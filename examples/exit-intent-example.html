<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exit Intent Example</title>
  
  <link rel="dns-prefetch" href="//campaigns.apps.29next.com">
  <link rel="dns-prefetch" href="//cdn-countries.muddy-wind-c7ca.workers.dev">

  <script src="https://campaign-cart-v2.pages.dev/config.js"></script>
  <script src="https://campaign-cart-v2.pages.dev/loader.js"></script>
</head>
<body>
  <h1>Exit Intent Demo</h1>
  <p>Try moving your mouse towards the top of the browser window (desktop) or scrolling down (mobile) to trigger the exit intent popup.</p>
  
  <div style="height: 200vh; padding: 20px;">
    <h2>Scroll down on mobile to trigger exit intent</h2>
    <p>This content is here to enable scrolling on mobile devices.</p>
  </div>

  <script>
    // Wait for SDK to be fully initialized
    window.addEventListener('next:initialized', function() {
      console.log('SDK initialized, setting up exit intent...');
      
      // Super simple exit intent setup
      next.exitIntent({
        image: 'https://cdn.prod.website-files.com/68106277c04984fe676e423a/6823ba8d65474fce67152554_exit-popup1.webp',
        action: async () => {
          const result = await next.applyCoupon('SAVE10');
          if (result.success) {
            alert('Coupon applied successfully: ' + result.message);
          } else {
            alert('Coupon failed: ' + result.message);
          }
        }
      });

      // Optional: Listen to events for analytics
      next.on('exit-intent:shown', (data) => {
        console.log('Exit intent popup shown:', data.imageUrl);
      });

      next.on('exit-intent:clicked', (data) => {
        console.log('Exit intent popup clicked:', data.imageUrl);
      });

      next.on('exit-intent:dismissed', (data) => {
        console.log('Exit intent popup dismissed:', data.imageUrl);
      });
    });
    
    // Even simpler examples:
    
    // Just show a popup (no action)
    function justShowPopup() {
      next.exitIntent({
        image: 'https://example.com/just-popup.webp'
      });
    }
    
    // Redirect instead of coupon
    function redirectExample() {
      next.exitIntent({
        image: 'https://example.com/special-offer.webp',
        action: () => {
          window.location.href = '/special-offer';
        }
      });
    }
    
    // Conditional popup based on cart
    function conditionalExample() {
      const cartCount = next.getCartCount();
      
      if (cartCount === 0) {
        next.exitIntent({
          image: 'https://example.com/empty-cart.webp',
          action: () => window.location.href = '/products'
        });
      } else {
        next.exitIntent({
          image: 'https://example.com/discount.webp', 
          action: () => next.applyCoupon('SAVE10')
        });
      }
    }
  </script>
</body>
</html>