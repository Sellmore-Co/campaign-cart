{
  "version": 3,
  "sources": ["../src/utils/NavigationPrevention.js", "../src/managers/ReceiptManager.js", "../src/index.js", "../src/api/ApiClient.js", "../src/utils/Logger.js", "../src/components/checkout/AddressHandler.js", "../src/components/checkout/FormValidator.js", "../src/managers/SpreedlyManager.js", "../src/utils/KonamiCodeHandler.js", "../src/components/checkout/PaymentHandler.js", "../src/components/checkout/BillingAddressHandler.js", "../src/components/checkout/PaymentSelector.js", "../src/components/checkout/AddressAutocomplete.js", "../src/components/checkout/PhoneInputHandler.js", "../src/components/checkout/ProspectCartHandler.js", "../src/components/checkout/ShippingSelector.js", "../src/managers/CheckoutManager.js", "../src/helpers/CampaignHelper.js", "../src/managers/StateManager.js", "../src/managers/CartManager.js", "../src/utils/DebugUtils.js", "../src/managers/SelectorManager.js", "../src/managers/ToggleManager.js", "../src/managers/DebugManager.js", "../src/managers/TimerManager.js", "../src/managers/DisplayManager.js", "../src/managers/CartDisplayManager.js", "../src/managers/AttributionManager.js", "../src/managers/EventManager.js", "../node_modules/@floating-ui/utils/dist/floating-ui.utils.mjs", "../node_modules/@floating-ui/core/dist/floating-ui.core.mjs", "../node_modules/@floating-ui/utils/dist/floating-ui.utils.dom.mjs", "../node_modules/@floating-ui/dom/dist/floating-ui.dom.esm.js", "../src/managers/TooltipManager.js", "../src/managers/UpsellManager.js", "../src/managers/DiscountManager.js", "../src/utils/PBAccordion.js", "../src/utils/UtmTransfer.js", "../src/core/TwentyNineNext.js"],
  "sourcesContent": ["export function preventBack() {\r\n    window.history.forward();\r\n}\r\n\r\n// Save upsell acceptance info to sessionStorage\r\nexport function saveAcceptedUpsell(packageId, nextUrl) {\r\n    try {\r\n        // Store that an upsell was accepted and the URL to return to\r\n        sessionStorage.setItem('upsell_accepted', 'true');\r\n        sessionStorage.setItem('upsell_package_id', packageId.toString());\r\n        sessionStorage.setItem('upsell_next_url', nextUrl);\r\n        \r\n        // Store current timestamp to potentially expire this data later\r\n        sessionStorage.setItem('upsell_accepted_time', Date.now().toString());\r\n    } catch (error) {\r\n        console.error('Error saving upsell data to sessionStorage:', error);\r\n    }\r\n}\r\n\r\n// Check if user has an accepted upsell and handle back navigation\r\nexport function handleBackNavigation() {\r\n    // If we have an accepted upsell, redirect on popstate (back button)\r\n    if (sessionStorage.getItem('upsell_accepted') === 'true') {\r\n        window.addEventListener('popstate', function(event) {\r\n            const nextUrl = sessionStorage.getItem('upsell_next_url');\r\n            if (nextUrl) {\r\n                // Redirect to the stored next URL, preserving debug parameters\r\n                const currentUrlParams = new URLSearchParams(window.location.search);\r\n                const hasDebug = currentUrlParams.has('debug') && currentUrlParams.get('debug') === 'true';\r\n                \r\n                // Create redirect URL with debug parameter if needed\r\n                let redirectUrl = nextUrl;\r\n                if (hasDebug) {\r\n                    // Check if nextUrl already has parameters\r\n                    if (redirectUrl.includes('?')) {\r\n                        redirectUrl += '&debug=true';\r\n                    } else {\r\n                        redirectUrl += '?debug=true';\r\n                    }\r\n                }\r\n                \r\n                window.location.href = redirectUrl;\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n// Check URL for debug parameter\r\nexport function hasDebugParameter() {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    return urlParams.has('debug') && urlParams.get('debug') === 'true';\r\n}\r\n\r\n// Create the next URL with debug parameter preserved if needed\r\nexport function createNextUrlWithDebug(nextUrl) {\r\n    if (!nextUrl) return nextUrl;\r\n    \r\n    if (hasDebugParameter()) {\r\n        // Check if nextUrl already has parameters\r\n        if (nextUrl.includes('?')) {\r\n            return `${nextUrl}&debug=true`;\r\n        } else {\r\n            return `${nextUrl}?debug=true`;\r\n        }\r\n    }\r\n    \r\n    return nextUrl;\r\n}\r\n\r\nexport function initNavigationPrevention() {\r\n    // Prevent back button with traditional approach\r\n    setTimeout(preventBack, 0);\r\n    window.onunload = function () {};\r\n    \r\n    // Set up back navigation handler for upsells\r\n    handleBackNavigation();\r\n}\r\n\r\n// For backward compatibility if this file is loaded via script tag\r\n// setTimeout(preventBack, 0);\r\n// window.onunload = function () {};", "/**\r\n * ReceiptPage - Handles the receipt page functionality\r\n * \r\n * This class is responsible for:\r\n * - Fetching order details using the ref_id from URL parameters\r\n * - Updating the DOM elements with order information\r\n * - Handling any receipt-specific interactions\r\n */\r\n\r\nimport { initNavigationPrevention, hasDebugParameter } from '../utils/NavigationPrevention.js';\r\n\r\nexport class ReceiptPage {\r\n  #apiClient;\r\n  #logger;\r\n  #app;\r\n  #orderData = null;\r\n  #orderFetched = false; // Flag to prevent duplicate API calls\r\n  #initialized = false; // Flag to prevent duplicate initialization\r\n  #debugMode = false;\r\n  \r\n  /**\r\n   * Initialize the ReceiptPage\r\n   * @param {Object} apiClient - The API client instance\r\n   * @param {Object} logger - The logger instance\r\n   * @param {Object} app - The main application instance\r\n   */\r\n  constructor(apiClient, logger, app) {\r\n    this.#apiClient = apiClient;\r\n    this.#logger = logger;\r\n    this.#app = app;\r\n    \r\n    // Check for debug mode\r\n    const debugMeta = document.querySelector('meta[name=\"os-debug\"]');\r\n    this.#debugMode = debugMeta?.getAttribute('content') === 'true';\r\n    \r\n    this.#safeLog('info', 'ReceiptPage component created');\r\n    \r\n    // Initialize immediately\r\n    this.init();\r\n  }\r\n  \r\n  // Safe logging method to handle potential missing logger methods\r\n  #safeLog(level, message, ...args) {\r\n    try {\r\n      if (this.#logger && typeof this.#logger[level] === 'function') {\r\n        this.#logger[level](message, ...args);\r\n      } else if (console[level]) {\r\n        console[level](message, ...args);\r\n      } else {\r\n        console.log(`[${level.toUpperCase()}] ${message}`, ...args);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error logging message:', error);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Initialize the receipt page\r\n   */\r\n  async init() {\r\n    // Prevent duplicate initialization\r\n    if (this.#initialized) {\r\n      this.#safeLog('info', 'Receipt page already initialized, skipping');\r\n      return;\r\n    }\r\n    \r\n    this.#safeLog('info', 'Initializing Receipt Page');\r\n    this.#initialized = true;\r\n    \r\n    // Check for debug mode from meta tag or URL parameter\r\n    // if (hasDebugParameter()) {\r\n    //   this.#debugMode = true;\r\n    //   this.#safeLog('debug', 'Debug mode enabled via URL parameter');\r\n    // }\r\n    \r\n    // Initialize navigation prevention\r\n    // initNavigationPrevention();\r\n    \r\n    // Get ref_id from URL parameters\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const refId = urlParams.get('ref_id');\r\n    \r\n    if (!refId) {\r\n      this.#safeLog('error', 'No ref_id found in URL parameters');\r\n      this.#showError('Order reference not found. Please check your URL.');\r\n      return;\r\n    }\r\n    \r\n    this.#safeLog('info', `Found ref_id in URL: ${refId}`);\r\n    \r\n    try {\r\n      // Fetch order details\r\n      await this.#fetchOrderDetails(refId);\r\n      \r\n      // Update the DOM with order details\r\n      this.#updateReceiptContent();\r\n    } catch (error) {\r\n      this.#safeLog('error', 'Error initializing receipt page:', error);\r\n      this.#showError('Failed to load order details. Please try again later.');\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Fetch order details from the API\r\n   * @param {string} refId - The order reference ID\r\n   */\r\n  async #fetchOrderDetails(refId) {\r\n    this.#safeLog('info', `Fetching order details for ref_id: ${refId}`);\r\n    \r\n    // Check if we've already fetched this order to prevent duplicate requests\r\n    if (this.#orderFetched && this.#orderData) {\r\n      this.#safeLog('info', 'Order already fetched, using cached data');\r\n      return this.#orderData;\r\n    }\r\n    \r\n    try {\r\n      // Check if API client is available\r\n      if (!this.#apiClient) {\r\n        throw new Error('API client not available');\r\n      }\r\n      \r\n      // Fetch order details\r\n      this.#safeLog('debug', 'Making API request to fetch order details');\r\n      this.#orderData = await this.#apiClient.getOrder(refId);\r\n      this.#orderFetched = true; // Set flag to prevent duplicate requests\r\n      \r\n      this.#safeLog('info', 'Order details fetched successfully');\r\n      this.#safeLog('debug', 'Order data:', this.#orderData);\r\n      \r\n      return this.#orderData;\r\n    } catch (error) {\r\n      this.#safeLog('error', `Error fetching order details for ref_id ${refId}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Update the receipt content with order details\r\n   */\r\n  #updateReceiptContent() {\r\n    if (!this.#orderData) {\r\n      this.#safeLog('error', 'No order data available to update receipt content');\r\n      return;\r\n    }\r\n    \r\n    this.#safeLog('info', 'Updating receipt content with order details');\r\n    \r\n    // Update customer name\r\n    this.#updateElement('fname', this.#orderData.user?.first_name || '');\r\n    \r\n    // Update billing information\r\n    if (this.#orderData.billing_address) {\r\n      this.#updateElement('billing_fname', `${this.#orderData.billing_address.first_name} ${this.#orderData.billing_address.last_name}`);\r\n      this.#updateElement('billing_address', this.#formatAddress(this.#orderData.billing_address));\r\n      this.#updateElement('billing_location', this.#formatLocation(this.#orderData.billing_address));\r\n      this.#updateElement('billing_country', this.#getCountryName(this.#orderData.billing_address.country) || '');\r\n    }\r\n    \r\n    // Update shipping information\r\n    if (this.#orderData.shipping_address) {\r\n      this.#updateElement('shipping_fname', `${this.#orderData.shipping_address.first_name} ${this.#orderData.shipping_address.last_name}`);\r\n      this.#updateElement('shipping_address', this.#formatAddress(this.#orderData.shipping_address));\r\n      this.#updateElement('shipping_location', this.#formatLocation(this.#orderData.shipping_address));\r\n      this.#updateElement('shipping_country', this.#getCountryName(this.#orderData.shipping_address.country) || '');\r\n    }\r\n    \r\n    // Update payment method - determine from order data\r\n    const paymentMethod = this.#determinePaymentMethod();\r\n    this.#updateElement('payment_method', paymentMethod);\r\n    \r\n    // Update order lines\r\n    this.#updateOrderLines();\r\n    \r\n    // Update shipping method - use both attribute names for compatibility\r\n    const shippingMethod = this.#orderData.shipping_method || 'Standard Shipping';\r\n    this.#updateElement('shipping-method', shippingMethod); // Hyphen version\r\n    this.#updateElement('shipping_method', shippingMethod); // Underscore version\r\n    \r\n    // Update shipping price\r\n    if (this.#orderData.shipping_excl_tax !== undefined) {\r\n      const shippingPrice = this.#formatCurrency(parseFloat(this.#orderData.shipping_excl_tax));\r\n      this.#updateElement('shipping-price', shippingPrice);\r\n      \r\n      // Always show shipping container regardless of price\r\n      const shippingContainer = document.querySelector('[data-os-receipt=\"shipping-container\"]');\r\n      if (shippingContainer) {\r\n        shippingContainer.style.display = 'flex';\r\n      }\r\n    }\r\n    \r\n    // Update tax information - show only if taxes exist\r\n    const taxContainer = document.querySelector('[data-os-receipt=\"tax-container\"]');\r\n    if (taxContainer) {\r\n      const totalTax = parseFloat(this.#orderData.total_tax || 0);\r\n      \r\n      if (totalTax > 0) {\r\n        // Show tax container and update tax amount\r\n        taxContainer.style.display = 'flex';\r\n        this.#updateElement('taxes', this.#formatCurrency(totalTax));\r\n      } else {\r\n        // Hide tax container if no taxes\r\n        taxContainer.style.display = 'none';\r\n      }\r\n    }\r\n    \r\n    // Update total\r\n    const total = this.#formatCurrency(parseFloat(this.#orderData.total_incl_tax) || 0);\r\n    this.#updateElement('total', total);\r\n    \r\n    // Update order number\r\n    this.#updateElement('order_number', this.#orderData.number || '');\r\n    \r\n    // Update order reference\r\n    this.#updateElement('order_reference', this.#orderData.ref_id || '');\r\n    \r\n    this.#safeLog('info', 'Receipt content updated successfully');\r\n  }\r\n  \r\n  /**\r\n   * Determine payment method from order data\r\n   * @returns {string} The formatted payment method\r\n   */\r\n  #determinePaymentMethod() {\r\n    // Check if payment_detail exists in the order data\r\n    if (this.#orderData.payment_detail && this.#orderData.payment_detail.payment_method) {\r\n      return this.#formatPaymentMethod(this.#orderData.payment_detail.payment_method);\r\n    }\r\n    \r\n    // If no payment_detail, try to determine from other fields\r\n    if (this.#orderData.payment_method) {\r\n      return this.#formatPaymentMethod(this.#orderData.payment_method);\r\n    }\r\n    \r\n    // Default to Credit Card if we can't determine\r\n    return 'Credit Card';\r\n  }\r\n  \r\n  /**\r\n   * Update order lines in the receipt\r\n   */\r\n  #updateOrderLines() {\r\n    if (!this.#orderData.lines || !Array.isArray(this.#orderData.lines)) {\r\n      this.#safeLog('warn', 'No order lines available');\r\n      return;\r\n    }\r\n    \r\n    const orderLinesContainer = document.querySelector('[data-os-receipt=\"order-lines\"]');\r\n    if (!orderLinesContainer) {\r\n      this.#safeLog('warn', 'Order lines container not found in DOM');\r\n      return;\r\n    }\r\n    \r\n    // Clear existing content\r\n    orderLinesContainer.innerHTML = '';\r\n    \r\n    // Template for a product line\r\n    const lineTemplate = document.querySelector('[data-os-receipt=\"product-line\"]');\r\n    \r\n    // If no template is found, create a simple one\r\n    let template = lineTemplate ? lineTemplate.outerHTML : `\r\n      <div data-os-receipt=\"product-line\" class=\"cart-summary__line\">\r\n        <div class=\"cart-summary__line-item\">\r\n          <div data-os-receipt=\"line-title\" class=\"cart-line__title\"></div>\r\n          <div data-os-receipt=\"line-saving\" class=\"cart-line__discount\"></div>\r\n        </div>\r\n        <div class=\"cart-summary__line-item\">\r\n          <p data-os-receipt=\"line-compare\" class=\"pb-cart__line-price pb--compare\"></p>\r\n          <p data-os-receipt=\"line-subtotal\" class=\"pb-cart__line-price\"></p>\r\n        </div>\r\n      </div>\r\n    `;\r\n    \r\n    // Add each order line\r\n    this.#orderData.lines.forEach(line => {\r\n      // Create a new line element\r\n      const lineElement = document.createElement('div');\r\n      lineElement.innerHTML = template;\r\n      const newLine = lineElement.firstElementChild;\r\n      \r\n      // Update line details\r\n      const productTitle = line.product_title || line.title || line.package_title || 'Product';\r\n      this.#updateElementInNode(newLine, 'line-title', productTitle);\r\n      \r\n      // Calculate savings if compare price is available\r\n      if (line.price_excl_tax_excl_discounts && \r\n          parseFloat(line.price_excl_tax_excl_discounts) > parseFloat(line.price_excl_tax)) {\r\n        const originalPrice = parseFloat(line.price_excl_tax_excl_discounts);\r\n        const currentPrice = parseFloat(line.price_excl_tax);\r\n        const savingsPercent = Math.round((1 - currentPrice / originalPrice) * 100);\r\n        \r\n        this.#updateElementInNode(newLine, 'line-saving', `(${savingsPercent}% OFF)`);\r\n        this.#updateElementInNode(newLine, 'line-compare', this.#formatCurrency(originalPrice));\r\n      } else {\r\n        // Hide savings elements if no compare price\r\n        const savingElement = newLine.querySelector('[data-os-receipt=\"line-saving\"]');\r\n        const compareElement = newLine.querySelector('[data-os-receipt=\"line-compare\"]');\r\n        if (savingElement) savingElement.style.display = 'none';\r\n        if (compareElement) compareElement.style.display = 'none';\r\n      }\r\n      \r\n      // Update subtotal - use price excluding tax instead of price including tax\r\n      const price = parseFloat(line.price_excl_tax) || 0;\r\n      this.#updateElementInNode(newLine, 'line-subtotal', this.#formatCurrency(price));\r\n      \r\n      // Add the line to the container\r\n      orderLinesContainer.appendChild(newLine);\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Update an element with the given value\r\n   * @param {string} attribute - The data-os-receipt attribute value\r\n   * @param {string} value - The value to set\r\n   */\r\n  #updateElement(attribute, value) {\r\n    const elements = document.querySelectorAll(`[data-os-receipt=\"${attribute}\"]`);\r\n    \r\n    if (elements.length === 0) {\r\n      this.#safeLog('debug', `No elements found with data-os-receipt=\"${attribute}\"`);\r\n      return;\r\n    }\r\n    \r\n    elements.forEach(element => {\r\n      element.textContent = value;\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Update an element within a specific node\r\n   * @param {HTMLElement} node - The parent node\r\n   * @param {string} attribute - The data-os-receipt attribute value\r\n   * @param {string} value - The value to set\r\n   */\r\n  #updateElementInNode(node, attribute, value) {\r\n    const element = node.querySelector(`[data-os-receipt=\"${attribute}\"]`);\r\n    \r\n    if (!element) {\r\n      this.#safeLog('debug', `No element found with data-os-receipt=\"${attribute}\" in node`);\r\n      return;\r\n    }\r\n    \r\n    element.textContent = value;\r\n  }\r\n  \r\n  /**\r\n   * Format an address for display\r\n   * @param {Object} address - The address object\r\n   * @returns {string} The formatted address\r\n   */\r\n  #formatAddress(address) {\r\n    let formattedAddress = '';\r\n    \r\n    if (address.line1) {\r\n      formattedAddress += address.line1;\r\n    }\r\n    \r\n    if (address.line2) {\r\n      formattedAddress += formattedAddress ? `, ${address.line2}` : address.line2;\r\n    }\r\n    \r\n    return formattedAddress;\r\n  }\r\n  \r\n  /**\r\n   * Format location (city, state, zip) for display\r\n   * @param {Object} address - The address object\r\n   * @returns {string} The formatted location\r\n   */\r\n  #formatLocation(address) {\r\n    let parts = [];\r\n    \r\n    if (address.line4) {\r\n      parts.push(address.line4); // City is in line4\r\n    }\r\n    \r\n    if (address.state) {\r\n      parts.push(address.state);\r\n    }\r\n    \r\n    if (address.postcode) {\r\n      parts.push(address.postcode);\r\n    }\r\n    \r\n    return parts.join(', ');\r\n  }\r\n  \r\n  /**\r\n   * Get country name from country code\r\n   * @param {string} countryCode - The country code\r\n   * @returns {string} The country name\r\n   */\r\n  #getCountryName(countryCode) {\r\n    const countryMap = {\r\n      'US': 'United States',\r\n      'CA': 'Canada',\r\n      'GB': 'United Kingdom',\r\n      'AU': 'Australia',\r\n      'NZ': 'New Zealand',\r\n      // Add more countries as needed\r\n    };\r\n    \r\n    return countryMap[countryCode] || countryCode;\r\n  }\r\n  \r\n  /**\r\n   * Format payment method for display\r\n   * @param {string} method - The payment method\r\n   * @returns {string} The formatted payment method\r\n   */\r\n  #formatPaymentMethod(method) {\r\n    const methodMap = {\r\n      'card_token': 'Credit Card',\r\n      'paypal': 'PayPal',\r\n      'apple_pay': 'Apple Pay',\r\n      'google_pay': 'Google Pay',\r\n      'credit': 'Credit Card',\r\n      'card': 'Credit Card'\r\n    };\r\n    \r\n    return methodMap[method] || method;\r\n  }\r\n  \r\n  /**\r\n   * Format currency for display\r\n   * @param {number} amount - The amount\r\n   * @returns {string} The formatted currency\r\n   */\r\n  #formatCurrency(amount) {\r\n    const currency = this.#orderData.currency || 'USD';\r\n    \r\n    // Ensure amount is a number\r\n    const numericAmount = parseFloat(amount);\r\n    \r\n    if (isNaN(numericAmount)) {\r\n      this.#safeLog('warn', `Invalid amount for currency formatting: ${amount}`);\r\n      return `$0.00 ${currency}`;\r\n    }\r\n    \r\n    try {\r\n      return new Intl.NumberFormat('en-US', {\r\n        style: 'currency',\r\n        currency: currency\r\n      }).format(numericAmount);\r\n    } catch (error) {\r\n      this.#safeLog('error', `Error formatting currency: ${error}`);\r\n      return `$${numericAmount.toFixed(2)} ${currency}`;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Show an error message on the page\r\n   * @param {string} message - The error message\r\n   */\r\n  #showError(message) {\r\n    this.#safeLog('error', `Displaying error message: ${message}`);\r\n    \r\n    // Find a container to show the error\r\n    const container = document.querySelector('.receipt-content') || document.body;\r\n    \r\n    // Create error element\r\n    const errorElement = document.createElement('div');\r\n    errorElement.className = 'receipt-error';\r\n    errorElement.style.color = 'red';\r\n    errorElement.style.padding = '20px';\r\n    errorElement.style.margin = '20px 0';\r\n    errorElement.style.border = '1px solid red';\r\n    errorElement.style.borderRadius = '5px';\r\n    errorElement.style.backgroundColor = 'rgba(255, 0, 0, 0.1)';\r\n    errorElement.textContent = message;\r\n    \r\n    // Add to the beginning of the container\r\n    container.prepend(errorElement);\r\n  }\r\n} ", "/**\r\n * 29next Client - Checkout Focus\r\n * A streamlined JavaScript utility for connecting 29next campaigns with checkout functionality.\r\n * \r\n * This is the main entry point for the library. It handles auto-initialization\r\n * and exports the TwentyNineNext class for manual initialization.\r\n */\r\n\r\nimport { TwentyNineNext } from './core/TwentyNineNext.js';\r\n\r\n// Initialize the client\r\nconst initialize = () => {\r\n  try {\r\n    // Skip initialization if explicitly disabled\r\n    if (document.querySelector('meta[name=\"os-disable-auto-init\"]')) {\r\n      console.log('29next Client: Auto-initialization disabled');\r\n      return;\r\n    }\r\n\r\n    // Get configuration from meta tags\r\n    const config = {\r\n      apiKey: document.querySelector('meta[name=\"os-api-key\"]')?.getAttribute('content') ?? null,\r\n      campaignId: document.querySelector('meta[name=\"os-campaign-id\"]')?.getAttribute('content') ?? null,\r\n      debug: document.querySelector('meta[name=\"os-debug\"]')?.getAttribute('content') === 'true',\r\n      paypalClientId: document.querySelector('meta[name=\"os-paypal-client-id\"]')?.getAttribute('content') ?? null,\r\n    };\r\n    \r\n    // Log initialization attempt\r\n    console.log('29next Client: Initializing with config', \r\n      JSON.stringify({\r\n        apiKey: config.apiKey ? '✓ Set' : '✗ Not set',\r\n        campaignId: config.campaignId ? '✓ Set' : '✗ Not set',\r\n        debug: config.debug\r\n      })\r\n    );\r\n    \r\n    // Set up the on29NextReady array if it doesn't exist yet\r\n    window.on29NextReady = Array.isArray(window.on29NextReady) ? window.on29NextReady : [];\r\n    \r\n    // Store the original callbacks\r\n    const callbacks = [...window.on29NextReady];\r\n    \r\n    // Create the client instance\r\n    window.twentyNineNext = new TwentyNineNext(config);\r\n    \r\n    // Process existing callbacks\r\n    callbacks.forEach(callback => {\r\n      window.twentyNineNext.onReady(callback);\r\n    });\r\n    \r\n    // Replace the array with an object that uses onReady for future callbacks\r\n    window.on29NextReady = {\r\n      push: callback => window.twentyNineNext.onReady(callback)\r\n    };\r\n  } catch (error) {\r\n    console.error('29next Client: Error during initialization', error);\r\n  }\r\n};\r\n\r\n// Initialize now if the DOM is already loaded, otherwise wait for DOMContentLoaded\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', initialize);\r\n} else {\r\n  initialize();\r\n}\r\n\r\nexport { TwentyNineNext };", "/**\r\n * ApiClient - Handles API requests to the 29next API\r\n * \r\n * This class is responsible for making API requests to the 29next API,\r\n * including fetching campaign data, creating carts, and processing orders.\r\n */\r\n\r\nexport class ApiClient {\r\n  #app;\r\n  #apiKey;\r\n  #campaignId;\r\n  #baseUrl = 'https://campaigns.apps.29next.com/api/v1';\r\n  #logger;\r\n\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#logger = app.logger.createModuleLogger('API');\r\n  }\r\n\r\n  init() {\r\n    this.#logger.info('Initializing ApiClient');\r\n    \r\n    // Check for campaign ID in URL parameters and save to localStorage if present\r\n    this.#checkForCampaignIdInUrl();\r\n    \r\n    // Get campaign ID from local storage or meta tag to use as API key\r\n    this.#campaignId = this.#getCampaignId();\r\n    \r\n    // Use campaign ID as API key if available\r\n    if (this.#campaignId) {\r\n      this.#apiKey = this.#campaignId;\r\n      this.#logger.info(`Using campaign ID as API key: ${this.#apiKey}`);\r\n    } else {\r\n      // Fall back to meta tag API key\r\n      const apiKeyMeta = document.querySelector('meta[name=\"os-api-key\"]');\r\n      this.#apiKey = apiKeyMeta?.getAttribute('content');\r\n      this.#logger.info(this.#apiKey ? 'API key retrieved from meta tag' : 'API key is not set');\r\n    }\r\n    \r\n    const proxyMeta = document.querySelector('meta[name=\"os-proxy-url\"]');\r\n    const proxyUrl = proxyMeta?.getAttribute('content');\r\n    if (proxyUrl) {\r\n      this.#baseUrl = proxyUrl;\r\n      this.#logger.info(`Using proxy URL: ${proxyUrl}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if campaignId exists in URL parameters and save to local storage if it does\r\n   */\r\n  #checkForCampaignIdInUrl() {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const campaignId = urlParams.get('campaignId');\r\n    \r\n    if (campaignId) {\r\n      this.#logger.info(`Found campaignId in URL: ${campaignId}`);\r\n      sessionStorage.setItem('os-campaign-id', campaignId);\r\n      this.#logger.info('Saved campaignId to session storage');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get campaign ID from session storage or meta tag\r\n   * @returns {string|null} Campaign ID\r\n   */\r\n  #getCampaignId() {\r\n    // First check session storage for campaign ID override\r\n    const storedCampaignId = sessionStorage.getItem('os-campaign-id');\r\n    \r\n    if (storedCampaignId) {\r\n      this.#logger.info(`Using campaign ID from session storage: ${storedCampaignId}`);\r\n      return storedCampaignId;\r\n    }\r\n    \r\n    // Fall back to meta tag\r\n    const campaignIdMeta = document.querySelector('meta[name=\"os-campaign-id\"]');\r\n    const metaCampaignId = campaignIdMeta?.getAttribute('content') ?? null;\r\n    \r\n    if (metaCampaignId) {\r\n      this.#logger.info(`Using campaign ID from meta tag: ${metaCampaignId}`);\r\n      return metaCampaignId;\r\n    }\r\n    \r\n    this.#logger.warn('No campaign ID found in session storage or meta tag');\r\n    return null;\r\n  }\r\n\r\n  #buildUrl(endpoint) {\r\n    const cleanEndpoint = endpoint.startsWith('/') ? endpoint.slice(1) : endpoint;\r\n    return `${this.#baseUrl}/${cleanEndpoint}`;\r\n  }\r\n\r\n  async #request(endpoint, method = 'GET', data = null) {\r\n    if (!this.#apiKey) {\r\n      this.#logger.warn('API key is not set');\r\n      if (endpoint === 'campaigns/') {\r\n        this.#logger.info('Returning mock campaign data since API key is not set');\r\n        return [{\r\n          name: 'Mock Campaign',\r\n          id: 'mock-campaign',\r\n          currency: 'USD',\r\n          locale: 'en-US',\r\n          packages: [],\r\n          products: []\r\n        }];\r\n      }\r\n      throw new Error('API key is required');\r\n    }\r\n\r\n    const url = this.#buildUrl(endpoint);\r\n    const options = {\r\n      method,\r\n      mode: 'cors',\r\n      credentials: 'same-origin',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Accept': 'application/json',\r\n        'Authorization': this.#apiKey\r\n      }\r\n    };\r\n\r\n    if (method !== 'GET' && data) options.body = JSON.stringify(data);\r\n\r\n    this.#logger.debug(`Making ${method} request to ${url}`, method !== 'GET' ? { requestData: data } : {});\r\n\r\n    try {\r\n      const response = await fetch(url, options);\r\n      this.#logger.debug(`Received response from ${url} with status ${response.status}`);\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json().catch(() => ({}));\r\n        this.#logger.error(`API error response from ${url}:`, errorData);\r\n        throw new Error(JSON.stringify(errorData));\r\n      }\r\n\r\n      const responseData = await response.json();\r\n      this.#logger.debug(`Successfully processed response from ${url}`);\r\n      return responseData;\r\n    } catch (error) {\r\n      this.#logger.error(`API request failed: ${endpoint}`, error);\r\n      if (error.message?.match(/NetworkError|Failed to fetch|Network request failed/)) {\r\n        this.#logger.warn('This appears to be a CORS issue. Make sure the API endpoint allows cross-origin requests.');\r\n      }\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async getCampaign() {\r\n    try {\r\n      const campaignsData = await this.#request('campaigns/');\r\n      this.#logger.debug('Campaign data received');\r\n\r\n      if (Array.isArray(campaignsData) && campaignsData.length > 0) return campaignsData[0];\r\n      if (campaignsData?.name) return campaignsData;\r\n\r\n      throw new Error('No valid campaign data found');\r\n    } catch (error) {\r\n      this.#logger.error('Error fetching campaign:', error);\r\n      this.#logger.warn('Using fallback empty campaign object');\r\n      return {\r\n        name: 'Default Campaign',\r\n        currency: 'USD',\r\n        packages: [],\r\n        formatPrice: price => `$${Number.parseFloat(price).toFixed(2)}`\r\n      };\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Get the current campaign ID\r\n   * @returns {string|null} The current campaign ID\r\n   */\r\n  getCampaignId() {\r\n    return this.#campaignId;\r\n  }\r\n\r\n  /**\r\n   * Get attribution data from the app instance\r\n   * @returns {Object} Attribution data\r\n   */\r\n  #getAttributionData() {\r\n    // Try to get from AttributionManager first\r\n    if (this.#app.attribution) {\r\n      // Use getAttributionForApi() which formats data correctly for the API\r\n      if (typeof this.#app.attribution.getAttributionForApi === 'function') {\r\n        return this.#app.attribution.getAttributionForApi();\r\n      }\r\n      return this.#app.attribution.getAttributionData();\r\n    }\r\n    \r\n    // Fall back to state if AttributionManager is not available\r\n    if (this.#app.state) {\r\n      // Try to get the API-formatted attribution data first\r\n      const apiFormatted = this.#app.state.getState('attribution');\r\n      if (apiFormatted) {\r\n        return apiFormatted;\r\n      }\r\n      // Fall back to the complete attribution data if necessary\r\n      return this.#app.state.getState('cart.attribution') || {};\r\n    }\r\n    \r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * Create a cart via the API\r\n   * @param {Object} cartData - The cart data\r\n   * @returns {Promise<Object>} The created cart\r\n   */\r\n  async createCart(cartData) {\r\n    this.#logger.debug('Creating cart', cartData);\r\n    \r\n    // Ensure attribution data is included\r\n    if (!cartData.attribution) {\r\n      cartData.attribution = this.#getAttributionData();\r\n      this.#logger.debug('Added attribution data to cart:', cartData.attribution);\r\n    } else {\r\n      this.#logger.debug('Cart already has attribution data:', cartData.attribution);\r\n    }\r\n    \r\n    try {\r\n      const response = await this.#request('carts/', 'POST', cartData);\r\n      this.#logger.info('Cart created successfully', response);\r\n      return response;\r\n    } catch (error) {\r\n      this.#logger.error('Error creating cart', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create an order via the API\r\n   * @param {Object} orderData - The order data\r\n   * @returns {Promise<Object>} The created order\r\n   */\r\n  async createOrder(orderData) {\r\n    this.#logger.info('Sending /order/create payload:', orderData);\r\n    \r\n    // Ensure attribution data is included\r\n    if (!orderData.attribution) {\r\n      orderData.attribution = this.#getAttributionData();\r\n      this.#logger.debug('Added attribution data to order:', orderData.attribution);\r\n    } else {\r\n      this.#logger.debug('Order already has attribution data:', orderData.attribution);\r\n    }\r\n    \r\n    // Ensure vouchers are properly formatted\r\n    if (orderData.vouchers) {\r\n      // First, check if vouchers is an array of objects with 'code', 'type', and 'value'\r\n      if (Array.isArray(orderData.vouchers) && orderData.vouchers.length > 0) {\r\n        // Check first voucher to determine format\r\n        const firstVoucher = orderData.vouchers[0];\r\n        \r\n        if (typeof firstVoucher === 'object' && firstVoucher !== null) {\r\n          // Convert object vouchers to string codes - API expects simple strings\r\n          orderData.vouchers = orderData.vouchers.map(voucher => {\r\n            if (typeof voucher === 'string') {\r\n              return voucher;\r\n            } else if (voucher && voucher.code) {\r\n              return voucher.code;\r\n            } else {\r\n              return String(voucher);\r\n            }\r\n          });\r\n          this.#logger.debug('Converted voucher objects to string codes for API:', orderData.vouchers);\r\n        }\r\n      }\r\n      \r\n      // Ensure it's still an array\r\n      if (!Array.isArray(orderData.vouchers)) {\r\n        if (typeof orderData.vouchers === 'string') {\r\n          orderData.vouchers = [orderData.vouchers];\r\n        } else {\r\n          // If it's not a string or array, log warning and remove it\r\n          this.#logger.warn('Invalid vouchers format, removing:', orderData.vouchers);\r\n          delete orderData.vouchers;\r\n        }\r\n      }\r\n      \r\n      if (orderData.vouchers) {\r\n        this.#logger.debug('Final vouchers format for API:', orderData.vouchers);\r\n      }\r\n    }\r\n    \r\n    // Check if this is a test order with test_card token\r\n    if (orderData.payment_token === 'test_card' || \r\n        (orderData.payment_detail && orderData.payment_detail.card_token === 'test_card')) {\r\n      \r\n      this.#logger.debug('Using test card token for order');\r\n      \r\n      // Ensure payment_detail is properly formatted for test card\r\n      orderData.payment_detail = orderData.payment_detail || {};\r\n      orderData.payment_detail.payment_method = 'card_token';\r\n      orderData.payment_detail.card_token = 'test_card';\r\n      \r\n      // If there was a payment_token at the root level, move it to payment_detail\r\n      if (orderData.payment_token) {\r\n        delete orderData.payment_token;\r\n      }\r\n    }\r\n    \r\n    try {\r\n      const response = await this.#request('orders/', 'POST', orderData);\r\n      this.#logger.info('Order created successfully', response);\r\n      \r\n      // Store order reference ID in sessionStorage\r\n      if (response.ref_id) {\r\n        sessionStorage.setItem('order_ref_id', response.ref_id);\r\n        this.#logger.debug(`Order reference ID stored: ${response.ref_id}`);\r\n      }\r\n      \r\n      return response;\r\n    } catch (error) {\r\n      this.#logger.error('Error creating order', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async getOrder(orderRef) {\r\n    if (!orderRef) throw new Error('Order reference is required');\r\n    this.#logger.debug(`Fetching order with ref: ${orderRef}`);\r\n    return this.#request(`orders/${orderRef}/`);\r\n  }\r\n\r\n  /**\r\n   * Add an upsell to an existing order\r\n   * @param {string} orderRef - Order reference ID\r\n   * @param {Object} upsellData - The upsell data including package_id and quantity\r\n   * @returns {Promise<Object>} The updated order\r\n   */\r\n  async createOrderUpsell(orderRef, upsellData) {\r\n    if (!orderRef) throw new Error('Order reference is required');\r\n    this.#logger.debug(`Adding upsell to order ref: ${orderRef}`, upsellData);\r\n    \r\n    // Format the upsell data properly\r\n    const formattedData = {\r\n      lines: Array.isArray(upsellData.lines) ? upsellData.lines : [\r\n        {\r\n          package_id: upsellData.package_id,\r\n          quantity: upsellData.quantity || 1\r\n        }\r\n      ]\r\n    };\r\n    \r\n    // Add payment detail if provided\r\n    if (upsellData.payment_detail) {\r\n      formattedData.payment_detail = upsellData.payment_detail;\r\n    }\r\n    \r\n    try {\r\n      const response = await this.#request(`orders/${orderRef}/upsells/`, 'POST', formattedData);\r\n      this.#logger.info('Upsell added successfully', response);\r\n      return response;\r\n    } catch (error) {\r\n      this.#logger.error('Error adding upsell to order', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the next page URL from the meta tag\r\n   * @param {string} refId - Optional reference ID to append to the URL\r\n   * @returns {string|null} Formatted next page URL or null if meta tag not found\r\n   */\r\n  getNextPageUrlFromMeta(refId = null) {\r\n    const nextPageMeta = document.querySelector('meta[name=\"os-next-page\"]');\r\n    if (!nextPageMeta || !nextPageMeta.getAttribute('content')) {\r\n      this.#logger.debug('No meta tag found for next page URL');\r\n      return null;\r\n    }\r\n    \r\n    const nextPagePath = nextPageMeta.getAttribute('content');\r\n    this.#logger.debug(`Found meta tag with next page URL: ${nextPagePath}`);\r\n    \r\n    // Convert to full URL if it's not already\r\n    const redirectUrl = nextPagePath.startsWith('http') ? \r\n      new URL(nextPagePath) : \r\n      new URL(nextPagePath, `${location.protocol}//${location.host}`);\r\n    \r\n    // Add ref_id as query param if provided\r\n    if (refId) {\r\n      redirectUrl.searchParams.append('ref_id', refId);\r\n    }\r\n    \r\n    return redirectUrl.href;\r\n  }\r\n\r\n  async processPayment(orderData, paymentMethod) {\r\n    this.#logger.debug(`Processing ${paymentMethod} payment for order`);\r\n\r\n    const paymentMethodMap = {\r\n      'credit': 'card_token',\r\n      'paypal': 'paypal',\r\n      'apple_pay': 'apple_pay',\r\n      'google_pay': 'google_pay'\r\n    };\r\n\r\n    orderData.payment_detail = orderData.payment_detail ?? {};\r\n    orderData.payment_detail.payment_method = paymentMethodMap[paymentMethod] ?? paymentMethod;\r\n\r\n    if (paymentMethod === 'credit' && !orderData.payment_detail.card_token) {\r\n      throw new Error('Credit card payment requires a card token');\r\n    }\r\n    if (paymentMethod !== 'credit') delete orderData.payment_detail.card_token;\r\n    \r\n    // Only set success_url from meta tag if available\r\n    if (!orderData.success_url) {\r\n      // Get from meta tag using utility method\r\n      const nextPageUrl = this.getNextPageUrlFromMeta(orderData.ref_id);\r\n      if (nextPageUrl) {\r\n        orderData.success_url = nextPageUrl;\r\n        this.#logger.debug(`Set success_url from meta tag: ${orderData.success_url}`);\r\n      } else {\r\n        this.#logger.debug('No meta tag found for success_url, API will use order_status_url as fallback');\r\n      }\r\n    }\r\n    \r\n    // Add payment_failed_url to redirect back to current page with error parameters\r\n    if (!orderData.payment_failed_url) {\r\n      const currentUrl = new URL(window.location.href);\r\n      currentUrl.searchParams.set('payment_failed', 'true');\r\n      currentUrl.searchParams.set('payment_method', paymentMethod);\r\n      orderData.payment_failed_url = currentUrl.href;\r\n      this.#logger.debug(`Set payment_failed_url to: ${orderData.payment_failed_url}`);\r\n    }\r\n\r\n    return this.createOrder(orderData);\r\n  }\r\n\r\n  getNextUrlFromOrderResponse(orderResponse) {\r\n    this.#logger.debug('Getting next URL for redirect');\r\n\r\n    const refId = orderResponse.ref_id;\r\n    \r\n    // If the API provides a payment_complete_url, use it directly (highest priority)\r\n    if (orderResponse.payment_complete_url) {\r\n      this.#logger.debug(`Using payment complete URL from API: ${orderResponse.payment_complete_url}`);\r\n      return orderResponse.payment_complete_url;\r\n    }\r\n    \r\n    // Check for next page URL in meta tag (second priority) using utility method\r\n    const nextPageUrl = this.getNextPageUrlFromMeta(refId);\r\n    if (nextPageUrl) {\r\n      return nextPageUrl;\r\n    }\r\n    \r\n    // Always use order_status_url as final fallback\r\n    if (orderResponse.order_status_url) {\r\n      this.#logger.debug(`Using order status URL from API: ${orderResponse.order_status_url}`);\r\n      return orderResponse.order_status_url;\r\n    }\r\n    \r\n    // If somehow no order_status_url exists (should not happen), log a warning\r\n    this.#logger.warn('No order_status_url found in API response - using fallback URL');\r\n    return `${window.location.origin}/checkout/confirmation/?ref_id=${refId || ''}`;\r\n  }\r\n}", "/**\r\n * Logger - Provides logging functionality for the 29next client\r\n */\r\n\r\n// Add global declaration for TypeScript compatibility\r\n// This would typically be in a separate .d.ts file in a TypeScript project\r\n// But including it as a comment for reference\r\n// declare global {\r\n//   interface Window {\r\n//     twentyNineNextStartupTime: number;\r\n//   }\r\n// }\r\n\r\nexport class Logger {\r\n  #debug;\r\n  #prefix = '29next';\r\n  #startupTime = 0;\r\n\r\n  constructor(debug = false) {\r\n    this.#debug = debug;\r\n    this.setStartupTime();\r\n  }\r\n\r\n  setDebug(debug) {\r\n    this.#debug = debug;\r\n  }\r\n\r\n  /**\r\n   * Sets the startup time to the current timestamp\r\n   */\r\n  setStartupTime() {\r\n    this.#startupTime = +new Date();\r\n    // Make startup time available globally\r\n    window.twentyNineNextStartupTime = this.#startupTime;\r\n  }\r\n\r\n  /**\r\n   * Gets the elapsed time since startup in milliseconds\r\n   */\r\n  getElapsedTime() {\r\n    return (+new Date()) - this.#startupTime;\r\n  }\r\n\r\n  createModuleLogger(moduleName) {\r\n    const modulePrefix = `${this.#prefix} [${moduleName}]`;\r\n    return {\r\n      debug: (...args) => this.#debugLog(modulePrefix, ...args),\r\n      info: (...args) => this.#info(modulePrefix, ...args),\r\n      warn: (...args) => this.#warn(modulePrefix, ...args),\r\n      error: (...args) => this.#error(modulePrefix, ...args),\r\n      // Add timing methods to module loggers\r\n      debugWithTime: (...args) => this.#debugLogWithTime(modulePrefix, ...args),\r\n      infoWithTime: (...args) => this.#infoWithTime(modulePrefix, ...args),\r\n      warnWithTime: (...args) => this.#warnWithTime(modulePrefix, ...args),\r\n      errorWithTime: (...args) => this.#errorWithTime(modulePrefix, ...args)\r\n    };\r\n  }\r\n\r\n  #info(prefix, message, ...args) {\r\n    console.info(`%c${prefix}%c ${message}`, 'color: #0066cc; font-weight: bold;', 'color: inherit;', ...args);\r\n  }\r\n\r\n  #warn(prefix, message, ...args) {\r\n    console.warn(`%c${prefix}%c ${message}`, 'color: #ff9900; font-weight: bold;', 'color: inherit;', ...args);\r\n  }\r\n\r\n  #error(prefix, message, ...args) {\r\n    console.error(`%c${prefix}%c ${message}`, 'color: #cc0000; font-weight: bold;', 'color: inherit;', ...args);\r\n  }\r\n\r\n  #debugLog(prefix, message, ...args) {\r\n    if (this.#debug) {\r\n      console.debug(`%c${prefix}:debug%c ${message}`, 'color: #666666; font-weight: bold;', 'color: inherit;', ...args);\r\n    }\r\n  }\r\n\r\n  // New methods with timing information\r\n  #infoWithTime(prefix, message, ...args) {\r\n    const diff = this.getElapsedTime();\r\n    console.info(`%c${prefix} +${diff}ms%c ${message}`, 'color: #0066cc; font-weight: bold;', 'color: inherit;', ...args);\r\n  }\r\n\r\n  #warnWithTime(prefix, message, ...args) {\r\n    const diff = this.getElapsedTime();\r\n    console.warn(`%c${prefix} +${diff}ms%c ${message}`, 'color: #ff9900; font-weight: bold;', 'color: inherit;', ...args);\r\n  }\r\n\r\n  #errorWithTime(prefix, message, ...args) {\r\n    const diff = this.getElapsedTime();\r\n    console.error(`%c${prefix} +${diff}ms%c ${message}`, 'color: #cc0000; font-weight: bold;', 'color: inherit;', ...args);\r\n  }\r\n\r\n  #debugLogWithTime(prefix, message, ...args) {\r\n    if (this.#debug) {\r\n      const diff = this.getElapsedTime();\r\n      console.debug(`%c${prefix}:debug +${diff}ms%c ${message}`, 'color: #666666; font-weight: bold;', 'color: inherit;', ...args);\r\n    }\r\n  }\r\n\r\n  // Standalone timing log methods\r\n  logWithTime(message, ...args) {\r\n    const diff = this.getElapsedTime();\r\n    console.log(`%c${this.#prefix} +${diff}ms%c ${message}`, 'color: #0066cc; font-weight: bold;', 'color: inherit;', ...args);\r\n  }\r\n\r\n  warnWithTime(message, ...args) {\r\n    const diff = this.getElapsedTime();\r\n    console.warn(`%c${this.#prefix} +${diff}ms%c ${message}`, 'color: #ff9900; font-weight: bold;', 'color: inherit;', ...args);\r\n  }\r\n\r\n  errorWithTime(message, ...args) {\r\n    const diff = this.getElapsedTime();\r\n    console.error(`%c${this.#prefix} +${diff}ms%c ${message}`, 'color: #cc0000; font-weight: bold;', 'color: inherit;', ...args);\r\n  }\r\n\r\n  debugWithTime(message, ...args) {\r\n    if (this.#debug) {\r\n      const diff = this.getElapsedTime();\r\n      console.debug(`%c${this.#prefix}:debug +${diff}ms%c ${message}`, 'color: #666666; font-weight: bold;', 'color: inherit;', ...args);\r\n    }\r\n  }\r\n}", "export class AddressHandler {\r\n  #form;\r\n  #logger;\r\n  #addressConfig;\r\n  #countries = [];\r\n  #states = {};\r\n  #elements;\r\n\r\n  constructor(form, logger) {\r\n    this.#form = form;\r\n    this.#logger = logger;\r\n    this.#addressConfig = this.#getAddressConfig();\r\n    this.#elements = {\r\n      shippingCountry: document.querySelector('[os-checkout-field=\"country\"]'),\r\n      shippingState: document.querySelector('[os-checkout-field=\"province\"]'),\r\n      billingCountry: document.querySelector('[os-checkout-field=\"billing-country\"]'),\r\n      billingState: document.querySelector('[os-checkout-field=\"billing-province\"]'),\r\n    };\r\n\r\n    this.#loadCachedData();\r\n    if (this.#elements.shippingCountry || this.#elements.billingCountry) {\r\n      this.#logger.info('AddressHandler initialized');\r\n      this.#init();\r\n    } else {\r\n      this.#logger.warn('No country selects found');\r\n    }\r\n  }\r\n\r\n  async #init() {\r\n    await this.#loadCountriesAndStates();\r\n    await Promise.all([\r\n      this.#elements.shippingCountry && this.#initCountrySelect(this.#elements.shippingCountry, this.#elements.shippingState),\r\n      this.#elements.billingCountry && this.#initCountrySelect(this.#elements.billingCountry, this.#elements.billingState),\r\n    ]);\r\n    this.#setupCountryChangeListeners();\r\n    this.#detectUserCountry();\r\n    this.#setupAutocompleteDetection();\r\n  }\r\n\r\n  #getAddressConfig() {\r\n    return {\r\n      defaultCountry: window.osConfig?.addressConfig?.defaultCountry ?? document.querySelector('meta[name=\"os-address-default-country\"]')?.content ?? 'US',\r\n      showCountries: window.osConfig?.addressConfig?.showCountries ?? document.querySelector('meta[name=\"os-address-show-countries\"]')?.content?.split(',').map(c => c.trim()) ?? [],\r\n      dontShowStates: window.osConfig?.addressConfig?.dontShowStates ?? document.querySelector('meta[name=\"os-address-dont-show-states\"]')?.content?.split(',').map(s => s.trim()) ?? [],\r\n      countries: window.osConfig?.addressConfig?.countries ?? [],\r\n    };\r\n  }\r\n\r\n  async #initCountrySelect(countrySelect, stateSelect) {\r\n    countrySelect.innerHTML = '<option value=\"\">Select Country</option>' + \r\n      this.#countries.map(c => `<option value=\"${c.iso2}\">${c.name}</option>`).join('');\r\n    countrySelect.value = this.#addressConfig.defaultCountry;\r\n    if (stateSelect && countrySelect.value) await this.#updateStateSelect(stateSelect, countrySelect.value);\r\n    this.#logger.debug(`Country select initialized with default ${this.#addressConfig.defaultCountry}`);\r\n  }\r\n\r\n  #setupCountryChangeListeners() {\r\n    const pairs = [\r\n      [this.#elements.shippingCountry, this.#elements.shippingState],\r\n      [this.#elements.billingCountry, this.#elements.billingState]\r\n    ];\r\n    pairs.forEach(([country, state]) => {\r\n      country?.addEventListener('change', () => state && this.#updateStateSelect(state, country.value));\r\n    });\r\n  }\r\n\r\n  async #updateStateSelect(stateSelect, countryCode, isPriority = false) {\r\n    if (!countryCode) return stateSelect.innerHTML = '<option value=\"\">Select State/Province</option>';\r\n    const states = this.#states[countryCode] || (await this.#loadStates(countryCode));\r\n    if (isPriority) await states;\r\n    this.#populateStateSelect(stateSelect, states);\r\n    this.#logger.debug(`State select updated for ${countryCode}`);\r\n  }\r\n\r\n  #populateStateSelect(stateSelect, states) {\r\n    const currentValue = stateSelect.value || stateSelect.getAttribute('data-pending-state') || '';\r\n    stateSelect.innerHTML = '<option value=\"\">Select State/Province</option>' + \r\n      states.map(s => `<option value=\"${s.iso2}\">${s.name}</option>`).join('');\r\n    stateSelect.parentElement.style.display = states.length ? '' : 'none';\r\n    if (currentValue && Array.from(stateSelect.options).some(o => o.value === currentValue)) stateSelect.value = currentValue;\r\n  }\r\n\r\n  #loadCachedData() {\r\n    const loadCache = key => {\r\n      const data = JSON.parse(localStorage.getItem(key) ?? '{}');\r\n      return (Date.now() - (data.timestamp ?? 0) < 24 * 60 * 60 * 1000) ? data : {};\r\n    };\r\n    this.#countries = loadCache('os_countries_cache').countries ?? [];\r\n    \r\n    // Filter cached countries if showCountries is specified\r\n    if (this.#countries.length && this.#addressConfig.showCountries.length) {\r\n      this.#countries = this.#countries.filter(c => \r\n        this.#addressConfig.showCountries.includes(c.iso2));\r\n      this.#logger.debug(`Filtered cached countries to: ${this.#addressConfig.showCountries.join(', ')}`);\r\n    }\r\n    \r\n    this.#states = loadCache('os_states_cache').states ?? {};\r\n    this.#logger.debug(`Loaded cached data: ${this.#countries.length} countries, ${Object.keys(this.#states).length} state sets`);\r\n  }\r\n\r\n  #saveCache(key, data) {\r\n    localStorage.setItem(key, JSON.stringify({ ...data, timestamp: Date.now() }));\r\n  }\r\n\r\n  async #loadCountriesAndStates() {\r\n    if (this.#countries.length) return;\r\n    this.#countries = this.#addressConfig.countries.length ? \r\n      this.#addressConfig.countries.map(c => ({ iso2: c.iso2 || c.code, name: c.name })) :\r\n      (await (await fetch('https://api.countrystatecity.in/v1/countries', { \r\n        headers: { 'X-CSCAPI-KEY': 'c2R3MzNhYmpvYUJPdmhkUlE5TUJWYUtJUGs2TTlNU3cyRmxmVW9wVQ==' } \r\n      })).json()).filter(c => !this.#addressConfig.showCountries.length || this.#addressConfig.showCountries.includes(c.iso2));\r\n    this.#countries.sort((a, b) => a.name.localeCompare(b.name));\r\n    this.#saveCache('os_countries_cache', { countries: this.#countries });\r\n    this.#logger.info(`Loaded ${this.#countries.length} countries`);\r\n  }\r\n\r\n  async #loadStates(countryCode) {\r\n    if (this.#states[countryCode]) return this.#states[countryCode];\r\n    try {\r\n      let states = (await (await fetch(`https://api.countrystatecity.in/v1/countries/${countryCode}/states`, { \r\n        headers: { 'X-CSCAPI-KEY': 'c2R3MzNhYmpvYUJPdmhkUlE5TUJWYUtJUGs2TTlNU3cyRmxmVW9wVQ==' } \r\n      })).json()).filter(s => !this.#addressConfig.dontShowStates.includes(s.iso2));\r\n      \r\n      states.sort((a, b) => a.name.localeCompare(b.name));\r\n      \r\n      this.#states[countryCode] = states;\r\n      this.#saveCache('os_states_cache', { states: this.#states });\r\n      this.#logger.debug(`Loaded and sorted ${states.length} states for ${countryCode}`);\r\n      return states;\r\n    } catch (error) {\r\n      this.#logger.error(`Failed to load states for ${countryCode}:`, error);\r\n      this.#states[countryCode] = countryCode === 'US' ? /* US states list */ [] : [];\r\n      return this.#states[countryCode];\r\n    }\r\n  }\r\n\r\n  async #detectUserCountry() {\r\n    if (this.#elements.shippingCountry?.value || this.#elements.billingCountry?.value) return;\r\n    const countryCode = this.#addressConfig.defaultCountry || (await Promise.any(['https://ipapi.co/json/', 'https://ipinfo.io/json'].map(u => fetch(u).then(r => r.json()))))?.country_code;\r\n    [this.#elements.shippingCountry, this.#elements.billingCountry].forEach(c => {\r\n      if (c) {\r\n        c.value = countryCode;\r\n        c.dispatchEvent(new Event('change'));\r\n      }\r\n    });\r\n    this.#logger.debug(`User country detected/set to ${countryCode}`);\r\n  }\r\n\r\n  #setupAutocompleteDetection() {\r\n    const fields = Object.values(this.#elements).filter(Boolean);\r\n    const observer = new MutationObserver(mutations => {\r\n      mutations.forEach(m => {\r\n        if (m.attributeName === 'value' && m.target.value) {\r\n          const state = m.target === this.#elements.shippingCountry ? this.#elements.shippingState : this.#elements.billingState;\r\n          state && this.#updateStateSelect(state, m.target.value, true);\r\n          this.#logger.debug(`Autocomplete detected on ${m.target.getAttribute('os-checkout-field')}`);\r\n        }\r\n      });\r\n    });\r\n    fields.forEach(f => observer.observe(f, { attributes: true, attributeFilter: ['value'] }));\r\n    this.#preloadCommonStates();\r\n    this.#logger.debug('Autocomplete detection set up');\r\n  }\r\n\r\n  #preloadCommonStates() {\r\n    const countries = this.#addressConfig.showCountries.length ? this.#addressConfig.showCountries : ['US', 'CA', 'GB', 'AU'];\r\n    countries.forEach(c => !this.#states[c] && this.#loadStates(c));\r\n    this.#logger.debug(`Preloading states for ${countries.join(', ')}`);\r\n  }\r\n}", "/**\r\n * FormValidator - Handles form validation for checkout\r\n */\r\nexport class FormValidator {\r\n  #logger;\r\n  #form;\r\n  #validationErrors = {};\r\n  #debugMode = false;\r\n  #spreedlyEnabled = false;\r\n  #spreedlyFieldsValid = false;\r\n  #spreedlyReady = false;\r\n\r\n  constructor(options = {}) {\r\n    this.#debugMode = options.debugMode || false;\r\n    this.#logger = options.logger || console;\r\n    this.#form = this.#getFormElement();\r\n    this.#spreedlyEnabled = typeof Spreedly !== 'undefined';\r\n\r\n    if (!this.#form) return;\r\n\r\n    this.#setupListeners();\r\n  }\r\n\r\n  #getFormElement() {\r\n    const form = document.querySelector('form[os-checkout=\"form\"]') || document.querySelector('form#combo_form');\r\n    if (!form) this.#safeLog('warn', 'No checkout form found');\r\n    return form;\r\n  }\r\n\r\n  #safeLog(level, message, ...args) {\r\n    try {\r\n      const logFn = this.#logger?.[level] || console[level] || console.log;\r\n      logFn.call(console, `[${level.toUpperCase()}] ${message}`, ...args);\r\n    } catch (error) {\r\n      console.error('Error logging:', error);\r\n    }\r\n  }\r\n\r\n  #setupListeners() {\r\n    this.#form.addEventListener('submit', e => this.#handleSubmit(e));\r\n    document.querySelector('[os-checkout-payment=\"combo\"]')?.addEventListener('click', () => {\r\n      if (this.validateAllFields()) this.#form.submit();\r\n    });\r\n    document.addEventListener('payment-method-changed', () => this.clearAllErrors());\r\n\r\n    if (this.#spreedlyEnabled && typeof Spreedly.on === 'function') {\r\n      this.#setupSpreedlyListeners();\r\n    }\r\n\r\n    // Add ZIP code formatting\r\n    this.#setupZipCodeFormatting();\r\n  }\r\n\r\n  #setupSpreedlyListeners() {\r\n    const listeners = {\r\n      'ready': () => {\r\n        this.#spreedlyReady = true;\r\n        this.#safeLog('debug', 'Spreedly is ready');\r\n      },\r\n      'paymentMethod': (token, pmData) => {\r\n        this.#spreedlyFieldsValid = true;\r\n        this.#safeLog('debug', 'Spreedly payment method created');\r\n        this.#clearSpreedlyErrors();\r\n      },\r\n      'validation': (result) => {\r\n        this.#safeLog('debug', `Spreedly field validation: ${result.fieldType} ${result.valid ? 'valid' : 'invalid'}`);\r\n        const field = document.getElementById(`spreedly-${result.fieldType}`);\r\n        if (field) {\r\n          field.classList.toggle('spreedly-valid', result.valid);\r\n          field.classList.toggle('error', !result.valid);\r\n        }\r\n        if (result.valid) {\r\n          this.clearErrorForField(field);\r\n        } else {\r\n          const errorMessage = this.#getSpreedlyFieldErrorMessage(result.fieldType);\r\n          this.#handleSpreedlyError({ attribute: result.fieldType, message: errorMessage });\r\n        }\r\n      },\r\n      'errors': (errors) => {\r\n        this.#spreedlyFieldsValid = false;\r\n        this.#safeLog('debug', 'Spreedly validation errors:', errors);\r\n        errors.forEach(error => this.#handleSpreedlyError(error));\r\n      },\r\n      'fieldEvent': (name, event, activeElement, inputData) => {\r\n        // Real-time feedback like Spreedly's example\r\n        const field = document.getElementById(`spreedly-${name}`);\r\n        if (event === 'input' && field) {\r\n          const isValid = name === 'number' ? inputData.validNumber : inputData.validCvv;\r\n          field.classList.toggle('spreedly-valid', isValid);\r\n          field.classList.toggle('error', !isValid);\r\n          if (isValid) {\r\n            this.clearErrorForField(field);\r\n          } else {\r\n            const errorMessage = this.#getSpreedlyFieldErrorMessage(name);\r\n            this.#showError(field, errorMessage);\r\n          }\r\n        }\r\n      }\r\n    };\r\n  \r\n    Object.entries(listeners).forEach(([event, handler]) => Spreedly.on(event, handler));\r\n  }\r\n\r\n  #getSpreedlyFieldErrorMessage(fieldType) {\r\n    const errorMessages = {\r\n      'number': 'Please enter a valid credit card number',\r\n      'cvv': 'Please enter a valid security code (CVV)'\r\n    };\r\n    return errorMessages[fieldType] || `Invalid ${fieldType}`;\r\n  }\r\n\r\n  #handleSpreedlyError(error) {\r\n    const fieldMap = {\r\n      'number': 'spreedly-number',\r\n      'card_number': 'spreedly-number',\r\n      'cvv': 'spreedly-cvv',\r\n      'month': 'cc-month',\r\n      'year': 'cc-year',\r\n      'full_name': 'cc-name',\r\n      'first_name': 'cc-name',\r\n      'last_name': 'cc-name'\r\n    };\r\n    const container = document.getElementById(fieldMap[error.attribute]) || \r\n                     document.querySelector(`[os-checkout-field=\"${fieldMap[error.attribute]}\"]`);\r\n    if (container) this.#showError(container, error.message);\r\n  }\r\n\r\n  #handleSubmit(event) {\r\n    if (!this.validateAllFields()) {\r\n      event.preventDefault();\r\n      this.#safeLog('warn', 'Form validation failed');\r\n    }\r\n  }\r\n\r\n  validateAllFields(selectedPaymentMethod = this.getSelectedPaymentMethod()) {\r\n    this.#debugMode && this.#logValidationStart(selectedPaymentMethod);\r\n    \r\n    const isCreditCard = ['credit', 'credit-card'].includes(selectedPaymentMethod);\r\n    let isValid = true;\r\n    \r\n    // First validate required fields\r\n    const requiredFields = Array.from(document.querySelectorAll('[os-checkout-validate=\"required\"]'));\r\n    const firstErrorField = this.#validateFields(requiredFields, isCreditCard);\r\n    \r\n    // For credit card payments, validate credit card fields\r\n    let ccValid = true;\r\n    if (isCreditCard) {\r\n      ccValid = this.validateCreditCard();\r\n    }\r\n    \r\n    // Now validate any filled phone fields (even if not required)\r\n    const phoneError = this.#validatePhoneFields();\r\n    \r\n    // Handle validation results\r\n    if (firstErrorField) {\r\n      this.#scrollToError(firstErrorField);\r\n      isValid = false;\r\n    } else if (phoneError) {\r\n      isValid = false;\r\n    } else if (!ccValid) {\r\n      isValid = false;\r\n    }\r\n\r\n    return isValid;\r\n  }\r\n\r\n  #logValidationStart(method) {\r\n    this.#safeLog('debug', 'Starting field validation for payment method:', method);\r\n    this.#safeLog('debug', 'Same as shipping:', this.isSameAsShipping());\r\n    this.#safeLog('debug', 'Spreedly enabled:', this.#spreedlyEnabled);\r\n    this.#safeLog('debug', 'Spreedly ready:', this.#spreedlyReady);\r\n  }\r\n\r\n  #validateFields(fields, isCreditCard) {\r\n    let firstErrorField = null;\r\n    \r\n    for (const field of fields) {\r\n      const fieldName = field.getAttribute('os-checkout-field');\r\n      if (this.#shouldSkipField(fieldName, isCreditCard)) {\r\n        this.clearErrorForField(field);\r\n        continue;\r\n      }\r\n\r\n      const label = field.previousElementSibling?.textContent || fieldName || field.placeholder;\r\n      if (!this.#validateField(field, label)) {\r\n        firstErrorField = firstErrorField || field;\r\n      }\r\n    }\r\n    return firstErrorField;\r\n  }\r\n\r\n  #shouldSkipField(fieldName, isCreditCard) {\r\n    return (this.isSameAsShipping() && fieldName?.startsWith('billing-')) ||\r\n           (isCreditCard && ['cc-number', 'cvv'].includes(fieldName));\r\n  }\r\n\r\n  #validateCreditCardExpiryFields() {\r\n    const [monthField, yearField] = this.#getExpiryFields();\r\n    return this.#validateExpiryField(monthField, 'month') && \r\n           this.#validateExpiryField(yearField, 'year');\r\n  }\r\n\r\n  #getExpiryFields() {\r\n    const monthSelectors = ['[os-checkout-field=\"cc-month\"]', '[os-checkout-field=\"exp-month\"]', '#credit_card_exp_month'];\r\n    const yearSelectors = ['[os-checkout-field=\"cc-year\"]', '[os-checkout-field=\"exp-year\"]', '#credit_card_exp_year'];\r\n    return [\r\n      monthSelectors.map(s => document.querySelector(s)).find(Boolean),\r\n      yearSelectors.map(s => document.querySelector(s)).find(Boolean)\r\n    ];\r\n  }\r\n\r\n  #validateExpiryField(field, type) {\r\n    if (!field || !field.value) {\r\n      this.#safeLog('error', `${type} field is empty`);\r\n      this.#showError(field, `Please select an expiration ${type}`);\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  #clearSpreedlyErrors() {\r\n    ['cc-number', 'cvv'].forEach(name => \r\n      this.clearErrorForField(document.querySelector(`[os-checkout-field=\"${name}\"]`)));\r\n    ['spreedly-number', 'spreedly-cvv'].forEach(id => \r\n      this.clearErrorForField(document.getElementById(id)));\r\n  }\r\n\r\n  #validateField(field, label) {\r\n    if (!field) return true;\r\n\r\n    const value = field.value.trim();\r\n    const validation = this.#getFieldValidation(field, value, this.#getReadableFieldLabel(field, label));\r\n    \r\n    if (!validation.isValid) {\r\n      this.#showError(field, validation.errorMessage);\r\n    } else {\r\n      this.clearErrorForField(field);\r\n    }\r\n    return validation.isValid;\r\n  }\r\n\r\n  #getReadableFieldLabel(field, fallbackLabel) {\r\n    const fieldName = field.getAttribute('os-checkout-field') || field.name;\r\n    \r\n    // Map of field names to user-friendly labels\r\n    const labelMap = {\r\n      'fname': 'First Name',\r\n      'lname': 'Last Name',\r\n      'email': 'Email',\r\n      'phone': 'Phone Number',\r\n      'address1': 'Address',\r\n      'address2': 'Apartment or Suite',\r\n      'city': 'City',\r\n      'province': 'State/Province',\r\n      'postal': 'ZIP/Postal Code',\r\n      'country': 'Country',\r\n      'cc-number': 'Credit Card Number',\r\n      'cvv': 'Security Code',\r\n      'cc-month': 'Expiration Month',\r\n      'cc-year': 'Expiration Year',\r\n      'cc-name': 'Name on Card',\r\n      'exp-month': 'Expiration Month',\r\n      'exp-year': 'Expiration Year',\r\n      'billing-fname': 'Billing First Name',\r\n      'billing-lname': 'Billing Last Name',\r\n      'billing-address1': 'Billing Address',\r\n      'billing-address2': 'Billing Apartment or Suite',\r\n      'billing-city': 'Billing City',\r\n      'billing-province': 'Billing State/Province',\r\n      'billing-postal': 'Billing ZIP/Postal Code',\r\n      'billing-country': 'Billing Country',\r\n      'billing-phone': 'Billing Phone Number'\r\n    };\r\n    \r\n    // Return the mapped label if available, otherwise use the fallback label\r\n    return labelMap[fieldName] || fallbackLabel || fieldName;\r\n  }\r\n\r\n  #getFieldValidation(field, value, label) {\r\n    const tag = field.tagName.toLowerCase();\r\n    const fieldName = field.getAttribute('os-checkout-field') || field.name;\r\n\r\n    if (tag === 'select') return {\r\n      isValid: !!value,\r\n      errorMessage: `Please select a ${label}`\r\n    };\r\n    \r\n    // Special handling for phone field - allow empty but validate if has value\r\n    if (field.type === 'tel' && field.iti) {\r\n      // If empty, it's valid (phone is optional)\r\n      if (!value.trim()) {\r\n        return { isValid: true, errorMessage: '' };\r\n      }\r\n      \r\n      // If they entered something, validate it as a US number\r\n      const isValid = field.iti.isValidNumber();\r\n      \r\n      return {\r\n        isValid: isValid,\r\n        errorMessage: `Please enter a valid US phone number (e.g. 555-555-5555)`\r\n      };\r\n    }\r\n    \r\n    if (!value) return { isValid: false, errorMessage: `Please enter your ${label}` };\r\n    \r\n    if (fieldName && (fieldName.includes('city') || fieldName.endsWith('-city'))) {\r\n      return this.#validateCity(value, label);\r\n    }\r\n    \r\n    if (fieldName && (fieldName.includes('zip') || fieldName.includes('postal') || fieldName.endsWith('-zip'))) {\r\n      return this.#validateZipCode(value, fieldName);\r\n    }\r\n    \r\n    if (field.type === 'email') return {\r\n      isValid: this.#isValidEmail(value),\r\n      errorMessage: `Please enter a valid email address`\r\n    };\r\n    return { isValid: true, errorMessage: '' };\r\n  }\r\n\r\n  #validateCity(value, label) {\r\n    // City should be a minimum of 2 letters without special characters, numbers, etc. Maximum length is 24 characters\r\n    const cityRegex = /^[a-zA-Z\\s]{2,24}$/;\r\n    return {\r\n      isValid: cityRegex.test(value),\r\n      errorMessage: `Please enter a valid city name (2-24 letters, no numbers or special characters)`\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Validate a US ZIP code (5 digits or ZIP+4 format)\r\n   * @param {string} value - ZIP code to validate\r\n   * @param {string} fieldName - Name of the field for error message\r\n   * @returns {Object} Validation result with isValid and errorMessage\r\n   */\r\n  #validateZipCode(value, fieldName = 'Zip') {\r\n    // US ZIP code pattern: 5 digits or 5 digits + hyphen + 4 digits\r\n    const zipPattern = /(^\\d{5}$)|(^\\d{5}-\\d{4}$)/;\r\n    const isValid = zipPattern.test(value);\r\n    \r\n    return {\r\n      isValid,\r\n      errorMessage: isValid ? '' : `Field must be a valid US Zip code.`\r\n    };\r\n  }\r\n\r\n  #showError(input, message) {\r\n    if (!input) return;\r\n    \r\n    input.classList.add('error');\r\n    const wrapper = input.closest('.frm-flds') || input.closest('.form-group') || input.parentElement;\r\n    const errorElement = this.#getOrCreateErrorElement(wrapper);\r\n    \r\n    errorElement.textContent = message;\r\n    Object.assign(errorElement.style, {\r\n      color: 'red',\r\n      fontSize: '0.875rem',\r\n      marginTop: '0.25rem'\r\n    });\r\n\r\n    if (!input.hasErrorListener) {\r\n      input.hasErrorListener = true;\r\n      ['input', 'change'].forEach(event => \r\n        input.addEventListener(event, () => this.clearErrorForField(input)));\r\n      if (input.type === 'tel' && input.iti) {\r\n        input.addEventListener('countrychange', () => this.clearErrorForField(input));\r\n      }\r\n    }\r\n  }\r\n\r\n  #getOrCreateErrorElement(wrapper) {\r\n    let errorElement = wrapper.querySelector('.pb-input-error');\r\n    if (!errorElement) {\r\n      errorElement = document.createElement('div');\r\n      errorElement.className = 'pb-input-error';\r\n      wrapper.appendChild(errorElement);\r\n    }\r\n    return errorElement;\r\n  }\r\n\r\n  clearErrorForField(field) {\r\n    if (!field) return;\r\n    \r\n    field.classList.remove('error');\r\n    const wrapper = field.closest('.frm-flds') || field.closest('.form-group') || field.parentElement;\r\n    wrapper?.querySelector('.pb-input-error')?.remove();\r\n\r\n    const fieldName = field.getAttribute('os-checkout-field');\r\n    if (['cc-number', 'cvv'].includes(fieldName)) {\r\n      const spreedlyId = `spreedly-${fieldName === 'cc-number' ? 'number' : 'cvv'}`;\r\n      const spreedlyContainer = document.getElementById(spreedlyId);\r\n      if (spreedlyContainer) {\r\n        spreedlyContainer.classList.remove('error');\r\n        spreedlyContainer.closest('.frm-flds')?.querySelector('.pb-input-error')?.remove();\r\n      }\r\n    }\r\n  }\r\n\r\n  clearAllErrors() {\r\n    this.#validationErrors = {};\r\n    document.querySelectorAll('.error').forEach(el => el.classList.remove('error'));\r\n    document.querySelectorAll('.pb-input-error').forEach(el => el.remove());\r\n    this.#clearSpreedlyErrors();\r\n  }\r\n\r\n  #scrollToError(element) {\r\n    if (!element) return;\r\n    \r\n    window.scrollTo({\r\n      top: element.getBoundingClientRect().top + window.pageYOffset - 100,\r\n      behavior: 'smooth'\r\n    });\r\n    setTimeout(() => element.focus(), 500);\r\n  }\r\n\r\n  #isValidEmail(email) {\r\n    return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\r\n  }\r\n\r\n  isSameAsShipping() {\r\n    const checkbox = document.querySelector('[os-checkout-field=\"same-as-shipping\"] input[type=\"checkbox\"]') || \r\n                     document.querySelector('[os-input-field=\"use-shipping-address\"] input[type=\"checkbox\"]') || \r\n                     document.querySelector('#use_shipping_address');\r\n    return checkbox ? checkbox.checked : true;\r\n  }\r\n\r\n  getSelectedPaymentMethod() {\r\n    return document.querySelector('input[name=\"payment_method\"]:checked')?.value || \r\n           document.querySelector('input[name=\"combo_mode\"]:checked')?.value || \r\n           'credit';\r\n  }\r\n\r\n  getFormValues() {\r\n    const values = {};\r\n    this.#form.querySelectorAll('input, select, textarea').forEach(field => {\r\n      if (['button', 'submit'].includes(field.type) || field.disabled || !field.name) return;\r\n\r\n      const fieldName = field.getAttribute('os-checkout-field') || field.name;\r\n      if (field.type === 'checkbox') {\r\n        values[fieldName] = field.checked;\r\n      } else if (field.type === 'radio') {\r\n        if (field.checked) values[fieldName] = field.value;\r\n      } else if (fieldName.includes('.')) {\r\n        const [parent, child] = fieldName.split('.');\r\n        values[parent] = values[parent] || {};\r\n        values[parent][child] = field.value;\r\n      } else {\r\n        values[fieldName] = field.value;\r\n      }\r\n    });\r\n    return values;\r\n  }\r\n\r\n  validateCreditCard() {\r\n    let isValid = true;\r\n  \r\n    // Validate expiry fields\r\n    const [monthField, yearField] = this.#getExpiryFields();\r\n    if (!this.#validateExpiryField(monthField, 'month')) isValid = false;\r\n    if (!this.#validateExpiryField(yearField, 'year')) isValid = false;\r\n  \r\n    // If Spreedly is enabled, validate its fields\r\n    if (this.#spreedlyEnabled && typeof Spreedly.validate === 'function') {\r\n      // Check if the Spreedly fields already have valid class\r\n      const numberContainer = document.getElementById('spreedly-number');\r\n      const cvvContainer = document.getElementById('spreedly-cvv');\r\n  \r\n      let numberValid = numberContainer?.classList.contains('spreedly-valid');\r\n      let cvvValid = cvvContainer?.classList.contains('spreedly-valid');\r\n  \r\n      // Trigger Spreedly validation\r\n      Spreedly.validate();\r\n      \r\n      // Use the visual validation state of the fields\r\n      if (!numberValid && numberContainer) {\r\n        this.#showError(numberContainer, 'Please enter a valid credit card number');\r\n        isValid = false;\r\n      }\r\n      \r\n      if (!cvvValid && cvvContainer) {\r\n        this.#showError(cvvContainer, 'Please enter a valid security code (CVV)');\r\n        isValid = false;\r\n      }\r\n    } else {\r\n      // Fallback for non-Spreedly setups\r\n      const ccNumber = document.querySelector('[os-checkout-field=\"cc-number\"]');\r\n      const cvv = document.querySelector('[os-checkout-field=\"cvv\"]');\r\n      \r\n      if (!ccNumber?.value.trim()) {\r\n        this.#showError(ccNumber, 'Please enter a credit card number');\r\n        isValid = false;\r\n      }\r\n      if (!cvv?.value.trim()) {\r\n        this.#showError(cvv, 'Please enter a security code (CVV)');\r\n        isValid = false;\r\n      }\r\n    }\r\n  \r\n    return isValid;\r\n  }\r\n\r\n  #validatePhoneFields() {\r\n    // Find all phone input fields\r\n    const phoneFields = Array.from(document.querySelectorAll('input[type=\"tel\"]'));\r\n    let hasError = false;\r\n    \r\n    for (const field of phoneFields) {\r\n      // Skip if field is empty (phone is optional)\r\n      if (!field.value.trim() || !field.iti) continue;\r\n      \r\n      // Validate phone number if entered\r\n      const isValid = field.iti.isValidNumber();\r\n      \r\n      if (!isValid) {\r\n        // Get specific error code for better error messages\r\n        const errorCode = field.iti.getValidationError();\r\n        \r\n        // Map error codes to user-friendly messages\r\n        const errorMessages = {\r\n          0: 'Please enter a valid US phone number (e.g. 555-555-5555)',\r\n          1: 'Invalid country code',\r\n          2: 'Phone number is too short',\r\n          3: 'Phone number is too long',\r\n          4: 'Please enter a valid phone number',\r\n          5: 'Invalid phone number format'\r\n        };\r\n        \r\n        const message = errorMessages[errorCode] || 'Please enter a valid US phone number';\r\n        this.#showError(field, message);\r\n        \r\n        if (!hasError) {\r\n          this.#scrollToError(field);\r\n          hasError = true;\r\n        }\r\n      } else {\r\n        this.clearErrorForField(field);\r\n      }\r\n    }\r\n    \r\n    return hasError;\r\n  }\r\n\r\n  /**\r\n   * Set up auto-formatting for ZIP code fields\r\n   */\r\n  #setupZipCodeFormatting() {\r\n    // Find all ZIP/postal code fields\r\n    const zipFields = [\r\n      ...document.querySelectorAll('[os-checkout-field=\"postal\"]'),\r\n      ...document.querySelectorAll('[os-checkout-field=\"billing-postal\"]'),\r\n      ...document.querySelectorAll('[os-checkout-field=\"zip\"]')\r\n    ];\r\n    \r\n    zipFields.forEach(field => {\r\n      if (field) {\r\n        field.addEventListener('input', (e) => this.#formatZipCode(e));\r\n        this.#logger.debug(`ZIP code formatting setup for: ${field.getAttribute('os-checkout-field') || field.name || 'unknown'}`);\r\n      }\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Format ZIP code as user types: \r\n   * - Allow only numbers and hyphen\r\n   * - Automatically add hyphen after 5 digits if the user is entering more\r\n   * @param {Event} event - Input event\r\n   */\r\n  #formatZipCode(event) {\r\n    const input = event.target;\r\n    const cursorPos = input.selectionStart;\r\n    const oldValue = input.value;\r\n    \r\n    // Remove non-digits and non-hyphens\r\n    let cleaned = oldValue.replace(/[^\\d-]/g, '');\r\n    \r\n    // Only allow one hyphen after the 5th digit\r\n    if (cleaned.length > 5) {\r\n      const firstPart = cleaned.slice(0, 5);\r\n      \r\n      if (cleaned.charAt(5) !== '-') {\r\n        // Insert hyphen after 5 digits\r\n        const secondPart = cleaned.slice(5).replace(/-/g, '');\r\n        cleaned = `${firstPart}-${secondPart}`;\r\n      } else {\r\n        // Keep existing hyphen and remove any others\r\n        const secondPart = cleaned.slice(6).replace(/-/g, '');\r\n        cleaned = `${firstPart}-${secondPart}`;\r\n      }\r\n    }\r\n    \r\n    // Limit to ZIP+4 format (12345-6789)\r\n    if (cleaned.includes('-')) {\r\n      const [first, second] = cleaned.split('-');\r\n      cleaned = `${first.slice(0, 5)}-${second.slice(0, 4)}`;\r\n    } else {\r\n      cleaned = cleaned.slice(0, 5);\r\n    }\r\n    \r\n    // Only update if changed to avoid cursor jumping\r\n    if (cleaned !== oldValue) {\r\n      input.value = cleaned;\r\n      \r\n      // Adjust cursor position\r\n      const posAdjust = cleaned.length - oldValue.length;\r\n      input.setSelectionRange(cursorPos + posAdjust, cursorPos + posAdjust);\r\n    }\r\n  }\r\n}", "/**\r\n * SpreedlyManager - Manages Spreedly iframe integration for secure credit card processing\r\n * \r\n * This class handles:\r\n * - Loading the Spreedly script if not already loaded\r\n * - Setting up the iframe fields for card number and CVV\r\n * - Styling the iframe fields to match the site design\r\n * - Handling tokenization of credit card data\r\n * - Managing validation and error handling\r\n */\r\n\r\nexport class SpreedlyManager {\r\n  #environmentKey;\r\n  #debugMode = false;\r\n  #isReady = false;\r\n  #onReadyCallback = null;\r\n  #onErrorCallback = null;\r\n  #onPaymentMethodCallback = null;\r\n  #onValidationCallback = null;\r\n  #config = null;\r\n  #app = null;\r\n\r\n  /**\r\n   * Create a new SpreedlyManager\r\n   * @param {string} environmentKey - The Spreedly environment key\r\n   * @param {Object} options - Configuration options\r\n   * @param {boolean} options.debug - Enable debug mode\r\n   * @param {Object} options.app - The app instance for accessing global config\r\n   */\r\n  constructor(environmentKey, options = {}) {\r\n    this.#environmentKey = environmentKey;\r\n    this.#debugMode = options.debug || false;\r\n    this.#app = options.app || null;\r\n    \r\n    // Load Spreedly configuration\r\n    this.#loadConfig();\r\n    \r\n    if (!environmentKey) {\r\n      this.#log('error', 'No environment key provided to SpreedlyManager');\r\n      return;\r\n    }\r\n    \r\n    this.#log('debug', `SpreedlyManager initialized with environment key: ${environmentKey}`);\r\n    this.#initialize();\r\n  }\r\n\r\n  /**\r\n   * Load Spreedly configuration from global config\r\n   */\r\n  #loadConfig() {\r\n    // Default configuration\r\n    this.#config = {\r\n      fieldType: {\r\n        number: 'text',\r\n        cvv: 'text'\r\n      },\r\n      numberFormat: 'prettyFormat',\r\n      placeholder: {\r\n        number: 'Credit Card Number',\r\n        cvv: 'CVV *'\r\n      },\r\n      labels: {\r\n        number: 'Card Number',\r\n        cvv: 'CVV'\r\n      },\r\n      titles: {\r\n        number: 'Credit card number',\r\n        cvv: 'Card verification value'\r\n      },\r\n      styling: {\r\n        number: 'color: #212529; font-size: .925rem; font-weight: 400; width: 100%; height:100%; font-family: system-ui,-apple-system,\"Segoe UI\",Roboto,\"Helvetica Neue\",\"Noto Sans\",\"Liberation Sans\",Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\",\"Segoe UI Symbol\",\"Noto Color Emoji\";',\r\n        cvv: 'color: #212529; font-size: .925rem; font-weight: 400; width: 100%; height: 100%; font-family: system-ui,-apple-system,\"Segoe UI\",Roboto,\"Helvetica Neue\",\"Noto Sans\",\"Liberation Sans\",Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\",\"Segoe UI Symbol\",\"Noto Color Emoji\";'\r\n      },\r\n      placeholder_styling: '',\r\n      required: {\r\n        number: true,\r\n        cvv: true\r\n      },\r\n      autocomplete: true\r\n    };\r\n\r\n    // Merge with global configuration if it exists\r\n    if (window.osConfig && window.osConfig.spreedlyConfig) {\r\n      this.#log('debug', 'Found global Spreedly configuration', window.osConfig.spreedlyConfig);\r\n      \r\n      // Merge field types\r\n      if (window.osConfig.spreedlyConfig.fieldType) {\r\n        this.#config.fieldType = {\r\n          ...this.#config.fieldType,\r\n          ...window.osConfig.spreedlyConfig.fieldType\r\n        };\r\n      }\r\n      \r\n      // Merge number format\r\n      if (window.osConfig.spreedlyConfig.numberFormat) {\r\n        this.#config.numberFormat = window.osConfig.spreedlyConfig.numberFormat;\r\n      }\r\n      \r\n      // Merge placeholders\r\n      if (window.osConfig.spreedlyConfig.placeholder) {\r\n        this.#config.placeholder = {\r\n          ...this.#config.placeholder,\r\n          ...window.osConfig.spreedlyConfig.placeholder\r\n        };\r\n      }\r\n      \r\n      // Merge labels\r\n      if (window.osConfig.spreedlyConfig.labels) {\r\n        this.#config.labels = {\r\n          ...this.#config.labels,\r\n          ...window.osConfig.spreedlyConfig.labels\r\n        };\r\n      }\r\n      \r\n      // Merge titles\r\n      if (window.osConfig.spreedlyConfig.titles) {\r\n        this.#config.titles = {\r\n          ...this.#config.titles,\r\n          ...window.osConfig.spreedlyConfig.titles\r\n        };\r\n      }\r\n      \r\n      // Merge styling\r\n      if (window.osConfig.spreedlyConfig.styling) {\r\n        this.#config.styling = {\r\n          ...this.#config.styling,\r\n          ...window.osConfig.spreedlyConfig.styling\r\n        };\r\n      }\r\n      \r\n      // Merge placeholder styling\r\n      if (window.osConfig.spreedlyConfig.placeholder_styling) {\r\n        this.#config.placeholder_styling = window.osConfig.spreedlyConfig.placeholder_styling;\r\n      }\r\n      \r\n      // Merge required attributes\r\n      if (window.osConfig.spreedlyConfig.required) {\r\n        this.#config.required = {\r\n          ...this.#config.required,\r\n          ...window.osConfig.spreedlyConfig.required\r\n        };\r\n      }\r\n      \r\n      // Merge autocomplete setting\r\n      if (window.osConfig.spreedlyConfig.hasOwnProperty('autocomplete')) {\r\n        this.#config.autocomplete = window.osConfig.spreedlyConfig.autocomplete;\r\n      }\r\n    }\r\n    \r\n    this.#log('debug', 'Spreedly configuration initialized', this.#config);\r\n  }\r\n\r\n  /**\r\n   * Initialize Spreedly\r\n   * Load the script if needed and set up the iframe fields\r\n   */\r\n  #initialize() {\r\n    if (typeof Spreedly === 'undefined') {\r\n      this.#log('debug', 'Spreedly not loaded, loading script...');\r\n      this.#loadScript()\r\n        .then(() => {\r\n          this.#log('debug', 'Spreedly script loaded');\r\n          this.#setupSpreedly();\r\n        })\r\n        .catch(error => {\r\n          this.#log('error', 'Failed to load Spreedly script', error);\r\n          if (this.#onErrorCallback) {\r\n            this.#onErrorCallback(['Failed to load Spreedly. Please refresh the page and try again.']);\r\n          }\r\n        });\r\n    } else {\r\n      this.#log('debug', 'Spreedly already loaded');\r\n      this.#setupSpreedly();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load the Spreedly script\r\n   * @returns {Promise} A promise that resolves when the script is loaded\r\n   */\r\n  #loadScript() {\r\n    return new Promise((resolve, reject) => {\r\n      const script = document.createElement('script');\r\n      script.src = 'https://core.spreedly.com/iframe/iframe-v1.min.js';\r\n      script.async = true;\r\n      script.onload = resolve;\r\n      script.onerror = reject;\r\n      document.head.appendChild(script);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set up Spreedly with the environment key and prepare the iframe fields\r\n   */\r\n  #setupSpreedly() {\r\n    try {\r\n      this.#log('debug', 'Setting up Spreedly...');\r\n      \r\n      // First, prepare the HTML structure for the iframe fields\r\n      this.#prepareHtmlStructure();\r\n      \r\n      // Initialize Spreedly with the environment key\r\n      Spreedly.init(this.#environmentKey, {\r\n        \"numberEl\": \"spreedly-number\",\r\n        \"cvvEl\": \"spreedly-cvv\"\r\n      });\r\n      \r\n      // Set up event listeners\r\n      Spreedly.on('ready', () => {\r\n        this.#log('debug', 'Spreedly iframe ready');\r\n        \r\n        // Apply configuration from the loaded config\r\n        this.#applySpreedlyConfig();\r\n        \r\n        // Mark as ready and call the ready callback if set\r\n        this.#isReady = true;\r\n        if (this.#onReadyCallback) {\r\n          this.#onReadyCallback();\r\n        }\r\n      });\r\n      \r\n      // Set up other event listeners\r\n      this.#setupEventListeners();\r\n      \r\n      this.#log('debug', 'Spreedly setup complete');\r\n    } catch (error) {\r\n      this.#log('error', 'Error setting up Spreedly', error);\r\n      if (this.#onErrorCallback) {\r\n        this.#onErrorCallback(['Failed to set up Spreedly. Please refresh the page and try again.']);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply configuration to Spreedly iframe fields\r\n   */\r\n  #applySpreedlyConfig() {\r\n    try {\r\n      this.#log('debug', 'Applying Spreedly configuration...');\r\n      \r\n      // Apply field types\r\n      Spreedly.setFieldType('number', this.#config.fieldType.number);\r\n      Spreedly.setFieldType('cvv', this.#config.fieldType.cvv);\r\n      \r\n      // Apply number format\r\n      Spreedly.setNumberFormat(this.#config.numberFormat);\r\n      \r\n      // Apply placeholders\r\n      Spreedly.setPlaceholder('number', this.#config.placeholder.number);\r\n      Spreedly.setPlaceholder('cvv', this.#config.placeholder.cvv);\r\n      \r\n      // Apply labels\r\n      Spreedly.setLabel('number', this.#config.labels.number);\r\n      Spreedly.setLabel('cvv', this.#config.labels.cvv);\r\n      \r\n      // Apply titles\r\n      Spreedly.setTitle('number', this.#config.titles.number);\r\n      Spreedly.setTitle('cvv', this.#config.titles.cvv);\r\n      \r\n      // Apply styling\r\n      Spreedly.setStyle('number', this.#config.styling.number);\r\n      Spreedly.setStyle('cvv', this.#config.styling.cvv);\r\n      \r\n      // Apply placeholder styling if specified\r\n      if (this.#config.placeholder_styling) {\r\n        Spreedly.setStyle('placeholder', this.#config.placeholder_styling);\r\n      }\r\n      \r\n      // Set required attributes if needed\r\n      if (this.#config.required.number) {\r\n        Spreedly.setRequiredAttribute('number');\r\n      }\r\n      if (this.#config.required.cvv) {\r\n        Spreedly.setRequiredAttribute('cvv');\r\n      }\r\n      \r\n      // Handle autocomplete\r\n      if (!this.#config.autocomplete) {\r\n        Spreedly.toggleAutoComplete();\r\n      }\r\n      \r\n      this.#log('debug', 'Spreedly configuration applied');\r\n    } catch (error) {\r\n      this.#log('error', 'Error applying Spreedly configuration', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Prepare the HTML structure for the iframe fields\r\n   * This uses the existing inputs rather than creating new ones\r\n   */\r\n  #prepareHtmlStructure() {\r\n    try {\r\n      this.#log('debug', 'Preparing HTML structure for Spreedly iframe fields');\r\n      \r\n      // Find the existing input containers\r\n      const numberField = document.querySelector('[os-checkout-field=\"cc-number\"]');\r\n      const cvvField = document.querySelector('[os-checkout-field=\"cvv\"]');\r\n      \r\n      if (!numberField || !cvvField) {\r\n        this.#log('error', 'Could not find credit card fields');\r\n        return;\r\n      }\r\n      \r\n      // Simply use the IDs of the existing fields\r\n      numberField.id = 'spreedly-number';\r\n      cvvField.id = 'spreedly-cvv';\r\n      \r\n      // Make sure the fields are set up for the iframe\r\n      numberField.setAttribute('data-spreedly', 'number');\r\n      cvvField.setAttribute('data-spreedly', 'cvv');\r\n      \r\n      this.#log('debug', 'HTML structure prepared for Spreedly iframe fields - using existing DOM elements');\r\n    } catch (error) {\r\n      this.#log('error', 'Error preparing HTML structure for Spreedly iframe fields', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set up event listeners for Spreedly events\r\n   */\r\n  #setupEventListeners() {\r\n    // Listen for validation errors\r\n    Spreedly.on('errors', (errors) => {\r\n      this.#log('error', 'Spreedly validation errors:', errors);\r\n      \r\n      // Format error messages\r\n      const errorMessages = errors.map(error => error.message);\r\n      \r\n      // Call the error callback if set\r\n      if (this.#onErrorCallback) {\r\n        this.#onErrorCallback(errorMessages);\r\n      }\r\n      \r\n      // Show errors on the form\r\n      this.#showErrors(errors);\r\n    });\r\n    \r\n    // Listen for successful payment method creation\r\n    Spreedly.on('paymentMethod', (token, pmData) => {\r\n      this.#log('debug', 'Spreedly payment method created:', token);\r\n      \r\n      // Clear any existing errors\r\n      this.clearAllErrors();\r\n      \r\n      // Call the payment method callback if set\r\n      if (this.#onPaymentMethodCallback) {\r\n        this.#onPaymentMethodCallback(token, pmData);\r\n      }\r\n    });\r\n    \r\n    // Listen for field validation events\r\n    Spreedly.on('validation', (result) => {\r\n      this.#log('debug', 'Spreedly field validation:', result);\r\n      \r\n      // Clear any existing error for this field\r\n      this.#clearFieldError(result.fieldType);\r\n      \r\n      // Call the validation callback if set\r\n      if (this.#onValidationCallback) {\r\n        this.#onValidationCallback(result);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Show errors on the form\r\n   * @param {Array} errors - Array of error objects from Spreedly\r\n   */\r\n  #showErrors(errors) {\r\n    errors.forEach(error => {\r\n      const fieldType = error.attribute;\r\n      let field = null;\r\n      \r\n      // Map Spreedly field types to our fields\r\n      if (fieldType === 'number' || fieldType === 'card_number') {\r\n        field = document.getElementById('spreedly-number');\r\n      } else if (fieldType === 'cvv') {\r\n        field = document.getElementById('spreedly-cvv');\r\n      } else if (fieldType === 'month' || fieldType === 'year') {\r\n        // Find the month/year select elements\r\n        field = document.querySelector(`[os-checkout-field=\"cc-${fieldType}\"]`) || \r\n               document.querySelector(`[os-checkout-field=\"exp-${fieldType}\"]`) || \r\n               document.querySelector(`#credit_card_exp_${fieldType}`);\r\n      } else if (fieldType === 'full_name' || fieldType === 'first_name' || fieldType === 'last_name') {\r\n        field = document.querySelector('[os-checkout-field=\"cc-name\"]');\r\n      }\r\n      \r\n      if (field) {\r\n        // Add error class to the field\r\n        field.classList.add('error');\r\n        \r\n        // Find the parent wrapper\r\n        const wrapper = field.closest('.frm-flds') || field.parentElement;\r\n        \r\n        // Create or update error message\r\n        let errorElement = wrapper.querySelector('.pb-input-error');\r\n        if (!errorElement) {\r\n          errorElement = document.createElement('div');\r\n          errorElement.className = 'pb-input-error';\r\n          wrapper.appendChild(errorElement);\r\n        }\r\n        \r\n        // Set error message and style\r\n        errorElement.textContent = error.message;\r\n        errorElement.style.color = 'red';\r\n        errorElement.style.fontSize = '0.875rem';\r\n        errorElement.style.marginTop = '0.25rem';\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear error for a specific field\r\n   * @param {string} fieldType - The field type (number, cvv, etc.)\r\n   */\r\n  #clearFieldError(fieldType) {\r\n    let field = null;\r\n    \r\n    // Map Spreedly field types to our fields\r\n    if (fieldType === 'number' || fieldType === 'card_number') {\r\n      field = document.getElementById('spreedly-number');\r\n    } else if (fieldType === 'cvv') {\r\n      field = document.getElementById('spreedly-cvv');\r\n    }\r\n    \r\n    if (field) {\r\n      // Remove error class from the field\r\n      field.classList.remove('error');\r\n      \r\n      // Find the parent wrapper\r\n      const wrapper = field.closest('.frm-flds') || field.parentElement;\r\n      \r\n      // Remove error message if it exists\r\n      const errorElement = wrapper.querySelector('.pb-input-error');\r\n      if (errorElement) {\r\n        errorElement.remove();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all errors\r\n   */\r\n  clearAllErrors() {\r\n    // Clear errors for number field\r\n    this.#clearFieldError('number');\r\n    \r\n    // Clear errors for CVV field\r\n    this.#clearFieldError('cvv');\r\n    \r\n    // Clear errors for month/year fields\r\n    const monthField = document.querySelector('[os-checkout-field=\"cc-month\"]') || \r\n                      document.querySelector('[os-checkout-field=\"exp-month\"]') || \r\n                      document.querySelector('#credit_card_exp_month');\r\n    const yearField = document.querySelector('[os-checkout-field=\"cc-year\"]') || \r\n                     document.querySelector('[os-checkout-field=\"exp-year\"]') || \r\n                     document.querySelector('#credit_card_exp_year');\r\n    \r\n    if (monthField) {\r\n      monthField.classList.remove('error');\r\n      const monthWrapper = monthField.closest('.frm-flds') || monthField.parentElement;\r\n      const monthError = monthWrapper.querySelector('.pb-input-error');\r\n      if (monthError) monthError.remove();\r\n    }\r\n    \r\n    if (yearField) {\r\n      yearField.classList.remove('error');\r\n      const yearWrapper = yearField.closest('.frm-flds') || yearField.parentElement;\r\n      const yearError = yearWrapper.querySelector('.pb-input-error');\r\n      if (yearError) yearError.remove();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Tokenize a credit card\r\n   * @param {Object} cardData - The card data to tokenize\r\n   * @param {string} cardData.full_name - The cardholder name\r\n   * @param {string} cardData.month - The expiration month (2 digits)\r\n   * @param {string} cardData.year - The expiration year (4 digits)\r\n   */\r\n  tokenizeCard(cardData) {\r\n    this.#log('debug', 'Tokenizing card with data:', {\r\n      ...cardData,\r\n      full_name: cardData.full_name,\r\n      month: cardData.month,\r\n      year: cardData.year\r\n    });\r\n    \r\n    // Clear any existing errors\r\n    this.clearAllErrors();\r\n    \r\n    // Validate required fields\r\n    if (!cardData.full_name || !cardData.month || !cardData.year) {\r\n      this.#log('error', 'Missing required card data');\r\n      \r\n      const errors = [];\r\n      if (!cardData.full_name) errors.push({ attribute: 'full_name', message: 'Cardholder name is required' });\r\n      if (!cardData.month) errors.push({ attribute: 'month', message: 'Expiration month is required' });\r\n      if (!cardData.year) errors.push({ attribute: 'year', message: 'Expiration year is required' });\r\n      \r\n      this.#showErrors(errors);\r\n      \r\n      if (this.#onErrorCallback) {\r\n        this.#onErrorCallback(errors.map(e => e.message));\r\n      }\r\n      \r\n      return;\r\n    }\r\n    \r\n    // Check if Spreedly is ready\r\n    if (!this.#isReady) {\r\n      this.#log('error', 'Spreedly is not ready yet');\r\n      \r\n      if (this.#onErrorCallback) {\r\n        this.#onErrorCallback(['Payment system is not ready yet. Please try again in a moment.']);\r\n      }\r\n      \r\n      return;\r\n    }\r\n    \r\n    // Tokenize the card\r\n    try {\r\n      Spreedly.tokenizeCreditCard(cardData);\r\n      this.#log('debug', 'Card tokenization initiated');\r\n    } catch (error) {\r\n      this.#log('error', 'Error tokenizing card', error);\r\n      \r\n      if (this.#onErrorCallback) {\r\n        this.#onErrorCallback(['An error occurred while processing your card. Please try again.']);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set a callback to be called when Spreedly is ready\r\n   * @param {Function} callback - The callback function\r\n   */\r\n  setOnReady(callback) {\r\n    this.#onReadyCallback = callback;\r\n    \r\n    // If already ready, call the callback immediately\r\n    if (this.#isReady && callback) {\r\n      callback();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set a callback to be called when Spreedly encounters an error\r\n   * @param {Function} callback - The callback function\r\n   */\r\n  setOnError(callback) {\r\n    this.#onErrorCallback = callback;\r\n  }\r\n\r\n  /**\r\n   * Set a callback to be called when a payment method is created\r\n   * @param {Function} callback - The callback function\r\n   */\r\n  setOnPaymentMethod(callback) {\r\n    this.#onPaymentMethodCallback = callback;\r\n  }\r\n\r\n  /**\r\n   * Set a callback to be called when a field is validated\r\n   * @param {Function} callback - The callback function\r\n   */\r\n  setOnValidation(callback) {\r\n    this.#onValidationCallback = callback;\r\n  }\r\n\r\n  /**\r\n   * Log a message with the specified level\r\n   * @param {string} level - The log level (debug, info, warn, error)\r\n   * @param {string} message - The message to log\r\n   * @param {*} data - Additional data to log\r\n   */\r\n  #log(level, message, data) {\r\n    if (this.#debugMode || level === 'error') {\r\n      const prefix = '[SpreedlyManager]';\r\n      \r\n      if (data) {\r\n        console[level](`${prefix} ${message}`, data);\r\n      } else {\r\n        console[level](`${prefix} ${message}`);\r\n      }\r\n    }\r\n  }\r\n}  ", "/**\r\n * KonamiCodeHandler - Utility class for handling the Konami code Easter egg\r\n * \r\n * This class provides functionality for detecting the Konami code sequence\r\n * and triggering a test order with predefined data.\r\n */\r\n\r\nexport class KonamiCodeHandler {\r\n  #konamiCodeSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];\r\n  #konamiCodePosition = 0;\r\n  #indicatorTimeout;\r\n  #indicator;\r\n  #logger;\r\n  #callback;\r\n  \r\n  /**\r\n   * Create a new KonamiCodeHandler instance\r\n   * @param {Object} options - Configuration options\r\n   * @param {Function} options.callback - Function to call when Konami code is detected\r\n   * @param {Object} options.logger - Logger instance for logging\r\n   */\r\n  constructor({ callback, logger } = {}) {\r\n    this.#logger = logger;\r\n    this.#callback = callback;\r\n    this.#createIndicator();\r\n    this.#initListener();\r\n    \r\n    if (this.#logger) {\r\n      this.#logger.debug('KonamiCodeHandler initialized');\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Create the visual indicator element\r\n   * @private\r\n   */\r\n  #createIndicator() {\r\n    this.#indicator = document.createElement('div');\r\n    this.#indicator.style.position = 'fixed';\r\n    this.#indicator.style.bottom = '10px';\r\n    this.#indicator.style.right = '10px';\r\n    this.#indicator.style.background = 'rgba(0, 0, 0, 0.7)';\r\n    this.#indicator.style.color = '#fff';\r\n    this.#indicator.style.padding = '5px 10px';\r\n    this.#indicator.style.borderRadius = '5px';\r\n    this.#indicator.style.fontFamily = 'monospace';\r\n    this.#indicator.style.fontSize = '12px';\r\n    this.#indicator.style.zIndex = '9999';\r\n    this.#indicator.style.display = 'none';\r\n    this.#indicator.textContent = 'Konami: 0/' + this.#konamiCodeSequence.length;\r\n    document.body.appendChild(this.#indicator);\r\n  }\r\n  \r\n  /**\r\n   * Initialize the keydown event listener\r\n   * @private\r\n   */\r\n  #initListener() {\r\n    document.addEventListener('keydown', (e) => {\r\n      // Check if the pressed key matches the next key in the sequence\r\n      if (e.key === this.#konamiCodeSequence[this.#konamiCodePosition]) {\r\n        // Move to the next position in the sequence\r\n        this.#konamiCodePosition++;\r\n        \r\n        // Only show the indicator after the first 4 keystrokes (up, up, down, down)\r\n        if (this.#konamiCodePosition >= 4) {\r\n          this.#indicator.style.display = 'block';\r\n          this.#indicator.textContent = `Konami: ${this.#konamiCodePosition}/${this.#konamiCodeSequence.length}`;\r\n        }\r\n        \r\n        // If we've reached the end of the sequence, trigger the callback\r\n        if (this.#konamiCodePosition === this.#konamiCodeSequence.length) {\r\n          if (this.#callback) {\r\n            this.#callback();\r\n          }\r\n          \r\n          // Reset the position for next time\r\n          this.#konamiCodePosition = 0;\r\n          \r\n          // Hide the indicator\r\n          setTimeout(() => {\r\n            this.#indicator.style.display = 'none';\r\n          }, 500);\r\n        }\r\n        \r\n        // Hide the indicator after a delay if not completed\r\n        if (this.#konamiCodePosition >= 4) {\r\n          clearTimeout(this.#indicatorTimeout);\r\n          this.#indicatorTimeout = setTimeout(() => {\r\n            this.#indicator.style.display = 'none';\r\n          }, 3000);\r\n        }\r\n      } else {\r\n        // Reset the position if the wrong key is pressed\r\n        if (this.#konamiCodePosition > 0) {\r\n          this.#konamiCodePosition = 0;\r\n          \r\n          // Only hide the indicator if it's currently shown\r\n          if (this.#indicator.style.display === 'block') {\r\n            this.#indicator.textContent = `Konami: 0/${this.#konamiCodeSequence.length}`;\r\n            \r\n            // Hide the indicator after a delay\r\n            clearTimeout(this.#indicatorTimeout);\r\n            this.#indicatorTimeout = setTimeout(() => {\r\n              this.#indicator.style.display = 'none';\r\n            }, 1500);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Set Konami code test mode in session storage\r\n   * This can be used by other components to detect when Konami code is active\r\n   */\r\n  static setTestMode() {\r\n    sessionStorage.setItem('konami_test_mode', 'true');\r\n    return true;\r\n  }\r\n  \r\n  /**\r\n   * Check if Konami code test mode is active\r\n   * @returns {boolean} True if Konami code test mode is active\r\n   */\r\n  static isTestMode() {\r\n    return sessionStorage.getItem('konami_test_mode') === 'true';\r\n  }\r\n  \r\n  /**\r\n   * Clear Konami code test mode from session storage\r\n   */\r\n  static clearTestMode() {\r\n    sessionStorage.removeItem('konami_test_mode');\r\n  }\r\n  \r\n  /**\r\n   * Get predefined test order data for Konami code test mode\r\n   * @param {Object} state - Application state\r\n   * @param {Function} getPackageIdFromUrl - Function to get package ID from URL\r\n   * @param {Function} getCartLines - Function to get cart lines\r\n   * @returns {Object} Test order data\r\n   */\r\n  static getTestOrderData(state, getPackageIdFromUrl, getCartLines) {\r\n    try {\r\n      // Get cart items from the app state\r\n      const cartItems = state?.cart?.items || [];\r\n      \r\n      // If cart is empty, create a dummy item\r\n      const packageId = getPackageIdFromUrl ? getPackageIdFromUrl() : 1;\r\n      const lines = cartItems.length > 0 && getCartLines ? \r\n        getCartLines(cartItems) : \r\n        [{ package_id: packageId || 1, quantity: 1 }];\r\n        \r\n      // Get the correct shipping method ID from the state\r\n      const shippingMethodObject = state?.cart?.shippingMethod;\r\n      const shippingMethodId = parseInt(shippingMethodObject?.ref_id, 10) || 1; // Use the ref_id from state\r\n      \r\n      // Create a complete test order data object\r\n      return {\r\n        user: {\r\n          email: 'test@test.com',\r\n          first_name: 'Test',\r\n          last_name: 'Order'\r\n        },\r\n        shipping_address: {\r\n          first_name: 'Test',\r\n          last_name: 'Order',\r\n          line1: 'Test Address 123',\r\n          line2: '',\r\n          line3: '',\r\n          line4: 'Tempe',\r\n          state: 'AZ',\r\n          postcode: '85281',\r\n          country: 'US',\r\n          phone_number: '+14807581224'\r\n        },\r\n        billing_address: {\r\n          first_name: 'Test',\r\n          last_name: 'Order',\r\n          line1: 'Test Address 123',\r\n          line2: '',\r\n          line3: '',\r\n          line4: 'Tempe',\r\n          state: 'AZ',\r\n          postcode: '85281',\r\n          country: 'US',\r\n          phone_number: '+14807581224'\r\n        },\r\n        shipping_method: shippingMethodId, // Use the ID read from state\r\n        attribution: state?.cart?.attribution || {},\r\n        lines: lines,\r\n        // Don't include payment-related fields here as they'll be added by the payment handler\r\n        success_url: window.location.origin + '/checkout/confirmation/'\r\n      };\r\n    } catch (error) {\r\n      console.error('Error getting Konami test order data:', error);\r\n      return null;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Show a message to the user when Konami code is activated\r\n   * @returns {HTMLElement} The message element\r\n   */\r\n  static showActivationMessage() {\r\n    const messageElement = document.createElement('div');\r\n    messageElement.style.position = 'fixed';\r\n    messageElement.style.top = '50%';\r\n    messageElement.style.left = '50%';\r\n    messageElement.style.transform = 'translate(-50%, -50%)';\r\n    messageElement.style.background = 'rgba(0, 0, 0, 0.8)';\r\n    messageElement.style.color = '#fff';\r\n    messageElement.style.padding = '20px';\r\n    messageElement.style.borderRadius = '10px';\r\n    messageElement.style.zIndex = '9999';\r\n    messageElement.style.textAlign = 'center';\r\n    messageElement.style.fontFamily = 'monospace';\r\n    messageElement.style.fontSize = '18px';\r\n    messageElement.innerHTML = `\r\n      <h3>🎮 KONAMI CODE ACTIVATED! 🎮</h3>\r\n      <p>Creating test order with predefined data:</p>\r\n      <p style=\"font-size: 14px; margin-top: 10px; text-align: left;\">\r\n        Email: test@test.com<br>\r\n        Name: Test Order<br>\r\n        Address: Test Address 123<br>\r\n        City: Tempe, AZ 85281<br>\r\n        Country: US<br>\r\n        Phone: +14807581224<br>\r\n        Card: 4111111111111111 (test mode)\r\n      </p>\r\n    `;\r\n    document.body.appendChild(messageElement);\r\n    return messageElement;\r\n  }\r\n} ", "/**\r\n * PaymentHandler - Handles payment processing for checkout\r\n */\r\nimport { SpreedlyManager } from '../../managers/SpreedlyManager.js';\r\nimport { FormValidator } from './FormValidator.js';\r\nimport { KonamiCodeHandler } from '../../utils/KonamiCodeHandler.js';\r\n\r\nexport class PaymentHandler {\r\n  #apiClient;\r\n  #logger;\r\n  #app;\r\n  #form;\r\n  #spreedlyManager = null;\r\n  #formValidator = null;\r\n  #paymentMethod = 'credit-card';\r\n  #isProcessing = false;\r\n  #debugMode = false;\r\n  #testCards = {\r\n    visa: '4111111111111111',\r\n    mastercard: '5555555555554444',\r\n    amex: '378282246310005',\r\n    discover: '6011111111111117'\r\n  };\r\n  #expressCheckoutButtons = {\r\n    paypal: null,\r\n    applePay: null,\r\n    googlePay: null\r\n  };\r\n  #deviceSupport = {\r\n    applePay: false,\r\n    googlePay: false\r\n  };\r\n\r\n  constructor(apiClient, logger, app) {\r\n    this.#apiClient = apiClient;\r\n    this.#logger = logger;\r\n    this.#app = app;\r\n    this.#form = this.#getCheckoutForm();\r\n\r\n    if (!this.#form) return;\r\n\r\n    this.#setupFormPrevention();\r\n    this.#setupCheckoutButton();\r\n    \r\n    this.#formValidator = new FormValidator({ \r\n      debugMode: this.#debugMode,\r\n      logger: this.#logger\r\n    });\r\n    this.#form.__formValidator = this.#formValidator;\r\n\r\n    this.#initPaymentMethods();\r\n    this.#initSpreedly();\r\n    this.#initExpressCheckout();\r\n    this.#checkForPaymentFailedParameters();\r\n  }\r\n\r\n  #getCheckoutForm() {\r\n    const form = document.querySelector('form[os-checkout=\"form\"]') || document.querySelector('form#combo_form');\r\n    if (!form) {\r\n      this.#safeLog('warn', 'No checkout form found');\r\n    }\r\n    return form;\r\n  }\r\n\r\n  #setupFormPrevention() {\r\n    this.#form.removeAttribute('action');\r\n    this.#form.setAttribute('method', 'post');\r\n    \r\n    const hiddenInput = document.createElement('input');\r\n    hiddenInput.type = 'hidden';\r\n    hiddenInput.name = 'prevent_serialization';\r\n    hiddenInput.value = 'true';\r\n    this.#form.appendChild(hiddenInput);\r\n\r\n    this.#form.addEventListener('submit', this.#preventFormSubmission.bind(this), true);\r\n    this.#form.onsubmit = this.#preventFormSubmission.bind(this);\r\n    this.#convertSubmitButtons();\r\n  }\r\n\r\n  #preventFormSubmission(e) {\r\n    if (e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      e.stopImmediatePropagation();\r\n    }\r\n    \r\n    this.#form.removeAttribute('action');\r\n    this.#form.setAttribute('method', 'post');\r\n    window.stop?.();\r\n    \r\n    this.#safeLog('debug', 'Form submission prevented');\r\n    return false;\r\n  }\r\n\r\n  #convertSubmitButtons() {\r\n    try {\r\n      const submitButtons = this.#form.querySelectorAll('button[type=\"submit\"], input[type=\"submit\"]');\r\n      submitButtons.forEach((button, index) => {\r\n        button.setAttribute('type', 'button');\r\n        button.addEventListener('click', (e) => {\r\n          e.preventDefault();\r\n          this.#safeLog('debug', `Submit button ${index + 1} clicked`);\r\n          this.processPayment();\r\n        });\r\n      });\r\n    } catch (error) {\r\n      this.#safeLog('error', 'Error converting submit buttons:', error);\r\n    }\r\n  }\r\n\r\n  #setupCheckoutButton() {\r\n    const checkoutButton = document.querySelector('[os-checkout-payment=\"combo\"]');\r\n    if (!checkoutButton) {\r\n      this.#safeLog('warn', 'Checkout button not found');\r\n      return;\r\n    }\r\n\r\n    const newButton = checkoutButton.cloneNode(true);\r\n    checkoutButton.parentNode.replaceChild(newButton, checkoutButton);\r\n    \r\n    newButton.addEventListener('click', (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      e.stopImmediatePropagation();\r\n      \r\n      this.#form.onsubmit = this.#preventFormSubmission.bind(this);\r\n      this.#form.removeAttribute('action');\r\n      this.#form.setAttribute('method', 'post');\r\n      \r\n      this.#safeLog('debug', 'Checkout button clicked');\r\n      setTimeout(() => this.processPayment(), 0);\r\n    });\r\n  }\r\n\r\n  #safeLog(level, message, ...args) {\r\n    try {\r\n      const logFn = this.#logger?.[level] || console[level] || console.log;\r\n      logFn.call(console, `[${level.toUpperCase()}] ${message}`, ...args);\r\n    } catch (error) {\r\n      console.error('Error logging:', error);\r\n    }\r\n  }\r\n\r\n  #initPaymentMethods() {\r\n    try {\r\n      const paymentMethodSelector = document.querySelector('[os-checkout-field=\"payment-method\"]') || \r\n                                   document.querySelector('input[name=\"combo_mode\"]:checked');\r\n      if (!paymentMethodSelector) {\r\n        this.#safeLog('warn', 'Payment method selector not found');\r\n        return;\r\n      }\r\n\r\n      this.#paymentMethod = paymentMethodSelector.value || 'credit-card';\r\n      this.#setupPaymentMethodListeners();\r\n    } catch (error) {\r\n      this.#safeLog('error', 'Error initializing payment methods:', error);\r\n    }\r\n  }\r\n\r\n  #setupPaymentMethodListeners() {\r\n    const radioButtons = document.querySelectorAll('input[name=\"combo_mode\"]');\r\n    const handler = (e) => {\r\n      this.#paymentMethod = e.target.value;\r\n      this.#safeLog('debug', `Payment method changed to: ${this.#paymentMethod}`);\r\n      document.dispatchEvent(new CustomEvent('payment-method-changed', {\r\n        detail: { mode: this.#paymentMethod }\r\n      }));\r\n    };\r\n\r\n    if (radioButtons.length > 0) {\r\n      radioButtons.forEach(radio => radio.addEventListener('change', handler));\r\n    } else {\r\n      document.querySelector('[os-checkout-field=\"payment-method\"]')\r\n        ?.addEventListener('change', handler);\r\n    }\r\n  }\r\n\r\n  #initSpreedly() {\r\n    try {\r\n      const environmentKey = document.querySelector('meta[name=\"spreedly-environment-key\"]')?.content ||\r\n                            document.querySelector('meta[name=\"os-payment-env-key\"]')?.content;\r\n      if (!environmentKey) {\r\n        this.#safeLog('warn', 'Spreedly environment key not found');\r\n        return;\r\n      }\r\n\r\n      this.#spreedlyManager = new SpreedlyManager(environmentKey, { \r\n        debug: this.#debugMode,\r\n        app: this.#app\r\n      });\r\n      this.#setupSpreedlyCallbacks();\r\n      this.#initializeExpirationFields();\r\n    } catch (error) {\r\n      this.#safeLog('error', 'Error initializing Spreedly:', error);\r\n    }\r\n  }\r\n\r\n  #setupSpreedlyCallbacks() {\r\n    this.#spreedlyManager.setOnReady(() => this.#safeLog('debug', 'Spreedly ready'));\r\n    this.#spreedlyManager.setOnError((errors) => {\r\n      this.#safeLog('error', 'Spreedly errors:', errors);\r\n      this.#isProcessing = false;\r\n      this.#hideProcessingState();\r\n      \r\n      // Map Spreedly validation errors to user-friendly messages\r\n      const errorMessage = this.#formatSpreedlyErrors(errors);\r\n      this.#handlePaymentError(errorMessage);\r\n    });\r\n    this.#spreedlyManager.setOnPaymentMethod((token, pmData) => {\r\n      this.#safeLog('debug', 'Spreedly payment method token received:', token);\r\n      this.#createOrder({\r\n        payment_token: token,\r\n        payment_method: 'credit-card',\r\n        ...this.#getOrderData()\r\n      });\r\n    });\r\n  }\r\n\r\n  #formatSpreedlyErrors(errors) {\r\n    if (!errors || errors.length === 0) {\r\n      return 'An unknown error occurred with your payment method';\r\n    }\r\n    \r\n    // Map common Spreedly error messages to user-friendly messages\r\n    const errorMap = {\r\n      'The card number is not a valid credit card number': 'Please enter a valid credit card number',\r\n      'Credit card number entered is not valid': 'Please enter a valid credit card number',\r\n      'The card number is too short': 'The card number you entered is too short',\r\n      'The card number is too long': 'The card number you entered is too long',\r\n      'The card security code is invalid': 'Please enter a valid security code (CVV)',\r\n      'The card security code is too short': 'The security code (CVV) is too short',\r\n      'The card security code is too long': 'The security code (CVV) is too long',\r\n      'The card has expired': 'This card has expired. Please use a different card',\r\n      'The card expiration month is invalid': 'Please select a valid expiration month',\r\n      'The card expiration year is invalid': 'Please select a valid expiration year'\r\n    };\r\n    \r\n    // Check if any of the errors match our map\r\n    for (const error of errors) {\r\n      for (const [key, value] of Object.entries(errorMap)) {\r\n        if (error.includes(key)) {\r\n          return value;\r\n        }\r\n      }\r\n    }\r\n    \r\n    // If no specific mapping, return the first error\r\n    return errors[0];\r\n  }\r\n\r\n  #initializeExpirationFields() {\r\n    try {\r\n      const [monthSelect, yearSelect] = this.#getExpirationElements();\r\n      this.#populateExpirationOptions(monthSelect, yearSelect);\r\n    } catch (error) {\r\n      this.#safeLog('error', 'Error initializing expiration fields:', error);\r\n    }\r\n  }\r\n\r\n  #getExpirationElements() {\r\n    const monthSelectors = ['[os-checkout-field=\"cc-month\"]', '[os-checkout-field=\"exp-month\"]', '#credit_card_exp_month'];\r\n    const yearSelectors = ['[os-checkout-field=\"cc-year\"]', '[os-checkout-field=\"exp-year\"]', '#credit_card_exp_year'];\r\n    \r\n    return [\r\n      monthSelectors.map(s => document.querySelector(s)).find(Boolean),\r\n      yearSelectors.map(s => document.querySelector(s)).find(Boolean)\r\n    ];\r\n  }\r\n\r\n  #populateExpirationOptions(monthSelect, yearSelect) {\r\n    if (monthSelect) {\r\n      monthSelect.innerHTML = '<option value=\"\">Month</option>';\r\n      for (let i = 1; i <= 12; i++) {\r\n        const month = i.toString().padStart(2, '0');\r\n        monthSelect.appendChild(new Option(month, month));\r\n      }\r\n    }\r\n\r\n    if (yearSelect) {\r\n      yearSelect.innerHTML = '<option value=\"\">Year</option>';\r\n      const currentYear = new Date().getFullYear();\r\n      for (let i = 0; i < 20; i++) {\r\n        const year = currentYear + i;\r\n        yearSelect.appendChild(new Option(year, year));\r\n      }\r\n    }\r\n  }\r\n\r\n  #isTestMode() {\r\n    // Check for URL parameter or Konami code flag in sessionStorage\r\n    return new URLSearchParams(window.location.search).get('test') === 'true' || \r\n           KonamiCodeHandler.isTestMode();\r\n  }\r\n\r\n  /**\r\n   * Set Konami code test mode flag\r\n   * This method can be called from CheckoutManager when Konami code is activated\r\n   */\r\n  setKonamiTestMode() {\r\n    KonamiCodeHandler.setTestMode();\r\n    this.#safeLog('info', '🎮 Konami code test mode activated');\r\n    return true;\r\n  }\r\n\r\n  processPayment() {\r\n    // Check if Konami code test mode is active and clear it after use\r\n    const isKonamiMode = KonamiCodeHandler.isTestMode();\r\n    if (isKonamiMode) {\r\n      KonamiCodeHandler.clearTestMode();\r\n      this.#safeLog('info', '🎮 Processing payment in Konami test mode');\r\n    }\r\n\r\n    if (this.#isProcessing) {\r\n      this.#safeLog('warn', 'Payment already processing');\r\n      return;\r\n    }\r\n\r\n    // Clear any previous errors before starting a new payment attempt\r\n    this.#clearPaymentErrors();\r\n\r\n    this.#enforceFormPrevention();\r\n    this.#isProcessing = true;\r\n    this.#safeLog('debug', `Processing payment with method: ${this.#paymentMethod}`);\r\n\r\n    try {\r\n      // If in Konami mode, bypass validation and use predefined test data\r\n      if (isKonamiMode) {\r\n        this.#showProcessingState();\r\n        \r\n        // Get order data using predefined test data\r\n        const orderData = KonamiCodeHandler.getTestOrderData(\r\n          this.#app?.state?.getState(),\r\n          this.#getPackageIdFromUrl.bind(this),\r\n          this.#getCartLines.bind(this)\r\n        );\r\n          \r\n        if (!orderData) {\r\n          this.#hideProcessingState();\r\n          return;\r\n        }\r\n        \r\n        // Create the order with test payment details using the specific test card\r\n        this.#createOrder({\r\n          ...orderData,\r\n          payment_detail: { \r\n            payment_method: 'card_token', \r\n            card_token: 'test_card',\r\n            test_card_number: '6011111111111117' // Use specific test card for Konami mode\r\n          }\r\n        });\r\n        return;\r\n      }\r\n      \r\n      // Regular payment flow (including test mode)\r\n      if (!this.#formValidator.validateAllFields(this.#paymentMethod)) {\r\n        this.#isProcessing = false;\r\n        this.#hideProcessingState();\r\n        return;\r\n      }\r\n\r\n      this.#showProcessingState();\r\n      const orderData = this.#getOrderData();\r\n      if (!orderData) return;\r\n\r\n      // If in test mode, bypass Spreedly validation and use test card token\r\n      if (this.#isTestMode()) {\r\n        this.#createOrder({\r\n          ...orderData,\r\n          payment_detail: { \r\n            payment_method: 'card_token', \r\n            card_token: 'test_card' // Use test_card token for test mode\r\n          }\r\n        });\r\n        return;\r\n      }\r\n\r\n      switch (this.#paymentMethod) {\r\n        case 'credit-card':\r\n        case 'credit':\r\n          this.#processCreditCard();\r\n          break;\r\n        case 'paypal':\r\n          this.#processPaypal();\r\n          break;\r\n        default:\r\n          this.#handlePaymentError(`Unknown payment method: ${this.#paymentMethod}`);\r\n      }\r\n    } catch (error) {\r\n      this.#safeLog('error', 'Error processing payment:', error);\r\n      this.#handlePaymentError('Unexpected error occurred');\r\n      this.#hideProcessingState();\r\n    }\r\n  }\r\n\r\n  #enforceFormPrevention() {\r\n    this.#form?.removeAttribute('action');\r\n    this.#form?.setAttribute('method', 'post');\r\n    this.#form.onsubmit = this.#preventFormSubmission.bind(this);\r\n    this.#form?.querySelectorAll('button[type=\"submit\"], input[type=\"submit\"]')\r\n      .forEach(btn => {\r\n        btn.disabled = true;\r\n        btn.setAttribute('type', 'button');\r\n      });\r\n  }\r\n\r\n  #showProcessingState() {\r\n    const submitButton = document.querySelector('[os-checkout-payment=\"combo\"]');\r\n    if (submitButton) {\r\n      submitButton.disabled = true;\r\n      submitButton.classList.add('is-submitting');\r\n    }\r\n  }\r\n\r\n  #hideProcessingState() {\r\n    const submitButton = document.querySelector('[os-checkout-payment=\"combo\"]');\r\n    if (submitButton) {\r\n      submitButton.disabled = false;\r\n      submitButton.classList.remove('is-submitting');\r\n    }\r\n    this.#isProcessing = false;\r\n  }\r\n\r\n  #processCreditCard() {\r\n    if (!this.#spreedlyManager) {\r\n      this.#handlePaymentError('Credit card processing unavailable');\r\n      return;\r\n    }\r\n  \r\n    const [fullName, month, year] = this.#getCreditCardFields();\r\n  \r\n    // If we're in debug test card mode or regular test mode, use test card flow\r\n    if (this.#isDebugTestCardMode() || this.#isTestMode()) {\r\n      this.#processTestCard(fullName, month, year);\r\n      return;\r\n    }\r\n  \r\n    // Validate credit card fields using the FormValidator\r\n    if (!this.#formValidator.validateCreditCard()) {\r\n      this.#safeLog('debug', 'Credit card validation failed on initial check');\r\n      if (!month || !year) {\r\n        this.#isProcessing = false;\r\n        this.#hideProcessingState();\r\n        return;\r\n      }\r\n    }\r\n  \r\n    // Proceed with tokenization\r\n    this.#spreedlyManager.tokenizeCard({ \r\n      full_name: fullName || '', \r\n      month, \r\n      year \r\n    });\r\n\r\n    // Add callback to log tokenization results\r\n    this.#spreedlyManager.setOnPaymentMethod((token, pmData) => {\r\n    //   console.log('Card tokenization successful:', {\r\n    //     token,\r\n    //     paymentMethodData: pmData,\r\n    //     cardholderName: fullName,\r\n    //     expirationMonth: month,\r\n    //     expirationYear: year\r\n    //   });\r\n      \r\n      // Comment out order creation\r\n      this.#createOrder({\r\n        payment_token: token,\r\n        payment_method: 'credit-card',\r\n        ...this.#getOrderData()\r\n      });\r\n    });\r\n  }\r\n\r\n  #getCreditCardFields() {\r\n    // Check if billing address is different from shipping\r\n    const isDifferentBilling = !this.#formValidator.isSameAsShipping();\r\n    \r\n    // Get first and last name from the appropriate form (billing or shipping)\r\n    const firstName = document.querySelector(`[os-checkout-field=\"${isDifferentBilling ? 'billing-fname' : 'fname'}\"]`)?.value || '';\r\n    const lastName = document.querySelector(`[os-checkout-field=\"${isDifferentBilling ? 'billing-lname' : 'lname'}\"]`)?.value || '';\r\n    \r\n    // Capitalize the names\r\n    const capitalize = (str) => str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();\r\n    const fullName = `${capitalize(firstName)} ${capitalize(lastName)}`.trim();\r\n    \r\n    return [\r\n      fullName,\r\n      document.querySelector('[os-checkout-field=\"cc-month\"]')?.value || \r\n      document.querySelector('[os-checkout-field=\"exp-month\"]')?.value || \r\n      document.querySelector('#credit_card_exp_month')?.value || '',\r\n      document.querySelector('[os-checkout-field=\"cc-year\"]')?.value || \r\n      document.querySelector('[os-checkout-field=\"exp-year\"]')?.value || \r\n      document.querySelector('#credit_card_exp_year')?.value || ''\r\n    ];\r\n  }\r\n\r\n  #isDebugTestCardMode() {\r\n    const params = new URLSearchParams(window.location.search);\r\n    return (this.#debugMode || params.get('debug') === 'true') && params.has('test-card');\r\n  }\r\n\r\n  #processTestCard(fullName, month, year) {\r\n    // Get the actual card number from the input field\r\n    const cardNumber = document.querySelector('[os-checkout-field=\"cc-number\"]')?.value || \r\n                      document.querySelector('#credit_card_number')?.value;\r\n    \r\n    if (!cardNumber) {\r\n      this.#handlePaymentError('Please enter a credit card number');\r\n      return;\r\n    }\r\n\r\n    // Create a test token with the actual card number\r\n    this.#createOrder({\r\n      payment_token: `test_card_token_${Date.now()}`,\r\n      payment_method: 'credit-card',\r\n      test_card_number: cardNumber,\r\n      ...this.#getOrderData()\r\n    });\r\n  }\r\n\r\n  #processPaypal() {\r\n    this.#createOrder({\r\n      payment_method: 'paypal',\r\n      ...this.#getOrderData()\r\n    });\r\n  }\r\n\r\n  #getPackageIdFromUrl() {\r\n    const params = new URLSearchParams(window.location.search);\r\n    const id = params.get('package_id') || params.get('pid');\r\n    return id ? parseInt(id, 10) || null : null;\r\n  }\r\n\r\n  #getOrderData() {\r\n    try {\r\n      const shippingData = this.#getAddressData(['fname', 'lname', 'address1', 'address2', 'city', 'province', 'postal', 'country', 'phone']);\r\n      const billingData = this.#formValidator.isSameAsShipping() ? null : \r\n        this.#getAddressData(['billing-fname', 'billing-lname', 'billing-address1', 'billing-address2', 'billing-city', 'billing-province', 'billing-postal', 'billing-country', 'billing-phone']);\r\n\r\n      const shippingAddress = this.#formatAddress(shippingData);\r\n      const billingAddress = billingData ? this.#formatAddress(billingData) : { ...shippingAddress };\r\n\r\n      if (!this.#app?.state) {\r\n        this.#handlePaymentError('Cart data missing');\r\n        return null;\r\n      }\r\n\r\n      const state = this.#app.state.getState();\r\n      if (!state.cart?.items?.length) {\r\n        this.#handlePaymentError('Cart is empty');\r\n        return null;\r\n      }\r\n\r\n      const orderData = {\r\n        user: {\r\n          email: state.user?.email || '',\r\n          first_name: state.user?.firstName || shippingAddress.first_name,\r\n          last_name: state.user?.lastName || shippingAddress.last_name\r\n        },\r\n        shipping_address: shippingAddress,\r\n        billing_address: billingAddress,\r\n        shipping_method: this.#getShippingMethod(state),\r\n        attribution: state.cart.attribution || {},\r\n        lines: this.#getCartLines(state.cart.items)\r\n      };\r\n\r\n      // Include vouchers if available - API expects array of strings\r\n      if (state.cart.vouchers && state.cart.vouchers.length > 0) {\r\n        // Convert any object vouchers to string codes\r\n        orderData.vouchers = state.cart.vouchers.map(voucher => {\r\n          if (typeof voucher === 'string') {\r\n            return voucher;\r\n          } else if (voucher && voucher.code) {\r\n            return voucher.code;\r\n          }\r\n          return String(voucher);\r\n        });\r\n        this.#safeLog('debug', `Using vouchers from cart: ${JSON.stringify(orderData.vouchers)}`);\r\n      } else if (state.cart.couponDetails && state.cart.couponCode) {\r\n        // Just use the coupon code as a string\r\n        orderData.vouchers = [state.cart.couponCode];\r\n        this.#safeLog('debug', `Using coupon code: ${state.cart.couponCode}`);\r\n      } else if (state.cart.couponCode) {\r\n        // Backward compatibility for coupon code only\r\n        orderData.vouchers = [state.cart.couponCode];\r\n        this.#safeLog('debug', `Using legacy coupon code: ${state.cart.couponCode}`);\r\n      }\r\n\r\n      return orderData;\r\n    } catch (error) {\r\n      this.#safeLog('error', 'Error getting order data:', error);\r\n      this.#handlePaymentError('Error preparing order');\r\n      return null;\r\n    }\r\n  }\r\n\r\n  #getAddressData(fields) {\r\n    const data = {};\r\n    fields.forEach(field => {\r\n      const value = document.querySelector(`[os-checkout-field=\"${field}\"]`)?.value;\r\n      if (value) data[field.replace('billing-', '')] = value;\r\n    });\r\n    return data;\r\n  }\r\n\r\n  #formatAddress(data) {\r\n    return {\r\n      first_name: data.fname || '',\r\n      last_name: data.lname || '',\r\n      line1: data.address1 || '',\r\n      line2: data.address2 || '',\r\n      line3: '',\r\n      line4: data.city || '',\r\n      state: data.province || '',\r\n      postcode: data.postal || '',\r\n      country: data.country || '',\r\n      phone_number: data.phone || ''\r\n    };\r\n  }\r\n\r\n  #getShippingMethod(state) {\r\n    const method = state.cart?.shippingMethod; // This is the object { ref_id: 2, code: 'default', ... }\r\n    // Extract the ref_id before parsing\r\n    const refId = method?.ref_id;\r\n    // Parse the refId, default to 1 if null, undefined, or NaN\r\n    return parseInt(refId, 10) || 1;\r\n  }\r\n\r\n  #getCartLines(items) {\r\n    return items.map(item => {\r\n      let packageId = parseInt(item.id || item.external_id, 10) || this.#getPackageIdFromUrl();\r\n      if (!packageId) throw new Error(`Invalid package ID for item: ${item.name}`);\r\n      \r\n      // Create the line item\r\n      const lineItem = {\r\n        package_id: packageId,\r\n        quantity: item.quantity || 1\r\n      };\r\n      \r\n      // If is_upsell property exists on the item, add it to the line item\r\n      if (item.is_upsell === true) {\r\n        lineItem.is_upsell = true;\r\n        this.#safeLog('debug', `Adding line item with is_upsell=true: ${packageId}`);\r\n      }\r\n      \r\n      return lineItem;\r\n    });\r\n  }\r\n\r\n  #createOrder(orderData) {\r\n    if (!orderData || !this.#apiClient) {\r\n      this.#handlePaymentError('Cannot create order');\r\n      this.#hideProcessingState();\r\n      return;\r\n    }\r\n\r\n    this.#enforceFormPrevention();\r\n    const formattedOrderData = this.#formatOrderData(orderData);\r\n    \r\n    // Debug vouchers\r\n    if (orderData.vouchers) {\r\n      this.#safeLog('debug', `Original vouchers in orderData:`, orderData.vouchers);\r\n    } else {\r\n      this.#safeLog('warn', `No vouchers found in original orderData`);\r\n    }\r\n    \r\n    if (formattedOrderData.vouchers) {\r\n      this.#safeLog('debug', `Formatted vouchers in formattedOrderData:`, formattedOrderData.vouchers);\r\n    } else {\r\n      this.#safeLog('warn', `No vouchers found in formattedOrderData - they may have been lost during formatting`);\r\n    }\r\n\r\n    this.#apiClient.createOrder(formattedOrderData)\r\n      .then(response => this.#handleOrderSuccess(response))\r\n      .catch(error => this.#handlePaymentError(this.#formatErrorMessage(error)))\r\n      .finally(() => this.#hideProcessingState());\r\n  }\r\n\r\n  #formatOrderData(orderData) {\r\n    const formatted = { ...orderData };\r\n    \r\n    // Only set success_url from meta tag if not already set in orderData\r\n    if (!formatted.success_url && this.#apiClient) {\r\n      // Use ApiClient to get next page URL from meta tag\r\n      const nextPageUrl = this.#apiClient.getNextPageUrlFromMeta(orderData.ref_id);\r\n      if (nextPageUrl) {\r\n        formatted.success_url = nextPageUrl;\r\n      }\r\n    }\r\n    \r\n    // Add payment_failed_url to redirect back to the current page with error parameters\r\n    if (!formatted.payment_failed_url) {\r\n      const currentUrl = new URL(window.location.href);\r\n      currentUrl.searchParams.set('payment_failed', 'true');\r\n      \r\n      // Add the payment method to the failed URL if available\r\n      if (orderData.payment_method) {\r\n        currentUrl.searchParams.set('payment_method', orderData.payment_method);\r\n      } else if (formatted.payment_detail?.payment_method) {\r\n        currentUrl.searchParams.set('payment_method', formatted.payment_detail.payment_method);\r\n      }\r\n      \r\n      formatted.payment_failed_url = currentUrl.href;\r\n      this.#safeLog('debug', `Set payment_failed_url to: ${formatted.payment_failed_url}`);\r\n    }\r\n    \r\n    if (orderData.payment_token) {\r\n      formatted.payment_detail = formatted.payment_detail || {};\r\n      formatted.payment_detail.card_token = orderData.payment_token;\r\n      delete formatted.payment_token;\r\n    }\r\n    if (orderData.payment_method) {\r\n      formatted.payment_detail = formatted.payment_detail || {};\r\n      formatted.payment_detail.payment_method = {\r\n        'credit-card': 'card_token',\r\n        'credit': 'card_token',\r\n        'paypal': 'paypal'\r\n      }[orderData.payment_method] || orderData.payment_method;\r\n      delete formatted.payment_method;\r\n    }\r\n    formatted.billing_address = formatted.billing_address || formatted.shipping_address;\r\n    \r\n    // Make sure vouchers are preserved from the original order data\r\n    if (!formatted.vouchers && orderData.vouchers) {\r\n      formatted.vouchers = [...orderData.vouchers];\r\n      this.#safeLog('debug', 'Restored vouchers from original order data', formatted.vouchers);\r\n    }\r\n    \r\n    // If we still don't have vouchers, check cart state directly as a fallback\r\n    if (!formatted.vouchers && this.#app?.state) {\r\n      const cart = this.#app.state.getState('cart');\r\n      if (cart.couponDetails && cart.couponCode) {\r\n        // Just use the coupon code as a string - API only expects strings\r\n        formatted.vouchers = [cart.couponCode];\r\n        this.#safeLog('debug', 'Added coupon code from cart state as fallback', formatted.vouchers);\r\n      } else if (cart.couponCode) {\r\n        formatted.vouchers = [cart.couponCode];\r\n        this.#safeLog('debug', 'Added coupon code from cart state as fallback', formatted.vouchers);\r\n      }\r\n    }\r\n    \r\n    // Make sure all vouchers are strings (not objects)\r\n    if (formatted.vouchers && Array.isArray(formatted.vouchers)) {\r\n      formatted.vouchers = formatted.vouchers.map(voucher => {\r\n        if (typeof voucher === 'string') {\r\n          return voucher;\r\n        } else if (voucher && voucher.code) {\r\n          return voucher.code;\r\n        }\r\n        return String(voucher);\r\n      });\r\n      this.#safeLog('debug', 'Ensured all vouchers are strings', formatted.vouchers);\r\n    }\r\n    \r\n    return formatted;\r\n  }\r\n\r\n  #formatErrorMessage(error) {\r\n    try {\r\n      const errorData = JSON.parse(error.message);\r\n\r\n      // 1. Handle specific payment_details errors (existing)\r\n      if (errorData?.payment_details) {\r\n        return this.#formatPaymentErrorMessage(errorData);\r\n      }\r\n\r\n      // 2. Handle specific known error keys directly (e.g., voucher)\r\n      if (typeof errorData?.voucher === 'string') {\r\n        return errorData.voucher; // Return the voucher message directly\r\n      }\r\n      // Example for adding other specific keys:\r\n      // if (typeof errorData?.another_specific_key === 'string') {\r\n      //   return errorData.another_specific_key;\r\n      // }\r\n\r\n      // 3. Handle generic errorData.message if present\r\n      if (errorData?.message) {\r\n        if (typeof errorData.message === 'string') {\r\n          // If errorData.message is just a string, use it.\r\n          // Prefixing with \"Order creation failed: \" to maintain some consistency\r\n          // with how it might have behaved for other errors hitting this path.\r\n          return `Order creation failed: ${errorData.message}`;\r\n        }\r\n        // If errorData.message is an object or array, format it (existing logic improved)\r\n        const formattedMessage = Array.isArray(errorData.message) ?\r\n          errorData.message.map(e => typeof e === 'object' ? Object.entries(e).map(([k, v]) => `${k}: ${v}`).join(', ') : String(e)).join('; ') :\r\n          (typeof errorData.message === 'object' ? Object.entries(errorData.message).map(([k, v]) => `${k}: ${v}`).join(', ') : String(errorData.message));\r\n        return `Order creation failed: ${formattedMessage}`;\r\n      }\r\n\r\n      // 4. Fallback: If no specific handlers matched, try to extract a general message from other keys\r\n      // Exclude 'ref_id' or other purely informational fields.\r\n      let generalErrorMessage = '';\r\n      for (const key in errorData) {\r\n        if (Object.prototype.hasOwnProperty.call(errorData, key) &&\r\n            key !== 'ref_id' && key !== 'payment_details' && key !== 'message' &&\r\n            typeof errorData[key] === 'string') {\r\n          generalErrorMessage += (generalErrorMessage ? '; ' : '') + `${this.#formatErrorKey(key)}: ${errorData[key]}`;\r\n        }\r\n      }\r\n      if (generalErrorMessage) {\r\n        return generalErrorMessage;\r\n      }\r\n\r\n    } catch (e) {\r\n      this.#safeLog('warn', `Error parsing or formatting API error message: ${e.message}`, error.message);\r\n      // error.message is the original string passed to the function.\r\n      // If it's a simple string (not JSON), it might be a direct message.\r\n      if (typeof error.message === 'string' && !error.message.startsWith('{') && !error.message.startsWith('[')) {\r\n          return error.message;\r\n      }\r\n      // Default for parsing failure or complex unhandled structures\r\n      return 'An error occurred while processing your request. Please check the details and try again.';\r\n    }\r\n\r\n    // Final, ultimate fallback if nothing above returned a message\r\n    return 'Order creation failed. Please contact support if the issue persists.';\r\n  }\r\n\r\n  #formatErrorKey(key) {\r\n    // Converts \"some_key\" to \"Some key\" for better display\r\n    return key.replace(/_/g, ' ').replace(/\\w\\S*/g, (txt) => txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase());\r\n  }\r\n\r\n  #formatPaymentErrorMessage(errorData) {\r\n    // Create a user-friendly message based on the payment error\r\n    const errorCode = errorData.payment_response_code;\r\n    const errorDetails = errorData.payment_details;\r\n    \r\n    // Map common error codes to user-friendly messages\r\n    const errorMessages = {\r\n      '3005': 'The card number you entered is invalid. Please check and try again.',\r\n      '3006': 'The card expiration date is invalid. Please check and try again.',\r\n      '3007': 'The card security code (CVV) is invalid. Please check and try again.',\r\n      '3008': 'The card has been declined. Please try another payment method.',\r\n      '3009': 'This card has expired. Please use a different card.',\r\n      '3010': 'The card has insufficient funds. Please try another payment method.'\r\n    };\r\n    \r\n    return errorMessages[errorCode] || errorDetails || 'There was a problem processing your payment. Please try again.';\r\n  }\r\n\r\n  #handlePaymentError(message) {\r\n    this.#hideProcessingState();\r\n    \r\n    // Clear any previous error indicators\r\n    this.#clearPaymentErrors();\r\n    \r\n    // Check if this is a credit card specific error\r\n    const isCreditCardError = this.#paymentMethod === 'credit-card' && \r\n      (message.includes('card') || message.includes('Card') || message.includes('CVV'));\r\n    \r\n    if (isCreditCardError) {\r\n      // Display error on the credit card field\r\n      this.#displayCreditCardError(message);\r\n    }\r\n    \r\n    // Handle Spreedly errors in the toast handler\r\n    const spreedlyErrorContainer = document.querySelector('[os-checkout-element=\"spreedly-error\"]');\r\n    if (spreedlyErrorContainer) {\r\n      const errorMessageElement = spreedlyErrorContainer.querySelector('[data-os-message=\"error\"]');\r\n      if (errorMessageElement) {\r\n        errorMessageElement.textContent = message;\r\n        spreedlyErrorContainer.style.display = 'flex';\r\n      }\r\n    } else {\r\n      // Fallback to general error container\r\n      const errorContainer = document.querySelector('[os-checkout-element=\"payment-error\"]');\r\n      if (errorContainer) {\r\n        errorContainer.textContent = message;\r\n        errorContainer.style.display = 'block';\r\n        errorContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n      } else {\r\n        alert(`Payment Error: ${message}`);\r\n      }\r\n    }\r\n  }\r\n  \r\n  #displayCreditCardError(message) {\r\n    // Find the credit card field container\r\n    let fieldSelector = '[os-checkout-field=\"cc-number\"]';\r\n    let fieldId = '#credit_card_number';\r\n    \r\n    // Determine which field has the error based on the message\r\n    if (message.toLowerCase().includes('cvv') || message.toLowerCase().includes('security code')) {\r\n      fieldSelector = '[os-checkout-field=\"cc-cvv\"]';\r\n      fieldId = '#credit_card_cvv';\r\n    } else if (message.toLowerCase().includes('expiration') || message.toLowerCase().includes('expired')) {\r\n      fieldSelector = '[os-checkout-field=\"cc-month\"], [os-checkout-field=\"cc-year\"]';\r\n      fieldId = '#credit_card_exp_month, #credit_card_exp_year';\r\n    }\r\n    \r\n    // Find the field container\r\n    const fieldSelectors = fieldSelector.split(',').map(s => s.trim());\r\n    const idSelectors = fieldId.split(',').map(s => s.trim());\r\n    \r\n    // Apply error styling to all matching fields\r\n    [...fieldSelectors, ...idSelectors].forEach(selector => {\r\n      const field = document.querySelector(selector);\r\n      if (!field) return;\r\n      \r\n      const container = field.closest('.form-group') || field.parentElement;\r\n      if (!container) return;\r\n      \r\n      // Add error class to the field\r\n      field.classList.add('is-invalid');\r\n      \r\n      // Create or update error message element\r\n      let errorElement = container.querySelector('.invalid-feedback');\r\n      if (!errorElement) {\r\n        errorElement = document.createElement('div');\r\n        errorElement.className = 'invalid-feedback';\r\n        container.appendChild(errorElement);\r\n      }\r\n      \r\n      errorElement.textContent = message;\r\n      errorElement.style.display = 'block';\r\n    });\r\n    \r\n    // Scroll to the first field with error\r\n    const firstErrorField = document.querySelector(fieldSelectors[0]) || document.querySelector(idSelectors[0]);\r\n    if (firstErrorField) {\r\n      firstErrorField.focus();\r\n      firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n    }\r\n  }\r\n  \r\n  #clearPaymentErrors() {\r\n    // Clear all credit card field errors\r\n    const ccFieldSelectors = [\r\n      '[os-checkout-field=\"cc-number\"]', '#credit_card_number',\r\n      '[os-checkout-field=\"cc-cvv\"]', '#credit_card_cvv',\r\n      '[os-checkout-field=\"cc-month\"]', '#credit_card_exp_month',\r\n      '[os-checkout-field=\"cc-year\"]', '#credit_card_exp_year'\r\n    ];\r\n    \r\n    ccFieldSelectors.forEach(selector => {\r\n      const field = document.querySelector(selector);\r\n      if (!field) return;\r\n      \r\n      field.classList.remove('is-invalid');\r\n      const container = field.closest('.form-group') || field.parentElement;\r\n      if (container) {\r\n        const errorElement = container.querySelector('.invalid-feedback');\r\n        if (errorElement) {\r\n          errorElement.style.display = 'none';\r\n        }\r\n      }\r\n    });\r\n    \r\n    // Clear general error container\r\n    const errorContainer = document.querySelector('[os-checkout-element=\"payment-error\"]');\r\n    if (errorContainer) {\r\n      errorContainer.style.display = 'none';\r\n    }\r\n  }\r\n\r\n  #handleOrderSuccess(orderData) {\r\n    sessionStorage.setItem('order_reference', orderData.ref_id);\r\n    \r\n    // Set pending purchase event flag\r\n    sessionStorage.setItem(`pending_purchase_event_${orderData.ref_id}`, 'true');\r\n    \r\n    // Trigger order.created event for the EventManager\r\n    this.#app?.triggerEvent?.('order.created', orderData);\r\n    \r\n\r\n    // If payment_complete_url exists, use it directly\r\n    // This is primarily for PayPal and other redirect payment flows\r\n    if (orderData.payment_complete_url) {\r\n      this.#safeLog('debug', `Redirecting to payment gateway: ${orderData.payment_complete_url}`);\r\n      window.location.href = orderData.payment_complete_url;\r\n      return;\r\n    }\r\n    \r\n    // Otherwise use the standard redirect approach for completed payments\r\n    const redirectUrl = this.#getRedirectUrl(orderData);\r\n    window.location.href = redirectUrl;\r\n  }\r\n\r\n  #getRedirectUrl(orderData) {\r\n    // If we have ApiClient, use its method for consistency\r\n    if (this.#apiClient) {\r\n      return this.#apiClient.getNextUrlFromOrderResponse(orderData);\r\n    }\r\n    \r\n    // Fallback implementation if ApiClient is not available\r\n    // First check for meta tag (highest priority after payment_complete_url)\r\n    const metaUrl = document.querySelector('meta[name=\"os-next-page\"]')?.content;\r\n    if (metaUrl) {\r\n      const url = metaUrl.startsWith('http') ? \r\n        metaUrl : \r\n        new URL(metaUrl, window.location.origin).href;\r\n      \r\n      return `${url}${url.includes('?') ? '&' : '?'}ref_id=${orderData.ref_id}`;\r\n    }\r\n    \r\n    // Then use order_status_url as the fallback\r\n    if (orderData.order_status_url) {\r\n      return orderData.order_status_url;\r\n    }\r\n    \r\n    // Last resort - use confirmation_url or construct one\r\n    return orderData.confirmation_url || \r\n           `${window.location.origin}/checkout/confirmation/?ref_id=${orderData.ref_id}`;\r\n  }\r\n\r\n  /**\r\n   * Initialize express checkout buttons\r\n   */\r\n  #initExpressCheckout() {\r\n    try {\r\n      // Detect device support for payment methods\r\n      this.#detectDeviceSupport();\r\n\r\n      // Initialize PayPal Express button\r\n      const paypalButton = document.querySelector('[os-checkout-payment=\"paypal\"]');\r\n      if (paypalButton) {\r\n        paypalButton.addEventListener('click', (e) => {\r\n          e.preventDefault();\r\n          this.processExpressCheckout('paypal');\r\n        });\r\n        this.#expressCheckoutButtons.paypal = paypalButton;\r\n      }\r\n\r\n      // Initialize Apple Pay button if supported\r\n      if (this.#deviceSupport.applePay) {\r\n        const applePayButton = document.querySelector('[os-checkout-payment=\"apple-pay\"]');\r\n        if (applePayButton) {\r\n          applePayButton.addEventListener('click', (e) => {\r\n            e.preventDefault();\r\n            this.processExpressCheckout('apple_pay');\r\n          });\r\n          this.#expressCheckoutButtons.applePay = applePayButton;\r\n        }\r\n      } else {\r\n        // Hide Apple Pay button if not supported\r\n        const applePayBtn = document.querySelector('[os-checkout-payment=\"apple-pay\"]');\r\n        if (applePayBtn) {\r\n          applePayBtn.style.display = 'none';\r\n        }\r\n      }\r\n\r\n      // Initialize Google Pay button if supported\r\n      if (this.#deviceSupport.googlePay) {\r\n        const googlePayButton = document.querySelector('[os-checkout-payment=\"google-pay\"]');\r\n        if (googlePayButton) {\r\n          googlePayButton.addEventListener('click', (e) => {\r\n            e.preventDefault();\r\n            this.processExpressCheckout('google_pay');\r\n          });\r\n          this.#expressCheckoutButtons.googlePay = googlePayButton;\r\n        }\r\n      } else {\r\n        // Hide Google Pay button if not supported\r\n        const googlePayBtn = document.querySelector('[os-checkout-payment=\"google-pay\"]');\r\n        if (googlePayBtn) {\r\n          googlePayBtn.style.display = 'none';\r\n        }\r\n      }\r\n\r\n      // Hide the express checkout container if no buttons are active\r\n      if (!this.#hasActiveExpressButtons()) {\r\n        const container = document.querySelector('[os-checkout-container=\"express-checkout\"]');\r\n        if (container) {\r\n          container.style.display = 'none';\r\n        }\r\n      }\r\n\r\n    } catch (error) {\r\n      this.#safeLog('error', 'Error initializing express checkout:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Detect which payment methods are supported by the device/browser\r\n   */\r\n  #detectDeviceSupport() {\r\n    // Check for Apple Pay support\r\n    if (window.ApplePaySession && window.ApplePaySession.canMakePayments) {\r\n      this.#deviceSupport.applePay = window.ApplePaySession.canMakePayments();\r\n      this.#safeLog('debug', `Apple Pay support: ${this.#deviceSupport.applePay}`);\r\n    }\r\n\r\n    // Basic Google Pay support check\r\n    this.#deviceSupport.googlePay = !!(window.chrome && window.chrome.runtime);\r\n    this.#safeLog('debug', `Google Pay support: ${this.#deviceSupport.googlePay}`);\r\n  }\r\n\r\n  /**\r\n   * Check if there are any active express checkout buttons\r\n   * @returns {boolean} True if at least one express button is initialized\r\n   */\r\n  #hasActiveExpressButtons() {\r\n    return !!(\r\n      this.#expressCheckoutButtons.paypal || \r\n      this.#expressCheckoutButtons.applePay || \r\n      this.#expressCheckoutButtons.googlePay\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Process an express checkout payment\r\n   * @param {string} method - Payment method ('paypal', 'apple_pay', 'google_pay')\r\n   */\r\n  processExpressCheckout(method) {\r\n    this.#safeLog('info', `Processing ${method} express checkout`);\r\n    \r\n    // Determine which button to use based on the method\r\n    let button;\r\n    switch (method) {\r\n      case 'paypal':\r\n        button = this.#expressCheckoutButtons.paypal;\r\n        break;\r\n      case 'apple_pay':\r\n        button = this.#expressCheckoutButtons.applePay;\r\n        break;\r\n      case 'google_pay':\r\n        button = this.#expressCheckoutButtons.googlePay;\r\n        break;\r\n      default:\r\n        this.#safeLog('error', `Unknown express checkout method: ${method}`);\r\n        return;\r\n    }\r\n    \r\n    // Show processing state\r\n    this.#setExpressButtonProcessing(button, true);\r\n    \r\n    try {\r\n      // Get cart data from state manager\r\n      const cart = this.#app.state.getState('cart');\r\n      \r\n      if (!cart || !cart.items || cart.items.length === 0) {\r\n        this.#safeLog('error', `Cannot process ${method} checkout: cart is empty`);\r\n        this.#handleExpressCheckoutError('Your cart is empty. Please add items to your cart before checking out.', button);\r\n        return;\r\n      }\r\n\r\n      // Prepare simplified API request for express checkout\r\n      // Express checkout doesn't need user and address information\r\n      const orderData = {\r\n        lines: cart.items.map(item => ({\r\n          package_id: item.id,\r\n          quantity: item.quantity || 1,\r\n          is_upsell: !!item.is_upsell\r\n        })),\r\n        payment_detail: {\r\n          payment_method: method\r\n        },\r\n        attribution: this.#app.attribution?.getAttributionData() || cart.attribution || {},\r\n        shipping_method: (cart.shippingMethod?.id || 1).toString()\r\n      };\r\n\r\n      // Get success_url from meta tag using ApiClient\r\n      if (this.#apiClient) {\r\n        const nextPageUrl = this.#apiClient.getNextPageUrlFromMeta();\r\n        if (nextPageUrl) {\r\n          orderData.success_url = nextPageUrl;\r\n          this.#safeLog('debug', `Express checkout success URL set from meta tag: ${nextPageUrl}`);\r\n        } else {\r\n          this.#safeLog('debug', 'No meta tag found for express checkout success_url, API will use order_status_url');\r\n        }\r\n      }\r\n      \r\n      // Add payment_failed_url to redirect back to current page with error parameters\r\n      const currentUrl = new URL(window.location.href);\r\n      currentUrl.searchParams.set('payment_failed', 'true');\r\n      currentUrl.searchParams.set('payment_method', method);\r\n      orderData.payment_failed_url = currentUrl.href;\r\n      this.#safeLog('debug', `Express checkout payment_failed_url set to: ${orderData.payment_failed_url}`);\r\n\r\n      // Add vouchers if available\r\n      if (cart.vouchers && cart.vouchers.length > 0) {\r\n        // Convert any object vouchers to string codes\r\n        orderData.vouchers = cart.vouchers.map(voucher => {\r\n          if (typeof voucher === 'string') {\r\n            return voucher;\r\n          } else if (voucher && voucher.code) {\r\n            return voucher.code;\r\n          }\r\n          return String(voucher);\r\n        });\r\n        this.#safeLog('debug', `Using vouchers from cart for express checkout: ${JSON.stringify(orderData.vouchers)}`);\r\n      } else if (cart.couponDetails && cart.couponCode) {\r\n        // Just use the coupon code as a string\r\n        orderData.vouchers = [cart.couponCode];\r\n        this.#safeLog('debug', `Using coupon code for express checkout: ${cart.couponCode}`);\r\n      } else if (cart.couponCode) {\r\n        // Backward compatibility for coupon code only\r\n        orderData.vouchers = [cart.couponCode];\r\n        this.#safeLog('debug', `Using legacy coupon code for express checkout: ${cart.couponCode}`);\r\n      }\r\n\r\n      this.#safeLog('debug', 'Express checkout order data:', orderData);\r\n\r\n      // Create order through API\r\n      this.#apiClient.createOrder(orderData)\r\n        .then(response => {\r\n          this.#safeLog('debug', `${method} express checkout order created:`, response);\r\n          \r\n          if (response.payment_complete_url) {\r\n            // Trigger event before redirect\r\n            this.#app.triggerEvent('express.checkout.started', {\r\n              method,\r\n              order: response\r\n            });\r\n            \r\n            // Redirect to payment processor\r\n            window.location.href = response.payment_complete_url;\r\n          } else {\r\n            throw new Error('No payment URL returned from API');\r\n          }\r\n        })\r\n        .catch(error => {\r\n          this.#safeLog('error', `${method} express checkout error:`, error);\r\n          this.#handleExpressCheckoutError(`There was an error processing your ${method.replace('_', ' ')} payment. Please try again or use a different payment method.`, button);\r\n        });\r\n    } catch (error) {\r\n      this.#safeLog('error', `Error in ${method} express checkout:`, error);\r\n      this.#handleExpressCheckoutError('An unexpected error occurred. Please try again.', button);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set express checkout button to processing state\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {boolean} isProcessing - Whether the button is processing\r\n   */\r\n  #setExpressButtonProcessing(button, isProcessing) {\r\n    if (!button) return;\r\n    \r\n    if (isProcessing) {\r\n      button.setAttribute('disabled', 'disabled');\r\n      button.classList.add('processing');\r\n      \r\n      // Store original content and replace with processing indicator\r\n      if (!button.dataset.originalHtml) {\r\n        button.dataset.originalHtml = button.innerHTML;\r\n        const loadingSpinner = document.createElement('div');\r\n        loadingSpinner.className = 'payment-btn-spinner';\r\n        loadingSpinner.innerHTML = '<div class=\"spinner\"></div>';\r\n        button.innerHTML = '';\r\n        button.appendChild(loadingSpinner);\r\n      }\r\n    } else {\r\n      button.removeAttribute('disabled');\r\n      button.classList.remove('processing');\r\n      \r\n      // Restore original content\r\n      if (button.dataset.originalHtml) {\r\n        button.innerHTML = button.dataset.originalHtml;\r\n        delete button.dataset.originalHtml;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle express checkout error\r\n   * @param {string} message - Error message\r\n   * @param {HTMLElement} button - Button element that was clicked\r\n   */\r\n  #handleExpressCheckoutError(message, button) {\r\n    // Reset button state\r\n    this.#setExpressButtonProcessing(button, false);\r\n    \r\n    // Create or update error message\r\n    const container = document.querySelector('.express-checkout-wrapper');\r\n    if (!container) return;\r\n    \r\n    let errorContainer = container.querySelector('.express-checkout-error');\r\n    \r\n    if (!errorContainer) {\r\n      errorContainer = document.createElement('div');\r\n      errorContainer.className = 'express-checkout-error';\r\n      container.appendChild(errorContainer);\r\n    }\r\n    \r\n    errorContainer.textContent = message;\r\n    errorContainer.style.display = 'block';\r\n    \r\n    // Hide error after 5 seconds\r\n    setTimeout(() => {\r\n      errorContainer.style.display = 'none';\r\n    }, 5000);\r\n    \r\n    // Trigger error event\r\n    this.#app.triggerEvent('express.checkout.error', { message });\r\n  }\r\n\r\n  /**\r\n   * Reset processing state for all express checkout buttons\r\n   */\r\n  resetExpressButtons() {\r\n    this.#setExpressButtonProcessing(this.#expressCheckoutButtons.paypal, false);\r\n    this.#setExpressButtonProcessing(this.#expressCheckoutButtons.applePay, false);\r\n    this.#setExpressButtonProcessing(this.#expressCheckoutButtons.googlePay, false);\r\n  }\r\n\r\n  /**\r\n   * Check URL parameters for payment_failed and display appropriate error message\r\n   */\r\n  #checkForPaymentFailedParameters() {\r\n    try {\r\n      const urlParams = new URLSearchParams(window.location.search);\r\n      const paymentFailed = urlParams.get('payment_failed');\r\n      \r\n      if (paymentFailed === 'true') {\r\n        const paymentMethod = urlParams.get('payment_method');\r\n        let errorMessage = 'Your payment could not be processed. Please try again or use a different payment method.';\r\n        \r\n        // Customize message based on payment method\r\n        if (paymentMethod) {\r\n          const methodDisplay = {\r\n            'paypal': 'PayPal',\r\n            'apple_pay': 'Apple Pay',\r\n            'google_pay': 'Google Pay',\r\n            'card_token': 'credit card',\r\n            'credit-card': 'credit card',\r\n            'credit': 'credit card'\r\n          }[paymentMethod] || paymentMethod;\r\n          \r\n          errorMessage = `Your ${methodDisplay} payment could not be processed. Please try again or use a different payment method.`;\r\n        }\r\n        \r\n        // Handle errors from express checkout methods differently\r\n        const isExpressCheckout = ['paypal', 'apple_pay', 'google_pay'].includes(paymentMethod);\r\n        if (isExpressCheckout) {\r\n          this.#displayTopBannerError(errorMessage, paymentMethod);\r\n        } else {\r\n          // Default to credit card error display for card_token or unknown methods\r\n          this.#handlePaymentError(errorMessage);\r\n        }\r\n        \r\n        // Clear the URL parameters to prevent showing the error again on refresh\r\n        const newUrl = new URL(window.location.href);\r\n        newUrl.searchParams.delete('payment_failed');\r\n        newUrl.searchParams.delete('payment_method');\r\n        window.history.replaceState({}, document.title, newUrl.href);\r\n      }\r\n    } catch (error) {\r\n      this.#safeLog('error', 'Error checking payment failed parameters:', error);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Display a prominent error banner at the top of the checkout form\r\n   * @param {string} message - Error message to display\r\n   * @param {string} method - Payment method that failed\r\n   */\r\n  #displayTopBannerError(message, method) {\r\n    try {\r\n      // Check if there's already a top banner error\r\n      let errorBanner = document.querySelector('[os-checkout-element=\"top-error-banner\"]');\r\n      \r\n      if (!errorBanner) {\r\n        // Create the banner\r\n        errorBanner = document.createElement('div');\r\n        errorBanner.setAttribute('os-checkout-element', 'top-error-banner');\r\n        errorBanner.className = 'checkout-error-banner';\r\n        errorBanner.style.width = '100%';\r\n        errorBanner.style.padding = '12px 16px';\r\n        errorBanner.style.backgroundColor = '#fff3cd';\r\n        errorBanner.style.color = '#856404';\r\n        errorBanner.style.borderRadius = '4px';\r\n        errorBanner.style.marginBottom = '20px';\r\n        errorBanner.style.border = '1px solid #ffeeba';\r\n        errorBanner.style.display = 'flex';\r\n        errorBanner.style.alignItems = 'center';\r\n        errorBanner.style.justifyContent = 'space-between';\r\n        \r\n        // Create message div\r\n        const messageDiv = document.createElement('div');\r\n        messageDiv.textContent = message;\r\n        \r\n        // Create close button\r\n        const closeButton = document.createElement('button');\r\n        closeButton.textContent = '×';\r\n        closeButton.style.background = 'none';\r\n        closeButton.style.border = 'none';\r\n        closeButton.style.fontSize = '20px';\r\n        closeButton.style.fontWeight = 'bold';\r\n        closeButton.style.cursor = 'pointer';\r\n        closeButton.style.marginLeft = '10px';\r\n        closeButton.addEventListener('click', () => {\r\n          errorBanner.style.display = 'none';\r\n        });\r\n        \r\n        // Assemble banner\r\n        errorBanner.appendChild(messageDiv);\r\n        errorBanner.appendChild(closeButton);\r\n        \r\n        // Insert banner at the top of the checkout form\r\n        const checkoutForm = this.#form;\r\n        if (checkoutForm) {\r\n          checkoutForm.insertBefore(errorBanner, checkoutForm.firstChild);\r\n        } else {\r\n          // Try to find other common checkout container elements\r\n          const checkoutContainer = \r\n            document.querySelector('[os-checkout-container=\"form\"]') || \r\n            document.querySelector('.checkout-form') ||\r\n            document.querySelector('.checkout-container');\r\n          \r\n          if (checkoutContainer) {\r\n            checkoutContainer.insertBefore(errorBanner, checkoutContainer.firstChild);\r\n          } else {\r\n            // Last resort - add to body\r\n            const mainContent = document.querySelector('main') || document.body;\r\n            mainContent.insertBefore(errorBanner, mainContent.firstChild);\r\n          }\r\n        }\r\n        \r\n        // Scroll to error banner\r\n        errorBanner.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n      } else {\r\n        // Update existing banner\r\n        const messageDiv = errorBanner.querySelector('div');\r\n        if (messageDiv) {\r\n          messageDiv.textContent = message;\r\n        } else {\r\n          errorBanner.textContent = message;\r\n        }\r\n        errorBanner.style.display = 'flex';\r\n        errorBanner.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n      }\r\n      \r\n      this.#safeLog('debug', `Displayed top banner error for ${method}: ${message}`);\r\n    } catch (error) {\r\n      this.#safeLog('error', 'Error displaying top banner error:', error);\r\n      // Fall back to the standard error method\r\n      this.#handlePaymentError(message);\r\n    }\r\n  }\r\n}", "/**\r\n * BillingAddressHandler - Manages the billing address form\r\n * \r\n * This class handles the billing address form functionality, including:\r\n * - Toggle between using shipping address or a different billing address\r\n * - Copying shipping address values to billing fields\r\n * - Showing/hiding the billing form based on user selection\r\n * - Showing/hiding the billing location fields when address is entered\r\n */\r\n\r\nexport class BillingAddressHandler {\r\n  #app;\r\n  #logger;\r\n  #sameAsShippingCheckbox;\r\n  #billingFormContainer;\r\n  #shippingFields = {};\r\n  #billingFields = {};\r\n  #fieldMap = {\r\n    'fname': 'billing-fname',\r\n    'lname': 'billing-lname',\r\n    'address1': 'billing-address1',\r\n    'address2': 'billing-address2',\r\n    'city': 'billing-city',\r\n    'province': 'billing-province',\r\n    'postal': 'billing-postal',\r\n    'country': 'billing-country',\r\n    'phone': 'billing-phone'\r\n  };\r\n  #isTransitioning = false;\r\n  #lastState = null;\r\n  #billingLocationComponent = null;\r\n  #billingAddress1Field = null;\r\n\r\n  constructor(app) {\r\n    this.#app = app;\r\n    \r\n    // Ensure we have a valid logger with all required methods\r\n    if (app?.logger) {\r\n      // If app.logger is a module logger, use it directly\r\n      if (typeof app.logger.debug === 'function' && \r\n          typeof app.logger.info === 'function' && \r\n          typeof app.logger.warn === 'function' && \r\n          typeof app.logger.error === 'function') {\r\n        this.#logger = app.logger;\r\n      } else {\r\n        // Otherwise, try to create a module logger\r\n        this.#logger = app.logger.createModuleLogger ? \r\n          app.logger.createModuleLogger('BILLING') : \r\n          console;\r\n      }\r\n    } else {\r\n      // Fallback to console if no logger is available\r\n      this.#logger = console;\r\n    }\r\n    \r\n    this.#init();\r\n  }\r\n\r\n  #init() {\r\n    try {\r\n      // Find the checkbox for \"same as shipping\" - try multiple possible selectors\r\n      this.#sameAsShippingCheckbox = \r\n        document.querySelector('[os-checkout-field=\"same-as-shipping\"]') || \r\n        document.querySelector('[name=\"use_shipping_address\"]') || \r\n        document.querySelector('#use_shipping_address');\r\n      \r\n      this.#billingFormContainer = document.querySelector('[os-checkout-element=\"different-billing-address\"]');\r\n      \r\n      // Find billing location component (city, state, zip)\r\n      this.#billingLocationComponent = document.querySelector('[data-os-component=\"billing-location\"]');\r\n      \r\n      // Find billing address field for input monitoring\r\n      this.#billingAddress1Field = document.querySelector('[os-checkout-field=\"billing-address1\"]');\r\n      \r\n      if (!this.#sameAsShippingCheckbox) {\r\n        this.#logWarn('Same as shipping checkbox not found. Tried multiple selectors including [name=\"use_shipping_address\"] and #use_shipping_address');\r\n        \r\n        // Log all checkboxes in the form for debugging\r\n        const allCheckboxes = document.querySelectorAll('input[type=\"checkbox\"]');\r\n        this.#logDebug(`Found ${allCheckboxes.length} checkboxes on the page:`);\r\n        allCheckboxes.forEach((checkbox, index) => {\r\n          this.#logDebug(`Checkbox ${index + 1}: id=${checkbox.id}, name=${checkbox.name}, class=${checkbox.className}`);\r\n        });\r\n        \r\n        return;\r\n      }\r\n      \r\n      if (!this.#billingFormContainer) {\r\n        this.#logWarn('Billing form container not found with selector [os-checkout-element=\"different-billing-address\"]');\r\n        \r\n        // Try alternative selector\r\n        this.#billingFormContainer = document.querySelector('.billing_form-container');\r\n        if (this.#billingFormContainer) {\r\n          this.#logInfo('Found billing form container with alternative selector .billing_form-container');\r\n        } else {\r\n          return;\r\n        }\r\n      }\r\n      \r\n      this.#logDebug('BillingAddressHandler initialized');\r\n      \r\n      // Cache all shipping and billing field elements\r\n      this.#cacheFieldElements();\r\n      \r\n      // Set initial state based on checkbox\r\n      this.#lastState = this.#sameAsShippingCheckbox.checked;\r\n      this.#toggleBillingForm(this.#lastState, false);\r\n      \r\n      // Set up billing location visibility\r\n      this.#setupBillingLocationVisibility();\r\n      \r\n      // Add event listeners\r\n      this.#setupEventListeners();\r\n    } catch (error) {\r\n      this.#logError('Error initializing BillingAddressHandler:', error);\r\n    }\r\n  }\r\n\r\n  // Safe logging methods that check if the method exists before calling\r\n  #logDebug(message, ...args) {\r\n    if (typeof this.#logger.debug === 'function') {\r\n      this.#logger.debug(message, ...args);\r\n    } else if (typeof this.#logger.log === 'function') {\r\n      this.#logger.log(message, ...args);\r\n    }\r\n  }\r\n\r\n  #logInfo(message, ...args) {\r\n    if (typeof this.#logger.info === 'function') {\r\n      this.#logger.info(message, ...args);\r\n    } else if (typeof this.#logger.log === 'function') {\r\n      this.#logger.log(message, ...args);\r\n    }\r\n  }\r\n\r\n  #logWarn(message, ...args) {\r\n    if (typeof this.#logger.warn === 'function') {\r\n      this.#logger.warn(message, ...args);\r\n    } else if (typeof this.#logger.log === 'function') {\r\n      this.#logger.log(`WARNING: ${message}`, ...args);\r\n    }\r\n  }\r\n\r\n  #logError(message, error) {\r\n    if (typeof this.#logger.error === 'function') {\r\n      this.#logger.error(message, error);\r\n    } else if (typeof this.#logger.log === 'function') {\r\n      this.#logger.log(`ERROR: ${message}`, error);\r\n    } else {\r\n      console.error(message, error);\r\n    }\r\n  }\r\n\r\n  #setupBillingLocationVisibility() {\r\n    // If we don't have the billing location component or address field, we can't proceed\r\n    if (!this.#billingLocationComponent) {\r\n      this.#logWarn('Billing location component not found with selector [data-os-component=\"billing-location\"]');\r\n      return;\r\n    }\r\n    \r\n    if (!this.#billingAddress1Field) {\r\n      this.#logWarn('Billing address1 field not found with selector [os-checkout-field=\"billing-address1\"]');\r\n      return;\r\n    }\r\n    \r\n    // Set initial state - hide the location component\r\n    this.#billingLocationComponent.classList.add('cc-hidden');\r\n    \r\n    this.#logDebug('Billing location component initially hidden');\r\n  }\r\n\r\n  #cacheFieldElements() {\r\n    // Cache shipping fields\r\n    Object.keys(this.#fieldMap).forEach(shippingField => {\r\n      const element = document.querySelector(`[os-checkout-field=\"${shippingField}\"]`);\r\n      if (element) {\r\n        this.#shippingFields[shippingField] = element;\r\n      }\r\n    });\r\n    \r\n    // Cache billing fields\r\n    Object.values(this.#fieldMap).forEach(billingField => {\r\n      const element = document.querySelector(`[os-checkout-field=\"${billingField}\"]`);\r\n      if (element) {\r\n        this.#billingFields[billingField] = element;\r\n      }\r\n    });\r\n    \r\n    this.#logDebug(`Cached ${Object.keys(this.#shippingFields).length} shipping fields and ${Object.keys(this.#billingFields).length} billing fields`);\r\n  }\r\n\r\n  #setupEventListeners() {\r\n    // Listen for changes to the \"same as shipping\" checkbox\r\n    this.#sameAsShippingCheckbox.addEventListener('change', (e) => {\r\n      if (!this.#isTransitioning) {\r\n        this.#lastState = e.target.checked;\r\n        this.#toggleBillingForm(e.target.checked, true);\r\n        \r\n        // If checked, copy shipping values to billing\r\n        if (e.target.checked) {\r\n          this.copyShippingToBilling();\r\n        }\r\n        \r\n        this.#logDebug(`Billing address changed: ${e.target.checked ? 'Same as shipping' : 'Different from shipping'}`);\r\n      }\r\n    });\r\n    \r\n    // Listen for payment method changes\r\n    document.addEventListener('payment-method-changed', () => {\r\n      if (this.#lastState !== null && !this.#isTransitioning) {\r\n        this.#toggleBillingForm(this.#lastState, false);\r\n        this.#logDebug(`Payment method changed, billing address state: ${this.#lastState ? 'Same as shipping' : 'Different from shipping'}`);\r\n      }\r\n    });\r\n    \r\n    // Listen for address autocomplete showing location fields\r\n    document.addEventListener('location-fields-shown', () => {\r\n      if (this.#billingLocationComponent) {\r\n        this.#showBillingLocationComponent();\r\n        this.#logDebug('Location fields shown by AddressAutocomplete, showing billing location component as well');\r\n      }\r\n    });\r\n    \r\n    // Listen for changes to shipping fields to update billing if \"same as shipping\" is checked\r\n    Object.entries(this.#shippingFields).forEach(([fieldName, element]) => {\r\n      element.addEventListener('change', () => {\r\n        if (this.#sameAsShippingCheckbox.checked) {\r\n          const billingFieldName = this.#fieldMap[fieldName];\r\n          const billingElement = this.#billingFields[billingFieldName];\r\n          \r\n          if (billingElement) {\r\n            billingElement.value = element.value;\r\n            \r\n            // Trigger change event on the billing field\r\n            billingElement.dispatchEvent(new Event('change', { bubbles: true }));\r\n          }\r\n        }\r\n      });\r\n    });\r\n    \r\n    // Set up input handler for billing address1 field\r\n    if (this.#billingAddress1Field && this.#billingLocationComponent) {\r\n      // Show location component when user types in address\r\n      this.#billingAddress1Field.addEventListener('input', () => {\r\n        // Show location component after minimum characters\r\n        if (this.#billingAddress1Field.value.length >= 3) {\r\n          this.#showBillingLocationComponent();\r\n        }\r\n      });\r\n      \r\n      // Set up mutation observer for autocomplete\r\n      this.#setupBillingAddressAutocompleteDetection();\r\n    }\r\n  }\r\n\r\n  #setupBillingAddressAutocompleteDetection() {\r\n    // Create mutation observer to detect when autocomplete fills the address field\r\n    const observer = new MutationObserver((mutations) => {\r\n      mutations.forEach((mutation) => {\r\n        if (mutation.type === 'attributes' && \r\n            (mutation.attributeName === 'value' || mutation.attributeName === 'autocomplete-value')) {\r\n          if (this.#billingAddress1Field.value.length > 0) {\r\n            this.#showBillingLocationComponent();\r\n            this.#logDebug('Autocomplete detected on billing address field');\r\n          }\r\n        }\r\n      });\r\n    });\r\n    \r\n    // Observe changes to the value attribute of the billing address field\r\n    observer.observe(this.#billingAddress1Field, { \r\n      attributes: true, \r\n      attributeFilter: ['value', 'autocomplete-value'] \r\n    });\r\n    \r\n    // Also listen for Google Places API autocomplete events\r\n    document.addEventListener('google-places-autocomplete-filled', (e) => {\r\n      if (e.detail && e.detail.field === 'billing-address1') {\r\n        this.#showBillingLocationComponent();\r\n        this.#logDebug('Google Places autocomplete detected on billing address field');\r\n      }\r\n    });\r\n    \r\n    this.#logDebug('Billing address autocomplete detection set up');\r\n  }\r\n\r\n  #showBillingLocationComponent() {\r\n    if (this.#billingLocationComponent && this.#billingLocationComponent.classList.contains('cc-hidden')) {\r\n      this.#billingLocationComponent.classList.remove('cc-hidden');\r\n      this.#logDebug('Billing location component shown');\r\n    }\r\n  }\r\n\r\n  #toggleBillingForm(isChecked, animate = true) {\r\n    if (!this.#billingFormContainer || this.#isTransitioning) return;\r\n\r\n    this.#isTransitioning = true;\r\n\r\n    if (!this.#billingFormContainer.style.transition) {\r\n      this.#billingFormContainer.style.transition = 'height 0.3s ease-out, opacity 0.3s ease-out';\r\n    }\r\n\r\n    const handleTransitionEnd = (e) => {\r\n      if (e.propertyName === 'height') {\r\n        if (!isChecked) {\r\n          this.#billingFormContainer.style.height = 'auto';\r\n        }\r\n        this.#billingFormContainer.style.overflow = '';\r\n        this.#isTransitioning = false;\r\n        this.#billingFormContainer.removeEventListener('transitionend', handleTransitionEnd);\r\n        \r\n        this.#logDebug(`Billing form transition completed: ${isChecked ? 'collapsed' : 'expanded'}`);\r\n      }\r\n    };\r\n\r\n    if (animate) {\r\n      this.#billingFormContainer.removeEventListener('transitionend', handleTransitionEnd);\r\n      \r\n      if (!isChecked) {\r\n        // Expanding\r\n        this.#billingFormContainer.style.display = 'flex';\r\n        this.#billingFormContainer.style.height = '0px';\r\n        this.#billingFormContainer.style.overflow = 'hidden';\r\n        \r\n        requestAnimationFrame(() => {\r\n          const targetHeight = this.#billingFormContainer.scrollHeight;\r\n          this.#billingFormContainer.style.height = `${targetHeight}px`;\r\n          this.#billingFormContainer.style.opacity = '1';\r\n          \r\n          this.#logDebug(`Expanding billing form to height: ${targetHeight}px`);\r\n        });\r\n        \r\n        this.#billingFormContainer.addEventListener('transitionend', handleTransitionEnd);\r\n      } else {\r\n        // Collapsing\r\n        this.#billingFormContainer.style.height = `${this.#billingFormContainer.scrollHeight}px`;\r\n        this.#billingFormContainer.style.overflow = 'hidden';\r\n        \r\n        requestAnimationFrame(() => {\r\n          this.#billingFormContainer.style.height = '0px';\r\n          this.#billingFormContainer.style.opacity = '0';\r\n          \r\n          this.#logDebug('Collapsing billing form');\r\n        });\r\n        \r\n        this.#billingFormContainer.addEventListener('transitionend', handleTransitionEnd);\r\n        \r\n        this.#billingFormContainer.addEventListener('transitionend', (e) => {\r\n          if (e.propertyName === 'height' && isChecked) {\r\n            this.#billingFormContainer.style.display = 'none';\r\n            this.#logDebug('Billing form hidden after collapse');\r\n          }\r\n        }, { once: true });\r\n      }\r\n    } else {\r\n      // No animation for initial state\r\n      this.#billingFormContainer.style.display = isChecked ? 'none' : 'flex';\r\n      this.#billingFormContainer.style.height = isChecked ? '0' : 'auto';\r\n      this.#billingFormContainer.style.opacity = isChecked ? '0' : '1';\r\n      this.#billingFormContainer.style.overflow = '';\r\n      this.#isTransitioning = false;\r\n      \r\n      this.#logDebug(`Set billing form without animation: ${isChecked ? 'hidden' : 'visible'}`);\r\n    }\r\n  }\r\n\r\n  // Deprecated method - use #toggleBillingForm instead\r\n  #updateBillingFormVisibility() {\r\n    this.#toggleBillingForm(this.#sameAsShippingCheckbox.checked, false);\r\n  }\r\n\r\n  /**\r\n   * Copy shipping address values to billing address fields\r\n   */\r\n  copyShippingToBilling() {\r\n    try {\r\n      Object.entries(this.#shippingFields).forEach(([shippingField, shippingElement]) => {\r\n        const billingFieldName = this.#fieldMap[shippingField];\r\n        const billingElement = this.#billingFields[billingFieldName];\r\n        \r\n        if (billingElement && shippingElement) {\r\n          billingElement.value = shippingElement.value;\r\n          \r\n          // Trigger change event on the billing field\r\n          billingElement.dispatchEvent(new Event('change', { bubbles: true }));\r\n        }\r\n      });\r\n      \r\n      // If address1 is copied and has value, show location component\r\n      if (this.#billingFields['billing-address1'] && \r\n          this.#billingFields['billing-address1'].value && \r\n          this.#billingFields['billing-address1'].value.length > 0) {\r\n        this.#showBillingLocationComponent();\r\n      }\r\n      \r\n      this.#logDebug('Copied shipping address to billing address');\r\n    } catch (error) {\r\n      this.#logError('Error copying shipping to billing:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the billing address data\r\n   * If \"same as shipping\" is checked, returns null to indicate shipping should be used\r\n   * Otherwise returns an object with the billing address fields\r\n   */\r\n  getBillingAddressData() {\r\n    // If same as shipping is checked, return null to indicate shipping should be used\r\n    if (this.#sameAsShippingCheckbox && this.#sameAsShippingCheckbox.checked) {\r\n      return null;\r\n    }\r\n    \r\n    // Otherwise, collect billing address data\r\n    const billingData = {};\r\n    \r\n    Object.entries(this.#billingFields).forEach(([fieldName, element]) => {\r\n      // Convert from billing-fname to fname format for API\r\n      const apiFieldName = fieldName.replace('billing-', '');\r\n      billingData[apiFieldName] = element.value;\r\n    });\r\n    \r\n    return billingData;\r\n  }\r\n\r\n  /**\r\n   * Check if billing address is same as shipping\r\n   * @returns {boolean} Whether billing address is same as shipping\r\n   */\r\n  isSameAsShipping() {\r\n    const isSame = this.#sameAsShippingCheckbox ? this.#sameAsShippingCheckbox.checked : true;\r\n    this.#logDebug(`Billing address is ${isSame ? 'same as' : 'different from'} shipping`);\r\n    return isSame;\r\n  }\r\n}", "/**\r\n * PaymentSelector - Handles payment method selection and form toggling\r\n */\r\n\r\nexport class PaymentSelector {\r\n  #logger;\r\n  #container;\r\n  #radioInputs;\r\n  #forms;\r\n  #activeTransitions = new Map();\r\n  #currentMode = null;\r\n\r\n  constructor(logger) {\r\n    this.#logger = logger;\r\n    this.#container = document.querySelector('[os-payment-mode]');\r\n    this.#radioInputs = document.querySelectorAll('input[name=\"combo_mode\"]');\r\n    this.#forms = document.querySelectorAll('[os-checkout-element$=\"-form\"]');\r\n\r\n    if (this.#container && this.#radioInputs.length > 0) {\r\n      this.#logger.debug('PaymentSelector initialized with elements found');\r\n      this.#init();\r\n    } else {\r\n      this.#logger.warn('PaymentSelector elements not found');\r\n    }\r\n  }\r\n\r\n  #init() {\r\n    const checkedRadio = document.querySelector('input[name=\"combo_mode\"]:checked');\r\n    if (checkedRadio && this.#container) {\r\n      this.#setPaymentMode(checkedRadio.value, false);\r\n    }\r\n\r\n    this.#radioInputs.forEach(radio => \r\n      radio.addEventListener('change', e => this.#setPaymentMode(e.target.value, true))\r\n    );\r\n\r\n    this.#logger.debug('PaymentSelector event listeners attached');\r\n  }\r\n\r\n  #setPaymentMode(mode, animate = true) {\r\n    this.#logger.debug(`Setting payment mode to: ${mode}, animate: ${animate}`);\r\n    \r\n    this.#container?.setAttribute('os-payment-mode', mode);\r\n    this.#currentMode = mode;\r\n\r\n    // Clear os--active from all headers first and add to the selected one\r\n    const creditHeader = this.#container?.querySelector('.cc-header');\r\n    const paypalHeader = this.#container?.querySelector('.paypal-header');\r\n    \r\n    creditHeader?.classList.remove('os--active');\r\n    paypalHeader?.classList.remove('os--active');\r\n\r\n    if (mode === 'credit' && creditHeader) {\r\n        creditHeader.classList.add('os--active');\r\n        this.#logger.debug('Added os--active to .cc-header');\r\n    } else if (mode === 'paypal' && paypalHeader) {\r\n        paypalHeader.classList.add('os--active');\r\n        this.#logger.debug('Added os--active to .paypal-header');\r\n    }\r\n\r\n    this.#forms.forEach(form => {\r\n      form.style.transition = 'none';\r\n      form.offsetHeight; // Force reflow\r\n      form.style.transition = '';\r\n    });\r\n\r\n    this.#forms.forEach(form => {\r\n      const formType = form.getAttribute('os-checkout-element');\r\n      const isSelected = formType === `${mode}-form`;\r\n\r\n      if (this.#activeTransitions.has(form)) {\r\n        const oldHandler = this.#activeTransitions.get(form);\r\n        form.removeEventListener('transitionend', oldHandler);\r\n        this.#activeTransitions.delete(form);\r\n      }\r\n\r\n      if (animate) {\r\n        form.style.display = 'block';\r\n        form.style.overflow = 'hidden';\r\n        const currentHeight = form.scrollHeight;\r\n        form.style.height = `${currentHeight}px`;\r\n        form.offsetHeight; // Force reflow\r\n\r\n        const transitionEndHandler = e => {\r\n          if (e.propertyName === 'height') {\r\n            if (isSelected) {\r\n              form.style.height = 'auto';\r\n              form.style.overflow = '';\r\n            } else {\r\n              form.style.display = 'none';\r\n            }\r\n            this.#activeTransitions.delete(form);\r\n          }\r\n        };\r\n\r\n        this.#activeTransitions.set(form, transitionEndHandler);\r\n        form.addEventListener('transitionend', transitionEndHandler, { once: true });\r\n\r\n        requestAnimationFrame(() => {\r\n          form.style.height = isSelected ? `${form.scrollHeight}px` : '0';\r\n          form.style.opacity = isSelected ? '1' : '0';\r\n        });\r\n      } else {\r\n        form.style.transition = 'none';\r\n        Object.assign(form.style, {\r\n          display: isSelected ? 'block' : 'none',\r\n          height: isSelected ? 'auto' : '0',\r\n          opacity: isSelected ? '1' : '0',\r\n          overflow: ''\r\n        });\r\n        form.offsetHeight; // Force reflow\r\n        form.style.transition = '';\r\n      }\r\n    });\r\n\r\n    document.dispatchEvent(new CustomEvent('payment-method-changed', { detail: { mode } }));\r\n  }\r\n}", "export class AddressAutocomplete {\r\n    #logger;\r\n    #fieldsShown = false;\r\n    #elements;\r\n    #enableAutocomplete;\r\n  \r\n    constructor(logger, options = {}) {\r\n      this.#logger = logger;\r\n      this.#enableAutocomplete = options.enableGoogleMapsAutocomplete !== false;\r\n      \r\n      this.#elements = {\r\n        shipping: {\r\n          address: document.querySelector('[os-checkout-field=\"address1\"]'),\r\n          city: document.querySelector('[os-checkout-field=\"city\"]'),\r\n          state: document.querySelector('[os-checkout-field=\"province\"]'),\r\n          zip: document.querySelector('[os-checkout-field=\"postal\"]'),\r\n          country: document.querySelector('[os-checkout-field=\"country\"]'),\r\n        },\r\n        billing: {\r\n          address: document.querySelector('[os-checkout-field=\"billing-address1\"]'),\r\n          city: document.querySelector('[os-checkout-field=\"billing-city\"]'),\r\n          state: document.querySelector('[os-checkout-field=\"billing-province\"]'),\r\n          zip: document.querySelector('[os-checkout-field=\"billing-postal\"]'),\r\n          country: document.querySelector('[os-checkout-field=\"billing-country\"]'),\r\n        },\r\n        locations: document.querySelectorAll('[data-os-component=\"location\"]'),\r\n      };\r\n  \r\n      this.#logger.info(`AddressAutocomplete initialized (autocomplete ${this.#enableAutocomplete ? 'enabled' : 'disabled'})`);\r\n      this.#hideLocationFields();\r\n      this.#init();\r\n    }\r\n  \r\n    async #init() {\r\n      this.#setupAutofillDetection();\r\n      \r\n      // Skip Google Maps initialization if autocomplete is disabled\r\n      if (!this.#enableAutocomplete) {\r\n        this.#logger.debug('Google Maps autocomplete disabled, using basic field listeners');\r\n        return this.#setupBasicFieldListeners();\r\n      }\r\n      \r\n      await this.#initAutocompleteWithRetry();\r\n    }\r\n  \r\n    #hideLocationFields() {\r\n      if (this.#fieldsShown) return;\r\n      this.#elements.locations.forEach(el => el.classList.add('cc-hidden'));\r\n      this.#logger.debug('Location fields hidden');\r\n    }\r\n  \r\n    #showLocationFields() {\r\n      if (this.#fieldsShown) return;\r\n      this.#elements.locations.forEach(el => el.classList.remove('cc-hidden'));\r\n      this.#fieldsShown = true;\r\n      document.dispatchEvent(new CustomEvent('location-fields-shown'));\r\n      this.#logger.debug('Location fields shown');\r\n    }\r\n  \r\n    #isGoogleMapsAvailable() {\r\n      return !!window.google?.maps?.places;\r\n    }\r\n  \r\n    async #initAutocompleteWithRetry(attempt = 0) {\r\n      // Skip if autocomplete is disabled\r\n      if (!this.#enableAutocomplete) {\r\n        return this.#setupBasicFieldListeners();\r\n      }\r\n      \r\n      if (this.#isGoogleMapsAvailable()) {\r\n        this.#logger.debug('Google Maps API available');\r\n        return this.#initializeAutocomplete();\r\n      }\r\n      if (attempt >= 3) {\r\n        this.#logger.warn('Google Maps API unavailable after 3 attempts');\r\n        return this.#setupBasicFieldListeners();\r\n      }\r\n  \r\n      this.#logger.debug(`Retrying Google Maps check, attempt ${attempt + 1}`);\r\n      await new Promise(resolve => setTimeout(resolve, 1000 * 1.5 ** attempt));\r\n      return this.#initAutocompleteWithRetry(attempt + 1);\r\n    }\r\n  \r\n    #initializeAutocomplete() {\r\n      const { shipping, billing } = this.#elements;\r\n      [shipping, billing].forEach(fields => {\r\n        if (fields.address) {\r\n          this.#setupAutocomplete(fields.address, fields);\r\n          this.#logger.debug(`Autocomplete set up for ${fields.address.getAttribute('os-checkout-field')}`);\r\n        }\r\n      });\r\n    }\r\n  \r\n    #setupAutocomplete(input, fields) {\r\n      try {\r\n        const autocomplete = new google.maps.places.Autocomplete(input, {\r\n          types: ['address'],\r\n          fields: ['address_components', 'formatted_address'],\r\n        });\r\n  \r\n        autocomplete.addListener('place_changed', () => {\r\n          const place = autocomplete.getPlace();\r\n          if (!place.address_components) return;\r\n  \r\n          this.#showLocationFields();\r\n          const components = Object.fromEntries(\r\n            place.address_components.map(c => [c.types[0], { long: c.long_name, short: c.short_name }])\r\n          );\r\n  \r\n          fields.address.value = [components.street_number?.long, components.route?.long].filter(Boolean).join(' ');\r\n          fields.city && (fields.city.value = components.locality?.long ?? '');\r\n          fields.zip && (fields.zip.value = components.postal_code?.long ?? '');\r\n  \r\n          if (fields.country && components.country) {\r\n            const countryCode = components.country.short;\r\n            if (fields.country.value !== countryCode) {\r\n              fields.country.value = countryCode;\r\n              fields.country.dispatchEvent(new Event('change', { bubbles: true }));\r\n              this.#logger.debug(`Country set to ${countryCode}`);\r\n            }\r\n            if (fields.state && components.administrative_area_level_1) {\r\n              this.#setStateWithRetry(fields.state, components.administrative_area_level_1.short);\r\n            }\r\n          }\r\n  \r\n          [fields.address, fields.city, fields.zip].forEach(el => el?.dispatchEvent(new Event('change', { bubbles: true })));\r\n        });\r\n  \r\n        input.addEventListener('blur', () => input.value.length > 10 && this.#showLocationFields());\r\n        input.addEventListener('keydown', e => e.key === 'Enter' && e.preventDefault());\r\n      } catch (error) {\r\n        this.#logger.error('Autocomplete setup failed:', error);\r\n        this.#setupBasicFieldListeners();\r\n      }\r\n    }\r\n  \r\n    async #setStateWithRetry(stateSelect, stateCode, attempt = 0) {\r\n      if (attempt >= 5) {\r\n        this.#logger.warn(`Failed to set state ${stateCode} after 5 attempts`);\r\n        return;\r\n      }\r\n      await new Promise(resolve => setTimeout(resolve, 300 * 1.5 ** attempt));\r\n  \r\n      const hasOption = Array.from(stateSelect.options).some(opt => opt.value === stateCode);\r\n      if (hasOption) {\r\n        stateSelect.value = stateCode;\r\n        stateSelect.dispatchEvent(new Event('change', { bubbles: true }));\r\n        this.#logger.debug(`State set to ${stateCode}`);\r\n      } else {\r\n        this.#setStateWithRetry(stateSelect, stateCode, attempt + 1);\r\n      }\r\n    }\r\n  \r\n    #setupBasicFieldListeners() {\r\n      [this.#elements.shipping.address, this.#elements.billing.address].forEach(field => {\r\n        field?.addEventListener('blur', () => field.value.length > 10 && this.#showLocationFields());\r\n      });\r\n      this.#logger.debug('Basic field listeners set up');\r\n    }\r\n  \r\n    #setupAutofillDetection() {\r\n      const style = document.createElement('style');\r\n      style.textContent = `\r\n        @keyframes onAutoFillStart { from { opacity: 0.99; } to { opacity: 1; } }\r\n        input:-webkit-autofill { animation-name: onAutoFillStart; }\r\n      `;\r\n      document.head.appendChild(style);\r\n  \r\n      const fields = [this.#elements.shipping.address, this.#elements.billing.address].filter(Boolean);\r\n      fields.forEach(field => {\r\n        field.addEventListener('input', () => field.value.length > 10 && this.#showLocationFields());\r\n        field.addEventListener('change', () => field.value.length > 0 && this.#showLocationFields());\r\n        field.addEventListener('animationstart', e => {\r\n          if (e.animationName === 'onAutoFillStart') {\r\n            this.#logger.debug(`Autofill detected on ${field.getAttribute('os-checkout-field')}`);\r\n            this.#showLocationFields();\r\n          }\r\n        });\r\n      });\r\n      this.#logger.debug('Autofill detection initialized');\r\n    }\r\n  }", "export class PhoneInputHandler {\r\n  #logger;\r\n  #intlTelInputAvailable = !!window.intlTelInput;\r\n\r\n  constructor(logger) {\r\n    this.#logger = logger;\r\n\r\n    if (!this.#intlTelInputAvailable) {\r\n      this.#logger.warn('intlTelInput not found, loading dynamically');\r\n      this.#loadIntlTelInput().then(() => this.#initPhoneInputs());\r\n    } else {\r\n      this.#logger.info('intlTelInput available, initializing phone inputs');\r\n      this.#initPhoneInputs();\r\n    }\r\n  }\r\n\r\n  async #loadIntlTelInput() {\r\n    const resources = [\r\n      { tag: 'link', rel: 'stylesheet', href: 'https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css' },\r\n      { tag: 'script', src: 'https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js', async: true },\r\n      { tag: 'script', src: 'https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js', async: true },\r\n    ];\r\n\r\n    await Promise.all(resources.map(({ tag, ...attrs }) => {\r\n      const element = document.createElement(tag);\r\n      Object.assign(element, attrs);\r\n      document.head.appendChild(element);\r\n      return tag === 'link' ? Promise.resolve() : new Promise(resolve => element.onload = resolve);\r\n    }));\r\n\r\n    this.#intlTelInputAvailable = true;\r\n    this.#logger.debug('intlTelInput and utils loaded');\r\n  }\r\n\r\n  #initPhoneInputs() {\r\n    if (!this.#intlTelInputAvailable) return;\r\n\r\n    const phoneInputs = document.querySelectorAll('input[type=\"tel\"]');\r\n    this.#logger.info(`Found ${phoneInputs.length} phone inputs`);\r\n    phoneInputs.forEach((input, i) => this.#initializePhoneInput(input, i + 1));\r\n  }\r\n\r\n  #initializePhoneInput(input, index) {\r\n    try {\r\n      const iti = window.intlTelInput(input, {\r\n        utilsScript: 'https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js',\r\n        separateDialCode: true,\r\n        onlyCountries: ['us'],\r\n        initialCountry: 'us',\r\n        allowDropdown: false,\r\n        dropdownContainer: document.body,\r\n        useFullscreenPopup: true,\r\n        formatOnDisplay: true,\r\n        autoPlaceholder: 'aggressive',\r\n        customContainer: 'iti-tel-input',\r\n        autoFormat: true,\r\n        nationalMode: true\r\n      });\r\n\r\n      input.iti = iti;\r\n      this.#logger.debug(`Phone input ${index} (${input.getAttribute('os-checkout-field') ?? 'unknown'}) initialized`);\r\n\r\n      this.#setupPhoneInputSync(input, iti);\r\n      this.#setupPhoneValidation(input, iti);\r\n\r\n      // Add input event listener for formatting and validation\r\n      input.addEventListener('input', () => {\r\n        const number = input.value.trim();\r\n        \r\n        // Format the number as user types\r\n        if (number) {\r\n          // Remove all non-numeric characters\r\n          const numericValue = number.replace(/\\D/g, '');\r\n          \r\n          // Format according to US pattern (XXX) XXX-XXXX\r\n          let formattedNumber = '';\r\n          if (numericValue.length > 0) {\r\n            if (numericValue.length <= 3) {\r\n              formattedNumber = `(${numericValue}`;\r\n            } else if (numericValue.length <= 6) {\r\n              formattedNumber = `(${numericValue.slice(0, 3)}) ${numericValue.slice(3)}`;\r\n            } else {\r\n              formattedNumber = `(${numericValue.slice(0, 3)}) ${numericValue.slice(3, 6)}-${numericValue.slice(6, 10)}`;\r\n            }\r\n          }\r\n          \r\n          // Only update if the format is different to avoid cursor jumping\r\n          if (input.value !== formattedNumber) {\r\n            // Store cursor position\r\n            const cursorPos = input.selectionStart;\r\n            const oldLength = input.value.length;\r\n            \r\n            // Update value\r\n            input.value = formattedNumber;\r\n            \r\n            // Calculate new cursor position\r\n            if (cursorPos !== null) {\r\n              const newLength = formattedNumber.length;\r\n              const cursorOffset = newLength - oldLength;\r\n              input.setSelectionRange(cursorPos + cursorOffset, cursorPos + cursorOffset);\r\n            }\r\n          }\r\n        }\r\n\r\n        const isValid = iti.isValidNumber();\r\n        const numberType = iti.getNumberType();\r\n        const validationError = iti.getValidationError();\r\n\r\n        // Clear any existing error if the field is empty\r\n        if (!number) {\r\n          this.#clearError(input);\r\n          return;\r\n        }\r\n\r\n        console.group('Phone Number Validation');\r\n        console.log('Number:', number);\r\n        console.log('Is Valid:', isValid);\r\n        console.log('Formatted Number:', iti.getNumber());\r\n        console.log('Number Type:', this.#getNumberTypeName(numberType));\r\n        console.log('Validation Error:', validationError);\r\n        console.groupEnd();\r\n\r\n        this.#logger.debug('Phone validation:', {\r\n          number,\r\n          isValid,\r\n          formattedNumber: iti.getNumber(),\r\n          type: this.#getNumberTypeName(numberType),\r\n          error: validationError\r\n        });\r\n      });\r\n\r\n      // Add blur event for validation and final formatting\r\n      input.addEventListener('blur', () => {\r\n        const number = input.value.trim();\r\n        if (number) {\r\n          const isValid = iti.isValidNumber();\r\n          \r\n          // On blur, ensure the number is in full international format\r\n          if (isValid) {\r\n            input.value = iti.getNumber(intlTelInputUtils.numberFormat.NATIONAL);\r\n          }\r\n          \r\n          console.log('Phone field blur - Final validation:', {\r\n            number,\r\n            isValid,\r\n            formattedNumber: iti.getNumber()\r\n          });\r\n\r\n          if (!isValid) {\r\n            this.#showError(input, 'Please enter a valid US phone number (e.g. 555-555-5555)');\r\n          } else {\r\n            this.#clearError(input);\r\n          }\r\n        }\r\n      });\r\n\r\n    } catch (error) {\r\n      this.#logger.error(`Error initializing phone input ${index}:`, error);\r\n    }\r\n  }\r\n\r\n  #showError(input, message) {\r\n    // Add error class to input\r\n    input.classList.add('error');\r\n    \r\n    // Add error class to iti container\r\n    const itiContainer = input.closest('.iti');\r\n    if (itiContainer) {\r\n      itiContainer.classList.add('error');\r\n      itiContainer.style.border = '1px solid red';\r\n    }\r\n    \r\n    // Find or create error message element\r\n    const wrapper = input.closest('.frm-flds') || input.closest('.form-group');\r\n    let errorElement = wrapper.querySelector('.pb-input-error');\r\n    if (!errorElement) {\r\n      errorElement = document.createElement('div');\r\n      errorElement.className = 'pb-input-error';\r\n      wrapper.appendChild(errorElement);\r\n    }\r\n    \r\n    // Set error message and styles\r\n    errorElement.textContent = message;\r\n    Object.assign(errorElement.style, {\r\n      color: 'red',\r\n      fontSize: '0.875rem',\r\n      marginTop: '0.25rem',\r\n      display: 'block',\r\n      position: 'relative',\r\n      clear: 'both'\r\n    });\r\n  }\r\n\r\n  #clearError(input) {\r\n    // Remove error class from input\r\n    input.classList.remove('error');\r\n    \r\n    // Remove error class from iti container\r\n    const itiContainer = input.closest('.iti');\r\n    if (itiContainer) {\r\n      itiContainer.classList.remove('error');\r\n      itiContainer.style.border = '';\r\n    }\r\n    \r\n    // Remove error message\r\n    const wrapper = input.closest('.frm-flds') || input.closest('.form-group');\r\n    const errorElement = wrapper.querySelector('.pb-input-error');\r\n    if (errorElement) {\r\n      errorElement.remove();\r\n    }\r\n  }\r\n\r\n  // Helper method to convert number type to readable name\r\n  #getNumberTypeName(type) {\r\n    const types = {\r\n      0: 'FIXED_LINE',\r\n      1: 'MOBILE',\r\n      2: 'FIXED_LINE_OR_MOBILE',\r\n      3: 'TOLL_FREE',\r\n      4: 'PREMIUM_RATE',\r\n      5: 'SHARED_COST',\r\n      6: 'VOIP',\r\n      7: 'PERSONAL_NUMBER',\r\n      8: 'PAGER',\r\n      9: 'UAN',\r\n      10: 'UNKNOWN'\r\n    };\r\n    return types[type] || 'UNKNOWN';\r\n  }\r\n\r\n  #setupPhoneInputSync(input, iti) {\r\n    const fieldAttr = input.getAttribute('os-checkout-field');\r\n    if (!fieldAttr) {\r\n      this.#logger.warn('Phone input missing os-checkout-field attribute');\r\n      return;\r\n    }\r\n\r\n    const countrySelect = document.querySelector(\r\n      fieldAttr === 'phone' ? '[os-checkout-field=\"country\"]' : '[os-checkout-field=\"billing-country\"]'\r\n    );\r\n\r\n    if (!countrySelect) {\r\n      this.#logger.warn(`Country select not found for ${fieldAttr}`);\r\n      return;\r\n    }\r\n\r\n    // Set country select to US if it exists\r\n    if (countrySelect.value !== 'US') {\r\n      countrySelect.value = 'US';\r\n      countrySelect.dispatchEvent(new Event('change', { bubbles: true }));\r\n      this.#logger.debug('Country select updated to US');\r\n    }\r\n  }\r\n\r\n  #setupPhoneValidation(input, iti) {\r\n    input.validatePhone = () => !input.value.trim() ? !input.hasAttribute('required') : iti.isValidNumber();\r\n    input.getFormattedNumber = () => iti.getNumber();\r\n\r\n    const form = input.closest('form');\r\n    form?.addEventListener('submit', () => {\r\n      if (input.value.trim() && iti.isValidNumber()) {\r\n        input.value = iti.getNumber();\r\n        this.#logger.debug(`Formatted phone number set to ${input.value} on submit`);\r\n      }\r\n    });\r\n  }\r\n}", "/**\r\n * ProspectCartHandler - Creates carts for users based on form data\r\n * \r\n * This component monitors checkout form fields and creates a cart in the API\r\n * when users fill out their email and other information. This helps with:\r\n * 1. Lead capture for abandoned carts\r\n * 2. Analytics for checkout funnel optimization\r\n * 3. Enabling cart recovery emails\r\n */\r\n\r\nexport class ProspectCartHandler {\r\n  #app;\r\n  #logger;\r\n  #initialized = false;\r\n  #cartCreated = false;\r\n  #cartAttempted = false;\r\n  #beginCheckoutFired = false; // Track if beginCheckout event has been fired\r\n  #debounceTimeout = null;\r\n  #debounceDelay = 3000; // 3 seconds debounce\r\n  #lastFormData = null; // Track the last form data we attempted to use\r\n  \r\n  // Form field selectors\r\n  #selectors = {\r\n    firstName: '[os-checkout-field=\"fname\"]',\r\n    lastName: '[os-checkout-field=\"lname\"]',\r\n    email: '[os-checkout-field=\"email\"]',\r\n    phone: '[os-checkout-field=\"phone\"]',\r\n    address1: '[os-checkout-field=\"address1\"]',\r\n    address2: '[os-checkout-field=\"address2\"]',\r\n    city: '[os-checkout-field=\"city\"]',\r\n    province: '[os-checkout-field=\"province\"]',\r\n    postal: '[os-checkout-field=\"postal\"]',\r\n    country: '[os-checkout-field=\"country\"]'\r\n  };\r\n  \r\n  // Form fields\r\n  #fields = {\r\n    firstName: null,\r\n    lastName: null,\r\n    email: null,\r\n    phone: null,\r\n    address1: null,\r\n    address2: null,\r\n    city: null,\r\n    province: null,\r\n    postal: null,\r\n    country: null\r\n  };\r\n  \r\n  // Email validation regex\r\n  #emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n\r\n  /**\r\n   * Initialize the ProspectCartHandler\r\n   * @param {Object} app - The main application instance\r\n   */\r\n  constructor(app) {\r\n    this.#app = app;\r\n    \r\n    // Create a module-specific logger\r\n    if (this.#app && this.#app.logger) {\r\n      this.#logger = this.#app.logger.createModuleLogger('PROSPECT');\r\n    } else {\r\n      // Create a simple logger fallback\r\n      this.#logger = {\r\n        debug: (message, data) => console.log(`[PROSPECT DEBUG] ${message}`, data !== undefined ? data : ''),\r\n        info: (message, data) => console.info(`[PROSPECT INFO] ${message}`, data !== undefined ? data : ''),\r\n        warn: (message, data) => console.warn(`[PROSPECT WARN] ${message}`, data !== undefined ? data : ''),\r\n        error: (message, data) => console.error(`[PROSPECT ERROR] ${message}`, data !== undefined ? data : '')\r\n      };\r\n    }\r\n    \r\n    // Initialize the component\r\n    this.#init();\r\n  }\r\n  \r\n  /**\r\n   * Initialize the component\r\n   */\r\n  #init() {\r\n    this.#logger.info('Initializing ProspectCartHandler');\r\n    \r\n    // Find form fields\r\n    this.#findFormFields();\r\n    \r\n    // If required fields are found, attach event listeners\r\n    if (this.#fields.email && (this.#fields.firstName || this.#fields.lastName)) {\r\n      this.#attachEventListeners();\r\n      this.#initialized = true;\r\n      this.#logger.info('ProspectCartHandler initialized successfully');\r\n    } else {\r\n      this.#logger.warn('Required form fields not found, ProspectCartHandler not initialized');\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Find form fields in the DOM\r\n   */\r\n  #findFormFields() {\r\n    // Find each form field\r\n    Object.keys(this.#selectors).forEach(field => {\r\n      this.#fields[field] = document.querySelector(this.#selectors[field]);\r\n      \r\n      // Also try with data-os-field attribute if not found\r\n      if (!this.#fields[field]) {\r\n        const altSelector = this.#selectors[field].replace('os-checkout-field', 'data-os-field');\r\n        this.#fields[field] = document.querySelector(altSelector);\r\n      }\r\n      \r\n      // Log if field is found\r\n      if (this.#fields[field]) {\r\n        this.#logger.debug(`Found ${field} field`);\r\n      } else {\r\n        this.#logger.debug(`${field} field not found`);\r\n      }\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Attach event listeners to form fields\r\n   */\r\n  #attachEventListeners() {\r\n    // Attach blur event listeners to key fields\r\n    if (this.#fields.email) {\r\n      this.#fields.email.addEventListener('blur', () => this.#handleFieldChange());\r\n    }\r\n    \r\n    if (this.#fields.firstName) {\r\n      this.#fields.firstName.addEventListener('blur', () => this.#handleFieldChange());\r\n    }\r\n    \r\n    if (this.#fields.lastName) {\r\n      this.#fields.lastName.addEventListener('blur', () => this.#handleFieldChange());\r\n    }\r\n    \r\n    // Listen for form submission to prevent multiple cart creation attempts\r\n    const form = document.querySelector('form[os-checkout=\"form\"]');\r\n    if (form) {\r\n      form.addEventListener('submit', () => {\r\n        // If the form is being submitted, we don't need to create a prospect cart\r\n        this.#cartAttempted = true;\r\n        if (this.#debounceTimeout) {\r\n          clearTimeout(this.#debounceTimeout);\r\n        }\r\n      });\r\n    }\r\n    \r\n    this.#logger.debug('Event listeners attached to form fields');\r\n  }\r\n  \r\n  /**\r\n   * Handle field change event\r\n   */\r\n  #handleFieldChange() {\r\n    // If cart already created or attempted, don't try again\r\n    if (this.#cartCreated || this.#cartAttempted) {\r\n      return;\r\n    }\r\n    \r\n    // Clear any existing timeout\r\n    if (this.#debounceTimeout) {\r\n      clearTimeout(this.#debounceTimeout);\r\n    }\r\n    \r\n    // Check if we should fire the beginCheckout event\r\n    // We do this before the debounce to capture the intent early\r\n    this.#checkAndFireBeginCheckout();\r\n    \r\n    // Set a new timeout to debounce the cart creation\r\n    this.#debounceTimeout = setTimeout(() => {\r\n      this.#checkAndCreateCart();\r\n    }, this.#debounceDelay);\r\n  }\r\n  \r\n  /**\r\n   * Check if we should fire the beginCheckout event\r\n   * and fire it if we haven't already\r\n   */\r\n  #checkAndFireBeginCheckout() {\r\n    // If we've already fired the event, don't fire it again\r\n    if (this.#beginCheckoutFired) {\r\n      return;\r\n    }\r\n    \r\n    // Check if we have enough information to consider this a checkout start\r\n    const hasEmail = this.#fields.email && \r\n                    this.#fields.email.value && \r\n                    this.#fields.email.value.trim().length > 0;\r\n                    \r\n    const hasName = (this.#fields.firstName && this.#fields.firstName.value && \r\n                    this.#fields.firstName.value.trim().length > 0) || \r\n                    (this.#fields.lastName && this.#fields.lastName.value && \r\n                    this.#fields.lastName.value.trim().length > 0);\r\n    \r\n    // If the user has entered an email or name, consider it a checkout start\r\n    if (hasEmail || hasName) {\r\n      this.#logger.debug('User has started entering checkout information, firing beginCheckout event');\r\n      \r\n      // Fire the beginCheckout event\r\n      if (this.#app.events) {\r\n        this.#app.events.beginCheckout();\r\n        this.#beginCheckoutFired = true;\r\n        this.#logger.info('beginCheckout event fired');\r\n      }\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Check if we have enough information to create a cart\r\n   * and create it if we do\r\n   */\r\n  #checkAndCreateCart() {\r\n    // If cart already created or attempted, don't create another one\r\n    if (this.#cartCreated || this.#cartAttempted) {\r\n      this.#logger.debug('Cart already created or attempted, skipping');\r\n      return;\r\n    }\r\n    \r\n    // Check if we have enough information to create a cart\r\n    if (!this.#hasMinimumRequiredFields()) {\r\n      this.#logger.debug('Not enough information to create a cart');\r\n      return;\r\n    }\r\n    \r\n    // Check if the form data has changed since our last attempt\r\n    const currentFormData = this.#getFormData();\r\n    if (this.#lastFormData && this.#isSameFormData(currentFormData, this.#lastFormData)) {\r\n      this.#logger.debug('Form data has not changed since last attempt, skipping');\r\n      return;\r\n    }\r\n    \r\n    // Store the current form data\r\n    this.#lastFormData = currentFormData;\r\n    \r\n    // Mark that we've attempted to create a cart\r\n    this.#cartAttempted = true;\r\n    \r\n    // Create the cart\r\n    this.#createProspectCart();\r\n  }\r\n  \r\n  /**\r\n   * Check if we have the minimum required fields to create a cart\r\n   * @returns {boolean} Whether we have the minimum required fields\r\n   */\r\n  #hasMinimumRequiredFields() {\r\n    // We need a valid email\r\n    const hasValidEmail = this.#fields.email && \r\n                         this.#fields.email.value && \r\n                         this.#emailRegex.test(this.#fields.email.value);\r\n    \r\n    if (!hasValidEmail) {\r\n      this.#logger.debug('Email is missing or invalid');\r\n      return false;\r\n    }\r\n    \r\n    // We need at least one name field (first or last)\r\n    const hasFirstName = this.#fields.firstName && \r\n                        this.#fields.firstName.value && \r\n                        this.#fields.firstName.value.trim().length >= 2;\r\n    \r\n    const hasLastName = this.#fields.lastName && \r\n                       this.#fields.lastName.value && \r\n                       this.#fields.lastName.value.trim().length >= 2;\r\n    \r\n    if (!hasFirstName && !hasLastName) {\r\n      this.#logger.debug('First name and last name are missing or too short');\r\n      return false;\r\n    }\r\n    \r\n    this.#logger.debug('Minimum required fields are present');\r\n    return true;\r\n  }\r\n  \r\n  /**\r\n   * Get the current form data\r\n   * @returns {Object} The form data\r\n   */\r\n  #getFormData() {\r\n    const data = {};\r\n    \r\n    // Get values from all fields\r\n    Object.keys(this.#fields).forEach(field => {\r\n      if (this.#fields[field]) {\r\n        data[field] = this.#fields[field].value;\r\n      }\r\n    });\r\n    \r\n    return data;\r\n  }\r\n  \r\n  /**\r\n   * Check if two form data objects are the same\r\n   * @param {Object} data1 - The first form data object\r\n   * @param {Object} data2 - The second form data object\r\n   * @returns {boolean} Whether the form data objects are the same\r\n   */\r\n  #isSameFormData(data1, data2) {\r\n    // Check if the required fields are the same\r\n    return data1.email === data2.email && \r\n           data1.firstName === data2.firstName && \r\n           data1.lastName === data2.lastName;\r\n  }\r\n  \r\n  /**\r\n   * Create a prospect cart\r\n   */\r\n  #createProspectCart() {\r\n    this.#logger.info('Creating prospect cart');\r\n    \r\n    // Get cart data from StateManager\r\n    const cartData = this.#app.state.getState('cart');\r\n    \r\n    // If cart has no lines, don't create a cart\r\n    if (!cartData || !cartData.items || cartData.items.length === 0) {\r\n      this.#logger.warn('No cart items available, skipping cart creation');\r\n      this.#cartAttempted = false; // Reset so we can try again later\r\n      return;\r\n    }\r\n    \r\n    // Get attribution data from state - it's already initialized and stored\r\n    const attributionData = cartData.attribution || {};\r\n    this.#logger.debug('Using attribution data from state', attributionData);\r\n    \r\n    // Get user information\r\n    const firstName = this.#fields.firstName ? this.#fields.firstName.value : '';\r\n    const lastName = this.#fields.lastName ? this.#fields.lastName.value : '';\r\n    const email = this.#fields.email ? this.#fields.email.value : '';\r\n    const phone = this.#getPhoneNumber();\r\n    \r\n    // Update user state with user information\r\n    this.#updateUserState(email, firstName, lastName, phone);\r\n    \r\n    // Create cart data object with essential information\r\n    const prospectCartData = {\r\n      lines: cartData.items.map(item => {\r\n        // Create the line item with required properties\r\n        const lineItem = {\r\n          package_id: item.id,\r\n          quantity: item.quantity || 1\r\n        };\r\n        \r\n        // Preserve is_upsell flag if it exists\r\n        if (item.is_upsell === true) {\r\n          lineItem.is_upsell = true;\r\n          this.#logger.debug(`Adding upsell item to prospect cart: ${item.id}`);\r\n        }\r\n        \r\n        return lineItem;\r\n      }),\r\n      user: {\r\n        first_name: firstName,\r\n        last_name: lastName,\r\n        email: email\r\n      },\r\n      attribution: attributionData\r\n    };\r\n\r\n    // Only add phone number if it's valid\r\n    if (phone) {\r\n      prospectCartData.user.phone_number = phone;\r\n    } else {\r\n      this.#logger.warn('Invalid phone number format - sending cart without phone number');\r\n    }\r\n    \r\n    // Add shipping method if available\r\n    if (cartData.shippingMethod) {\r\n      prospectCartData.shipping_method = cartData.shippingMethod.code || cartData.shippingMethod.id;\r\n    }\r\n    \r\n    // Only add address data if it's complete and valid\r\n    const addressData = this.#getValidAddressData();\r\n    if (addressData && Object.keys(addressData).length > 0) {\r\n      // Check if we have a valid address (with valid postal code if country is provided)\r\n      if (this.#isAddressValid(addressData)) {\r\n        this.#logger.debug('Adding valid address data to cart');\r\n        prospectCartData.address = addressData;\r\n      } else {\r\n        this.#logger.info('Address data is incomplete or invalid - sending cart with user info only');\r\n      }\r\n    } else {\r\n      this.#logger.debug('No address data available - sending cart with user info only');\r\n    }\r\n    \r\n    // Create the cart via API\r\n    this.#createCartViaApi(prospectCartData);\r\n  }\r\n  \r\n  /**\r\n   * Update user state with user information\r\n   * @param {string} email - User's email\r\n   * @param {string} firstName - User's first name\r\n   * @param {string} lastName - User's last name\r\n   * @param {string} phone - User's phone number\r\n   */\r\n  #updateUserState(email, firstName, lastName, phone) {\r\n    if (!this.#app.state) {\r\n      this.#logger.warn('State manager not available, cannot update user state');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      // Get current user state\r\n      const currentUser = this.#app.state.getState('user') || {};\r\n      \r\n      // Update user state with new information\r\n      const updatedUser = {\r\n        ...currentUser,\r\n        email: email || currentUser.email,\r\n        firstName: firstName || currentUser.firstName,\r\n        lastName: lastName || currentUser.lastName,\r\n        phone: phone || currentUser.phone\r\n      };\r\n      \r\n      // Set the updated user state\r\n      this.#app.state.setState('user', updatedUser);\r\n      this.#logger.debug('Updated user state with user information', updatedUser);\r\n    } catch (error) {\r\n      this.#logger.error('Error updating user state:', error);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Check if address data is valid\r\n   * @param {Object} address - The address data\r\n   * @returns {boolean} Whether the address is valid\r\n   */\r\n  #isAddressValid(address) {\r\n    // If we have a country but no postal code, or an invalid postal code, the address is invalid\r\n    if (address.country === 'US' && (!address.postcode || !this.#isValidPostalCode(address.postcode, 'US'))) {\r\n      this.#logger.warn('US address requires a valid postal code');\r\n      return false;\r\n    }\r\n    \r\n    // For other countries, we're less strict\r\n    return true;\r\n  }\r\n  \r\n  /**\r\n   * Get address data from form fields, validating postal code if present\r\n   * @returns {Object} The validated address data\r\n   */\r\n  #getValidAddressData() {\r\n    // Get country and postal code first to check validity\r\n    const country = this.#fields.country && this.#fields.country.value ? \r\n                   this.#fields.country.value : '';\r\n    \r\n    const postalCode = this.#fields.postal && this.#fields.postal.value ? \r\n                      this.#fields.postal.value : '';\r\n    \r\n    // For US addresses, if postal code is invalid, don't include any address data\r\n    if (country === 'US' && postalCode && !this.#isValidPostalCode(postalCode, country)) {\r\n      this.#logger.warn(`Invalid postal code for US: ${postalCode} - omitting all address data`);\r\n      return null;\r\n    }\r\n    \r\n    // Only include address fields that have values\r\n    const address = {};\r\n    \r\n    // Add name and phone to address if available\r\n    if (this.#fields.firstName && this.#fields.firstName.value) {\r\n      address.first_name = this.#fields.firstName.value;\r\n    }\r\n    \r\n    if (this.#fields.lastName && this.#fields.lastName.value) {\r\n      address.last_name = this.#fields.lastName.value;\r\n    }\r\n    \r\n    const phone = this.#getPhoneNumber();\r\n    if (phone) {\r\n      address.phone_number = phone;\r\n    }\r\n    \r\n    // Add optional address fields if they have values\r\n    if (this.#fields.address1 && this.#fields.address1.value) {\r\n      address.line1 = this.#fields.address1.value;\r\n    }\r\n    \r\n    if (this.#fields.address2 && this.#fields.address2.value) {\r\n      address.line2 = this.#fields.address2.value;\r\n    }\r\n    \r\n    if (this.#fields.city && this.#fields.city.value) {\r\n      address.line4 = this.#fields.city.value; // City\r\n    }\r\n    \r\n    if (this.#fields.province && this.#fields.province.value) {\r\n      address.state = this.#fields.province.value;\r\n    }\r\n    \r\n    // Add country and postal code if available and valid\r\n    if (country) {\r\n      address.country = country;\r\n    }\r\n    \r\n    if (postalCode && (!country || this.#isValidPostalCode(postalCode, country))) {\r\n      address.postcode = postalCode;\r\n    }\r\n    \r\n    return address;\r\n  }\r\n  \r\n  /**\r\n   * Check if a postal code is valid for a country\r\n   * @param {string} postalCode - The postal code to validate\r\n   * @param {string} country - The country code\r\n   * @returns {boolean} Whether the postal code is valid\r\n   */\r\n  #isValidPostalCode(postalCode, country) {\r\n    // Skip validation if no postal code or country\r\n    if (!postalCode || !country) {\r\n      return true;\r\n    }\r\n    \r\n    // Validate based on country\r\n    switch (country.toUpperCase()) {\r\n      case 'US':\r\n        // US postal codes should be 5 digits or 5+4 digits\r\n        return /^\\d{5}(-\\d{4})?$/.test(postalCode);\r\n        \r\n      case 'CA':\r\n        // Canadian postal codes: A1A 1A1\r\n        return /^[A-Za-z]\\d[A-Za-z][ -]?\\d[A-Za-z]\\d$/.test(postalCode);\r\n        \r\n      case 'GB':\r\n      case 'UK':\r\n        // UK postal codes are complex but generally follow this pattern\r\n        return /^[A-Z]{1,2}[0-9][A-Z0-9]? ?[0-9][A-Z]{2}$/i.test(postalCode);\r\n        \r\n      case 'AU':\r\n        // Australian postal codes are 4 digits\r\n        return /^\\d{4}$/.test(postalCode);\r\n        \r\n      case 'NZ':\r\n        // New Zealand postal codes are 4 digits\r\n        return /^\\d{4}$/.test(postalCode);\r\n        \r\n      case 'DE':\r\n        // German postal codes are 5 digits\r\n        return /^\\d{5}$/.test(postalCode);\r\n        \r\n      case 'FR':\r\n        // French postal codes are 5 digits\r\n        return /^\\d{5}$/.test(postalCode);\r\n        \r\n      // Add more countries as needed\r\n        \r\n      default:\r\n        // For other countries, accept any non-empty string\r\n        // The API will validate if needed\r\n        return postalCode.trim().length > 0;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Get phone number from field, handling international format\r\n   * @returns {string} The phone number\r\n   */\r\n  #getPhoneNumber() {\r\n    if (!this.#fields.phone) return '';\r\n    \r\n    // Check if we have an international telephone input instance\r\n    if (this.#fields.phone.iti && typeof this.#fields.phone.iti.getNumber === 'function') {\r\n      const number = this.#fields.phone.iti.getNumber();\r\n      // Only return the number if it's valid\r\n      if (this.#fields.phone.iti.isValidNumber()) {\r\n        return number;\r\n      }\r\n      return ''; // Return empty string if invalid\r\n    }\r\n    \r\n    // If no international telephone input, validate the number format\r\n    const value = this.#fields.phone.value;\r\n    if (!value) return '';\r\n    \r\n    // Basic phone number validation\r\n    const phoneRegex = /^\\+?[1-9]\\d{1,14}$/;\r\n    return phoneRegex.test(value.replace(/\\D/g, '')) ? value : '';\r\n  }\r\n  \r\n  /**\r\n   * Create a cart via the API\r\n   * @param {Object} cartData - The cart data\r\n   */\r\n  #createCartViaApi(cartData) {\r\n    // Check if we have access to the API client\r\n    if (!this.#app.api || typeof this.#app.api.createCart !== 'function') {\r\n      this.#logger.error('API client not available');\r\n      this.#cartAttempted = false; // Reset so we can try again later\r\n      return;\r\n    }\r\n    \r\n    // Log the cart data being sent\r\n    this.#logger.debug('Sending cart data to API', cartData);\r\n    \r\n    // Create the cart\r\n    this.#app.api.createCart(cartData)\r\n      .then(response => {\r\n        this.#logger.info('Prospect cart created successfully', response);\r\n        this.#cartCreated = true;\r\n        \r\n        // Trigger prospect cart created event\r\n        if (this.#app.events) {\r\n          this.#app.events.trigger('prospect.cartCreated', {\r\n            cart: response\r\n          });\r\n          \r\n          // Trigger begin_checkout event for analytics if not already fired\r\n          if (!this.#beginCheckoutFired) {\r\n            this.#logger.info('Triggering beginCheckout event for analytics');\r\n            this.#app.events.beginCheckout();\r\n            this.#beginCheckoutFired = true;\r\n          } else {\r\n            this.#logger.debug('beginCheckout event already fired, skipping');\r\n          }\r\n        }\r\n      })\r\n      .catch(error => {\r\n        this.#logger.error('Error creating prospect cart', error);\r\n        // Reset the attempted flag so we can try again later with different data\r\n        this.#cartAttempted = false;\r\n      });\r\n  }\r\n  \r\n  /**\r\n   * Manually trigger the beginCheckout event\r\n   * This can be called from outside the class if needed\r\n   */\r\n  triggerBeginCheckout() {\r\n    if (this.#app && this.#app.events) {\r\n      // Only fire if not already fired\r\n      if (!this.#beginCheckoutFired) {\r\n        this.#logger.info('Manually triggering beginCheckout event');\r\n        this.#app.events.beginCheckout();\r\n        this.#beginCheckoutFired = true;\r\n        return true;\r\n      } else {\r\n        this.#logger.debug('beginCheckout event already fired, skipping');\r\n        return false;\r\n      }\r\n    } else {\r\n      this.#logger.warn('Cannot trigger beginCheckout event: Events manager not available');\r\n      return false;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Reset the beginCheckout flag\r\n   * This can be used if the user clears the form or starts over\r\n   */\r\n  resetBeginCheckoutFlag() {\r\n    this.#beginCheckoutFired = false;\r\n    this.#logger.debug('Reset beginCheckout flag');\r\n    return true;\r\n  }\r\n} ", "/**\r\n * ShippingSelector - Handles shipping method selection UI on the checkout page.\r\n */\r\n\r\nexport class ShippingSelector {\r\n  #app;\r\n  #logger;\r\n  #container;\r\n  #shippingMethods; // Collection of { element, input, id }\r\n\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#logger = app.logger.createModuleLogger('SHIPPING_SELECTOR');\r\n    this.#container = document.querySelector('[os-component=\"shipping-mode\"]');\r\n    \r\n    if (!this.#container) {\r\n      this.#logger.warn('Shipping selector container [os-component=\"shipping-mode\"] not found.');\r\n      return;\r\n    }\r\n    \r\n    this.#shippingMethods = this.#findShippingMethods();\r\n    \r\n    if (this.#shippingMethods.length > 0) {\r\n      this.#logger.debug(`Found ${this.#shippingMethods.length} shipping methods.`);\r\n      this.#init();\r\n    } else {\r\n      this.#logger.warn('No shipping methods found within the container.');\r\n    }\r\n  }\r\n\r\n  #findShippingMethods() {\r\n    const methods = [];\r\n    this.#container.querySelectorAll('.shipping-method').forEach(methodElement => {\r\n      const input = methodElement.querySelector('input[name=\"shipping_method\"][type=\"radio\"]');\r\n      if (input) {\r\n        methods.push({\r\n          element: methodElement,\r\n          input: input,\r\n          id: input.value // Assuming the value attribute holds the shipping method ID\r\n        });\r\n      } else {\r\n        this.#logger.warn('Shipping method element found without a radio input.', methodElement);\r\n      }\r\n    });\r\n    return methods;\r\n  }\r\n\r\n  #init() {\r\n    // Add change event listeners\r\n    this.#shippingMethods.forEach(method => {\r\n      method.input.addEventListener('change', () => this.#handleShippingChange(method.id));\r\n    });\r\n\r\n    // Sync initial state with cart\r\n    this.#syncWithCartState();\r\n\r\n    // Listen for cart updates to keep UI in sync\r\n    this.#app.state.subscribe('cart.shippingMethod', () => this.#syncWithCartState());\r\n\r\n    this.#logger.debug('ShippingSelector initialized and event listeners attached.');\r\n  }\r\n\r\n  #handleShippingChange(shippingMethodId) {\r\n    this.#logger.info(`Shipping method selected via UI: ${shippingMethodId}`);\r\n    try {\r\n      // Update the cart state\r\n      this.#app.cart.setShippingMethod(shippingMethodId);\r\n      // Note: The UI update will happen automatically via the state subscription (#syncWithCartState)\r\n    } catch (error) {\r\n      this.#logger.error(`Failed to set shipping method ${shippingMethodId}:`, error);\r\n      // Optionally: Revert UI selection or show an error to the user\r\n      this.#syncWithCartState(); // Re-sync UI to the actual cart state\r\n    }\r\n  }\r\n\r\n  #syncWithCartState() {\r\n    const currentShippingMethod = this.#app.state.getState('cart.shippingMethod');\r\n    const currentShippingId = currentShippingMethod?.ref_id?.toString(); // Use ref_id from the full object\r\n\r\n    this.#logger.debug(`Syncing UI with cart state. Current shipping ID: ${currentShippingId}`);\r\n\r\n    this.#shippingMethods.forEach(method => {\r\n      const isSelected = method.id === currentShippingId;\r\n      method.element.classList.toggle('os--active', isSelected);\r\n      // Ensure the correct radio button is checked visually\r\n      if (method.input.checked !== isSelected) {\r\n        method.input.checked = isSelected;\r\n      }\r\n      this.#logger.debug(`Method ID ${method.id}: selected=${isSelected}, input.checked=${method.input.checked}`);\r\n    });\r\n  }\r\n} ", "/**\r\n * CheckoutPage - Handles checkout page functionality\r\n * \r\n * This class is responsible for initializing and managing the checkout page,\r\n * including form validation, payment processing, and address handling.\r\n */\r\n\r\nimport { AddressHandler } from '../components/checkout/AddressHandler.js';\r\nimport { FormValidator } from '../components/checkout/FormValidator.js';\r\nimport { PaymentHandler } from '../components/checkout/PaymentHandler.js';\r\nimport { BillingAddressHandler } from '../components/checkout/BillingAddressHandler.js';\r\nimport { PaymentSelector } from '../components/checkout/PaymentSelector.js';\r\nimport { AddressAutocomplete } from '../components/checkout/AddressAutocomplete.js';\r\nimport { PhoneInputHandler } from '../components/checkout/PhoneInputHandler.js';\r\nimport { ProspectCartHandler } from '../components/checkout/ProspectCartHandler.js';\r\nimport { ShippingSelector } from '../components/checkout/ShippingSelector.js';\r\nimport { KonamiCodeHandler } from '../utils/KonamiCodeHandler.js';\r\n\r\nexport class CheckoutPage {\r\n  #apiClient;\r\n  #logger;\r\n  #form;\r\n  #app;\r\n  #konamiCodeHandler;\r\n\r\n  constructor(apiClient, logger, app) {\r\n    this.#apiClient = apiClient;\r\n    this.#logger = logger;\r\n    this.#app = app; // Store the app instance for use with ProspectCartHandler\r\n    this.#form = document.querySelector('form[os-checkout=\"form\"]') || document.querySelector('form#combo_form');\r\n    \r\n    if (!this.#form) {\r\n      this.#logger.warn('No checkout form found with [os-checkout=\"form\"] selector or form#combo_form');\r\n      return;\r\n    }\r\n    \r\n    // CRITICAL: Remove any action and set method to post to prevent URL serialization\r\n    this.#form.removeAttribute('action');\r\n    this.#form.setAttribute('method', 'post');\r\n    this.#form.setAttribute('novalidate', 'novalidate');\r\n    \r\n    // Add a hidden input to indicate JavaScript is enabled\r\n    const hiddenInput = document.createElement('input');\r\n    hiddenInput.type = 'hidden';\r\n    hiddenInput.name = 'js_enabled';\r\n    hiddenInput.value = 'true';\r\n    this.#form.appendChild(hiddenInput);\r\n    \r\n    // Add a hidden input to prevent serialization\r\n    const preventSerializationInput = document.createElement('input');\r\n    preventSerializationInput.type = 'hidden';\r\n    preventSerializationInput.name = 'prevent_serialization';\r\n    preventSerializationInput.value = 'true';\r\n    this.#form.appendChild(preventSerializationInput);\r\n    \r\n    // Add multiple layers of form submission prevention\r\n    const preventSubmit = (e) => {\r\n      if (e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        e.stopImmediatePropagation();\r\n      }\r\n      \r\n      // Ensure form doesn't have action and has post method\r\n      this.#form.removeAttribute('action');\r\n      this.#form.setAttribute('method', 'post');\r\n      \r\n      // Cancel any form submission that might be in progress\r\n      if (typeof window.stop === 'function') {\r\n        window.stop();\r\n      }\r\n      \r\n      this.#logger.debug('Form direct submission prevented');\r\n      return false;\r\n    };\r\n    \r\n    this.#form.addEventListener('submit', preventSubmit, true);\r\n    this.#form.onsubmit = preventSubmit;\r\n    \r\n    // Disable all submit buttons in the form\r\n    this.#disableSubmitButtons();\r\n    \r\n    this.#logger.debug('CheckoutPage initialized with form found');\r\n    this.#initializeComponents();\r\n    \r\n    // Initialize Konami code handler\r\n    this.#initKonamiCodeHandler();\r\n  }\r\n\r\n  #initializeComponents() {\r\n    try {\r\n      // First, fix the billing form by duplicating shipping form fields\r\n      this.#injectBillingFormFields();\r\n      \r\n      // Initialize components one by one with proper error handling\r\n      this.#initAddressHandler();\r\n      this.#initBillingAddressHandler();\r\n      this.#initPaymentSelector();\r\n      this.#initFormValidator();\r\n      this.#initPaymentHandler();\r\n      this.#initShippingSelector();\r\n      this.#initAddressAutocomplete();\r\n      this.#initPhoneInputHandler();\r\n      this.#initProspectCartHandler();\r\n      \r\n      this.#setupEventListeners();\r\n      \r\n      document.dispatchEvent(new CustomEvent('os:checkout.ready', {\r\n        detail: { checkoutPage: this }\r\n      }));\r\n      \r\n      this.#logger.info('Checkout page components initialized successfully');\r\n    } catch (error) {\r\n      this.#logger.error('Error initializing checkout components', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize the Konami code handler\r\n   */\r\n  #initKonamiCodeHandler() {\r\n    try {\r\n      // Create a new KonamiCodeHandler instance with a callback to trigger the Easter egg\r\n      this.#konamiCodeHandler = new KonamiCodeHandler({\r\n        callback: () => this.#triggerKonamiCodeEasterEgg(),\r\n        logger: this.#logger\r\n      });\r\n      \r\n      this.#logger.debug('Konami code handler initialized');\r\n    } catch (error) {\r\n      this.#logger.error('Error initializing Konami code handler:', error);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Trigger the Konami code Easter egg - create a test order with predefined data\r\n   */\r\n  #triggerKonamiCodeEasterEgg() {\r\n    try {\r\n      this.#logger.info('🎮 Konami code activated! Creating test order...');\r\n      \r\n      // Show the activation message\r\n      const messageElement = KonamiCodeHandler.showActivationMessage();\r\n      \r\n      // Process the test payment after a short delay\r\n      setTimeout(() => {\r\n        // Remove the message\r\n        document.body.removeChild(messageElement);\r\n        \r\n        // Process the test payment\r\n        if (this.paymentHandler) {\r\n          // Set Konami test mode\r\n          KonamiCodeHandler.setTestMode();\r\n          \r\n          // Process the payment - the payment handler will detect the Konami test mode\r\n          this.paymentHandler.processPayment();\r\n          \r\n          this.#logger.info('Konami code test order initiated');\r\n        } else {\r\n          this.#logger.error('Payment handler not initialized, cannot create test order');\r\n          alert('Could not create test order: Payment handler not initialized');\r\n        }\r\n      }, 2000);\r\n    } catch (error) {\r\n      this.#logger.error('Error triggering Konami code Easter egg:', error);\r\n    }\r\n  }\r\n\r\n  #initAddressHandler() {\r\n    try {\r\n      this.addressHandler = new AddressHandler(this.#form, this.#logger);\r\n    } catch (error) {\r\n      this.#logger.error('Error initializing AddressHandler', error);\r\n    }\r\n  }\r\n\r\n  #initBillingAddressHandler() {\r\n    try {\r\n      this.billingAddressHandler = new BillingAddressHandler(this.#app);\r\n      \r\n      // Store the billing address handler on the form for access by other components\r\n      if (this.#form && this.billingAddressHandler) {\r\n        this.#form.__billingAddressHandler = this.billingAddressHandler;\r\n        this.#logger.debug('BillingAddressHandler initialized and attached to form');\r\n      }\r\n    } catch (error) {\r\n      this.#logger.error('Error initializing BillingAddressHandler', error);\r\n    }\r\n  }\r\n\r\n  #initPaymentSelector() {\r\n    try {\r\n      this.paymentSelector = new PaymentSelector(this.#logger);\r\n    } catch (error) {\r\n      this.#logger.error('Error initializing PaymentSelector', error);\r\n    }\r\n  }\r\n\r\n  #initFormValidator() {\r\n    try {\r\n      this.formValidator = new FormValidator({ \r\n        debugMode: window.location.search.includes('debug=true'),\r\n        logger: this.#logger\r\n      });\r\n      \r\n      if (this.#form && this.formValidator) {\r\n        this.#form.__formValidator = this.formValidator;\r\n        this.#logger.debug('FormValidator initialized and attached to form');\r\n      }\r\n    } catch (error) {\r\n      this.#logger.error('Error initializing FormValidator', error);\r\n    }\r\n  }\r\n\r\n  #initPaymentHandler() {\r\n    try {\r\n      this.paymentHandler = new PaymentHandler(this.#apiClient, this.#logger, this.#app);\r\n    } catch (error) {\r\n      this.#logger.error('Error initializing PaymentHandler', error);\r\n    }\r\n  }\r\n\r\n  #initShippingSelector() {\r\n    try {\r\n      this.shippingSelector = new ShippingSelector(this.#app);\r\n    } catch (error) {\r\n      this.#logger.error('Error initializing ShippingSelector', error);\r\n    }\r\n  }\r\n\r\n  #initAddressAutocomplete() {\r\n    try {\r\n      // Pass Google Maps options from the app instance\r\n      const googleMapsOptions = {\r\n        enableGoogleMapsAutocomplete: this.#app.options.enableGoogleMapsAutocomplete\r\n      };\r\n      \r\n      this.addressAutocomplete = new AddressAutocomplete(this.#logger, googleMapsOptions);\r\n    } catch (error) {\r\n      this.#logger.error('Error initializing AddressAutocomplete', error);\r\n    }\r\n  }\r\n\r\n  #initPhoneInputHandler() {\r\n    try {\r\n      this.phoneInputHandler = new PhoneInputHandler(this.#logger);\r\n    } catch (error) {\r\n      this.#logger.error('Error initializing PhoneInputHandler', error);\r\n    }\r\n  }\r\n\r\n  #initProspectCartHandler() {\r\n    try {\r\n      // Initialize the ProspectCartHandler if we have the app instance\r\n      if (this.#app) {\r\n        this.prospectCartHandler = new ProspectCartHandler(this.#app);\r\n        this.#logger.info('ProspectCartHandler initialized');\r\n      } else {\r\n        this.#logger.warn('App instance not provided, ProspectCartHandler not initialized');\r\n      }\r\n    } catch (error) {\r\n      this.#logger.error('Error initializing ProspectCartHandler', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fix billing form by duplicating shipping form fields\r\n   * This ensures the billing form has the correct field attributes\r\n   */\r\n  #injectBillingFormFields() {\r\n    try {\r\n      this.#logger.info('Fixing billing form by duplicating shipping form');\r\n      \r\n      // Find the shipping form and billing container\r\n      const shippingForm = document.querySelector('[os-checkout-component=\"shipping-form\"]');\r\n      const billingContainer = document.querySelector('[os-checkout-component=\"billing-form\"]');\r\n      \r\n      // If both elements exist, proceed with duplication\r\n      if (shippingForm && billingContainer) {\r\n        // Log the found elements\r\n        this.#logger.info(`Found shipping form and billing container`);\r\n        \r\n        // Clone the shipping form\r\n        const billingForm = shippingForm.cloneNode(true);\r\n        \r\n        // Update all field attributes to billing-specific ones\r\n        const fieldMap = {\r\n          'fname': 'billing-fname',\r\n          'lname': 'billing-lname',\r\n          'address1': 'billing-address1',\r\n          'address2': 'billing-address2',\r\n          'city': 'billing-city',\r\n          'province': 'billing-province',\r\n          'postal': 'billing-postal',\r\n          'country': 'billing-country',\r\n          'phone': 'billing-phone'\r\n        };\r\n        \r\n        // Update all input, select fields\r\n        billingForm.querySelectorAll('input, select').forEach(field => {\r\n          const fieldAttr = field.getAttribute('os-checkout-field');\r\n          if (fieldAttr && fieldMap[fieldAttr]) {\r\n            field.setAttribute('os-checkout-field', fieldMap[fieldAttr]);\r\n            \r\n            // Also update IDs and names to avoid duplicates\r\n            if (field.id) {\r\n              field.id = 'billing_' + field.id;\r\n            }\r\n            if (field.name) {\r\n              field.name = 'billing_' + field.name;\r\n            }\r\n            if (field.getAttribute('data-name')) {\r\n              field.setAttribute('data-name', 'Billing ' + field.getAttribute('data-name'));\r\n            }\r\n            \r\n            // Update autocomplete attributes\r\n            if (field.getAttribute('autocomplete')) {\r\n              field.setAttribute('autocomplete', 'billing ' + field.getAttribute('autocomplete'));\r\n            }\r\n          }\r\n        });\r\n        \r\n        // Update location container attribute\r\n        const locationContainer = billingForm.querySelector('[data-os-component=\"location\"]');\r\n        if (locationContainer) {\r\n          locationContainer.setAttribute('data-os-component', 'billing-location');\r\n        }\r\n        \r\n        // Clear any existing content in the billing container\r\n        billingContainer.innerHTML = '';\r\n        \r\n        // Append the modified form to the billing container\r\n        billingContainer.appendChild(billingForm);\r\n        \r\n        this.#logger.info('Billing form successfully created from shipping form');\r\n      } else {\r\n        this.#logger.warn('Could not fix billing form - shipping form or billing container not found');\r\n        this.#logger.warn(`Shipping form found: ${!!shippingForm}, Billing container found: ${!!billingContainer}`);\r\n        \r\n        // Log all checkout components for debugging\r\n        const allComponents = document.querySelectorAll('[os-checkout-component]');\r\n        this.#logger.warn(`Found ${allComponents.length} checkout components:`);\r\n        allComponents.forEach(comp => {\r\n          this.#logger.warn(`- ${comp.getAttribute('os-checkout-component')}`);\r\n        });\r\n      }\r\n    } catch (error) {\r\n      this.#logger.error('Error fixing billing form:', error);\r\n    }\r\n  }\r\n\r\n  #setupEventListeners() {\r\n    try {\r\n      document.addEventListener('payment-method-changed', e => {\r\n        this.#logger.debug(`Payment method changed to: ${e.detail.mode}`);\r\n        const container = document.querySelector('[os-payment-mode]');\r\n        container?.setAttribute('os-payment-mode', e.detail.mode);\r\n      });\r\n      \r\n      // Ensure we're properly handling form submission\r\n      if (this.#form) {\r\n        this.#form.addEventListener('submit', e => this.#handleSubmit(e));\r\n        this.#logger.debug('Form submit event listener attached');\r\n      }\r\n      \r\n      // Listen for prospect cart created event if ProspectCartHandler is initialized\r\n      if (this.#app && this.#app.events && this.prospectCartHandler) {\r\n        this.#app.events.on('prospect.cartCreated', (data) => {\r\n          this.#logger.info('Prospect cart created successfully', data);\r\n          // You can add additional logic here if needed\r\n        });\r\n      }\r\n      \r\n      // Listen for order created event\r\n      if (this.#app && this.#app.events) {\r\n        this.#app.events.on('order.created', (data) => {\r\n          this.#logger.info('Order created successfully', data);\r\n          // You can add additional logic here if needed\r\n        });\r\n      }\r\n    } catch (error) {\r\n      this.#logger.error('Error setting up event listeners:', error);\r\n    }\r\n  }\r\n\r\n  #handleSubmit(event) {\r\n    // Always prevent the default form submission first\r\n    if (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      event.stopImmediatePropagation();\r\n    }\r\n    \r\n    this.#logger.debug('Form submission intercepted by #handleSubmit');\r\n    \r\n    // Prevent any form submission\r\n    if (this.#form) {\r\n      this.#form.removeAttribute('action');\r\n      this.#form.setAttribute('method', 'post');\r\n      \r\n      const preventSubmit = (e) => {\r\n        if (e) {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          e.stopImmediatePropagation();\r\n        }\r\n        \r\n        // Ensure form doesn't have action and has post method\r\n        if (this.#form) {\r\n          this.#form.removeAttribute('action');\r\n          this.#form.setAttribute('method', 'post');\r\n        }\r\n        \r\n        // Cancel any form submission that might be in progress\r\n        if (typeof window.stop === 'function') {\r\n          window.stop();\r\n        }\r\n        \r\n        this.#logger.debug('Form direct submission prevented');\r\n        return false;\r\n      };\r\n      \r\n      this.#form.onsubmit = preventSubmit;\r\n    }\r\n    \r\n    if (this.formValidator && !this.formValidator.validateAllFields()) {\r\n      this.#logger.warn('Form validation failed, stopping submission');\r\n      return false;\r\n    }\r\n    \r\n    if (this.paymentHandler) {\r\n      this.#logger.debug('Delegating to paymentHandler.processPayment()');\r\n      this.paymentHandler.processPayment();\r\n    } else {\r\n      this.#logger.error('Payment handler not initialized');\r\n    }\r\n    \r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Disable all submit buttons in the form to prevent accidental form submission\r\n   * @private\r\n   */\r\n  #disableSubmitButtons() {\r\n    try {\r\n      if (!this.#form) return;\r\n      \r\n      // Find all submit buttons in the form\r\n      const submitButtons = this.#form.querySelectorAll('button[type=\"submit\"], input[type=\"submit\"]');\r\n      \r\n      if (submitButtons.length > 0) {\r\n        this.#logger.debug(`Found ${submitButtons.length} submit buttons, converting to type=\"button\"`);\r\n        \r\n        submitButtons.forEach((button, index) => {\r\n          // Change type to button\r\n          button.setAttribute('type', 'button');\r\n          \r\n          // Add click handler to process payment\r\n          button.addEventListener('click', (e) => {\r\n            e.preventDefault();\r\n            this.#logger.debug(`Submit button ${index + 1} clicked, delegating to payment handler`);\r\n            \r\n            if (this.paymentHandler) {\r\n              this.paymentHandler.processPayment();\r\n            } else {\r\n              this.#logger.error('Payment handler not initialized');\r\n            }\r\n          });\r\n          \r\n          this.#logger.debug(`Converted submit button ${index + 1} to type=\"button\"`);\r\n        });\r\n      } else {\r\n        this.#logger.debug('No submit buttons found in the form');\r\n      }\r\n    } catch (error) {\r\n      this.#logger.error('Error disabling submit buttons:', error);\r\n    }\r\n  }\r\n}", "/**\r\n * CampaignHelper - Utility class for working with campaign data\r\n * \r\n * This class provides helper methods for accessing and using campaign data\r\n * that was retrieved during initialization.\r\n */\r\n\r\nexport class CampaignHelper {\r\n  #app;\r\n  #logger;\r\n  #viewItemListFired = false;\r\n\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#logger = app.logger.createModuleLogger('CAMPAIGN');\r\n  }\r\n\r\n  getCampaignData() {\r\n    const campaignData = this.#app.campaignData;\r\n    return campaignData;\r\n  }\r\n\r\n  getCampaignName() {\r\n    return this.#app.campaignData?.name ?? '';\r\n  }\r\n\r\n  getCampaignId() {\r\n    return this.#app.campaignData?.id ?? '';\r\n  }\r\n\r\n  getProducts() {\r\n    const products = this.#app.campaignData?.products ?? [];\r\n    return products;\r\n  }\r\n\r\n  getProductById(productId) {\r\n    return this.getProducts().find(product => product.id === productId);\r\n  }\r\n\r\n  getCurrency() {\r\n    return this.#app.campaignData?.currency ?? 'USD';\r\n  }\r\n\r\n  getLocale() {\r\n    return this.#app.campaignData?.locale ?? 'en-US';\r\n  }\r\n\r\n  formatPrice(price) {\r\n    if (typeof price !== 'number') return '';\r\n\r\n    try {\r\n      return new Intl.NumberFormat(this.getLocale(), {\r\n        style: 'currency',\r\n        currency: this.getCurrency()\r\n      }).format(price);\r\n    } catch (error) {\r\n      this.#logger.error('Error formatting price:', error);\r\n      return price.toString();\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Manually trigger the view_item_list event\r\n   */\r\n  triggerViewItemList() {\r\n    if (!this.#app.campaignData) {\r\n      this.#logger.warn('Cannot trigger view_item_list: No campaign data available');\r\n      return;\r\n    }\r\n    \r\n    if (!this.#app.eventManager) {\r\n      this.#logger.warn('Cannot trigger view_item_list: EventManager not found');\r\n      return;\r\n    }\r\n    \r\n    // Use the new viewVisibleItemList method if available, otherwise fall back to the old method\r\n    if (typeof this.#app.eventManager.viewVisibleItemList === 'function') {\r\n      this.#logger.debug('Manually triggering viewVisibleItemList event');\r\n      this.#app.eventManager.viewVisibleItemList();\r\n    } else if (this.#app.events?.viewItemList) {\r\n      this.#logger.debug('Falling back to events.viewItemList method');\r\n      this.#app.events.viewItemList(this.#app.campaignData);\r\n    } else {\r\n      this.#logger.warn('No suitable method found to trigger view_item_list event');\r\n    }\r\n    \r\n    this.#viewItemListFired = true;\r\n  }\r\n}", "/**\r\n * StateManager - Manages application state\r\n * \r\n * This class provides a centralized state management system for the application,\r\n * including local cart functionality. It uses a pub/sub pattern to notify\r\n * subscribers when state changes.\r\n */\r\n\r\nexport class StateManager {\r\n  #app;\r\n  #logger;\r\n  #state;\r\n  #subscribers = {};\r\n\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#logger = app.logger.createModuleLogger('STATE');\r\n    this.#state = this.#initDefaultState();\r\n    this.#loadState();\r\n    this.#logger.info('StateManager initialized (core state loaded)');\r\n  }\r\n\r\n  finalizeInitializationAndRecalculate() {\r\n    this.#logger.info('[StateManager] Finalizing initialization: performing initial cart calculations.');\r\n    this.#processCartUpdates(true, 'cart.initialLoad'); \r\n  }\r\n\r\n  #initDefaultState() {\r\n    return {\r\n      cart: {\r\n        items: [],\r\n        totals: {\r\n          subtotal: 0,\r\n          retail_subtotal: 0,\r\n          savings: 0,\r\n          savings_percentage: 0,\r\n          shipping: 0,\r\n          tax: 0,\r\n          total: 0,\r\n          recurring_total: 0,\r\n          discount: 0,\r\n          coupon_savings: 0,\r\n          currency: 'USD',\r\n          currency_symbol: '$'\r\n        },\r\n        shippingMethod: null,\r\n        couponCode: null,\r\n        couponDetails: null,\r\n        attribution: {\r\n          utm_source: '',\r\n          utm_medium: '',\r\n          utm_campaign: '',\r\n          utm_content: '',\r\n          utm_term: '',\r\n          gclid: '',\r\n          fbclid: '',\r\n          sub1: '',\r\n          sub2: '',\r\n          sub3: '',\r\n          sub4: '',\r\n          sub5: '',\r\n          referrer: '',\r\n          landing_page: '',\r\n          user_agent: '',\r\n          device_type: '',\r\n          fbc: '',\r\n          fbp: ''\r\n        }\r\n      },\r\n      user: { email: null, firstName: null, lastName: null, phone: null },\r\n      ui: { loading: false, currentStep: 'cart', errors: {} }\r\n    };\r\n  }\r\n\r\n  #loadState() {\r\n    try {\r\n      const savedState = sessionStorage.getItem('os_state');\r\n      if (savedState) {\r\n        const parsedState = JSON.parse(savedState);\r\n        if (parsedState.cart && Array.isArray(parsedState.cart.items)) {\r\n          parsedState.cart.items = parsedState.cart.items.map(item => ({\r\n            ...item,\r\n            applied_coupon_discount_amount: parseFloat(item.applied_coupon_discount_amount || '0.00') \r\n          }));\r\n        } else if (parsedState.cart) {\r\n          parsedState.cart.items = [];\r\n        }\r\n        this.#state = { ...this.#state, ...parsedState, ui: { ...this.#state.ui } };\r\n        this.#logger.info('State loaded from sessionStorage');\r\n      }\r\n    } catch (error) {\r\n      this.#logger.error('Error loading state from sessionStorage:', error);\r\n    }\r\n  }\r\n\r\n  #saveState() {\r\n    try {\r\n      const stateToSave = {\r\n        cart: this.#state.cart,\r\n        user: this.#state.user\r\n      };\r\n      sessionStorage.setItem('os_state', JSON.stringify(stateToSave));\r\n      this.#logger.debug('State saved to sessionStorage');\r\n    } catch (error) {\r\n      this.#logger.error('Error saving state to sessionStorage:', error);\r\n    }\r\n  }\r\n\r\n  getState(path = null) {\r\n    if (!path) return this.#state;\r\n    return path.split('.').reduce((obj, key) => obj?.[key] ?? null, this.#state);\r\n  }\r\n\r\n  setState(path, value, notify = true) {\r\n    let current = this.#state;\r\n    const parts = path.split('.');\r\n    let parent = this.#state;\r\n    let finalPart = parts[0];\r\n\r\n    for (const [i, part] of parts.entries()) {\r\n      if (i === parts.length - 1) {\r\n        current[part] = value;\r\n        finalPart = part;\r\n      } else {\r\n        current[part] ??= {};\r\n        parent = current;\r\n        current = current[part];\r\n      }\r\n    }\r\n\r\n    const cartRelatedChange = path.startsWith('cart.items') || \r\n                              path === 'cart.couponDetails' || \r\n                              path === 'cart.couponCode' || \r\n                              path.startsWith('cart.shippingMethod');\r\n\r\n    if (cartRelatedChange) {\r\n      this.#processCartUpdates(notify, path);\r\n    } else {\r\n      this.#saveState();\r\n      if (notify) {\r\n        this.#notifySubscribers(path, value);\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  subscribe(path, callback) {\r\n    this.#subscribers[path] ??= [];\r\n    this.#subscribers[path].push(callback);\r\n    try {\r\n      callback(this.getState(path), path);\r\n    } catch (error) {\r\n      this.#logger.error(`Error in initial subscriber callback for ${path}:`, error);\r\n    }\r\n    return () => this.#subscribers[path] = this.#subscribers[path].filter(cb => cb !== callback);\r\n  }\r\n\r\n  #notifySubscribers(path, value) {\r\n    this.#logger.debug(`Notifying subscribers for path: ${path}`);\r\n    \r\n    for (const [subPath, callbacks] of Object.entries(this.#subscribers)) {\r\n      if (subPath === path || subPath === '*' || path.startsWith(`${subPath}.`)) {\r\n        const subValue = subPath === '*' ? this.getState() : this.getState(subPath);\r\n        callbacks.forEach(callback => {\r\n          try {\r\n            callback(subValue, subPath);\r\n          } catch (error) {\r\n            this.#logger.error(`Error in subscriber callback for ${subPath}:`, error);\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  clearState() {\r\n    this.#state = this.#initDefaultState();\r\n    sessionStorage.removeItem('os_state');\r\n    this.#notifySubscribers('*', this.#state);\r\n    this.#logger.info('State cleared');\r\n  }\r\n\r\n  addToCart(item) {\r\n    if (!item?.id) {\r\n      this.#logger.error('Invalid item for addToCart:', item);\r\n      throw new Error('Invalid item. Must have id.');\r\n    }\r\n    this.#logger.debugWithTime(`[StateManager] addToCart: Input item: ${JSON.stringify(item)}`);\r\n\r\n    // Always try to match by ref_id first\r\n    let packageData = this.#app.campaignData?.packages?.find(pkg => \r\n      pkg.ref_id.toString() === item.id.toString()\r\n    );\r\n    \r\n    // If no match by ref_id and not explicitly restricted to ref_id only, try by external_id as fallback\r\n    if (!packageData && !item.match_by_ref_id_only) {\r\n      packageData = this.#app.campaignData?.packages?.find(pkg => \r\n        pkg.external_id?.toString() === item.id.toString()\r\n      );\r\n      if (packageData) {\r\n        this.#logger.debugWithTime(`[StateManager] No ref_id match found, falling back to external_id match for: ${item.id}`);\r\n      }\r\n    }\r\n    \r\n    this.#logger.debugWithTime(`[StateManager] addToCart: Found packageData: ${JSON.stringify(packageData)}`);\r\n\r\n    // If we only have id but no name/price, and package data exists, use package data\r\n    if (packageData && (!item.name || item.price === undefined)) {\r\n      item = {\r\n        ...item,\r\n        name: packageData.name,\r\n        price: parseFloat(packageData.price)\r\n      };\r\n      this.#logger.debugWithTime(`[StateManager] Auto-populated item from packageData: ${JSON.stringify(item)}`);\r\n    } else if (!item.name || item.price === undefined) {\r\n      this.#logger.error('Invalid item for addToCart and no matching package found:', item);\r\n      throw new Error('Invalid item. Must have id, name, and price, or a valid package id.');\r\n    }\r\n\r\n    const itemPackageId = packageData?.ref_id?.toString() || item.id.toString();\r\n    const inputQuantity = item.quantity || 1;\r\n\r\n    let finalItemData;\r\n\r\n    if (packageData) {\r\n      this.#logger.debugWithTime(`[StateManager] Using packageData for item ${item.id}. PackageData price: ${packageData.price}, price_total: ${packageData.price_total}, qty: ${packageData.qty}`);\r\n      \r\n      finalItemData = {\r\n        ...item,\r\n        id: item.id.toString(),\r\n        package_id: itemPackageId,\r\n        name: packageData.name || item.name,\r\n        quantity: inputQuantity,\r\n        price: Number.parseFloat(packageData.price),\r\n        price_total: Number.parseFloat(packageData.price_total),\r\n        retail_price: Number.parseFloat(packageData.price_retail) ?? undefined,\r\n        retail_price_total: Number.parseFloat(packageData.price_retail_total) ?? undefined,\r\n        is_recurring: packageData.is_recurring ?? false,\r\n        price_recurring: packageData.price_recurring ? Number.parseFloat(packageData.price_recurring) : undefined,\r\n        price_recurring_total: packageData.price_recurring_total ? Number.parseFloat(packageData.price_recurring_total) : undefined,\r\n        interval: packageData.interval ?? undefined,\r\n        interval_count: packageData.interval_count ?? undefined,\r\n        image: packageData.image || item.image,\r\n        external_id: packageData.external_id ?? undefined,\r\n        applied_coupon_discount_amount: parseFloat(item.applied_coupon_discount_amount || '0.00')\r\n      };\r\n\r\n      if (finalItemData.price_total == null && finalItemData.price != null && (packageData.qty || 1) > 0) {\r\n        finalItemData.price_total = finalItemData.price * (packageData.qty || 1);\r\n        this.#logger.debugWithTime(`[StateManager] Calculated price_total for package item: ${finalItemData.price_total}`);\r\n      }\r\n      if (finalItemData.retail_price_total == null && finalItemData.retail_price != null && (packageData.qty || 1) > 0) {\r\n        finalItemData.retail_price_total = finalItemData.retail_price * (packageData.qty || 1);\r\n        this.#logger.debugWithTime(`[StateManager] Calculated retail_price_total for package item: ${finalItemData.retail_price_total}`);\r\n      }\r\n\r\n    } else {\r\n      this.#logger.debugWithTime(`[StateManager] No packageData found for item id ${item.id}. Using input item data directly.`);\r\n      const basePrice = Number.parseFloat(item.price);\r\n      const retailPrice = Number.parseFloat(item.retail_price) ?? undefined;\r\n\r\n      finalItemData = {\r\n        ...item,\r\n        id: item.id.toString(),\r\n        package_id: itemPackageId, \r\n        quantity: inputQuantity,\r\n        price: basePrice,\r\n        price_total: Number.parseFloat(item.price_total ?? (basePrice * inputQuantity).toFixed(2)),\r\n        retail_price: retailPrice,\r\n        retail_price_total: Number.parseFloat(item.retail_price_total ?? (retailPrice ? (retailPrice * inputQuantity).toFixed(2) : undefined)) ?? undefined,\r\n        applied_coupon_discount_amount: parseFloat(item.applied_coupon_discount_amount || '0.00')\r\n      };\r\n    }\r\n\r\n    this.#logger.debugWithTime(`[StateManager] addToCart: Final item data before adding to cart: ${JSON.stringify(finalItemData)}`);\r\n\r\n    const existingItemIndex = this.#state.cart.items.findIndex(i => i.id === finalItemData.id && i.package_id === finalItemData.package_id);\r\n    let newItems;\r\n\r\n    if (existingItemIndex >= 0) {\r\n      newItems = this.#state.cart.items.map((cartItem, index) => {\r\n        if (index === existingItemIndex) {\r\n          const newQuantity = (cartItem.quantity || 1) + inputQuantity;\r\n          return {\r\n            ...cartItem,\r\n            ...finalItemData,\r\n            quantity: newQuantity,\r\n            price_total: finalItemData.price ? (finalItemData.price * (packageData?.qty || 1) * newQuantity) : 0,\r\n            retail_price_total: finalItemData.retail_price ? (finalItemData.retail_price * (packageData?.qty || 1) * newQuantity) : undefined,\r\n            price_recurring_total: finalItemData.price_recurring ? (finalItemData.price_recurring * (packageData?.qty || 1) * newQuantity) : undefined,\r\n          };\r\n        }\r\n        return cartItem;\r\n      });\r\n      this.#logger.debugWithTime(`[StateManager] Updated existing item: ${finalItemData.name}, new quantity: ${newItems[existingItemIndex].quantity}`);\r\n    } else {\r\n      newItems = [...this.#state.cart.items, finalItemData];\r\n      this.#logger.debugWithTime(`[StateManager] Added new item: ${finalItemData.name}`);\r\n    }\r\n    \r\n    this.setState('cart.items', newItems); \r\n    this.#logger.info(`Item added/updated in cart: ${finalItemData.name}`);\r\n    return this.getState('cart');\r\n  }\r\n\r\n  updateCartItem(itemId, updates) {\r\n    const cart = this.getState('cart');\r\n    const itemIndex = cart.items.findIndex(item => item.id === itemId);\r\n    if (itemIndex === -1) {\r\n      this.#logger.error(`Item not found in cart: ${itemId}`);\r\n      throw new Error(`Item not found in cart: ${itemId}`);\r\n    }\r\n\r\n    const updatedItems = [...cart.items];\r\n    updatedItems[itemIndex] = { ...updatedItems[itemIndex], ...updates };\r\n    if (updatedItems[itemIndex].quantity === 0) updatedItems.splice(itemIndex, 1);\r\n\r\n    this.setState('cart.items', updatedItems);\r\n    this.#logger.info(`Cart item updated: ${itemId}`);\r\n    return this.getState('cart');\r\n  }\r\n\r\n  removeFromCart(itemId) {\r\n    const updatedItems = this.getState('cart').items.filter(item => item.id !== itemId);\r\n    this.setState('cart.items', updatedItems);\r\n    this.#logger.info(`Item removed from cart: ${itemId}`);\r\n    return this.getState('cart');\r\n  }\r\n\r\n  clearCart() {\r\n    this.setState('cart.items', []);\r\n    this.setState('cart.couponCode', null);\r\n    this.setState('cart.couponDetails', null);\r\n    this.setState('cart.shippingMethod', null);\r\n    this.#logger.info('Cart cleared');\r\n    return this.getState('cart');\r\n  }\r\n\r\n  setShippingMethod(shippingMethod) {\r\n    this.setState('cart.shippingMethod', shippingMethod);\r\n    this.#logger.info(`Shipping method set: ${shippingMethod.code}`);\r\n    return this.getState('cart');\r\n  }\r\n\r\n  applyCoupon(couponCode, discountType = 'percentage', discountValue = 0, applicableProductIds = []) {\r\n    this.setState('cart.couponDetails', {\r\n      code: couponCode,\r\n      type: discountType,\r\n      value: parseFloat(discountValue),\r\n      applicable_product_ids: applicableProductIds\r\n    });\r\n    this.setState('cart.couponCode', couponCode);\r\n    this.#logger.info(`Attempted to apply coupon: ${couponCode}`);\r\n    return this.getState('cart');\r\n  }\r\n\r\n  removeCoupon() {\r\n    this.setState('cart.couponDetails', null);\r\n    this.setState('cart.couponCode', null);\r\n    this.#logger.info('Coupon removed');\r\n    return this.getState('cart');\r\n  }\r\n\r\n  #processCartUpdates(notify = true, changedPath = 'cart') {\r\n    this.#logger.debug(`[StateManager] Processing cart updates triggered by: ${changedPath}`);\r\n    if (!this.#app.discount) {\r\n        this.#logger.warn(\"[StateManager] #processCartUpdates: DiscountManager (this.#app.discount) not available yet. Skipping discount calculations for now.\");\r\n        // Only recalculate basic totals if discount manager isn't ready, to avoid errors\r\n        // This situation should ideally be avoided by calling finalizeInitializationAndRecalculate later.\r\n        const { items, shippingMethod } = this.#state.cart;\r\n        const currentItems = Array.isArray(items) ? items : [];\r\n        const subtotalPreDiscount = currentItems.reduce((acc, item) => acc + (item.price_total ?? (item.price * (item.quantity || 1))), 0);\r\n        let shipping = shippingMethod?.price ? Number.parseFloat(shippingMethod.price) : 0;\r\n        const tax = 0;\r\n        this.#state.cart.totals = {\r\n            ...this.#initDefaultState().cart.totals, // Reset to default totals structure\r\n            subtotal: subtotalPreDiscount,\r\n            original_subtotal: subtotalPreDiscount,\r\n            total: subtotalPreDiscount + shipping + tax,\r\n            shipping: shipping\r\n        };\r\n        this.#logger.debug('[StateManager] Basic cart totals recalculated without coupon logic.');\r\n    } else {\r\n        this.#updateItemAppliedDiscounts(); \r\n        this.#recalculateCart(); \r\n    }\r\n    this.#saveState();\r\n\r\n    if (notify) {\r\n      if (changedPath !== 'cart' && changedPath !== 'cart.initialLoad') { \r\n          const changedValue = changedPath.split('.').reduce((obj, key) => obj?.[key] ?? null, this.#state);\r\n          this.#notifySubscribers(changedPath, changedValue);\r\n      }\r\n      this.#notifySubscribers('cart', this.getState('cart')); \r\n    }\r\n  }\r\n\r\n  #updateItemAppliedDiscounts() {\r\n    if (!this.#app.discount) { // Guard against missing discount manager\r\n        this.#logger.warn(\"[StateManager] #updateItemAppliedDiscounts: DiscountManager not available. Skipping.\");\r\n        // Ensure items have a default value for applied_coupon_discount_amount if not set\r\n        this.#state.cart.items = (this.#state.cart.items || []).map(item => ({...item, applied_coupon_discount_amount: item.applied_coupon_discount_amount || 0.00 }));\r\n        return;\r\n    }\r\n    const { items, couponDetails } = this.#state.cart;\r\n    if (!Array.isArray(items)) {\r\n      this.#logger.warn('[StateManager] #updateItemAppliedDiscounts: cart.items is not an array.');\r\n      return;\r\n    }\r\n    this.#logger.debugWithTime(`[SM.#updateItemAppliedDiscounts] Start. Coupon: ${couponDetails?.code}.`);\r\n\r\n    this.#state.cart.items = items.map(item => {\r\n      let itemDiscountAmount = 0;\r\n      const itemBasePriceForDiscountCalc = (item.price_total != null) \r\n                                          ? item.price_total \r\n                                          : (item.price || 0) * (item.quantity || 1);\r\n\r\n      if (couponDetails && couponDetails.code) { // No need to check this.#app.discount again here\r\n        let isItemApplicableForCoupon = false;\r\n        if (couponDetails.applicable_product_ids && couponDetails.applicable_product_ids.length > 0) {\r\n          if (couponDetails.applicable_product_ids.includes(item.package_id?.toString()) ||\r\n              couponDetails.applicable_product_ids.includes(item.id?.toString())) {\r\n            isItemApplicableForCoupon = true;\r\n          }\r\n        } else {\r\n          isItemApplicableForCoupon = true; \r\n        }\r\n        if (isItemApplicableForCoupon) {\r\n          if (couponDetails.type === 'percentage') {\r\n            itemDiscountAmount = itemBasePriceForDiscountCalc * (couponDetails.value / 100);\r\n          } else if (couponDetails.type === 'fixed') {\r\n            if (couponDetails.applicable_product_ids && couponDetails.applicable_product_ids.length > 0) {\r\n              itemDiscountAmount = Math.min(itemBasePriceForDiscountCalc, couponDetails.value);\r\n            } else {\r\n              itemDiscountAmount = 0; \r\n            }\r\n          }\r\n        }\r\n      }\r\n      return {\r\n        ...item,\r\n        applied_coupon_discount_amount: parseFloat(itemDiscountAmount.toFixed(2)) \r\n      };\r\n    });\r\n    this.#logger.debugWithTime('[StateManager] Updated per-item applied_coupon_discount_amount.');\r\n  }\r\n\r\n  #recalculateCart() {\r\n    if (!this.#app.discount) { // Guard against missing discount manager\r\n        this.#logger.warn(\"[StateManager] #recalculateCart: DiscountManager not available. Skipping full total recalc.\");\r\n        // Potentially set totals to a very basic state if this happens post-init\r\n        const subtotal = (this.#state.cart.items || []).reduce((acc, item) => acc + (item.price_total ?? (item.price * (item.quantity || 1))), 0);\r\n        this.#state.cart.totals = { ...this.#initDefaultState().cart.totals, subtotal: subtotal, original_subtotal: subtotal, total: subtotal }; // Simplified\r\n        return;\r\n    }\r\n    const { items, shippingMethod, couponDetails } = this.#state.cart;\r\n    const currentItems = Array.isArray(items) ? items : [];\r\n    this.#logger.debugWithTime(`[SM.#recalculateCart] Start. Coupon: ${couponDetails?.code}. Item count: ${currentItems.length}`);\r\n\r\n    const subtotalPreDiscount = currentItems.reduce((acc, item) => \r\n      acc + (item.price_total ?? (item.price * (item.quantity || 1))), 0);\r\n\r\n    let totalDiscountFromCoupon = 0;\r\n    if (couponDetails && couponDetails.code) { \r\n        totalDiscountFromCoupon = this.#app.discount.calculateDiscount(couponDetails, subtotalPreDiscount, currentItems);\r\n        this.#logger.debugWithTime(`[SM.#recalculateCart] DiscountManager returned totalDiscountFromCoupon: ${totalDiscountFromCoupon}`);\r\n    } else {\r\n      this.#logger.debugWithTime('[SM.#recalculateCart] No active coupon or discount manager for total discount calc.');\r\n    }\r\n    \r\n    const subtotalAfterDiscount = subtotalPreDiscount - totalDiscountFromCoupon;\r\n    const retailSubtotal = currentItems.reduce((acc, item) => \r\n      acc + (item.retail_price_total ?? ((item.retail_price ?? item.price) * (item.quantity || 1))), 0);\r\n    const savings = retailSubtotal - subtotalAfterDiscount;\r\n    const savingsPercentage = retailSubtotal > 0 ? (savings / retailSubtotal) * 100 : 0;\r\n    const recurringTotal = currentItems.reduce((acc, item) => \r\n      acc + (item.is_recurring && item.price_recurring ? item.price_recurring * (item.quantity || 1) : 0), 0);\r\n    let shipping = shippingMethod?.price ? Number.parseFloat(shippingMethod.price) : 0;\r\n    if (couponDetails && couponDetails.type === 'free_shipping') {\r\n      shipping = 0;\r\n    }\r\n    const tax = 0;\r\n    const finalTotal = subtotalAfterDiscount + shipping + tax;\r\n    const currency = this.#app.campaignData?.currency ?? 'USD';\r\n    const currencySymbol = { USD: '$', EUR: '€', GBP: '£' }[currency] ?? '$';\r\n\r\n    this.#state.cart.totals = {\r\n      subtotal: subtotalAfterDiscount,\r\n      original_subtotal: subtotalPreDiscount,\r\n      retail_subtotal: retailSubtotal,\r\n      savings,\r\n      savings_percentage: savingsPercentage,\r\n      shipping,\r\n      tax,\r\n      total: finalTotal,\r\n      recurring_total: recurringTotal,\r\n      discount: totalDiscountFromCoupon,\r\n      coupon_savings: totalDiscountFromCoupon,\r\n      currency,\r\n      currency_symbol: currencySymbol\r\n    };\r\n    this.#logger.debug('[StateManager] Cart totals recalculated.');\r\n  }\r\n\r\n  isItemInCart(itemId) {\r\n    return this.#state.cart.items.some(item => item.id === itemId);\r\n  }\r\n\r\n  getCartForApi() {\r\n    const { items, shippingMethod, couponCode, couponDetails, attribution } = this.getState('cart');\r\n    const { email, firstName, lastName, phone } = this.getState('user');\r\n    \r\n    let vouchers = [];\r\n    if (couponCode) {\r\n      if (couponDetails && couponDetails.type && couponDetails.value !== undefined) {\r\n        vouchers.push({\r\n          code: couponCode,\r\n          type: couponDetails.type,\r\n          value: couponDetails.value\r\n        });\r\n      } else {\r\n        vouchers.push(couponCode);\r\n      }\r\n    }\r\n    \r\n    return {\r\n      lines: items.map(item => ({ product_id: item.id, quantity: item.quantity || 1, price: item.price })),\r\n      shipping_method: shippingMethod?.ref_id ?? null,\r\n      coupon_code: couponCode,\r\n      vouchers: vouchers,\r\n      user: { email, first_name: firstName, last_name: lastName, phone },\r\n      attribution: attribution || {}\r\n    };\r\n  }\r\n\r\n  async syncCartWithApi() {\r\n    try {\r\n      this.setState('ui.loading', true);\r\n      const apiCart = this.getCartForApi();\r\n      const response = await this.#app.api.createCart(apiCart);\r\n      this.#logger.info('Cart synced with API');\r\n      this.#app.triggerEvent('cart.synced', { cart: response });\r\n      return response;\r\n    } catch (error) {\r\n      this.#logger.error('Error syncing cart with API:', error);\r\n      this.setState('ui.errors.cart', error.message);\r\n      throw error;\r\n    } finally {\r\n      this.setState('ui.loading', false);\r\n    }\r\n  }\r\n}", "/**\n * CartManager - Manages cart operations\n * \n * This class provides a simplified interface for cart operations,\n * using the StateManager for state management.\n */\n\nexport class CartManager {\n  #app;\n  #stateManager;\n  #logger;\n  #cartElements;\n\n  constructor(app) {\n    this.#app = app;\n    this.#stateManager = app.state;\n    this.#logger = app.logger.createModuleLogger('CART');\n    this.#initCartUI();\n    this.#logger.info('CartManager initialized');\n  }\n\n  #initCartUI() {\n    this.#cartElements = {\n      addToCartButtons: document.querySelectorAll('[data-os-add-to-cart]'),\n      cartCount: document.querySelectorAll('[data-os-cart-count]'),\n      cartTotal: document.querySelectorAll('[data-os-cart-total]'),\n      cartItems: document.querySelector('[data-os-cart-items]'),\n      cartEmpty: document.querySelector('[data-os-cart-empty]'),\n      cartContainer: document.querySelector('[data-os-cart-container]')\n    };\n\n    this.#cartElements.addToCartButtons.forEach(button => {\n      button.addEventListener('click', event => {\n        event.preventDefault();\n        const item = {\n          id: button.getAttribute('data-os-product-id'),\n          name: button.getAttribute('data-os-product-name'),\n          price: Number.parseFloat(button.getAttribute('data-os-product-price')),\n          quantity: Number.parseInt(button.getAttribute('data-os-product-quantity') ?? '1', 10)\n        };\n        if (item.id && item.name && item.price) this.#addToCart(item);\n        else this.#logger.error('Invalid product data for add to cart button');\n      });\n    });\n\n    this.#stateManager.subscribe('cart', () => this.#updateCartUI());\n    this.#updateCartUI();\n  }\n\n  #updateCartUI() {\n    const cart = this.#stateManager.getState('cart');\n\n    this.#cartElements.cartCount.forEach(element => {\n      const itemCount = cart.items.reduce((count, item) => count + (item.quantity || 1), 0);\n      element.textContent = itemCount.toString();\n      element.classList.toggle('hidden', itemCount === 0);\n    });\n\n    const formatPrice = price => this.#app.campaign?.formatPrice(price) ?? price.toFixed(2);\n    this.#cartElements.cartTotal.forEach(element => element.textContent = formatPrice(cart.totals.total));\n\n    const updateElement = (selector, value, hideIfZero = false) => {\n      const element = document.querySelector(selector);\n      if (element) {\n        element.textContent = hideIfZero ? `${Math.round(value)}%` : formatPrice(value);\n        if (hideIfZero && value === 0) element.parentElement?.classList.add('hidden');\n        else element.parentElement?.classList.remove('hidden');\n      }\n    };\n\n    updateElement('[data-os-cart-retail-subtotal]', cart.totals.retail_subtotal);\n    updateElement('[data-os-cart-savings]', cart.totals.savings, true);\n    updateElement('[data-os-cart-savings-percentage]', cart.totals.savings_percentage, true);\n    updateElement('[data-os-cart-recurring-total]', cart.totals.recurring_total, true);\n    updateElement('[data-os-cart-subtotal]', cart.totals.subtotal);\n    updateElement('[data-os-cart-shipping]', cart.totals.shipping);\n    updateElement('[data-os-cart-original-subtotal]', cart.totals.original_subtotal);\n    updateElement('[data-os-cart-discount]', cart.totals.discount);\n    updateElement('[data-os-cart-coupon-savings]', cart.totals.coupon_savings);\n    \n    // Update coupon display\n    const couponElement = document.querySelector('[data-os-cart-coupon]');\n    const couponContainer = document.querySelector('[data-os-cart-coupon-container]');\n    \n    if (couponElement && couponContainer) {\n      if (cart.couponDetails && cart.couponCode) {\n        couponElement.textContent = this.#app.discount?.getCouponDisplayText(cart.couponDetails) || cart.couponCode;\n        couponContainer.classList.remove('hidden');\n      } else {\n        couponContainer.classList.add('hidden');\n      }\n    }\n\n    if (this.#cartElements.cartItems) {\n      this.#cartElements.cartItems.innerHTML = '';\n      cart.items.forEach(item => this.#cartElements.cartItems.appendChild(this.#createCartItemElement(item)));\n    }\n\n    if (this.#cartElements.cartEmpty && this.#cartElements.cartContainer) {\n      const isEmpty = cart.items.length === 0;\n      this.#cartElements.cartEmpty.classList.toggle('hidden', !isEmpty);\n      this.#cartElements.cartContainer.classList.toggle('hidden', isEmpty);\n    }\n  }\n\n  #createCartItemElement(item) {\n    const formatPrice = price => this.#app.campaign?.formatPrice(price) ?? price.toFixed(2);\n    const itemElement = document.createElement('div');\n    itemElement.className = 'os-cart-item';\n    itemElement.setAttribute('data-os-cart-item-id', item.id);\n\n    const price = formatPrice(item.price);\n    const retailPrice = item.retail_price ? formatPrice(item.retail_price) : '';\n    const total = formatPrice(item.price * (item.quantity || 1));\n    const savings = item.retail_price ? (item.retail_price - item.price) * (item.quantity || 1) : 0;\n    const savingsHtml = savings ? `\n      <div class=\"os-cart-item-savings\">\n        <span class=\"os-cart-item-savings-label\">You save:</span>\n        <span class=\"os-cart-item-savings-value\">${formatPrice(savings)} (${Math.round(savings / (item.retail_price * (item.quantity || 1)) * 100)}%)</span>\n      </div>\n    ` : '';\n    const recurringHtml = item.is_recurring && item.price_recurring ? `\n      <div class=\"os-cart-item-recurring\">\n        <span class=\"os-cart-item-recurring-label\">Recurring:</span>\n        <span class=\"os-cart-item-recurring-value\">${formatPrice(item.price_recurring)} ${item.interval_count > 1 ? `every ${item.interval_count} ${item.interval}s` : `per ${item.interval}`}</span>\n      </div>\n    ` : '';\n    const imageHtml = item.image ? `\n      <div class=\"os-cart-item-image\">\n        <img src=\"${item.image}\" alt=\"${item.name}\" />\n      </div>\n    ` : '';\n\n    itemElement.innerHTML = `\n      ${imageHtml}\n      <div class=\"os-cart-item-details\">\n        <div class=\"os-cart-item-name\">${item.name}</div>\n        <div class=\"os-cart-item-price-container\">\n          <div class=\"os-cart-item-price\">${price}</div>\n          ${retailPrice ? `<div class=\"os-cart-item-retail-price\">${retailPrice}</div>` : ''}\n        </div>\n        ${savingsHtml}\n        ${recurringHtml}\n      </div>\n      <div class=\"os-cart-item-quantity\">\n        <button class=\"os-cart-item-decrease\" data-os-cart-decrease=\"${item.id}\">-</button>\n        <span class=\"os-cart-item-quantity-value\">${item.quantity || 1}</span>\n        <button class=\"os-cart-item-increase\" data-os-cart-increase=\"${item.id}\">+</button>\n      </div>\n      <div class=\"os-cart-item-total\">${total}</div>\n      <button class=\"os-cart-item-remove\" data-os-cart-remove=\"${item.id}\">×</button>\n    `;\n\n    itemElement.querySelector(`[data-os-cart-decrease=\"${item.id}\"]`)?.addEventListener('click', () => this.#updateCartItemQuantity(item.id, (item.quantity || 1) - 1));\n    itemElement.querySelector(`[data-os-cart-increase=\"${item.id}\"]`)?.addEventListener('click', () => this.#updateCartItemQuantity(item.id, (item.quantity || 1) + 1));\n    itemElement.querySelector(`[data-os-cart-remove=\"${item.id}\"]`)?.addEventListener('click', () => this.#removeFromCart(item.id));\n\n    return itemElement;\n  }\n\n  #addToCart(item) {\n    try {\n      const result = this.#stateManager.addToCart(item);\n      // this.#showMessage(`${item.name} added to cart`);\n      return result;\n    } catch (error) {\n      this.#logger.error('Error adding item to cart:', error);\n      // this.#showMessage('Error adding item to cart', 'error');\n      throw error;\n    }\n  }\n\n  #updateCartItemQuantity(itemId, quantity) {\n    try {\n      return quantity <= 0 ? this.#removeFromCart(itemId) : this.#stateManager.updateCartItem(itemId, { quantity });\n    } catch (error) {\n      this.#logger.error('Error updating cart item quantity:', error);\n      // this.#showMessage('Error updating cart', 'error');\n      throw error;\n    }\n  }\n\n  #removeFromCart(itemId) {\n    try {\n      return this.#stateManager.removeFromCart(itemId);\n    } catch (error) {\n      this.#logger.error('Error removing item from cart:', error);\n      // this.#showMessage('Error removing item from cart', 'error');\n      throw error;\n    }\n  }\n\n  clearCart() {\n    try {\n      return this.#stateManager.clearCart();\n    } catch (error) {\n      this.#logger.error('Error clearing cart:', error);\n      // this.#showMessage('Error clearing cart', 'error');\n      throw error;\n    }\n  }\n\n  addToCart(item) {\n    return this.#addToCart(item);\n  }\n\n  addToCartByRefId(refId, quantity = 1) {\n    try {\n      // Find the package by ref_id ONLY - do not match by external_id\n      const packageData = this.#app.campaignData?.packages?.find(pkg => \n        pkg.ref_id.toString() === refId.toString()\n      );\n      \n      if (!packageData) {\n        this.#logger.error(`Package with ref_id ${refId} not found in campaign data`);\n        throw new Error(`Package with ref_id ${refId} not found`);\n      }\n      \n      // Create item object with explicitly matching to ref_id\n      const item = {\n        id: packageData.ref_id.toString(), // Use ref_id for id to prevent external_id matching\n        ref_id: packageData.ref_id.toString(), // Add ref_id explicitly \n        name: packageData.name,\n        price: parseFloat(packageData.price),\n        quantity: quantity,\n        type: 'package',\n        // Flag to indicate this item should only be matched by ref_id\n        match_by_ref_id_only: true\n      };\n      \n      return this.#addToCart(item);\n    } catch (error) {\n      this.#logger.error(`Error adding item by ref_id ${refId}:`, error);\n      throw error;\n    }\n  }\n\n  removeFromCart(itemId) {\n    return this.#removeFromCart(itemId);\n  }\n\n  setShippingMethod(shippingMethodId) {\n    try {\n      // Ensure campaignData and shipping_methods are available\n      const campaignData = this.#app.campaignData;\n      if (!campaignData || !Array.isArray(campaignData.shipping_methods)) {\n        this.#logger.error('Campaign data or shipping methods not available.');\n        throw new Error('Shipping methods not loaded.');\n      }\n      \n      // Find the shipping method object by its ref_id\n      const selectedMethod = campaignData.shipping_methods.find(\n        method => method.ref_id?.toString() === shippingMethodId?.toString()\n      );\n      \n      if (!selectedMethod) {\n        this.#logger.error(`Shipping method with ID ${shippingMethodId} not found.`);\n        throw new Error(`Shipping method ID ${shippingMethodId} not found.`);\n      }\n      \n      // Pass the found object to the state manager\n      this.#logger.info(`Setting shipping method to:`, selectedMethod);\n      return this.#stateManager.setShippingMethod(selectedMethod);\n    } catch (error) {\n      this.#logger.error('Error setting shipping method:', error);\n      // this.#showMessage('Error setting shipping method', 'error');\n      throw error;\n    }\n  }\n\n  applyCoupon(couponCode, discountType = 'percentage', discountValue = 0, applicableProductIds = []) {\n    try {\n      // Pass applicableProductIds to StateManager\n      const result = this.#stateManager.applyCoupon(couponCode, discountType, discountValue, applicableProductIds);\n      \n      // Refresh unit pricing calculations if SelectorManager is available\n      if (this.#app.selector && typeof this.#app.selector.refreshUnitPricing === 'function') {\n        setTimeout(() => this.#app.selector.refreshUnitPricing(), 10);\n      }\n      \n      return result;\n    } catch (error) {\n      this.#logger.error('Error applying coupon:', error);\n      // this.#showMessage('Error applying coupon', 'error');\n      throw error;\n    }\n  }\n\n  removeCoupon() {\n    try {\n      const result = this.#stateManager.removeCoupon();\n      \n      // Refresh unit pricing calculations if SelectorManager is available\n      if (this.#app.selector && typeof this.#app.selector.refreshUnitPricing === 'function') {\n        setTimeout(() => this.#app.selector.refreshUnitPricing(), 10);\n      }\n      \n      return result;\n    } catch (error) {\n      this.#logger.error('Error removing coupon:', error);\n      // this.#showMessage('Error removing coupon', 'error');\n      throw error;\n    }\n  }\n\n  getCouponDetails() {\n    const cart = this.#stateManager.getState('cart');\n    return cart.couponDetails;\n  }\n\n  async syncCartWithApi() {\n    try {\n      return await this.#stateManager.syncCartWithApi();\n    } catch (error) {\n      this.#logger.error('Error syncing cart with API:', error);\n      // this.#showMessage('Error syncing cart with server', 'error');\n      throw error;\n    }\n  }\n\n  isItemInCart(itemId) {\n    return this.#stateManager.isItemInCart?.(itemId) ?? this.#stateManager.getState('cart').items.some(item => item.id === itemId);\n  }\n\n  // #showMessage(message, type = 'success') {\n  //   const messageElement = document.createElement('div');\n  //   messageElement.className = `os-message os-message-${type}`;\n  //   messageElement.textContent = message;\n  //   document.body.appendChild(messageElement);\n  //   setTimeout(() => {\n  //     messageElement.classList.add('os-message-hide');\n  //     setTimeout(() => document.body.removeChild(messageElement), 300);\n  //   }, 3000);\n  // }\n}", "/**\n * DebugUtils - Utilities for debugging components\n */\n\nexport class DebugUtils {\n  static #debugStylesInjected = false;\n  static #isDebugMode = false;\n  static #xrayEnabled = false;\n  static #overlays = [];\n\n  /**\n   * Initialize debug mode by checking URL parameters\n   * @returns {boolean} Whether debug mode is enabled\n   */\n  static initDebugMode() {\n    const urlParams = new URLSearchParams(window.location.search);\n    this.#isDebugMode = urlParams.get('debugger') === 'true';\n    \n    if (this.#isDebugMode && !this.#debugStylesInjected) {\n      this.injectDebugStyles();\n      this.#xrayEnabled = localStorage.getItem('os_debug_xray_enabled') === 'true';\n    }\n    \n    return this.#isDebugMode;\n  }\n\n  /**\n   * Check if debug mode is enabled\n   * @returns {boolean} Whether debug mode is enabled\n   */\n  static isDebugMode() {\n    return this.#isDebugMode;\n  }\n\n  /**\n   * Check if X-ray mode is enabled\n   * @returns {boolean} Whether X-ray mode is enabled\n   */\n  static isXrayEnabled() {\n    return this.#xrayEnabled;\n  }\n\n  /**\n   * Toggle X-ray mode on or off\n   * @param {boolean} enabled - Whether to enable X-ray mode\n   * @returns {boolean} The new state of X-ray mode\n   */\n  static toggleXray(enabled = !this.#xrayEnabled) {\n    if (!this.#isDebugMode) return false;\n    \n    this.#xrayEnabled = enabled;\n    localStorage.setItem('os_debug_xray_enabled', this.#xrayEnabled.toString());\n    \n    // Toggle visibility of all overlays\n    this.#overlays.forEach(overlay => {\n      overlay.style.display = this.#xrayEnabled ? 'block' : 'none';\n    });\n    \n    return this.#xrayEnabled;\n  }\n\n  /**\n   * Inject debug styles into the document head\n   */\n  static injectDebugStyles() {\n    if (this.#debugStylesInjected) return;\n    \n    const styleElement = document.createElement('style');\n    styleElement.id = 'os-debug-styles';\n    styleElement.textContent = `\n      /* Common debug styles */\n      .os-debug-overlay {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n        z-index: 9999;\n        border: 2px dashed rgba(255, 0, 0, 0.7);\n        box-sizing: border-box;\n      }\n      .os-debug-label {\n        position: absolute;\n        top: 0;\n        right: 0;\n        background-color: rgba(0, 0, 0, 0.7);\n        color: white;\n        font-size: 12px;\n        padding: 2px 6px;\n        border-radius: 0 0 0 4px;\n        font-family: monospace;\n        z-index: 10000;\n      }\n      \n      /* Selector-specific styles */\n      .os-debug-card-overlay {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n        z-index: 9998;\n        border: 1px solid rgba(0, 255, 255, 0.7);\n        box-sizing: border-box;\n      }\n      .os-debug-card-label {\n        position: absolute;\n        top: 0;\n        right: 0;\n        background-color: rgba(0, 0, 0, 0.7);\n        color: white;\n        font-size: 10px;\n        padding: 1px 4px;\n        border-radius: 0 0 0 4px;\n        font-family: monospace;\n        z-index: 9999;\n      }\n      .os--selected .os-debug-card-overlay {\n        border: 2px solid rgba(0, 255, 0, 0.9);\n      }\n      .os--active .os-debug-card-overlay {\n        background-color: rgba(255, 255, 0, 0.2);\n      }\n      \n      /* Toggle-specific styles */\n      .os-debug-toggle-overlay {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n        z-index: 9998;\n        border: 1px solid rgba(255, 165, 0, 0.7);\n        box-sizing: border-box;\n      }\n      .os-debug-toggle-label {\n        position: absolute;\n        top: 0;\n        right: 0;\n        background-color: rgba(0, 0, 0, 0.7);\n        color: white;\n        font-size: 10px;\n        padding: 1px 4px;\n        border-radius: 0 0 0 4px;\n        font-family: monospace;\n        z-index: 9999;\n      }\n      [data-os-active=\"true\"] .os-debug-toggle-overlay {\n        background-color: rgba(255, 165, 0, 0.3);\n        border: 2px solid rgba(255, 165, 0, 0.9);\n      }\n      \n      /* Upsell styles */\n      .os-debug-upsell-overlay {\n        border: 2px dashed rgba(76, 175, 80, 0.9) !important;\n      }\n      .os-debug-upsell-label {\n        background-color: rgba(76, 175, 80, 0.9) !important;\n      }\n      .os-debug-upsell-badge {\n        display: inline-block;\n        background-color: rgba(76, 175, 80, 0.9);\n        color: white;\n        font-size: 9px;\n        padding: 1px 3px;\n        border-radius: 2px;\n        margin-left: 4px;\n        vertical-align: middle;\n      }\n      \n      /* Debug bar styles */\n      .os-debug-bar {\n        position: fixed;\n        bottom: 0;\n        left: 0;\n        width: 100%;\n        background-color: rgba(33, 33, 33, 0.9);\n        color: white;\n        font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        font-size: 14px;\n        z-index: 10001;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 8px 16px;\n        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);\n      }\n      \n      .os-debug-bar-title {\n        font-weight: 600;\n        margin-right: 20px;\n      }\n      \n      .os-debug-bar-controls {\n        display: flex;\n        align-items: center;\n      }\n      \n      .os-debug-bar-control {\n        margin: 0 10px;\n        display: flex;\n        align-items: center;\n      }\n      \n      .os-debug-bar-toggle {\n        position: relative;\n        display: inline-block;\n        width: 40px;\n        height: 20px;\n        margin-left: 8px;\n      }\n      \n      .os-debug-bar-toggle input {\n        opacity: 0;\n        width: 0;\n        height: 0;\n      }\n      \n      .os-debug-bar-slider {\n        position: absolute;\n        cursor: pointer;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background-color: #ccc;\n        transition: .4s;\n        border-radius: 20px;\n      }\n      \n      .os-debug-bar-slider:before {\n        position: absolute;\n        content: \"\";\n        height: 16px;\n        width: 16px;\n        left: 2px;\n        bottom: 2px;\n        background-color: white;\n        transition: .4s;\n        border-radius: 50%;\n      }\n      \n      input:checked + .os-debug-bar-slider {\n        background-color: #2196F3;\n      }\n      \n      input:checked + .os-debug-bar-slider:before {\n        transform: translateX(20px);\n      }\n      \n      .os-debug-bar-button {\n        background-color: #2196F3;\n        color: white;\n        border: none;\n        border-radius: 4px;\n        padding: 4px 10px;\n        font-size: 12px;\n        cursor: pointer;\n        margin-left: 10px;\n      }\n      \n      .os-debug-bar-button:hover {\n        background-color: #0b7dda;\n      }\n    `;\n    \n    document.head.appendChild(styleElement);\n    this.#debugStylesInjected = true;\n  }\n\n  /**\n   * Add a debug overlay to an element\n   * @param {HTMLElement} element - The element to add the overlay to\n   * @param {string} id - The ID to display\n   * @param {string} type - The type of element\n   * @param {Object} additionalInfo - Additional information to display\n   */\n  static addDebugOverlay(element, id, type, additionalInfo = {}) {\n    if (!this.#isDebugMode) return;\n    \n    // Make sure the element has position relative for absolute positioning of the overlay\n    const computedStyle = window.getComputedStyle(element);\n    if (computedStyle.position === 'static') {\n      element.style.position = 'relative';\n    }\n\n    const overlay = document.createElement('div');\n    overlay.className = `os-debug-${type}-overlay`;\n    \n    const label = document.createElement('div');\n    label.className = `os-debug-${type}-label`;\n    \n    // Check if this is an upsell element\n    const isUpsell = additionalInfo.Upsell === 'Yes';\n    if (isUpsell) {\n      overlay.classList.add('os-debug-upsell-overlay');\n      label.classList.add('os-debug-upsell-label');\n    }\n    \n    // Build label text\n    let labelText = `ID: ${id}`;\n    \n    // Add additional info\n    Object.entries(additionalInfo).forEach(([key, value]) => {\n      // Add upsell badge if this is the upsell property\n      if (key === 'Upsell' && value === 'Yes') {\n        labelText += ` | ${key}: <span class=\"os-debug-upsell-badge\">UPSELL</span>`;\n      } else {\n        labelText += ` | ${key}: ${value}`;\n      }\n    });\n    \n    label.innerHTML = labelText;\n    \n    // Set initial visibility based on X-ray mode\n    if (!this.#xrayEnabled) {\n      overlay.style.display = 'none';\n      label.style.display = 'none';\n    }\n    \n    element.appendChild(overlay);\n    element.appendChild(label);\n    \n    // Track overlays for toggling\n    this.#overlays.push(overlay);\n    this.#overlays.push(label);\n  }\n} ", "/**\r\n * SelectorManager - Manages selector components\r\n */\r\n\r\nimport { DebugUtils } from '../utils/DebugUtils.js';\r\n\r\nexport class SelectorManager {\r\n  #app;\r\n  #logger;\r\n  #selectors = {};\r\n  #selectedItems = {};\r\n  #isDebugMode = false;\r\n\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#logger = app.logger.createModuleLogger('SELECTOR');\r\n    this.#isDebugMode = DebugUtils.initDebugMode();\r\n    this.#initSelectors();\r\n    this.#logger.info('SelectorManager initialized');\r\n    if (this.#isDebugMode) {\r\n      this.#logger.info('Debug mode enabled for selectors');\r\n    }\r\n  }\r\n\r\n  #initSelectors() {\r\n    document.querySelectorAll('[data-os-component=\"selector\"][data-os-selection-mode=\"swap\"]').forEach(selector => this.#initSelector(selector));\r\n    setTimeout(() => this.#syncWithCart(), 0);\r\n    this.#app.state?.subscribe('cart', () => this.#syncWithCart());\r\n    \r\n    // Initialize unit pricing for all selectors\r\n    this.initUnitPricing();\r\n    \r\n    // Trigger view_item_list event for visible packages after initialization\r\n    setTimeout(() => this.triggerViewItemList(), 100);\r\n  }\r\n\r\n  #initSelector(selectorElement) {\r\n    const selectorId = selectorElement.getAttribute('data-os-id');\r\n    if (!selectorId) {\r\n      this.#logger.warn('Selector missing data-os-id', selectorElement);\r\n      return;\r\n    }\r\n\r\n    const mode = selectorElement.getAttribute('data-os-selection-mode') || 'swap';\r\n    \r\n    this.#selectors[selectorId] = { \r\n      element: selectorElement, \r\n      items: [],\r\n      mode\r\n    };\r\n    \r\n    this.#selectedItems[selectorId] = null;\r\n    selectorElement.querySelectorAll('[data-os-element=\"card\"]').forEach(card => this.#initCard(selectorId, card));\r\n    \r\n    if (this.#isDebugMode) {\r\n      DebugUtils.addDebugOverlay(selectorElement, selectorId, 'overlay', { 'Mode': mode });\r\n    }\r\n  }\r\n\r\n  #initCard(selectorId, cardElement) {\r\n    const packageId = cardElement.getAttribute('data-os-package');\r\n    if (!packageId) {\r\n      this.#logger.warn('Card missing data-os-package', cardElement);\r\n      return;\r\n    }\r\n\r\n    const shippingId = cardElement.getAttribute('data-os-shipping-id');\r\n\r\n    const priceElement = cardElement.querySelector('.pb-quantity__price.pb--current');\r\n    const priceText = priceElement?.textContent.trim() ?? '$0.00 USD';\r\n    const price = Number.parseFloat(priceText.match(/\\$(\\d+\\.\\d+)/)?.[1] ?? '0');\r\n\r\n    const nameElement = cardElement.querySelector('.card-title');\r\n    const name = nameElement?.textContent.trim() ?? `Package ${packageId}`;\r\n\r\n    const quantity = Number.parseInt(cardElement.getAttribute('data-os-quantity') ?? '1', 10);\r\n    const isPreSelected = cardElement.getAttribute('data-os-selected') === 'true';\r\n\r\n    const item = {\r\n      element: cardElement,\r\n      packageId,\r\n      quantity,\r\n      price,\r\n      name,\r\n      isPreSelected,\r\n      shippingId\r\n    };\r\n\r\n    this.#selectors[selectorId].items.push(item);\r\n    cardElement.addEventListener('click', () => this.#handleClick(selectorId, item));\r\n    \r\n    if (this.#isDebugMode) {\r\n      DebugUtils.addDebugOverlay(cardElement, packageId, 'card', {\r\n        'Price': `$${price}`,\r\n        'Qty': quantity,\r\n        'PreSel': isPreSelected ? 'Yes' : 'No',\r\n        'ShipID': shippingId || 'None'\r\n      });\r\n    }\r\n  }\r\n\r\n  #handleClick(selectorId, item) {\r\n    const previous = this.#selectedItems[selectorId];\r\n    this.#selectItem(selectorId, item);\r\n    this.#updateCart(selectorId, previous);\r\n\r\n    if (item.shippingId !== null && item.shippingId !== undefined) {\r\n      this.#logger.info(`Setting shipping method to ${item.shippingId} based on selected card ${item.packageId}`);\r\n      try {\r\n        this.#app.cart.setShippingMethod(item.shippingId);\r\n      } catch (error) {\r\n        this.#logger.error(`Failed to set shipping method ${item.shippingId}:`, error);\r\n      }\r\n    }\r\n  }\r\n\r\n  #selectItem(selectorId, item) {\r\n    if (this.#selectedItems[selectorId] === item) return;\r\n\r\n    this.#selectors[selectorId].items.forEach(i => {\r\n      i.element.classList.remove('os--selected');\r\n      i.element.setAttribute('data-os-selected', 'false');\r\n      i.isSelected = false;\r\n    });\r\n\r\n    item.element.classList.add('os--selected');\r\n    item.element.setAttribute('data-os-selected', 'true');\r\n    item.isSelected = true;\r\n    this.#selectedItems[selectorId] = item;\r\n    this.#logger.debug(`Selected item ${item.packageId} in selector ${selectorId}`);\r\n  }\r\n\r\n  #updateCart(selectorId, previousItem) {\r\n    if (!this.#app.cart) {\r\n      this.#logger.error('Cart manager not available');\r\n      return;\r\n    }\r\n\r\n    const selected = this.#selectedItems[selectorId];\r\n    if (!selected) return;\r\n\r\n    if (previousItem && previousItem.packageId !== selected.packageId) {\r\n      this.#removeItemFromCart(previousItem);\r\n    }\r\n\r\n    if (!this.#app.cart.isItemInCart(selected.packageId)) {\r\n      this.#addItemToCart(selected);\r\n    }\r\n\r\n    const currentSelectedItem = this.#selectedItems[selectorId];\r\n    if (currentSelectedItem && currentSelectedItem.shippingId !== null && currentSelectedItem.shippingId !== undefined) {\r\n      const currentCartShippingMethod = this.#app.state?.getState('cart')?.shippingMethod?.ref_id;\r\n      if (currentCartShippingMethod?.toString() !== currentSelectedItem.shippingId.toString()) {\r\n        this.#logger.info(`Syncing shipping method to ${currentSelectedItem.shippingId} for selected item ${currentSelectedItem.packageId}`);\r\n        try {\r\n          this.#app.cart.setShippingMethod(currentSelectedItem.shippingId);\r\n        } catch (error) {\r\n          this.#logger.error(`Failed to sync shipping method ${currentSelectedItem.shippingId}:`, error);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  #addItemToCart(item) {\r\n    if (!this.#app.cart) {\r\n      this.#logger.error('Cart manager not available in addItemToCart');\r\n      return;\r\n    }\r\n    if (typeof this.#app.cart.addToCart !== 'function') {\r\n      this.#logger.error('addToCart is not a function on this.#app.cart:', this.#app.cart);\r\n      return;\r\n    }\r\n\r\n    this.#logger.info(`Adding item ${item.packageId} to cart`);\r\n    this.#app.cart.addToCart({\r\n      id: item.packageId,\r\n      name: item.name,\r\n      price: item.price,\r\n      quantity: item.quantity,\r\n      type: 'package'\r\n    });\r\n\r\n    item.element.classList.add('os--active');\r\n    item.element.setAttribute('data-os-active', 'true');\r\n  }\r\n\r\n  #removeItemFromCart(item) {\r\n    if (!this.#app.cart) {\r\n      this.#logger.error('Cart manager not available in removeItemFromCart');\r\n      return;\r\n    }\r\n    if (typeof this.#app.cart.removeFromCart !== 'function') {\r\n      this.#logger.error('removeFromCart is not a function on this.#app.cart:', this.#app.cart);\r\n      return;\r\n    }\r\n\r\n    this.#logger.info(`Removing item ${item.packageId} from cart`);\r\n    this.#app.cart.removeFromCart(item.packageId);\r\n\r\n    item.element.classList.remove('os--active');\r\n    item.element.setAttribute('data-os-active', 'false');\r\n  }\r\n\r\n  #syncWithCart() {\r\n    if (!this.#app.cart) {\r\n      this.#logger.debug('Cart manager not available for sync');\r\n      return;\r\n    }\r\n\r\n    const cart = this.#app.state?.getState('cart');\r\n    if (!cart) {\r\n      this.#logger.debug('Cart state not available');\r\n      return;\r\n    }\r\n\r\n    this.#logger.debug('Syncing with cart, this.#app.cart:', this.#app.cart);\r\n\r\n    Object.keys(this.#selectors).forEach(selectorId => {\r\n      const items = this.#selectors[selectorId].items;\r\n      const cartItemsInSelector = items.filter(item => this.#app.cart.isItemInCart(item.packageId));\r\n\r\n      if (cartItemsInSelector.length > 0) {\r\n        const itemInCart = cartItemsInSelector[0];\r\n        this.#selectItem(selectorId, itemInCart);\r\n        cartItemsInSelector.forEach(item => {\r\n          if (item.packageId !== itemInCart.packageId) this.#removeItemFromCart(item);\r\n        });\r\n      } else if (!this.#selectedItems[selectorId]) {\r\n        const preSelected = items.find(item => item.isPreSelected);\r\n        if (preSelected) {\r\n          this.#selectItem(selectorId, preSelected);\r\n          this.#addItemToCart(preSelected);\r\n        }\r\n      }\r\n\r\n      items.forEach(item => {\r\n        const isInCart = this.#app.cart.isItemInCart(item.packageId);\r\n        item.element.classList.toggle('os--active', isInCart);\r\n        item.element.setAttribute('data-os-active', isInCart.toString());\r\n      });\r\n      \r\n      const currentSelectedItem = this.#selectedItems[selectorId];\r\n      if (currentSelectedItem && currentSelectedItem.shippingId !== null && currentSelectedItem.shippingId !== undefined) {\r\n        const currentCartShippingMethod = this.#app.state?.getState('cart')?.shippingMethod?.ref_id;\r\n        if (currentCartShippingMethod?.toString() !== currentSelectedItem.shippingId.toString()) {\r\n          this.#logger.info(`Syncing shipping method to ${currentSelectedItem.shippingId} for selected item ${currentSelectedItem.packageId}`);\r\n          try {\r\n            this.#app.cart.setShippingMethod(currentSelectedItem.shippingId);\r\n          } catch (error) {\r\n            this.#logger.error(`Failed to sync shipping method ${currentSelectedItem.shippingId}:`, error);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initialize unit pricing for all selectors\r\n   * This populates any elements with data-card-price attributes\r\n   */\r\n  initUnitPricing() {\r\n    this.#logger.info('Initializing unit pricing for selectors');\r\n    // Add a delay to ensure campaign data is loaded\r\n    setTimeout(() => {\r\n      Object.keys(this.#selectors).forEach(selectorId => {\r\n        this.#initUnitPricingForSelector(selectorId);\r\n      });\r\n    }, 100);\r\n  }\r\n\r\n  /**\r\n   * Initialize unit pricing for a specific selector\r\n   * @param {string} selectorId - The ID of the selector\r\n   */\r\n  #initUnitPricingForSelector(selectorId) {\r\n    const selector = this.#selectors[selectorId];\r\n    if (!selector) {\r\n      this.#logger.warn(`Selector ${selectorId} not found for unit pricing`);\r\n      return;\r\n    }\r\n\r\n    // Get package data from the campaign data\r\n    const campaignData = this.#app?.campaignData;\r\n    if (!campaignData || !campaignData.packages) {\r\n      this.#logger.warn('Campaign data not available for unit pricing');\r\n      return;\r\n    }\r\n\r\n    selector.items.forEach(item => {\r\n      this.#updateUnitPricingForCard(item, campaignData.packages);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update unit pricing for a specific card\r\n   * @param {Object} item - The item object\r\n   * @param {Array} packages - The packages array from campaign data\r\n   */\r\n  #updateUnitPricingForCard(item, packages) {\r\n    // Find the package data for this card\r\n    const packageData = packages.find(pkg => \r\n      pkg.ref_id.toString() === item.packageId.toString() || \r\n      (pkg.external_id && pkg.external_id.toString() === item.packageId.toString())\r\n    );\r\n\r\n    if (!packageData) {\r\n      this.#logger.debug(`Package data not found for item ${item.packageId}`);\r\n      return;\r\n    }\r\n\r\n    const cardElement = item.element;\r\n    \r\n    // Log package data for debugging\r\n    this.#logger.debug(`Processing unit pricing for package ${item.packageId}:`, {\r\n      packageId: item.packageId,\r\n      name: packageData.name,\r\n      price: packageData.price,\r\n      price_total: packageData.price_total,\r\n      price_retail: packageData.price_retail,\r\n      price_retail_total: packageData.price_retail_total,\r\n      qty: packageData.qty\r\n    });\r\n    \r\n    // Calculate unit metrics\r\n    const totalUnits = packageData.qty || 1;\r\n    let totalPrice = Number.parseFloat(packageData.price_total) || Number.parseFloat(packageData.price) * totalUnits;\r\n    const totalRetailPrice = Number.parseFloat(packageData.price_retail_total) || \r\n                             (Number.parseFloat(packageData.price_retail) * totalUnits) || \r\n                             totalPrice;\r\n    \r\n    // Check if there's an active coupon that affects this package\r\n    const couponDetails = this.#app.cart?.getCouponDetails?.();\r\n    let discountedTotalPrice = totalPrice;\r\n    \r\n    if (couponDetails) {\r\n      this.#logger.debug(`Active coupon found for unit pricing calculations:`, couponDetails);\r\n      \r\n      // If it's a percentage coupon, apply the discount to the package price\r\n      if (couponDetails.type === 'percentage' && couponDetails.value > 0) {\r\n        const discountPercentage = couponDetails.value / 100;\r\n        discountedTotalPrice = totalPrice * (1 - discountPercentage);\r\n        this.#logger.debug(`Applied ${couponDetails.value}% discount to package price: ${totalPrice} -> ${discountedTotalPrice}`);\r\n      } \r\n      // If it's a fixed amount coupon, distribute it proportionally across all items\r\n      else if (couponDetails.type === 'fixed' && couponDetails.value > 0) {\r\n        // Get cart total before discount to calculate proportional discount\r\n        const cart = this.#app.state?.getState('cart');\r\n        if (cart && cart.totals && cart.totals.original_subtotal > 0) {\r\n          const cartSubtotal = cart.totals.original_subtotal;\r\n          const packageProportion = totalPrice / cartSubtotal;\r\n          const packageDiscount = couponDetails.value * packageProportion;\r\n          \r\n          // Don't let discount exceed the package price\r\n          discountedTotalPrice = Math.max(0, totalPrice - packageDiscount);\r\n          this.#logger.debug(`Applied proportional fixed discount (${packageDiscount.toFixed(2)}) to package price: ${totalPrice} -> ${discountedTotalPrice}`);\r\n        }\r\n      }\r\n      // Free shipping doesn't affect product prices\r\n    }\r\n    \r\n    // Use the discounted price for calculations\r\n    totalPrice = discountedTotalPrice;\r\n    \r\n    // Calculate unit prices\r\n    const unitPrice = totalPrice / totalUnits;\r\n    const unitRetailPrice = totalRetailPrice / totalUnits;\r\n    const unitSavings = unitRetailPrice - unitPrice;\r\n    const unitSavingsPercentage = unitRetailPrice > 0 ? (unitSavings / unitRetailPrice) * 100 : 0;\r\n    \r\n    // Calculate total savings\r\n    const totalSavings = totalRetailPrice - totalPrice;\r\n    const totalSavingsPercentage = totalRetailPrice > 0 ? (totalSavings / totalRetailPrice) * 100 : 0;\r\n    \r\n    // Log calculated values for debugging\r\n    this.#logger.debug(`Calculated prices for package ${item.packageId}:`, {\r\n      totalUnits,\r\n      totalPrice,\r\n      totalRetailPrice,\r\n      totalSavings,\r\n      totalSavingsPercentage,\r\n      unitPrice,\r\n      unitRetailPrice,\r\n      unitSavings,\r\n      unitSavingsPercentage\r\n    });\r\n    \r\n    // Format prices\r\n    const formatPrice = (price) => {\r\n      if (this.#app.campaign?.formatPrice) {\r\n        return this.#app.campaign.formatPrice(price);\r\n      }\r\n      return `$${price.toFixed(2)}`;\r\n    };\r\n    \r\n    // Track which elements have been processed with data-divide-by\r\n    const processedElements = new Set();\r\n    \r\n    // Look for any data-divide-by elements to calculate subunit pricing (e.g., price per facial)\r\n    const subunitElements = cardElement.querySelectorAll('[data-divide-by]');\r\n    if (subunitElements.length > 0) {\r\n      this.#logger.debug(`Found ${subunitElements.length} elements with data-divide-by in card ${item.packageId}`);\r\n      \r\n      subunitElements.forEach(element => {\r\n        const divisor = parseFloat(element.getAttribute('data-divide-by'));\r\n        if (!isNaN(divisor) && divisor > 0) {\r\n          const type = element.getAttribute('data-card-price');\r\n          \r\n          // Skip elements without a data-card-price attribute\r\n          if (!type) {\r\n            this.#logger.debug(`Skipping element with data-divide-by but no data-card-price attribute`);\r\n            return;\r\n          }\r\n          \r\n          let value;\r\n          \r\n          // Calculate the subunit value based on the type\r\n          switch (type) {\r\n            case 'each-sale':\r\n              value = unitPrice / divisor;\r\n              break;\r\n            case 'each-regular':\r\n              value = unitRetailPrice / divisor;\r\n              break;\r\n            case 'saving-amount':\r\n              value = unitSavings / divisor;\r\n              break;\r\n            case 'saving-percentage':\r\n              value = unitSavingsPercentage; // Percentage stays the same regardless of division\r\n              break;\r\n            case 'total-sale':\r\n              value = totalPrice / divisor;\r\n              break;\r\n            case 'total-regular':\r\n              value = totalRetailPrice / divisor;\r\n              break;\r\n            case 'total-saving-amount':\r\n              value = totalSavings / divisor;\r\n              break;\r\n            case 'total-saving-percentage':\r\n              value = totalSavingsPercentage; // Percentage stays the same\r\n              break;\r\n            default:\r\n              this.#logger.debug(`Unknown price type: ${type}`);\r\n              return;\r\n          }\r\n          \r\n          // Format the value\r\n          let formattedValue;\r\n          if (type.includes('percentage')) {\r\n            formattedValue = `${Math.round(value)}%`;\r\n          } else {\r\n            formattedValue = formatPrice(value);\r\n          }\r\n          \r\n          // Update the element\r\n          this.#logger.debug(`Setting price for element with data-divide-by=\"${divisor}\":`, {\r\n            attributeType: type,\r\n            originalValue: element.textContent,\r\n            calculatedValue: value,\r\n            formattedValue: formattedValue,\r\n            element: element.outerHTML\r\n          });\r\n          \r\n          element.textContent = formattedValue;\r\n          \r\n          // Mark this element as processed\r\n          processedElements.add(element);\r\n          \r\n          this.#logger.debug(`Updated element with data-divide-by=\"${divisor}\" for ${type}: ${formattedValue}`);\r\n        }\r\n      });\r\n    }\r\n\r\n    // UNIT PRICING - Update elements with data-card-price attribute (skip those already processed)\r\n    this.#updatePriceElement(cardElement, 'each-sale', formatPrice(unitPrice), processedElements);\r\n    this.#updatePriceElement(cardElement, 'each-regular', formatPrice(unitRetailPrice), processedElements);\r\n    this.#updatePriceElement(cardElement, 'saving-amount', formatPrice(unitSavings), processedElements);\r\n    this.#updatePriceElement(cardElement, 'saving-percentage', `${Math.round(unitSavingsPercentage)}%`, processedElements);\r\n    \r\n    // TOTAL PRICING - Add support for total package prices\r\n    this.#updatePriceElement(cardElement, 'total-sale', formatPrice(totalPrice), processedElements);\r\n    this.#updatePriceElement(cardElement, 'total-regular', formatPrice(totalRetailPrice), processedElements);\r\n    this.#updatePriceElement(cardElement, 'total-saving-amount', formatPrice(totalSavings), processedElements);\r\n    this.#updatePriceElement(cardElement, 'total-saving-percentage', `${Math.round(totalSavingsPercentage)}%`, processedElements);\r\n    \r\n    this.#logger.debug(`Updated pricing for card ${item.packageId}: ${formatPrice(unitPrice)} per unit, ${formatPrice(totalPrice)} total`);\r\n  }\r\n\r\n  /**\r\n   * Format a price with currency symbol\r\n   * @param {number} price - Price to format\r\n   * @returns {string} Formatted price\r\n   */\r\n  #formatPrice(price) {\r\n    // Use the campaign's formatPrice method if available\r\n    if (this.#app.campaign?.formatPrice) {\r\n      return this.#app.campaign.formatPrice(price);\r\n    }\r\n    \r\n    // Otherwise, use a simple formatter\r\n    return `$${price.toFixed(2)}`;\r\n  }\r\n\r\n  /**\r\n   * Update a price element with the calculated value\r\n   * @param {HTMLElement} cardElement - The card element\r\n   * @param {string} type - The price type\r\n   * @param {string} value - The formatted price value\r\n   * @param {Set} processedElements - Set of elements that have already been processed\r\n   */\r\n  #updatePriceElement(cardElement, type, value, processedElements = new Set()) {\r\n    const priceElements = cardElement.querySelectorAll(`[data-card-price=\"${type}\"]`);\r\n    \r\n    if (priceElements.length > 0) {\r\n      priceElements.forEach(element => {\r\n        // Skip elements that have already been processed with data-divide-by\r\n        if (processedElements.has(element)) {\r\n          return;\r\n        }\r\n        \r\n        element.textContent = value;\r\n        \r\n        // If the price is 0 or negative, optionally hide the element\r\n        const hideIfZero = element.getAttribute('data-hide-if-zero') === 'true';\r\n        const numericValue = parseFloat(value.replace(/[^0-9.-]+/g, ''));\r\n        \r\n        if (hideIfZero && (numericValue <= 0)) {\r\n          element.style.display = 'none';\r\n          // Also hide parent if it has data-container attribute\r\n          const container = element.closest('[data-container=\"true\"]');\r\n          if (container) container.style.display = 'none';\r\n        } else {\r\n          element.style.display = '';\r\n          // Show parent if it was hidden\r\n          const container = element.closest('[data-container=\"true\"]');\r\n          if (container) container.style.display = '';\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refresh unit pricing for all selectors\r\n   * This can be called after campaign data is updated\r\n   */\r\n  refreshUnitPricing() {\r\n    this.initUnitPricing();\r\n  }\r\n\r\n  /**\r\n   * Trigger view_item_list event for all visible packages on the page\r\n   * This method is public so it can be called from EventManager if needed\r\n   */\r\n  triggerViewItemList() {\r\n    const campaignData = this.#app.getCampaignData();\r\n    if (!campaignData || !campaignData.packages || campaignData.packages.length === 0) {\r\n      this.#logger.warn('Cannot trigger view_item_list: No packages in campaign data');\r\n      return;\r\n    }\r\n    \r\n    // Collect all package IDs present on the page\r\n    const visiblePackageIds = new Set();\r\n    const visiblePackages = [];\r\n    \r\n    // Iterate through all selectors to find visible packages\r\n    Object.values(this.#selectors).forEach(selector => {\r\n      selector.items.forEach(item => {\r\n        if (item.packageId) {\r\n          visiblePackageIds.add(item.packageId.toString());\r\n        }\r\n      });\r\n    });\r\n    \r\n    // For debugging, log the found packages\r\n    this.#logger.debug(`Found ${visiblePackageIds.size} unique package IDs in selectors`);\r\n    \r\n    // Find matching packages in campaign data\r\n    campaignData.packages.forEach(pkg => {\r\n      const refIdStr = pkg.ref_id?.toString();\r\n      const externalIdStr = pkg.external_id?.toString();\r\n      \r\n      if (visiblePackageIds.has(refIdStr) || visiblePackageIds.has(externalIdStr)) {\r\n        visiblePackages.push(pkg);\r\n      }\r\n    });\r\n    \r\n    // If we found matching packages, trigger the event\r\n    if (visiblePackages.length > 0) {\r\n      this.#logger.info(`Triggering view_item_list for ${visiblePackages.length} visible packages`);\r\n      \r\n      // Create a filtered version of campaign data\r\n      const filteredCampaignData = {\r\n        ...campaignData,\r\n        packages: visiblePackages\r\n      };\r\n      \r\n      // Check which method to use based on what's available\r\n      if (this.#app.eventManager?.viewItemList) {\r\n        // Use EventManager's viewItemList if available\r\n        this.#app.eventManager.viewItemList(filteredCampaignData);\r\n        this.#logger.debug('Used eventManager.viewItemList to fire event');\r\n      } else if (this.#app.events?.viewItemList) {\r\n        // Fall back to events system\r\n        this.#app.events.viewItemList(filteredCampaignData);\r\n        this.#logger.debug('Used events.viewItemList to fire event');\r\n      } else {\r\n        this.#logger.warn('No suitable method found to trigger view_item_list');\r\n      }\r\n    } else {\r\n      this.#logger.warn('No matching packages found between selectors and campaign data');\r\n    }\r\n  }\r\n}", "/**\r\n * ToggleManager - Manages toggle item buttons in the DOM\r\n * \r\n * This class handles toggle item buttons that can add/remove items from the cart.\r\n */\r\n\r\nimport { DebugUtils } from '../utils/DebugUtils.js';\r\n\r\nexport class ToggleManager {\r\n  #packageToggles = {}; // Renamed and restructured: Key is packageId\r\n  #app;\r\n  #logger;\r\n  #isDebugMode = false;\r\n\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#logger = app.logger.createModuleLogger('TOGGLE');\r\n    this.#isDebugMode = DebugUtils.initDebugMode();\r\n    this.#initAndRegisterToggleElements();\r\n    this.#app.state.subscribe('cart', () => this.#updateAllToggleUIs()); // Changed method name\r\n    this.#logger.info('ToggleManager initialized');\r\n    if (this.#isDebugMode) {\r\n      this.#logger.info('Debug mode enabled for toggle items');\r\n    }\r\n  }\r\n\r\n  #initAndRegisterToggleElements() {\r\n    const toggleElements = document.querySelectorAll('[data-os-action=\"toggle-item\"]');\r\n    if (!toggleElements.length) {\r\n      this.#logger.debug('No toggle item buttons found.');\r\n      return;\r\n    }\r\n    this.#logger.info(`Found ${toggleElements.length} toggle item button elements.`);\r\n    toggleElements.forEach(element => this.#registerToggleElement(element));\r\n    this.#updateAllToggleUIs(); // Initial UI update based on loaded cart state\r\n  }\r\n\r\n  #registerToggleElement(toggleElement) {\r\n    const packageId = toggleElement.getAttribute('data-os-package');\r\n    if (!packageId) {\r\n      this.#logger.warn('Toggle element missing data-os-package attribute', toggleElement);\r\n      return;\r\n    }\r\n\r\n    const quantity = Number.parseInt(toggleElement.getAttribute('data-os-quantity') ?? '1', 10);\r\n\r\n    // If this packageId hasn't been seen, initialize its entry\r\n    if (!this.#packageToggles[packageId]) {\r\n      this.#packageToggles[packageId] = {\r\n        packageId: packageId,\r\n        quantity: quantity, // Assume quantity is consistent for the package\r\n        elements: [] // Array to hold all DOM elements for this package\r\n      };\r\n      this.#logger.debug(`[INIT] Creating new toggle registration for packageId: ${packageId}`);\r\n    } else {\r\n       // Optional: Warn if quantity differs between buttons for the same package\r\n       if (this.#packageToggles[packageId].quantity !== quantity) {\r\n           this.#logger.warn(`Toggle button for package ${packageId} has different quantity (${quantity}) than previously registered (${this.#packageToggles[packageId].quantity}). Using first quantity found.`);\r\n       }\r\n    }\r\n\r\n    // Add the current DOM element to the list for this packageId\r\n    this.#packageToggles[packageId].elements.push(toggleElement);\r\n    this.#logger.debugWithTime(`[INIT] Registered element for packageId: ${packageId}. Total elements for this package: ${this.#packageToggles[packageId].elements.length}`);\r\n\r\n    // Add event listener to this specific element\r\n    toggleElement.addEventListener('click', event => {\r\n      event.preventDefault();\r\n      this.#processToggleAction(packageId, toggleElement); // Pass packageId and the clicked element\r\n    });\r\n\r\n    // Add debug overlay if needed\r\n    if (this.#isDebugMode) {\r\n      this.#addDebugOverlay(toggleElement, packageId, quantity);\r\n    }\r\n  }\r\n\r\n  // Note: Removed toggleId parameter as it's not the primary key anymore\r\n  #addDebugOverlay(element, packageId, quantity) { \r\n    const packageData = this.#getPackageDataFromCampaign(packageId);\r\n    const price = packageData ? packageData.price : 'N/A';\r\n    const isUpsell = element.hasAttribute('data-os-upsell') ? \r\n      element.getAttribute('data-os-upsell') === 'true' : \r\n      (element.closest('[data-os-upsell-section]') !== null);\r\n    \r\n    // Use packageId or a unique element identifier if needed for the DebugUtils key\r\n    DebugUtils.addDebugOverlay(element, `toggle-${packageId}-${this.#packageToggles[packageId]?.elements.length || 0}`, 'toggle', {\r\n      'Package': packageId,\r\n      'Qty': quantity,\r\n      'Price': price,\r\n      'Upsell': isUpsell ? 'Yes' : 'No'\r\n    });\r\n  }\r\n\r\n  // Renamed from #toggleItem, takes packageId and the specific element clicked\r\n  #processToggleAction(packageId, clickedElement) {\r\n    const packageInfo = this.#packageToggles[packageId];\r\n    if (!packageInfo) {\r\n      this.#logger.error(`Toggle package info for packageId ${packageId} not found`);\r\n      return;\r\n    }\r\n\r\n    const { quantity } = packageInfo; // Use quantity from registered package info\r\n    const isInCart = this.#isItemInCart(packageId);\r\n\r\n    if (isInCart) {\r\n      this.#removeItemFromCart(packageId);\r\n      this.#logger.info(`Toggled OFF item ${packageId}`);\r\n    } else {\r\n      const packageData = this.#getPackageDataFromCampaign(packageId);\r\n      if (!packageData) {\r\n        this.#logger.error(`Package ${packageId} not found in campaign data`);\r\n        return;\r\n      }\r\n\r\n      // Check if THIS SPECIFIC clicked element represents an upsell\r\n      const isUpsell = clickedElement.hasAttribute('data-os-upsell') ? \r\n        clickedElement.getAttribute('data-os-upsell') === 'true' : \r\n        (clickedElement.closest('[data-os-upsell-section]') !== null);\r\n\r\n      this.#addItemToCart({\r\n        // Use packageId consistently for ID unless your cart expects something else\r\n        id: packageId, \r\n        name: packageData.name,\r\n        price: Number.parseFloat(packageData.price),\r\n        quantity,\r\n        type: 'package',\r\n        is_upsell: isUpsell\r\n      });\r\n      \r\n      this.#logger.info(`Toggled ON item ${packageId}${isUpsell ? ' (upsell)' : ''}`);\r\n    }\r\n\r\n    // UI update is now handled centrally by the state subscription calling #updateAllToggleUIs\r\n    // No need to call #updateToggleItemUI directly here.\r\n\r\n    // Trigger event with packageId and new state\r\n    this.#app.triggerEvent('toggle.changed', { packageId, isActive: !isInCart });\r\n  }\r\n\r\n  #getPackageDataFromCampaign(packageId) {\r\n    if (!this.#app.campaignData?.packages) {\r\n      this.#logger.error('Campaign data not available');\r\n      return null;\r\n    }\r\n    return this.#app.campaignData.packages.find(pkg => pkg.ref_id?.toString() === packageId?.toString() || pkg.id?.toString() === packageId?.toString()) ?? null;\r\n  }\r\n  \r\n  // Renamed from #updateAllToggleItemsUI\r\n  #updateAllToggleUIs() {\r\n    this.#logger.debugWithTime(`[UPDATE_ALL] Cart state changed. Updating ALL package toggle UIs.`);\r\n    Object.values(this.#packageToggles).forEach(packageInfo => { \r\n        this.#updateUIForPackage(packageInfo);\r\n    });\r\n  }\r\n\r\n  // New method to update all elements for a given package\r\n  #updateUIForPackage(packageInfo) {\r\n      const { packageId, elements } = packageInfo;\r\n      if (!elements || elements.length === 0) return;\r\n      \r\n      const isInCart = this.#isItemInCart(packageId);\r\n      this.#logger.debugWithTime(`[UPDATE_PKG_UI] Updating UI for package ${packageId}. IsInCart: ${isInCart}. Element count: ${elements.length}`);\r\n      \r\n      elements.forEach(element => {\r\n        element.classList.toggle('os--active', isInCart);\r\n        element.setAttribute('data-os-active', isInCart.toString());\r\n    \r\n        const wrapper = element.closest('[data-os-toggle-wrapper]');\r\n        if (wrapper) {\r\n          wrapper.classList.toggle('os--active', isInCart);\r\n          this.#logger.debugWithTime(`  > Toggled wrapper class for element of package ${packageId}`);\r\n        } else {\r\n          this.#logger.debugWithTime(`  > No wrapper found via closest() for element of package ${packageId}`);\r\n        }\r\n      });\r\n  }\r\n\r\n  #isItemInCart(itemId) {\r\n    // Use item.package_id now that StateManager provides it reliably\r\n    const items = this.#app.state.getState('cart')?.items || [];\r\n    const found = items.some(item => item.package_id?.toString() === itemId?.toString());\r\n    this.#logger.debugWithTime(`[isItemInCart] Checking for packageId: \"${itemId}\". Found: ${found}`);\r\n    return found; \r\n  }\r\n\r\n  #addItemToCart(item) {\r\n    if (!this.#app.cart) {\r\n      this.#logger.error('Cart manager not available');\r\n      return;\r\n    }\r\n    this.#app.cart.addToCart(item);\r\n  }\r\n\r\n  #removeItemFromCart(packageIdToRemove) { // Renamed param for clarity\r\n    if (!this.#app.cart) {\r\n      this.#logger.error('Cart manager not available');\r\n      return;\r\n    }\r\n    // Assuming CartManager.removeFromCart expects the packageId/ID used in the cart items\r\n    this.#app.cart.removeFromCart(packageIdToRemove);\r\n  }\r\n}", "/**\n * DebugManager - Provides debugging tools for developers\n * \n * This class provides debugging tools for developers, including a mini-cart widget\n * that can be toggled via console commands.\n */\n\nimport { DebugUtils } from '../utils/DebugUtils.js';\n\nexport class DebugManager {\n  #app;\n  #logger;\n  #miniCartVisible = false;\n  #miniCartElement = null;\n  #debugBarElement = null;\n  #isDebugMode = false;\n\n  constructor(app) {\n    this.#app = app;\n    this.#logger = app.logger.createModuleLogger('DEBUG');\n    this.#isDebugMode = DebugUtils.initDebugMode();\n    this.#init();\n    this.#logger.info('DebugManager initialized');\n  }\n\n  #init() {\n    // Expose debug methods to window object\n    window.showMiniCart = () => this.#showMiniCart();\n    window.hideMiniCart = () => this.#hideMiniCart();\n    window.toggleMiniCart = () => this.#toggleMiniCart();\n    window.toggleXray = (enabled) => this.#toggleXray(enabled);\n\n    // Check for URL parameter ?debugger=true\n    if (this.#isDebugMode) {\n      this.#logger.info('Debug mode activated via URL parameter');\n      this.#createDebugBar();\n      \n      // Show mini-cart if it was previously visible\n      if (localStorage.getItem('os_debug_mini_cart_visible') === 'true') {\n        this.#showMiniCart();\n      }\n    }\n\n    this.#app.state?.subscribe('cart', () => {\n      if (this.#miniCartVisible) this.#updateMiniCart();\n    });\n\n    this.#logger.debug('Debug methods exposed to window object');\n  }\n\n  #createDebugBar() {\n    if (this.#debugBarElement) return;\n\n    const debugBar = document.createElement('div');\n    debugBar.className = 'os-debug-bar';\n\n    // Left section with title\n    const leftSection = document.createElement('div');\n    leftSection.className = 'os-debug-bar-left';\n    \n    const title = document.createElement('span');\n    title.className = 'os-debug-bar-title';\n    title.textContent = '29next Debug Tools';\n    \n    leftSection.appendChild(title);\n\n    // Right section with controls\n    const rightSection = document.createElement('div');\n    rightSection.className = 'os-debug-bar-controls';\n\n    // X-ray toggle\n    const xrayControl = document.createElement('div');\n    xrayControl.className = 'os-debug-bar-control';\n    \n    const xrayLabel = document.createElement('span');\n    xrayLabel.textContent = 'X-ray View';\n    \n    const xrayToggle = document.createElement('label');\n    xrayToggle.className = 'os-debug-bar-toggle';\n    \n    const xrayCheckbox = document.createElement('input');\n    xrayCheckbox.type = 'checkbox';\n    xrayCheckbox.checked = DebugUtils.isXrayEnabled();\n    xrayCheckbox.addEventListener('change', () => this.#toggleXray(xrayCheckbox.checked));\n    \n    const xraySlider = document.createElement('span');\n    xraySlider.className = 'os-debug-bar-slider';\n    \n    xrayToggle.append(xrayCheckbox, xraySlider);\n    xrayControl.append(xrayLabel, xrayToggle);\n\n    // Mini-cart toggle\n    const cartControl = document.createElement('div');\n    cartControl.className = 'os-debug-bar-control';\n    \n    const cartButton = document.createElement('button');\n    cartButton.className = 'os-debug-bar-button';\n    cartButton.textContent = 'Toggle Mini-Cart';\n    cartButton.addEventListener('click', () => this.#toggleMiniCart());\n    \n    cartControl.appendChild(cartButton);\n\n    // Add controls to right section\n    rightSection.append(xrayControl, cartControl);\n\n    // Add sections to debug bar\n    debugBar.append(leftSection, rightSection);\n\n    // Add debug bar to document\n    document.body.appendChild(debugBar);\n    this.#debugBarElement = debugBar;\n  }\n\n  #toggleXray(enabled) {\n    const isEnabled = DebugUtils.toggleXray(enabled);\n    \n    // Update checkbox if it exists\n    if (this.#debugBarElement) {\n      const checkbox = this.#debugBarElement.querySelector('input[type=\"checkbox\"]');\n      if (checkbox) checkbox.checked = isEnabled;\n    }\n    \n    this.#logger.info(`X-ray view ${isEnabled ? 'enabled' : 'disabled'}`);\n    return isEnabled;\n  }\n\n  #showMiniCart() {\n    if (this.#miniCartVisible) {\n      this.#logger.debug('Mini-cart already visible');\n      return;\n    }\n\n    this.#logger.info('Showing mini-cart widget');\n    this.#miniCartElement ??= this.#createMiniCartElement();\n    this.#miniCartElement.style.display = 'block';\n    this.#miniCartVisible = true;\n    localStorage.setItem('os_debug_mini_cart_visible', 'true');\n    this.#updateMiniCart();\n  }\n\n  #hideMiniCart() {\n    if (!this.#miniCartVisible) {\n      this.#logger.debug('Mini-cart already hidden');\n      return;\n    }\n\n    this.#logger.info('Hiding mini-cart widget');\n    if (this.#miniCartElement) {\n      this.#miniCartElement.style.display = 'none';\n    }\n    this.#miniCartVisible = false;\n    localStorage.setItem('os_debug_mini_cart_visible', 'false');\n  }\n\n  #toggleMiniCart() {\n    this.#miniCartVisible ? this.#hideMiniCart() : this.#showMiniCart();\n  }\n\n  #createMiniCartElement() {\n    const miniCart = document.createElement('div');\n    miniCart.className = 'os-debug-mini-cart';\n    miniCart.style.cssText = `\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      width: 300px;\n      max-height: 400px;\n      overflow-y: auto;\n      background-color: white;\n      border: 1px solid #ccc;\n      border-radius: 4px;\n      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n      z-index: 9999;\n      font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n      font-size: 14px;\n      display: none;\n    `;\n\n    const header = document.createElement('div');\n    header.className = 'os-debug-mini-cart-header';\n    header.style.cssText = `\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 10px 15px;\n      background-color: #f5f5f5;\n      border-bottom: 1px solid #eee;\n    `;\n\n    const title = document.createElement('div');\n    title.className = 'os-debug-mini-cart-title';\n    title.textContent = 'Debug Mini-Cart';\n    title.style.fontWeight = '600';\n\n    const buttonContainer = document.createElement('div');\n    buttonContainer.style.display = 'flex';\n    buttonContainer.style.alignItems = 'center';\n\n    const refreshButton = document.createElement('button');\n    refreshButton.className = 'os-debug-mini-cart-refresh';\n    refreshButton.textContent = '↻';\n    refreshButton.title = 'Refresh cart data';\n    refreshButton.style.cssText = `\n      background: none;\n      border: none;\n      font-size: 16px;\n      cursor: pointer;\n      padding: 0 8px;\n      line-height: 1;\n      color: #666;\n    `;\n    refreshButton.addEventListener('click', () => {\n      this.#updateMiniCart();\n      this.#logger.info('Mini-cart data refreshed manually');\n    });\n\n    const closeButton = document.createElement('button');\n    closeButton.className = 'os-debug-mini-cart-close';\n    closeButton.textContent = '×';\n    closeButton.style.cssText = `\n      background: none;\n      border: none;\n      font-size: 20px;\n      cursor: pointer;\n      padding: 0;\n      line-height: 1;\n    `;\n    closeButton.addEventListener('click', () => this.#hideMiniCart());\n\n    buttonContainer.append(refreshButton, closeButton);\n    header.append(title, buttonContainer);\n\n    const content = document.createElement('div');\n    content.className = 'os-debug-mini-cart-content';\n    content.style.padding = '15px';\n\n    const footer = document.createElement('div');\n    footer.className = 'os-debug-mini-cart-footer';\n    footer.style.cssText = `\n      padding: 10px 15px;\n      background-color: #f5f5f5;\n      border-top: 1px solid #eee;\n      font-size: 12px;\n      color: #666;\n      text-align: center;\n    `;\n    footer.textContent = 'Use window.hideMiniCart() to hide this widget';\n\n    miniCart.append(header, content, footer);\n    document.body.appendChild(miniCart);\n\n    return miniCart;\n  }\n\n  #updateMiniCart() {\n    if (!this.#miniCartElement) return;\n\n    const content = this.#miniCartElement.querySelector('.os-debug-mini-cart-content');\n    if (!content) return;\n\n    const cart = this.#app.state?.getState('cart');\n    if (!cart) {\n      content.innerHTML = '<div style=\"color: #999; text-align: center;\">Cart data not available</div>';\n      return;\n    }\n\n    this.#logger.debug('Updating mini-cart with cart data:', cart);\n\n    const formatPrice = price => this.#app.campaign?.formatPrice(price) ?? `$${price.toFixed(2)}`;\n    let html = '';\n\n    if (!cart.items?.length) {\n      html += '<div style=\"color: #999; text-align: center; margin-bottom: 15px;\">Cart is empty</div>';\n    } else {\n      html += '<div style=\"margin-bottom: 15px;\">';\n      html += '<div style=\"font-weight: 600; margin-bottom: 10px;\">Items:</div>';\n      html += '<ul style=\"list-style: none; padding: 0; margin: 0;\">';\n      cart.items.forEach(item => {\n        // Check if item is marked as an upsell\n        const isUpsell = !!item.is_upsell;\n        \n        // Create upsell badge if needed\n        const upsellBadge = isUpsell ? \n          `<span style=\"display: inline-block; background-color: #4CAF50; color: white; font-size: 10px; padding: 2px 5px; border-radius: 3px; margin-left: 5px;\">UPSELL</span>` : \n          '';\n        \n        html += `\n          <li style=\"padding: 5px 0; border-bottom: 1px solid #eee; ${isUpsell ? 'background-color: rgba(76, 175, 80, 0.1);' : ''}\">\n            <div style=\"display: flex; justify-content: space-between;\">\n              <div style=\"font-weight: 500;\">${item.name}${upsellBadge}</div>\n              <div>${item.quantity} × ${formatPrice(item.price)}</div>\n            </div>\n            <div style=\"display: flex; justify-content: space-between; margin-top: 5px;\">\n              <div style=\"color: #666; font-size: 12px;\">\n                ID: ${item.id}\n                ${isUpsell ? '<span style=\"color: #4CAF50; margin-left: 5px;\">✓ is_upsell=true</span>' : ''}\n              </div>\n              <div style=\"font-weight: 500;\">${formatPrice(item.price * item.quantity)}</div>\n            </div>\n          </li>\n        `;\n      });\n      html += '</ul></div>';\n    }\n\n    if (cart.totals) {\n      html += '<div>';\n      html += '<div style=\"font-weight: 600; margin-bottom: 10px;\">Totals:</div>';\n      html += '<ul style=\"list-style: none; padding: 0; margin: 0;\">';\n      \n      // Check if there's original subtotal (before discount)\n      if (cart.totals.original_subtotal && cart.totals.original_subtotal > cart.totals.subtotal) {\n        html += `\n          <li style=\"display: flex; justify-content: space-between; padding: 3px 0;\">\n            <div>Original Subtotal:</div>\n            <div>${formatPrice(cart.totals.original_subtotal)}</div>\n          </li>\n        `;\n      }\n      \n      html += `\n        <li style=\"display: flex; justify-content: space-between; padding: 3px 0;\">\n          <div>Subtotal:</div>\n          <div>${formatPrice(cart.totals.subtotal)}</div>\n        </li>\n      `;\n      \n      // Display voucher information if available\n      if (cart.couponCode) {\n        const voucherType = cart.couponDetails?.type || 'unknown';\n        const voucherValue = cart.couponDetails?.value;\n        \n        let voucherInfo = cart.couponCode;\n        \n        // Add type and value info if available\n        if (voucherType && voucherValue !== undefined) {\n          if (voucherType === 'percentage') {\n            voucherInfo += ` (${voucherValue}% off)`;\n          } else if (voucherType === 'fixed') {\n            voucherInfo += ` ($${voucherValue} off)`;\n          } else if (voucherType === 'free_shipping') {\n            voucherInfo += ` (Free shipping)`;\n          }\n        }\n        \n        html += `\n          <li style=\"display: flex; justify-content: space-between; padding: 3px 0; color: #4CAF50;\">\n            <div>Voucher:</div>\n            <div>${voucherInfo}</div>\n          </li>\n        `;\n        \n        // Show discount amount if available\n        if (cart.totals.discount > 0) {\n          html += `\n            <li style=\"display: flex; justify-content: space-between; padding: 3px 0; color: #4CAF50;\">\n              <div>Discount:</div>\n              <div>-${formatPrice(cart.totals.discount)}</div>\n            </li>\n          `;\n        }\n      }\n      \n      if (cart.totals.retail_subtotal > cart.totals.subtotal) {\n        html += `\n          <li style=\"display: flex; justify-content: space-between; padding: 3px 0;\">\n            <div>Retail Subtotal:</div>\n            <div>${formatPrice(cart.totals.retail_subtotal)}</div>\n          </li>\n        `;\n        if (cart.totals.savings) {\n          html += `\n            <li style=\"display: flex; justify-content: space-between; padding: 3px 0; color: #e53935;\">\n              <div>Savings:</div>\n              <div>${formatPrice(cart.totals.savings)} (${Math.round(cart.totals.savings_percentage)}%)</div>\n            </li>\n          `;\n        }\n      }\n      if (cart.totals.shipping > 0) {\n        html += `\n          <li style=\"display: flex; justify-content: space-between; padding: 3px 0;\">\n            <div>Shipping:</div>\n            <div>${formatPrice(cart.totals.shipping)}</div>\n          </li>\n        `;\n      } else if (cart.totals.shipping === 0 && cart.couponDetails?.type === 'free_shipping') {\n        // Clearly indicate when free shipping is applied via voucher\n        html += `\n          <li style=\"display: flex; justify-content: space-between; padding: 3px 0; color: #4CAF50;\">\n            <div>Shipping:</div>\n            <div>FREE</div>\n          </li>\n        `;\n      }\n      if (cart.totals.recurring_total > 0) {\n        html += `\n          <li style=\"display: flex; justify-content: space-between; padding: 3px 0; color: #2196f3;\">\n            <div>Recurring Total:</div>\n            <div>${formatPrice(cart.totals.recurring_total)}</div>\n          </li>\n        `;\n      }\n      html += `\n        <li style=\"display: flex; justify-content: space-between; padding: 3px 0; font-weight: 600; margin-top: 5px; border-top: 1px solid #eee;\">\n          <div>Total:</div>\n          <div>${formatPrice(cart.totals.total)}</div>\n        </li>\n      `;\n      html += '</ul></div>';\n    } else {\n      html += '<div style=\"color: #999; text-align: center; margin-bottom: 15px;\">Cart totals not available</div>';\n    }\n\n    content.innerHTML = html;\n  }\n}", "/**\r\n * TimerManager - Manages countdown timers\r\n * \r\n * This class handles countdown timers that can be added to the page\r\n * using data-os-element=\"timer\" attributes.\r\n */\r\n\r\nexport class TimerManager {\r\n  #app;\r\n  #logger;\r\n  #timers = new Map();\r\n  #storagePrefix = 'os-timer-';\r\n\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#logger = app.logger.createModuleLogger('TIMER');\r\n    this.#initTimers();\r\n    this.#logger.infoWithTime('TimerManager initialized');\r\n  }\r\n\r\n  /**\r\n   * Initialize all timers on the page\r\n   */\r\n  #initTimers() {\r\n    this.#logger.infoWithTime('Initializing timers');\r\n    const timerElements = document.querySelectorAll('[data-os-element=\"timer\"]');\r\n    \r\n    if (timerElements.length === 0) {\r\n      this.#logger.debugWithTime('No timer elements found on page');\r\n      return;\r\n    }\r\n    \r\n    this.#logger.debugWithTime(`Found ${timerElements.length} timer elements`);\r\n    \r\n    timerElements.forEach((timerElement) => {\r\n      this.#setupTimer(timerElement);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set up a single timer element\r\n   * @param {HTMLElement} timerElement - The timer element to set up\r\n   */\r\n  #setupTimer(timerElement) {\r\n    // Get the parent element that may contain timer configuration\r\n    const parentElement = timerElement.closest('[data-os-element=\"timer-text\"]');\r\n    \r\n    if (!parentElement) {\r\n      this.#logger.warnWithTime(`Timer element has no parent with data-os-element=\"timer-text\", using default configuration`);\r\n    }\r\n    \r\n    // Get timer configuration\r\n    const timerConfig = this.#getTimerConfig(timerElement, parentElement);\r\n    \r\n    if (!timerConfig.duration) {\r\n      this.#logger.warnWithTime(`Timer element is missing duration, skipping: ${timerElement.outerHTML}`);\r\n      return;\r\n    }\r\n    \r\n    // Store the original content of the parent element for potential restoration\r\n    const originalParentContent = parentElement ? parentElement.innerHTML : null;\r\n    \r\n    // Set up the timer\r\n    let startTime = +new Date();\r\n    const timerPersistenceId = timerConfig.persistenceId;\r\n    \r\n    // If we have a persistence ID, try to load the start time from localStorage\r\n    if (timerPersistenceId) {\r\n      const storageKey = this.#storagePrefix + timerPersistenceId;\r\n      const cachedStartTime = parseInt(localStorage.getItem(storageKey) || \"\");\r\n      \r\n      if (cachedStartTime > 0) {\r\n        startTime = cachedStartTime;\r\n        this.#logger.debugWithTime(`Loaded persisted timer start time for ${timerPersistenceId}: ${new Date(startTime).toISOString()}`);\r\n      } else {\r\n        localStorage.setItem(storageKey, String(startTime));\r\n        this.#logger.debugWithTime(`Saved new timer start time for ${timerPersistenceId}: ${new Date(startTime).toISOString()}`);\r\n      }\r\n    } else {\r\n      this.#logger.debugWithTime(`Timer has no persistence ID, it will reset with every page load: ${timerElement.outerHTML}`);\r\n    }\r\n    \r\n    // Create a timer object to store the interval ID\r\n    const timer = {\r\n      element: timerElement,\r\n      parentElement,\r\n      config: timerConfig,\r\n      startTime,\r\n      intervalId: null,\r\n      originalParentContent\r\n    };\r\n    \r\n    // Store the timer information\r\n    this.#timers.set(timerElement, timer);\r\n    \r\n    // Create the timer update handler with access to the timer object\r\n    const updateHandler = () => {\r\n      const now = +new Date();\r\n      const elapsed = (now - startTime) / 1000;\r\n      let seconds = Math.round(timerConfig.duration - elapsed);\r\n      \r\n      if (seconds <= 0) {\r\n        seconds = 0;\r\n        \r\n        // Handle timer expiry\r\n        if (timerConfig.expiryText) {\r\n          // Check if we should replace the entire parent content or just the timer\r\n          if (parentElement && timerConfig.replaceEntireContent) {\r\n            parentElement.innerHTML = timerConfig.expiryText;\r\n          } else {\r\n            timerElement.innerText = timerConfig.expiryText;\r\n          }\r\n        } else {\r\n          timerElement.innerText = \"00:00\";\r\n        }\r\n        \r\n        // Clear the interval - now we can safely access the intervalId from the timer object\r\n        if (timer.intervalId) {\r\n          clearInterval(timer.intervalId);\r\n          timer.intervalId = null;\r\n        }\r\n        \r\n        this.#timers.delete(timerElement);\r\n        \r\n        // Trigger expiry event\r\n        this.#triggerTimerEvent('expired', timerElement, { \r\n          timerElement, \r\n          parentElement, \r\n          config: timerConfig \r\n        });\r\n        \r\n        return;\r\n      }\r\n      \r\n      // Format the time\r\n      const hours = Math.floor(seconds / 3600);\r\n      seconds -= hours * 3600;\r\n      const minutes = Math.floor(seconds / 60);\r\n      seconds -= minutes * 60;\r\n      \r\n      // Update the timer text\r\n      const formattedTime = this.#formatTime(hours, minutes, seconds, timerConfig.format);\r\n      timerElement.innerText = formattedTime;\r\n      \r\n      // Trigger update event\r\n      this.#triggerTimerEvent('updated', timerElement, { \r\n        timerElement, \r\n        parentElement, \r\n        config: timerConfig,\r\n        remaining: { hours, minutes, seconds },\r\n        formattedTime\r\n      });\r\n    };\r\n    \r\n    // Run the handler immediately to set the initial value\r\n    updateHandler();\r\n    \r\n    // Set up the interval and store the ID in the timer object\r\n    timer.intervalId = setInterval(updateHandler, 1000);\r\n    \r\n    this.#logger.debugWithTime(`Timer initialized: ${timerConfig.duration} seconds, persistence ID: ${timerConfig.persistenceId || 'none'}`);\r\n  }\r\n\r\n  /**\r\n   * Get timer configuration from element attributes\r\n   * @param {HTMLElement} timerElement - The timer element\r\n   * @param {HTMLElement|null} parentElement - The parent element with timer configuration\r\n   * @returns {Object} Timer configuration\r\n   */\r\n  #getTimerConfig(timerElement, parentElement) {\r\n    const config = {\r\n      duration: 0,\r\n      persistenceId: null,\r\n      expiryText: null,\r\n      format: 'auto', // 'auto', 'hh:mm:ss', 'mm:ss', 'ss'\r\n      replaceEntireContent: false // Whether to replace the entire parent content on expiry\r\n    };\r\n    \r\n    // Try to get duration from data attributes\r\n    if (timerElement.dataset.osDuration) {\r\n      config.duration = parseInt(timerElement.dataset.osDuration);\r\n    } else if (parentElement?.dataset.osTimerDuration) {\r\n      config.duration = parseInt(parentElement.dataset.osTimerDuration);\r\n    }\r\n    \r\n    // Try to get persistence ID from data attributes\r\n    if (timerElement.dataset.osPersistenceId) {\r\n      config.persistenceId = timerElement.dataset.osPersistenceId;\r\n    } else if (parentElement?.dataset.osTimerPersistenceId) {\r\n      config.persistenceId = parentElement.dataset.osTimerPersistenceId;\r\n    }\r\n    \r\n    // Try to get expiry text from data attributes\r\n    if (timerElement.dataset.osExpiryText) {\r\n      config.expiryText = timerElement.dataset.osExpiryText;\r\n    } else if (parentElement?.dataset.osTimerExpiryText) {\r\n      config.expiryText = parentElement.dataset.osTimerExpiryText;\r\n    }\r\n    \r\n    // Try to get format from data attributes\r\n    if (timerElement.dataset.osFormat) {\r\n      config.format = timerElement.dataset.osFormat;\r\n    } else if (parentElement?.dataset.osTimerFormat) {\r\n      config.format = parentElement.dataset.osTimerFormat;\r\n    }\r\n    \r\n    // Check if we should replace the entire content\r\n    if (timerElement.dataset.osReplaceEntireContent === 'true') {\r\n      config.replaceEntireContent = true;\r\n    } else if (parentElement?.dataset.osTimerReplaceEntireContent === 'true') {\r\n      config.replaceEntireContent = true;\r\n    }\r\n    \r\n    // If the expiry text contains HTML tags, we should replace the entire content\r\n    if (config.expiryText && (config.expiryText.includes('<') || config.expiryText.includes('>'))) {\r\n      config.replaceEntireContent = true;\r\n    }\r\n    \r\n    return config;\r\n  }\r\n\r\n  /**\r\n   * Format time according to the specified format\r\n   * @param {number} hours - Hours\r\n   * @param {number} minutes - Minutes\r\n   * @param {number} seconds - Seconds\r\n   * @param {string} format - Format string ('auto', 'hh:mm:ss', 'mm:ss', 'ss')\r\n   * @returns {string} Formatted time\r\n   */\r\n  #formatTime(hours, minutes, seconds, format) {\r\n    const padded = (num) => num.toString().padStart(2, '0');\r\n    \r\n    if (format === 'hh:mm:ss' || (format === 'auto' && hours > 0)) {\r\n      return `${padded(hours)}:${padded(minutes)}:${padded(seconds)}`;\r\n    } else if (format === 'mm:ss' || (format === 'auto' && minutes > 0)) {\r\n      return `${padded(minutes)}:${padded(seconds)}`;\r\n    } else if (format === 'ss') {\r\n      return padded(seconds);\r\n    }\r\n    \r\n    // Default format (auto with no significant time)\r\n    return `${padded(minutes)}:${padded(seconds)}`;\r\n  }\r\n\r\n  /**\r\n   * Trigger a timer event\r\n   * @param {string} eventName - Name of the event\r\n   * @param {HTMLElement} element - Element that triggered the event\r\n   * @param {Object} detail - Event details\r\n   */\r\n  #triggerTimerEvent(eventName, element, detail = {}) {\r\n    const event = new CustomEvent(`os:timer.${eventName}`, {\r\n      bubbles: true,\r\n      cancelable: true,\r\n      detail: { ...detail, manager: this }\r\n    });\r\n    \r\n    element.dispatchEvent(event);\r\n    document.dispatchEvent(event);\r\n    this.#logger.debugWithTime(`Timer event triggered: ${eventName}`);\r\n  }\r\n\r\n  /**\r\n   * Refresh all timers on the page\r\n   * This can be called after dynamic content is loaded\r\n   */\r\n  refreshTimers() {\r\n    this.#logger.infoWithTime('Refreshing timers');\r\n    \r\n    // Clear existing timers\r\n    this.#timers.forEach((timer) => {\r\n      if (timer.intervalId) {\r\n        clearInterval(timer.intervalId);\r\n        timer.intervalId = null;\r\n      }\r\n    });\r\n    \r\n    this.#timers.clear();\r\n    \r\n    // Re-initialize timers\r\n    this.#initTimers();\r\n  }\r\n\r\n  /**\r\n   * Get all active timers\r\n   * @returns {Map} Map of active timers\r\n   */\r\n  getTimers() {\r\n    return this.#timers;\r\n  }\r\n} ", "/**\r\n * DisplayManager - Manages conditional display of elements based on cart contents\r\n * \r\n * This class handles showing/hiding elements based on what's in the cart,\r\n * using data-os-in-cart attributes.\r\n */\r\n\r\nexport class DisplayManager {\r\n  #app;\r\n  #logger;\r\n  #displayElements = new Map();\r\n\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#logger = app.logger.createModuleLogger('DISPLAY');\r\n    this.#initDisplayElements();\r\n    \r\n    // Subscribe to cart updates to refresh display elements\r\n    this.#app.state.subscribe('cart', () => this.refreshDisplayElements());\r\n    \r\n    this.#logger.infoWithTime('DisplayManager initialized');\r\n  }\r\n\r\n  /**\r\n   * Initialize all display elements on the page\r\n   */\r\n  #initDisplayElements() {\r\n    this.#logger.infoWithTime('Initializing display elements');\r\n    \r\n    // Find all swap display containers\r\n    const swapContainers = document.querySelectorAll('[data-os-cart=\"swap-display\"]');\r\n    \r\n    if (swapContainers.length === 0) {\r\n      this.#logger.debugWithTime('No swap display containers found on page');\r\n      return;\r\n    }\r\n    \r\n    this.#logger.debugWithTime(`Found ${swapContainers.length} swap display containers`);\r\n    \r\n    // Process each container\r\n    swapContainers.forEach((container, index) => {\r\n      const containerId = container.dataset.osId || `auto-container-${index}`;\r\n      \r\n      // Find all display elements within this container\r\n      const displayElements = container.querySelectorAll('[data-os-in-cart=\"display\"]');\r\n      \r\n      if (displayElements.length === 0) {\r\n        this.#logger.warnWithTime(`Container ${containerId} has no display elements`);\r\n        return;\r\n      }\r\n      \r\n      // Store the container and its display elements\r\n      this.#displayElements.set(container, {\r\n        id: containerId,\r\n        elements: Array.from(displayElements).map(element => ({\r\n          element,\r\n          packageId: element.dataset.osPackage\r\n        }))\r\n      });\r\n      \r\n      this.#logger.debugWithTime(`Initialized container ${containerId} with ${displayElements.length} display elements`);\r\n    });\r\n    \r\n    // Initial update of all display elements\r\n    this.refreshDisplayElements();\r\n  }\r\n\r\n  /**\r\n   * Refresh all display elements based on current cart contents\r\n   */\r\n  refreshDisplayElements() {\r\n    this.#logger.debugWithTime('Refreshing display elements');\r\n    \r\n    // Get current cart items\r\n    const cart = this.#app.state.getState('cart');\r\n    const cartItemIds = cart.items.map(item => item.id.toString());\r\n    \r\n    // Update each container\r\n    this.#displayElements.forEach((containerData, container) => {\r\n      this.#updateContainerDisplay(container, containerData, cartItemIds);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update the display of elements within a container based on cart contents\r\n   * @param {HTMLElement} container - The container element\r\n   * @param {Object} containerData - Data about the container and its elements\r\n   * @param {Array<string>} cartItemIds - IDs of items currently in the cart\r\n   */\r\n  #updateContainerDisplay(container, containerData, cartItemIds) {\r\n    const { id, elements } = containerData;\r\n    let hasVisibleElement = false;\r\n    \r\n    // First pass: check if any element should be visible\r\n    for (const { element, packageId } of elements) {\r\n      if (packageId && cartItemIds.includes(packageId)) {\r\n        // Show this element\r\n        element.style.display = 'block';\r\n        hasVisibleElement = true;\r\n        this.#logger.debugWithTime(`Showing element for package ${packageId} in container ${id}`);\r\n      } else {\r\n        // Hide this element\r\n        element.style.display = 'none';\r\n      }\r\n    }\r\n    \r\n    // If no elements are visible, show the first one as fallback (optional)\r\n    if (!hasVisibleElement && elements.length > 0) {\r\n      // Option 1: Show nothing (current behavior)\r\n      // Option 2: Show the first element as fallback\r\n      // elements[0].element.style.display = 'block';\r\n      // this.#logger.debugWithTime(`No matching packages in cart, showing first element as fallback in container ${id}`);\r\n    }\r\n    \r\n    // Trigger a custom event\r\n    this.#triggerDisplayEvent('updated', container, {\r\n      containerId: id,\r\n      hasVisibleElement,\r\n      visiblePackageIds: elements\r\n        .filter(({ element }) => element.style.display === 'block')\r\n        .map(({ packageId }) => packageId)\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Trigger a display event\r\n   * @param {string} eventName - Name of the event\r\n   * @param {HTMLElement} element - Element that triggered the event\r\n   * @param {Object} detail - Event details\r\n   */\r\n  #triggerDisplayEvent(eventName, element, detail = {}) {\r\n    const event = new CustomEvent(`os:display.${eventName}`, {\r\n      bubbles: true,\r\n      cancelable: true,\r\n      detail: { ...detail, manager: this }\r\n    });\r\n    \r\n    element.dispatchEvent(event);\r\n    document.dispatchEvent(event);\r\n    this.#logger.debugWithTime(`Display event triggered: ${eventName}`);\r\n  }\r\n\r\n  /**\r\n   * Manually refresh display elements\r\n   * This can be called after dynamic content is loaded\r\n   */\r\n  refresh() {\r\n    this.#logger.infoWithTime('Manually refreshing display elements');\r\n    this.#displayElements.clear();\r\n    this.#initDisplayElements();\r\n  }\r\n} ", "/**\r\n * CartDisplayManager - Manages cart display in the checkout page\r\n * \r\n * This class handles updating the cart summary display based on cart contents,\r\n * including line items, totals, savings, and shipping information.\r\n */\r\n\r\nexport class CartDisplayManager {\r\n  #app;\r\n  #logger;\r\n  #elements = {\r\n    lineDisplays: [], // Changed to array to support multiple displays\r\n    summaryContainers: [], // Changed to array to support multiple containers\r\n    savingsBars: [], // Changed to array\r\n    shippingBars: [], // Changed to array\r\n    grandTotals: [], // Changed to array\r\n    subtotals: [], // Added for subtotal elements\r\n    // Summary toggle elements\r\n    summaryBars: [], // Changed to array\r\n    summaryPanels: [], // Changed to array\r\n    summaryTexts: [], // Changed to array\r\n    summaryIcons: [], // Changed to array\r\n    // Compare total elements\r\n    compareTotalElements: []\r\n  };\r\n  #config = {\r\n    currencySymbol: '$',\r\n    showComparePricing: true,\r\n    showProductImages: true,\r\n    showTaxPendingMessage: true,\r\n    frequencyOverrides: {}, // Added for frequency text overrides by package ID\r\n    priceOverrides: {} // Added for price overrides by package ID\r\n  };\r\n  #lineItemTemplate = null;\r\n\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#logger = app.logger.createModuleLogger('CART_DISPLAY');\r\n    this.#initCartDisplay();\r\n    \r\n    // Subscribe to cart updates\r\n    this.#app.state.subscribe('cart', () => this.updateCartDisplay());\r\n    \r\n    this.#logger.infoWithTime('CartDisplayManager initialized');\r\n  }\r\n\r\n  /**\r\n   * Initialize the cart display elements\r\n   */\r\n  #initCartDisplay() {\r\n    this.#logger.infoWithTime('[INIT] Initializing cart display');\r\n\r\n    // Load config from window.osConfig\r\n    if (window.osConfig && window.osConfig.cartDisplayConfig) {\r\n      if (window.osConfig.cartDisplayConfig.frequencyOverrides) {\r\n        this.#config.frequencyOverrides = window.osConfig.cartDisplayConfig.frequencyOverrides;\r\n      }\r\n      if (window.osConfig.cartDisplayConfig.priceOverrides) {\r\n        this.#config.priceOverrides = window.osConfig.cartDisplayConfig.priceOverrides;\r\n      }\r\n      // Log loaded config keys at debug level\r\n      this.#logger.debugWithTime(`[INIT] Loaded cartDisplayConfig. Freq Keys: ${Object.keys(this.#config.frequencyOverrides || {}).join(',') || 'none'}, Price Keys: ${Object.keys(this.#config.priceOverrides || {}).join(',') || 'none'}`);\r\n    } else {\r\n      this.#logger.debugWithTime('[INIT] No cartDisplayConfig found in window.osConfig.');\r\n    }\r\n\r\n    // Find elements\r\n    this.#elements.lineDisplays = document.querySelectorAll('[data-os-cart-summary=\"line-display\"]');\r\n    this.#elements.summaryContainers = document.querySelectorAll('[data-os-cart=\"summary\"]');\r\n    this.#elements.savingsBars = document.querySelectorAll('[data-os-cart-summary=\"savings\"]');\r\n    this.#elements.shippingBars = document.querySelectorAll('[data-os-cart-summary=\"shipping-bar\"]');\r\n    this.#elements.grandTotals = document.querySelectorAll('[data-os-cart-summary=\"grand-total\"]');\r\n    this.#elements.subtotals = document.querySelectorAll('[data-os-cart-summary=\"subtotal\"]');\r\n    this.#elements.summaryBars = document.querySelectorAll('[os-checkout-element=\"summary-bar\"]');\r\n    this.#elements.summaryPanels = document.querySelectorAll('[os-checkout-element=\"summary-mobile\"]');\r\n    this.#elements.summaryTexts = document.querySelectorAll('[os-checkout-element=\"summary-text\"]');\r\n    this.#elements.summaryIcons = document.querySelectorAll('[os-summary-icon]');\r\n    this.#elements.compareTotalElements = document.querySelectorAll('[data-os-cart-summary=\"compare-total\"]');\r\n\r\n    // Get config from attributes\r\n    if (this.#elements.summaryContainers.length > 0) {\r\n      const firstContainer = this.#elements.summaryContainers[0];\r\n      this.#config.showComparePricing = firstContainer.dataset.showComparePricing !== 'false';\r\n      this.#config.showProductImages = firstContainer.dataset.showProductImages !== 'false';\r\n      this.#config.showTaxPendingMessage = firstContainer.dataset.showTaxPendingMessage !== 'false';\r\n      this.#config.currencySymbol = firstContainer.dataset.currencySymbol || '$';\r\n    }\r\n    \r\n    // Check template\r\n    const existingLineItem = document.querySelector('[data-os-cart-summary=\"line-item\"]');\r\n    if (existingLineItem) {\r\n      this.#lineItemTemplate = existingLineItem.cloneNode(true);\r\n      this.#logger.debugWithTime('[INIT] Line item template found and cloned.');\r\n      const hasFreqInTemplate = !!this.#lineItemTemplate.querySelector('[data-os-cart-summary=\"line-frequency\"]');\r\n      const hasSaleInTemplate = !!this.#lineItemTemplate.querySelector('[data-os-cart-summary=\"line-sale\"]');\r\n      this.#logger.debugWithTime(`[INIT] Template check: Has Frequency? ${hasFreqInTemplate}. Has Sale Price? ${hasSaleInTemplate}`);\r\n    } else {\r\n      this.#logger.warnWithTime('[INIT] CRITICAL: Line item template NOT FOUND.');\r\n    }\r\n    \r\n    this.#initSummaryToggle();\r\n    this.updateCartDisplay();\r\n  }\r\n\r\n  /**\r\n   * Initialize the summary toggle functionality\r\n   */\r\n  #initSummaryToggle() {\r\n    const { summaryBars, summaryPanels, summaryTexts, summaryIcons } = this.#elements;\r\n    \r\n    if (!summaryBars.length || !summaryPanels.length) {\r\n      this.#logger.debugWithTime('Summary toggle elements not found, skipping initialization');\r\n      return;\r\n    }\r\n    \r\n    this.#logger.debugWithTime('Initializing summary toggle');\r\n    \r\n    // Initialize each summary panel\r\n    summaryPanels.forEach((panel, index) => {\r\n      // Add a class to prevent transitions during initialization\r\n      panel.classList.add('no-transition');\r\n      \r\n      // Set initial styles if not already expanded\r\n      if (!panel.classList.contains('cc-expanded')) {\r\n        panel.style.height = '0';\r\n        panel.style.opacity = '0';\r\n        panel.style.overflow = 'hidden';\r\n        \r\n        // Set initial text content for corresponding text element\r\n        const textElement = summaryTexts[index];\r\n        if (textElement) {\r\n          textElement.textContent = 'Show Order Summary';\r\n        }\r\n      }\r\n      \r\n      // Force reflow and remove no-transition class\r\n      requestAnimationFrame(() => {\r\n        panel.classList.remove('no-transition');\r\n        panel.style.transition = 'height 0.3s ease-out, opacity 0.25s ease-out';\r\n      });\r\n    });\r\n    \r\n    // Add click event listener to each summary bar\r\n    summaryBars.forEach((bar, index) => {\r\n      bar.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        this.#toggleSummary(index);\r\n      });\r\n    });\r\n    \r\n    // Add resize listener to handle window size changes\r\n    window.addEventListener('resize', this.#debounce(() => {\r\n      summaryPanels.forEach(panel => {\r\n        if (panel.classList.contains('cc-expanded')) {\r\n          panel.style.height = 'auto';\r\n        }\r\n      });\r\n    }, 250));\r\n    \r\n    this.#logger.debugWithTime('Summary toggle initialized');\r\n  }\r\n\r\n  /**\r\n   * Toggle the summary panel between expanded and collapsed states\r\n   * @param {number} index - Index of the summary panel to toggle\r\n   */\r\n  #toggleSummary(index = 0) {\r\n    const { summaryPanels, summaryTexts, summaryIcons } = this.#elements;\r\n    \r\n    const panel = summaryPanels[index];\r\n    const text = summaryTexts[index];\r\n    const icon = summaryIcons[index];\r\n    \r\n    if (!panel) return;\r\n    \r\n    const isExpanded = panel.classList.contains('cc-expanded');\r\n    \r\n    if (!isExpanded) {\r\n      // Expanding\r\n      panel.classList.add('cc-expanded');\r\n      panel.style.height = `${panel.scrollHeight}px`;\r\n      panel.style.opacity = '1';\r\n      \r\n      if (text) {\r\n        text.textContent = 'Hide Order Summary';\r\n      }\r\n      \r\n      if (icon) {\r\n        icon.style.transform = 'rotate(180deg)';\r\n      }\r\n      \r\n      panel.addEventListener('transitionend', () => {\r\n        if (panel.classList.contains('cc-expanded')) {\r\n          panel.style.height = 'auto';\r\n        }\r\n      }, { once: true });\r\n      \r\n      this.#logger.debugWithTime('Summary panel expanded');\r\n    } else {\r\n      // Collapsing\r\n      const currentHeight = panel.scrollHeight;\r\n      panel.style.height = `${currentHeight}px`;\r\n      panel.offsetHeight; // Force reflow\r\n      \r\n      panel.style.height = '0';\r\n      panel.style.opacity = '0';\r\n      \r\n      if (text) {\r\n        text.textContent = 'Show Order Summary';\r\n      }\r\n      \r\n      if (icon) {\r\n        icon.style.transform = 'rotate(0deg)';\r\n      }\r\n      \r\n      panel.addEventListener('transitionend', () => {\r\n        if (panel.style.height === '0px') {\r\n          panel.classList.remove('cc-expanded');\r\n        }\r\n      }, { once: true });\r\n      \r\n      this.#logger.debugWithTime('Summary panel collapsed');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update the cart display with current cart data\r\n   */\r\n  updateCartDisplay() {\r\n    this.#logger.debugWithTime('[UPDATE] updateCartDisplay CALLED');\r\n\r\n    const cart = this.#app.state.getState('cart');\r\n\r\n    if (!cart) {\r\n      this.#logger.warnWithTime('[UPDATE] Cart data not available, returning.');\r\n      return;\r\n    }\r\n    // Check for cart.items specifically\r\n    if (!Array.isArray(cart.items)) { \r\n      this.#logger.warnWithTime(`[UPDATE] Cart data present, but cart.items is not an array (type: ${typeof cart.items}). Cannot update display.`);\r\n      return;\r\n    }\r\n\r\n    this.#logger.debugWithTime(`[UPDATE] Processing cart with ${cart.items.length} items. Package IDs: ${cart.items.map(item => item?.package_id || 'N/A').join(', ')}`);\r\n    \r\n    this.#updateLineItems(cart.items);\r\n    this.#updateSummary(cart.totals);\r\n    this.#updateShipping(cart.totals.shipping, cart.shippingMethod);\r\n    this.#updateSavings(cart.totals);\r\n    this.#updateGrandTotal(cart.totals.total);\r\n    this.#updateCompareTotals(cart.totals);\r\n    this.#logger.debugWithTime('[UPDATE] Cart display fully updated');\r\n  }\r\n\r\n  /**\r\n   * Update the line items display\r\n   * @param {Array} items - Cart items\r\n   */\r\n  #updateLineItems(items) {\r\n    this.#logger.debugWithTime(`[#updateLineItems] Entered. Item count: ${items.length}.`);\r\n    if (!this.#elements.lineDisplays.length || !this.#lineItemTemplate) {\r\n      this.#logger.warnWithTime('[#updateLineItems] Line displays or template not found, cannot update.');\r\n      return;\r\n    }\r\n\r\n    this.#elements.lineDisplays.forEach(lineDisplayElement => {\r\n      lineDisplayElement.innerHTML = '';\r\n      // Determine if this specific line-display wants to show item-level discounts\r\n      const showDiscountedPriceOnLineItem = lineDisplayElement.dataset.osShowItemDiscount === 'true';\r\n      this.#logger.debugWithTime(`[#updateLineItems] lineDisplay ${lineDisplayElement.classList} showDiscountedPriceOnLineItem: ${showDiscountedPriceOnLineItem}`);\r\n\r\n      if (items && items.length > 0) {\r\n        items.forEach(item => {\r\n          // Pass the flag to #createLineItemElement\r\n          const lineItemElement = this.#createLineItemElement(item, showDiscountedPriceOnLineItem);\r\n          lineDisplayElement.appendChild(lineItemElement);\r\n        });\r\n      }\r\n    });\r\n\r\n    const scrollIndicators = document.querySelectorAll('[data-os-cart-summary=\"summary-scroll\"]');\r\n    if (scrollIndicators.length) {\r\n      const shouldShowScroll = items && items.length > 2;\r\n      scrollIndicators.forEach(indicator => {\r\n        indicator.classList.toggle('hide', !shouldShowScroll);\r\n      });\r\n    }\r\n\r\n    // Direct DOM update fallback - this also needs to be aware of the flag if it were to modify prices\r\n    // For now, its main job is overrides from #config, which is fine.\r\n    // If it were to reflect item.applied_coupon_discount_amount, it would need to check the parent flag too.\r\n    setTimeout(() => {\r\n      this.#logger.debugWithTime(`[Direct DOM Update] Attempting...`);\r\n      const allFrequencyElements = document.querySelectorAll('[data-os-cart-summary=\"line-frequency\"]');\r\n      allFrequencyElements.forEach(el => {\r\n        const itemElement = el.closest('[data-os-cart-summary=\"line-item\"]');\r\n        if (!itemElement) return;\r\n        const titleElement = itemElement.querySelector('[data-os-cart-summary=\"line-title\"]');\r\n        if (!titleElement || !items) return;\r\n        const itemTitle = titleElement.textContent;\r\n        const matchingItem = items.find(cartItem => cartItem.name === itemTitle);\r\n        if (matchingItem) {\r\n          const directItemPackageIdString = (matchingItem.package_id !== undefined && matchingItem.package_id !== null)\r\n                                           ? matchingItem.package_id.toString()\r\n                                           : 'undefined'; \r\n          if (directItemPackageIdString !== 'undefined' && this.#config.frequencyOverrides && this.#config.frequencyOverrides[directItemPackageIdString]) {\r\n            const overrideText = this.#config.frequencyOverrides[directItemPackageIdString];\r\n            this.#logger.debugWithTime(`[Direct DOM Update] Setting frequency for \"${itemTitle}\" (package_id \"${directItemPackageIdString}\")`);\r\n            el.textContent = overrideText;\r\n            el.classList.remove('hide');\r\n          }\r\n        }\r\n      });\r\n\r\n      const allSalePriceElements = document.querySelectorAll('[data-os-cart-summary=\"line-sale\"]');\r\n      allSalePriceElements.forEach(el => {\r\n        const itemElement = el.closest('[data-os-cart-summary=\"line-item\"]');\r\n        if (!itemElement) return;\r\n        const titleElement = itemElement.querySelector('[data-os-cart-summary=\"line-title\"]');\r\n        if (!titleElement || !items) return;\r\n        const itemTitle = titleElement.textContent;\r\n        const matchingItem = items.find(cartItem => cartItem.name === itemTitle);\r\n        if (matchingItem) {\r\n          const directItemPackageIdString = (matchingItem.package_id !== undefined && matchingItem.package_id !== null)\r\n                                           ? matchingItem.package_id.toString()\r\n                                           : 'undefined'; \r\n          if (directItemPackageIdString !== 'undefined' && this.#config.priceOverrides && this.#config.priceOverrides[directItemPackageIdString] !== undefined) {\r\n            const overridePrice = this.#config.priceOverrides[directItemPackageIdString];\r\n            this.#logger.debugWithTime(`[Direct DOM Update] Setting price for \"${itemTitle}\" (package_id \"${directItemPackageIdString}\")`);\r\n            el.textContent = this.#formatPrice(overridePrice * (matchingItem.quantity || 1));\r\n          }\r\n        }\r\n      });\r\n    }, 150);\r\n  }\r\n\r\n  /**\r\n   * Create a line item element\r\n   * @param {Object} item - Cart item\r\n   * @param {boolean} showDiscountedPriceOnLineItem - Flag indicating if this item should show a discounted price\r\n   * @returns {HTMLElement} Line item element\r\n   */\r\n  #createLineItemElement(item, showDiscountedPriceOnLineItem = false) {\r\n    if (!item) {\r\n      this.#logger.warnWithTime('[#createLineItemElement] Item is null or undefined. Skipping.');\r\n      return document.createElement('div');\r\n    }\r\n    if (!this.#lineItemTemplate) {\r\n      this.#logger.warnWithTime('[#createLineItemElement] Line item template is missing.');\r\n      const el = document.createElement('div');\r\n      el.textContent = 'Error: Line item template missing';\r\n      return el;\r\n    }\r\n\r\n    const itemPackageIdString = (item.package_id?.toString()) || (item.id?.toString()) || 'undefined';\r\n    this.#logger.debugWithTime(`[#createLineItemElement] For \"${item.name}\", pkgId:\"${itemPackageIdString}\", showDiscountedFlag:${showDiscountedPriceOnLineItem}, item.applied_coupon_discount_amount: ${item.applied_coupon_discount_amount}`);\r\n\r\n    const lineItem = this.#lineItemTemplate.cloneNode(true);\r\n    if (itemPackageIdString !== 'undefined') lineItem.dataset.osPackageId = itemPackageIdString;\r\n    if (item.is_upsell === true) lineItem.dataset.osItemType = 'upsell';\r\n    else lineItem.dataset.osItemType = 'standard';\r\n\r\n    const titleElement = lineItem.querySelector('[data-os-cart-summary=\"line-title\"]');\r\n    if (titleElement) titleElement.textContent = item.name;\r\n\r\n    if (this.#config.showProductImages) {\r\n      const imageElement = lineItem.querySelector('[data-os-cart-summary=\"line-image\"]');\r\n      if (imageElement && item.image) {\r\n        imageElement.src = item.image;\r\n        imageElement.alt = item.name;\r\n      }\r\n    }\r\n    \r\n    const qtyElement = lineItem.querySelector('[os-cart=\"line_item-qty\"]');\r\n    if (qtyElement) qtyElement.textContent = item.quantity || 1;\r\n    \r\n    const frequencyElement = lineItem.querySelector('[data-os-cart-summary=\"line-frequency\"]');\r\n    if (frequencyElement) {\r\n      let frequencyText = null;\r\n      if (itemPackageIdString !== 'undefined' && this.#config.frequencyOverrides && this.#config.frequencyOverrides[itemPackageIdString]) {\r\n        frequencyText = this.#config.frequencyOverrides[itemPackageIdString];\r\n      } else if (item.subscription_frequency) {\r\n        frequencyText = `Schedule: Every ${item.subscription_frequency} Days`;\r\n      }\r\n      if (frequencyText) {\r\n        frequencyElement.textContent = frequencyText;\r\n        frequencyElement.classList.remove('hide');\r\n      } else {\r\n        frequencyElement.classList.add('hide');\r\n      }\r\n    }\r\n    \r\n    const comparePriceEl = lineItem.querySelector('[data-os-cart-summary=\"line-compare\"]');\r\n    const salePriceEl = lineItem.querySelector('[data-os-cart-summary=\"line-sale\"]');\r\n\r\n    // Determine the base price for this line item (total for its quantity)\r\n    // This is before CartDisplayManager's own priceOverrides and before coupon display adjustments.\r\n    let baseLinePrice = (item.price_total != null) ? item.price_total : (item.price || 0) * (item.quantity || 1);\r\n\r\n    // Apply CartDisplayManager's specific display priceOverride if it exists.\r\n    // This override is per-unit, so multiply by quantity.\r\n    if (itemPackageIdString !== 'undefined' && this.#config.priceOverrides && this.#config.priceOverrides[itemPackageIdString] !== undefined) {\r\n      baseLinePrice = this.#config.priceOverrides[itemPackageIdString] * (item.quantity || 1);\r\n      this.#logger.debugWithTime(`[#createLineItemElement] Using CDM config price override for \"${itemPackageIdString}\". New baseLinePrice: ${baseLinePrice}`);\r\n    }\r\n\r\n    let finalSalePriceForLine = baseLinePrice;\r\n\r\n    // If flagged to show item discount, and item has an applied coupon discount from StateManager\r\n    if (showDiscountedPriceOnLineItem && item.applied_coupon_discount_amount && typeof item.applied_coupon_discount_amount === 'number' && item.applied_coupon_discount_amount > 0) {\r\n      const itemLineDiscount = item.applied_coupon_discount_amount; // This is total discount for this line\r\n      finalSalePriceForLine = Math.max(0, baseLinePrice - itemLineDiscount);\r\n      this.#logger.debugWithTime(`[#createLineItemElement] Item \"${item.name}\" (pkgId:\"${itemPackageIdString}\") applying item coupon discount. BaseLinePrice: ${baseLinePrice}, ItemLineDiscount: ${itemLineDiscount}, FinalSalePriceForLine: ${finalSalePriceForLine}`);\r\n      if (salePriceEl) salePriceEl.classList.add('price--coupon-applied');\r\n    } else {\r\n      if (salePriceEl) salePriceEl.classList.remove('price--coupon-applied');\r\n    }\r\n    \r\n    if (salePriceEl) {\r\n      salePriceEl.textContent = this.#formatPrice(finalSalePriceForLine);\r\n    }\r\n\r\n    // Compare price logic: should be based on item.retail_price_total vs. baseLinePrice (pre-coupon)\r\n    const retailTotalForLine = (item.retail_price_total != null) ? item.retail_price_total : (item.retail_price || 0) * (item.quantity || 1);\r\n    if (comparePriceEl && retailTotalForLine > 0 && this.#config.showComparePricing) {\r\n        if (retailTotalForLine > baseLinePrice) { // Compare retail against the price before coupon display adjustment\r\n            comparePriceEl.textContent = this.#formatPrice(retailTotalForLine);\r\n            comparePriceEl.classList.remove('hide');\r\n        } else {\r\n            comparePriceEl.classList.add('hide');\r\n        }\r\n    } else if (comparePriceEl) {\r\n        comparePriceEl.classList.add('hide');\r\n    }\r\n    \r\n    // Savings percentage: retailTotalForLine vs finalSalePriceForLine\r\n    const savingsPercentElement = lineItem.querySelector('[data-os-cart-summary=\"line-saving-percent\"]');\r\n    if (savingsPercentElement && retailTotalForLine > 0) {\r\n      if (retailTotalForLine > finalSalePriceForLine) {\r\n        const savingsPercent = Math.round((1 - (finalSalePriceForLine / retailTotalForLine)) * 100);\r\n        if (savingsPercent > 0) {\r\n            const format = savingsPercentElement.dataset.osFormat || 'default';\r\n            let savingsText = `${savingsPercent}% OFF`;\r\n            if (format === 'parenthesis') savingsText = `(${savingsPercent}% OFF)`;\r\n            savingsPercentElement.textContent = savingsText;\r\n            savingsPercentElement.classList.remove('hide');\r\n        } else {\r\n            savingsPercentElement.classList.add('hide');\r\n        }\r\n      } else {\r\n        savingsPercentElement.classList.add('hide');\r\n      }\r\n    } else if (savingsPercentElement) {\r\n      savingsPercentElement.classList.add('hide');\r\n    }\r\n    \r\n    const removeButton = lineItem.querySelector('[data-os-cart-summary=\"remove-line\"]');\r\n    if (removeButton) {\r\n      removeButton.addEventListener('click', (event) => {\r\n        event.preventDefault();\r\n        const itemIdToRemove = item.id?.toString(); \r\n        this.#logger.infoWithTime(`Remove button clicked for item id: ${itemIdToRemove} (package_id: ${itemPackageIdString})`);\r\n        if (itemIdToRemove && itemIdToRemove !== 'undefined' && this.#app.cart) {\r\n          try {\r\n            this.#app.cart.removeFromCart(itemIdToRemove); \r\n          } catch (error) {\r\n            this.#logger.errorWithTime(`Error removing item id ${itemIdToRemove} from cart:`, error);\r\n          }\r\n        } else {\r\n          this.#logger.warnWithTime(`Cannot remove item: item.id is undefined or cart manager not available.`);\r\n        }\r\n      });\r\n    }\r\n    \r\n    return lineItem;\r\n  }\r\n\r\n  /**\r\n   * Update the summary section\r\n   * @param {Object} totals - Cart totals\r\n   */\r\n  #updateSummary(totals) {\r\n    if (!totals) return;\r\n    \r\n    // Update subtotal elements\r\n    if (this.#elements.subtotals.length) {\r\n      this.#elements.subtotals.forEach(element => {\r\n        element.textContent = this.#formatPrice(totals.subtotal);\r\n      });\r\n      this.#logger.debugWithTime(`Updated subtotal to: ${this.#formatPrice(totals.subtotal)}`);\r\n    }\r\n    \r\n    // Update coupon discount elements if coupon is applied\r\n    if (totals.discount > 0) {\r\n      const discountElements = document.querySelectorAll('[data-os-cart-summary=\"discount-amount\"]');\r\n      const discountRows = document.querySelectorAll('[data-os-cart-summary=\"discount-row\"]');\r\n      \r\n      // Update discount amount elements\r\n      discountElements.forEach(element => {\r\n        element.textContent = `-${this.#formatPrice(totals.discount)}`;\r\n      });\r\n      \r\n      // Show discount rows\r\n      discountRows.forEach(row => {\r\n        row.classList.remove('hide');\r\n      });\r\n      \r\n      this.#logger.debugWithTime(`Updated discount amount to: -${this.#formatPrice(totals.discount)}`);\r\n      \r\n      // Also update any original subtotal elements to show the pre-discount amount\r\n      const originalSubtotalElements = document.querySelectorAll('[data-os-cart-summary=\"original-subtotal\"]');\r\n      originalSubtotalElements.forEach(element => {\r\n        element.textContent = this.#formatPrice(totals.original_subtotal || totals.subtotal + totals.discount);\r\n        element.classList.remove('hide');\r\n      });\r\n    } else {\r\n      // Hide discount rows if no discount\r\n      const discountRows = document.querySelectorAll('[data-os-cart-summary=\"discount-row\"]');\r\n      discountRows.forEach(row => {\r\n        row.classList.add('hide');\r\n      });\r\n      \r\n      // Hide original subtotal elements\r\n      const originalSubtotalElements = document.querySelectorAll('[data-os-cart-summary=\"original-subtotal\"]');\r\n      originalSubtotalElements.forEach(element => {\r\n        element.classList.add('hide');\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update the shipping information\r\n   * @param {number} shippingCost - Shipping cost\r\n   * @param {Object} shippingMethod - Selected shipping method\r\n   */\r\n  #updateShipping(shippingCost, shippingMethod) {\r\n    if (!this.#elements.shippingBars.length) {\r\n      this.#logger.warnWithTime('Shipping bars not found');\r\n      return;\r\n    }\r\n    \r\n    // Update all shipping bars\r\n    this.#elements.shippingBars.forEach(shippingBar => {\r\n      const shippingCompare = shippingBar.querySelector('[data-os-cart-summary=\"shipping-compare\"]');\r\n      const shippingCurrent = shippingBar.querySelector('[data-os-cart-summary=\"shipping-current\"]');\r\n      \r\n      if (shippingCompare && shippingCurrent) {\r\n        // If shipping is free but there was a standard shipping cost\r\n        if (shippingCost === 0 && shippingMethod?.standard_cost > 0) {\r\n          shippingCompare.textContent = this.#formatPrice(shippingMethod.standard_cost);\r\n          shippingCurrent.textContent = 'FREE';\r\n          shippingCompare.classList.remove('hide');\r\n        } \r\n        // If shipping has a cost\r\n        else if (shippingCost > 0) {\r\n          shippingCurrent.textContent = this.#formatPrice(shippingCost);\r\n          shippingCompare.classList.add('hide');\r\n        } \r\n        // If shipping is just free\r\n        else {\r\n          shippingCurrent.textContent = 'FREE';\r\n          shippingCompare.classList.add('hide');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update the savings information\r\n   * @param {Object} totals - Cart totals\r\n   */\r\n  #updateSavings(totals) {\r\n    if (!this.#elements.savingsBars.length) {\r\n      this.#logger.warnWithTime('Savings bars not found');\r\n      return;\r\n    }\r\n    \r\n    // Update all savings bars\r\n    this.#elements.savingsBars.forEach(savingsBar => {\r\n      // Find elements within this specific savings bar\r\n      const savingsAmount = savingsBar.querySelector('[data-os-cart-summary=\"savings-amount\"]');\r\n      const savingsPercentage = savingsBar.querySelector('[data-os-cart-summary=\"savings-percentage\"]');\r\n      \r\n      if (totals.savings > 0 && totals.savings_percentage > 0) {\r\n        if (savingsAmount) {\r\n          savingsAmount.textContent = this.#formatPrice(totals.savings);\r\n          this.#logger.debugWithTime(`Updated savings amount to: ${this.#formatPrice(totals.savings)}`);\r\n        }\r\n        \r\n        if (savingsPercentage) {\r\n          savingsPercentage.textContent = `${Math.round(totals.savings_percentage)}% OFF`;\r\n          this.#logger.debugWithTime(`Updated savings percentage to: ${Math.round(totals.savings_percentage)}% OFF`);\r\n        }\r\n        \r\n        savingsBar.classList.remove('hide');\r\n      } else {\r\n        savingsBar.classList.add('hide');\r\n      }\r\n    });\r\n    \r\n    // Also update any standalone savings elements that might be outside the savings bars\r\n    const allSavingsAmounts = document.querySelectorAll('[data-os-cart-summary=\"savings-amount\"]');\r\n    const allSavingsPercentages = document.querySelectorAll('[data-os-cart-summary=\"savings-percentage\"]');\r\n    \r\n    if (totals.savings > 0 && totals.savings_percentage > 0) {\r\n      allSavingsAmounts.forEach(element => {\r\n        element.textContent = this.#formatPrice(totals.savings);\r\n      });\r\n      \r\n      allSavingsPercentages.forEach(element => {\r\n        element.textContent = `${Math.round(totals.savings_percentage)}% OFF`;\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update the grand total\r\n   * @param {number} total - Cart total\r\n   */\r\n  #updateGrandTotal(total) {\r\n    if (!this.#elements.grandTotals.length) {\r\n      this.#logger.warnWithTime('Grand total elements not found');\r\n      return;\r\n    }\r\n    \r\n    // Update all grand total elements\r\n    this.#elements.grandTotals.forEach(element => {\r\n      element.textContent = this.#formatPrice(total);\r\n    });\r\n    \r\n    this.#logger.debugWithTime(`Updated grand total to: ${this.#formatPrice(total)}`);\r\n  }\r\n\r\n  /**\r\n   * Format a price with currency symbol\r\n   * @param {number} price - Price to format\r\n   * @returns {string} Formatted price\r\n   */\r\n  #formatPrice(price) {\r\n    // Use the campaign's formatPrice method if available\r\n    if (this.#app.campaign?.formatPrice) {\r\n      return this.#app.campaign.formatPrice(price);\r\n    }\r\n    \r\n    // Otherwise, use a simple formatter\r\n    return `${this.#config.currencySymbol}${price.toFixed(2)} USD`;\r\n  }\r\n\r\n  /**\r\n   * Simple debounce function for resize events\r\n   * @param {Function} func - Function to debounce\r\n   * @param {number} wait - Wait time in milliseconds\r\n   * @returns {Function} Debounced function\r\n   */\r\n  #debounce(func, wait) {\r\n    let timeout;\r\n    return function executedFunction(...args) {\r\n      const later = () => {\r\n        clearTimeout(timeout);\r\n        func(...args);\r\n      };\r\n      clearTimeout(timeout);\r\n      timeout = setTimeout(later, wait);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Update the compare total elements\r\n   * @param {Object} totals - Cart totals\r\n   */\r\n  #updateCompareTotals(totals) {\r\n    if (!this.#elements.compareTotalElements.length) {\r\n      this.#logger.debugWithTime('No compare-total elements found');\r\n      return;\r\n    }\r\n    \r\n    this.#logger.debugWithTime('Updating compare-total elements');\r\n    this.#logger.debugWithTime(`Cart totals: ${JSON.stringify(totals)}`);\r\n    \r\n    // Add debug attribute to body to help inspect the totals in browser\r\n    document.body.setAttribute('data-debug-cart-totals', JSON.stringify({\r\n      total: totals.total,\r\n      subtotal: totals.subtotal,\r\n      original_subtotal: totals.original_subtotal,\r\n      retail_subtotal: totals.retail_subtotal,\r\n      discount: totals.discount\r\n    }));\r\n    \r\n    this.#elements.compareTotalElements.forEach(element => {\r\n      // Get the data attribute that specifies which total to use\r\n      const totalType = element.dataset.totalType || 'retail';\r\n      let compareValue = null;\r\n      \r\n      // Priority order for compare value:\r\n      // 1. If retail_subtotal exists and is higher than subtotal, use that (hardcoded product discount)\r\n      // 2. If a coupon is applied, use original_subtotal (coupon discount)\r\n      // 3. Fall back to specified totalType\r\n      \r\n      // Check for retail pricing first (highest priority)\r\n      if (totals.retail_subtotal && totals.retail_subtotal > totals.subtotal) {\r\n        compareValue = totals.retail_subtotal;\r\n        this.#logger.debugWithTime(`Using retail_subtotal (${compareValue}) as compare value - product has built-in discount`);\r\n      }\r\n      // Then check for coupon discount\r\n      else if (totals.discount > 0) {\r\n        // If we have original_subtotal, use it, otherwise calculate it\r\n        compareValue = totals.original_subtotal || (totals.subtotal + totals.discount);\r\n        this.#logger.debugWithTime(`Using original_subtotal (${compareValue}) as compare value because a coupon is applied`);\r\n      }\r\n      // Finally fall back to the specified type\r\n      else {\r\n        switch (totalType) {\r\n          case 'retail':\r\n            compareValue = totals.retail_subtotal;\r\n            break;\r\n          case 'recurring':\r\n            compareValue = totals.recurring_total;\r\n            break;\r\n          case 'subtotal_compare':\r\n          case 'original':\r\n          case 'msrp':\r\n            compareValue = totals[totalType] || null;\r\n            break;\r\n          default:\r\n            compareValue = totals.retail_subtotal;\r\n        }\r\n      }\r\n      \r\n      // Special case: If retail_subtotal exists AND coupon is applied, show the higher of the two\r\n      if (totals.retail_subtotal && totals.discount > 0) {\r\n        const couponCompareValue = totals.original_subtotal || (totals.subtotal + totals.discount);\r\n        if (totals.retail_subtotal > couponCompareValue) {\r\n          compareValue = totals.retail_subtotal;\r\n          this.#logger.debugWithTime(`Using retail_subtotal (${compareValue}) as it's higher than original_subtotal with coupon`);\r\n        } else {\r\n          compareValue = couponCompareValue;\r\n          this.#logger.debugWithTime(`Using original_subtotal (${compareValue}) as it's higher than retail_subtotal`);\r\n        }\r\n      }\r\n      \r\n      // Special handling for diagonal-line style elements\r\n      const hasStyleAttr = element.hasAttribute('data-style');\r\n      const style = element.getAttribute('data-style');\r\n      const isDiagonalLine = style === 'diagonal-line';\r\n      \r\n      // Log details about the element for debugging\r\n      this.#logger.debugWithTime(`Element ${element.outerHTML} has style? ${hasStyleAttr}, style=${style}, isDiagonal=${isDiagonalLine}`);\r\n      this.#logger.debugWithTime(`Compare value: ${compareValue}, Total: ${totals.total}, Should show? ${compareValue && compareValue > totals.total}`);\r\n      \r\n      // Set a data attribute with the compare value for debugging\r\n      element.setAttribute('data-compare-value', compareValue || 'none');\r\n      \r\n      // Different handling based on styling of the element\r\n      if (isDiagonalLine) {\r\n        if (compareValue && compareValue > totals.total) {\r\n          // For diagonal-line style, add the \"diagonal-strike\" class instead of hiding\r\n          element.classList.add('diagonal-strike');\r\n          element.textContent = this.#formatPrice(compareValue);\r\n          element.classList.remove('hide');\r\n          this.#logger.debugWithTime(`Updated diagonal-line compare-total to: ${this.#formatPrice(compareValue)}`);\r\n        } else {\r\n          // Hide if no valid compare value\r\n          element.classList.remove('diagonal-strike');\r\n          element.classList.add('hide');\r\n        }\r\n      } else {\r\n        // Standard handling for other elements\r\n        if (compareValue && compareValue > totals.total) {\r\n          element.textContent = this.#formatPrice(compareValue);\r\n          element.classList.remove('hide');\r\n          this.#logger.debugWithTime(`Updated compare-total to: ${this.#formatPrice(compareValue)}`);\r\n        } else {\r\n          // Hide the element if there's no compare value or it's not greater than the current total\r\n          element.classList.add('hide');\r\n          this.#logger.debugWithTime(`Hiding compare-total element: compareValue=${compareValue}, total=${totals.total}`);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Find all elements with a specific data attribute across all summary containers\r\n   * @param {string} attribute - The data attribute to search for\r\n   * @returns {NodeList} - All matching elements\r\n   */\r\n  #findAllSummaryElements(attribute) {\r\n    return document.querySelectorAll(`[${attribute}]`);\r\n  }\r\n\r\n  /**\r\n   * Refresh the cart display and re-find all elements\r\n   * This can be called after dynamic content is loaded or when the viewport changes\r\n   */\r\n  refresh() {\r\n    this.#logger.infoWithTime('Manually refreshing cart display');\r\n    this.#initCartDisplay();\r\n  }\r\n} ", "/**\r\n * AttributionManager - Manages attribution data for analytics and tracking\r\n * \r\n * This class is responsible for collecting, storing, and retrieving attribution data\r\n * from various sources (URL parameters, cookies, localStorage, etc.) and making it\r\n * available to the application through the state manager.\r\n */\r\n\r\nexport class AttributionManager {\r\n  #app;\r\n  #logger;\r\n  #attributionData = {};\r\n  #initialized = false;\r\n\r\n  /**\r\n   * Initialize the AttributionManager\r\n   * @param {Object} app - The main application instance\r\n   */\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#logger = app.logger.createModuleLogger('ATTRIBUTION');\r\n    this.#init();\r\n  }\r\n\r\n  /**\r\n   * Initialize the AttributionManager\r\n   */\r\n  #init() {\r\n    this.#logger.info('Initializing AttributionManager');\r\n    this.#collectAttributionData();\r\n    this.#storeAttributionData();\r\n    this.#setupEventListeners();\r\n    this.#initialized = true;\r\n    this.#logger.info('AttributionManager initialized successfully');\r\n  }\r\n\r\n  /**\r\n   * Collect attribution data from various sources\r\n   */\r\n  #collectAttributionData() {\r\n    // Build metadata object for additional tracking data\r\n    const metadata = {\r\n      landing_page: window.location.href || '',\r\n      referrer: document.referrer || '',\r\n      device: navigator.userAgent || '',\r\n      device_type: this.#getDeviceType(),\r\n      timestamp: Date.now(),\r\n      domain: window.location.hostname,\r\n      \r\n      // Facebook tracking data\r\n      fb_fbp: this.#getCookie('_fbp') || '',\r\n      fb_fbc: this.#getCookie('_fbc') || '',\r\n      fb_pixel_id: this.#getFacebookPixelId()\r\n    };\r\n    \r\n    // Add fbclid to metadata if it exists\r\n    const fbclid = this.#getStoredValue('fbclid') || '';\r\n    if (fbclid) {\r\n      metadata.fbclid = fbclid;\r\n    }\r\n    \r\n    // Handle Everflow click ID (evclid)\r\n    this.#handleEverflowClickId(metadata);\r\n    \r\n    // Collect all meta tracking tags and add them to metadata\r\n    this.#collectTrackingTags(metadata);\r\n\r\n    // Get the affiliate value from affid or aff parameters\r\n    const affiliate = this.#getStoredValue('affid') || this.#getStoredValue('aff') || '';\r\n\r\n    // Collect UTM parameters and other tracking data\r\n    this.#attributionData = {\r\n      // Attribution API compatible fields\r\n      affiliate: affiliate,\r\n      funnel: '', // Will be set later when campaign data is available\r\n      gclid: this.#getStoredValue('gclid') || '',\r\n      metadata: metadata,\r\n      \r\n      // Standard UTM parameters\r\n      utm_source: this.#getStoredValue('utm_source') || '',\r\n      utm_medium: this.#getStoredValue('utm_medium') || '',\r\n      utm_campaign: this.#getStoredValue('utm_campaign') || '',\r\n      utm_content: this.#getStoredValue('utm_content') || '',\r\n      utm_term: this.#getStoredValue('utm_term') || '',\r\n      \r\n      // Other tracking parameters\r\n      fbclid: fbclid,\r\n      \r\n      // Sub-affiliate parameters\r\n      subaffiliate1: this.#getStoredValue('subaffiliate1') || this.#getStoredValue('sub1') || '',\r\n      subaffiliate2: this.#getStoredValue('subaffiliate2') || this.#getStoredValue('sub2') || '',\r\n      subaffiliate3: this.#getStoredValue('subaffiliate3') || this.#getStoredValue('sub3') || '',\r\n      subaffiliate4: this.#getStoredValue('subaffiliate4') || this.#getStoredValue('sub4') || '',\r\n      subaffiliate5: this.#getStoredValue('subaffiliate5') || this.#getStoredValue('sub5') || '',\r\n      \r\n      // Time data\r\n      first_visit_timestamp: this.#getFirstVisitTimestamp(),\r\n      current_visit_timestamp: Date.now()\r\n    };\r\n\r\n    this.#logger.debug('Attribution data collected');\r\n  }\r\n\r\n  /**\r\n   * Handle Everflow click ID tracking\r\n   * @param {Object} metadata - The metadata object to update\r\n   */\r\n  #handleEverflowClickId(metadata) {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    let evclid = localStorage.getItem(\"evclid\");\r\n    \r\n    // Check URL parameters first\r\n    if (urlParams.has(\"evclid\")) {\r\n      evclid = urlParams.get(\"evclid\");\r\n      localStorage.setItem(\"evclid\", evclid);\r\n      sessionStorage.setItem(\"evclid\", evclid);\r\n      this.#logger.debug(`Everflow click ID found in URL: ${evclid}`);\r\n    } \r\n    // Try sessionStorage as fallback\r\n    else if (!evclid && sessionStorage.getItem(\"evclid\")) {\r\n      evclid = sessionStorage.getItem(\"evclid\");\r\n      localStorage.setItem(\"evclid\", evclid);\r\n      this.#logger.debug(`Everflow click ID found in sessionStorage: ${evclid}`);\r\n    }\r\n    \r\n    // Handle sg_evclid separately\r\n    if (urlParams.has(\"sg_evclid\")) {\r\n      const sg_evclid = urlParams.get(\"sg_evclid\");\r\n      sessionStorage.setItem(\"sg_evclid\", sg_evclid);\r\n      localStorage.setItem(\"sg_evclid\", sg_evclid);\r\n      metadata.sg_evclid = sg_evclid;\r\n      this.#logger.debug(`SG Everflow click ID found: ${sg_evclid}`);\r\n    } else if (localStorage.getItem(\"sg_evclid\")) {\r\n      metadata.sg_evclid = localStorage.getItem(\"sg_evclid\");\r\n    }\r\n    \r\n    // Set the transaction ID in metadata if we have it\r\n    if (evclid) {\r\n      metadata.everflow_transaction_id = evclid;\r\n      this.#logger.debug(`Added Everflow transaction ID to metadata: ${evclid}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Collect all meta tracking tags and add them to metadata object\r\n   * @param {Object} metadata - The metadata object to update\r\n   */\r\n  #collectTrackingTags(metadata) {\r\n    const trackingTags = document.querySelectorAll('meta[name=\"os-tracking-tag\"]');\r\n    this.#logger.debug(`Found ${trackingTags.length} tracking tags`);\r\n    \r\n    trackingTags.forEach(tag => {\r\n      const tagName = tag.getAttribute('data-tag-name');\r\n      const tagValue = tag.getAttribute('data-tag-value');\r\n      const shouldPersist = tag.getAttribute('data-persist') === 'true';\r\n      \r\n      if (tagName && tagValue) {\r\n        metadata[tagName] = tagValue;\r\n        this.#logger.debug(`Added tracking tag: ${tagName} = ${tagValue}`);\r\n        \r\n        // Store in sessionStorage if it should persist\r\n        if (shouldPersist) {\r\n          try {\r\n            sessionStorage.setItem(`os_tag_${tagName}`, tagValue);\r\n            this.#logger.debug(`Persisted tracking tag: ${tagName} = ${tagValue}`);\r\n          } catch (error) {\r\n            this.#logger.error(`Error persisting tracking tag ${tagName}:`, error);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Store attribution data in the state\r\n   */\r\n  #storeAttributionData() {\r\n    if (!this.#app.state) {\r\n      this.#logger.warn('State manager not available, attribution data will not be stored');\r\n      return;\r\n    }\r\n\r\n    // Store the complete attribution data in the cart attribution\r\n    this.#app.state.setState('cart.attribution', this.#attributionData);\r\n    \r\n    // Also store specific API-compatible attribution object for checkout\r\n    this.#app.state.setState('attribution', this.getAttributionForApi());\r\n    \r\n    // Store in localStorage for persistence across sessions\r\n    this.#persistAttributionData();\r\n    \r\n    // Trigger attribution updated event\r\n    if (this.#app.events) {\r\n      this.#app.events.trigger('attribution.updated', {\r\n        attribution: this.#attributionData\r\n      });\r\n    }\r\n    \r\n    this.#logger.debug('Attribution data stored in state');\r\n  }\r\n\r\n  /**\r\n   * Persist attribution data to localStorage\r\n   */\r\n  #persistAttributionData() {\r\n    try {\r\n      localStorage.setItem('os_attribution', JSON.stringify(this.#attributionData));\r\n      this.#logger.debug('Attribution data persisted to localStorage');\r\n    } catch (error) {\r\n      this.#logger.error('Error persisting attribution data to localStorage:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load persisted attribution data from localStorage\r\n   * @returns {Object} The loaded attribution data\r\n   */\r\n  #loadPersistedAttributionData() {\r\n    try {\r\n      const persistedData = localStorage.getItem('os_attribution');\r\n      if (persistedData) {\r\n        return JSON.parse(persistedData);\r\n      }\r\n    } catch (error) {\r\n      this.#logger.error('Error loading attribution data from localStorage:', error);\r\n    }\r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * Get the first visit timestamp\r\n   * @returns {number} The timestamp of the first visit\r\n   */\r\n  #getFirstVisitTimestamp() {\r\n    // Try to get from localStorage first\r\n    const persistedData = this.#loadPersistedAttributionData();\r\n    if (persistedData.first_visit_timestamp) {\r\n      return persistedData.first_visit_timestamp;\r\n    }\r\n    \r\n    // Otherwise, use the current timestamp\r\n    return Date.now();\r\n  }\r\n\r\n  /**\r\n   * Set up event listeners for page navigation\r\n   */\r\n  #setupEventListeners() {\r\n    // Listen for page changes to update landing page\r\n    window.addEventListener('popstate', () => {\r\n      const metadata = this.#attributionData.metadata || {};\r\n      metadata.landing_page = window.location.href;\r\n      \r\n      this.updateAttributionData({\r\n        metadata: metadata\r\n      });\r\n    });\r\n    \r\n    // Listen for campaign data loading\r\n    if (this.#app.events) {\r\n      this.#app.events.on('campaign.loaded', (data) => {\r\n        if (data && data.campaign && data.campaign.name && !this.#attributionData.funnel) {\r\n          // Set funnel name if not already set\r\n          // Check for meta tag first\r\n          const funnelMetaTag = document.querySelector('meta[name=\"os-tracking-tag\"][data-tag-name=\"funnel_name\"]');\r\n          const funnelName = funnelMetaTag?.getAttribute('data-tag-value') || data.campaign.name;\r\n          \r\n          // Set the funnel name\r\n          this.setFunnelName(funnelName);\r\n        }\r\n      });\r\n      \r\n      // Listen for cart creation events\r\n      this.#app.events.on('prospect.cartCreated', () => {\r\n        const metadata = this.#attributionData.metadata || {};\r\n        metadata.conversion_timestamp = Date.now();\r\n        \r\n        this.updateAttributionData({\r\n          metadata: metadata\r\n        });\r\n        \r\n        this.#logger.debug('Cart created, updated metadata with conversion timestamp');\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update attribution data with new values\r\n   * @param {Object} newData - New attribution data to merge\r\n   */\r\n  updateAttributionData(newData) {\r\n    // Handle metadata updates specially to merge them instead of replacing\r\n    if (newData.metadata && this.#attributionData.metadata) {\r\n      newData.metadata = {\r\n        ...this.#attributionData.metadata,\r\n        ...newData.metadata\r\n      };\r\n    }\r\n    \r\n    // Special case for funnel - use the new value and log it\r\n    if (newData.funnel) {\r\n      this.#logger.debug(`Updating funnel value to: ${newData.funnel}`);\r\n    }\r\n    \r\n    this.#attributionData = {\r\n      ...this.#attributionData,\r\n      ...newData\r\n    };\r\n    \r\n    this.#storeAttributionData();\r\n    this.#logger.debug('Attribution data updated', newData);\r\n    \r\n    // Trigger event\r\n    if (this.#app.events) {\r\n      this.#app.events.trigger('attribution.updated', {\r\n        attribution: this.#attributionData\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get attribution data\r\n   * @returns {Object} The current attribution data\r\n   */\r\n  getAttributionData() {\r\n    return { ...this.#attributionData };\r\n  }\r\n  \r\n  /**\r\n   * Get attribution data formatted for API\r\n   * @returns {Object} Attribution data formatted for API\r\n   */\r\n  getAttributionForApi() {\r\n    // Get Everflow transaction ID from metadata\r\n    const everflowTransactionId = this.#attributionData.metadata?.everflow_transaction_id || '';\r\n    \r\n    return {\r\n      // Core attribution fields\r\n      affiliate: this.#attributionData.affiliate,\r\n      funnel: this.#attributionData.funnel,\r\n      gclid: this.#attributionData.gclid,\r\n      metadata: this.#attributionData.metadata,\r\n      \r\n      // Everflow transaction ID at root level\r\n      everflow_transaction_id: everflowTransactionId,\r\n      \r\n      // UTM parameters at root level as required by API\r\n      utm_source: this.#attributionData.utm_source,\r\n      utm_medium: this.#attributionData.utm_medium,\r\n      utm_campaign: this.#attributionData.utm_campaign,\r\n      utm_content: this.#attributionData.utm_content,\r\n      utm_term: this.#attributionData.utm_term,\r\n      \r\n      // Subaffiliate parameters at root level as required by API\r\n      subaffiliate1: this.#attributionData.subaffiliate1,\r\n      subaffiliate2: this.#attributionData.subaffiliate2,\r\n      subaffiliate3: this.#attributionData.subaffiliate3,\r\n      subaffiliate4: this.#attributionData.subaffiliate4,\r\n      subaffiliate5: this.#attributionData.subaffiliate5\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Debug method to log attribution data to console\r\n   * Useful for troubleshooting attribution issues\r\n   */\r\n  debug() {\r\n    console.group('AttributionManager Debug Info');\r\n    \r\n    // Check sources for funnel value\r\n    const funnelMetaTag = document.querySelector('meta[name=\"os-tracking-tag\"][data-tag-name=\"funnel_name\"]');\r\n    const funnelFromTag = funnelMetaTag ? funnelMetaTag.getAttribute('data-tag-value') : '';\r\n    const campaignName = this.#app.campaign?.getCampaignName() || this.#app.campaignData?.name || '';\r\n    \r\n    // Show key attribution values first for quick reference\r\n    console.log('Key Attribution Values:');\r\n    console.log('- Affiliate:', this.#attributionData.affiliate);\r\n    console.log('- Funnel:', this.#attributionData.funnel);\r\n    console.log('  • Funnel from meta tag:', funnelFromTag || '(not set)');\r\n    console.log('  • Campaign name:', campaignName || '(not set)');\r\n    console.log('  • Source used:', funnelFromTag ? 'meta tag' : (campaignName ? 'campaign name' : 'none'));\r\n    \r\n    // Everflow information\r\n    console.log('Everflow Information:');\r\n    console.log('- localStorage evclid:', localStorage.getItem('evclid') || '(not set)');\r\n    console.log('- sessionStorage evclid:', sessionStorage.getItem('evclid') || '(not set)');\r\n    console.log('- metadata.everflow_transaction_id:', this.#attributionData.metadata?.everflow_transaction_id || '(not set)');\r\n    console.log('- Is EF object available:', typeof window.EF !== 'undefined' ? 'Yes' : 'No');\r\n    \r\n    // API formatted data\r\n    console.group('API Formatted Attribution Data (What gets sent to API)');\r\n    const apiData = this.getAttributionForApi();\r\n    \r\n    // Core fields\r\n    console.log('Core Fields:');\r\n    console.log('- affiliate:', apiData.affiliate);\r\n    console.log('- funnel:', apiData.funnel);\r\n    console.log('- gclid:', apiData.gclid);\r\n    \r\n    // UTM parameters\r\n    console.log('UTM Parameters:');\r\n    console.log('- utm_source:', apiData.utm_source);\r\n    console.log('- utm_medium:', apiData.utm_medium);\r\n    console.log('- utm_campaign:', apiData.utm_campaign);\r\n    console.log('- utm_content:', apiData.utm_content);\r\n    console.log('- utm_term:', apiData.utm_term);\r\n    \r\n    // Subaffiliate parameters\r\n    console.log('Subaffiliate Parameters:');\r\n    console.log('- subaffiliate1:', apiData.subaffiliate1);\r\n    console.log('- subaffiliate2:', apiData.subaffiliate2);\r\n    console.log('- subaffiliate3:', apiData.subaffiliate3);\r\n    console.log('- subaffiliate4:', apiData.subaffiliate4);\r\n    console.log('- subaffiliate5:', apiData.subaffiliate5);\r\n    \r\n    // Metadata\r\n    console.group('Metadata Object:');\r\n    console.log('- Domain:', apiData.metadata.domain);\r\n    console.log('- Device (User Agent):', apiData.metadata.device);\r\n    console.log('- Device Type:', apiData.metadata.device_type);\r\n    \r\n    // Facebook data in metadata\r\n    console.log('- Facebook Data:');\r\n    console.log('  - fb_fbp:', apiData.metadata.fb_fbp);\r\n    console.log('  - fb_fbc:', apiData.metadata.fb_fbc);\r\n    console.log('  - fb_pixel_id:', apiData.metadata.fb_pixel_id);\r\n    \r\n    console.log('- Full Metadata:', apiData.metadata);\r\n    console.groupEnd();\r\n    \r\n    console.groupEnd();\r\n    \r\n    // Raw attribution data\r\n    console.log('Raw Attribution Data:', this.#attributionData);\r\n    console.log('URL Parameters:', new URLSearchParams(window.location.search).toString());\r\n    \r\n    // Display tracking tags\r\n    console.group('Tracking Tags');\r\n    const trackingTags = document.querySelectorAll('meta[name=\"os-tracking-tag\"]');\r\n    if (trackingTags.length > 0) {\r\n      trackingTags.forEach(tag => {\r\n        console.log(`${tag.getAttribute('data-tag-name')}: ${tag.getAttribute('data-tag-value')}${tag.getAttribute('data-persist') === 'true' ? ' (persisted)' : ''}`);\r\n      });\r\n    } else {\r\n      console.log('No tracking tags found');\r\n    }\r\n    console.groupEnd();\r\n    \r\n    // Check for the funnel meta tag\r\n    console.log('Funnel Meta Tag:', funnelMetaTag ? {\r\n      exists: true,\r\n      value: funnelMetaTag.getAttribute('data-tag-value')\r\n    } : {\r\n      exists: false\r\n    });\r\n    \r\n    // Campaign data\r\n    console.log('Campaign Name:', this.#app.campaignData?.name || 'Not available');\r\n    \r\n    // Check state data\r\n    if (this.#app.state) {\r\n      console.log('API-formatted State Attribution:', this.#app.state.getState('attribution'));\r\n    }\r\n    \r\n    console.groupEnd();\r\n    \r\n    return 'Attribution debug info logged to console.';\r\n  }\r\n\r\n  /**\r\n   * Get a value from URL parameters, sessionStorage, or localStorage\r\n   * @param {string} key - The key to get\r\n   * @returns {string} The value\r\n   */\r\n  #getStoredValue(key) {\r\n    // Try to get from URL parameters first (highest priority)\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    if (urlParams.has(key)) {\r\n      const value = urlParams.get(key);\r\n      \r\n      // Store in sessionStorage for persistence during the session\r\n      try {\r\n        sessionStorage.setItem(key, value);\r\n      } catch (error) {\r\n        this.#logger.error(`Error storing ${key} in sessionStorage:`, error);\r\n      }\r\n      \r\n      return value;\r\n    }\r\n    \r\n    // Try to get from sessionStorage (second priority)\r\n    try {\r\n      if (sessionStorage.getItem(key)) {\r\n        return sessionStorage.getItem(key);\r\n      }\r\n    } catch (error) {\r\n      this.#logger.error(`Error reading ${key} from sessionStorage:`, error);\r\n    }\r\n    \r\n    // Try to get from localStorage (third priority)\r\n    try {\r\n      if (localStorage.getItem(key)) {\r\n        return localStorage.getItem(key);\r\n      }\r\n    } catch (error) {\r\n      this.#logger.error(`Error reading ${key} from localStorage:`, error);\r\n    }\r\n    \r\n    // Try to get from persisted attribution data (lowest priority)\r\n    const persistedData = this.#loadPersistedAttributionData();\r\n    if (persistedData[key]) {\r\n      return persistedData[key];\r\n    }\r\n    \r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Get a cookie value\r\n   * @param {string} name - The cookie name\r\n   * @returns {string} The cookie value\r\n   */\r\n  #getCookie(name) {\r\n    const value = `; ${document.cookie}`;\r\n    const parts = value.split(`; ${name}=`);\r\n    if (parts.length === 2) return parts.pop().split(';').shift();\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Get the device type based on user agent\r\n   * @returns {string} The device type\r\n   */\r\n  #getDeviceType() {\r\n    const userAgent = navigator.userAgent;\r\n    \r\n    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)) {\r\n      return 'mobile';\r\n    }\r\n    \r\n    return 'desktop';\r\n  }\r\n\r\n  /**\r\n   * Try to detect Facebook Pixel ID from the page\r\n   * @returns {string} The Facebook Pixel ID or empty string if not found\r\n   */\r\n  #getFacebookPixelId() {\r\n    // First check for dedicated os-facebook-pixel meta tag (highest priority)\r\n    const osFbPixelMeta = document.querySelector('meta[name=\"os-facebook-pixel\"]');\r\n    if (osFbPixelMeta) {\r\n      const pixelId = osFbPixelMeta.getAttribute('content');\r\n      if (pixelId) {\r\n        this.#logger.debug(`Facebook Pixel ID found from os-facebook-pixel meta tag: ${pixelId}`);\r\n        return pixelId;\r\n      }\r\n    }\r\n    \r\n    // Try to find FB Pixel ID from script tags\r\n    const scripts = document.querySelectorAll('script');\r\n    for (const script of scripts) {\r\n      const content = script.textContent || '';\r\n      if (content.includes('fbq(') && content.includes('init')) {\r\n        const match = content.match(/fbq\\s*\\(\\s*['\"]init['\"],\\s*['\"](\\d+)['\"]/);\r\n        if (match && match[1]) {\r\n          return match[1];\r\n        }\r\n      }\r\n    }\r\n    \r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Set the funnel name in attribution data\r\n   * Simple method to set the funnel name\r\n   * @param {string} funnelName - The funnel name to set\r\n   */\r\n  setFunnelName(funnelName) {\r\n    if (!funnelName) {\r\n      this.#logger.warn('Cannot set empty funnel name');\r\n      return false;\r\n    }\r\n\r\n    // Update the funnel field in attribution data\r\n    this.#attributionData.funnel = funnelName;\r\n    \r\n    // Store in state manager - this will handle syncing with session storage\r\n    this.#storeAttributionData();\r\n    \r\n    this.#logger.info(`Funnel name set to: ${funnelName}`);\r\n    \r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Set the Everflow click ID (evclid) in attribution data\r\n   * @param {string} clickId - The Everflow click ID to set\r\n   * @returns {boolean} True if the ID was set successfully\r\n   */\r\n  setEverflowClickId(clickId) {\r\n    if (!clickId) {\r\n      this.#logger.warn('Cannot set empty Everflow click ID');\r\n      return false;\r\n    }\r\n\r\n    // Store in local/session storage\r\n    localStorage.setItem(\"evclid\", clickId);\r\n    sessionStorage.setItem(\"evclid\", clickId);\r\n\r\n    // Update the metadata with the transaction ID\r\n    const metadata = this.#attributionData.metadata || {};\r\n    metadata.everflow_transaction_id = clickId;\r\n    \r\n    // Update attribution data\r\n    this.updateAttributionData({\r\n      metadata: metadata\r\n    });\r\n    \r\n    this.#logger.info(`Everflow click ID set to: ${clickId}`);\r\n    \r\n    return true;\r\n  }\r\n} ", "/**\r\n * EventManager - Manages platform-specific events\r\n * \r\n * This class provides a centralized system for firing events to different platforms\r\n * such as Google Tag Manager, Facebook Pixel, etc. It handles ecommerce events\r\n * like view_item_list, add_to_cart, purchase, etc.\r\n */\r\n\r\nexport class EventManager {\r\n  #app;\r\n  #logger;\r\n  #isInitialized = false;\r\n  #platforms = {\r\n    gtm: { enabled: false, initialized: false },\r\n    fbPixel: { enabled: false, initialized: false },\r\n    ga4: { enabled: false, initialized: false }\r\n  };\r\n  #debugMode = false;\r\n  #processedOrderIds = new Set(); // Track processed order IDs to prevent duplicates\r\n  #viewItemListFired = false; // Track if view_item_list has been fired\r\n  #disabledEvents = new Set(); // Track which events are disabled\r\n\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#logger = app.logger.createModuleLogger('EVENT');\r\n    this.#debugMode = app.options?.debug || false;\r\n    \r\n    // Initialize the event manager\r\n    this.init();\r\n  }\r\n\r\n  /**\r\n   * Initialize the event manager\r\n   */\r\n  init() {\r\n    this.#logger.info('Initializing EventManager');\r\n    \r\n    // Detect available platforms\r\n    this.#detectPlatforms();\r\n    \r\n    // Load disabled events configuration\r\n    this.#loadDisabledEventsConfig();\r\n    \r\n    // Subscribe to relevant app events\r\n    this.#setupEventListeners();\r\n    \r\n    // Load processed order IDs from sessionStorage to prevent duplicates across page loads\r\n    this.#loadProcessedOrderIds();\r\n    \r\n    this.#isInitialized = true;\r\n    this.#logger.info('EventManager initialized');\r\n  }\r\n\r\n  /**\r\n   * Load disabled events from global configuration\r\n   */\r\n  #loadDisabledEventsConfig() {\r\n    // Check for window.osConfig.disabledEvents\r\n    if (window.osConfig && window.osConfig.disabledEvents) {\r\n      // Clear existing set\r\n      this.#disabledEvents.clear();\r\n      \r\n      // Parse disabled events array or object\r\n      if (Array.isArray(window.osConfig.disabledEvents)) {\r\n        // Handle array format: ['view_item', 'purchase', etc.]\r\n        window.osConfig.disabledEvents.forEach(eventName => {\r\n          this.#disabledEvents.add(eventName);\r\n        });\r\n      } else if (typeof window.osConfig.disabledEvents === 'object') {\r\n        // Handle object format: {view_item: true, purchase: true, etc.}\r\n        Object.entries(window.osConfig.disabledEvents).forEach(([eventName, isDisabled]) => {\r\n          if (isDisabled) {\r\n            this.#disabledEvents.add(eventName);\r\n          }\r\n        });\r\n      }\r\n      \r\n      if (this.#disabledEvents.size > 0) {\r\n        this.#logger.info(`Loaded disabled events configuration: ${Array.from(this.#disabledEvents).join(', ')}`);\r\n      }\r\n    }\r\n    \r\n    // Check for disabled platforms\r\n    if (window.osConfig && window.osConfig.disabledPlatforms) {\r\n      Object.entries(window.osConfig.disabledPlatforms).forEach(([platform, isDisabled]) => {\r\n        if (isDisabled && this.#platforms[platform]) {\r\n          this.#platforms[platform].enabled = false;\r\n          this.#logger.info(`Platform ${platform} disabled via configuration`);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if an event is disabled\r\n   * @param {string} eventName - The name of the event to check\r\n   * @returns {boolean} - Whether the event is disabled\r\n   */\r\n  #isEventDisabled(eventName) {\r\n    // Check for platform-specific events\r\n    // Format: 'platform:event' (e.g., 'fbPixel:purchase')\r\n    if (eventName.includes(':')) {\r\n      const [platform, event] = eventName.split(':');\r\n      \r\n      // Check if the platform itself is disabled\r\n      if (this.#platforms[platform] && !this.#platforms[platform].enabled) {\r\n        return true;\r\n      }\r\n      \r\n      return this.#disabledEvents.has(eventName);\r\n    }\r\n    \r\n    // Check for general event disabling (affects all platforms)\r\n    return this.#disabledEvents.has(eventName);\r\n  }\r\n\r\n  /**\r\n   * Load processed order IDs from sessionStorage\r\n   */\r\n  #loadProcessedOrderIds() {\r\n    try {\r\n      const storedIds = sessionStorage.getItem('os_processed_order_ids');\r\n      if (storedIds) {\r\n        const parsedIds = JSON.parse(storedIds);\r\n        if (Array.isArray(parsedIds)) {\r\n          parsedIds.forEach(id => this.#processedOrderIds.add(id));\r\n          this.#logger.debug(`Loaded ${parsedIds.length} processed order IDs from sessionStorage`);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      this.#logger.error('Error loading processed order IDs from sessionStorage:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Save processed order IDs to sessionStorage\r\n   */\r\n  #saveProcessedOrderIds() {\r\n    try {\r\n      const idsArray = Array.from(this.#processedOrderIds);\r\n      sessionStorage.setItem('os_processed_order_ids', JSON.stringify(idsArray));\r\n      this.#logger.debug(`Saved ${idsArray.length} processed order IDs to sessionStorage`);\r\n    } catch (error) {\r\n      this.#logger.error('Error saving processed order IDs to sessionStorage:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Detect which platforms are available\r\n   */\r\n  #detectPlatforms() {\r\n    // Check for Google Tag Manager\r\n    if (typeof window.dataLayer !== 'undefined') {\r\n      this.#platforms.gtm.enabled = true;\r\n      this.#platforms.gtm.initialized = true;\r\n      this.#logger.info('Google Tag Manager detected');\r\n    } else {\r\n      this.#logger.info('Google Tag Manager not detected');\r\n    }\r\n\r\n    // Check for Facebook Pixel\r\n    if (typeof window.fbq !== 'undefined') {\r\n      this.#platforms.fbPixel.enabled = true;\r\n      this.#platforms.fbPixel.initialized = true;\r\n      this.#logger.info('Facebook Pixel detected');\r\n    } else {\r\n      this.#logger.info('Facebook Pixel not detected');\r\n    }\r\n\r\n    // Check for Google Analytics 4\r\n    if (typeof window.gtag !== 'undefined') {\r\n      this.#platforms.ga4.enabled = true;\r\n      this.#platforms.ga4.initialized = true;\r\n      this.#logger.info('Google Analytics 4 detected');\r\n    } else {\r\n      this.#logger.info('Google Analytics 4 not detected');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup event listeners for app events\r\n   */\r\n  #setupEventListeners() {\r\n    // Keep track of previous cart state to detect changes\r\n    let previousCartItems = [];\r\n    \r\n    // Listen for campaign loaded event\r\n    this.#app.on('campaign.loaded', (data) => {\r\n      this.#logger.debug('Campaign loaded event received, triggering viewVisibleItemList');\r\n      this.viewVisibleItemList();\r\n    });\r\n\r\n    // Listen for cart updated event\r\n    this.#app.on('cart.updated', (data) => {\r\n      if (data.cart && data.cart.items && data.cart.items.length > 0) {\r\n        // Check if this is an actual item change or just other cart updates\r\n        const currentCartItemsJSON = JSON.stringify(data.cart.items.map(item => ({ \r\n          id: item.id, \r\n          quantity: item.quantity \r\n        })));\r\n        const previousCartItemsJSON = JSON.stringify(previousCartItems);\r\n        \r\n        // Only fire add_to_cart if items have changed\r\n        if (currentCartItemsJSON !== previousCartItemsJSON) {\r\n          this.#logger.debug('Cart items changed, firing add_to_cart event');\r\n          this.addToCart(data.cart);\r\n          \r\n          // Update previous cart items for next comparison\r\n          previousCartItems = data.cart.items.map(item => ({ \r\n            id: item.id, \r\n            quantity: item.quantity \r\n          }));\r\n        } else {\r\n          this.#logger.debug('Cart updated but items unchanged, not firing add_to_cart');\r\n        }\r\n      } else {\r\n        // Reset previous cart items if cart is empty\r\n        previousCartItems = [];\r\n      }\r\n    });\r\n\r\n    // Listen for order created event\r\n    // commented to trigger only on first page they load.\r\n\r\n    // this.#app.on('order.created', (data) => {\r\n    //   this.purchase(data);\r\n    // });\r\n    \r\n    // Listen for order loaded event\r\n    this.#app.on('order.loaded', (data) => {\r\n      this.#logger.debug('Received order.loaded event with data:', JSON.stringify(data, null, 2));\r\n      \r\n      if (data.order) {\r\n        this.#logger.info('Order loaded on receipt page, checking if purchase event needed');\r\n        this.purchase(data.order);\r\n      } else {\r\n        this.#logger.warn('Order.loaded event received but no order data found', data);\r\n      }\r\n    });\r\n  }\r\n  \r\n\r\n  /**\r\n   * Fire a view_item_list event\r\n   * @param {Object} campaignData - The campaign data\r\n   */\r\n  viewItemList(campaignData) {\r\n    this.#logger.debug('viewItemList called with campaign data:', campaignData ? 'present' : 'missing');\r\n    \r\n    if (!campaignData || !campaignData.packages || campaignData.packages.length === 0) {\r\n      this.#logger.warn('Cannot fire view_item_list event: No packages found in campaign data');\r\n      return;\r\n    }\r\n\r\n    this.#logger.debug(`Found ${campaignData.packages.length} packages in campaign data`);\r\n    \r\n    const items = campaignData.packages.map(pkg => {\r\n      // Ensure price is a number\r\n      const price = typeof pkg.price === 'string' ? parseFloat(pkg.price) : (pkg.price || 0);\r\n      \r\n      return {\r\n        item_id: pkg.external_id || pkg.ref_id,\r\n        item_name: pkg.name,\r\n        price: price,\r\n        currency: campaignData.currency || 'USD',\r\n        quantity: pkg.qty || 1\r\n      };\r\n    });\r\n\r\n    const eventData = {\r\n      event: 'view_item_list',\r\n      ecommerce: {\r\n        currency: campaignData.currency || 'USD',\r\n        items: items\r\n      }\r\n    };\r\n\r\n    this.#logger.debug('Firing view_item_list event with data:', eventData);\r\n    this.#fireEvent('view_item_list', eventData);\r\n  }\r\n\r\n  /**\r\n   * Fire an add_to_cart event\r\n   * @param {Object} cartData - The cart data or a single package object\r\n   */\r\n  addToCart(cartData) {\r\n    // Check if this is a single package object rather than a cart\r\n    const isSinglePackage = !cartData.items && !cartData.totals;\r\n    \r\n    let items = [];\r\n    let currency = 'USD';\r\n    let value = 0;\r\n    \r\n    if (isSinglePackage) {\r\n      // Convert single package to cart format\r\n      this.#logger.debug('addToCart called with single package, converting to cart format');\r\n      \r\n      if (!cartData) {\r\n        this.#logger.warn('Cannot fire add_to_cart event: No package data provided');\r\n        return;\r\n      }\r\n      \r\n      // Extract package data\r\n      const pkg = cartData;\r\n      const item = {\r\n        item_id: pkg.external_id || pkg.ref_id || pkg.id,\r\n        item_name: pkg.name,\r\n        price: parseFloat(pkg.price) || 0,\r\n        currency: pkg.currency || this.#app.getCampaignData()?.currency || 'USD',\r\n        quantity: pkg.quantity || 1\r\n      };\r\n      \r\n      items = [item];\r\n      currency = item.currency;\r\n      value = item.price * item.quantity;\r\n    } else {\r\n      // Standard cart format\r\n      if (!cartData || !cartData.items || cartData.items.length === 0) {\r\n        this.#logger.warn('Cannot fire add_to_cart event: No items in cart');\r\n        return;\r\n      }\r\n      \r\n      items = cartData.items.map(item => ({\r\n        item_id: item.external_id || item.id,\r\n        item_name: item.name,\r\n        price: parseFloat(item.price) || 0,\r\n        currency: cartData.totals?.currency || 'USD',\r\n        quantity: item.quantity || 1\r\n      }));\r\n      \r\n      currency = cartData.totals?.currency || 'USD';\r\n      value = cartData.totals?.total || 0;\r\n    }\r\n\r\n    const eventData = {\r\n      event: 'add_to_cart',\r\n      ecommerce: {\r\n        currency: currency,\r\n        value: value,\r\n        items: items\r\n      }\r\n    };\r\n\r\n    this.#fireEvent('add_to_cart', eventData);\r\n  }\r\n\r\n  /**\r\n   * Fire a purchase event\r\n   * @param {Object} orderData - The order data\r\n   * @param {boolean} force - Whether to force firing the event even if the order ID has been processed\r\n   */\r\n  purchase(orderData, force = false) {\r\n    if (!orderData || !orderData.lines || orderData.lines.length === 0) {\r\n      this.#logger.warn('Cannot fire purchase event: No items in order');\r\n      return;\r\n    }\r\n\r\n    // Check if this order has already been processed\r\n    const orderId = orderData.number || orderData.ref_id;\r\n    this.#logger.debug(`Purchase method called for order ${orderId}, force=${force}, already processed=${this.#processedOrderIds.has(orderId)}`);\r\n    \r\n    if (!force && orderId && this.#processedOrderIds.has(orderId)) {\r\n      this.#logger.info(`Purchase event for order ${orderId} already fired, skipping`);\r\n      return;\r\n    }\r\n\r\n    this.#logger.info(`Preparing to fire purchase event for order ${orderId}`);\r\n    \r\n    const items = orderData.lines.map(line => ({\r\n      item_id: line.product_id || line.id,\r\n      item_name: line.product_title || line.name,\r\n      price: parseFloat(line.price_incl_tax || line.price) || 0,\r\n      currency: orderData.currency || 'USD',\r\n      quantity: line.quantity || 1\r\n    }));\r\n\r\n    // Get user data with privacy considerations\r\n    const userData = this.#getUserDataForTracking(orderData);\r\n\r\n    const eventData = {\r\n      event: 'purchase',\r\n      ecommerce: {\r\n        transaction_id: orderId,\r\n        value: parseFloat(orderData.total_incl_tax || orderData.total) || 0,\r\n        tax: parseFloat(orderData.total_tax) || 0,\r\n        shipping: parseFloat(orderData.shipping_incl_tax || orderData.shipping) || 0,\r\n        currency: orderData.currency || 'USD',\r\n        coupon: orderData.vouchers?.length > 0 ? orderData.vouchers[0].code : '',\r\n        ...userData,\r\n        items: items\r\n      }\r\n    };\r\n\r\n    this.#fireEvent('purchase', eventData);\r\n\r\n    // Mark this order as processed\r\n    if (orderId) {\r\n      this.#processedOrderIds.add(orderId);\r\n      this.#saveProcessedOrderIds();\r\n      this.#logger.debug(`Marked order ${orderId} as processed, total processed orders: ${this.#processedOrderIds.size}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get user data for tracking with privacy considerations\r\n   * @param {Object} orderData - The order data\r\n   * @returns {Object} - User data for tracking\r\n   */\r\n  #getUserDataForTracking(orderData) {\r\n    const userData = {};\r\n    \r\n    if (orderData.user) {\r\n      // Only include non-PII data or hashed values\r\n      if (orderData.user.first_name) userData.firstname = orderData.user.first_name;\r\n      if (orderData.user.last_name) userData.lastname = orderData.user.last_name;\r\n      \r\n      // Hash email for privacy\r\n      if (orderData.user.email) {\r\n        userData.email_hash = this.#hashString(orderData.user.email);\r\n      }\r\n    }\r\n    \r\n    if (orderData.shipping_address) {\r\n      userData.city = orderData.shipping_address.line4 || '';\r\n      userData.state = orderData.shipping_address.state || '';\r\n      userData.zipcode = orderData.shipping_address.postcode || '';\r\n      userData.country = orderData.shipping_address.country || '';\r\n    }\r\n    \r\n    return userData;\r\n  }\r\n\r\n  /**\r\n   * Hash a string for privacy\r\n   * @param {string} str - The string to hash\r\n   * @returns {string} - The hashed string\r\n   */\r\n  #hashString(str) {\r\n    let hash = 0;\r\n    if (str.length === 0) return hash.toString();\r\n    \r\n    for (let i = 0; i < str.length; i++) {\r\n      const char = str.charCodeAt(i);\r\n      hash = ((hash << 5) - hash) + char;\r\n      hash = hash & hash; // Convert to 32bit integer\r\n    }\r\n    \r\n    return hash.toString();\r\n  }\r\n\r\n  /**\r\n   * Fire an event to all enabled platforms\r\n   * @param {string} eventName - The name of the event\r\n   * @param {Object} eventData - The event data\r\n   */\r\n  #fireEvent(eventName, eventData) {\r\n    // Check if this event is globally disabled\r\n    if (this.#isEventDisabled(eventName)) {\r\n      this.#logger.info(`Event ${eventName} is disabled by configuration, not firing`);\r\n      return;\r\n    }\r\n\r\n    this.#logger.debug(`Firing ${eventName} event`, eventData);\r\n\r\n    // Clear previous ecommerce data for GTM\r\n    if (this.#platforms.gtm.enabled && !this.#isEventDisabled(`gtm:${eventName}`)) {\r\n      window.dataLayer = window.dataLayer || [];\r\n      this.#logger.debug('Clearing previous ecommerce data in dataLayer');\r\n      window.dataLayer.push({ ecommerce: null });\r\n      \r\n      // Add a console log that's easy to spot\r\n      console.log(`🔥 Firing ${eventName} event to dataLayer`);\r\n      \r\n      // this.#logger.debug('Pushing event data to dataLayer');\r\n      window.dataLayer.push(eventData);\r\n      \r\n\r\n      this.#logger.debug(`${eventName} event fired to Google Tag Manager`);\r\n    } else if (this.#platforms.gtm.enabled) {\r\n      this.#logger.info(`GTM event ${eventName} is disabled by configuration, not firing to GTM`);\r\n    } else {\r\n      this.#logger.warn(`Cannot fire ${eventName} event to GTM: GTM not enabled`);\r\n      \r\n      // Try to initialize dataLayer anyway\r\n      console.log('GTM not detected, initializing dataLayer and pushing event');\r\n      window.dataLayer = window.dataLayer || [];\r\n      window.dataLayer.push({ ecommerce: null });\r\n      window.dataLayer.push(eventData);\r\n    }\r\n\r\n    // Fire event to Facebook Pixel\r\n    if (this.#platforms.fbPixel.enabled && !this.#isEventDisabled(`fbPixel:${eventName}`)) {\r\n      switch (eventName) {\r\n        case 'view_item_list':\r\n          window.fbq('track', 'ViewContent', {\r\n            content_type: 'product_group',\r\n            content_ids: eventData.ecommerce.items.map(item => item.item_id),\r\n            currency: eventData.ecommerce.currency\r\n          });\r\n          break;\r\n        case 'add_to_cart':\r\n          window.fbq('track', 'AddToCart', {\r\n            content_type: 'product_group',\r\n            content_ids: eventData.ecommerce.items.map(item => item.item_id),\r\n            currency: eventData.ecommerce.currency,\r\n            value: eventData.ecommerce.value\r\n          });\r\n          break;\r\n        case 'purchase':\r\n          window.fbq('track', 'Purchase', {\r\n            content_type: 'product_group',\r\n            content_ids: eventData.ecommerce.items.map(item => item.item_id),\r\n            currency: eventData.ecommerce.currency,\r\n            value: eventData.ecommerce.value\r\n          });\r\n          break;\r\n      }\r\n      this.#logger.debug(`${eventName} event fired to Facebook Pixel`);\r\n    } else if (this.#platforms.fbPixel.enabled) {\r\n      this.#logger.info(`Facebook Pixel event ${eventName} is disabled by configuration, not firing to FB Pixel`);\r\n    }\r\n\r\n    // Fire event to Google Analytics 4\r\n    if (this.#platforms.ga4.enabled && !this.#isEventDisabled(`ga4:${eventName}`)) {\r\n      window.gtag('event', eventName, {\r\n        currency: eventData.ecommerce.currency,\r\n        value: eventData.ecommerce.value,\r\n        items: eventData.ecommerce.items\r\n      });\r\n      this.#logger.debug(`${eventName} event fired to Google Analytics 4`);\r\n    } else if (this.#platforms.ga4.enabled) {\r\n      this.#logger.info(`GA4 event ${eventName} is disabled by configuration, not firing to GA4`);\r\n    }\r\n\r\n    // Dispatch a DOM event for custom handlers (this always fires regardless of disabled status)\r\n    const customEvent = new CustomEvent(`os:${eventName}`, {\r\n      bubbles: true,\r\n      detail: eventData\r\n    });\r\n    document.dispatchEvent(customEvent);\r\n  }\r\n\r\n  /**\r\n   * Manually fire a view_item event\r\n   * @param {Object} packageData - The package data\r\n   */\r\n  viewItem(packageData) {\r\n    if (!packageData) {\r\n      this.#logger.warn('Cannot fire view_item event: No package data provided');\r\n      return;\r\n    }\r\n\r\n    const item = {\r\n      item_id: packageData.ref_id || packageData.external_id || packageData.id,\r\n      item_name: packageData.name,\r\n      price: parseFloat(packageData.price) || 0,\r\n      currency: packageData.currency || this.#app.getCampaignData()?.currency || 'USD',\r\n      quantity: 1\r\n    };\r\n\r\n    const eventData = {\r\n      event: 'view_item',\r\n      ecommerce: {\r\n        currency: item.currency,\r\n        value: item.price,\r\n        items: [item]\r\n      }\r\n    };\r\n\r\n    this.#fireEvent('view_item', eventData);\r\n  }\r\n\r\n  /**\r\n   * Manually fire a begin_checkout event\r\n   */\r\n  beginCheckout() {\r\n    const cart = this.#app.state.getState('cart');\r\n    \r\n    if (!cart || !cart.items || cart.items.length === 0) {\r\n      this.#logger.warn('Cannot fire begin_checkout event: No items in cart');\r\n      return;\r\n    }\r\n\r\n    const items = cart.items.map(item => ({\r\n      item_id: item.external_id || item.id,\r\n      item_name: item.name,\r\n      price: parseFloat(item.price) || 0,\r\n      currency: cart.totals?.currency || 'USD',\r\n      quantity: item.quantity || 1\r\n    }));\r\n\r\n    const eventData = {\r\n      event: 'begin_checkout',\r\n      ecommerce: {\r\n        currency: cart.totals?.currency || 'USD',\r\n        value: cart.totals?.total || 0,\r\n        items: items\r\n      }\r\n    };\r\n\r\n    this.#fireEvent('begin_checkout', eventData);\r\n  }\r\n\r\n  /**\r\n   * Manually fire a custom event\r\n   * @param {string} eventName - The name of the event\r\n   * @param {Object} eventData - The event data\r\n   */\r\n  fireCustomEvent(eventName, eventData = {}) {\r\n    if (!eventName) {\r\n      this.#logger.warn('Cannot fire custom event: No event name provided');\r\n      return;\r\n    }\r\n\r\n    const formattedEventData = {\r\n      event: eventName,\r\n      ...eventData\r\n    };\r\n\r\n    this.#logger.debug(`Firing custom event: ${eventName}`, formattedEventData);\r\n\r\n    // Fire to Google Tag Manager\r\n    if (this.#platforms.gtm.enabled) {\r\n      window.dataLayer = window.dataLayer || [];\r\n      window.dataLayer.push(formattedEventData);\r\n      this.#logger.debug(`Custom event ${eventName} fired to Google Tag Manager`);\r\n    }\r\n\r\n    // Fire to Facebook Pixel\r\n    if (this.#platforms.fbPixel.enabled && typeof window.fbq === 'function') {\r\n      window.fbq('trackCustom', eventName, eventData);\r\n      this.#logger.debug(`Custom event ${eventName} fired to Facebook Pixel`);\r\n    }\r\n\r\n    // Fire to Google Analytics 4\r\n    if (this.#platforms.ga4.enabled && typeof window.gtag === 'function') {\r\n      window.gtag('event', eventName, eventData);\r\n      this.#logger.debug(`Custom event ${eventName} fired to Google Analytics 4`);\r\n    }\r\n\r\n    // Dispatch a DOM event for custom handlers\r\n    const customEvent = new CustomEvent(`os:${eventName}`, {\r\n      bubbles: true,\r\n      detail: formattedEventData\r\n    });\r\n    document.dispatchEvent(customEvent);\r\n  }\r\n\r\n  /**\r\n   * Enable or disable a platform\r\n   * @param {string} platform - The platform to enable/disable (gtm, fbPixel, ga4)\r\n   * @param {boolean} enabled - Whether to enable or disable the platform\r\n   */\r\n  setPlatformEnabled(platform, enabled) {\r\n    if (this.#platforms[platform]) {\r\n      this.#platforms[platform].enabled = enabled;\r\n      this.#logger.info(`${platform} ${enabled ? 'enabled' : 'disabled'}`);\r\n    } else {\r\n      this.#logger.warn(`Unknown platform: ${platform}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the status of all platforms\r\n   * @returns {Object} - The status of all platforms\r\n   */\r\n  getPlatformStatus() {\r\n    return { ...this.#platforms };\r\n  }\r\n  \r\n  /**\r\n   * Manually disable a specific event or platform-specific event\r\n   * @param {string} eventName - The event name to disable (can be format 'event' or 'platform:event')\r\n   */\r\n  disableEvent(eventName) {\r\n    this.#disabledEvents.add(eventName);\r\n    this.#logger.info(`Event ${eventName} has been disabled`);\r\n  }\r\n\r\n  /**\r\n   * Manually enable a previously disabled event\r\n   * @param {string} eventName - The event name to enable\r\n   */\r\n  enableEvent(eventName) {\r\n    this.#disabledEvents.delete(eventName);\r\n    this.#logger.info(`Event ${eventName} has been enabled`);\r\n  }\r\n\r\n  /**\r\n   * Get all currently disabled events\r\n   * @returns {string[]} - Array of disabled event names\r\n   */\r\n  getDisabledEvents() {\r\n    return Array.from(this.#disabledEvents);\r\n  }\r\n\r\n  /**\r\n   * Check if the EventManager is fully initialized\r\n   * @returns {boolean} - Whether the EventManager is initialized\r\n   */\r\n  get isInitialized() {\r\n    return this.#isInitialized;\r\n  }\r\n} ", "/**\n * Custom positioning reference element.\n * @see https://floating-ui.com/docs/virtual-elements\n */\n\nconst sides = ['top', 'right', 'bottom', 'left'];\nconst alignments = ['start', 'end'];\nconst placements = /*#__PURE__*/sides.reduce((acc, side) => acc.concat(side, side + \"-\" + alignments[0], side + \"-\" + alignments[1]), []);\nconst min = Math.min;\nconst max = Math.max;\nconst round = Math.round;\nconst floor = Math.floor;\nconst createCoords = v => ({\n  x: v,\n  y: v\n});\nconst oppositeSideMap = {\n  left: 'right',\n  right: 'left',\n  bottom: 'top',\n  top: 'bottom'\n};\nconst oppositeAlignmentMap = {\n  start: 'end',\n  end: 'start'\n};\nfunction clamp(start, value, end) {\n  return max(start, min(value, end));\n}\nfunction evaluate(value, param) {\n  return typeof value === 'function' ? value(param) : value;\n}\nfunction getSide(placement) {\n  return placement.split('-')[0];\n}\nfunction getAlignment(placement) {\n  return placement.split('-')[1];\n}\nfunction getOppositeAxis(axis) {\n  return axis === 'x' ? 'y' : 'x';\n}\nfunction getAxisLength(axis) {\n  return axis === 'y' ? 'height' : 'width';\n}\nfunction getSideAxis(placement) {\n  return ['top', 'bottom'].includes(getSide(placement)) ? 'y' : 'x';\n}\nfunction getAlignmentAxis(placement) {\n  return getOppositeAxis(getSideAxis(placement));\n}\nfunction getAlignmentSides(placement, rects, rtl) {\n  if (rtl === void 0) {\n    rtl = false;\n  }\n  const alignment = getAlignment(placement);\n  const alignmentAxis = getAlignmentAxis(placement);\n  const length = getAxisLength(alignmentAxis);\n  let mainAlignmentSide = alignmentAxis === 'x' ? alignment === (rtl ? 'end' : 'start') ? 'right' : 'left' : alignment === 'start' ? 'bottom' : 'top';\n  if (rects.reference[length] > rects.floating[length]) {\n    mainAlignmentSide = getOppositePlacement(mainAlignmentSide);\n  }\n  return [mainAlignmentSide, getOppositePlacement(mainAlignmentSide)];\n}\nfunction getExpandedPlacements(placement) {\n  const oppositePlacement = getOppositePlacement(placement);\n  return [getOppositeAlignmentPlacement(placement), oppositePlacement, getOppositeAlignmentPlacement(oppositePlacement)];\n}\nfunction getOppositeAlignmentPlacement(placement) {\n  return placement.replace(/start|end/g, alignment => oppositeAlignmentMap[alignment]);\n}\nfunction getSideList(side, isStart, rtl) {\n  const lr = ['left', 'right'];\n  const rl = ['right', 'left'];\n  const tb = ['top', 'bottom'];\n  const bt = ['bottom', 'top'];\n  switch (side) {\n    case 'top':\n    case 'bottom':\n      if (rtl) return isStart ? rl : lr;\n      return isStart ? lr : rl;\n    case 'left':\n    case 'right':\n      return isStart ? tb : bt;\n    default:\n      return [];\n  }\n}\nfunction getOppositeAxisPlacements(placement, flipAlignment, direction, rtl) {\n  const alignment = getAlignment(placement);\n  let list = getSideList(getSide(placement), direction === 'start', rtl);\n  if (alignment) {\n    list = list.map(side => side + \"-\" + alignment);\n    if (flipAlignment) {\n      list = list.concat(list.map(getOppositeAlignmentPlacement));\n    }\n  }\n  return list;\n}\nfunction getOppositePlacement(placement) {\n  return placement.replace(/left|right|bottom|top/g, side => oppositeSideMap[side]);\n}\nfunction expandPaddingObject(padding) {\n  return {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0,\n    ...padding\n  };\n}\nfunction getPaddingObject(padding) {\n  return typeof padding !== 'number' ? expandPaddingObject(padding) : {\n    top: padding,\n    right: padding,\n    bottom: padding,\n    left: padding\n  };\n}\nfunction rectToClientRect(rect) {\n  const {\n    x,\n    y,\n    width,\n    height\n  } = rect;\n  return {\n    width,\n    height,\n    top: y,\n    left: x,\n    right: x + width,\n    bottom: y + height,\n    x,\n    y\n  };\n}\n\nexport { alignments, clamp, createCoords, evaluate, expandPaddingObject, floor, getAlignment, getAlignmentAxis, getAlignmentSides, getAxisLength, getExpandedPlacements, getOppositeAlignmentPlacement, getOppositeAxis, getOppositeAxisPlacements, getOppositePlacement, getPaddingObject, getSide, getSideAxis, max, min, placements, rectToClientRect, round, sides };\n", "import { getSideAxis, getAlignmentAxis, getAxisLength, getSide, getAlignment, evaluate, getPaddingObject, rectToClientRect, min, clamp, placements, getAlignmentSides, getOppositeAlignmentPlacement, getOppositePlacement, getExpandedPlacements, getOppositeAxisPlacements, sides, max, getOppositeAxis } from '@floating-ui/utils';\nexport { rectToClientRect } from '@floating-ui/utils';\n\nfunction computeCoordsFromPlacement(_ref, placement, rtl) {\n  let {\n    reference,\n    floating\n  } = _ref;\n  const sideAxis = getSideAxis(placement);\n  const alignmentAxis = getAlignmentAxis(placement);\n  const alignLength = getAxisLength(alignmentAxis);\n  const side = getSide(placement);\n  const isVertical = sideAxis === 'y';\n  const commonX = reference.x + reference.width / 2 - floating.width / 2;\n  const commonY = reference.y + reference.height / 2 - floating.height / 2;\n  const commonAlign = reference[alignLength] / 2 - floating[alignLength] / 2;\n  let coords;\n  switch (side) {\n    case 'top':\n      coords = {\n        x: commonX,\n        y: reference.y - floating.height\n      };\n      break;\n    case 'bottom':\n      coords = {\n        x: commonX,\n        y: reference.y + reference.height\n      };\n      break;\n    case 'right':\n      coords = {\n        x: reference.x + reference.width,\n        y: commonY\n      };\n      break;\n    case 'left':\n      coords = {\n        x: reference.x - floating.width,\n        y: commonY\n      };\n      break;\n    default:\n      coords = {\n        x: reference.x,\n        y: reference.y\n      };\n  }\n  switch (getAlignment(placement)) {\n    case 'start':\n      coords[alignmentAxis] -= commonAlign * (rtl && isVertical ? -1 : 1);\n      break;\n    case 'end':\n      coords[alignmentAxis] += commonAlign * (rtl && isVertical ? -1 : 1);\n      break;\n  }\n  return coords;\n}\n\n/**\n * Computes the `x` and `y` coordinates that will place the floating element\n * next to a given reference element.\n *\n * This export does not have any `platform` interface logic. You will need to\n * write one for the platform you are using Floating UI with.\n */\nconst computePosition = async (reference, floating, config) => {\n  const {\n    placement = 'bottom',\n    strategy = 'absolute',\n    middleware = [],\n    platform\n  } = config;\n  const validMiddleware = middleware.filter(Boolean);\n  const rtl = await (platform.isRTL == null ? void 0 : platform.isRTL(floating));\n  let rects = await platform.getElementRects({\n    reference,\n    floating,\n    strategy\n  });\n  let {\n    x,\n    y\n  } = computeCoordsFromPlacement(rects, placement, rtl);\n  let statefulPlacement = placement;\n  let middlewareData = {};\n  let resetCount = 0;\n  for (let i = 0; i < validMiddleware.length; i++) {\n    const {\n      name,\n      fn\n    } = validMiddleware[i];\n    const {\n      x: nextX,\n      y: nextY,\n      data,\n      reset\n    } = await fn({\n      x,\n      y,\n      initialPlacement: placement,\n      placement: statefulPlacement,\n      strategy,\n      middlewareData,\n      rects,\n      platform,\n      elements: {\n        reference,\n        floating\n      }\n    });\n    x = nextX != null ? nextX : x;\n    y = nextY != null ? nextY : y;\n    middlewareData = {\n      ...middlewareData,\n      [name]: {\n        ...middlewareData[name],\n        ...data\n      }\n    };\n    if (reset && resetCount <= 50) {\n      resetCount++;\n      if (typeof reset === 'object') {\n        if (reset.placement) {\n          statefulPlacement = reset.placement;\n        }\n        if (reset.rects) {\n          rects = reset.rects === true ? await platform.getElementRects({\n            reference,\n            floating,\n            strategy\n          }) : reset.rects;\n        }\n        ({\n          x,\n          y\n        } = computeCoordsFromPlacement(rects, statefulPlacement, rtl));\n      }\n      i = -1;\n    }\n  }\n  return {\n    x,\n    y,\n    placement: statefulPlacement,\n    strategy,\n    middlewareData\n  };\n};\n\n/**\n * Resolves with an object of overflow side offsets that determine how much the\n * element is overflowing a given clipping boundary on each side.\n * - positive = overflowing the boundary by that number of pixels\n * - negative = how many pixels left before it will overflow\n * - 0 = lies flush with the boundary\n * @see https://floating-ui.com/docs/detectOverflow\n */\nasync function detectOverflow(state, options) {\n  var _await$platform$isEle;\n  if (options === void 0) {\n    options = {};\n  }\n  const {\n    x,\n    y,\n    platform,\n    rects,\n    elements,\n    strategy\n  } = state;\n  const {\n    boundary = 'clippingAncestors',\n    rootBoundary = 'viewport',\n    elementContext = 'floating',\n    altBoundary = false,\n    padding = 0\n  } = evaluate(options, state);\n  const paddingObject = getPaddingObject(padding);\n  const altContext = elementContext === 'floating' ? 'reference' : 'floating';\n  const element = elements[altBoundary ? altContext : elementContext];\n  const clippingClientRect = rectToClientRect(await platform.getClippingRect({\n    element: ((_await$platform$isEle = await (platform.isElement == null ? void 0 : platform.isElement(element))) != null ? _await$platform$isEle : true) ? element : element.contextElement || (await (platform.getDocumentElement == null ? void 0 : platform.getDocumentElement(elements.floating))),\n    boundary,\n    rootBoundary,\n    strategy\n  }));\n  const rect = elementContext === 'floating' ? {\n    x,\n    y,\n    width: rects.floating.width,\n    height: rects.floating.height\n  } : rects.reference;\n  const offsetParent = await (platform.getOffsetParent == null ? void 0 : platform.getOffsetParent(elements.floating));\n  const offsetScale = (await (platform.isElement == null ? void 0 : platform.isElement(offsetParent))) ? (await (platform.getScale == null ? void 0 : platform.getScale(offsetParent))) || {\n    x: 1,\n    y: 1\n  } : {\n    x: 1,\n    y: 1\n  };\n  const elementClientRect = rectToClientRect(platform.convertOffsetParentRelativeRectToViewportRelativeRect ? await platform.convertOffsetParentRelativeRectToViewportRelativeRect({\n    elements,\n    rect,\n    offsetParent,\n    strategy\n  }) : rect);\n  return {\n    top: (clippingClientRect.top - elementClientRect.top + paddingObject.top) / offsetScale.y,\n    bottom: (elementClientRect.bottom - clippingClientRect.bottom + paddingObject.bottom) / offsetScale.y,\n    left: (clippingClientRect.left - elementClientRect.left + paddingObject.left) / offsetScale.x,\n    right: (elementClientRect.right - clippingClientRect.right + paddingObject.right) / offsetScale.x\n  };\n}\n\n/**\n * Provides data to position an inner element of the floating element so that it\n * appears centered to the reference element.\n * @see https://floating-ui.com/docs/arrow\n */\nconst arrow = options => ({\n  name: 'arrow',\n  options,\n  async fn(state) {\n    const {\n      x,\n      y,\n      placement,\n      rects,\n      platform,\n      elements,\n      middlewareData\n    } = state;\n    // Since `element` is required, we don't Partial<> the type.\n    const {\n      element,\n      padding = 0\n    } = evaluate(options, state) || {};\n    if (element == null) {\n      return {};\n    }\n    const paddingObject = getPaddingObject(padding);\n    const coords = {\n      x,\n      y\n    };\n    const axis = getAlignmentAxis(placement);\n    const length = getAxisLength(axis);\n    const arrowDimensions = await platform.getDimensions(element);\n    const isYAxis = axis === 'y';\n    const minProp = isYAxis ? 'top' : 'left';\n    const maxProp = isYAxis ? 'bottom' : 'right';\n    const clientProp = isYAxis ? 'clientHeight' : 'clientWidth';\n    const endDiff = rects.reference[length] + rects.reference[axis] - coords[axis] - rects.floating[length];\n    const startDiff = coords[axis] - rects.reference[axis];\n    const arrowOffsetParent = await (platform.getOffsetParent == null ? void 0 : platform.getOffsetParent(element));\n    let clientSize = arrowOffsetParent ? arrowOffsetParent[clientProp] : 0;\n\n    // DOM platform can return `window` as the `offsetParent`.\n    if (!clientSize || !(await (platform.isElement == null ? void 0 : platform.isElement(arrowOffsetParent)))) {\n      clientSize = elements.floating[clientProp] || rects.floating[length];\n    }\n    const centerToReference = endDiff / 2 - startDiff / 2;\n\n    // If the padding is large enough that it causes the arrow to no longer be\n    // centered, modify the padding so that it is centered.\n    const largestPossiblePadding = clientSize / 2 - arrowDimensions[length] / 2 - 1;\n    const minPadding = min(paddingObject[minProp], largestPossiblePadding);\n    const maxPadding = min(paddingObject[maxProp], largestPossiblePadding);\n\n    // Make sure the arrow doesn't overflow the floating element if the center\n    // point is outside the floating element's bounds.\n    const min$1 = minPadding;\n    const max = clientSize - arrowDimensions[length] - maxPadding;\n    const center = clientSize / 2 - arrowDimensions[length] / 2 + centerToReference;\n    const offset = clamp(min$1, center, max);\n\n    // If the reference is small enough that the arrow's padding causes it to\n    // to point to nothing for an aligned placement, adjust the offset of the\n    // floating element itself. To ensure `shift()` continues to take action,\n    // a single reset is performed when this is true.\n    const shouldAddOffset = !middlewareData.arrow && getAlignment(placement) != null && center !== offset && rects.reference[length] / 2 - (center < min$1 ? minPadding : maxPadding) - arrowDimensions[length] / 2 < 0;\n    const alignmentOffset = shouldAddOffset ? center < min$1 ? center - min$1 : center - max : 0;\n    return {\n      [axis]: coords[axis] + alignmentOffset,\n      data: {\n        [axis]: offset,\n        centerOffset: center - offset - alignmentOffset,\n        ...(shouldAddOffset && {\n          alignmentOffset\n        })\n      },\n      reset: shouldAddOffset\n    };\n  }\n});\n\nfunction getPlacementList(alignment, autoAlignment, allowedPlacements) {\n  const allowedPlacementsSortedByAlignment = alignment ? [...allowedPlacements.filter(placement => getAlignment(placement) === alignment), ...allowedPlacements.filter(placement => getAlignment(placement) !== alignment)] : allowedPlacements.filter(placement => getSide(placement) === placement);\n  return allowedPlacementsSortedByAlignment.filter(placement => {\n    if (alignment) {\n      return getAlignment(placement) === alignment || (autoAlignment ? getOppositeAlignmentPlacement(placement) !== placement : false);\n    }\n    return true;\n  });\n}\n/**\n * Optimizes the visibility of the floating element by choosing the placement\n * that has the most space available automatically, without needing to specify a\n * preferred placement. Alternative to `flip`.\n * @see https://floating-ui.com/docs/autoPlacement\n */\nconst autoPlacement = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'autoPlacement',\n    options,\n    async fn(state) {\n      var _middlewareData$autoP, _middlewareData$autoP2, _placementsThatFitOnE;\n      const {\n        rects,\n        middlewareData,\n        placement,\n        platform,\n        elements\n      } = state;\n      const {\n        crossAxis = false,\n        alignment,\n        allowedPlacements = placements,\n        autoAlignment = true,\n        ...detectOverflowOptions\n      } = evaluate(options, state);\n      const placements$1 = alignment !== undefined || allowedPlacements === placements ? getPlacementList(alignment || null, autoAlignment, allowedPlacements) : allowedPlacements;\n      const overflow = await detectOverflow(state, detectOverflowOptions);\n      const currentIndex = ((_middlewareData$autoP = middlewareData.autoPlacement) == null ? void 0 : _middlewareData$autoP.index) || 0;\n      const currentPlacement = placements$1[currentIndex];\n      if (currentPlacement == null) {\n        return {};\n      }\n      const alignmentSides = getAlignmentSides(currentPlacement, rects, await (platform.isRTL == null ? void 0 : platform.isRTL(elements.floating)));\n\n      // Make `computeCoords` start from the right place.\n      if (placement !== currentPlacement) {\n        return {\n          reset: {\n            placement: placements$1[0]\n          }\n        };\n      }\n      const currentOverflows = [overflow[getSide(currentPlacement)], overflow[alignmentSides[0]], overflow[alignmentSides[1]]];\n      const allOverflows = [...(((_middlewareData$autoP2 = middlewareData.autoPlacement) == null ? void 0 : _middlewareData$autoP2.overflows) || []), {\n        placement: currentPlacement,\n        overflows: currentOverflows\n      }];\n      const nextPlacement = placements$1[currentIndex + 1];\n\n      // There are more placements to check.\n      if (nextPlacement) {\n        return {\n          data: {\n            index: currentIndex + 1,\n            overflows: allOverflows\n          },\n          reset: {\n            placement: nextPlacement\n          }\n        };\n      }\n      const placementsSortedByMostSpace = allOverflows.map(d => {\n        const alignment = getAlignment(d.placement);\n        return [d.placement, alignment && crossAxis ?\n        // Check along the mainAxis and main crossAxis side.\n        d.overflows.slice(0, 2).reduce((acc, v) => acc + v, 0) :\n        // Check only the mainAxis.\n        d.overflows[0], d.overflows];\n      }).sort((a, b) => a[1] - b[1]);\n      const placementsThatFitOnEachSide = placementsSortedByMostSpace.filter(d => d[2].slice(0,\n      // Aligned placements should not check their opposite crossAxis\n      // side.\n      getAlignment(d[0]) ? 2 : 3).every(v => v <= 0));\n      const resetPlacement = ((_placementsThatFitOnE = placementsThatFitOnEachSide[0]) == null ? void 0 : _placementsThatFitOnE[0]) || placementsSortedByMostSpace[0][0];\n      if (resetPlacement !== placement) {\n        return {\n          data: {\n            index: currentIndex + 1,\n            overflows: allOverflows\n          },\n          reset: {\n            placement: resetPlacement\n          }\n        };\n      }\n      return {};\n    }\n  };\n};\n\n/**\n * Optimizes the visibility of the floating element by flipping the `placement`\n * in order to keep it in view when the preferred placement(s) will overflow the\n * clipping boundary. Alternative to `autoPlacement`.\n * @see https://floating-ui.com/docs/flip\n */\nconst flip = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'flip',\n    options,\n    async fn(state) {\n      var _middlewareData$arrow, _middlewareData$flip;\n      const {\n        placement,\n        middlewareData,\n        rects,\n        initialPlacement,\n        platform,\n        elements\n      } = state;\n      const {\n        mainAxis: checkMainAxis = true,\n        crossAxis: checkCrossAxis = true,\n        fallbackPlacements: specifiedFallbackPlacements,\n        fallbackStrategy = 'bestFit',\n        fallbackAxisSideDirection = 'none',\n        flipAlignment = true,\n        ...detectOverflowOptions\n      } = evaluate(options, state);\n\n      // If a reset by the arrow was caused due to an alignment offset being\n      // added, we should skip any logic now since `flip()` has already done its\n      // work.\n      // https://github.com/floating-ui/floating-ui/issues/2549#issuecomment-1719601643\n      if ((_middlewareData$arrow = middlewareData.arrow) != null && _middlewareData$arrow.alignmentOffset) {\n        return {};\n      }\n      const side = getSide(placement);\n      const initialSideAxis = getSideAxis(initialPlacement);\n      const isBasePlacement = getSide(initialPlacement) === initialPlacement;\n      const rtl = await (platform.isRTL == null ? void 0 : platform.isRTL(elements.floating));\n      const fallbackPlacements = specifiedFallbackPlacements || (isBasePlacement || !flipAlignment ? [getOppositePlacement(initialPlacement)] : getExpandedPlacements(initialPlacement));\n      const hasFallbackAxisSideDirection = fallbackAxisSideDirection !== 'none';\n      if (!specifiedFallbackPlacements && hasFallbackAxisSideDirection) {\n        fallbackPlacements.push(...getOppositeAxisPlacements(initialPlacement, flipAlignment, fallbackAxisSideDirection, rtl));\n      }\n      const placements = [initialPlacement, ...fallbackPlacements];\n      const overflow = await detectOverflow(state, detectOverflowOptions);\n      const overflows = [];\n      let overflowsData = ((_middlewareData$flip = middlewareData.flip) == null ? void 0 : _middlewareData$flip.overflows) || [];\n      if (checkMainAxis) {\n        overflows.push(overflow[side]);\n      }\n      if (checkCrossAxis) {\n        const sides = getAlignmentSides(placement, rects, rtl);\n        overflows.push(overflow[sides[0]], overflow[sides[1]]);\n      }\n      overflowsData = [...overflowsData, {\n        placement,\n        overflows\n      }];\n\n      // One or more sides is overflowing.\n      if (!overflows.every(side => side <= 0)) {\n        var _middlewareData$flip2, _overflowsData$filter;\n        const nextIndex = (((_middlewareData$flip2 = middlewareData.flip) == null ? void 0 : _middlewareData$flip2.index) || 0) + 1;\n        const nextPlacement = placements[nextIndex];\n        if (nextPlacement) {\n          // Try next placement and re-run the lifecycle.\n          return {\n            data: {\n              index: nextIndex,\n              overflows: overflowsData\n            },\n            reset: {\n              placement: nextPlacement\n            }\n          };\n        }\n\n        // First, find the candidates that fit on the mainAxis side of overflow,\n        // then find the placement that fits the best on the main crossAxis side.\n        let resetPlacement = (_overflowsData$filter = overflowsData.filter(d => d.overflows[0] <= 0).sort((a, b) => a.overflows[1] - b.overflows[1])[0]) == null ? void 0 : _overflowsData$filter.placement;\n\n        // Otherwise fallback.\n        if (!resetPlacement) {\n          switch (fallbackStrategy) {\n            case 'bestFit':\n              {\n                var _overflowsData$filter2;\n                const placement = (_overflowsData$filter2 = overflowsData.filter(d => {\n                  if (hasFallbackAxisSideDirection) {\n                    const currentSideAxis = getSideAxis(d.placement);\n                    return currentSideAxis === initialSideAxis ||\n                    // Create a bias to the `y` side axis due to horizontal\n                    // reading directions favoring greater width.\n                    currentSideAxis === 'y';\n                  }\n                  return true;\n                }).map(d => [d.placement, d.overflows.filter(overflow => overflow > 0).reduce((acc, overflow) => acc + overflow, 0)]).sort((a, b) => a[1] - b[1])[0]) == null ? void 0 : _overflowsData$filter2[0];\n                if (placement) {\n                  resetPlacement = placement;\n                }\n                break;\n              }\n            case 'initialPlacement':\n              resetPlacement = initialPlacement;\n              break;\n          }\n        }\n        if (placement !== resetPlacement) {\n          return {\n            reset: {\n              placement: resetPlacement\n            }\n          };\n        }\n      }\n      return {};\n    }\n  };\n};\n\nfunction getSideOffsets(overflow, rect) {\n  return {\n    top: overflow.top - rect.height,\n    right: overflow.right - rect.width,\n    bottom: overflow.bottom - rect.height,\n    left: overflow.left - rect.width\n  };\n}\nfunction isAnySideFullyClipped(overflow) {\n  return sides.some(side => overflow[side] >= 0);\n}\n/**\n * Provides data to hide the floating element in applicable situations, such as\n * when it is not in the same clipping context as the reference element.\n * @see https://floating-ui.com/docs/hide\n */\nconst hide = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'hide',\n    options,\n    async fn(state) {\n      const {\n        rects\n      } = state;\n      const {\n        strategy = 'referenceHidden',\n        ...detectOverflowOptions\n      } = evaluate(options, state);\n      switch (strategy) {\n        case 'referenceHidden':\n          {\n            const overflow = await detectOverflow(state, {\n              ...detectOverflowOptions,\n              elementContext: 'reference'\n            });\n            const offsets = getSideOffsets(overflow, rects.reference);\n            return {\n              data: {\n                referenceHiddenOffsets: offsets,\n                referenceHidden: isAnySideFullyClipped(offsets)\n              }\n            };\n          }\n        case 'escaped':\n          {\n            const overflow = await detectOverflow(state, {\n              ...detectOverflowOptions,\n              altBoundary: true\n            });\n            const offsets = getSideOffsets(overflow, rects.floating);\n            return {\n              data: {\n                escapedOffsets: offsets,\n                escaped: isAnySideFullyClipped(offsets)\n              }\n            };\n          }\n        default:\n          {\n            return {};\n          }\n      }\n    }\n  };\n};\n\nfunction getBoundingRect(rects) {\n  const minX = min(...rects.map(rect => rect.left));\n  const minY = min(...rects.map(rect => rect.top));\n  const maxX = max(...rects.map(rect => rect.right));\n  const maxY = max(...rects.map(rect => rect.bottom));\n  return {\n    x: minX,\n    y: minY,\n    width: maxX - minX,\n    height: maxY - minY\n  };\n}\nfunction getRectsByLine(rects) {\n  const sortedRects = rects.slice().sort((a, b) => a.y - b.y);\n  const groups = [];\n  let prevRect = null;\n  for (let i = 0; i < sortedRects.length; i++) {\n    const rect = sortedRects[i];\n    if (!prevRect || rect.y - prevRect.y > prevRect.height / 2) {\n      groups.push([rect]);\n    } else {\n      groups[groups.length - 1].push(rect);\n    }\n    prevRect = rect;\n  }\n  return groups.map(rect => rectToClientRect(getBoundingRect(rect)));\n}\n/**\n * Provides improved positioning for inline reference elements that can span\n * over multiple lines, such as hyperlinks or range selections.\n * @see https://floating-ui.com/docs/inline\n */\nconst inline = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'inline',\n    options,\n    async fn(state) {\n      const {\n        placement,\n        elements,\n        rects,\n        platform,\n        strategy\n      } = state;\n      // A MouseEvent's client{X,Y} coords can be up to 2 pixels off a\n      // ClientRect's bounds, despite the event listener being triggered. A\n      // padding of 2 seems to handle this issue.\n      const {\n        padding = 2,\n        x,\n        y\n      } = evaluate(options, state);\n      const nativeClientRects = Array.from((await (platform.getClientRects == null ? void 0 : platform.getClientRects(elements.reference))) || []);\n      const clientRects = getRectsByLine(nativeClientRects);\n      const fallback = rectToClientRect(getBoundingRect(nativeClientRects));\n      const paddingObject = getPaddingObject(padding);\n      function getBoundingClientRect() {\n        // There are two rects and they are disjoined.\n        if (clientRects.length === 2 && clientRects[0].left > clientRects[1].right && x != null && y != null) {\n          // Find the first rect in which the point is fully inside.\n          return clientRects.find(rect => x > rect.left - paddingObject.left && x < rect.right + paddingObject.right && y > rect.top - paddingObject.top && y < rect.bottom + paddingObject.bottom) || fallback;\n        }\n\n        // There are 2 or more connected rects.\n        if (clientRects.length >= 2) {\n          if (getSideAxis(placement) === 'y') {\n            const firstRect = clientRects[0];\n            const lastRect = clientRects[clientRects.length - 1];\n            const isTop = getSide(placement) === 'top';\n            const top = firstRect.top;\n            const bottom = lastRect.bottom;\n            const left = isTop ? firstRect.left : lastRect.left;\n            const right = isTop ? firstRect.right : lastRect.right;\n            const width = right - left;\n            const height = bottom - top;\n            return {\n              top,\n              bottom,\n              left,\n              right,\n              width,\n              height,\n              x: left,\n              y: top\n            };\n          }\n          const isLeftSide = getSide(placement) === 'left';\n          const maxRight = max(...clientRects.map(rect => rect.right));\n          const minLeft = min(...clientRects.map(rect => rect.left));\n          const measureRects = clientRects.filter(rect => isLeftSide ? rect.left === minLeft : rect.right === maxRight);\n          const top = measureRects[0].top;\n          const bottom = measureRects[measureRects.length - 1].bottom;\n          const left = minLeft;\n          const right = maxRight;\n          const width = right - left;\n          const height = bottom - top;\n          return {\n            top,\n            bottom,\n            left,\n            right,\n            width,\n            height,\n            x: left,\n            y: top\n          };\n        }\n        return fallback;\n      }\n      const resetRects = await platform.getElementRects({\n        reference: {\n          getBoundingClientRect\n        },\n        floating: elements.floating,\n        strategy\n      });\n      if (rects.reference.x !== resetRects.reference.x || rects.reference.y !== resetRects.reference.y || rects.reference.width !== resetRects.reference.width || rects.reference.height !== resetRects.reference.height) {\n        return {\n          reset: {\n            rects: resetRects\n          }\n        };\n      }\n      return {};\n    }\n  };\n};\n\n// For type backwards-compatibility, the `OffsetOptions` type was also\n// Derivable.\n\nasync function convertValueToCoords(state, options) {\n  const {\n    placement,\n    platform,\n    elements\n  } = state;\n  const rtl = await (platform.isRTL == null ? void 0 : platform.isRTL(elements.floating));\n  const side = getSide(placement);\n  const alignment = getAlignment(placement);\n  const isVertical = getSideAxis(placement) === 'y';\n  const mainAxisMulti = ['left', 'top'].includes(side) ? -1 : 1;\n  const crossAxisMulti = rtl && isVertical ? -1 : 1;\n  const rawValue = evaluate(options, state);\n\n  // eslint-disable-next-line prefer-const\n  let {\n    mainAxis,\n    crossAxis,\n    alignmentAxis\n  } = typeof rawValue === 'number' ? {\n    mainAxis: rawValue,\n    crossAxis: 0,\n    alignmentAxis: null\n  } : {\n    mainAxis: rawValue.mainAxis || 0,\n    crossAxis: rawValue.crossAxis || 0,\n    alignmentAxis: rawValue.alignmentAxis\n  };\n  if (alignment && typeof alignmentAxis === 'number') {\n    crossAxis = alignment === 'end' ? alignmentAxis * -1 : alignmentAxis;\n  }\n  return isVertical ? {\n    x: crossAxis * crossAxisMulti,\n    y: mainAxis * mainAxisMulti\n  } : {\n    x: mainAxis * mainAxisMulti,\n    y: crossAxis * crossAxisMulti\n  };\n}\n\n/**\n * Modifies the placement by translating the floating element along the\n * specified axes.\n * A number (shorthand for `mainAxis` or distance), or an axes configuration\n * object may be passed.\n * @see https://floating-ui.com/docs/offset\n */\nconst offset = function (options) {\n  if (options === void 0) {\n    options = 0;\n  }\n  return {\n    name: 'offset',\n    options,\n    async fn(state) {\n      var _middlewareData$offse, _middlewareData$arrow;\n      const {\n        x,\n        y,\n        placement,\n        middlewareData\n      } = state;\n      const diffCoords = await convertValueToCoords(state, options);\n\n      // If the placement is the same and the arrow caused an alignment offset\n      // then we don't need to change the positioning coordinates.\n      if (placement === ((_middlewareData$offse = middlewareData.offset) == null ? void 0 : _middlewareData$offse.placement) && (_middlewareData$arrow = middlewareData.arrow) != null && _middlewareData$arrow.alignmentOffset) {\n        return {};\n      }\n      return {\n        x: x + diffCoords.x,\n        y: y + diffCoords.y,\n        data: {\n          ...diffCoords,\n          placement\n        }\n      };\n    }\n  };\n};\n\n/**\n * Optimizes the visibility of the floating element by shifting it in order to\n * keep it in view when it will overflow the clipping boundary.\n * @see https://floating-ui.com/docs/shift\n */\nconst shift = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'shift',\n    options,\n    async fn(state) {\n      const {\n        x,\n        y,\n        placement\n      } = state;\n      const {\n        mainAxis: checkMainAxis = true,\n        crossAxis: checkCrossAxis = false,\n        limiter = {\n          fn: _ref => {\n            let {\n              x,\n              y\n            } = _ref;\n            return {\n              x,\n              y\n            };\n          }\n        },\n        ...detectOverflowOptions\n      } = evaluate(options, state);\n      const coords = {\n        x,\n        y\n      };\n      const overflow = await detectOverflow(state, detectOverflowOptions);\n      const crossAxis = getSideAxis(getSide(placement));\n      const mainAxis = getOppositeAxis(crossAxis);\n      let mainAxisCoord = coords[mainAxis];\n      let crossAxisCoord = coords[crossAxis];\n      if (checkMainAxis) {\n        const minSide = mainAxis === 'y' ? 'top' : 'left';\n        const maxSide = mainAxis === 'y' ? 'bottom' : 'right';\n        const min = mainAxisCoord + overflow[minSide];\n        const max = mainAxisCoord - overflow[maxSide];\n        mainAxisCoord = clamp(min, mainAxisCoord, max);\n      }\n      if (checkCrossAxis) {\n        const minSide = crossAxis === 'y' ? 'top' : 'left';\n        const maxSide = crossAxis === 'y' ? 'bottom' : 'right';\n        const min = crossAxisCoord + overflow[minSide];\n        const max = crossAxisCoord - overflow[maxSide];\n        crossAxisCoord = clamp(min, crossAxisCoord, max);\n      }\n      const limitedCoords = limiter.fn({\n        ...state,\n        [mainAxis]: mainAxisCoord,\n        [crossAxis]: crossAxisCoord\n      });\n      return {\n        ...limitedCoords,\n        data: {\n          x: limitedCoords.x - x,\n          y: limitedCoords.y - y,\n          enabled: {\n            [mainAxis]: checkMainAxis,\n            [crossAxis]: checkCrossAxis\n          }\n        }\n      };\n    }\n  };\n};\n/**\n * Built-in `limiter` that will stop `shift()` at a certain point.\n */\nconst limitShift = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    options,\n    fn(state) {\n      const {\n        x,\n        y,\n        placement,\n        rects,\n        middlewareData\n      } = state;\n      const {\n        offset = 0,\n        mainAxis: checkMainAxis = true,\n        crossAxis: checkCrossAxis = true\n      } = evaluate(options, state);\n      const coords = {\n        x,\n        y\n      };\n      const crossAxis = getSideAxis(placement);\n      const mainAxis = getOppositeAxis(crossAxis);\n      let mainAxisCoord = coords[mainAxis];\n      let crossAxisCoord = coords[crossAxis];\n      const rawOffset = evaluate(offset, state);\n      const computedOffset = typeof rawOffset === 'number' ? {\n        mainAxis: rawOffset,\n        crossAxis: 0\n      } : {\n        mainAxis: 0,\n        crossAxis: 0,\n        ...rawOffset\n      };\n      if (checkMainAxis) {\n        const len = mainAxis === 'y' ? 'height' : 'width';\n        const limitMin = rects.reference[mainAxis] - rects.floating[len] + computedOffset.mainAxis;\n        const limitMax = rects.reference[mainAxis] + rects.reference[len] - computedOffset.mainAxis;\n        if (mainAxisCoord < limitMin) {\n          mainAxisCoord = limitMin;\n        } else if (mainAxisCoord > limitMax) {\n          mainAxisCoord = limitMax;\n        }\n      }\n      if (checkCrossAxis) {\n        var _middlewareData$offse, _middlewareData$offse2;\n        const len = mainAxis === 'y' ? 'width' : 'height';\n        const isOriginSide = ['top', 'left'].includes(getSide(placement));\n        const limitMin = rects.reference[crossAxis] - rects.floating[len] + (isOriginSide ? ((_middlewareData$offse = middlewareData.offset) == null ? void 0 : _middlewareData$offse[crossAxis]) || 0 : 0) + (isOriginSide ? 0 : computedOffset.crossAxis);\n        const limitMax = rects.reference[crossAxis] + rects.reference[len] + (isOriginSide ? 0 : ((_middlewareData$offse2 = middlewareData.offset) == null ? void 0 : _middlewareData$offse2[crossAxis]) || 0) - (isOriginSide ? computedOffset.crossAxis : 0);\n        if (crossAxisCoord < limitMin) {\n          crossAxisCoord = limitMin;\n        } else if (crossAxisCoord > limitMax) {\n          crossAxisCoord = limitMax;\n        }\n      }\n      return {\n        [mainAxis]: mainAxisCoord,\n        [crossAxis]: crossAxisCoord\n      };\n    }\n  };\n};\n\n/**\n * Provides data that allows you to change the size of the floating element —\n * for instance, prevent it from overflowing the clipping boundary or match the\n * width of the reference element.\n * @see https://floating-ui.com/docs/size\n */\nconst size = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return {\n    name: 'size',\n    options,\n    async fn(state) {\n      var _state$middlewareData, _state$middlewareData2;\n      const {\n        placement,\n        rects,\n        platform,\n        elements\n      } = state;\n      const {\n        apply = () => {},\n        ...detectOverflowOptions\n      } = evaluate(options, state);\n      const overflow = await detectOverflow(state, detectOverflowOptions);\n      const side = getSide(placement);\n      const alignment = getAlignment(placement);\n      const isYAxis = getSideAxis(placement) === 'y';\n      const {\n        width,\n        height\n      } = rects.floating;\n      let heightSide;\n      let widthSide;\n      if (side === 'top' || side === 'bottom') {\n        heightSide = side;\n        widthSide = alignment === ((await (platform.isRTL == null ? void 0 : platform.isRTL(elements.floating))) ? 'start' : 'end') ? 'left' : 'right';\n      } else {\n        widthSide = side;\n        heightSide = alignment === 'end' ? 'top' : 'bottom';\n      }\n      const maximumClippingHeight = height - overflow.top - overflow.bottom;\n      const maximumClippingWidth = width - overflow.left - overflow.right;\n      const overflowAvailableHeight = min(height - overflow[heightSide], maximumClippingHeight);\n      const overflowAvailableWidth = min(width - overflow[widthSide], maximumClippingWidth);\n      const noShift = !state.middlewareData.shift;\n      let availableHeight = overflowAvailableHeight;\n      let availableWidth = overflowAvailableWidth;\n      if ((_state$middlewareData = state.middlewareData.shift) != null && _state$middlewareData.enabled.x) {\n        availableWidth = maximumClippingWidth;\n      }\n      if ((_state$middlewareData2 = state.middlewareData.shift) != null && _state$middlewareData2.enabled.y) {\n        availableHeight = maximumClippingHeight;\n      }\n      if (noShift && !alignment) {\n        const xMin = max(overflow.left, 0);\n        const xMax = max(overflow.right, 0);\n        const yMin = max(overflow.top, 0);\n        const yMax = max(overflow.bottom, 0);\n        if (isYAxis) {\n          availableWidth = width - 2 * (xMin !== 0 || xMax !== 0 ? xMin + xMax : max(overflow.left, overflow.right));\n        } else {\n          availableHeight = height - 2 * (yMin !== 0 || yMax !== 0 ? yMin + yMax : max(overflow.top, overflow.bottom));\n        }\n      }\n      await apply({\n        ...state,\n        availableWidth,\n        availableHeight\n      });\n      const nextDimensions = await platform.getDimensions(elements.floating);\n      if (width !== nextDimensions.width || height !== nextDimensions.height) {\n        return {\n          reset: {\n            rects: true\n          }\n        };\n      }\n      return {};\n    }\n  };\n};\n\nexport { arrow, autoPlacement, computePosition, detectOverflow, flip, hide, inline, limitShift, offset, shift, size };\n", "function hasWindow() {\n  return typeof window !== 'undefined';\n}\nfunction getNodeName(node) {\n  if (isNode(node)) {\n    return (node.nodeName || '').toLowerCase();\n  }\n  // Mocked nodes in testing environments may not be instances of Node. By\n  // returning `#document` an infinite loop won't occur.\n  // https://github.com/floating-ui/floating-ui/issues/2317\n  return '#document';\n}\nfunction getWindow(node) {\n  var _node$ownerDocument;\n  return (node == null || (_node$ownerDocument = node.ownerDocument) == null ? void 0 : _node$ownerDocument.defaultView) || window;\n}\nfunction getDocumentElement(node) {\n  var _ref;\n  return (_ref = (isNode(node) ? node.ownerDocument : node.document) || window.document) == null ? void 0 : _ref.documentElement;\n}\nfunction isNode(value) {\n  if (!hasWindow()) {\n    return false;\n  }\n  return value instanceof Node || value instanceof getWindow(value).Node;\n}\nfunction isElement(value) {\n  if (!hasWindow()) {\n    return false;\n  }\n  return value instanceof Element || value instanceof getWindow(value).Element;\n}\nfunction isHTMLElement(value) {\n  if (!hasWindow()) {\n    return false;\n  }\n  return value instanceof HTMLElement || value instanceof getWindow(value).HTMLElement;\n}\nfunction isShadowRoot(value) {\n  if (!hasWindow() || typeof ShadowRoot === 'undefined') {\n    return false;\n  }\n  return value instanceof ShadowRoot || value instanceof getWindow(value).ShadowRoot;\n}\nfunction isOverflowElement(element) {\n  const {\n    overflow,\n    overflowX,\n    overflowY,\n    display\n  } = getComputedStyle(element);\n  return /auto|scroll|overlay|hidden|clip/.test(overflow + overflowY + overflowX) && !['inline', 'contents'].includes(display);\n}\nfunction isTableElement(element) {\n  return ['table', 'td', 'th'].includes(getNodeName(element));\n}\nfunction isTopLayer(element) {\n  return [':popover-open', ':modal'].some(selector => {\n    try {\n      return element.matches(selector);\n    } catch (e) {\n      return false;\n    }\n  });\n}\nfunction isContainingBlock(elementOrCss) {\n  const webkit = isWebKit();\n  const css = isElement(elementOrCss) ? getComputedStyle(elementOrCss) : elementOrCss;\n\n  // https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block\n  // https://drafts.csswg.org/css-transforms-2/#individual-transforms\n  return ['transform', 'translate', 'scale', 'rotate', 'perspective'].some(value => css[value] ? css[value] !== 'none' : false) || (css.containerType ? css.containerType !== 'normal' : false) || !webkit && (css.backdropFilter ? css.backdropFilter !== 'none' : false) || !webkit && (css.filter ? css.filter !== 'none' : false) || ['transform', 'translate', 'scale', 'rotate', 'perspective', 'filter'].some(value => (css.willChange || '').includes(value)) || ['paint', 'layout', 'strict', 'content'].some(value => (css.contain || '').includes(value));\n}\nfunction getContainingBlock(element) {\n  let currentNode = getParentNode(element);\n  while (isHTMLElement(currentNode) && !isLastTraversableNode(currentNode)) {\n    if (isContainingBlock(currentNode)) {\n      return currentNode;\n    } else if (isTopLayer(currentNode)) {\n      return null;\n    }\n    currentNode = getParentNode(currentNode);\n  }\n  return null;\n}\nfunction isWebKit() {\n  if (typeof CSS === 'undefined' || !CSS.supports) return false;\n  return CSS.supports('-webkit-backdrop-filter', 'none');\n}\nfunction isLastTraversableNode(node) {\n  return ['html', 'body', '#document'].includes(getNodeName(node));\n}\nfunction getComputedStyle(element) {\n  return getWindow(element).getComputedStyle(element);\n}\nfunction getNodeScroll(element) {\n  if (isElement(element)) {\n    return {\n      scrollLeft: element.scrollLeft,\n      scrollTop: element.scrollTop\n    };\n  }\n  return {\n    scrollLeft: element.scrollX,\n    scrollTop: element.scrollY\n  };\n}\nfunction getParentNode(node) {\n  if (getNodeName(node) === 'html') {\n    return node;\n  }\n  const result =\n  // Step into the shadow DOM of the parent of a slotted node.\n  node.assignedSlot ||\n  // DOM Element detected.\n  node.parentNode ||\n  // ShadowRoot detected.\n  isShadowRoot(node) && node.host ||\n  // Fallback.\n  getDocumentElement(node);\n  return isShadowRoot(result) ? result.host : result;\n}\nfunction getNearestOverflowAncestor(node) {\n  const parentNode = getParentNode(node);\n  if (isLastTraversableNode(parentNode)) {\n    return node.ownerDocument ? node.ownerDocument.body : node.body;\n  }\n  if (isHTMLElement(parentNode) && isOverflowElement(parentNode)) {\n    return parentNode;\n  }\n  return getNearestOverflowAncestor(parentNode);\n}\nfunction getOverflowAncestors(node, list, traverseIframes) {\n  var _node$ownerDocument2;\n  if (list === void 0) {\n    list = [];\n  }\n  if (traverseIframes === void 0) {\n    traverseIframes = true;\n  }\n  const scrollableAncestor = getNearestOverflowAncestor(node);\n  const isBody = scrollableAncestor === ((_node$ownerDocument2 = node.ownerDocument) == null ? void 0 : _node$ownerDocument2.body);\n  const win = getWindow(scrollableAncestor);\n  if (isBody) {\n    const frameElement = getFrameElement(win);\n    return list.concat(win, win.visualViewport || [], isOverflowElement(scrollableAncestor) ? scrollableAncestor : [], frameElement && traverseIframes ? getOverflowAncestors(frameElement) : []);\n  }\n  return list.concat(scrollableAncestor, getOverflowAncestors(scrollableAncestor, [], traverseIframes));\n}\nfunction getFrameElement(win) {\n  return win.parent && Object.getPrototypeOf(win.parent) ? win.frameElement : null;\n}\n\nexport { getComputedStyle, getContainingBlock, getDocumentElement, getFrameElement, getNearestOverflowAncestor, getNodeName, getNodeScroll, getOverflowAncestors, getParentNode, getWindow, isContainingBlock, isElement, isHTMLElement, isLastTraversableNode, isNode, isOverflowElement, isShadowRoot, isTableElement, isTopLayer, isWebKit };\n", "import { rectToClientRect, detectOverflow as detectOverflow$1, offset as offset$1, autoPlacement as autoPlacement$1, shift as shift$1, flip as flip$1, size as size$1, hide as hide$1, arrow as arrow$1, inline as inline$1, limitShift as limitShift$1, computePosition as computePosition$1 } from '@floating-ui/core';\nimport { round, createCoords, max, min, floor } from '@floating-ui/utils';\nimport { getComputedStyle, isHTMLElement, isElement, getWindow, isWebKit, getFrameElement, getNodeScroll, getDocumentElement, isTopLayer, getNodeName, isOverflowElement, getOverflowAncestors, getParentNode, isLastTraversableNode, isContainingBlock, isTableElement, getContainingBlock } from '@floating-ui/utils/dom';\nexport { getOverflowAncestors } from '@floating-ui/utils/dom';\n\nfunction getCssDimensions(element) {\n  const css = getComputedStyle(element);\n  // In testing environments, the `width` and `height` properties are empty\n  // strings for SVG elements, returning NaN. Fallback to `0` in this case.\n  let width = parseFloat(css.width) || 0;\n  let height = parseFloat(css.height) || 0;\n  const hasOffset = isHTMLElement(element);\n  const offsetWidth = hasOffset ? element.offsetWidth : width;\n  const offsetHeight = hasOffset ? element.offsetHeight : height;\n  const shouldFallback = round(width) !== offsetWidth || round(height) !== offsetHeight;\n  if (shouldFallback) {\n    width = offsetWidth;\n    height = offsetHeight;\n  }\n  return {\n    width,\n    height,\n    $: shouldFallback\n  };\n}\n\nfunction unwrapElement(element) {\n  return !isElement(element) ? element.contextElement : element;\n}\n\nfunction getScale(element) {\n  const domElement = unwrapElement(element);\n  if (!isHTMLElement(domElement)) {\n    return createCoords(1);\n  }\n  const rect = domElement.getBoundingClientRect();\n  const {\n    width,\n    height,\n    $\n  } = getCssDimensions(domElement);\n  let x = ($ ? round(rect.width) : rect.width) / width;\n  let y = ($ ? round(rect.height) : rect.height) / height;\n\n  // 0, NaN, or Infinity should always fallback to 1.\n\n  if (!x || !Number.isFinite(x)) {\n    x = 1;\n  }\n  if (!y || !Number.isFinite(y)) {\n    y = 1;\n  }\n  return {\n    x,\n    y\n  };\n}\n\nconst noOffsets = /*#__PURE__*/createCoords(0);\nfunction getVisualOffsets(element) {\n  const win = getWindow(element);\n  if (!isWebKit() || !win.visualViewport) {\n    return noOffsets;\n  }\n  return {\n    x: win.visualViewport.offsetLeft,\n    y: win.visualViewport.offsetTop\n  };\n}\nfunction shouldAddVisualOffsets(element, isFixed, floatingOffsetParent) {\n  if (isFixed === void 0) {\n    isFixed = false;\n  }\n  if (!floatingOffsetParent || isFixed && floatingOffsetParent !== getWindow(element)) {\n    return false;\n  }\n  return isFixed;\n}\n\nfunction getBoundingClientRect(element, includeScale, isFixedStrategy, offsetParent) {\n  if (includeScale === void 0) {\n    includeScale = false;\n  }\n  if (isFixedStrategy === void 0) {\n    isFixedStrategy = false;\n  }\n  const clientRect = element.getBoundingClientRect();\n  const domElement = unwrapElement(element);\n  let scale = createCoords(1);\n  if (includeScale) {\n    if (offsetParent) {\n      if (isElement(offsetParent)) {\n        scale = getScale(offsetParent);\n      }\n    } else {\n      scale = getScale(element);\n    }\n  }\n  const visualOffsets = shouldAddVisualOffsets(domElement, isFixedStrategy, offsetParent) ? getVisualOffsets(domElement) : createCoords(0);\n  let x = (clientRect.left + visualOffsets.x) / scale.x;\n  let y = (clientRect.top + visualOffsets.y) / scale.y;\n  let width = clientRect.width / scale.x;\n  let height = clientRect.height / scale.y;\n  if (domElement) {\n    const win = getWindow(domElement);\n    const offsetWin = offsetParent && isElement(offsetParent) ? getWindow(offsetParent) : offsetParent;\n    let currentWin = win;\n    let currentIFrame = getFrameElement(currentWin);\n    while (currentIFrame && offsetParent && offsetWin !== currentWin) {\n      const iframeScale = getScale(currentIFrame);\n      const iframeRect = currentIFrame.getBoundingClientRect();\n      const css = getComputedStyle(currentIFrame);\n      const left = iframeRect.left + (currentIFrame.clientLeft + parseFloat(css.paddingLeft)) * iframeScale.x;\n      const top = iframeRect.top + (currentIFrame.clientTop + parseFloat(css.paddingTop)) * iframeScale.y;\n      x *= iframeScale.x;\n      y *= iframeScale.y;\n      width *= iframeScale.x;\n      height *= iframeScale.y;\n      x += left;\n      y += top;\n      currentWin = getWindow(currentIFrame);\n      currentIFrame = getFrameElement(currentWin);\n    }\n  }\n  return rectToClientRect({\n    width,\n    height,\n    x,\n    y\n  });\n}\n\n// If <html> has a CSS width greater than the viewport, then this will be\n// incorrect for RTL.\nfunction getWindowScrollBarX(element, rect) {\n  const leftScroll = getNodeScroll(element).scrollLeft;\n  if (!rect) {\n    return getBoundingClientRect(getDocumentElement(element)).left + leftScroll;\n  }\n  return rect.left + leftScroll;\n}\n\nfunction getHTMLOffset(documentElement, scroll, ignoreScrollbarX) {\n  if (ignoreScrollbarX === void 0) {\n    ignoreScrollbarX = false;\n  }\n  const htmlRect = documentElement.getBoundingClientRect();\n  const x = htmlRect.left + scroll.scrollLeft - (ignoreScrollbarX ? 0 :\n  // RTL <body> scrollbar.\n  getWindowScrollBarX(documentElement, htmlRect));\n  const y = htmlRect.top + scroll.scrollTop;\n  return {\n    x,\n    y\n  };\n}\n\nfunction convertOffsetParentRelativeRectToViewportRelativeRect(_ref) {\n  let {\n    elements,\n    rect,\n    offsetParent,\n    strategy\n  } = _ref;\n  const isFixed = strategy === 'fixed';\n  const documentElement = getDocumentElement(offsetParent);\n  const topLayer = elements ? isTopLayer(elements.floating) : false;\n  if (offsetParent === documentElement || topLayer && isFixed) {\n    return rect;\n  }\n  let scroll = {\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n  let scale = createCoords(1);\n  const offsets = createCoords(0);\n  const isOffsetParentAnElement = isHTMLElement(offsetParent);\n  if (isOffsetParentAnElement || !isOffsetParentAnElement && !isFixed) {\n    if (getNodeName(offsetParent) !== 'body' || isOverflowElement(documentElement)) {\n      scroll = getNodeScroll(offsetParent);\n    }\n    if (isHTMLElement(offsetParent)) {\n      const offsetRect = getBoundingClientRect(offsetParent);\n      scale = getScale(offsetParent);\n      offsets.x = offsetRect.x + offsetParent.clientLeft;\n      offsets.y = offsetRect.y + offsetParent.clientTop;\n    }\n  }\n  const htmlOffset = documentElement && !isOffsetParentAnElement && !isFixed ? getHTMLOffset(documentElement, scroll, true) : createCoords(0);\n  return {\n    width: rect.width * scale.x,\n    height: rect.height * scale.y,\n    x: rect.x * scale.x - scroll.scrollLeft * scale.x + offsets.x + htmlOffset.x,\n    y: rect.y * scale.y - scroll.scrollTop * scale.y + offsets.y + htmlOffset.y\n  };\n}\n\nfunction getClientRects(element) {\n  return Array.from(element.getClientRects());\n}\n\n// Gets the entire size of the scrollable document area, even extending outside\n// of the `<html>` and `<body>` rect bounds if horizontally scrollable.\nfunction getDocumentRect(element) {\n  const html = getDocumentElement(element);\n  const scroll = getNodeScroll(element);\n  const body = element.ownerDocument.body;\n  const width = max(html.scrollWidth, html.clientWidth, body.scrollWidth, body.clientWidth);\n  const height = max(html.scrollHeight, html.clientHeight, body.scrollHeight, body.clientHeight);\n  let x = -scroll.scrollLeft + getWindowScrollBarX(element);\n  const y = -scroll.scrollTop;\n  if (getComputedStyle(body).direction === 'rtl') {\n    x += max(html.clientWidth, body.clientWidth) - width;\n  }\n  return {\n    width,\n    height,\n    x,\n    y\n  };\n}\n\nfunction getViewportRect(element, strategy) {\n  const win = getWindow(element);\n  const html = getDocumentElement(element);\n  const visualViewport = win.visualViewport;\n  let width = html.clientWidth;\n  let height = html.clientHeight;\n  let x = 0;\n  let y = 0;\n  if (visualViewport) {\n    width = visualViewport.width;\n    height = visualViewport.height;\n    const visualViewportBased = isWebKit();\n    if (!visualViewportBased || visualViewportBased && strategy === 'fixed') {\n      x = visualViewport.offsetLeft;\n      y = visualViewport.offsetTop;\n    }\n  }\n  return {\n    width,\n    height,\n    x,\n    y\n  };\n}\n\n// Returns the inner client rect, subtracting scrollbars if present.\nfunction getInnerBoundingClientRect(element, strategy) {\n  const clientRect = getBoundingClientRect(element, true, strategy === 'fixed');\n  const top = clientRect.top + element.clientTop;\n  const left = clientRect.left + element.clientLeft;\n  const scale = isHTMLElement(element) ? getScale(element) : createCoords(1);\n  const width = element.clientWidth * scale.x;\n  const height = element.clientHeight * scale.y;\n  const x = left * scale.x;\n  const y = top * scale.y;\n  return {\n    width,\n    height,\n    x,\n    y\n  };\n}\nfunction getClientRectFromClippingAncestor(element, clippingAncestor, strategy) {\n  let rect;\n  if (clippingAncestor === 'viewport') {\n    rect = getViewportRect(element, strategy);\n  } else if (clippingAncestor === 'document') {\n    rect = getDocumentRect(getDocumentElement(element));\n  } else if (isElement(clippingAncestor)) {\n    rect = getInnerBoundingClientRect(clippingAncestor, strategy);\n  } else {\n    const visualOffsets = getVisualOffsets(element);\n    rect = {\n      x: clippingAncestor.x - visualOffsets.x,\n      y: clippingAncestor.y - visualOffsets.y,\n      width: clippingAncestor.width,\n      height: clippingAncestor.height\n    };\n  }\n  return rectToClientRect(rect);\n}\nfunction hasFixedPositionAncestor(element, stopNode) {\n  const parentNode = getParentNode(element);\n  if (parentNode === stopNode || !isElement(parentNode) || isLastTraversableNode(parentNode)) {\n    return false;\n  }\n  return getComputedStyle(parentNode).position === 'fixed' || hasFixedPositionAncestor(parentNode, stopNode);\n}\n\n// A \"clipping ancestor\" is an `overflow` element with the characteristic of\n// clipping (or hiding) child elements. This returns all clipping ancestors\n// of the given element up the tree.\nfunction getClippingElementAncestors(element, cache) {\n  const cachedResult = cache.get(element);\n  if (cachedResult) {\n    return cachedResult;\n  }\n  let result = getOverflowAncestors(element, [], false).filter(el => isElement(el) && getNodeName(el) !== 'body');\n  let currentContainingBlockComputedStyle = null;\n  const elementIsFixed = getComputedStyle(element).position === 'fixed';\n  let currentNode = elementIsFixed ? getParentNode(element) : element;\n\n  // https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block\n  while (isElement(currentNode) && !isLastTraversableNode(currentNode)) {\n    const computedStyle = getComputedStyle(currentNode);\n    const currentNodeIsContaining = isContainingBlock(currentNode);\n    if (!currentNodeIsContaining && computedStyle.position === 'fixed') {\n      currentContainingBlockComputedStyle = null;\n    }\n    const shouldDropCurrentNode = elementIsFixed ? !currentNodeIsContaining && !currentContainingBlockComputedStyle : !currentNodeIsContaining && computedStyle.position === 'static' && !!currentContainingBlockComputedStyle && ['absolute', 'fixed'].includes(currentContainingBlockComputedStyle.position) || isOverflowElement(currentNode) && !currentNodeIsContaining && hasFixedPositionAncestor(element, currentNode);\n    if (shouldDropCurrentNode) {\n      // Drop non-containing blocks.\n      result = result.filter(ancestor => ancestor !== currentNode);\n    } else {\n      // Record last containing block for next iteration.\n      currentContainingBlockComputedStyle = computedStyle;\n    }\n    currentNode = getParentNode(currentNode);\n  }\n  cache.set(element, result);\n  return result;\n}\n\n// Gets the maximum area that the element is visible in due to any number of\n// clipping ancestors.\nfunction getClippingRect(_ref) {\n  let {\n    element,\n    boundary,\n    rootBoundary,\n    strategy\n  } = _ref;\n  const elementClippingAncestors = boundary === 'clippingAncestors' ? isTopLayer(element) ? [] : getClippingElementAncestors(element, this._c) : [].concat(boundary);\n  const clippingAncestors = [...elementClippingAncestors, rootBoundary];\n  const firstClippingAncestor = clippingAncestors[0];\n  const clippingRect = clippingAncestors.reduce((accRect, clippingAncestor) => {\n    const rect = getClientRectFromClippingAncestor(element, clippingAncestor, strategy);\n    accRect.top = max(rect.top, accRect.top);\n    accRect.right = min(rect.right, accRect.right);\n    accRect.bottom = min(rect.bottom, accRect.bottom);\n    accRect.left = max(rect.left, accRect.left);\n    return accRect;\n  }, getClientRectFromClippingAncestor(element, firstClippingAncestor, strategy));\n  return {\n    width: clippingRect.right - clippingRect.left,\n    height: clippingRect.bottom - clippingRect.top,\n    x: clippingRect.left,\n    y: clippingRect.top\n  };\n}\n\nfunction getDimensions(element) {\n  const {\n    width,\n    height\n  } = getCssDimensions(element);\n  return {\n    width,\n    height\n  };\n}\n\nfunction getRectRelativeToOffsetParent(element, offsetParent, strategy) {\n  const isOffsetParentAnElement = isHTMLElement(offsetParent);\n  const documentElement = getDocumentElement(offsetParent);\n  const isFixed = strategy === 'fixed';\n  const rect = getBoundingClientRect(element, true, isFixed, offsetParent);\n  let scroll = {\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n  const offsets = createCoords(0);\n  if (isOffsetParentAnElement || !isOffsetParentAnElement && !isFixed) {\n    if (getNodeName(offsetParent) !== 'body' || isOverflowElement(documentElement)) {\n      scroll = getNodeScroll(offsetParent);\n    }\n    if (isOffsetParentAnElement) {\n      const offsetRect = getBoundingClientRect(offsetParent, true, isFixed, offsetParent);\n      offsets.x = offsetRect.x + offsetParent.clientLeft;\n      offsets.y = offsetRect.y + offsetParent.clientTop;\n    } else if (documentElement) {\n      // If the <body> scrollbar appears on the left (e.g. RTL systems). Use\n      // Firefox with layout.scrollbar.side = 3 in about:config to test this.\n      offsets.x = getWindowScrollBarX(documentElement);\n    }\n  }\n  const htmlOffset = documentElement && !isOffsetParentAnElement && !isFixed ? getHTMLOffset(documentElement, scroll) : createCoords(0);\n  const x = rect.left + scroll.scrollLeft - offsets.x - htmlOffset.x;\n  const y = rect.top + scroll.scrollTop - offsets.y - htmlOffset.y;\n  return {\n    x,\n    y,\n    width: rect.width,\n    height: rect.height\n  };\n}\n\nfunction isStaticPositioned(element) {\n  return getComputedStyle(element).position === 'static';\n}\n\nfunction getTrueOffsetParent(element, polyfill) {\n  if (!isHTMLElement(element) || getComputedStyle(element).position === 'fixed') {\n    return null;\n  }\n  if (polyfill) {\n    return polyfill(element);\n  }\n  let rawOffsetParent = element.offsetParent;\n\n  // Firefox returns the <html> element as the offsetParent if it's non-static,\n  // while Chrome and Safari return the <body> element. The <body> element must\n  // be used to perform the correct calculations even if the <html> element is\n  // non-static.\n  if (getDocumentElement(element) === rawOffsetParent) {\n    rawOffsetParent = rawOffsetParent.ownerDocument.body;\n  }\n  return rawOffsetParent;\n}\n\n// Gets the closest ancestor positioned element. Handles some edge cases,\n// such as table ancestors and cross browser bugs.\nfunction getOffsetParent(element, polyfill) {\n  const win = getWindow(element);\n  if (isTopLayer(element)) {\n    return win;\n  }\n  if (!isHTMLElement(element)) {\n    let svgOffsetParent = getParentNode(element);\n    while (svgOffsetParent && !isLastTraversableNode(svgOffsetParent)) {\n      if (isElement(svgOffsetParent) && !isStaticPositioned(svgOffsetParent)) {\n        return svgOffsetParent;\n      }\n      svgOffsetParent = getParentNode(svgOffsetParent);\n    }\n    return win;\n  }\n  let offsetParent = getTrueOffsetParent(element, polyfill);\n  while (offsetParent && isTableElement(offsetParent) && isStaticPositioned(offsetParent)) {\n    offsetParent = getTrueOffsetParent(offsetParent, polyfill);\n  }\n  if (offsetParent && isLastTraversableNode(offsetParent) && isStaticPositioned(offsetParent) && !isContainingBlock(offsetParent)) {\n    return win;\n  }\n  return offsetParent || getContainingBlock(element) || win;\n}\n\nconst getElementRects = async function (data) {\n  const getOffsetParentFn = this.getOffsetParent || getOffsetParent;\n  const getDimensionsFn = this.getDimensions;\n  const floatingDimensions = await getDimensionsFn(data.floating);\n  return {\n    reference: getRectRelativeToOffsetParent(data.reference, await getOffsetParentFn(data.floating), data.strategy),\n    floating: {\n      x: 0,\n      y: 0,\n      width: floatingDimensions.width,\n      height: floatingDimensions.height\n    }\n  };\n};\n\nfunction isRTL(element) {\n  return getComputedStyle(element).direction === 'rtl';\n}\n\nconst platform = {\n  convertOffsetParentRelativeRectToViewportRelativeRect,\n  getDocumentElement,\n  getClippingRect,\n  getOffsetParent,\n  getElementRects,\n  getClientRects,\n  getDimensions,\n  getScale,\n  isElement,\n  isRTL\n};\n\nfunction rectsAreEqual(a, b) {\n  return a.x === b.x && a.y === b.y && a.width === b.width && a.height === b.height;\n}\n\n// https://samthor.au/2021/observing-dom/\nfunction observeMove(element, onMove) {\n  let io = null;\n  let timeoutId;\n  const root = getDocumentElement(element);\n  function cleanup() {\n    var _io;\n    clearTimeout(timeoutId);\n    (_io = io) == null || _io.disconnect();\n    io = null;\n  }\n  function refresh(skip, threshold) {\n    if (skip === void 0) {\n      skip = false;\n    }\n    if (threshold === void 0) {\n      threshold = 1;\n    }\n    cleanup();\n    const elementRectForRootMargin = element.getBoundingClientRect();\n    const {\n      left,\n      top,\n      width,\n      height\n    } = elementRectForRootMargin;\n    if (!skip) {\n      onMove();\n    }\n    if (!width || !height) {\n      return;\n    }\n    const insetTop = floor(top);\n    const insetRight = floor(root.clientWidth - (left + width));\n    const insetBottom = floor(root.clientHeight - (top + height));\n    const insetLeft = floor(left);\n    const rootMargin = -insetTop + \"px \" + -insetRight + \"px \" + -insetBottom + \"px \" + -insetLeft + \"px\";\n    const options = {\n      rootMargin,\n      threshold: max(0, min(1, threshold)) || 1\n    };\n    let isFirstUpdate = true;\n    function handleObserve(entries) {\n      const ratio = entries[0].intersectionRatio;\n      if (ratio !== threshold) {\n        if (!isFirstUpdate) {\n          return refresh();\n        }\n        if (!ratio) {\n          // If the reference is clipped, the ratio is 0. Throttle the refresh\n          // to prevent an infinite loop of updates.\n          timeoutId = setTimeout(() => {\n            refresh(false, 1e-7);\n          }, 1000);\n        } else {\n          refresh(false, ratio);\n        }\n      }\n      if (ratio === 1 && !rectsAreEqual(elementRectForRootMargin, element.getBoundingClientRect())) {\n        // It's possible that even though the ratio is reported as 1, the\n        // element is not actually fully within the IntersectionObserver's root\n        // area anymore. This can happen under performance constraints. This may\n        // be a bug in the browser's IntersectionObserver implementation. To\n        // work around this, we compare the element's bounding rect now with\n        // what it was at the time we created the IntersectionObserver. If they\n        // are not equal then the element moved, so we refresh.\n        refresh();\n      }\n      isFirstUpdate = false;\n    }\n\n    // Older browsers don't support a `document` as the root and will throw an\n    // error.\n    try {\n      io = new IntersectionObserver(handleObserve, {\n        ...options,\n        // Handle <iframe>s\n        root: root.ownerDocument\n      });\n    } catch (e) {\n      io = new IntersectionObserver(handleObserve, options);\n    }\n    io.observe(element);\n  }\n  refresh(true);\n  return cleanup;\n}\n\n/**\n * Automatically updates the position of the floating element when necessary.\n * Should only be called when the floating element is mounted on the DOM or\n * visible on the screen.\n * @returns cleanup function that should be invoked when the floating element is\n * removed from the DOM or hidden from the screen.\n * @see https://floating-ui.com/docs/autoUpdate\n */\nfunction autoUpdate(reference, floating, update, options) {\n  if (options === void 0) {\n    options = {};\n  }\n  const {\n    ancestorScroll = true,\n    ancestorResize = true,\n    elementResize = typeof ResizeObserver === 'function',\n    layoutShift = typeof IntersectionObserver === 'function',\n    animationFrame = false\n  } = options;\n  const referenceEl = unwrapElement(reference);\n  const ancestors = ancestorScroll || ancestorResize ? [...(referenceEl ? getOverflowAncestors(referenceEl) : []), ...getOverflowAncestors(floating)] : [];\n  ancestors.forEach(ancestor => {\n    ancestorScroll && ancestor.addEventListener('scroll', update, {\n      passive: true\n    });\n    ancestorResize && ancestor.addEventListener('resize', update);\n  });\n  const cleanupIo = referenceEl && layoutShift ? observeMove(referenceEl, update) : null;\n  let reobserveFrame = -1;\n  let resizeObserver = null;\n  if (elementResize) {\n    resizeObserver = new ResizeObserver(_ref => {\n      let [firstEntry] = _ref;\n      if (firstEntry && firstEntry.target === referenceEl && resizeObserver) {\n        // Prevent update loops when using the `size` middleware.\n        // https://github.com/floating-ui/floating-ui/issues/1740\n        resizeObserver.unobserve(floating);\n        cancelAnimationFrame(reobserveFrame);\n        reobserveFrame = requestAnimationFrame(() => {\n          var _resizeObserver;\n          (_resizeObserver = resizeObserver) == null || _resizeObserver.observe(floating);\n        });\n      }\n      update();\n    });\n    if (referenceEl && !animationFrame) {\n      resizeObserver.observe(referenceEl);\n    }\n    resizeObserver.observe(floating);\n  }\n  let frameId;\n  let prevRefRect = animationFrame ? getBoundingClientRect(reference) : null;\n  if (animationFrame) {\n    frameLoop();\n  }\n  function frameLoop() {\n    const nextRefRect = getBoundingClientRect(reference);\n    if (prevRefRect && !rectsAreEqual(prevRefRect, nextRefRect)) {\n      update();\n    }\n    prevRefRect = nextRefRect;\n    frameId = requestAnimationFrame(frameLoop);\n  }\n  update();\n  return () => {\n    var _resizeObserver2;\n    ancestors.forEach(ancestor => {\n      ancestorScroll && ancestor.removeEventListener('scroll', update);\n      ancestorResize && ancestor.removeEventListener('resize', update);\n    });\n    cleanupIo == null || cleanupIo();\n    (_resizeObserver2 = resizeObserver) == null || _resizeObserver2.disconnect();\n    resizeObserver = null;\n    if (animationFrame) {\n      cancelAnimationFrame(frameId);\n    }\n  };\n}\n\n/**\n * Resolves with an object of overflow side offsets that determine how much the\n * element is overflowing a given clipping boundary on each side.\n * - positive = overflowing the boundary by that number of pixels\n * - negative = how many pixels left before it will overflow\n * - 0 = lies flush with the boundary\n * @see https://floating-ui.com/docs/detectOverflow\n */\nconst detectOverflow = detectOverflow$1;\n\n/**\n * Modifies the placement by translating the floating element along the\n * specified axes.\n * A number (shorthand for `mainAxis` or distance), or an axes configuration\n * object may be passed.\n * @see https://floating-ui.com/docs/offset\n */\nconst offset = offset$1;\n\n/**\n * Optimizes the visibility of the floating element by choosing the placement\n * that has the most space available automatically, without needing to specify a\n * preferred placement. Alternative to `flip`.\n * @see https://floating-ui.com/docs/autoPlacement\n */\nconst autoPlacement = autoPlacement$1;\n\n/**\n * Optimizes the visibility of the floating element by shifting it in order to\n * keep it in view when it will overflow the clipping boundary.\n * @see https://floating-ui.com/docs/shift\n */\nconst shift = shift$1;\n\n/**\n * Optimizes the visibility of the floating element by flipping the `placement`\n * in order to keep it in view when the preferred placement(s) will overflow the\n * clipping boundary. Alternative to `autoPlacement`.\n * @see https://floating-ui.com/docs/flip\n */\nconst flip = flip$1;\n\n/**\n * Provides data that allows you to change the size of the floating element —\n * for instance, prevent it from overflowing the clipping boundary or match the\n * width of the reference element.\n * @see https://floating-ui.com/docs/size\n */\nconst size = size$1;\n\n/**\n * Provides data to hide the floating element in applicable situations, such as\n * when it is not in the same clipping context as the reference element.\n * @see https://floating-ui.com/docs/hide\n */\nconst hide = hide$1;\n\n/**\n * Provides data to position an inner element of the floating element so that it\n * appears centered to the reference element.\n * @see https://floating-ui.com/docs/arrow\n */\nconst arrow = arrow$1;\n\n/**\n * Provides improved positioning for inline reference elements that can span\n * over multiple lines, such as hyperlinks or range selections.\n * @see https://floating-ui.com/docs/inline\n */\nconst inline = inline$1;\n\n/**\n * Built-in `limiter` that will stop `shift()` at a certain point.\n */\nconst limitShift = limitShift$1;\n\n/**\n * Computes the `x` and `y` coordinates that will place the floating element\n * next to a given reference element.\n */\nconst computePosition = (reference, floating, options) => {\n  // This caches the expensive `getClippingElementAncestors` function so that\n  // multiple lifecycle resets re-use the same result. It only lives for a\n  // single call. If other functions become expensive, we can add them as well.\n  const cache = new Map();\n  const mergedOptions = {\n    platform,\n    ...options\n  };\n  const platformWithCache = {\n    ...mergedOptions.platform,\n    _c: cache\n  };\n  return computePosition$1(reference, floating, {\n    ...mergedOptions,\n    platform: platformWithCache\n  });\n};\n\nexport { arrow, autoPlacement, autoUpdate, computePosition, detectOverflow, flip, hide, inline, limitShift, offset, platform, shift, size };\n", "/**\r\n * TooltipManager - Manages tooltips for checkout elements\r\n * \r\n * This class provides a tooltip system using the floating-ui library.\r\n * It dynamically loads required dependencies and handles tooltip positioning and display.\r\n */\r\n\r\nimport { computePosition, flip, shift, offset, arrow } from '@floating-ui/dom';\r\n\r\nexport class TooltipManager {\r\n  #app;\r\n  #logger;\r\n  #tooltip;\r\n  #arrowElement;\r\n  #textContainer;\r\n  #currentElement = null;\r\n  #showTimeout = null;\r\n  #hideTimeout = null;\r\n  #initialized = false;\r\n\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#logger = app.logger.createModuleLogger('TOOLTIP');\r\n    \r\n    this.#init();\r\n    this.#logger.info('TooltipManager initialized');\r\n  }\r\n\r\n  /**\r\n   * Initialize the tooltip system\r\n   */\r\n  #init() {\r\n    if (this.#initialized) return;\r\n    \r\n    this.#tooltip = this.#createTooltip();\r\n    this.#arrowElement = this.#tooltip.querySelector('#checkout-tooltip-arrow');\r\n    this.#textContainer = this.#tooltip.querySelector('#checkout-tooltip-text');\r\n    \r\n    this.#setupEventListeners();\r\n    this.#initialized = true;\r\n    this.#logger.info('Tooltip system initialized with floating-ui');\r\n  }\r\n\r\n  /**\r\n   * Create the tooltip element\r\n   */\r\n  #createTooltip() {\r\n    // Check if tooltip already exists\r\n    const existingTooltip = document.getElementById('checkout-tooltip');\r\n    if (existingTooltip) return existingTooltip;\r\n    \r\n    const tooltip = document.createElement('div');\r\n    tooltip.setAttribute('role', 'tooltip');\r\n    tooltip.id = 'checkout-tooltip';\r\n    tooltip.style.display = 'none';\r\n    \r\n    // Create text container\r\n    const textContainer = document.createElement('div');\r\n    textContainer.id = 'checkout-tooltip-text';\r\n    tooltip.appendChild(textContainer);\r\n    \r\n    // Create arrow element\r\n    const arrowElement = document.createElement('div');\r\n    arrowElement.id = 'checkout-tooltip-arrow';\r\n    tooltip.appendChild(arrowElement);\r\n    \r\n    document.body.appendChild(tooltip);\r\n    return tooltip;\r\n  }\r\n\r\n  /**\r\n   * Set up event listeners for tooltips\r\n   */\r\n  #setupEventListeners() {\r\n    // Event delegation for better performance\r\n    document.addEventListener('mouseover', (e) => {\r\n      const element = e.target.closest('[data-os-tooltip]');\r\n      if (!element) return;\r\n\r\n      clearTimeout(this.#showTimeout);\r\n      this.#showTimeout = setTimeout(() => {\r\n        this.#showTooltip(element);\r\n      }, 200);\r\n    });\r\n\r\n    document.addEventListener('mouseout', (e) => {\r\n      const element = e.target.closest('[data-os-tooltip]');\r\n      if (!element) return;\r\n\r\n      clearTimeout(this.#showTimeout);\r\n      this.#hideTooltip();\r\n    });\r\n\r\n    // Handle focus events for accessibility\r\n    document.addEventListener('focus', (e) => {\r\n      const element = e.target.closest('[data-os-tooltip]');\r\n      if (!element) return;\r\n      this.#showTooltip(element);\r\n    }, true);\r\n\r\n    document.addEventListener('blur', (e) => {\r\n      const element = e.target.closest('[data-os-tooltip]');\r\n      if (!element) return;\r\n      this.#hideTooltip();\r\n    }, true);\r\n\r\n    // Handle escape key\r\n    document.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Escape' && this.#currentElement) {\r\n        this.#hideTooltip();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Show the tooltip for a specific element\r\n   */\r\n  #showTooltip(element) {\r\n    if (!this.#initialized) {\r\n      this.#logger.warn('Cannot show tooltip: system not initialized');\r\n      return;\r\n    }\r\n    \r\n    clearTimeout(this.#hideTimeout);\r\n    this.#currentElement = element;\r\n    \r\n    const text = element.getAttribute('data-os-tooltip');\r\n    const position = element.getAttribute('data-os-tooltip-position') || 'top';\r\n    \r\n    this.#textContainer.textContent = text;\r\n    this.#tooltip.style.display = 'block';\r\n\r\n    computePosition(element, this.#tooltip, {\r\n      placement: position,\r\n      middleware: [\r\n        offset(8),\r\n        flip({\r\n          fallbackPlacements: ['top', 'right', 'bottom', 'left'],\r\n        }),\r\n        shift({ padding: 5 }),\r\n        arrow({ element: this.#arrowElement }),\r\n      ],\r\n    }).then(({ x, y, placement, middlewareData }) => {\r\n      Object.assign(this.#tooltip.style, {\r\n        left: `${x}px`,\r\n        top: `${y}px`,\r\n      });\r\n\r\n      // Arrow positioning\r\n      const { x: arrowX, y: arrowY } = middlewareData.arrow;\r\n      const staticSide = {\r\n        top: 'bottom',\r\n        right: 'left',\r\n        bottom: 'top',\r\n        left: 'right',\r\n      }[placement.split('-')[0]];\r\n\r\n      Object.assign(this.#arrowElement.style, {\r\n        left: arrowX != null ? `${arrowX}px` : '',\r\n        top: arrowY != null ? `${arrowY}px` : '',\r\n        right: '',\r\n        bottom: '',\r\n        [staticSide]: '-4px',\r\n      });\r\n\r\n      requestAnimationFrame(() => {\r\n        this.#tooltip.classList.add('checkout-tooltip-visible');\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Hide the tooltip\r\n   */\r\n  #hideTooltip() {\r\n    if (!this.#tooltip) return;\r\n    \r\n    this.#tooltip.classList.remove('checkout-tooltip-visible');\r\n    this.#hideTimeout = setTimeout(() => {\r\n      if (!this.#tooltip.classList.contains('checkout-tooltip-visible')) {\r\n        this.#tooltip.style.display = 'none';\r\n      }\r\n      this.#currentElement = null;\r\n    }, 200);\r\n  }\r\n} ", "/**\r\n * UpsellManager - Manages post-purchase upsell operations\r\n * \r\n * This class provides functionality for handling post-purchase upsells,\r\n * allowing customers to add additional products to their order.\r\n */\r\n\r\nimport { initNavigationPrevention, saveAcceptedUpsell, createNextUrlWithDebug } from '../utils/NavigationPrevention.js';\r\n\r\nexport class UpsellManager {\r\n  #app;\r\n  #logger;\r\n  #stateManager;\r\n  #api;\r\n  #upsellElements = {};\r\n  #orderRef = null;\r\n\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#logger = app.logger.createModuleLogger('UPSELL');\r\n    this.#stateManager = app.state;\r\n    this.#api = app.api;\r\n    \r\n    this.#init();\r\n    this.#logger.info('UpsellManager initialized');\r\n  }\r\n\r\n  #init() {\r\n    // Initialize navigation prevention\r\n    // initNavigationPrevention();\r\n    \r\n    // Check for order reference in URL or sessionStorage\r\n    this.#orderRef = this.#getOrderReferenceId();\r\n    \r\n    if (this.#orderRef) {\r\n      this.#logger.info(`Order reference ID found: ${this.#orderRef}`);\r\n      this.#stateManager.setState('order.ref_id', this.#orderRef);\r\n    } else {\r\n      this.#logger.warn('No order reference ID found, upsell functionality will be limited');\r\n    }\r\n    \r\n    this.#initUpsellElements();\r\n    this.#bindEvents();\r\n  }\r\n  \r\n  /**\r\n   * Get the order reference ID from URL parameters or sessionStorage\r\n   * @returns {string|null} The order reference ID or null if not found\r\n   */\r\n  #getOrderReferenceId() {\r\n    // Try to get from URL parameters first\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    let refId = urlParams.get('ref_id');\r\n    \r\n    // If not in URL, try sessionStorage\r\n    if (!refId) {\r\n      refId = sessionStorage.getItem('order_ref_id');\r\n      this.#logger.debug('Getting order ref_id from sessionStorage:', refId);\r\n    } else {\r\n      this.#logger.debug('Getting order ref_id from URL parameters:', refId);\r\n      // Save to sessionStorage for future use\r\n      sessionStorage.setItem('order_ref_id', refId);\r\n    }\r\n    \r\n    return refId;\r\n  }\r\n  \r\n  /**\r\n   * Initialize upsell UI elements\r\n   */\r\n  #initUpsellElements() {\r\n    this.#upsellElements = {\r\n      acceptButtons: document.querySelectorAll('[data-os-upsell=\"accept\"]'),\r\n      declineButtons: document.querySelectorAll('[data-os-upsell=\"decline\"]'),\r\n    };\r\n    \r\n    this.#logger.debug(`Found ${this.#upsellElements.acceptButtons.length} accept buttons and ${this.#upsellElements.declineButtons.length} decline buttons`);\r\n  }\r\n  \r\n  /**\r\n   * Bind events to upsell elements\r\n   */\r\n  #bindEvents() {\r\n    // Bind click events to accept buttons\r\n    this.#upsellElements.acceptButtons.forEach(button => {\r\n      button.addEventListener('click', event => {\r\n        event.preventDefault();\r\n        \r\n        const packageId = button.getAttribute('data-os-package-id');\r\n        const quantity = parseInt(button.getAttribute('data-os-quantity') || '1', 10);\r\n        const nextUrl = button.getAttribute('data-os-next-url');\r\n        \r\n        if (!packageId) {\r\n          this.#logger.error('No package ID specified for upsell accept button');\r\n          return;\r\n        }\r\n        \r\n        this.acceptUpsell(packageId, quantity, nextUrl);\r\n      });\r\n    });\r\n    \r\n    // Bind click events to decline buttons\r\n    this.#upsellElements.declineButtons.forEach(button => {\r\n      button.addEventListener('click', event => {\r\n        event.preventDefault();\r\n        \r\n        const nextUrl = button.getAttribute('data-os-next-url');\r\n        if (nextUrl) {\r\n          this.declineUpsell(nextUrl);\r\n        } else {\r\n          this.#logger.error('No next URL specified for upsell decline button');\r\n        }\r\n      });\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Accept an upsell offer by adding the product to the order\r\n   * @param {string|number} packageId - The package ID to add to the order\r\n   * @param {number} quantity - The quantity to add (default: 1)\r\n   * @param {string} nextUrl - The URL to redirect to after adding the upsell\r\n   */\r\n  async acceptUpsell(packageId, quantity = 1, nextUrl) {\r\n    if (!this.#orderRef) {\r\n      this.#logger.error('Cannot accept upsell: No order reference ID found');\r\n      return;\r\n    }\r\n    \r\n    this.#logger.info(`Accepting upsell: Package ${packageId}, Quantity ${quantity}`);\r\n    \r\n    // Disable all upsell buttons to prevent multiple clicks\r\n    this.#disableUpsellButtons();\r\n    \r\n    try {\r\n      // Show loading state\r\n      document.body.classList.add('os-loading');\r\n      \r\n      // Create the upsell data\r\n      const upsellData = {\r\n        lines: [{\r\n          package_id: Number(packageId),\r\n          quantity: Number(quantity),\r\n          is_upsell: true\r\n        }]\r\n      };\r\n      \r\n      // Call the API to add the upsell\r\n      const response = await this.#api.createOrderUpsell(this.#orderRef, upsellData);\r\n      this.#logger.info('Upsell successfully added to order', response);\r\n      \r\n      // Store upsell information in sessionStorage for tracking on the next page\r\n      this.#storeUpsellPurchaseData(response, packageId, quantity);\r\n      \r\n      // Save accepted upsell info for back navigation prevention\r\n      //const processedNextUrl = createNextUrlWithDebug(nextUrl);\r\n      // saveAcceptedUpsell(packageId, processedNextUrl);\r\n      \r\n      // Redirect to the next page\r\n      this.#redirect(nextUrl);\r\n    } catch (error) {\r\n      this.#logger.error('Error accepting upsell:', error);\r\n      document.body.classList.remove('os-loading');\r\n      \r\n      // Re-enable buttons in case of error\r\n      this.#enableUpsellButtons();\r\n      \r\n      // Display error to user\r\n      this.#displayError('There was an error processing your upsell. Please try again.');\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Store upsell data in sessionStorage to track as a purchase event on next page load\r\n   * @param {Object} response - API response from createOrderUpsell\r\n   * @param {string|number} packageId - The package ID added to the order\r\n   * @param {number} quantity - The quantity added\r\n   */\r\n  #storeUpsellPurchaseData(response, packageId, quantity) {\r\n    try {\r\n      // Get the campaign data to find the package details\r\n      const campaignData = this.#app.getCampaignData();\r\n      if (!campaignData || !campaignData.packages) {\r\n        this.#logger.warn('Campaign data not available for upsell tracking');\r\n        return;\r\n      }\r\n      \r\n      // Find the package that was added as an upsell\r\n      const packageData = campaignData.packages.find(pkg => \r\n        pkg.ref_id.toString() === packageId.toString() || \r\n        pkg.external_id?.toString() === packageId.toString()\r\n      );\r\n      \r\n      if (!packageData) {\r\n        this.#logger.warn(`Package data not found for upsell tracking: ${packageId}`);\r\n        return;\r\n      }\r\n      \r\n      // Store minimal order data needed for the purchase event\r\n      const upsellPurchaseData = {\r\n        number: response.number || response.ref_id,\r\n        ref_id: response.ref_id,\r\n        total: parseFloat(packageData.price) * quantity,\r\n        currency: campaignData.currency || 'USD',\r\n        lines: [{\r\n          product_id: packageData.external_id || packageData.ref_id,\r\n          product_title: packageData.name,\r\n          price: parseFloat(packageData.price),\r\n          quantity: quantity,\r\n          is_upsell: true\r\n        }]\r\n      };\r\n      \r\n      // Store data in sessionStorage with a flag indicating it's an upsell purchase\r\n      sessionStorage.setItem('pending_upsell_purchase', 'true');\r\n      sessionStorage.setItem('upsell_purchase_data', JSON.stringify(upsellPurchaseData));\r\n      \r\n      this.#logger.info('Stored upsell purchase data for tracking on next page load', upsellPurchaseData);\r\n    } catch (error) {\r\n      this.#logger.error('Error storing upsell purchase data:', error);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Decline an upsell offer and redirect to the next URL\r\n   * @param {string} nextUrl - The URL to redirect to\r\n   */\r\n  declineUpsell(nextUrl) {\r\n    this.#logger.info('Declining upsell offer');\r\n    \r\n    // Disable all upsell buttons to prevent multiple clicks\r\n    this.#disableUpsellButtons();\r\n    \r\n    this.#redirect(nextUrl);\r\n  }\r\n  \r\n  /**\r\n   * Disable all upsell buttons to prevent multiple clicks\r\n   */\r\n  #disableUpsellButtons() {\r\n    this.#logger.debug('Disabling upsell buttons');\r\n    \r\n    // Disable all accept buttons\r\n    this.#upsellElements.acceptButtons.forEach(button => {\r\n      button.style.pointerEvents = 'none';\r\n      button.classList.add('os-button-disabled');\r\n    });\r\n    \r\n    // Disable all decline buttons\r\n    this.#upsellElements.declineButtons.forEach(button => {\r\n      button.style.pointerEvents = 'none';\r\n      button.classList.add('os-button-disabled');\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Re-enable all upsell buttons (used in case of error)\r\n   */\r\n  #enableUpsellButtons() {\r\n    this.#logger.debug('Re-enabling upsell buttons');\r\n    \r\n    // Re-enable all accept buttons\r\n    this.#upsellElements.acceptButtons.forEach(button => {\r\n      button.style.pointerEvents = '';\r\n      button.classList.remove('os-button-disabled');\r\n    });\r\n    \r\n    // Re-enable all decline buttons\r\n    this.#upsellElements.declineButtons.forEach(button => {\r\n      button.style.pointerEvents = '';\r\n      button.classList.remove('os-button-disabled');\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Redirect to a URL, appending the order reference ID if needed\r\n   * @param {string} url - The URL to redirect to\r\n   */\r\n  #redirect(url) {\r\n    if (!url) {\r\n      this.#logger.warn('No URL provided for redirect');\r\n      return;\r\n    }\r\n    \r\n    const redirectUrl = new URL(url, window.location.origin);\r\n    \r\n    // Append the order reference ID if not already in the URL\r\n    if (this.#orderRef && !redirectUrl.searchParams.has('ref_id')) {\r\n      redirectUrl.searchParams.append('ref_id', this.#orderRef);\r\n    }\r\n    \r\n    // Preserve debug parameter if present\r\n    const currentUrlParams = new URLSearchParams(window.location.search);\r\n    if (currentUrlParams.has('debug') && currentUrlParams.get('debug') === 'true' && \r\n        !redirectUrl.searchParams.has('debug')) {\r\n      redirectUrl.searchParams.append('debug', 'true');\r\n    }\r\n    \r\n    this.#logger.info(`Redirecting to ${redirectUrl.href}`);\r\n    window.location.href = redirectUrl.href;\r\n  }\r\n  \r\n  /**\r\n   * Display an error message to the user\r\n   * @param {string} message - The error message to display\r\n   */\r\n  #displayError(message) {\r\n    const errorContainer = document.querySelector('[data-os-error-container]');\r\n    if (errorContainer) {\r\n      errorContainer.textContent = message;\r\n      errorContainer.style.display = 'block';\r\n    } else {\r\n      alert(message);\r\n    }\r\n  }\r\n} ", "/**\r\n * DiscountManager - Manages discount calculations for vouchers/coupons\r\n * \r\n * This class handles different types of discounts (percentage, fixed amount)\r\n * and provides methods to calculate discount amounts.\r\n */\r\n\r\nexport class DiscountManager {\r\n  #app;\r\n  #logger;\r\n\r\n  constructor(app) {\r\n    this.#app = app;\r\n    this.#logger = app.logger.createModuleLogger('DISCOUNT');\r\n    this.#logger.info('DiscountManager initialized');\r\n  }\r\n\r\n  /**\r\n   * Calculate discount amount based on coupon details and subtotal\r\n   * @param {Object} couponDetails - Coupon details object\r\n   * @param {number} subtotal - Cart subtotal before discount\r\n   * @param {Array} cartItems - Array of cart items\r\n   * @returns {number} Calculated discount amount\r\n   */\r\n  calculateDiscount(couponDetails, subtotal, cartItems = []) {\r\n    if (!couponDetails || !couponDetails.code) {\r\n      this.#logger.debug('[DM.calculateDiscount] No coupon details or code provided. Returning 0.');\r\n      return 0;\r\n    }\r\n    this.#logger.debugWithTime(`[DM.calculateDiscount] Start. Coupon: \"${couponDetails.code}\", type: ${couponDetails.type}, value: ${couponDetails.value}, originalSubtotal: ${subtotal}, itemCount: ${cartItems.length}`);\r\n\r\n    let discountableSubtotal = subtotal;\r\n    let itemEligibilityMessage = '';\r\n\r\n    if (couponDetails.applicable_product_ids && Array.isArray(couponDetails.applicable_product_ids) && couponDetails.applicable_product_ids.length > 0) {\r\n      this.#logger.debugWithTime(`[DM.calculateDiscount] Coupon \"${couponDetails.code}\" is product-specific. Applicable IDs: ${couponDetails.applicable_product_ids.join(', ')}. Cart items for check: ${JSON.stringify(cartItems.map(i => ({id: i.id, pkgId: i.package_id})))}`);\r\n      const applicableItems = cartItems.filter(item => \r\n        couponDetails.applicable_product_ids.includes(item.package_id?.toString()) || \r\n        couponDetails.applicable_product_ids.includes(item.id?.toString())\r\n      );\r\n      this.#logger.debugWithTime(`[DM.calculateDiscount] Found ${applicableItems.length} applicable items for coupon \"${couponDetails.code}\".`);\r\n\r\n      if (applicableItems.length === 0) {\r\n        this.#logger.info(`[DM.calculateDiscount] Coupon \"${couponDetails.code}\" requires specific products not found in cart. No discount applied.`);\r\n        return 0; \r\n      }\r\n\r\n      discountableSubtotal = applicableItems.reduce((acc, item) => \r\n        acc + (item.price_total ?? (item.price * (item.quantity || 1))), 0);\r\n      itemEligibilityMessage = ` on applicable items (subtotal: ${discountableSubtotal.toFixed(2)})`;\r\n      this.#logger.debugWithTime(`[DM.calculateDiscount] Subtotal of applicable items for \"${couponDetails.code}\": ${discountableSubtotal}`);\r\n    } else {\r\n      this.#logger.debugWithTime(`[DM.calculateDiscount] Coupon \"${couponDetails.code}\" is not product-specific or no cartItems provided/needed for check.`);\r\n    }\r\n\r\n    let discountAmount = 0;\r\n    switch (couponDetails.type) {\r\n      case 'percentage':\r\n        discountAmount = discountableSubtotal * (couponDetails.value / 100);\r\n        this.#logger.debug(`Applied ${couponDetails.value}% discount${itemEligibilityMessage}: -${discountAmount.toFixed(2)}`);\r\n        break;\r\n      case 'fixed':\r\n        discountAmount = Math.min(discountableSubtotal, couponDetails.value);\r\n        this.#logger.debug(`Applied fixed discount${itemEligibilityMessage}: -${discountAmount.toFixed(2)}`);\r\n        break;\r\n      case 'free_shipping':\r\n        this.#logger.debug('Applied free shipping discount (handled in shipping calculation)');\r\n        // Free shipping doesn't usually return a monetary amount here unless it represents saved shipping cost.\r\n        // If it should reduce the main discountAmount, logic would be needed here.\r\n        break;\r\n      default:\r\n        this.#logger.warn(`Unknown discount type: ${couponDetails.type}`);\r\n        break;\r\n    }\r\n    this.#logger.debugWithTime(`[DM.calculateDiscount] Coupon \"${couponDetails.code}\" calculated discountAmount: ${discountAmount.toFixed(2)}${itemEligibilityMessage}. Returning this value.`);\r\n    return discountAmount;\r\n  }\r\n\r\n  /**\r\n   * Validates if a coupon can be applied to the cart\r\n   * @param {string} couponCode - Coupon code to validate\r\n   * @param {Object} cart - Cart object\r\n   * @returns {boolean} Whether the coupon is valid\r\n   */\r\n  validateCoupon(couponCode, cart) {\r\n    // This would typically call an API to validate the coupon\r\n    // For now, we'll assume all coupons are valid\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Get display text for a coupon\r\n   * @param {Object} couponDetails - Coupon details\r\n   * @returns {string} Display text for the coupon\r\n   */\r\n  getCouponDisplayText(couponDetails) {\r\n    if (!couponDetails || !couponDetails.code) {\r\n      return '';\r\n    }\r\n\r\n    switch (couponDetails.type) {\r\n      case 'percentage':\r\n        return `${couponDetails.code} (${couponDetails.value}% off)`;\r\n      case 'fixed':\r\n        return `${couponDetails.code} ($${couponDetails.value} off)`;\r\n      case 'free_shipping':\r\n        return `${couponDetails.code} (Free shipping)`;\r\n      default:\r\n        return couponDetails.code;\r\n    }\r\n  }\r\n} ", "/**\r\n * PBAccordion utility\r\n * \r\n * Handles accordion UI components marked with pb-component=\"accordion\"\r\n */\r\n\r\nexport class PBAccordion {\r\n  constructor() {\r\n    this.cleanupInitialState();\r\n    this.init();\r\n  }\r\n\r\n  cleanupInitialState() {\r\n    document.querySelectorAll('[pb-component=\"accordion\"]').forEach(accordion => {\r\n      const group = accordion.querySelector('[pb-accordion-element=\"group\"]');\r\n      if (!group) return;\r\n\r\n      const items = group.querySelectorAll('[pb-accordion-element=\"accordion\"]');\r\n      items.forEach(item => {\r\n        const content = item.querySelector('[pb-accordion-element=\"content\"]');\r\n        const trigger = item.querySelector('[pb-accordion-element=\"trigger\"]');\r\n        const arrow = item.querySelector('[pb-accordion-element=\"arrow\"]');\r\n        const plus = item.querySelector('[pb-accordion-element=\"plus\"]');\r\n        \r\n        if (content) {\r\n          content.style.maxHeight = '0';\r\n          content.style.opacity = '0';\r\n          content.style.visibility = 'hidden';\r\n          content.style.display = 'none';\r\n        }\r\n        if (trigger) trigger.setAttribute('aria-expanded', 'false');\r\n        \r\n        item.classList.remove('is-active-accordion');\r\n        content?.classList.remove('is-active-accordion');\r\n        if (arrow) arrow.classList.remove('is-active-accordion');\r\n        if (plus) plus.classList.remove('is-active-accordion');\r\n      });\r\n\r\n      const initial = group.getAttribute('pb-accordion-initial');\r\n      if (initial && initial !== 'none') {\r\n        const initialItem = items[parseInt(initial) - 1];\r\n        if (initialItem) {\r\n          this.openAccordion(initialItem);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  init() {\r\n    document.querySelectorAll('[pb-component=\"accordion\"]').forEach(accordion => {\r\n      const group = accordion.querySelector('[pb-accordion-element=\"group\"]');\r\n      if (!group) return;\r\n      group.addEventListener('click', (e) => this.handleClick(e, group));\r\n    });\r\n  }\r\n\r\n  handleClick(event, group) {\r\n    const accordionItem = event.target.closest('[pb-accordion-element=\"accordion\"]');\r\n    if (!accordionItem) return;\r\n\r\n    const isOpen = accordionItem.classList.contains('is-active-accordion');\r\n    const isSingle = group.getAttribute('pb-accordion-single') === 'true';\r\n\r\n    if (isSingle) {\r\n      group.querySelectorAll('[pb-accordion-element=\"accordion\"]').forEach(item => {\r\n        if (item !== accordionItem && item.classList.contains('is-active-accordion')) {\r\n          this.closeAccordion(item);\r\n        }\r\n      });\r\n    }\r\n\r\n    if (isOpen) {\r\n      this.closeAccordion(accordionItem);\r\n    } else {\r\n      this.openAccordion(accordionItem);\r\n    }\r\n  }\r\n\r\n  openAccordion(item) {\r\n    const trigger = item.querySelector('[pb-accordion-element=\"trigger\"]');\r\n    const content = item.querySelector('[pb-accordion-element=\"content\"]');\r\n    const arrow = item.querySelector('[pb-accordion-element=\"arrow\"]');\r\n    const plus = item.querySelector('[pb-accordion-element=\"plus\"]');\r\n\r\n    content.style.visibility = 'visible';\r\n    content.style.display = 'block';\r\n    \r\n    content.offsetHeight;\r\n\r\n    const contentHeight = content.scrollHeight;\r\n    \r\n    requestAnimationFrame(() => {\r\n      content.style.maxHeight = `${contentHeight}px`;\r\n      content.style.opacity = '1';\r\n      trigger.setAttribute('aria-expanded', 'true');\r\n      item.classList.add('is-active-accordion');\r\n      content.classList.add('is-active-accordion');\r\n      if (arrow) arrow.classList.add('is-active-accordion');\r\n      if (plus) plus.classList.add('is-active-accordion');\r\n    });\r\n\r\n    content.addEventListener('transitionend', () => {\r\n      if (item.classList.contains('is-active-accordion')) {\r\n        content.style.maxHeight = 'none';\r\n      }\r\n    }, { once: true });\r\n  }\r\n\r\n  closeAccordion(item) {\r\n    const trigger = item.querySelector('[pb-accordion-element=\"trigger\"]');\r\n    const content = item.querySelector('[pb-accordion-element=\"content\"]');\r\n    const arrow = item.querySelector('[pb-accordion-element=\"arrow\"]');\r\n    const plus = item.querySelector('[pb-accordion-element=\"plus\"]');\r\n\r\n    content.style.maxHeight = `${content.scrollHeight}px`;\r\n    content.style.display = 'block';\r\n\r\n    content.offsetHeight;\r\n\r\n    requestAnimationFrame(() => {\r\n      content.style.maxHeight = '0';\r\n      content.style.opacity = '0';\r\n      trigger.setAttribute('aria-expanded', 'false');\r\n      item.classList.remove('is-active-accordion');\r\n      content.classList.remove('is-active-accordion');\r\n      if (arrow) arrow.classList.remove('is-active-accordion');\r\n      if (plus) plus.classList.remove('is-active-accordion');\r\n    });\r\n\r\n    content.addEventListener('transitionend', () => {\r\n      if (!item.classList.contains('is-active-accordion')) {\r\n        content.style.visibility = 'hidden';\r\n        content.style.display = 'none';\r\n      }\r\n    }, { once: true });\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize PBAccordion if accordion elements exist on the page\r\n */\r\nexport const initPBAccordion = () => {\r\n  if (document.querySelector('[pb-component=\"accordion\"]')) {\r\n    return new PBAccordion();\r\n  }\r\n  return null;\r\n}; ", "/**\r\n * UTM Parameter Transfer Utility\r\n * \r\n * This utility automatically adds the current URL's query parameters (UTM and others)\r\n * to all links on a page when they are clicked.\r\n * \r\n * Configuration via window.osConfig.utmTransfer = {\r\n *   enabled: true,                 // Whether to enable UTM transfer\r\n *   applyToExternalLinks: false,   // Whether to apply to external links\r\n *   excludedDomains: [],           // Domains to exclude from parameter transfer\r\n *   paramsToCopy: []               // Specific params to copy (empty = all params)\r\n * }\r\n */\r\n\r\nclass UtmTransfer {\r\n  constructor() {\r\n    this.config = {\r\n      enabled: true,\r\n      applyToExternalLinks: false,\r\n      excludedDomains: [],\r\n      paramsToCopy: []\r\n    };\r\n    \r\n    // Load configuration\r\n    this.loadConfig();\r\n  }\r\n  \r\n  loadConfig() {\r\n    if (window.osConfig && window.osConfig.utmTransfer) {\r\n      this.config = {\r\n        ...this.config,\r\n        ...window.osConfig.utmTransfer\r\n      };\r\n    }\r\n    \r\n    // Ensure paramsToCopy is valid\r\n    if (this.config.paramsToCopy === null || this.config.paramsToCopy === undefined) {\r\n      this.config.paramsToCopy = [];\r\n    }\r\n    \r\n    console.log('UTM Transfer: Initialized with config', JSON.stringify(this.config));\r\n  }\r\n  \r\n  // Initialize the UTM transfer feature\r\n  init() {\r\n    if (!this.config.enabled) {\r\n      console.log('UTM Transfer: Disabled by configuration');\r\n      return;\r\n    }\r\n    \r\n    // Get current URL search parameters\r\n    const currentParams = new URLSearchParams(window.location.search);\r\n    \r\n    // Skip if no parameters exist\r\n    if (currentParams.toString() === '') {\r\n      console.log('UTM Transfer: No URL parameters to transfer');\r\n      return;\r\n    }\r\n    \r\n    // Log all available parameters\r\n    const availableParams = [];\r\n    currentParams.forEach((value, key) => {\r\n      availableParams.push(`${key}=${value}`);\r\n    });\r\n    console.log(`UTM Transfer: Available parameters: ${availableParams.join(', ')}`);\r\n    \r\n    // Filter parameters if specific ones are specified\r\n    let paramsToApply = currentParams;\r\n    \r\n    // Only filter if paramsToCopy is explicitly provided and has items\r\n    if (Array.isArray(this.config.paramsToCopy) && this.config.paramsToCopy.length > 0) {\r\n      console.log(`UTM Transfer: Filtering to specific parameters: ${this.config.paramsToCopy.join(', ')}`);\r\n      \r\n      paramsToApply = new URLSearchParams();\r\n      this.config.paramsToCopy.forEach(param => {\r\n        if (currentParams.has(param)) {\r\n          paramsToApply.append(param, currentParams.get(param));\r\n          console.log(`UTM Transfer: Found parameter to copy: ${param}=${currentParams.get(param)}`);\r\n        }\r\n      });\r\n      \r\n      // Skip if no matching parameters\r\n      if (paramsToApply.toString() === '') {\r\n        console.log('UTM Transfer: No matching parameters to transfer');\r\n        return;\r\n      }\r\n    } else {\r\n      console.log('UTM Transfer: No specific parameters configured, will copy all parameters');\r\n    }\r\n    \r\n    // Get all anchor elements on the page\r\n    const links = document.querySelectorAll('a');\r\n    console.log(`UTM Transfer: Found ${links.length} links on the page`);\r\n    \r\n    // For each link\r\n    links.forEach(link => {\r\n      // Add click event listener\r\n      link.addEventListener('click', event => {\r\n        this.applyParamsToLink(link, paramsToApply);\r\n      });\r\n    });\r\n    \r\n    console.log('UTM Transfer: Event listeners attached to links');\r\n  }\r\n  \r\n  // Apply parameters to a specific link\r\n  applyParamsToLink(linkElement, params = null) {\r\n    if (!linkElement || !linkElement.getAttribute) {\r\n      console.error('UTM Transfer: Invalid link element provided');\r\n      return;\r\n    }\r\n    \r\n    // Get the href attribute\r\n    let href = linkElement.getAttribute('href');\r\n    if (!href) return;\r\n    \r\n    // Skip special links\r\n    if (href.startsWith('#') || \r\n        href.startsWith('javascript:') || \r\n        href.startsWith('mailto:') || \r\n        href.startsWith('tel:')) {\r\n      return;\r\n    }\r\n    \r\n    // Handle external links\r\n    const isExternalLink = href.includes('://') && !href.includes(window.location.hostname);\r\n    if (isExternalLink) {\r\n      // Skip external links if not configured to apply to them\r\n      if (!this.config.applyToExternalLinks) {\r\n        return;\r\n      }\r\n      \r\n      // Check excluded domains\r\n      if (this.config.excludedDomains && this.config.excludedDomains.length > 0) {\r\n        for (const domain of this.config.excludedDomains) {\r\n          if (href.includes(domain)) {\r\n            return; // Skip excluded domains\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Use provided params or get current ones\r\n    const paramsToApply = params || new URLSearchParams(window.location.search);\r\n    if (paramsToApply.toString() === '') {\r\n      return; // No parameters to apply\r\n    }\r\n    \r\n    // Parse the link's URL\r\n    let url;\r\n    try {\r\n      // Handle relative URLs\r\n      url = new URL(href, window.location.origin);\r\n    } catch (e) {\r\n      console.error('UTM Transfer: Invalid URL:', href);\r\n      return;\r\n    }\r\n    \r\n    // Get existing parameters in the link\r\n    const linkParams = new URLSearchParams(url.search);\r\n    \r\n    // Add current page parameters, without overriding existing ones\r\n    paramsToApply.forEach((value, key) => {\r\n      if (!linkParams.has(key)) {\r\n        linkParams.append(key, value);\r\n      }\r\n    });\r\n    \r\n    // Update the link's search parameters\r\n    url.search = linkParams.toString();\r\n    \r\n    // Update the href attribute\r\n    linkElement.setAttribute('href', url.toString());\r\n    \r\n    // Log if in debug mode\r\n    if (this.config.debug) {\r\n      console.log(`UTM Transfer: Updated link ${href} to ${url.toString()}`);\r\n    }\r\n  }\r\n}\r\n\r\n// Export a function to initialize the UTM transfer\r\nexport const initUtmTransfer = () => {\r\n  const utmTransfer = new UtmTransfer();\r\n  utmTransfer.init();\r\n  \r\n  // Also expose for manual use\r\n  return utmTransfer;\r\n}; ", "/**\r\n * TwentyNineNext - Core class for 29next client\r\n * \r\n * This is a streamlined version focused primarily on checkout functionality.\r\n */\r\n\r\nimport { ApiClient } from '../api/ApiClient.js';\r\nimport { Logger } from '../utils/Logger.js';\r\nimport { CheckoutPage } from '../managers/CheckoutManager.js';\r\nimport { CampaignHelper } from '../helpers/CampaignHelper.js';\r\nimport { StateManager } from '../managers/StateManager.js';\r\nimport { CartManager } from '../managers/CartManager.js';\r\nimport { SelectorManager } from '../managers/SelectorManager.js';\r\nimport { ToggleManager } from '../managers/ToggleManager.js';\r\nimport { DebugManager } from '../managers/DebugManager.js';\r\nimport { TimerManager } from '../managers/TimerManager.js';\r\nimport { DisplayManager } from '../managers/DisplayManager.js';\r\nimport { CartDisplayManager } from '../managers/CartDisplayManager.js';\r\nimport { AttributionManager } from '../managers/AttributionManager.js';\r\nimport { EventManager } from '../managers/EventManager.js';\r\nimport { TooltipManager } from '../managers/TooltipManager.js';\r\nimport { UpsellManager } from '../managers/UpsellManager.js';\r\nimport { DiscountManager } from '../managers/DiscountManager.js';\r\nimport { initPBAccordion } from '../utils/PBAccordion.js';\r\nimport { initUtmTransfer } from '../utils/UtmTransfer.js';\r\n\r\nexport class TwentyNineNext {\r\n  #isInitialized = false;\r\n  #isCheckoutPage = false;\r\n  #campaignData = null;\r\n\r\n  constructor(options = {}) {\r\n    // Get Google Maps config from window.osConfig if available\r\n    const googleMapsConfig = window.osConfig?.googleMaps || {};\r\n    \r\n    this.options = {\r\n      debug: false,\r\n      autoInit: true,\r\n      googleMapsApiKey: googleMapsConfig.apiKey || 'YOUR_API_KEY_HERE',\r\n      googleMapsRegion: googleMapsConfig.region || 'US',\r\n      enableGoogleMapsAutocomplete: googleMapsConfig.enableAutocomplete !== false,\r\n      ...options\r\n    };\r\n    this.logger = new Logger(this.options.debug);\r\n    this.coreLogger = this.logger.createModuleLogger('CORE');\r\n    this.api = new ApiClient(this);\r\n    this.config = this.#loadConfig();\r\n    this.state = new StateManager(this);\r\n    this.attribution = new AttributionManager(this);\r\n    this.discount = new DiscountManager(this);\r\n    this.cart = new CartManager(this);\r\n    this.campaign = new CampaignHelper(this);\r\n    this.upsell = new UpsellManager(this);\r\n\r\n    // After all essential managers (especially discount) are instantiated,\r\n    // tell StateManager to perform its full initial calculation and update.\r\n    if (this.state && typeof this.state.finalizeInitializationAndRecalculate === 'function') {\r\n      this.state.finalizeInitializationAndRecalculate();\r\n    } else {\r\n      this.coreLogger.error('[TwentyNineNext Constructor] StateManager not ready or finalizeInitializationAndRecalculate not found!');\r\n    }\r\n\r\n    // Unified event system\r\n    this.events = {\r\n      on: (event, callback) => this.on(event, callback),\r\n      once: (event, callback) => this.once(event, callback),\r\n      off: (event, callback) => this.off(event, callback),\r\n      trigger: (event, data) => this.triggerEvent(event, data),\r\n    };\r\n\r\n    if (this.options.autoInit) this.init();\r\n  }\r\n\r\n  // Event Listeners using DOM events\r\n  on(event, callback) {\r\n    const wrappedCallback = (e) => {\r\n      try {\r\n        callback(e.detail);\r\n      } catch (error) {\r\n        this.coreLogger.error(`Error in event callback for \"${event}\":`, error);\r\n      }\r\n    };\r\n    document.addEventListener(`os:${event}`, wrappedCallback);\r\n    this.coreLogger.debug(`Event listener registered for \"${event}\"`);\r\n    return this;\r\n  }\r\n\r\n  once(event, callback) {\r\n    const wrappedCallback = (e) => {\r\n      try {\r\n        callback(e.detail);\r\n      } catch (error) {\r\n        this.coreLogger.error(`Error in one-time event callback for \"${event}\":`, error);\r\n      }\r\n      document.removeEventListener(`os:${event}`, wrappedCallback);\r\n    };\r\n    document.addEventListener(`os:${event}`, wrappedCallback);\r\n    this.coreLogger.debug(`One-time event listener registered for \"${event}\"`);\r\n    return this;\r\n  }\r\n\r\n  off(event, callback) {\r\n    document.removeEventListener(`os:${event}`, callback);\r\n    return this;\r\n  }\r\n\r\n  #loadConfig() {\r\n    const config = { apiKey: null, campaignId: null, debug: this.options.debug };\r\n    \r\n    // Check URL parameters for campaignId and store in sessionStorage if present\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const urlCampaignId = urlParams.get('campaignId');\r\n    if (urlCampaignId) {\r\n      this.coreLogger.info(`Found campaignId in URL: ${urlCampaignId}`);\r\n      sessionStorage.setItem('os-campaign-id', urlCampaignId);\r\n      config.apiKey = urlCampaignId;\r\n      config.campaignId = urlCampaignId;\r\n      this.coreLogger.info('Saved campaignId to session storage and using as API key');\r\n    } else {\r\n      // Check sessionStorage for stored campaignId to use as API key\r\n      const storedCampaignId = sessionStorage.getItem('os-campaign-id');\r\n      if (storedCampaignId) {\r\n        this.coreLogger.info(`Using campaign ID from session storage as API key: ${storedCampaignId}`);\r\n        config.apiKey = storedCampaignId;\r\n        config.campaignId = storedCampaignId;\r\n      } else {\r\n        // Fall back to meta tag for API key\r\n        const apiKeyMeta = document.querySelector('meta[name=\"os-api-key\"]');\r\n        config.apiKey = apiKeyMeta?.getAttribute('content') ?? null;\r\n        this.coreLogger.info(`API key from meta: ${config.apiKey ? '✓ Set' : '✗ Not set'}`);\r\n        \r\n        // Also check for campaign ID meta tag for reference\r\n        const campaignIdMeta = document.querySelector('meta[name=\"os-campaign-id\"]');\r\n        config.campaignId = campaignIdMeta?.getAttribute('content') ?? null;\r\n        this.coreLogger.info(`Campaign ID from meta: ${config.campaignId ? '✓ Set' : '✗ Not set'}`);\r\n      }\r\n    }\r\n\r\n    const debugMeta = document.querySelector('meta[name=\"os-debug\"]');\r\n    if (debugMeta?.getAttribute('content') === 'true') {\r\n      config.debug = true;\r\n      this.logger.setDebug(true);\r\n      this.coreLogger.info('Debug mode: ✓ Enabled');\r\n    }\r\n    \r\n    // Initialize the spreedly configuration if present\r\n    this.#initSpreedlyConfig();\r\n    \r\n    return config;\r\n  }\r\n  \r\n  /**\r\n   * Initialize Spreedly configuration from global config\r\n   * This allows users to customize Spreedly iframe behavior\r\n   */\r\n  #initSpreedlyConfig() {\r\n    // Ensure osConfig exists\r\n    window.osConfig = window.osConfig || {};\r\n    \r\n    // If spreedlyConfig doesn't exist, create it with defaults\r\n    if (!window.osConfig.spreedlyConfig) {\r\n      this.coreLogger.debug('Initializing default Spreedly configuration');\r\n      window.osConfig.spreedlyConfig = {\r\n        fieldType: {\r\n          number: 'text',\r\n          cvv: 'text'\r\n        },\r\n        numberFormat: 'prettyFormat',\r\n        placeholder: {\r\n          number: 'Credit Card Number',\r\n          cvv: 'CVV *'\r\n        },\r\n        labels: {\r\n          number: 'Card Number',\r\n          cvv: 'CVV'\r\n        }\r\n        // Other properties will use defaults from SpreedlyManager\r\n      };\r\n    } else {\r\n      this.coreLogger.info('Found custom Spreedly configuration');\r\n    }\r\n  }\r\n\r\n  async #loadGoogleMapsApi() {\r\n    // Skip loading if autocomplete is disabled\r\n    if (!this.options.enableGoogleMapsAutocomplete) {\r\n      this.coreLogger.debug('Google Maps Autocomplete is disabled in configuration');\r\n      return;\r\n    }\r\n    \r\n    if (typeof google !== 'undefined' && typeof google.maps !== 'undefined') {\r\n      this.coreLogger.debug('Google Maps API already loaded');\r\n      return;\r\n    }\r\n\r\n    this.coreLogger.debug('Loading Google Maps API...');\r\n    return new Promise((resolve) => {\r\n      const script = document.createElement('script');\r\n      const regionParam = this.options.googleMapsRegion ? `&region=${this.options.googleMapsRegion}` : '';\r\n      script.src = `https://maps.googleapis.com/maps/api/js?key=${this.options.googleMapsApiKey}&libraries=places${regionParam}`;\r\n      script.async = true;\r\n      script.defer = true;\r\n      script.onload = () => {\r\n        this.coreLogger.debug('Google Maps API loaded successfully');\r\n        resolve();\r\n      };\r\n      script.onerror = () => {\r\n        this.coreLogger.error('Failed to load Google Maps API');\r\n        resolve(); // Resolve to continue initialization\r\n      };\r\n      document.head.appendChild(script);\r\n    });\r\n  }\r\n\r\n  async init() {\r\n    this.coreLogger.info('Initializing 29next client (async init phase)');\r\n    this.api.init();\r\n\r\n    // Ensure window.on29NextReady is an array\r\n    if (typeof window.on29NextReady !== 'undefined' && !Array.isArray(window.on29NextReady)) {\r\n      this.coreLogger.warn('window.on29NextReady is not an array, resetting it');\r\n      window.on29NextReady = [];\r\n    }\r\n\r\n    await this.#fetchCampaignData();\r\n    await this.#loadGoogleMapsApi();\r\n    \r\n    // Initialize managers early\r\n    this.#initializeManagers();\r\n    \r\n    // Check for pending upsell purchases - needs to happen after EventManager is initialized\r\n    await this.#checkForPendingUpsellPurchase();\r\n    \r\n    this.#isCheckoutPage = this.#detectCheckoutPage();\r\n    if (this.#isCheckoutPage) this.#initCheckoutPage();\r\n\r\n    this.#initUIUtilities();\r\n    \r\n    // Check for pending purchase events AFTER EventManager is initialized\r\n    await this.#checkForPendingPurchaseEvents();\r\n\r\n    this.#isInitialized = true;\r\n    this.triggerEvent('initialized', { client: this });\r\n    await this.#finalizeInitialization();\r\n  }\r\n\r\n  async #fetchCampaignData() {\r\n    try {\r\n      this.coreLogger.info('Fetching campaign data...');\r\n      this.#campaignData = await this.api.getCampaign();\r\n      this.#campaignData = this.#campaignData || { packages: [] }; // Ensure packages array\r\n      this.#campaignData.packages = this.#campaignData.packages || [];\r\n      this.campaignData = this.#campaignData;\r\n\r\n      this.coreLogger.info('Campaign data retrieved successfully');\r\n      window.osConfig = window.osConfig || {};\r\n      window.osConfig.campaign = this.#campaignData;\r\n      window.dataLayer = window.dataLayer || [];\r\n      \r\n      // Set the funnel name using campaign data\r\n      if (this.#campaignData.name && this.attribution) {\r\n        // First check for meta tag (higher priority)\r\n        const funnelMetaTag = document.querySelector('meta[name=\"os-tracking-tag\"][data-tag-name=\"funnel_name\"]');\r\n        const funnelName = funnelMetaTag?.getAttribute('data-tag-value') || this.#campaignData.name;\r\n        \r\n        // Use our simplified method to set the funnel name\r\n        this.attribution.setFunnelName(funnelName);\r\n      }\r\n      \r\n      this.triggerEvent('campaign.loaded', { campaign: this.#campaignData });\r\n    } catch (error) {\r\n      this.coreLogger.error('Failed to retrieve campaign data:', error);\r\n      this.#campaignData = {\r\n        name: 'Default Campaign',\r\n        packages: [],\r\n        currency: 'USD',\r\n        locale: 'en-US',\r\n      };\r\n      this.campaignData = this.#campaignData;\r\n    }\r\n  }\r\n\r\n  #initializeManagers() {\r\n    this.selector = new SelectorManager(this);\r\n    this.toggle = new ToggleManager(this);\r\n    this.timer = new TimerManager(this);\r\n    this.display = new DisplayManager(this);\r\n    this.eventManager = new EventManager(this);\r\n    this.tooltip = new TooltipManager(this);\r\n\r\n    if (\r\n      this.#isCheckoutPage ||\r\n      document.querySelector('[data-os-cart=\"line-display\"]') ||\r\n      document.querySelector('[os-cart=\"checkout-summary\"]') ||\r\n      document.querySelector('[data-os-cart-summary=\"grand-total\"]')\r\n    ) {\r\n      this.coreLogger.info('Cart display elements detected, initializing CartDisplayManager');\r\n      this.cartDisplay = new CartDisplayManager(this);\r\n    }\r\n\r\n    this.debug = new DebugManager(this);\r\n\r\n    // Extend events with EventManager methods\r\n    Object.assign(this.events, {\r\n      emit: (event, data) => this.triggerEvent(event, data),\r\n      viewItemList: (data) => this.eventManager.viewItemList(data || this.#campaignData),\r\n      viewItem: (packageData) => this.eventManager.viewItem(packageData),\r\n      addToCart: (cartData) => this.eventManager.addToCart(cartData),\r\n      beginCheckout: () => this.eventManager.beginCheckout(),\r\n      purchase: (orderData, force) => this.eventManager.purchase(orderData, force),\r\n      fireCustomEvent: (eventName, eventData) => this.eventManager.fireCustomEvent(eventName, eventData),\r\n    });\r\n  }\r\n\r\n  async #finalizeInitialization() {\r\n    // Let SelectorManager handle view_item_list event\r\n    // The #triggerViewItemList method in SelectorManager is now responsible for this\r\n    await new Promise((resolve) => setTimeout(resolve, 800)); // Single delay for rendering\r\n    this.#hidePreloader();\r\n  }\r\n\r\n  #hidePreloader() {\r\n    const preloader = document.querySelector('div[os-element=\"preloader\"]');\r\n    if (preloader) {\r\n      this.coreLogger.info('Hiding preloader element');\r\n      preloader.style.transition = 'opacity 0.5s ease';\r\n      preloader.style.opacity = '0';\r\n      preloader.style.pointerEvents = 'none';\r\n      this.coreLogger.debug('Preloader hidden');\r\n    }\r\n  }\r\n\r\n  #detectCheckoutPage() {\r\n    const pageTypeMeta = document.querySelector('meta[name=\"os-page-type\"]');\r\n    const pageType = pageTypeMeta?.getAttribute('content');\r\n    if (pageType === 'checkout' || (!pageType && document.querySelector('form[os-checkout=\"form\"]'))) {\r\n      this.coreLogger.info('Checkout page detected');\r\n      return true;\r\n    }\r\n    if (pageType === 'receipt') {\r\n      this.coreLogger.info('Receipt page detected');\r\n      this.#initReceiptPage();\r\n    }\r\n    if (pageType === 'upsell' || document.querySelector('[data-os-upsell]')) {\r\n      this.coreLogger.info('Upsell page detected');\r\n      this.#initUpsellPage();\r\n    }\r\n    return false;\r\n  }\r\n\r\n  #initCheckoutPage() {\r\n    this.checkout = new CheckoutPage(this.api, this.coreLogger, this);\r\n  }\r\n\r\n  #initReceiptPage() {\r\n    import('../managers/ReceiptManager.js')\r\n      .then((module) => {\r\n        const ReceiptPage = module.ReceiptPage;\r\n        this.receipt = new ReceiptPage(this.api, this.coreLogger, this);\r\n        this.coreLogger.info('Receipt page initialized');\r\n        \r\n        // No need to trigger order.loaded here anymore as it's handled globally\r\n        // by the checkForPendingPurchaseEvents method\r\n      })\r\n      .catch((error) => this.coreLogger.error('Failed to load ReceiptPage module:', error));\r\n  }\r\n\r\n  #initUpsellPage() {\r\n    this.coreLogger.info('Initializing upsell page');\r\n    \r\n    // Make sure the UpsellManager is initialized and available\r\n    if (!this.upsell) {\r\n      this.upsell = new UpsellManager(this);\r\n      this.coreLogger.info('UpsellManager initialized for upsell page');\r\n    }\r\n    \r\n    // Trigger upsell page events\r\n    this.triggerEvent('upsell.pageview', {\r\n      ref_id: new URLSearchParams(window.location.search).get('ref_id') || sessionStorage.getItem('order_ref_id')\r\n    });\r\n    \r\n    // Check if we have a pending upsell purchase from previous page\r\n    const hasPendingUpsell = sessionStorage.getItem('pending_upsell_purchase') === 'true';\r\n    if (hasPendingUpsell) {\r\n      this.coreLogger.info('Found pending upsell purchase, will be tracked by UpsellManager');\r\n    }\r\n  }\r\n\r\n  #initUIUtilities() {\r\n    this.coreLogger.info('Initializing UI utilities');\r\n    try {\r\n      const accordion = initPBAccordion();\r\n      if (accordion) {\r\n        this.pbAccordion = accordion;\r\n        this.coreLogger.info('PBAccordion initialized');\r\n      }\r\n    } catch (error) {\r\n      this.coreLogger.error('Failed to initialize PBAccordion:', error);\r\n    }\r\n    try {\r\n      const utmTransfer = initUtmTransfer();\r\n      if (utmTransfer) {\r\n        this.utmTransfer = utmTransfer;\r\n        this.coreLogger.info('UTM parameter transfer initialized');\r\n      }\r\n    } catch (error) {\r\n      this.coreLogger.error('Failed to initialize UTM transfer:', error);\r\n    }\r\n  }\r\n\r\n  triggerEvent(eventName, detail = {}) {\r\n    this.coreLogger.debug(`Triggering event: ${eventName}`);\r\n    const eventData = { ...detail, timestamp: Date.now(), client: this };\r\n    \r\n    // Debug log to see exact content of event data\r\n    if (eventName === 'order.loaded') {\r\n      this.coreLogger.debug('Event data for order.loaded:', JSON.stringify(eventData, null, 2));\r\n    }\r\n    \r\n    const event = new CustomEvent(`os:${eventName}`, { bubbles: true, cancelable: true, detail: eventData });\r\n    document.dispatchEvent(event);\r\n    return event;\r\n  }\r\n\r\n  getCampaignData() {\r\n    return this.#campaignData;\r\n  }\r\n\r\n  get isInitialized() {\r\n    return this.#isInitialized;\r\n  }\r\n\r\n  get isCheckoutPage() {\r\n    return this.#isCheckoutPage;\r\n  }\r\n\r\n  debugTriggerViewItemList() {\r\n    console.log('🛠️ Manually triggering view_item_list event');\r\n    if (!this.#campaignData) {\r\n      console.error('❌ No campaign data available');\r\n      return { success: false, message: 'No campaign data' };\r\n    }\r\n    if (!this.events.viewItemList) {\r\n      console.error('❌ events.viewItemList not available');\r\n      return { success: false, message: 'Event manager not initialized' };\r\n    }\r\n    window.dataLayer = window.dataLayer || [];\r\n    window.dataLayer.push({ ecommerce: null });\r\n    this.events.viewItemList(this.#campaignData);\r\n    console.log('✅ view_item_list manually triggered');\r\n    return { success: true, message: 'view_item_list event triggered', campaignData: this.#campaignData };\r\n  }\r\n\r\n  isReady() {\r\n    return this.#isInitialized && this.#campaignData !== null && Array.isArray(this.#campaignData.packages);\r\n  }\r\n\r\n  onReady(callback) {\r\n    if (!callback || typeof callback !== 'function') return this;\r\n    if (this.isReady()) {\r\n      try {\r\n        callback(this);\r\n      } catch (error) {\r\n        this.coreLogger.error('Error in onReady callback:', error);\r\n      }\r\n    } else {\r\n      this.once('initialized', () => {\r\n        if (this.isReady()) callback(this);\r\n      });\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Check for pending purchase events for orders with ref_id in URL\r\n   */\r\n  async #checkForPendingPurchaseEvents() {\r\n    const refId = new URLSearchParams(window.location.search).get('ref_id');\r\n    if (!refId) return;\r\n    \r\n    this.coreLogger.debug(`Checking for pending purchase events for ref_id: ${refId}`);\r\n    \r\n    // Check if this order has a pending purchase event\r\n    const hasPendingEvent = sessionStorage.getItem(`pending_purchase_event_${refId}`) === 'true';\r\n    \r\n    if (hasPendingEvent) {\r\n      this.coreLogger.info(`Found pending purchase event for order ${refId}`);\r\n      \r\n      // Check if EventManager is initialized before proceeding\r\n      const isEventManagerReady = this.eventManager && this.eventManager.isInitialized;\r\n      this.coreLogger.debug(`EventManager ready: ${isEventManagerReady}`);\r\n      \r\n      if (!isEventManagerReady) {\r\n        this.coreLogger.warn('EventManager not ready yet, will not trigger order.loaded event');\r\n        return;\r\n      }\r\n      \r\n      try {\r\n        const orderData = await this.api.getOrder(refId);\r\n        if (orderData) {\r\n          // Fix: Use the proper data structure expected by EventManager\r\n          // EventManager expects data.order, not data.detail.order\r\n          this.coreLogger.info(`Triggering order.loaded event for pending purchase ${refId}`);\r\n          this.triggerEvent('order.loaded', { order: orderData });\r\n          this.coreLogger.info(`Triggered order.loaded event for pending purchase ${refId}`);\r\n          \r\n          // Clear the pending flag\r\n          sessionStorage.removeItem(`pending_purchase_event_${refId}`);\r\n          this.coreLogger.debug(`Removed pending purchase flag for order ${refId}`);\r\n        } else {\r\n          this.coreLogger.warn(`Could not fetch order data for pending purchase ${refId}`);\r\n        }\r\n      } catch (error) {\r\n        this.coreLogger.error(`Failed to load order data for pending purchase ${refId}:`, error);\r\n      }\r\n    } else {\r\n      this.coreLogger.debug(`No pending purchase event for order ${refId}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check for pending upsell purchases and track them\r\n   * This runs on EVERY page load regardless of page type\r\n   */\r\n  async #checkForPendingUpsellPurchase() {\r\n    try {\r\n      const hasPendingUpsell = sessionStorage.getItem('pending_upsell_purchase') === 'true';\r\n      \r\n      if (hasPendingUpsell) {\r\n        this.coreLogger.info('Found pending upsell purchase, processing tracking event');\r\n        \r\n        const upsellPurchaseData = sessionStorage.getItem('upsell_purchase_data');\r\n        if (upsellPurchaseData) {\r\n          // Parse the stored upsell purchase data\r\n          const purchaseData = JSON.parse(upsellPurchaseData);\r\n          \r\n          // Send the purchase event through EventManager\r\n          if (this.eventManager && typeof this.eventManager.purchase === 'function') {\r\n            this.coreLogger.info('Triggering purchase event for upsell', purchaseData);\r\n            // Force the purchase event to ensure it's tracked even if the main order was already tracked\r\n            this.eventManager.purchase(purchaseData, true);\r\n            \r\n            // Also fire a custom os_accepted_upsell event for additional tracking\r\n            if (typeof this.eventManager.fireCustomEvent === 'function') {\r\n              // Create the custom event data\r\n              const customEventData = {\r\n                transaction_id: purchaseData.number,\r\n                ref_id: purchaseData.ref_id,\r\n                product_id: purchaseData.lines[0]?.product_id,\r\n                product_name: purchaseData.lines[0]?.product_title,\r\n                price: purchaseData.lines[0]?.price,\r\n                quantity: purchaseData.lines[0]?.quantity,\r\n                total: purchaseData.total,\r\n                currency: purchaseData.currency\r\n              };\r\n              \r\n              this.coreLogger.info('Triggering os_accepted_upsell custom event', customEventData);\r\n              this.eventManager.fireCustomEvent('os_accepted_upsell', customEventData);\r\n            }\r\n          } else if (this.events && typeof this.events.purchase === 'function') {\r\n            this.coreLogger.info('Triggering purchase event for upsell via events API', purchaseData);\r\n            this.events.purchase(purchaseData, true);\r\n            \r\n            // Also fire a custom os_accepted_upsell event\r\n            if (typeof this.events.fireCustomEvent === 'function') {\r\n              // Create the custom event data\r\n              const customEventData = {\r\n                transaction_id: purchaseData.number,\r\n                ref_id: purchaseData.ref_id,\r\n                product_id: purchaseData.lines[0]?.product_id,\r\n                product_name: purchaseData.lines[0]?.product_title,\r\n                price: purchaseData.lines[0]?.price,\r\n                quantity: purchaseData.lines[0]?.quantity,\r\n                total: purchaseData.total,\r\n                currency: purchaseData.currency\r\n              };\r\n              \r\n              this.coreLogger.info('Triggering os_accepted_upsell custom event via events API', customEventData);\r\n              this.events.fireCustomEvent('os_accepted_upsell', customEventData);\r\n            }\r\n          } else {\r\n            this.coreLogger.warn('No method available to track upsell purchase');\r\n          }\r\n        }\r\n        \r\n        // Clear the pending upsell purchase flag regardless of tracking success\r\n        sessionStorage.removeItem('pending_upsell_purchase');\r\n        sessionStorage.removeItem('upsell_purchase_data');\r\n        this.coreLogger.debug('Cleared pending upsell purchase data');\r\n      }\r\n    } catch (error) {\r\n      this.coreLogger.error('Error checking for pending upsell purchase:', error);\r\n    }\r\n  }\r\n}"],
  "mappings": "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",
  "names": ["init_NavigationPrevention", "__esmMin", "ReceiptManager_exports", "__export", "ReceiptPage", "_apiClient", "_logger", "_app", "_orderData", "_orderFetched", "_initialized", "_debugMode", "_safeLog", "safeLog_fn", "_fetchOrderDetails", "fetchOrderDetails_fn", "_updateReceiptContent", "updateReceiptContent_fn", "_determinePaymentMethod", "determinePaymentMethod_fn", "_updateOrderLines", "updateOrderLines_fn", "_updateElement", "updateElement_fn", "_updateElementInNode", "updateElementInNode_fn", "_formatAddress", "formatAddress_fn", "_formatLocation", "formatLocation_fn", "_getCountryName", "getCountryName_fn", "_formatPaymentMethod", "formatPaymentMethod_fn", "_formatCurrency", "formatCurrency_fn", "_showError", "showError_fn", "init_ReceiptManager", "__esmMin", "init_NavigationPrevention", "apiClient", "logger", "app", "__privateAdd", "__privateSet", "debugMeta", "__privateMethod", "__privateGet", "refId", "error", "level", "message", "args", "paymentMethod", "shippingMethod", "shippingPrice", "shippingContainer", "taxContainer", "totalTax", "total", "orderLinesContainer", "lineTemplate", "template", "line", "lineElement", "newLine", "productTitle", "originalPrice", "currentPrice", "savingsPercent", "savingElement", "compareElement", "price", "attribute", "value", "elements", "element", "node", "address", "formattedAddress", "parts", "countryCode", "method", "amount", "currency", "numericAmount", "container", "errorElement", "src_exports", "__export", "TwentyNineNext", "_app", "_apiKey", "_campaignId", "_baseUrl", "_logger", "_checkForCampaignIdInUrl", "checkForCampaignIdInUrl_fn", "_getCampaignId", "getCampaignId_fn", "_buildUrl", "buildUrl_fn", "_request", "request_fn", "_getAttributionData", "getAttributionData_fn", "ApiClient", "app", "__privateAdd", "__privateSet", "__privateGet", "__privateMethod", "apiKeyMeta", "proxyUrl", "campaignsData", "error", "price", "cartData", "response", "orderData", "firstVoucher", "voucher", "orderRef", "upsellData", "formattedData", "refId", "nextPageMeta", "nextPagePath", "redirectUrl", "paymentMethod", "paymentMethodMap", "nextPageUrl", "currentUrl", "orderResponse", "campaignId", "storedCampaignId", "metaCampaignId", "endpoint", "cleanEndpoint", "method", "data", "url", "options", "errorData", "responseData", "apiFormatted", "_debug", "_prefix", "_startupTime", "_info", "info_fn", "_warn", "warn_fn", "_error", "error_fn", "_debugLog", "debugLog_fn", "_infoWithTime", "infoWithTime_fn", "_warnWithTime", "warnWithTime_fn", "_errorWithTime", "errorWithTime_fn", "_debugLogWithTime", "debugLogWithTime_fn", "Logger", "debug", "__privateAdd", "__privateSet", "__privateGet", "moduleName", "modulePrefix", "args", "__privateMethod", "message", "diff", "prefix", "_form", "_logger", "_addressConfig", "_countries", "_states", "_elements", "_init", "init_fn", "_getAddressConfig", "getAddressConfig_fn", "_initCountrySelect", "initCountrySelect_fn", "_setupCountryChangeListeners", "setupCountryChangeListeners_fn", "_updateStateSelect", "updateStateSelect_fn", "_populateStateSelect", "populateStateSelect_fn", "_loadCachedData", "loadCachedData_fn", "_saveCache", "saveCache_fn", "_loadCountriesAndStates", "loadCountriesAndStates_fn", "_loadStates", "loadStates_fn", "_detectUserCountry", "detectUserCountry_fn", "_setupAutocompleteDetection", "setupAutocompleteDetection_fn", "_preloadCommonStates", "preloadCommonStates_fn", "AddressHandler", "form", "logger", "__privateAdd", "__privateSet", "__privateMethod", "__privateGet", "c", "s", "countrySelect", "stateSelect", "country", "state", "countryCode", "isPriority", "states", "currentValue", "o", "loadCache", "key", "data", "a", "b", "error", "u", "r", "fields", "observer", "mutations", "m", "f", "countries", "_logger", "_form", "_validationErrors", "_debugMode", "_spreedlyEnabled", "_spreedlyFieldsValid", "_spreedlyReady", "_getFormElement", "getFormElement_fn", "_safeLog", "safeLog_fn", "_setupListeners", "setupListeners_fn", "_setupSpreedlyListeners", "setupSpreedlyListeners_fn", "_getSpreedlyFieldErrorMessage", "getSpreedlyFieldErrorMessage_fn", "_handleSpreedlyError", "handleSpreedlyError_fn", "_handleSubmit", "handleSubmit_fn", "_logValidationStart", "logValidationStart_fn", "_validateFields", "validateFields_fn", "_shouldSkipField", "shouldSkipField_fn", "_validateCreditCardExpiryFields", "validateCreditCardExpiryFields_fn", "_getExpiryFields", "getExpiryFields_fn", "_validateExpiryField", "validateExpiryField_fn", "_clearSpreedlyErrors", "clearSpreedlyErrors_fn", "_validateField", "validateField_fn", "_getReadableFieldLabel", "getReadableFieldLabel_fn", "_getFieldValidation", "getFieldValidation_fn", "_validateCity", "validateCity_fn", "_validateZipCode", "validateZipCode_fn", "_showError", "showError_fn", "_getOrCreateErrorElement", "getOrCreateErrorElement_fn", "_scrollToError", "scrollToError_fn", "_isValidEmail", "isValidEmail_fn", "_validatePhoneFields", "validatePhoneFields_fn", "_setupZipCodeFormatting", "setupZipCodeFormatting_fn", "_formatZipCode", "formatZipCode_fn", "FormValidator", "options", "__privateAdd", "__privateSet", "__privateMethod", "__privateGet", "selectedPaymentMethod", "isCreditCard", "isValid", "requiredFields", "firstErrorField", "ccValid", "phoneError", "field", "fieldName", "spreedlyId", "spreedlyContainer", "el", "checkbox", "values", "parent", "child", "monthField", "yearField", "numberContainer", "cvvContainer", "numberValid", "cvvValid", "ccNumber", "cvv", "form", "level", "message", "args", "error", "token", "pmData", "result", "errorMessage", "errors", "name", "event", "activeElement", "inputData", "handler", "fieldType", "fieldMap", "container", "method", "fields", "label", "monthSelectors", "yearSelectors", "type", "id", "value", "validation", "fallbackLabel", "tag", "input", "wrapper", "errorElement", "element", "email", "phoneFields", "hasError", "errorCode", "e", "cursorPos", "oldValue", "cleaned", "firstPart", "secondPart", "first", "second", "posAdjust", "_environmentKey", "_debugMode", "_isReady", "_onReadyCallback", "_onErrorCallback", "_onPaymentMethodCallback", "_onValidationCallback", "_config", "_app", "_loadConfig", "loadConfig_fn", "_initialize", "initialize_fn", "_loadScript", "loadScript_fn", "_setupSpreedly", "setupSpreedly_fn", "_applySpreedlyConfig", "applySpreedlyConfig_fn", "_prepareHtmlStructure", "prepareHtmlStructure_fn", "_setupEventListeners", "setupEventListeners_fn", "_showErrors", "showErrors_fn", "_clearFieldError", "clearFieldError_fn", "_log", "log_fn", "SpreedlyManager", "environmentKey", "options", "__privateAdd", "__privateSet", "__privateMethod", "monthField", "yearField", "monthError", "yearError", "cardData", "errors", "__privateGet", "e", "error", "callback", "resolve", "reject", "script", "numberField", "cvvField", "errorMessages", "token", "pmData", "result", "fieldType", "field", "wrapper", "errorElement", "level", "message", "data", "prefix", "_konamiCodeSequence", "_konamiCodePosition", "_indicatorTimeout", "_indicator", "_logger", "_callback", "_createIndicator", "createIndicator_fn", "_initListener", "initListener_fn", "KonamiCodeHandler", "callback", "logger", "__privateAdd", "__privateSet", "__privateMethod", "__privateGet", "state", "getPackageIdFromUrl", "getCartLines", "cartItems", "packageId", "lines", "shippingMethodObject", "shippingMethodId", "error", "messageElement", "__privateWrapper", "_apiClient", "_logger", "_app", "_form", "_spreedlyManager", "_formValidator", "_paymentMethod", "_isProcessing", "_debugMode", "_testCards", "_expressCheckoutButtons", "_deviceSupport", "_getCheckoutForm", "getCheckoutForm_fn", "_setupFormPrevention", "setupFormPrevention_fn", "_preventFormSubmission", "preventFormSubmission_fn", "_convertSubmitButtons", "convertSubmitButtons_fn", "_setupCheckoutButton", "setupCheckoutButton_fn", "_safeLog", "safeLog_fn", "_initPaymentMethods", "initPaymentMethods_fn", "_setupPaymentMethodListeners", "setupPaymentMethodListeners_fn", "_initSpreedly", "initSpreedly_fn", "_setupSpreedlyCallbacks", "setupSpreedlyCallbacks_fn", "_formatSpreedlyErrors", "formatSpreedlyErrors_fn", "_initializeExpirationFields", "initializeExpirationFields_fn", "_getExpirationElements", "getExpirationElements_fn", "_populateExpirationOptions", "populateExpirationOptions_fn", "_isTestMode", "isTestMode_fn", "_enforceFormPrevention", "enforceFormPrevention_fn", "_showProcessingState", "showProcessingState_fn", "_hideProcessingState", "hideProcessingState_fn", "_processCreditCard", "processCreditCard_fn", "_getCreditCardFields", "getCreditCardFields_fn", "_isDebugTestCardMode", "isDebugTestCardMode_fn", "_processTestCard", "processTestCard_fn", "_processPaypal", "processPaypal_fn", "_getPackageIdFromUrl", "getPackageIdFromUrl_fn", "_getOrderData", "getOrderData_fn", "_getAddressData", "getAddressData_fn", "_formatAddress", "formatAddress_fn", "_getShippingMethod", "getShippingMethod_fn", "_getCartLines", "getCartLines_fn", "_createOrder", "createOrder_fn", "_formatOrderData", "formatOrderData_fn", "_formatErrorMessage", "formatErrorMessage_fn", "_formatErrorKey", "formatErrorKey_fn", "_formatPaymentErrorMessage", "formatPaymentErrorMessage_fn", "_handlePaymentError", "handlePaymentError_fn", "_displayCreditCardError", "displayCreditCardError_fn", "_clearPaymentErrors", "clearPaymentErrors_fn", "_handleOrderSuccess", "handleOrderSuccess_fn", "_getRedirectUrl", "getRedirectUrl_fn", "_initExpressCheckout", "initExpressCheckout_fn", "_detectDeviceSupport", "detectDeviceSupport_fn", "_hasActiveExpressButtons", "hasActiveExpressButtons_fn", "_setExpressButtonProcessing", "setExpressButtonProcessing_fn", "_handleExpressCheckoutError", "handleExpressCheckoutError_fn", "_checkForPaymentFailedParameters", "checkForPaymentFailedParameters_fn", "_displayTopBannerError", "displayTopBannerError_fn", "PaymentHandler", "apiClient", "logger", "app", "__privateAdd", "__privateSet", "__privateMethod", "__privateGet", "FormValidator", "KonamiCodeHandler", "isKonamiMode", "orderData", "error", "method", "button", "cart", "item", "nextPageUrl", "currentUrl", "voucher", "response", "form", "hiddenInput", "index", "e", "checkoutButton", "newButton", "level", "message", "args", "paymentMethodSelector", "radioButtons", "handler", "radio", "environmentKey", "SpreedlyManager", "errors", "errorMessage", "token", "pmData", "errorMap", "key", "value", "monthSelect", "yearSelect", "monthSelectors", "yearSelectors", "i", "month", "currentYear", "year", "btn", "submitButton", "fullName", "isDifferentBilling", "firstName", "lastName", "capitalize", "str", "params", "cardNumber", "id", "shippingData", "billingData", "shippingAddress", "billingAddress", "state", "fields", "data", "field", "refId", "items", "packageId", "lineItem", "formattedOrderData", "formatted", "errorData", "k", "v", "generalErrorMessage", "txt", "errorCode", "errorDetails", "spreedlyErrorContainer", "errorMessageElement", "errorContainer", "fieldSelector", "fieldId", "fieldSelectors", "s", "idSelectors", "selector", "container", "errorElement", "firstErrorField", "redirectUrl", "metaUrl", "url", "paypalButton", "applePayButton", "applePayBtn", "googlePayButton", "googlePayBtn", "isProcessing", "loadingSpinner", "urlParams", "paymentMethod", "newUrl", "errorBanner", "messageDiv", "closeButton", "checkoutForm", "checkoutContainer", "mainContent", "_app", "_logger", "_sameAsShippingCheckbox", "_billingFormContainer", "_shippingFields", "_billingFields", "_fieldMap", "_isTransitioning", "_lastState", "_billingLocationComponent", "_billingAddress1Field", "_init", "init_fn", "_logDebug", "logDebug_fn", "_logInfo", "logInfo_fn", "_logWarn", "logWarn_fn", "_logError", "logError_fn", "_setupBillingLocationVisibility", "setupBillingLocationVisibility_fn", "_cacheFieldElements", "cacheFieldElements_fn", "_setupEventListeners", "setupEventListeners_fn", "_setupBillingAddressAutocompleteDetection", "setupBillingAddressAutocompleteDetection_fn", "_showBillingLocationComponent", "showBillingLocationComponent_fn", "_toggleBillingForm", "toggleBillingForm_fn", "_updateBillingFormVisibility", "updateBillingFormVisibility_fn", "BillingAddressHandler", "app", "__privateAdd", "__privateSet", "__privateMethod", "__privateGet", "shippingField", "shippingElement", "billingFieldName", "billingElement", "error", "billingData", "fieldName", "element", "apiFieldName", "isSame", "allCheckboxes", "checkbox", "index", "message", "args", "billingField", "mutations", "mutation", "e", "isChecked", "animate", "handleTransitionEnd", "targetHeight", "_logger", "_container", "_radioInputs", "_forms", "_activeTransitions", "_currentMode", "_init", "init_fn", "_setPaymentMode", "setPaymentMode_fn", "PaymentSelector", "logger", "__privateAdd", "__privateSet", "__privateGet", "__privateMethod", "checkedRadio", "radio", "e", "mode", "animate", "creditHeader", "paypalHeader", "form", "isSelected", "oldHandler", "currentHeight", "transitionEndHandler", "_logger", "_fieldsShown", "_elements", "_enableAutocomplete", "_init", "init_fn", "_hideLocationFields", "hideLocationFields_fn", "_showLocationFields", "showLocationFields_fn", "_isGoogleMapsAvailable", "isGoogleMapsAvailable_fn", "_initAutocompleteWithRetry", "initAutocompleteWithRetry_fn", "_initializeAutocomplete", "initializeAutocomplete_fn", "_setupAutocomplete", "setupAutocomplete_fn", "_setStateWithRetry", "setStateWithRetry_fn", "_setupBasicFieldListeners", "setupBasicFieldListeners_fn", "_setupAutofillDetection", "setupAutofillDetection_fn", "AddressAutocomplete", "logger", "options", "__privateAdd", "__privateSet", "__privateGet", "__privateMethod", "el", "attempt", "resolve", "shipping", "billing", "fields", "input", "autocomplete", "place", "components", "countryCode", "e", "error", "stateSelect", "stateCode", "opt", "field", "style", "_logger", "_intlTelInputAvailable", "_loadIntlTelInput", "loadIntlTelInput_fn", "_initPhoneInputs", "initPhoneInputs_fn", "_initializePhoneInput", "initializePhoneInput_fn", "_showError", "showError_fn", "_clearError", "clearError_fn", "_getNumberTypeName", "getNumberTypeName_fn", "_setupPhoneInputSync", "setupPhoneInputSync_fn", "_setupPhoneValidation", "setupPhoneValidation_fn", "PhoneInputHandler", "logger", "__privateAdd", "__privateSet", "__privateGet", "__privateMethod", "resources", "tag", "attrs", "element", "resolve", "phoneInputs", "input", "i", "index", "iti", "number", "numericValue", "formattedNumber", "cursorPos", "oldLength", "cursorOffset", "isValid", "numberType", "validationError", "error", "message", "itiContainer", "wrapper", "errorElement", "type", "fieldAttr", "countrySelect", "_app", "_logger", "_initialized", "_cartCreated", "_cartAttempted", "_beginCheckoutFired", "_debounceTimeout", "_debounceDelay", "_lastFormData", "_selectors", "_fields", "_emailRegex", "_init", "init_fn", "_findFormFields", "findFormFields_fn", "_attachEventListeners", "attachEventListeners_fn", "_handleFieldChange", "handleFieldChange_fn", "_checkAndFireBeginCheckout", "checkAndFireBeginCheckout_fn", "_checkAndCreateCart", "checkAndCreateCart_fn", "_hasMinimumRequiredFields", "hasMinimumRequiredFields_fn", "_getFormData", "getFormData_fn", "_isSameFormData", "isSameFormData_fn", "_createProspectCart", "createProspectCart_fn", "_updateUserState", "updateUserState_fn", "_isAddressValid", "isAddressValid_fn", "_getValidAddressData", "getValidAddressData_fn", "_isValidPostalCode", "isValidPostalCode_fn", "_getPhoneNumber", "getPhoneNumber_fn", "_createCartViaApi", "createCartViaApi_fn", "ProspectCartHandler", "app", "__privateAdd", "__privateSet", "__privateGet", "message", "data", "__privateMethod", "field", "altSelector", "form", "hasEmail", "hasName", "currentFormData", "hasFirstName", "hasLastName", "data1", "data2", "cartData", "attributionData", "firstName", "lastName", "email", "phone", "prospectCartData", "item", "lineItem", "addressData", "currentUser", "updatedUser", "error", "address", "country", "postalCode", "number", "value", "response", "_app", "_logger", "_container", "_shippingMethods", "_findShippingMethods", "findShippingMethods_fn", "_init", "init_fn", "_handleShippingChange", "handleShippingChange_fn", "_syncWithCartState", "syncWithCartState_fn", "ShippingSelector", "app", "__privateAdd", "__privateSet", "__privateGet", "__privateMethod", "methods", "methodElement", "input", "method", "shippingMethodId", "error", "currentShippingId", "isSelected", "_apiClient", "_logger", "_form", "_app", "_konamiCodeHandler", "_initializeComponents", "initializeComponents_fn", "_initKonamiCodeHandler", "initKonamiCodeHandler_fn", "_triggerKonamiCodeEasterEgg", "triggerKonamiCodeEasterEgg_fn", "_initAddressHandler", "initAddressHandler_fn", "_initBillingAddressHandler", "initBillingAddressHandler_fn", "_initPaymentSelector", "initPaymentSelector_fn", "_initFormValidator", "initFormValidator_fn", "_initPaymentHandler", "initPaymentHandler_fn", "_initShippingSelector", "initShippingSelector_fn", "_initAddressAutocomplete", "initAddressAutocomplete_fn", "_initPhoneInputHandler", "initPhoneInputHandler_fn", "_initProspectCartHandler", "initProspectCartHandler_fn", "_injectBillingFormFields", "injectBillingFormFields_fn", "_setupEventListeners", "setupEventListeners_fn", "_handleSubmit", "handleSubmit_fn", "_disableSubmitButtons", "disableSubmitButtons_fn", "CheckoutPage", "apiClient", "logger", "app", "__privateAdd", "__privateSet", "__privateGet", "hiddenInput", "preventSerializationInput", "preventSubmit", "e", "__privateMethod", "error", "KonamiCodeHandler", "messageElement", "AddressHandler", "BillingAddressHandler", "PaymentSelector", "FormValidator", "PaymentHandler", "ShippingSelector", "googleMapsOptions", "AddressAutocomplete", "PhoneInputHandler", "ProspectCartHandler", "shippingForm", "billingContainer", "billingForm", "fieldMap", "field", "fieldAttr", "locationContainer", "allComponents", "comp", "data", "event", "submitButtons", "button", "index", "_app", "_logger", "_viewItemListFired", "CampaignHelper", "app", "__privateAdd", "__privateSet", "__privateGet", "productId", "product", "price", "error", "_app", "_logger", "_state", "_subscribers", "_initDefaultState", "initDefaultState_fn", "_loadState", "loadState_fn", "_saveState", "saveState_fn", "_notifySubscribers", "notifySubscribers_fn", "_processCartUpdates", "processCartUpdates_fn", "_updateItemAppliedDiscounts", "updateItemAppliedDiscounts_fn", "_recalculateCart", "recalculateCart_fn", "StateManager", "app", "__privateAdd", "__privateSet", "__privateMethod", "__privateGet", "path", "obj", "key", "value", "notify", "current", "parts", "parent", "finalPart", "i", "part", "callback", "_a", "error", "cb", "item", "packageData", "pkg", "itemPackageId", "inputQuantity", "finalItemData", "basePrice", "retailPrice", "existingItemIndex", "newItems", "cartItem", "index", "newQuantity", "itemId", "updates", "cart", "itemIndex", "updatedItems", "shippingMethod", "couponCode", "discountType", "discountValue", "applicableProductIds", "items", "couponDetails", "attribution", "email", "firstName", "lastName", "phone", "vouchers", "apiCart", "response", "savedState", "parsedState", "stateToSave", "subPath", "callbacks", "subValue", "changedPath", "subtotalPreDiscount", "acc", "shipping", "tax", "changedValue", "itemDiscountAmount", "itemBasePriceForDiscountCalc", "isItemApplicableForCoupon", "subtotal", "currentItems", "totalDiscountFromCoupon", "subtotalAfterDiscount", "retailSubtotal", "savings", "savingsPercentage", "recurringTotal", "finalTotal", "currency", "currencySymbol", "_app", "_stateManager", "_logger", "_cartElements", "_initCartUI", "initCartUI_fn", "_updateCartUI", "updateCartUI_fn", "_createCartItemElement", "createCartItemElement_fn", "_addToCart", "addToCart_fn", "_updateCartItemQuantity", "updateCartItemQuantity_fn", "_removeFromCart", "removeFromCart_fn", "CartManager", "app", "__privateAdd", "__privateSet", "__privateMethod", "__privateGet", "error", "item", "refId", "quantity", "packageData", "pkg", "itemId", "shippingMethodId", "campaignData", "selectedMethod", "method", "couponCode", "discountType", "discountValue", "applicableProductIds", "result", "button", "event", "cart", "element", "itemCount", "count", "formatPrice", "price", "updateElement", "selector", "value", "hideIfZero", "couponElement", "couponContainer", "isEmpty", "itemElement", "retailPrice", "total", "savings", "savingsHtml", "recurringHtml", "imageHtml", "_debugStylesInjected", "_isDebugMode", "_xrayEnabled", "_overlays", "DebugUtils", "urlParams", "__privateSet", "__privateGet", "enabled", "overlay", "styleElement", "element", "id", "type", "additionalInfo", "label", "labelText", "key", "value", "__privateAdd", "_app", "_logger", "_selectors", "_selectedItems", "_isDebugMode", "_initSelectors", "initSelectors_fn", "_initSelector", "initSelector_fn", "_initCard", "initCard_fn", "_handleClick", "handleClick_fn", "_selectItem", "selectItem_fn", "_updateCart", "updateCart_fn", "_addItemToCart", "addItemToCart_fn", "_removeItemFromCart", "removeItemFromCart_fn", "_syncWithCart", "syncWithCart_fn", "_initUnitPricingForSelector", "initUnitPricingForSelector_fn", "_updateUnitPricingForCard", "updateUnitPricingForCard_fn", "_formatPrice", "formatPrice_fn", "_updatePriceElement", "updatePriceElement_fn", "SelectorManager", "app", "__privateAdd", "__privateSet", "DebugUtils", "__privateMethod", "__privateGet", "selectorId", "campaignData", "visiblePackageIds", "visiblePackages", "selector", "item", "pkg", "refIdStr", "externalIdStr", "filteredCampaignData", "selectorElement", "mode", "card", "cardElement", "packageId", "shippingId", "priceText", "price", "name", "quantity", "isPreSelected", "previous", "error", "i", "previousItem", "selected", "currentSelectedItem", "items", "cartItemsInSelector", "itemInCart", "preSelected", "isInCart", "packages", "packageData", "totalUnits", "totalPrice", "totalRetailPrice", "couponDetails", "discountedTotalPrice", "discountPercentage", "cart", "cartSubtotal", "packageProportion", "packageDiscount", "unitPrice", "unitRetailPrice", "unitSavings", "unitSavingsPercentage", "totalSavings", "totalSavingsPercentage", "formatPrice", "processedElements", "subunitElements", "element", "divisor", "type", "value", "formattedValue", "priceElements", "hideIfZero", "numericValue", "container", "_packageToggles", "_app", "_logger", "_isDebugMode", "_initAndRegisterToggleElements", "initAndRegisterToggleElements_fn", "_registerToggleElement", "registerToggleElement_fn", "_addDebugOverlay", "addDebugOverlay_fn", "_processToggleAction", "processToggleAction_fn", "_getPackageDataFromCampaign", "getPackageDataFromCampaign_fn", "_updateAllToggleUIs", "updateAllToggleUIs_fn", "_updateUIForPackage", "updateUIForPackage_fn", "_isItemInCart", "isItemInCart_fn", "_addItemToCart", "addItemToCart_fn", "_removeItemFromCart", "removeItemFromCart_fn", "ToggleManager", "app", "__privateAdd", "__privateSet", "DebugUtils", "__privateMethod", "__privateGet", "toggleElements", "element", "toggleElement", "packageId", "quantity", "event", "packageData", "price", "isUpsell", "clickedElement", "packageInfo", "isInCart", "pkg", "elements", "wrapper", "itemId", "found", "item", "packageIdToRemove", "_app", "_logger", "_miniCartVisible", "_miniCartElement", "_debugBarElement", "_isDebugMode", "_init", "init_fn", "_createDebugBar", "createDebugBar_fn", "_toggleXray", "toggleXray_fn", "_showMiniCart", "showMiniCart_fn", "_hideMiniCart", "hideMiniCart_fn", "_toggleMiniCart", "toggleMiniCart_fn", "_createMiniCartElement", "createMiniCartElement_fn", "_updateMiniCart", "updateMiniCart_fn", "DebugManager", "app", "__privateAdd", "__privateSet", "DebugUtils", "__privateMethod", "__privateGet", "enabled", "debugBar", "leftSection", "title", "rightSection", "xrayControl", "xrayLabel", "xrayToggle", "xrayCheckbox", "xraySlider", "cartControl", "cartButton", "isEnabled", "checkbox", "miniCart", "header", "buttonContainer", "refreshButton", "closeButton", "content", "footer", "cart", "formatPrice", "price", "html", "item", "isUpsell", "upsellBadge", "voucherType", "voucherValue", "voucherInfo", "_app", "_logger", "_timers", "_storagePrefix", "_initTimers", "initTimers_fn", "_setupTimer", "setupTimer_fn", "_getTimerConfig", "getTimerConfig_fn", "_formatTime", "formatTime_fn", "_triggerTimerEvent", "triggerTimerEvent_fn", "TimerManager", "app", "__privateAdd", "__privateSet", "__privateMethod", "__privateGet", "timer", "timerElements", "timerElement", "parentElement", "timerConfig", "originalParentContent", "startTime", "timerPersistenceId", "storageKey", "cachedStartTime", "updateHandler", "elapsed", "seconds", "hours", "minutes", "formattedTime", "config", "format", "padded", "num", "eventName", "element", "detail", "event", "_app", "_logger", "_displayElements", "_initDisplayElements", "initDisplayElements_fn", "_updateContainerDisplay", "updateContainerDisplay_fn", "_triggerDisplayEvent", "triggerDisplayEvent_fn", "DisplayManager", "app", "__privateAdd", "__privateSet", "__privateMethod", "__privateGet", "cartItemIds", "item", "containerData", "container", "swapContainers", "index", "containerId", "displayElements", "element", "id", "elements", "hasVisibleElement", "packageId", "eventName", "detail", "event", "_app", "_logger", "_elements", "_config", "_lineItemTemplate", "_initCartDisplay", "initCartDisplay_fn", "_initSummaryToggle", "initSummaryToggle_fn", "_toggleSummary", "toggleSummary_fn", "_updateLineItems", "updateLineItems_fn", "_createLineItemElement", "createLineItemElement_fn", "_updateSummary", "updateSummary_fn", "_updateShipping", "updateShipping_fn", "_updateSavings", "updateSavings_fn", "_updateGrandTotal", "updateGrandTotal_fn", "_formatPrice", "formatPrice_fn", "_debounce", "debounce_fn", "_updateCompareTotals", "updateCompareTotals_fn", "_findAllSummaryElements", "findAllSummaryElements_fn", "CartDisplayManager", "app", "__privateAdd", "__privateSet", "__privateMethod", "__privateGet", "cart", "item", "firstContainer", "existingLineItem", "hasFreqInTemplate", "hasSaleInTemplate", "summaryBars", "summaryPanels", "summaryTexts", "summaryIcons", "panel", "index", "textElement", "bar", "e", "text", "icon", "currentHeight", "items", "lineDisplayElement", "showDiscountedPriceOnLineItem", "lineItemElement", "scrollIndicators", "shouldShowScroll", "indicator", "el", "itemElement", "titleElement", "itemTitle", "matchingItem", "cartItem", "directItemPackageIdString", "overrideText", "overridePrice", "itemPackageIdString", "lineItem", "imageElement", "qtyElement", "frequencyElement", "frequencyText", "comparePriceEl", "salePriceEl", "baseLinePrice", "finalSalePriceForLine", "itemLineDiscount", "retailTotalForLine", "savingsPercentElement", "savingsPercent", "format", "savingsText", "removeButton", "event", "itemIdToRemove", "error", "totals", "element", "discountElements", "discountRows", "row", "shippingCost", "shippingMethod", "shippingBar", "shippingCompare", "shippingCurrent", "savingsBar", "savingsAmount", "savingsPercentage", "allSavingsAmounts", "allSavingsPercentages", "total", "price", "func", "wait", "timeout", "args", "later", "totalType", "compareValue", "couponCompareValue", "hasStyleAttr", "style", "isDiagonalLine", "attribute", "_app", "_logger", "_attributionData", "_initialized", "_init", "init_fn", "_collectAttributionData", "collectAttributionData_fn", "_handleEverflowClickId", "handleEverflowClickId_fn", "_collectTrackingTags", "collectTrackingTags_fn", "_storeAttributionData", "storeAttributionData_fn", "_persistAttributionData", "persistAttributionData_fn", "_loadPersistedAttributionData", "loadPersistedAttributionData_fn", "_getFirstVisitTimestamp", "getFirstVisitTimestamp_fn", "_setupEventListeners", "setupEventListeners_fn", "_getStoredValue", "getStoredValue_fn", "_getCookie", "getCookie_fn", "_getDeviceType", "getDeviceType_fn", "_getFacebookPixelId", "getFacebookPixelId_fn", "AttributionManager", "app", "__privateAdd", "__privateSet", "__privateMethod", "newData", "__privateGet", "everflowTransactionId", "funnelMetaTag", "funnelFromTag", "campaignName", "apiData", "trackingTags", "tag", "funnelName", "clickId", "metadata", "fbclid", "affiliate", "urlParams", "evclid", "sg_evclid", "tagName", "tagValue", "shouldPersist", "error", "persistedData", "data", "key", "value", "name", "parts", "userAgent", "osFbPixelMeta", "pixelId", "scripts", "script", "content", "match", "_app", "_logger", "_isInitialized", "_platforms", "_debugMode", "_processedOrderIds", "_viewItemListFired", "_disabledEvents", "_loadDisabledEventsConfig", "loadDisabledEventsConfig_fn", "_isEventDisabled", "isEventDisabled_fn", "_loadProcessedOrderIds", "loadProcessedOrderIds_fn", "_saveProcessedOrderIds", "saveProcessedOrderIds_fn", "_detectPlatforms", "detectPlatforms_fn", "_setupEventListeners", "setupEventListeners_fn", "_getUserDataForTracking", "getUserDataForTracking_fn", "_hashString", "hashString_fn", "_fireEvent", "fireEvent_fn", "EventManager", "app", "__privateAdd", "__privateSet", "__privateGet", "__privateMethod", "campaignData", "items", "pkg", "price", "eventData", "cartData", "isSinglePackage", "currency", "value", "item", "orderData", "force", "orderId", "line", "userData", "packageData", "cart", "eventName", "formattedEventData", "customEvent", "platform", "enabled", "isDisabled", "event", "storedIds", "parsedIds", "id", "error", "idsArray", "previousCartItems", "data", "currentCartItemsJSON", "previousCartItemsJSON", "str", "hash", "i", "char", "min", "max", "round", "createCoords", "v", "oppositeSideMap", "oppositeAlignmentMap", "clamp", "start", "value", "end", "max", "min", "evaluate", "param", "getSide", "placement", "getAlignment", "getOppositeAxis", "axis", "getAxisLength", "getSideAxis", "getAlignmentAxis", "getAlignmentSides", "rects", "rtl", "alignment", "alignmentAxis", "length", "mainAlignmentSide", "getOppositePlacement", "getExpandedPlacements", "oppositePlacement", "getOppositeAlignmentPlacement", "getSideList", "side", "isStart", "lr", "rl", "tb", "bt", "getOppositeAxisPlacements", "flipAlignment", "direction", "list", "expandPaddingObject", "padding", "getPaddingObject", "rectToClientRect", "rect", "x", "y", "width", "height", "computeCoordsFromPlacement", "_ref", "placement", "rtl", "reference", "floating", "sideAxis", "getSideAxis", "alignmentAxis", "getAlignmentAxis", "alignLength", "getAxisLength", "side", "getSide", "isVertical", "commonX", "commonY", "commonAlign", "coords", "getAlignment", "computePosition", "config", "strategy", "middleware", "platform", "validMiddleware", "rects", "x", "y", "statefulPlacement", "middlewareData", "resetCount", "i", "name", "fn", "nextX", "nextY", "data", "reset", "detectOverflow", "state", "options", "_await$platform$isEle", "elements", "boundary", "rootBoundary", "elementContext", "altBoundary", "padding", "evaluate", "paddingObject", "getPaddingObject", "element", "clippingClientRect", "rectToClientRect", "rect", "offsetParent", "offsetScale", "elementClientRect", "arrow", "axis", "length", "arrowDimensions", "isYAxis", "minProp", "maxProp", "clientProp", "endDiff", "startDiff", "arrowOffsetParent", "clientSize", "centerToReference", "largestPossiblePadding", "minPadding", "min", "maxPadding", "min$1", "max", "center", "offset", "clamp", "shouldAddOffset", "alignmentOffset", "flip", "options", "state", "_middlewareData$arrow", "_middlewareData$flip", "placement", "middlewareData", "rects", "initialPlacement", "platform", "elements", "checkMainAxis", "checkCrossAxis", "specifiedFallbackPlacements", "fallbackStrategy", "fallbackAxisSideDirection", "flipAlignment", "detectOverflowOptions", "evaluate", "side", "getSide", "initialSideAxis", "getSideAxis", "isBasePlacement", "rtl", "fallbackPlacements", "getOppositePlacement", "getExpandedPlacements", "hasFallbackAxisSideDirection", "getOppositeAxisPlacements", "placements", "overflow", "detectOverflow", "overflows", "overflowsData", "sides", "getAlignmentSides", "_middlewareData$flip2", "_overflowsData$filter", "nextIndex", "nextPlacement", "resetPlacement", "d", "a", "b", "_overflowsData$filter2", "currentSideAxis", "acc", "convertValueToCoords", "state", "options", "placement", "platform", "elements", "rtl", "side", "getSide", "alignment", "getAlignment", "isVertical", "getSideAxis", "mainAxisMulti", "crossAxisMulti", "rawValue", "evaluate", "mainAxis", "crossAxis", "alignmentAxis", "offset", "_middlewareData$offse", "_middlewareData$arrow", "x", "y", "middlewareData", "diffCoords", "shift", "checkMainAxis", "checkCrossAxis", "limiter", "_ref", "detectOverflowOptions", "coords", "overflow", "detectOverflow", "getOppositeAxis", "mainAxisCoord", "crossAxisCoord", "minSide", "maxSide", "min", "max", "clamp", "limitedCoords", "hasWindow", "getNodeName", "node", "isNode", "getWindow", "_node$ownerDocument", "getDocumentElement", "_ref", "value", "isElement", "isHTMLElement", "isShadowRoot", "isOverflowElement", "element", "overflow", "overflowX", "overflowY", "display", "getComputedStyle", "isTableElement", "isTopLayer", "selector", "isContainingBlock", "elementOrCss", "webkit", "isWebKit", "css", "getContainingBlock", "currentNode", "getParentNode", "isLastTraversableNode", "getNodeScroll", "result", "getNearestOverflowAncestor", "parentNode", "getOverflowAncestors", "list", "traverseIframes", "_node$ownerDocument2", "scrollableAncestor", "isBody", "win", "frameElement", "getFrameElement", "getCssDimensions", "element", "css", "getComputedStyle", "width", "height", "hasOffset", "isHTMLElement", "offsetWidth", "offsetHeight", "shouldFallback", "round", "unwrapElement", "isElement", "getScale", "domElement", "createCoords", "rect", "$", "x", "y", "noOffsets", "getVisualOffsets", "win", "getWindow", "isWebKit", "shouldAddVisualOffsets", "isFixed", "floatingOffsetParent", "getBoundingClientRect", "includeScale", "isFixedStrategy", "offsetParent", "clientRect", "scale", "visualOffsets", "offsetWin", "currentWin", "currentIFrame", "getFrameElement", "iframeScale", "iframeRect", "left", "top", "rectToClientRect", "getWindowScrollBarX", "leftScroll", "getNodeScroll", "getDocumentElement", "getHTMLOffset", "documentElement", "scroll", "ignoreScrollbarX", "htmlRect", "convertOffsetParentRelativeRectToViewportRelativeRect", "_ref", "elements", "strategy", "topLayer", "isTopLayer", "offsets", "isOffsetParentAnElement", "getNodeName", "isOverflowElement", "offsetRect", "htmlOffset", "getClientRects", "getDocumentRect", "html", "body", "max", "getViewportRect", "visualViewport", "visualViewportBased", "getInnerBoundingClientRect", "getClientRectFromClippingAncestor", "clippingAncestor", "hasFixedPositionAncestor", "stopNode", "parentNode", "getParentNode", "isLastTraversableNode", "getClippingElementAncestors", "cache", "cachedResult", "result", "getOverflowAncestors", "el", "currentContainingBlockComputedStyle", "elementIsFixed", "currentNode", "computedStyle", "currentNodeIsContaining", "isContainingBlock", "ancestor", "getClippingRect", "boundary", "rootBoundary", "clippingAncestors", "firstClippingAncestor", "clippingRect", "accRect", "min", "getDimensions", "getRectRelativeToOffsetParent", "isStaticPositioned", "getTrueOffsetParent", "polyfill", "rawOffsetParent", "getOffsetParent", "svgOffsetParent", "isTableElement", "getContainingBlock", "getElementRects", "data", "getOffsetParentFn", "getDimensionsFn", "floatingDimensions", "isRTL", "platform", "offset", "shift", "flip", "arrow", "computePosition", "reference", "floating", "options", "cache", "mergedOptions", "platform", "platformWithCache", "_app", "_logger", "_tooltip", "_arrowElement", "_textContainer", "_currentElement", "_showTimeout", "_hideTimeout", "_initialized", "_init", "init_fn", "_createTooltip", "createTooltip_fn", "_setupEventListeners", "setupEventListeners_fn", "_showTooltip", "showTooltip_fn", "_hideTooltip", "hideTooltip_fn", "TooltipManager", "app", "__privateAdd", "__privateSet", "__privateMethod", "__privateGet", "existingTooltip", "tooltip", "textContainer", "arrowElement", "element", "text", "position", "computePosition", "offset", "flip", "shift", "arrow", "x", "y", "placement", "middlewareData", "arrowX", "arrowY", "staticSide", "init_NavigationPrevention", "_app", "_logger", "_stateManager", "_api", "_upsellElements", "_orderRef", "_init", "init_fn", "_getOrderReferenceId", "getOrderReferenceId_fn", "_initUpsellElements", "initUpsellElements_fn", "_bindEvents", "bindEvents_fn", "_storeUpsellPurchaseData", "storeUpsellPurchaseData_fn", "_disableUpsellButtons", "disableUpsellButtons_fn", "_enableUpsellButtons", "enableUpsellButtons_fn", "_redirect", "redirect_fn", "_displayError", "displayError_fn", "UpsellManager", "app", "__privateAdd", "__privateSet", "__privateMethod", "__privateGet", "packageId", "quantity", "nextUrl", "upsellData", "response", "error", "refId", "button", "event", "campaignData", "packageData", "pkg", "upsellPurchaseData", "url", "redirectUrl", "currentUrlParams", "message", "errorContainer", "_app", "_logger", "DiscountManager", "app", "__privateAdd", "__privateSet", "__privateGet", "couponDetails", "subtotal", "cartItems", "discountableSubtotal", "itemEligibilityMessage", "i", "applicableItems", "item", "acc", "discountAmount", "couponCode", "cart", "PBAccordion", "accordion", "group", "items", "item", "content", "trigger", "arrow", "plus", "initial", "initialItem", "e", "event", "accordionItem", "isOpen", "contentHeight", "initPBAccordion", "UtmTransfer", "currentParams", "availableParams", "value", "key", "paramsToApply", "param", "links", "link", "event", "linkElement", "params", "href", "domain", "url", "linkParams", "initUtmTransfer", "utmTransfer", "_isInitialized", "_isCheckoutPage", "_campaignData", "_loadConfig", "loadConfig_fn", "_initSpreedlyConfig", "initSpreedlyConfig_fn", "_loadGoogleMapsApi", "loadGoogleMapsApi_fn", "_fetchCampaignData", "fetchCampaignData_fn", "_initializeManagers", "initializeManagers_fn", "_finalizeInitialization", "finalizeInitialization_fn", "_hidePreloader", "hidePreloader_fn", "_detectCheckoutPage", "detectCheckoutPage_fn", "_initCheckoutPage", "initCheckoutPage_fn", "_initReceiptPage", "initReceiptPage_fn", "_initUpsellPage", "initUpsellPage_fn", "_initUIUtilities", "initUIUtilities_fn", "_checkForPendingPurchaseEvents", "checkForPendingPurchaseEvents_fn", "_checkForPendingUpsellPurchase", "checkForPendingUpsellPurchase_fn", "TwentyNineNext", "options", "__privateAdd", "googleMapsConfig", "Logger", "ApiClient", "__privateMethod", "StateManager", "AttributionManager", "DiscountManager", "CartManager", "CampaignHelper", "UpsellManager", "event", "callback", "data", "wrappedCallback", "e", "error", "__privateSet", "__privateGet", "eventName", "detail", "eventData", "config", "urlCampaignId", "storedCampaignId", "apiKeyMeta", "campaignIdMeta", "resolve", "script", "regionParam", "funnelName", "SelectorManager", "ToggleManager", "TimerManager", "DisplayManager", "EventManager", "TooltipManager", "CartDisplayManager", "DebugManager", "packageData", "cartData", "orderData", "force", "preloader", "pageType", "CheckoutPage", "module", "ReceiptPage", "accordion", "initPBAccordion", "utmTransfer", "initUtmTransfer", "refId", "isEventManagerReady", "upsellPurchaseData", "purchaseData", "customEventData", "initialize", "config", "callbacks", "TwentyNineNext", "callback", "error"]
}
