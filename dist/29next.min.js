"use strict";var TwentyNineNext=(()=>{var Wa=Object.defineProperty;var ru=Object.getOwnPropertyDescriptor;var su=Object.getOwnPropertyNames;var nu=Object.prototype.hasOwnProperty;var ou=(m,t)=>()=>(m&&(t=m(m=0)),t);var Rc=(m,t)=>{for(var i in t)Wa(m,i,{get:t[i],enumerable:!0})},au=(m,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of su(t))!nu.call(m,n)&&n!==i&&Wa(m,n,{get:()=>t[n],enumerable:!(r=ru(t,n))||r.enumerable});return m};var cu=m=>au(Wa({},"__esModule",{value:!0}),m);var Ha=(m,t,i)=>{if(!t.has(m))throw TypeError("Cannot "+i)};var e=(m,t,i)=>(Ha(m,t,"read from private field"),i?i.call(m):t.get(m)),o=(m,t,i)=>{if(t.has(m))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(m):t.set(m,i)},l=(m,t,i,r)=>(Ha(m,t,"write to private field"),r?r.call(m,i):t.set(m,i),i);var Wc=(m,t,i,r)=>({set _(n){l(m,t,n,i)},get _(){return e(m,t,r)}}),s=(m,t,i)=>(Ha(m,t,"access private method"),i);var Bh={};Rc(Bh,{ReceiptPage:()=>Fc});var wi,Ie,ka,_,xr,kr,Ta,I,N,Aa,Dh,$a,Rh,Ia,Wh,La,Hh,Y,nt,Le,Er,Tr,Nc,Ar,Uc,$r,zc,Ir,Oc,_i,xa,Lr,Dc,Fc,jh=ou(()=>{"use strict";Fc=class{constructor(t,i,r){o(this,I);o(this,Aa);o(this,$a);o(this,Ia);o(this,La);o(this,Y);o(this,Le);o(this,Tr);o(this,Ar);o(this,$r);o(this,Ir);o(this,_i);o(this,Lr);o(this,wi,void 0);o(this,Ie,void 0);o(this,ka,void 0);o(this,_,null);o(this,xr,!1);o(this,kr,!1);o(this,Ta,!1);l(this,wi,t),l(this,Ie,i),l(this,ka,r);let n=document.querySelector('meta[name="os-debug"]');l(this,Ta,n?.getAttribute("content")==="true"),s(this,I,N).call(this,"info","ReceiptPage component created"),this.init()}async init(){if(e(this,kr)){s(this,I,N).call(this,"info","Receipt page already initialized, skipping");return}s(this,I,N).call(this,"info","Initializing Receipt Page"),l(this,kr,!0);let i=new URLSearchParams(window.location.search).get("ref_id");if(!i){s(this,I,N).call(this,"error","No ref_id found in URL parameters"),s(this,Lr,Dc).call(this,"Order reference not found. Please check your URL.");return}s(this,I,N).call(this,"info",`Found ref_id in URL: ${i}`);try{await s(this,Aa,Dh).call(this,i),s(this,$a,Rh).call(this)}catch(r){s(this,I,N).call(this,"error","Error initializing receipt page:",r),s(this,Lr,Dc).call(this,"Failed to load order details. Please try again later.")}}};wi=new WeakMap,Ie=new WeakMap,ka=new WeakMap,_=new WeakMap,xr=new WeakMap,kr=new WeakMap,Ta=new WeakMap,I=new WeakSet,N=function(t,i,...r){try{e(this,Ie)&&typeof e(this,Ie)[t]=="function"?e(this,Ie)[t](i,...r):console[t]?console[t](i,...r):(`${t.toUpperCase()}${i}`,[...r])}catch(n){console.error("Error logging message:",n)}},Aa=new WeakSet,Dh=async function(t){if(s(this,I,N).call(this,"info",`Fetching order details for ref_id: ${t}`),e(this,xr)&&e(this,_))return s(this,I,N).call(this,"info","Order already fetched, using cached data"),e(this,_);try{if(!e(this,wi))throw new Error("API client not available");return s(this,I,N).call(this,"debug","Making API request to fetch order details"),l(this,_,await e(this,wi).getOrder(t)),l(this,xr,!0),s(this,I,N).call(this,"info","Order details fetched successfully"),s(this,I,N).call(this,"debug","Order data:",e(this,_)),e(this,_)}catch(i){throw s(this,I,N).call(this,"error",`Error fetching order details for ref_id ${t}:`,i),i}},$a=new WeakSet,Rh=function(){if(!e(this,_)){s(this,I,N).call(this,"error","No order data available to update receipt content");return}s(this,I,N).call(this,"info","Updating receipt content with order details"),s(this,Y,nt).call(this,"fname",e(this,_).user?.first_name||""),e(this,_).billing_address&&(s(this,Y,nt).call(this,"billing_fname",`${e(this,_).billing_address.first_name} ${e(this,_).billing_address.last_name}`),s(this,Y,nt).call(this,"billing_address",s(this,Tr,Nc).call(this,e(this,_).billing_address)),s(this,Y,nt).call(this,"billing_location",s(this,Ar,Uc).call(this,e(this,_).billing_address)),s(this,Y,nt).call(this,"billing_country",s(this,$r,zc).call(this,e(this,_).billing_address.country)||"")),e(this,_).shipping_address&&(s(this,Y,nt).call(this,"shipping_fname",`${e(this,_).shipping_address.first_name} ${e(this,_).shipping_address.last_name}`),s(this,Y,nt).call(this,"shipping_address",s(this,Tr,Nc).call(this,e(this,_).shipping_address)),s(this,Y,nt).call(this,"shipping_location",s(this,Ar,Uc).call(this,e(this,_).shipping_address)),s(this,Y,nt).call(this,"shipping_country",s(this,$r,zc).call(this,e(this,_).shipping_address.country)||""));let t=s(this,Ia,Wh).call(this);s(this,Y,nt).call(this,"payment_method",t),s(this,La,Hh).call(this);let i=e(this,_).shipping_method||"Standard Shipping";s(this,Y,nt).call(this,"shipping-method",i),s(this,Y,nt).call(this,"shipping_method",i);let r=s(this,_i,xa).call(this,parseFloat(e(this,_).total_incl_tax)||0);s(this,Y,nt).call(this,"total",r),s(this,Y,nt).call(this,"order_number",e(this,_).number||""),s(this,Y,nt).call(this,"order_reference",e(this,_).ref_id||""),s(this,I,N).call(this,"info","Receipt content updated successfully")},Ia=new WeakSet,Wh=function(){return e(this,_).payment_detail&&e(this,_).payment_detail.payment_method?s(this,Ir,Oc).call(this,e(this,_).payment_detail.payment_method):e(this,_).payment_method?s(this,Ir,Oc).call(this,e(this,_).payment_method):"Credit Card"},La=new WeakSet,Hh=function(){if(!e(this,_).lines||!Array.isArray(e(this,_).lines)){s(this,I,N).call(this,"warn","No order lines available");return}let t=document.querySelector('[data-os-receipt="order-lines"]');if(!t){s(this,I,N).call(this,"warn","Order lines container not found in DOM");return}t.innerHTML="";let i=document.querySelector('[data-os-receipt="product-line"]'),r=i?i.outerHTML:`
      <div data-os-receipt="product-line" class="cart-summary__line">
        <div class="cart-summary__line-item">
          <div data-os-receipt="line-title" class="cart-line__title"></div>
          <div data-os-receipt="line-saving" class="cart-line__discount"></div>
        </div>
        <div class="cart-summary__line-item">
          <p data-os-receipt="line-compare" class="pb-cart__line-price pb--compare"></p>
          <p data-os-receipt="line-subtotal" class="pb-cart__line-price"></p>
        </div>
      </div>
    `;e(this,_).lines.forEach(n=>{let a=document.createElement("div");a.innerHTML=r;let c=a.firstElementChild,d=n.product_title||n.title||n.package_title||"Product";if(s(this,Le,Er).call(this,c,"line-title",d),n.price_excl_tax_excl_discounts&&parseFloat(n.price_excl_tax_excl_discounts)>parseFloat(n.price_excl_tax)){let p=parseFloat(n.price_excl_tax_excl_discounts),v=parseFloat(n.price_excl_tax),L=Math.round((1-v/p)*100);s(this,Le,Er).call(this,c,"line-saving",`(${L}% OFF)`),s(this,Le,Er).call(this,c,"line-compare",s(this,_i,xa).call(this,p))}else{let p=c.querySelector('[data-os-receipt="line-saving"]'),v=c.querySelector('[data-os-receipt="line-compare"]');p&&(p.style.display="none"),v&&(v.style.display="none")}let h=parseFloat(n.price_incl_tax)||parseFloat(n.price_excl_tax)||0;s(this,Le,Er).call(this,c,"line-subtotal",s(this,_i,xa).call(this,h)),t.appendChild(c)})},Y=new WeakSet,nt=function(t,i){let r=document.querySelectorAll(`[data-os-receipt="${t}"]`);if(r.length===0){s(this,I,N).call(this,"debug",`No elements found with data-os-receipt="${t}"`);return}r.forEach(n=>{n.textContent=i})},Le=new WeakSet,Er=function(t,i,r){let n=t.querySelector(`[data-os-receipt="${i}"]`);if(!n){s(this,I,N).call(this,"debug",`No element found with data-os-receipt="${i}" in node`);return}n.textContent=r},Tr=new WeakSet,Nc=function(t){let i="";return t.line1&&(i+=t.line1),t.line2&&(i+=i?`, ${t.line2}`:t.line2),i},Ar=new WeakSet,Uc=function(t){let i=[];return t.line4&&i.push(t.line4),t.state&&i.push(t.state),t.postcode&&i.push(t.postcode),i.join(", ")},$r=new WeakSet,zc=function(t){return{US:"United States",CA:"Canada",GB:"United Kingdom",AU:"Australia",NZ:"New Zealand"}[t]||t},Ir=new WeakSet,Oc=function(t){return{card_token:"Credit Card",paypal:"PayPal",apple_pay:"Apple Pay",google_pay:"Google Pay",credit:"Credit Card",card:"Credit Card"}[t]||t},_i=new WeakSet,xa=function(t){let i=e(this,_).currency||"USD",r=parseFloat(t);if(isNaN(r))return s(this,I,N).call(this,"warn",`Invalid amount for currency formatting: ${t}`),`$0.00 ${i}`;try{return new Intl.NumberFormat("en-US",{style:"currency",currency:i}).format(r)}catch(n){return s(this,I,N).call(this,"error",`Error formatting currency: ${n}`),`$${r.toFixed(2)} ${i}`}},Lr=new WeakSet,Dc=function(t){s(this,I,N).call(this,"error",`Displaying error message: ${t}`);let i=document.querySelector(".receipt-content")||document.body,r=document.createElement("div");r.className="receipt-error",r.style.color="red",r.style.padding="20px",r.style.margin="20px 0",r.style.border="1px solid red",r.style.borderRadius="5px",r.style.backgroundColor="rgba(255, 0, 0, 0.1)",r.textContent=t,i.prepend(r)}});var hu={};Rc(hu,{TwentyNineNext:()=>Pr});var wt,Ot,ki,w,Mr,Hc,me,xi,Ti,Ba,qr=class{constructor(t){o(this,Mr);o(this,me);o(this,Ti);o(this,wt,void 0);o(this,Ot,void 0);o(this,ki,"https://campaigns.apps.29next.com/api/v1");o(this,w,void 0);l(this,wt,t),l(this,w,t.logger.createModuleLogger("API"))}init(){if(e(this,w).info("Initializing ApiClient"),l(this,Ot,e(this,wt).config.apiKey),e(this,Ot))e(this,w).info("API key is set");else{let r=document.querySelector('meta[name="os-api-key"]');l(this,Ot,r?.getAttribute("content")),e(this,w).info(e(this,Ot)?"API key retrieved from meta tag":"API key is not set")}let i=document.querySelector('meta[name="os-proxy-url"]')?.getAttribute("content");i&&(l(this,ki,i),e(this,w).info(`Using proxy URL: ${i}`))}async getCampaign(){try{let t=await s(this,me,xi).call(this,"campaigns/");if(e(this,w).debug("Campaign data received"),Array.isArray(t)&&t.length>0)return t[0];if(t?.name)return t;throw new Error("No valid campaign data found")}catch(t){return e(this,w).error("Error fetching campaign:",t),e(this,w).warn("Using fallback empty campaign object"),{name:"Default Campaign",currency:"USD",packages:[],formatPrice:i=>`$${Number.parseFloat(i).toFixed(2)}`}}}async createCart(t){e(this,w).debug("Creating cart",t),t.attribution?e(this,w).debug("Cart already has attribution data:",t.attribution):(t.attribution=s(this,Ti,Ba).call(this),e(this,w).debug("Added attribution data to cart:",t.attribution));try{let i=await s(this,me,xi).call(this,"carts/","POST",t);return e(this,w).info("Cart created successfully",i),i}catch(i){throw e(this,w).error("Error creating cart",i),i}}async createOrder(t){e(this,w).debug("Creating order",t),t.attribution?e(this,w).debug("Order already has attribution data:",t.attribution):(t.attribution=s(this,Ti,Ba).call(this),e(this,w).debug("Added attribution data to order:",t.attribution)),(t.payment_token==="test_card"||t.payment_detail&&t.payment_detail.card_token==="test_card")&&(e(this,w).debug("Using test card token for order"),t.payment_detail=t.payment_detail||{},t.payment_detail.payment_method="card_token",t.payment_detail.card_token="test_card",t.payment_token&&delete t.payment_token);try{let i=await s(this,me,xi).call(this,"orders/","POST",t);return e(this,w).info("Order created successfully",i),i.ref_id&&(sessionStorage.setItem("order_ref_id",i.ref_id),e(this,w).debug(`Order reference ID stored: ${i.ref_id}`)),i}catch(i){throw e(this,w).error("Error creating order",i),i}}async getOrder(t){if(!t)throw new Error("Order reference is required");return e(this,w).debug(`Fetching order with ref: ${t}`),s(this,me,xi).call(this,`orders/${t}/`)}async processPayment(t,i){e(this,w).debug(`Processing ${i} payment for order`);let r={credit:"card_token",paypal:"paypal",apple_pay:"apple_pay",google_pay:"google_pay"};if(t.payment_detail=t.payment_detail??{},t.payment_detail.payment_method=r[i]??i,i==="credit"&&!t.payment_detail.card_token)throw new Error("Credit card payment requires a card token");return i!=="credit"&&delete t.payment_detail.card_token,this.createOrder(t)}getNextUrlFromOrderResponse(t,i="/checkout/complete"){e(this,w).debug("Getting next URL for redirect");let r=t.ref_id,n=document.querySelector('meta[name="os-next-page"]'),a=i;if(n?.getAttribute("content")){let p=n.getAttribute("content");e(this,w).debug(`Found meta tag with next page URL: ${p}`);let v=p.startsWith("http")?new URL(p):new URL(p,`${location.protocol}//${location.host}`);return r&&v.searchParams.append("ref_id",r),v.href}if(t.payment_complete_url)return t.payment_complete_url;if(t.order_status_url)return t.order_status_url;let d=location.pathname.split("/").slice(0,-1).join("/"),h=new URL(`${d}${a}`,`${location.protocol}//${location.host}`);return r&&h.searchParams.append("ref_id",r),h.href}};wt=new WeakMap,Ot=new WeakMap,ki=new WeakMap,w=new WeakMap,Mr=new WeakSet,Hc=function(t){let i=t.startsWith("/")?t.slice(1):t;return`${e(this,ki)}/${i}`},me=new WeakSet,xi=async function(t,i="GET",r=null){if(!e(this,Ot)){if(e(this,w).warn("API key is not set"),t==="campaigns/")return e(this,w).info("Returning mock campaign data since API key is not set"),[{name:"Mock Campaign",id:"mock-campaign",currency:"USD",locale:"en-US",packages:[],products:[]}];throw new Error("API key is required")}let n=s(this,Mr,Hc).call(this,t),a={method:i,mode:"cors",credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:e(this,Ot)}};i!=="GET"&&r&&(a.body=JSON.stringify(r)),e(this,w).debug(`Making ${i} request to ${n}`,i!=="GET"?{requestData:r}:{});try{let c=await fetch(n,a);if(e(this,w).debug(`Received response from ${n} with status ${c.status}`),!c.ok){let h=await c.json().catch(()=>({}));throw e(this,w).error(`API error response from ${n}:`,h),new Error(JSON.stringify(h))}let d=await c.json();return e(this,w).debug(`Successfully processed response from ${n}`),d}catch(c){throw e(this,w).error(`API request failed: ${t}`,c),c.message?.match(/NetworkError|Failed to fetch|Network request failed/)&&e(this,w).warn("This appears to be a CORS issue. Make sure the API endpoint allows cross-origin requests."),c}},Ti=new WeakSet,Ba=function(){if(e(this,wt).attribution)return typeof e(this,wt).attribution.getAttributionForApi=="function"?e(this,wt).attribution.getAttributionForApi():e(this,wt).attribution.getAttributionData();if(e(this,wt).state){let t=e(this,wt).state.getState("attribution");return t||e(this,wt).state.getState("cart.attribution")||{}}return{}};var Jt,Yt,qe,Nr,Bc,Ur,jc,zr,Vc,Or,Gc,Dr,Kc,Rr,Jc,Wr,Yc,Hr,Xc,Fr=class{constructor(t=!1){o(this,Nr);o(this,Ur);o(this,zr);o(this,Or);o(this,Dr);o(this,Rr);o(this,Wr);o(this,Hr);o(this,Jt,void 0);o(this,Yt,"29next");o(this,qe,0);l(this,Jt,t),this.setStartupTime()}setDebug(t){l(this,Jt,t)}setStartupTime(){l(this,qe,+new Date),window.twentyNineNextStartupTime=e(this,qe)}getElapsedTime(){return+new Date-e(this,qe)}createModuleLogger(t){let i=`${e(this,Yt)} [${t}]`;return{debug:(...r)=>s(this,Or,Gc).call(this,i,...r),info:(...r)=>s(this,Nr,Bc).call(this,i,...r),warn:(...r)=>s(this,Ur,jc).call(this,i,...r),error:(...r)=>s(this,zr,Vc).call(this,i,...r),debugWithTime:(...r)=>s(this,Hr,Xc).call(this,i,...r),infoWithTime:(...r)=>s(this,Dr,Kc).call(this,i,...r),warnWithTime:(...r)=>s(this,Rr,Jc).call(this,i,...r),errorWithTime:(...r)=>s(this,Wr,Yc).call(this,i,...r)}}logWithTime(t,...i){let r=this.getElapsedTime();`${e(this,Yt)}${r}${t}`,[...i]}warnWithTime(t,...i){let r=this.getElapsedTime();console.warn(`%c${e(this,Yt)} +${r}ms%c ${t}`,"color: #ff9900; font-weight: bold;","color: inherit;",...i)}errorWithTime(t,...i){let r=this.getElapsedTime();console.error(`%c${e(this,Yt)} +${r}ms%c ${t}`,"color: #cc0000; font-weight: bold;","color: inherit;",...i)}debugWithTime(t,...i){if(e(this,Jt)){let r=this.getElapsedTime();console.debug(`%c${e(this,Yt)}:debug +${r}ms%c ${t}`,"color: #666666; font-weight: bold;","color: inherit;",...i)}}};Jt=new WeakMap,Yt=new WeakMap,qe=new WeakMap,Nr=new WeakSet,Bc=function(t,i,...r){`${t}${i}`,[...r]},Ur=new WeakSet,jc=function(t,i,...r){console.warn(`%c${t}%c ${i}`,"color: #ff9900; font-weight: bold;","color: inherit;",...r)},zr=new WeakSet,Vc=function(t,i,...r){console.error(`%c${t}%c ${i}`,"color: #cc0000; font-weight: bold;","color: inherit;",...r)},Or=new WeakSet,Gc=function(t,i,...r){e(this,Jt)&&console.debug(`%c${t}:debug%c ${i}`,"color: #666666; font-weight: bold;","color: inherit;",...r)},Dr=new WeakSet,Kc=function(t,i,...r){let n=this.getElapsedTime();`${t}${n}${i}`,[...r]},Rr=new WeakSet,Jc=function(t,i,...r){let n=this.getElapsedTime();console.warn(`%c${t} +${n}ms%c ${i}`,"color: #ff9900; font-weight: bold;","color: inherit;",...r)},Wr=new WeakSet,Yc=function(t,i,...r){let n=this.getElapsedTime();console.error(`%c${t} +${n}ms%c ${i}`,"color: #cc0000; font-weight: bold;","color: inherit;",...r)},Hr=new WeakSet,Xc=function(t,i,...r){if(e(this,Jt)){let n=this.getElapsedTime();console.debug(`%c${t}:debug +${n}ms%c ${i}`,"color: #666666; font-weight: bold;","color: inherit;",...r)}};var Vr,Q,ct,At,yt,P,Gr,Zc,Kr,Qc,Ai,ja,Jr,tl,Me,Br,Yr,el,Xr,il,$i,Va,Zr,rl,Ii,Ga,Qr,sl,ts,nl,es,ol,jr=class{constructor(t,i){o(this,Gr);o(this,Kr);o(this,Ai);o(this,Jr);o(this,Me);o(this,Yr);o(this,Xr);o(this,$i);o(this,Zr);o(this,Ii);o(this,Qr);o(this,ts);o(this,es);o(this,Vr,void 0);o(this,Q,void 0);o(this,ct,void 0);o(this,At,[]);o(this,yt,{});o(this,P,void 0);l(this,Vr,t),l(this,Q,i),l(this,ct,s(this,Kr,Qc).call(this)),l(this,P,{shippingCountry:document.querySelector('[os-checkout-field="country"]'),shippingState:document.querySelector('[os-checkout-field="province"]'),billingCountry:document.querySelector('[os-checkout-field="billing-country"]'),billingState:document.querySelector('[os-checkout-field="billing-province"]')}),s(this,Xr,il).call(this),e(this,P).shippingCountry||e(this,P).billingCountry?(e(this,Q).info("AddressHandler initialized"),s(this,Gr,Zc).call(this)):e(this,Q).warn("No country selects found")}};Vr=new WeakMap,Q=new WeakMap,ct=new WeakMap,At=new WeakMap,yt=new WeakMap,P=new WeakMap,Gr=new WeakSet,Zc=async function(){await s(this,Zr,rl).call(this),await Promise.all([e(this,P).shippingCountry&&s(this,Ai,ja).call(this,e(this,P).shippingCountry,e(this,P).shippingState),e(this,P).billingCountry&&s(this,Ai,ja).call(this,e(this,P).billingCountry,e(this,P).billingState)]),s(this,Jr,tl).call(this),s(this,Qr,sl).call(this),s(this,ts,nl).call(this)},Kr=new WeakSet,Qc=function(){return{defaultCountry:window.osConfig?.addressConfig?.defaultCountry??document.querySelector('meta[name="os-address-default-country"]')?.content??"US",showCountries:window.osConfig?.addressConfig?.showCountries??document.querySelector('meta[name="os-address-show-countries"]')?.content?.split(",").map(t=>t.trim())??[],dontShowStates:window.osConfig?.addressConfig?.dontShowStates??document.querySelector('meta[name="os-address-dont-show-states"]')?.content?.split(",").map(t=>t.trim())??[],countries:window.osConfig?.addressConfig?.countries??[]}},Ai=new WeakSet,ja=async function(t,i){t.innerHTML='<option value="">Select Country</option>'+e(this,At).map(r=>`<option value="${r.iso2}">${r.name}</option>`).join(""),t.value=e(this,ct).defaultCountry,i&&t.value&&await s(this,Me,Br).call(this,i,t.value),e(this,Q).debug(`Country select initialized with default ${e(this,ct).defaultCountry}`)},Jr=new WeakSet,tl=function(){[[e(this,P).shippingCountry,e(this,P).shippingState],[e(this,P).billingCountry,e(this,P).billingState]].forEach(([i,r])=>{i?.addEventListener("change",()=>r&&s(this,Me,Br).call(this,r,i.value))})},Me=new WeakSet,Br=async function(t,i,r=!1){if(!i)return t.innerHTML='<option value="">Select State/Province</option>';let n=e(this,yt)[i]||await s(this,Ii,Ga).call(this,i);r&&await n,s(this,Yr,el).call(this,t,n),e(this,Q).debug(`State select updated for ${i}`)},Yr=new WeakSet,el=function(t,i){let r=t.value||t.getAttribute("data-pending-state")||"";t.innerHTML='<option value="">Select State/Province</option>'+i.map(n=>`<option value="${n.iso2}">${n.name}</option>`).join(""),t.parentElement.style.display=i.length?"":"none",r&&Array.from(t.options).some(n=>n.value===r)&&(t.value=r)},Xr=new WeakSet,il=function(){let t=i=>{let r=JSON.parse(localStorage.getItem(i)??"{}");return Date.now()-(r.timestamp??0)<864e5?r:{}};l(this,At,t("os_countries_cache").countries??[]),l(this,yt,t("os_states_cache").states??{}),e(this,Q).debug(`Loaded cached data: ${e(this,At).length} countries, ${Object.keys(e(this,yt)).length} state sets`)},$i=new WeakSet,Va=function(t,i){localStorage.setItem(t,JSON.stringify({...i,timestamp:Date.now()}))},Zr=new WeakSet,rl=async function(){e(this,At).length||(l(this,At,e(this,ct).countries.length?e(this,ct).countries.map(t=>({iso2:t.iso2||t.code,name:t.name})):(await(await fetch("https://api.countrystatecity.in/v1/countries",{headers:{"X-CSCAPI-KEY":"c2R3MzNhYmpvYUJPdmhkUlE5TUJWYUtJUGs2TTlNU3cyRmxmVW9wVQ=="}})).json()).filter(t=>!e(this,ct).showCountries.length||e(this,ct).showCountries.includes(t.iso2))),e(this,At).sort((t,i)=>t.name.localeCompare(i.name)),s(this,$i,Va).call(this,"os_countries_cache",{countries:e(this,At)}),e(this,Q).info(`Loaded ${e(this,At).length} countries`))},Ii=new WeakSet,Ga=async function(t){if(e(this,yt)[t])return e(this,yt)[t];try{let i=(await(await fetch(`https://api.countrystatecity.in/v1/countries/${t}/states`,{headers:{"X-CSCAPI-KEY":"c2R3MzNhYmpvYUJPdmhkUlE5TUJWYUtJUGs2TTlNU3cyRmxmVW9wVQ=="}})).json()).filter(r=>!e(this,ct).dontShowStates.includes(r.iso2));return e(this,yt)[t]=i,s(this,$i,Va).call(this,"os_states_cache",{states:e(this,yt)}),e(this,Q).debug(`Loaded ${i.length} states for ${t}`),i}catch(i){return e(this,Q).error(`Failed to load states for ${t}:`,i),e(this,yt)[t]=t==="US"?[]:[],e(this,yt)[t]}},Qr=new WeakSet,sl=async function(){if(e(this,P).shippingCountry?.value||e(this,P).billingCountry?.value)return;let t=e(this,ct).defaultCountry||(await Promise.any(["https://ipapi.co/json/","https://ipinfo.io/json"].map(i=>fetch(i).then(r=>r.json()))))?.country_code;[e(this,P).shippingCountry,e(this,P).billingCountry].forEach(i=>{i&&(i.value=t,i.dispatchEvent(new Event("change")))}),e(this,Q).debug(`User country detected/set to ${t}`)},ts=new WeakSet,nl=function(){let t=Object.values(e(this,P)).filter(Boolean),i=new MutationObserver(r=>{r.forEach(n=>{if(n.attributeName==="value"&&n.target.value){let a=n.target===e(this,P).shippingCountry?e(this,P).shippingState:e(this,P).billingState;a&&s(this,Me,Br).call(this,a,n.target.value,!0),e(this,Q).debug(`Autocomplete detected on ${n.target.getAttribute("os-checkout-field")}`)}})});t.forEach(r=>i.observe(r,{attributes:!0,attributeFilter:["value"]})),s(this,es,ol).call(this),e(this,Q).debug("Autocomplete detection set up")},es=new WeakSet,ol=function(){let t=e(this,ct).showCountries.length?e(this,ct).showCountries:["US","CA","GB","AU"];t.forEach(i=>!e(this,yt)[i]&&s(this,Ii,Ga).call(this,i)),e(this,Q).debug(`Preloading states for ${t.join(", ")}`)};var Li,Xt,rs,Pi,ge,ss,qi,ns,al,lt,_t,os,cl,as,ll,cs,dl,ls,hl,ds,ul,hs,ml,us,gl,ms,pl,gs,fl,Mi,Ka,Fi,Ja,ps,yl,fs,bl,Fe,is,ys,vl,bs,Sl,vs,wl,Ne=class{constructor(t={}){o(this,ns);o(this,lt);o(this,os);o(this,as);o(this,cs);o(this,ls);o(this,ds);o(this,hs);o(this,us);o(this,ms);o(this,gs);o(this,Mi);o(this,Fi);o(this,ps);o(this,fs);o(this,Fe);o(this,ys);o(this,bs);o(this,vs);o(this,Li,void 0);o(this,Xt,void 0);o(this,rs,{});o(this,Pi,!1);o(this,ge,!1);o(this,ss,!1);o(this,qi,!1);l(this,Pi,t.debugMode||!1),l(this,Li,t.logger||console),l(this,Xt,s(this,ns,al).call(this)),l(this,ge,typeof Spreedly<"u"),e(this,Xt)&&s(this,os,cl).call(this)}validateAllFields(t=this.getSelectedPaymentMethod()){e(this,Pi)&&s(this,ds,ul).call(this,t);let i=["credit","credit-card"].includes(t),r=Array.from(document.querySelectorAll('[os-checkout-validate="required"]')),n=s(this,hs,ml).call(this,r,i);return i&&e(this,ge)&&!n&&!s(this,ms,pl).call(this)?!1:n?(s(this,bs,Sl).call(this,n),!1):!0}clearErrorForField(t){if(!t)return;t.classList.remove("error"),(t.closest(".frm-flds")||t.closest(".form-group")||t.parentElement)?.querySelector(".pb-input-error")?.remove();let r=t.getAttribute("os-checkout-field");if(["cc-number","cvv"].includes(r)){let n=`spreedly-${r==="cc-number"?"number":"cvv"}`,a=document.getElementById(n);a&&(a.classList.remove("error"),a.closest(".frm-flds")?.querySelector(".pb-input-error")?.remove())}}clearAllErrors(){l(this,rs,{}),document.querySelectorAll(".error").forEach(t=>t.classList.remove("error")),document.querySelectorAll(".pb-input-error").forEach(t=>t.remove()),s(this,Fi,Ja).call(this)}isSameAsShipping(){let t=document.querySelector('[os-checkout-field="same-as-shipping"] input[type="checkbox"]')||document.querySelector('[os-input-field="use-shipping-address"] input[type="checkbox"]')||document.querySelector("#use_shipping_address");return t?t.checked:!0}getSelectedPaymentMethod(){return document.querySelector('input[name="payment_method"]:checked')?.value||document.querySelector('input[name="combo_mode"]:checked')?.value||"credit"}getFormValues(){let t={};return e(this,Xt).querySelectorAll("input, select, textarea").forEach(i=>{if(["button","submit"].includes(i.type)||i.disabled||!i.name)return;let r=i.getAttribute("os-checkout-field")||i.name;if(i.type==="checkbox")t[r]=i.checked;else if(i.type==="radio")i.checked&&(t[r]=i.value);else if(r.includes(".")){let[n,a]=r.split(".");t[n]=t[n]||{},t[n][a]=i.value}else t[r]=i.value}),t}};Li=new WeakMap,Xt=new WeakMap,rs=new WeakMap,Pi=new WeakMap,ge=new WeakMap,ss=new WeakMap,qi=new WeakMap,ns=new WeakSet,al=function(){let t=document.querySelector('form[os-checkout="form"]')||document.querySelector("form#combo_form");return t||s(this,lt,_t).call(this,"warn","No checkout form found"),t},lt=new WeakSet,_t=function(t,i,...r){try{(e(this,Li)?.[t]||console[t]||console.log).call(console,`[${t.toUpperCase()}] ${i}`,...r)}catch(n){console.error("Error logging:",n)}},os=new WeakSet,cl=function(){e(this,Xt).addEventListener("submit",t=>s(this,ls,hl).call(this,t)),document.querySelector('[os-checkout-payment="combo"]')?.addEventListener("click",()=>{this.validateAllFields()&&e(this,Xt).submit()}),document.addEventListener("payment-method-changed",()=>this.clearAllErrors()),e(this,ge)&&typeof Spreedly.on=="function"&&s(this,as,ll).call(this)},as=new WeakSet,ll=function(){Object.entries({ready:()=>{l(this,qi,!0),s(this,lt,_t).call(this,"debug","Spreedly is ready")},paymentMethod:(i,r)=>{l(this,ss,!0),s(this,lt,_t).call(this,"debug","Spreedly payment method created"),s(this,Fi,Ja).call(this)},validation:i=>{s(this,lt,_t).call(this,"debug",`Spreedly field validation: ${i.fieldType} ${i.valid?"valid":"invalid"}`),i.valid&&this.clearErrorForField(document.getElementById(`spreedly-${i.fieldType}`))},errors:i=>{s(this,lt,_t).call(this,"debug","Spreedly validation errors:",i),i.forEach(r=>s(this,cs,dl).call(this,r))}}).forEach(([i,r])=>Spreedly.on(i,r))},cs=new WeakSet,dl=function(t){let i={number:"spreedly-number",card_number:"spreedly-number",cvv:"spreedly-cvv",month:"cc-month",year:"cc-year",full_name:"cc-name",first_name:"cc-name",last_name:"cc-name"},r=document.getElementById(i[t.attribute])||document.querySelector(`[os-checkout-field="${i[t.attribute]}"]`);r&&s(this,Fe,is).call(this,r,t.message)},ls=new WeakSet,hl=function(t){this.validateAllFields()||(t.preventDefault(),s(this,lt,_t).call(this,"warn","Form validation failed"))},ds=new WeakSet,ul=function(t){s(this,lt,_t).call(this,"debug","Starting field validation for payment method:",t),s(this,lt,_t).call(this,"debug","Same as shipping:",this.isSameAsShipping()),s(this,lt,_t).call(this,"debug","Spreedly enabled:",e(this,ge)),s(this,lt,_t).call(this,"debug","Spreedly ready:",e(this,qi))},hs=new WeakSet,ml=function(t,i){let r=null;for(let n of t){let a=n.getAttribute("os-checkout-field");if(s(this,us,gl).call(this,a,i)){this.clearErrorForField(n);continue}let c=n.previousElementSibling?.textContent||a||n.placeholder;s(this,ps,yl).call(this,n,c)||(r=r||n)}return r},us=new WeakSet,gl=function(t,i){return this.isSameAsShipping()&&t?.startsWith("billing-")||i&&["cc-number","cvv"].includes(t)},ms=new WeakSet,pl=function(){let[t,i]=s(this,gs,fl).call(this);return s(this,Mi,Ka).call(this,t,"month")&&s(this,Mi,Ka).call(this,i,"year")},gs=new WeakSet,fl=function(){let t=['[os-checkout-field="cc-month"]','[os-checkout-field="exp-month"]',"#credit_card_exp_month"],i=['[os-checkout-field="cc-year"]','[os-checkout-field="exp-year"]',"#credit_card_exp_year"];return[t.map(r=>document.querySelector(r)).find(Boolean),i.map(r=>document.querySelector(r)).find(Boolean)]},Mi=new WeakSet,Ka=function(t,i){return!t||!t.value?(s(this,lt,_t).call(this,"error",`${i} field is empty`),s(this,Fe,is).call(this,t,`Please select an expiration ${i}`),!1):!0},Fi=new WeakSet,Ja=function(){["cc-number","cvv"].forEach(t=>this.clearErrorForField(document.querySelector(`[os-checkout-field="${t}"]`))),["spreedly-number","spreedly-cvv"].forEach(t=>this.clearErrorForField(document.getElementById(t)))},ps=new WeakSet,yl=function(t,i){if(!t)return!0;let r=t.value.trim(),n=s(this,fs,bl).call(this,t,r,i);return n.isValid?this.clearErrorForField(t):s(this,Fe,is).call(this,t,n.errorMessage),n.isValid},fs=new WeakSet,bl=function(t,i,r){return t.tagName.toLowerCase()==="select"?{isValid:!!i,errorMessage:`Please select a ${r.toLowerCase()}`}:i?t.type==="tel"&&t.iti?{isValid:t.iti.isValidNumber(),errorMessage:"Please enter a valid phone number"}:t.type==="email"?{isValid:s(this,vs,wl).call(this,i),errorMessage:"Please enter a valid email address"}:{isValid:!0,errorMessage:""}:{isValid:!1,errorMessage:`${r} is required`}},Fe=new WeakSet,is=function(t,i){if(!t)return;t.classList.add("error");let r=t.closest(".frm-flds")||t.closest(".form-group")||t.parentElement,n=s(this,ys,vl).call(this,r);n.textContent=i,Object.assign(n.style,{color:"red",fontSize:"0.875rem",marginTop:"0.25rem"}),t.hasErrorListener||(t.hasErrorListener=!0,["input","change"].forEach(a=>t.addEventListener(a,()=>this.clearErrorForField(t))),t.type==="tel"&&t.iti&&t.addEventListener("countrychange",()=>this.clearErrorForField(t)))},ys=new WeakSet,vl=function(t){let i=t.querySelector(".pb-input-error");return i||(i=document.createElement("div"),i.className="pb-input-error",t.appendChild(i)),i},bs=new WeakSet,Sl=function(t){t&&(window.scrollTo({top:t.getBoundingClientRect().top+window.pageYOffset-100,behavior:"smooth"}),setTimeout(()=>t.focus(),500))},vs=new WeakSet,wl=function(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)};var Ni,Ui,Ue,ze,tt,Oe,De,_s,_l,Cs,Cl,zi,Ya,Es,El,xs,xl,Oi,Xa,Re,Ss,T,q,ws=class{constructor(t,i={}){o(this,_s);o(this,Cs);o(this,zi);o(this,Es);o(this,xs);o(this,Oi);o(this,Re);o(this,T);o(this,Ni,void 0);o(this,Ui,!1);o(this,Ue,!1);o(this,ze,null);o(this,tt,null);o(this,Oe,null);o(this,De,null);if(l(this,Ni,t),l(this,Ui,i.debug||!1),!t){s(this,T,q).call(this,"error","No environment key provided to SpreedlyManager");return}s(this,T,q).call(this,"debug",`SpreedlyManager initialized with environment key: ${t}`),s(this,_s,_l).call(this)}clearAllErrors(){s(this,Re,Ss).call(this,"number"),s(this,Re,Ss).call(this,"cvv");let t=document.querySelector('[os-checkout-field="cc-month"]')||document.querySelector('[os-checkout-field="exp-month"]')||document.querySelector("#credit_card_exp_month"),i=document.querySelector('[os-checkout-field="cc-year"]')||document.querySelector('[os-checkout-field="exp-year"]')||document.querySelector("#credit_card_exp_year");if(t){t.classList.remove("error");let n=(t.closest(".frm-flds")||t.parentElement).querySelector(".pb-input-error");n&&n.remove()}if(i){i.classList.remove("error");let n=(i.closest(".frm-flds")||i.parentElement).querySelector(".pb-input-error");n&&n.remove()}}tokenizeCard(t){if(s(this,T,q).call(this,"debug","Tokenizing card with data:",{...t,full_name:t.full_name,month:t.month,year:t.year}),this.clearAllErrors(),!t.full_name||!t.month||!t.year){s(this,T,q).call(this,"error","Missing required card data");let i=[];t.full_name||i.push({attribute:"full_name",message:"Cardholder name is required"}),t.month||i.push({attribute:"month",message:"Expiration month is required"}),t.year||i.push({attribute:"year",message:"Expiration year is required"}),s(this,Oi,Xa).call(this,i),e(this,tt)&&e(this,tt).call(this,i.map(r=>r.message));return}if(!e(this,Ue)){s(this,T,q).call(this,"error","Spreedly is not ready yet"),e(this,tt)&&e(this,tt).call(this,["Payment system is not ready yet. Please try again in a moment."]);return}try{Spreedly.tokenizeCreditCard(t),s(this,T,q).call(this,"debug","Card tokenization initiated")}catch(i){s(this,T,q).call(this,"error","Error tokenizing card",i),e(this,tt)&&e(this,tt).call(this,["An error occurred while processing your card. Please try again."])}}setOnReady(t){l(this,ze,t),e(this,Ue)&&t&&t()}setOnError(t){l(this,tt,t)}setOnPaymentMethod(t){l(this,Oe,t)}setOnValidation(t){l(this,De,t)}};Ni=new WeakMap,Ui=new WeakMap,Ue=new WeakMap,ze=new WeakMap,tt=new WeakMap,Oe=new WeakMap,De=new WeakMap,_s=new WeakSet,_l=function(){typeof Spreedly>"u"?(s(this,T,q).call(this,"debug","Spreedly not loaded, loading script..."),s(this,Cs,Cl).call(this).then(()=>{s(this,T,q).call(this,"debug","Spreedly script loaded"),s(this,zi,Ya).call(this)}).catch(t=>{s(this,T,q).call(this,"error","Failed to load Spreedly script",t),e(this,tt)&&e(this,tt).call(this,["Failed to load Spreedly. Please refresh the page and try again."])})):(s(this,T,q).call(this,"debug","Spreedly already loaded"),s(this,zi,Ya).call(this))},Cs=new WeakSet,Cl=function(){return new Promise((t,i)=>{let r=document.createElement("script");r.src="https://core.spreedly.com/iframe/iframe-v1.min.js",r.async=!0,r.onload=t,r.onerror=i,document.head.appendChild(r)})},zi=new WeakSet,Ya=function(){try{s(this,T,q).call(this,"debug","Setting up Spreedly..."),s(this,Es,El).call(this),Spreedly.init(e(this,Ni),{numberEl:"spreedly-number",cvvEl:"spreedly-cvv"});let t='color: #212529; font-size: 1rem; line-height: 1.5; font-weight: 400;       width: calc(100% - 20px); height: calc(100% - 2px); position: absolute;       font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue","Noto Sans","Liberation Sans",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";';Spreedly.on("ready",()=>{s(this,T,q).call(this,"debug","Spreedly iframe ready"),Spreedly.setFieldType("text"),Spreedly.setPlaceholder("cvv","CVV *"),Spreedly.setPlaceholder("number","Credit Card Number"),Spreedly.setNumberFormat("prettyFormat"),Spreedly.setStyle("cvv",t),Spreedly.setStyle("number",t),l(this,Ue,!0),e(this,ze)&&e(this,ze).call(this)}),s(this,xs,xl).call(this),s(this,T,q).call(this,"debug","Spreedly setup complete")}catch(t){s(this,T,q).call(this,"error","Error setting up Spreedly",t),e(this,tt)&&e(this,tt).call(this,["Failed to set up Spreedly. Please refresh the page and try again."])}},Es=new WeakSet,El=function(){try{s(this,T,q).call(this,"debug","Preparing HTML structure for Spreedly iframe fields");let t=document.querySelector('[os-checkout-field="cc-number"]'),i=document.querySelector('[os-checkout-field="cvv"]');if(!t||!i){s(this,T,q).call(this,"error","Could not find credit card fields");return}let r=t.closest(".frm-flds"),n=i.closest(".frm-flds");if(r&&n){t.style.display="none",i.style.display="none";let a=document.createElement("div");a.id="spreedly-number",a.className="input-flds spreedly-field",r.appendChild(a);let c=document.createElement("div");c.id="spreedly-cvv",c.className="input-flds spreedly-field",n.appendChild(c);let d=document.createElement("style");d.textContent=`
          .spreedly-field {
            position: relative;
            overflow: hidden;
          }
        `,document.head.appendChild(d)}else s(this,T,q).call(this,"error","Could not find credit card field containers");s(this,T,q).call(this,"debug","HTML structure prepared for Spreedly iframe fields")}catch(t){s(this,T,q).call(this,"error","Error preparing HTML structure for Spreedly iframe fields",t)}},xs=new WeakSet,xl=function(){Spreedly.on("errors",t=>{s(this,T,q).call(this,"error","Spreedly validation errors:",t);let i=t.map(r=>r.message);e(this,tt)&&e(this,tt).call(this,i),s(this,Oi,Xa).call(this,t)}),Spreedly.on("paymentMethod",(t,i)=>{s(this,T,q).call(this,"debug","Spreedly payment method created:",t),this.clearAllErrors(),e(this,Oe)&&e(this,Oe).call(this,t,i)}),Spreedly.on("validation",t=>{s(this,T,q).call(this,"debug","Spreedly field validation:",t),s(this,Re,Ss).call(this,t.fieldType),e(this,De)&&e(this,De).call(this,t)})},Oi=new WeakSet,Xa=function(t){t.forEach(i=>{let r=i.attribute,n=null;if(r==="number"||r==="card_number"?n=document.getElementById("spreedly-number"):r==="cvv"?n=document.getElementById("spreedly-cvv"):r==="month"||r==="year"?n=document.querySelector(`[os-checkout-field="cc-${r}"]`)||document.querySelector(`[os-checkout-field="exp-${r}"]`)||document.querySelector(`#credit_card_exp_${r}`):(r==="full_name"||r==="first_name"||r==="last_name")&&(n=document.querySelector('[os-checkout-field="cc-name"]')),n){n.classList.add("error");let a=n.closest(".frm-flds")||n.parentElement,c=a.querySelector(".pb-input-error");c||(c=document.createElement("div"),c.className="pb-input-error",a.appendChild(c)),c.textContent=i.message,c.style.color="red",c.style.fontSize="0.875rem",c.style.marginTop="0.25rem"}})},Re=new WeakSet,Ss=function(t){let i=null;if(t==="number"||t==="card_number"?i=document.getElementById("spreedly-number"):t==="cvv"&&(i=document.getElementById("spreedly-cvv")),i){i.classList.remove("error");let n=(i.closest(".frm-flds")||i.parentElement).querySelector(".pb-input-error");n&&n.remove()}},T=new WeakSet,q=function(t,i,r){if(e(this,Ui)||t==="error"){let n="[SpreedlyManager]";r?console[t](`${n} ${i}`,r):console[t](`${n} ${i}`)}};var Zt,Ct,pe,M,We,He,ks,kl,Ts,Tl,Et=class{constructor({callback:t,logger:i}={}){o(this,ks);o(this,Ts);o(this,Zt,["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"]);o(this,Ct,0);o(this,pe,void 0);o(this,M,void 0);o(this,We,void 0);o(this,He,void 0);l(this,We,i),l(this,He,t),s(this,ks,kl).call(this),s(this,Ts,Tl).call(this),e(this,We)&&e(this,We).debug("KonamiCodeHandler initialized")}static setTestMode(){return sessionStorage.setItem("konami_test_mode","true"),!0}static isTestMode(){return sessionStorage.getItem("konami_test_mode")==="true"}static clearTestMode(){sessionStorage.removeItem("konami_test_mode")}static getTestOrderData(t,i,r){try{let n=t?.cart?.items||[],a=i?i():1,c=n.length>0&&r?r(n):[{package_id:a||1,quantity:1}];return{user:{email:"test@test.com",first_name:"Test",last_name:"Order"},shipping_address:{first_name:"Test",last_name:"Order",line1:"Test Address 123",line2:"",line3:"",line4:"Tempe",state:"AZ",postcode:"85281",country:"US",phone_number:"+14807581224"},billing_address:{first_name:"Test",last_name:"Order",line1:"Test Address 123",line2:"",line3:"",line4:"Tempe",state:"AZ",postcode:"85281",country:"US",phone_number:"+14807581224"},shipping_method:1,attribution:t?.cart?.attribution||{},lines:c,success_url:window.location.origin+"/checkout/confirmation/"}}catch(n){return console.error("Error getting Konami test order data:",n),null}}static showActivationMessage(){let t=document.createElement("div");return t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.background="rgba(0, 0, 0, 0.8)",t.style.color="#fff",t.style.padding="20px",t.style.borderRadius="10px",t.style.zIndex="9999",t.style.textAlign="center",t.style.fontFamily="monospace",t.style.fontSize="18px",t.innerHTML=`
      <h3>ðŸŽ® KONAMI CODE ACTIVATED! ðŸŽ®</h3>
      <p>Creating test order with predefined data:</p>
      <p style="font-size: 14px; margin-top: 10px; text-align: left;">
        Email: test@test.com<br>
        Name: Test Order<br>
        Address: Test Address 123<br>
        City: Tempe, AZ 85281<br>
        Country: US<br>
        Phone: +14807581224<br>
        Card: 4111111111111111 (test mode)
      </p>
    `,document.body.appendChild(t),t}};Zt=new WeakMap,Ct=new WeakMap,pe=new WeakMap,M=new WeakMap,We=new WeakMap,He=new WeakMap,ks=new WeakSet,kl=function(){l(this,M,document.createElement("div")),e(this,M).style.position="fixed",e(this,M).style.bottom="10px",e(this,M).style.right="10px",e(this,M).style.background="rgba(0, 0, 0, 0.7)",e(this,M).style.color="#fff",e(this,M).style.padding="5px 10px",e(this,M).style.borderRadius="5px",e(this,M).style.fontFamily="monospace",e(this,M).style.fontSize="12px",e(this,M).style.zIndex="9999",e(this,M).style.display="none",e(this,M).textContent="Konami: 0/"+e(this,Zt).length,document.body.appendChild(e(this,M))},Ts=new WeakSet,Tl=function(){document.addEventListener("keydown",t=>{t.key===e(this,Zt)[e(this,Ct)]?(Wc(this,Ct)._++,e(this,Ct)>=4&&(e(this,M).style.display="block",e(this,M).textContent=`Konami: ${e(this,Ct)}/${e(this,Zt).length}`),e(this,Ct)===e(this,Zt).length&&(e(this,He)&&e(this,He).call(this),l(this,Ct,0),setTimeout(()=>{e(this,M).style.display="none"},500)),e(this,Ct)>=4&&(clearTimeout(e(this,pe)),l(this,pe,setTimeout(()=>{e(this,M).style.display="none"},3e3)))):e(this,Ct)>0&&(l(this,Ct,0),e(this,M).style.display==="block"&&(e(this,M).textContent=`Konami: 0/${e(this,Zt).length}`,clearTimeout(e(this,pe)),l(this,pe,setTimeout(()=>{e(this,M).style.display="none"},1500))))})};var je,Ve,Qt,R,Dt,ye,xt,be,Ge,$s,Is,Al,Ls,$l,ve,Di,Ps,Il,qs,Ll,F,U,Ms,Pl,Fs,ql,Ns,Ml,Us,Fl,zs,Nl,Os,Ul,Ds,zl,Rs,Ol,Ws,Dl,Wi,Za,Hi,Qa,Rt,fe,Hs,Rl,Bs,Wl,js,Hl,Vs,Bl,Gs,jl,Bi,tc,te,Be,ji,ec,Vi,ic,Ks,Vl,Gi,rc,Se,Ri,Js,Gl,Ys,Kl,Xs,Jl,bt,$t,Zs,Yl,Ki,sc,Qs,Xl,tn,Zl,As=class{constructor(t,i,r){o(this,Is);o(this,Ls);o(this,ve);o(this,Ps);o(this,qs);o(this,F);o(this,Ms);o(this,Fs);o(this,Ns);o(this,Us);o(this,zs);o(this,Os);o(this,Ds);o(this,Rs);o(this,Ws);o(this,Wi);o(this,Hi);o(this,Rt);o(this,Hs);o(this,Bs);o(this,js);o(this,Vs);o(this,Gs);o(this,Bi);o(this,te);o(this,ji);o(this,Vi);o(this,Ks);o(this,Gi);o(this,Se);o(this,Js);o(this,Ys);o(this,Xs);o(this,bt);o(this,Zs);o(this,Ki);o(this,Qs);o(this,tn);o(this,je,void 0);o(this,Ve,void 0);o(this,Qt,void 0);o(this,R,void 0);o(this,Dt,null);o(this,ye,null);o(this,xt,"credit-card");o(this,be,!1);o(this,Ge,!1);o(this,$s,{visa:"4111111111111111",mastercard:"5555555555554444",amex:"378282246310005",discover:"6011111111111117"});l(this,je,t),l(this,Ve,i),l(this,Qt,r),l(this,R,s(this,Is,Al).call(this)),e(this,R)&&(s(this,Ls,$l).call(this),s(this,qs,Ll).call(this),l(this,ye,new Ne({debugMode:e(this,Ge),logger:e(this,Ve)})),e(this,R).__formValidator=e(this,ye),s(this,Ms,Pl).call(this),s(this,Ns,Ml).call(this))}setKonamiTestMode(){return Et.setTestMode(),s(this,F,U).call(this,"info","ðŸŽ® Konami code test mode activated"),!0}processPayment(){let t=Et.isTestMode();if(t&&(Et.clearTestMode(),s(this,F,U).call(this,"info","ðŸŽ® Processing payment in Konami test mode")),e(this,be)){s(this,F,U).call(this,"warn","Payment already processing");return}s(this,Ki,sc).call(this),s(this,Wi,Za).call(this),l(this,be,!0),s(this,F,U).call(this,"debug",`Processing payment with method: ${e(this,xt)}`);try{if(t||s(this,Ws,Dl).call(this)){s(this,Hi,Qa).call(this);let r=t?Et.getTestOrderData(e(this,Qt)?.state?.getState(),s(this,Bi,tc).bind(this),s(this,Gi,rc).bind(this)):s(this,te,Be).call(this);if(!r){s(this,Rt,fe).call(this);return}s(this,Se,Ri).call(this,{...r,payment_detail:{payment_method:"card_token",card_token:"test_card"}});return}if(!e(this,ye).validateAllFields(e(this,xt))){l(this,be,!1),s(this,Rt,fe).call(this);return}if(s(this,Hi,Qa).call(this),!s(this,te,Be).call(this))return;switch(e(this,xt)){case"credit-card":case"credit":s(this,Hs,Rl).call(this);break;case"paypal":s(this,Gs,jl).call(this);break;default:s(this,bt,$t).call(this,`Unknown payment method: ${e(this,xt)}`)}}catch(i){s(this,F,U).call(this,"error","Error processing payment:",i),s(this,bt,$t).call(this,"Unexpected error occurred"),s(this,Rt,fe).call(this)}}};je=new WeakMap,Ve=new WeakMap,Qt=new WeakMap,R=new WeakMap,Dt=new WeakMap,ye=new WeakMap,xt=new WeakMap,be=new WeakMap,Ge=new WeakMap,$s=new WeakMap,Is=new WeakSet,Al=function(){let t=document.querySelector('form[os-checkout="form"]')||document.querySelector("form#combo_form");return t||s(this,F,U).call(this,"warn","No checkout form found"),t},Ls=new WeakSet,$l=function(){e(this,R).removeAttribute("action"),e(this,R).setAttribute("method","post");let t=document.createElement("input");t.type="hidden",t.name="prevent_serialization",t.value="true",e(this,R).appendChild(t),e(this,R).addEventListener("submit",s(this,ve,Di).bind(this),!0),e(this,R).onsubmit=s(this,ve,Di).bind(this),s(this,Ps,Il).call(this)},ve=new WeakSet,Di=function(t){return t&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()),e(this,R).removeAttribute("action"),e(this,R).setAttribute("method","post"),window.stop?.(),s(this,F,U).call(this,"debug","Form submission prevented"),!1},Ps=new WeakSet,Il=function(){try{e(this,R).querySelectorAll('button[type="submit"], input[type="submit"]').forEach((i,r)=>{i.setAttribute("type","button"),i.addEventListener("click",n=>{n.preventDefault(),s(this,F,U).call(this,"debug",`Submit button ${r+1} clicked`),this.processPayment()})})}catch(t){s(this,F,U).call(this,"error","Error converting submit buttons:",t)}},qs=new WeakSet,Ll=function(){let t=document.querySelector('[os-checkout-payment="combo"]');if(!t){s(this,F,U).call(this,"warn","Checkout button not found");return}let i=t.cloneNode(!0);t.parentNode.replaceChild(i,t),i.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation(),e(this,R).onsubmit=s(this,ve,Di).bind(this),e(this,R).removeAttribute("action"),e(this,R).setAttribute("method","post"),s(this,F,U).call(this,"debug","Checkout button clicked"),setTimeout(()=>this.processPayment(),0)})},F=new WeakSet,U=function(t,i,...r){try{(e(this,Ve)?.[t]||console[t]||console.log).call(console,`[${t.toUpperCase()}] ${i}`,...r)}catch(n){console.error("Error logging:",n)}},Ms=new WeakSet,Pl=function(){try{let t=document.querySelector('[os-checkout-field="payment-method"]')||document.querySelector('input[name="combo_mode"]:checked');if(!t){s(this,F,U).call(this,"warn","Payment method selector not found");return}l(this,xt,t.value||"credit-card"),s(this,Fs,ql).call(this)}catch(t){s(this,F,U).call(this,"error","Error initializing payment methods:",t)}},Fs=new WeakSet,ql=function(){let t=document.querySelectorAll('input[name="combo_mode"]'),i=r=>{l(this,xt,r.target.value),s(this,F,U).call(this,"debug",`Payment method changed to: ${e(this,xt)}`),document.dispatchEvent(new CustomEvent("payment-method-changed",{detail:{mode:e(this,xt)}}))};t.length>0?t.forEach(r=>r.addEventListener("change",i)):document.querySelector('[os-checkout-field="payment-method"]')?.addEventListener("change",i)},Ns=new WeakSet,Ml=function(){try{let t=document.querySelector('meta[name="spreedly-environment-key"]')?.content||document.querySelector('meta[name="os-payment-env-key"]')?.content;if(!t){s(this,F,U).call(this,"warn","Spreedly environment key not found");return}l(this,Dt,new ws(t,{debug:e(this,Ge)})),s(this,Us,Fl).call(this),s(this,Os,Ul).call(this)}catch(t){s(this,F,U).call(this,"error","Error initializing Spreedly:",t)}},Us=new WeakSet,Fl=function(){e(this,Dt).setOnReady(()=>s(this,F,U).call(this,"debug","Spreedly ready")),e(this,Dt).setOnError(t=>{s(this,F,U).call(this,"error","Spreedly errors:",t);let i=s(this,zs,Nl).call(this,t);s(this,bt,$t).call(this,i)}),e(this,Dt).setOnPaymentMethod((t,i)=>{s(this,F,U).call(this,"debug","Spreedly payment method token received:",t),s(this,Se,Ri).call(this,{payment_token:t,payment_method:"credit-card",...s(this,te,Be).call(this)})})},zs=new WeakSet,Nl=function(t){if(!t||t.length===0)return"An unknown error occurred with your payment method";let i={"The card number is not a valid credit card number":"Please enter a valid credit card number","The card number is too short":"The card number you entered is too short","The card number is too long":"The card number you entered is too long","The card security code is invalid":"Please enter a valid security code (CVV)","The card security code is too short":"The security code (CVV) is too short","The card security code is too long":"The security code (CVV) is too long","The card has expired":"This card has expired. Please use a different card","The card expiration month is invalid":"Please select a valid expiration month","The card expiration year is invalid":"Please select a valid expiration year"};for(let r of t)for(let[n,a]of Object.entries(i))if(r.includes(n))return a;return t[0]},Os=new WeakSet,Ul=function(){try{let[t,i]=s(this,Ds,zl).call(this);s(this,Rs,Ol).call(this,t,i)}catch(t){s(this,F,U).call(this,"error","Error initializing expiration fields:",t)}},Ds=new WeakSet,zl=function(){let t=['[os-checkout-field="cc-month"]','[os-checkout-field="exp-month"]',"#credit_card_exp_month"],i=['[os-checkout-field="cc-year"]','[os-checkout-field="exp-year"]',"#credit_card_exp_year"];return[t.map(r=>document.querySelector(r)).find(Boolean),i.map(r=>document.querySelector(r)).find(Boolean)]},Rs=new WeakSet,Ol=function(t,i){if(t){t.innerHTML='<option value="">Month</option>';for(let r=1;r<=12;r++){let n=r.toString().padStart(2,"0");t.appendChild(new Option(n,n))}}if(i){i.innerHTML='<option value="">Year</option>';let r=new Date().getFullYear();for(let n=0;n<20;n++){let a=r+n;i.appendChild(new Option(a,a))}}},Ws=new WeakSet,Dl=function(){return new URLSearchParams(window.location.search).get("test")==="true"||Et.isTestMode()},Wi=new WeakSet,Za=function(){e(this,R)?.removeAttribute("action"),e(this,R)?.setAttribute("method","post"),e(this,R).onsubmit=s(this,ve,Di).bind(this),e(this,R)?.querySelectorAll('button[type="submit"], input[type="submit"]').forEach(t=>{t.disabled=!0,t.setAttribute("type","button")})},Hi=new WeakSet,Qa=function(){let t=document.querySelector('[os-checkout-payment="combo"]');t&&(t.disabled=!0,t.classList.add("is-submitting"))},Rt=new WeakSet,fe=function(){let t=document.querySelector('[os-checkout-payment="combo"]');t&&(t.disabled=!1,t.classList.remove("is-submitting")),l(this,be,!1)},Hs=new WeakSet,Rl=function(){if(!e(this,Dt)){s(this,bt,$t).call(this,"Credit card processing unavailable");return}let[t,i,r]=s(this,Bs,Wl).call(this);if(!i||!r){s(this,bt,$t).call(this,"Please select expiration month and year");return}s(this,js,Hl).call(this)?s(this,Vs,Bl).call(this,t,i,r):e(this,Dt).tokenizeCard({full_name:t||"Test User",month:i,year:r})},Bs=new WeakSet,Wl=function(){return[document.querySelector('[os-checkout-field="cc-name"]')?.value||"",document.querySelector('[os-checkout-field="cc-month"]')?.value||document.querySelector('[os-checkout-field="exp-month"]')?.value||document.querySelector("#credit_card_exp_month")?.value||"",document.querySelector('[os-checkout-field="cc-year"]')?.value||document.querySelector('[os-checkout-field="exp-year"]')?.value||document.querySelector("#credit_card_exp_year")?.value||""]},js=new WeakSet,Hl=function(){let t=new URLSearchParams(window.location.search);return(e(this,Ge)||t.get("debug")==="true")&&t.has("test-card")},Vs=new WeakSet,Bl=function(t,i,r){let n=new URLSearchParams(window.location.search).get("test-card"),a=e(this,$s)[n];a&&s(this,Se,Ri).call(this,{payment_token:`test_card_token_${n}_${Date.now()}`,payment_method:"credit-card",test_card_type:n,test_card_number:a,...s(this,te,Be).call(this)})},Gs=new WeakSet,jl=function(){s(this,Se,Ri).call(this,{payment_method:"paypal",...s(this,te,Be).call(this)})},Bi=new WeakSet,tc=function(){let t=new URLSearchParams(window.location.search),i=t.get("package_id")||t.get("pid");return i&&parseInt(i,10)||null},te=new WeakSet,Be=function(){try{let t=s(this,ji,ec).call(this,["fname","lname","address1","address2","city","province","postal","country","phone"]),i=e(this,ye).isSameAsShipping()?null:s(this,ji,ec).call(this,["billing-fname","billing-lname","billing-address1","billing-address2","billing-city","billing-province","billing-postal","billing-country","billing-phone"]),r=s(this,Vi,ic).call(this,t),n=i?s(this,Vi,ic).call(this,i):{...r};if(!e(this,Qt)?.state)return s(this,bt,$t).call(this,"Cart data missing"),null;let a=e(this,Qt).state.getState();return a.cart?.items?.length?{user:{email:a.user?.email||"",first_name:a.user?.firstName||r.first_name,last_name:a.user?.lastName||r.last_name},shipping_address:r,billing_address:n,shipping_method:s(this,Ks,Vl).call(this,a),attribution:a.cart.attribution||{},lines:s(this,Gi,rc).call(this,a.cart.items)}:(s(this,bt,$t).call(this,"Cart is empty"),null)}catch(t){return s(this,F,U).call(this,"error","Error getting order data:",t),s(this,bt,$t).call(this,"Error preparing order"),null}},ji=new WeakSet,ec=function(t){let i={};return t.forEach(r=>{let n=document.querySelector(`[os-checkout-field="${r}"]`)?.value;n&&(i[r.replace("billing-","")]=n)}),i},Vi=new WeakSet,ic=function(t){return{first_name:t.fname||"",last_name:t.lname||"",line1:t.address1||"",line2:t.address2||"",line3:"",line4:t.city||"",state:t.province||"",postcode:t.postal||"",country:t.country||"",phone_number:t.phone||""}},Ks=new WeakSet,Vl=function(t){let i=t.cart?.shippingMethod;return typeof i=="number"?i:parseInt(i,10)||1},Gi=new WeakSet,rc=function(t){return t.map(i=>{let r=parseInt(i.id||i.external_id,10)||s(this,Bi,tc).call(this);if(!r)throw new Error(`Invalid package ID for item: ${i.name}`);return{package_id:r,quantity:i.quantity||1}})},Se=new WeakSet,Ri=function(t){if(!t||!e(this,je)){s(this,bt,$t).call(this,"Cannot create order"),s(this,Rt,fe).call(this);return}s(this,Wi,Za).call(this);let i=s(this,Js,Gl).call(this,t);e(this,je).createOrder(i).then(r=>s(this,Qs,Xl).call(this,r)).catch(r=>s(this,bt,$t).call(this,s(this,Ys,Kl).call(this,r))).finally(()=>s(this,Rt,fe).call(this))},Js=new WeakSet,Gl=function(t){let i={...t,success_url:t.success_url||window.location.origin+"/checkout/confirmation/"};return t.payment_token&&(i.payment_detail={card_token:t.payment_token},delete i.payment_token),t.payment_method&&(i.payment_detail=i.payment_detail||{},i.payment_detail.payment_method={"credit-card":"card_token",credit:"card_token",paypal:"paypal"}[t.payment_method]||t.payment_method,delete i.payment_method),i.shipping_method=parseInt(i.shipping_method,10)||1,i.billing_address=i.billing_address||i.shipping_address,i},Ys=new WeakSet,Kl=function(t){try{let i=JSON.parse(t.message);if(i?.payment_details)return s(this,Xs,Jl).call(this,i);if(i?.message)return`Order creation failed: ${Array.isArray(i.message)?i.message.map(r=>Object.entries(r).map(([n,a])=>`${n}: ${a}`).join(", ")).join(", "):Object.entries(i.message).map(([r,n])=>`${r}: ${n}`).join(", ")}`}catch{return t.message||"Unknown error"}return"Order creation failed"},Xs=new WeakSet,Jl=function(t){let i=t.payment_response_code,r=t.payment_details;return{3005:"The card number you entered is invalid. Please check and try again.",3006:"The card expiration date is invalid. Please check and try again.",3007:"The card security code (CVV) is invalid. Please check and try again.",3008:"The card has been declined. Please try another payment method.",3009:"This card has expired. Please use a different card.",3010:"The card has insufficient funds. Please try another payment method."}[i]||r||"There was a problem processing your payment. Please try again."},bt=new WeakSet,$t=function(t){s(this,Rt,fe).call(this),s(this,Ki,sc).call(this),e(this,xt)==="credit-card"&&(t.includes("card")||t.includes("Card")||t.includes("CVV"))&&s(this,Zs,Yl).call(this,t);let r=document.querySelector('[os-checkout-element="payment-error"]');r?(r.textContent=t,r.style.display="block",r.scrollIntoView({behavior:"smooth",block:"center"})):alert(`Payment Error: ${t}`)},Zs=new WeakSet,Yl=function(t){let i='[os-checkout-field="cc-number"]',r="#credit_card_number";t.toLowerCase().includes("cvv")||t.toLowerCase().includes("security code")?(i='[os-checkout-field="cc-cvv"]',r="#credit_card_cvv"):(t.toLowerCase().includes("expiration")||t.toLowerCase().includes("expired"))&&(i='[os-checkout-field="cc-month"], [os-checkout-field="cc-year"]',r="#credit_card_exp_month, #credit_card_exp_year");let n=i.split(",").map(d=>d.trim()),a=r.split(",").map(d=>d.trim());[...n,...a].forEach(d=>{let h=document.querySelector(d);if(!h)return;let p=h.closest(".form-group")||h.parentElement;if(!p)return;h.classList.add("is-invalid");let v=p.querySelector(".invalid-feedback");v||(v=document.createElement("div"),v.className="invalid-feedback",p.appendChild(v)),v.textContent=t,v.style.display="block"});let c=document.querySelector(n[0])||document.querySelector(a[0]);c&&(c.focus(),c.scrollIntoView({behavior:"smooth",block:"center"}))},Ki=new WeakSet,sc=function(){['[os-checkout-field="cc-number"]',"#credit_card_number",'[os-checkout-field="cc-cvv"]',"#credit_card_cvv",'[os-checkout-field="cc-month"]',"#credit_card_exp_month",'[os-checkout-field="cc-year"]',"#credit_card_exp_year"].forEach(r=>{let n=document.querySelector(r);if(!n)return;n.classList.remove("is-invalid");let a=n.closest(".form-group")||n.parentElement;if(a){let c=a.querySelector(".invalid-feedback");c&&(c.style.display="none")}});let i=document.querySelector('[os-checkout-element="payment-error"]');i&&(i.style.display="none")},Qs=new WeakSet,Xl=function(t){sessionStorage.setItem("order_reference",t.ref_id),e(this,Qt)?.triggerEvent?.("order.created",t);let i=s(this,tn,Zl).call(this,t);window.location.href=i},tn=new WeakSet,Zl=function(t){let i=document.querySelector('meta[name="os-next-page"]')?.content;return i?`${i}${i.includes("?")?"&":"?"}ref_id=${t.ref_id}`:t.confirmation_url||t.order_status_url||`/checkout/confirmation/?ref_id=${t.ref_id}`};var rn,z,vt,E,we,ee,_e,Wt,Ht,sn,Ql,et,dt,nn,td,Yi,nc,Xi,oc,on,ed,an,id,Ce,Ji,ac,lu,en=class{constructor(t){o(this,sn);o(this,et);o(this,nn);o(this,Yi);o(this,Xi);o(this,on);o(this,an);o(this,Ce);o(this,ac);o(this,rn,void 0);o(this,z,void 0);o(this,vt,void 0);o(this,E,void 0);o(this,we,{});o(this,ee,{});o(this,_e,{fname:"billing-fname",lname:"billing-lname",address1:"billing-address1",address2:"billing-address2",city:"billing-city",province:"billing-province",postal:"billing-postal",country:"billing-country",phone:"billing-phone"});o(this,Wt,!1);o(this,Ht,null);l(this,rn,t),t?.logger?typeof t.logger.debug=="function"&&typeof t.logger.info=="function"&&typeof t.logger.warn=="function"&&typeof t.logger.error=="function"?l(this,z,t.logger):l(this,z,t.logger.createModuleLogger?t.logger.createModuleLogger("BILLING"):console):l(this,z,console),s(this,sn,Ql).call(this)}copyShippingToBilling(){try{Object.entries(e(this,we)).forEach(([t,i])=>{let r=e(this,_e)[t],n=e(this,ee)[r];n&&i&&(n.value=i.value,n.dispatchEvent(new Event("change",{bubbles:!0})))}),s(this,et,dt).call(this,"Copied shipping address to billing address")}catch(t){s(this,Xi,oc).call(this,"Error copying shipping to billing:",t)}}getBillingAddressData(){if(e(this,vt)&&e(this,vt).checked)return null;let t={};return Object.entries(e(this,ee)).forEach(([i,r])=>{let n=i.replace("billing-","");t[n]=r.value}),t}isSameAsShipping(){let t=e(this,vt)?e(this,vt).checked:!0;return s(this,et,dt).call(this,`Billing address is ${t?"same as":"different from"} shipping`),t}};rn=new WeakMap,z=new WeakMap,vt=new WeakMap,E=new WeakMap,we=new WeakMap,ee=new WeakMap,_e=new WeakMap,Wt=new WeakMap,Ht=new WeakMap,sn=new WeakSet,Ql=function(){try{if(l(this,vt,document.querySelector('[os-checkout-field="same-as-shipping"]')||document.querySelector('[name="use_shipping_address"]')||document.querySelector("#use_shipping_address")),l(this,E,document.querySelector('[os-checkout-element="different-billing-address"]')),!e(this,vt)){s(this,Yi,nc).call(this,'Same as shipping checkbox not found. Tried multiple selectors including [name="use_shipping_address"] and #use_shipping_address');let t=document.querySelectorAll('input[type="checkbox"]');s(this,et,dt).call(this,`Found ${t.length} checkboxes on the page:`),t.forEach((i,r)=>{s(this,et,dt).call(this,`Checkbox ${r+1}: id=${i.id}, name=${i.name}, class=${i.className}`)});return}if(!e(this,E))if(s(this,Yi,nc).call(this,'Billing form container not found with selector [os-checkout-element="different-billing-address"]'),l(this,E,document.querySelector(".billing_form-container")),e(this,E))s(this,nn,td).call(this,"Found billing form container with alternative selector .billing_form-container");else return;s(this,et,dt).call(this,"BillingAddressHandler initialized"),s(this,on,ed).call(this),l(this,Ht,e(this,vt).checked),s(this,Ce,Ji).call(this,e(this,Ht),!1),s(this,an,id).call(this)}catch(t){s(this,Xi,oc).call(this,"Error initializing BillingAddressHandler:",t)}},et=new WeakSet,dt=function(t,...i){typeof e(this,z).debug=="function"?e(this,z).debug(t,...i):typeof e(this,z).log=="function"&&e(this,z).log(t,...i)},nn=new WeakSet,td=function(t,...i){typeof e(this,z).info=="function"?e(this,z).info(t,...i):typeof e(this,z).log=="function"&&e(this,z).log(t,...i)},Yi=new WeakSet,nc=function(t,...i){typeof e(this,z).warn=="function"?e(this,z).warn(t,...i):typeof e(this,z).log=="function"&&e(this,z).log(`WARNING: ${t}`,...i)},Xi=new WeakSet,oc=function(t,i){typeof e(this,z).error=="function"?e(this,z).error(t,i):typeof e(this,z).log=="function"?e(this,z).log(`ERROR: ${t}`,i):console.error(t,i)},on=new WeakSet,ed=function(){Object.keys(e(this,_e)).forEach(t=>{let i=document.querySelector(`[os-checkout-field="${t}"]`);i&&(e(this,we)[t]=i)}),Object.values(e(this,_e)).forEach(t=>{let i=document.querySelector(`[os-checkout-field="${t}"]`);i&&(e(this,ee)[t]=i)}),s(this,et,dt).call(this,`Cached ${Object.keys(e(this,we)).length} shipping fields and ${Object.keys(e(this,ee)).length} billing fields`)},an=new WeakSet,id=function(){e(this,vt).addEventListener("change",t=>{e(this,Wt)||(l(this,Ht,t.target.checked),s(this,Ce,Ji).call(this,t.target.checked,!0),t.target.checked&&this.copyShippingToBilling(),s(this,et,dt).call(this,`Billing address changed: ${t.target.checked?"Same as shipping":"Different from shipping"}`))}),document.addEventListener("payment-method-changed",()=>{e(this,Ht)!==null&&!e(this,Wt)&&(s(this,Ce,Ji).call(this,e(this,Ht),!1),s(this,et,dt).call(this,`Payment method changed, billing address state: ${e(this,Ht)?"Same as shipping":"Different from shipping"}`))}),Object.entries(e(this,we)).forEach(([t,i])=>{i.addEventListener("change",()=>{if(e(this,vt).checked){let r=e(this,_e)[t],n=e(this,ee)[r];n&&(n.value=i.value,n.dispatchEvent(new Event("change",{bubbles:!0})))}})})},Ce=new WeakSet,Ji=function(t,i=!0){if(!e(this,E)||e(this,Wt))return;l(this,Wt,!0),e(this,E).style.transition||(e(this,E).style.transition="height 0.3s ease-out, opacity 0.3s ease-out");let r=n=>{n.propertyName==="height"&&(t||(e(this,E).style.height="auto"),e(this,E).style.overflow="",l(this,Wt,!1),e(this,E).removeEventListener("transitionend",r),s(this,et,dt).call(this,`Billing form transition completed: ${t?"collapsed":"expanded"}`))};i?(e(this,E).removeEventListener("transitionend",r),t?(e(this,E).style.height=`${e(this,E).scrollHeight}px`,e(this,E).style.overflow="hidden",requestAnimationFrame(()=>{e(this,E).style.height="0px",e(this,E).style.opacity="0",s(this,et,dt).call(this,"Collapsing billing form")}),e(this,E).addEventListener("transitionend",r),e(this,E).addEventListener("transitionend",n=>{n.propertyName==="height"&&t&&(e(this,E).style.display="none",s(this,et,dt).call(this,"Billing form hidden after collapse"))},{once:!0})):(e(this,E).style.display="flex",e(this,E).style.height="0px",e(this,E).style.overflow="hidden",requestAnimationFrame(()=>{let n=e(this,E).scrollHeight;e(this,E).style.height=`${n}px`,e(this,E).style.opacity="1",s(this,et,dt).call(this,`Expanding billing form to height: ${n}px`)}),e(this,E).addEventListener("transitionend",r))):(e(this,E).style.display=t?"none":"flex",e(this,E).style.height=t?"0":"auto",e(this,E).style.opacity=t?"0":"1",e(this,E).style.overflow="",l(this,Wt,!1),s(this,et,dt).call(this,`Set billing form without animation: ${t?"hidden":"visible"}`))},ac=new WeakSet,lu=function(){s(this,Ce,Ji).call(this,e(this,vt).checked,!1)};var ie,Ee,Ke,Je,re,ln,dn,rd,Zi,cc,cn=class{constructor(t){o(this,dn);o(this,Zi);o(this,ie,void 0);o(this,Ee,void 0);o(this,Ke,void 0);o(this,Je,void 0);o(this,re,new Map);o(this,ln,null);l(this,ie,t),l(this,Ee,document.querySelector("[os-payment-mode]")),l(this,Ke,document.querySelectorAll('input[name="combo_mode"]')),l(this,Je,document.querySelectorAll('[os-checkout-element$="-form"]')),e(this,Ee)&&e(this,Ke).length>0?(e(this,ie).debug("PaymentSelector initialized with elements found"),s(this,dn,rd).call(this)):e(this,ie).warn("PaymentSelector elements not found")}};ie=new WeakMap,Ee=new WeakMap,Ke=new WeakMap,Je=new WeakMap,re=new WeakMap,ln=new WeakMap,dn=new WeakSet,rd=function(){let t=document.querySelector('input[name="combo_mode"]:checked');t&&e(this,Ee)&&s(this,Zi,cc).call(this,t.value,!1),e(this,Ke).forEach(i=>i.addEventListener("change",r=>s(this,Zi,cc).call(this,r.target.value,!0))),e(this,ie).debug("PaymentSelector event listeners attached")},Zi=new WeakSet,cc=function(t,i=!0){e(this,ie).debug(`Setting payment mode to: ${t}, animate: ${i}`),e(this,Ee)?.setAttribute("os-payment-mode",t),l(this,ln,t),e(this,Je).forEach(r=>{r.style.transition="none",r.offsetHeight,r.style.transition=""}),e(this,Je).forEach(r=>{let a=r.getAttribute("os-checkout-element")===`${t}-form`;if(e(this,re).has(r)){let c=e(this,re).get(r);r.removeEventListener("transitionend",c),e(this,re).delete(r)}if(i){r.style.display="block",r.style.overflow="hidden";let c=r.scrollHeight;r.style.height=`${c}px`,r.offsetHeight;let d=h=>{h.propertyName==="height"&&(a?(r.style.height="auto",r.style.overflow=""):r.style.display="none",e(this,re).delete(r))};e(this,re).set(r,d),r.addEventListener("transitionend",d,{once:!0}),requestAnimationFrame(()=>{r.style.height=a?`${r.scrollHeight}px`:"0",r.style.opacity=a?"1":"0"})}else r.style.transition="none",Object.assign(r.style,{display:a?"block":"none",height:a?"auto":"0",opacity:a?"1":"0",overflow:""}),r.offsetHeight,r.style.transition=""}),document.dispatchEvent(new CustomEvent("payment-method-changed",{detail:{mode:t}}))};var K,Ye,It,un,sd,mn,nd,Bt,xe,gn,od,Qi,lc,pn,ad,fn,cd,tr,dc,er,hc,yn,ld,hn=class{constructor(t){o(this,un);o(this,mn);o(this,Bt);o(this,gn);o(this,Qi);o(this,pn);o(this,fn);o(this,tr);o(this,er);o(this,yn);o(this,K,void 0);o(this,Ye,!1);o(this,It,void 0);l(this,K,t),l(this,It,{shipping:{address:document.querySelector('[os-checkout-field="address1"]'),city:document.querySelector('[os-checkout-field="city"]'),state:document.querySelector('[os-checkout-field="province"]'),zip:document.querySelector('[os-checkout-field="postal"]'),country:document.querySelector('[os-checkout-field="country"]')},billing:{address:document.querySelector('[os-checkout-field="billing-address1"]'),city:document.querySelector('[os-checkout-field="billing-city"]'),state:document.querySelector('[os-checkout-field="billing-province"]'),zip:document.querySelector('[os-checkout-field="billing-postal"]'),country:document.querySelector('[os-checkout-field="billing-country"]')},locations:document.querySelectorAll('[data-os-component="location"]')}),e(this,K).info("AddressAutocomplete initialized"),s(this,mn,nd).call(this),s(this,un,sd).call(this)}};K=new WeakMap,Ye=new WeakMap,It=new WeakMap,un=new WeakSet,sd=async function(){s(this,yn,ld).call(this),await s(this,Qi,lc).call(this)},mn=new WeakSet,nd=function(){e(this,Ye)||(e(this,It).locations.forEach(t=>t.classList.add("cc-hidden")),e(this,K).debug("Location fields hidden"))},Bt=new WeakSet,xe=function(){e(this,Ye)||(e(this,It).locations.forEach(t=>t.classList.remove("cc-hidden")),l(this,Ye,!0),document.dispatchEvent(new CustomEvent("location-fields-shown")),e(this,K).debug("Location fields shown"))},gn=new WeakSet,od=function(){return!!window.google?.maps?.places},Qi=new WeakSet,lc=async function(t=0){return s(this,gn,od).call(this)?(e(this,K).debug("Google Maps API available"),s(this,pn,ad).call(this)):t>=3?(e(this,K).warn("Google Maps API unavailable after 3 attempts"),s(this,er,hc).call(this)):(e(this,K).debug(`Retrying Google Maps check, attempt ${t+1}`),await new Promise(i=>setTimeout(i,1e3*1.5**t)),s(this,Qi,lc).call(this,t+1))},pn=new WeakSet,ad=function(){let{shipping:t,billing:i}=e(this,It);[t,i].forEach(r=>{r.address&&(s(this,fn,cd).call(this,r.address,r),e(this,K).debug(`Autocomplete set up for ${r.address.getAttribute("os-checkout-field")}`))})},fn=new WeakSet,cd=function(t,i){try{let r=new google.maps.places.Autocomplete(t,{types:["address"],fields:["address_components","formatted_address"]});r.addListener("place_changed",()=>{let n=r.getPlace();if(!n.address_components)return;s(this,Bt,xe).call(this);let a=Object.fromEntries(n.address_components.map(c=>[c.types[0],{long:c.long_name,short:c.short_name}]));if(i.address.value=[a.street_number?.long,a.route?.long].filter(Boolean).join(" "),i.city&&(i.city.value=a.locality?.long??""),i.zip&&(i.zip.value=a.postal_code?.long??""),i.country&&a.country){let c=a.country.short;i.country.value!==c&&(i.country.value=c,i.country.dispatchEvent(new Event("change",{bubbles:!0})),e(this,K).debug(`Country set to ${c}`)),i.state&&a.administrative_area_level_1&&s(this,tr,dc).call(this,i.state,a.administrative_area_level_1.short)}[i.address,i.city,i.zip].forEach(c=>c?.dispatchEvent(new Event("change",{bubbles:!0})))}),t.addEventListener("blur",()=>t.value.length>10&&s(this,Bt,xe).call(this)),t.addEventListener("keydown",n=>n.key==="Enter"&&n.preventDefault())}catch(r){e(this,K).error("Autocomplete setup failed:",r),s(this,er,hc).call(this)}},tr=new WeakSet,dc=async function(t,i,r=0){if(r>=5){e(this,K).warn(`Failed to set state ${i} after 5 attempts`);return}await new Promise(a=>setTimeout(a,300*1.5**r)),Array.from(t.options).some(a=>a.value===i)?(t.value=i,t.dispatchEvent(new Event("change",{bubbles:!0})),e(this,K).debug(`State set to ${i}`)):s(this,tr,dc).call(this,t,i,r+1)},er=new WeakSet,hc=function(){[e(this,It).shipping.address,e(this,It).billing.address].forEach(t=>{t?.addEventListener("blur",()=>t.value.length>10&&s(this,Bt,xe).call(this))}),e(this,K).debug("Basic field listeners set up")},yn=new WeakSet,ld=function(){let t=document.createElement("style");t.textContent=`
        @keyframes onAutoFillStart { from { opacity: 0.99; } to { opacity: 1; } }
        input:-webkit-autofill { animation-name: onAutoFillStart; }
      `,document.head.appendChild(t),[e(this,It).shipping.address,e(this,It).billing.address].filter(Boolean).forEach(r=>{r.addEventListener("input",()=>r.value.length>10&&s(this,Bt,xe).call(this)),r.addEventListener("change",()=>r.value.length>0&&s(this,Bt,xe).call(this)),r.addEventListener("animationstart",n=>{n.animationName==="onAutoFillStart"&&(e(this,K).debug(`Autofill detected on ${r.getAttribute("os-checkout-field")}`),s(this,Bt,xe).call(this))})}),e(this,K).debug("Autofill detection initialized")};var it,Xe,vn,dd,ir,uc,Sn,hd,wn,ud,_n,md,bn=class{constructor(t){o(this,vn);o(this,ir);o(this,Sn);o(this,wn);o(this,_n);o(this,it,void 0);o(this,Xe,!!window.intlTelInput);l(this,it,t),e(this,Xe)?(e(this,it).info("intlTelInput available, initializing phone inputs"),s(this,ir,uc).call(this)):(e(this,it).warn("intlTelInput not found, loading dynamically"),s(this,vn,dd).call(this).then(()=>s(this,ir,uc).call(this)))}};it=new WeakMap,Xe=new WeakMap,vn=new WeakSet,dd=async function(){let t=[{tag:"link",rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css"},{tag:"script",src:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js",async:!0},{tag:"script",src:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",async:!0}];await Promise.all(t.map(({tag:i,...r})=>{let n=document.createElement(i);return Object.assign(n,r),document.head.appendChild(n),i==="link"?Promise.resolve():new Promise(a=>n.onload=a)})),l(this,Xe,!0),e(this,it).debug("intlTelInput and utils loaded")},ir=new WeakSet,uc=function(){if(!e(this,Xe))return;let t=document.querySelectorAll('input[type="tel"]');e(this,it).info(`Found ${t.length} phone inputs`),t.forEach((i,r)=>s(this,Sn,hd).call(this,i,r+1))},Sn=new WeakSet,hd=function(t,i){try{let r=window.intlTelInput(t,{utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",separateDialCode:!0,preferredCountries:["us","gb","ca","au"],dropdownContainer:document.body,useFullscreenPopup:!0,formatOnDisplay:!0,autoPlaceholder:"aggressive",customContainer:"iti-tel-input"});t.iti=r,e(this,it).debug(`Phone input ${i} (${t.getAttribute("os-checkout-field")??"unknown"}) initialized`),s(this,wn,ud).call(this,t,r),s(this,_n,md).call(this,t,r)}catch(r){e(this,it).error(`Error initializing phone input ${i}:`,r)}},wn=new WeakSet,ud=function(t,i){let r=t.getAttribute("os-checkout-field");if(!r){e(this,it).warn("Phone input missing os-checkout-field attribute");return}let n=document.querySelector(r==="phone"?'[os-checkout-field="country"]':'[os-checkout-field="billing-country"]');if(!n){e(this,it).warn(`Country select not found for ${r}`);return}n.addEventListener("change",()=>{let a=n.value?.toLowerCase();a&&(i.setCountry(a),e(this,it).debug(`Country select updated phone to ${a}`))}),t.addEventListener("countrychange",()=>{let{iso2:a}=i.getSelectedCountryData()??{};a?(n.value=a.toUpperCase(),n.dispatchEvent(new Event("change",{bubbles:!0})),e(this,it).debug(`Phone country updated select to ${a}`)):e(this,it).warn("Invalid country data from phone input")}),n.value&&i.setCountry(n.value.toLowerCase())},_n=new WeakSet,md=function(t,i){t.validatePhone=()=>t.value.trim()?i.isValidNumber():!t.hasAttribute("required"),t.getFormattedNumber=()=>i.getNumber(),t.closest("form")?.addEventListener("submit",()=>{t.value.trim()&&i.isValidNumber()&&(t.value=i.getNumber(),e(this,it).debug(`Formatted phone number set to ${t.value} on submit`))})};var O,y,kn,Ze,qt,Mt,se,Tn,Qe,ti,u,An,$n,gd,In,pd,Ln,fd,ei,Cn,Pn,yd,qn,bd,Mn,vd,Fn,Sd,Nn,wd,Un,_d,zn,Cd,On,Ed,Dn,xd,ii,En,rr,mc,Rn,kd,xn=class{constructor(t){o(this,$n);o(this,In);o(this,Ln);o(this,ei);o(this,Pn);o(this,qn);o(this,Mn);o(this,Fn);o(this,Nn);o(this,Un);o(this,zn);o(this,On);o(this,Dn);o(this,ii);o(this,rr);o(this,Rn);o(this,O,void 0);o(this,y,void 0);o(this,kn,!1);o(this,Ze,!1);o(this,qt,!1);o(this,Mt,!1);o(this,se,null);o(this,Tn,3e3);o(this,Qe,null);o(this,ti,{firstName:'[os-checkout-field="fname"]',lastName:'[os-checkout-field="lname"]',email:'[os-checkout-field="email"]',phone:'[os-checkout-field="phone"]',address1:'[os-checkout-field="address1"]',address2:'[os-checkout-field="address2"]',city:'[os-checkout-field="city"]',province:'[os-checkout-field="province"]',postal:'[os-checkout-field="postal"]',country:'[os-checkout-field="country"]'});o(this,u,{firstName:null,lastName:null,email:null,phone:null,address1:null,address2:null,city:null,province:null,postal:null,country:null});o(this,An,/^[^\s@]+@[^\s@]+\.[^\s@]+$/);l(this,O,t),e(this,O)&&e(this,O).logger?l(this,y,e(this,O).logger.createModuleLogger("PROSPECT")):l(this,y,{debug:(i,r)=>console.log(`[PROSPECT DEBUG] ${i}`,r!==void 0?r:""),info:(i,r)=>console.info(`[PROSPECT INFO] ${i}`,r!==void 0?r:""),warn:(i,r)=>console.warn(`[PROSPECT WARN] ${i}`,r!==void 0?r:""),error:(i,r)=>console.error(`[PROSPECT ERROR] ${i}`,r!==void 0?r:"")}),s(this,$n,gd).call(this)}triggerBeginCheckout(){return e(this,O)&&e(this,O).events?e(this,Mt)?(e(this,y).debug("beginCheckout event already fired, skipping"),!1):(e(this,y).info("Manually triggering beginCheckout event"),e(this,O).events.beginCheckout(),l(this,Mt,!0),!0):(e(this,y).warn("Cannot trigger beginCheckout event: Events manager not available"),!1)}resetBeginCheckoutFlag(){return l(this,Mt,!1),e(this,y).debug("Reset beginCheckout flag"),!0}};O=new WeakMap,y=new WeakMap,kn=new WeakMap,Ze=new WeakMap,qt=new WeakMap,Mt=new WeakMap,se=new WeakMap,Tn=new WeakMap,Qe=new WeakMap,ti=new WeakMap,u=new WeakMap,An=new WeakMap,$n=new WeakSet,gd=function(){e(this,y).info("Initializing ProspectCartHandler"),s(this,In,pd).call(this),e(this,u).email&&(e(this,u).firstName||e(this,u).lastName)?(s(this,Ln,fd).call(this),l(this,kn,!0),e(this,y).info("ProspectCartHandler initialized successfully")):e(this,y).warn("Required form fields not found, ProspectCartHandler not initialized")},In=new WeakSet,pd=function(){Object.keys(e(this,ti)).forEach(t=>{if(e(this,u)[t]=document.querySelector(e(this,ti)[t]),!e(this,u)[t]){let i=e(this,ti)[t].replace("os-checkout-field","data-os-field");e(this,u)[t]=document.querySelector(i)}e(this,u)[t]?e(this,y).debug(`Found ${t} field`):e(this,y).debug(`${t} field not found`)})},Ln=new WeakSet,fd=function(){e(this,u).email&&e(this,u).email.addEventListener("blur",()=>s(this,ei,Cn).call(this)),e(this,u).firstName&&e(this,u).firstName.addEventListener("blur",()=>s(this,ei,Cn).call(this)),e(this,u).lastName&&e(this,u).lastName.addEventListener("blur",()=>s(this,ei,Cn).call(this));let t=document.querySelector('form[os-checkout="form"]');t&&t.addEventListener("submit",()=>{l(this,qt,!0),e(this,se)&&clearTimeout(e(this,se))}),e(this,y).debug("Event listeners attached to form fields")},ei=new WeakSet,Cn=function(){e(this,Ze)||e(this,qt)||(e(this,se)&&clearTimeout(e(this,se)),s(this,Pn,yd).call(this),l(this,se,setTimeout(()=>{s(this,qn,bd).call(this)},e(this,Tn))))},Pn=new WeakSet,yd=function(){if(e(this,Mt))return;let t=e(this,u).email&&e(this,u).email.value&&e(this,u).email.value.trim().length>0,i=e(this,u).firstName&&e(this,u).firstName.value&&e(this,u).firstName.value.trim().length>0||e(this,u).lastName&&e(this,u).lastName.value&&e(this,u).lastName.value.trim().length>0;(t||i)&&(e(this,y).debug("User has started entering checkout information, firing beginCheckout event"),e(this,O).events&&(e(this,O).events.beginCheckout(),l(this,Mt,!0),e(this,y).info("beginCheckout event fired")))},qn=new WeakSet,bd=function(){if(e(this,Ze)||e(this,qt)){e(this,y).debug("Cart already created or attempted, skipping");return}if(!s(this,Mn,vd).call(this)){e(this,y).debug("Not enough information to create a cart");return}let t=s(this,Fn,Sd).call(this);if(e(this,Qe)&&s(this,Nn,wd).call(this,t,e(this,Qe))){e(this,y).debug("Form data has not changed since last attempt, skipping");return}l(this,Qe,t),l(this,qt,!0),s(this,Un,_d).call(this)},Mn=new WeakSet,vd=function(){if(!(e(this,u).email&&e(this,u).email.value&&e(this,An).test(e(this,u).email.value)))return e(this,y).debug("Email is missing or invalid"),!1;let i=e(this,u).firstName&&e(this,u).firstName.value&&e(this,u).firstName.value.trim().length>=2,r=e(this,u).lastName&&e(this,u).lastName.value&&e(this,u).lastName.value.trim().length>=2;return!i&&!r?(e(this,y).debug("First name and last name are missing or too short"),!1):(e(this,y).debug("Minimum required fields are present"),!0)},Fn=new WeakSet,Sd=function(){let t={};return Object.keys(e(this,u)).forEach(i=>{e(this,u)[i]&&(t[i]=e(this,u)[i].value)}),t},Nn=new WeakSet,wd=function(t,i){return t.email===i.email&&t.firstName===i.firstName&&t.lastName===i.lastName},Un=new WeakSet,_d=function(){e(this,y).info("Creating prospect cart");let t=e(this,O).state.getState("cart");if(!t||!t.items||t.items.length===0){e(this,y).warn("No cart items available, skipping cart creation"),l(this,qt,!1);return}let i=t.attribution||{};e(this,y).debug("Using attribution data from state",i);let r=e(this,u).firstName?e(this,u).firstName.value:"",n=e(this,u).lastName?e(this,u).lastName.value:"",a=e(this,u).email?e(this,u).email.value:"",c=s(this,rr,mc).call(this);s(this,zn,Cd).call(this,a,r,n,c);let d={lines:t.items.map(p=>({package_id:p.id,quantity:p.quantity||1})),user:{first_name:r,last_name:n,email:a,phone_number:c},attribution:i};t.shippingMethod&&(d.shipping_method=t.shippingMethod.code||t.shippingMethod.id);let h=s(this,Dn,xd).call(this);h&&Object.keys(h).length>0?s(this,On,Ed).call(this,h)?(e(this,y).debug("Adding valid address data to cart"),d.address=h):e(this,y).info("Address data is incomplete or invalid - sending cart with user info only"):e(this,y).debug("No address data available - sending cart with user info only"),s(this,Rn,kd).call(this,d)},zn=new WeakSet,Cd=function(t,i,r,n){if(!e(this,O).state){e(this,y).warn("State manager not available, cannot update user state");return}try{let a=e(this,O).state.getState("user")||{},c={...a,email:t||a.email,firstName:i||a.firstName,lastName:r||a.lastName,phone:n||a.phone};e(this,O).state.setState("user",c),e(this,y).debug("Updated user state with user information",c)}catch(a){e(this,y).error("Error updating user state:",a)}},On=new WeakSet,Ed=function(t){return t.country==="US"&&(!t.postcode||!s(this,ii,En).call(this,t.postcode,"US"))?(e(this,y).warn("US address requires a valid postal code"),!1):!0},Dn=new WeakSet,xd=function(){let t=e(this,u).country&&e(this,u).country.value?e(this,u).country.value:"",i=e(this,u).postal&&e(this,u).postal.value?e(this,u).postal.value:"";if(t==="US"&&i&&!s(this,ii,En).call(this,i,t))return e(this,y).warn(`Invalid postal code for US: ${i} - omitting all address data`),null;let r={};e(this,u).firstName&&e(this,u).firstName.value&&(r.first_name=e(this,u).firstName.value),e(this,u).lastName&&e(this,u).lastName.value&&(r.last_name=e(this,u).lastName.value);let n=s(this,rr,mc).call(this);return n&&(r.phone_number=n),e(this,u).address1&&e(this,u).address1.value&&(r.line1=e(this,u).address1.value),e(this,u).address2&&e(this,u).address2.value&&(r.line2=e(this,u).address2.value),e(this,u).city&&e(this,u).city.value&&(r.line4=e(this,u).city.value),e(this,u).province&&e(this,u).province.value&&(r.state=e(this,u).province.value),t&&(r.country=t),i&&(!t||s(this,ii,En).call(this,i,t))&&(r.postcode=i),r},ii=new WeakSet,En=function(t,i){if(!t||!i)return!0;switch(i.toUpperCase()){case"US":return/^\d{5}(-\d{4})?$/.test(t);case"CA":return/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/.test(t);case"GB":case"UK":return/^[A-Z]{1,2}[0-9][A-Z0-9]? ?[0-9][A-Z]{2}$/i.test(t);case"AU":return/^\d{4}$/.test(t);case"NZ":return/^\d{4}$/.test(t);case"DE":return/^\d{5}$/.test(t);case"FR":return/^\d{5}$/.test(t);default:return t.trim().length>0}},rr=new WeakSet,mc=function(){return e(this,u).phone?e(this,u).phone.iti&&typeof e(this,u).phone.iti.getNumber=="function"?e(this,u).phone.iti.getNumber():e(this,u).phone.value:""},Rn=new WeakSet,kd=function(t){if(!e(this,O).api||typeof e(this,O).api.createCart!="function"){e(this,y).error("API client not available"),l(this,qt,!1);return}e(this,y).debug("Sending cart data to API",t),e(this,O).api.createCart(t).then(i=>{e(this,y).info("Prospect cart created successfully",i),l(this,Ze,!0),e(this,O).events&&(e(this,O).events.trigger("prospect.cartCreated",{cart:i}),e(this,Mt)?e(this,y).debug("beginCheckout event already fired, skipping"):(e(this,y).info("Triggering beginCheckout event for analytics"),e(this,O).events.beginCheckout(),l(this,Mt,!0)))}).catch(i=>{e(this,y).error("Error creating prospect cart",i),l(this,qt,!1)})};var sr,g,k,ht,Hn,Bn,Td,jn,Ad,Vn,$d,Gn,Id,Kn,Ld,Jn,Pd,Yn,qd,Xn,Md,Zn,Fd,Qn,Nd,to,Ud,eo,zd,io,Od,ro,Dd,so,Rd,Wn=class{constructor(t,i,r){o(this,Bn);o(this,jn);o(this,Vn);o(this,Gn);o(this,Kn);o(this,Jn);o(this,Yn);o(this,Xn);o(this,Zn);o(this,Qn);o(this,to);o(this,eo);o(this,io);o(this,ro);o(this,so);o(this,sr,void 0);o(this,g,void 0);o(this,k,void 0);o(this,ht,void 0);o(this,Hn,void 0);if(l(this,sr,t),l(this,g,i),l(this,ht,r),l(this,k,document.querySelector('form[os-checkout="form"]')||document.querySelector("form#combo_form")),!e(this,k)){e(this,g).warn('No checkout form found with [os-checkout="form"] selector or form#combo_form');return}e(this,k).removeAttribute("action"),e(this,k).setAttribute("method","post"),e(this,k).setAttribute("novalidate","novalidate");let n=document.createElement("input");n.type="hidden",n.name="js_enabled",n.value="true",e(this,k).appendChild(n);let a=document.createElement("input");a.type="hidden",a.name="prevent_serialization",a.value="true",e(this,k).appendChild(a);let c=d=>(d&&(d.preventDefault(),d.stopPropagation(),d.stopImmediatePropagation()),e(this,k).removeAttribute("action"),e(this,k).setAttribute("method","post"),typeof window.stop=="function"&&window.stop(),e(this,g).debug("Form direct submission prevented"),!1);e(this,k).addEventListener("submit",c,!0),e(this,k).onsubmit=c,s(this,so,Rd).call(this),e(this,g).debug("CheckoutPage initialized with form found"),s(this,Bn,Td).call(this),s(this,jn,Ad).call(this)}};sr=new WeakMap,g=new WeakMap,k=new WeakMap,ht=new WeakMap,Hn=new WeakMap,Bn=new WeakSet,Td=function(){try{s(this,eo,zd).call(this),s(this,Gn,Id).call(this),s(this,Kn,Ld).call(this),s(this,Jn,Pd).call(this),s(this,Yn,qd).call(this),s(this,Xn,Md).call(this),s(this,Zn,Fd).call(this),s(this,Qn,Nd).call(this),s(this,to,Ud).call(this),s(this,io,Od).call(this),document.dispatchEvent(new CustomEvent("os:checkout.ready",{detail:{checkoutPage:this}})),e(this,g).info("Checkout page components initialized successfully")}catch(t){e(this,g).error("Error initializing checkout components",t)}},jn=new WeakSet,Ad=function(){try{l(this,Hn,new Et({callback:()=>s(this,Vn,$d).call(this),logger:e(this,g)})),e(this,g).debug("Konami code handler initialized")}catch(t){e(this,g).error("Error initializing Konami code handler:",t)}},Vn=new WeakSet,$d=function(){try{e(this,g).info("ðŸŽ® Konami code activated! Creating test order...");let t=Et.showActivationMessage();setTimeout(()=>{document.body.removeChild(t),this.paymentHandler?(Et.setTestMode(),this.paymentHandler.processPayment(),e(this,g).info("Konami code test order initiated")):(e(this,g).error("Payment handler not initialized, cannot create test order"),alert("Could not create test order: Payment handler not initialized"))},2e3)}catch(t){e(this,g).error("Error triggering Konami code Easter egg:",t)}},Gn=new WeakSet,Id=function(){try{this.addressHandler=new jr(e(this,k),e(this,g))}catch(t){e(this,g).error("Error initializing AddressHandler",t)}},Kn=new WeakSet,Ld=function(){try{this.billingAddressHandler=new en(e(this,ht)),e(this,k)&&this.billingAddressHandler&&(e(this,k).__billingAddressHandler=this.billingAddressHandler,e(this,g).debug("BillingAddressHandler initialized and attached to form"))}catch(t){e(this,g).error("Error initializing BillingAddressHandler",t)}},Jn=new WeakSet,Pd=function(){try{this.paymentSelector=new cn(e(this,g))}catch(t){e(this,g).error("Error initializing PaymentSelector",t)}},Yn=new WeakSet,qd=function(){try{this.formValidator=new Ne({debugMode:window.location.search.includes("debug=true"),logger:e(this,g)}),e(this,k)&&this.formValidator&&(e(this,k).__formValidator=this.formValidator,e(this,g).debug("FormValidator initialized and attached to form"))}catch(t){e(this,g).error("Error initializing FormValidator",t)}},Xn=new WeakSet,Md=function(){try{this.paymentHandler=new As(e(this,sr),e(this,g),e(this,ht))}catch(t){e(this,g).error("Error initializing PaymentHandler",t)}},Zn=new WeakSet,Fd=function(){try{this.addressAutocomplete=new hn(e(this,g))}catch(t){e(this,g).error("Error initializing AddressAutocomplete",t)}},Qn=new WeakSet,Nd=function(){try{this.phoneInputHandler=new bn(e(this,g))}catch(t){e(this,g).error("Error initializing PhoneInputHandler",t)}},to=new WeakSet,Ud=function(){try{e(this,ht)?(this.prospectCartHandler=new xn(e(this,ht)),e(this,g).info("ProspectCartHandler initialized")):e(this,g).warn("App instance not provided, ProspectCartHandler not initialized")}catch(t){e(this,g).error("Error initializing ProspectCartHandler",t)}},eo=new WeakSet,zd=function(){try{e(this,g).info("Fixing billing form by duplicating shipping form");let t=document.querySelector('[os-checkout-component="shipping-form"]'),i=document.querySelector('[os-checkout-component="billing-form"]');if(t&&i){e(this,g).info("Found shipping form and billing container");let r=t.cloneNode(!0),n={fname:"billing-fname",lname:"billing-lname",address1:"billing-address1",address2:"billing-address2",city:"billing-city",province:"billing-province",postal:"billing-postal",country:"billing-country",phone:"billing-phone"};r.querySelectorAll("input, select").forEach(c=>{let d=c.getAttribute("os-checkout-field");d&&n[d]&&(c.setAttribute("os-checkout-field",n[d]),c.id&&(c.id="billing_"+c.id),c.name&&(c.name="billing_"+c.name),c.getAttribute("data-name")&&c.setAttribute("data-name","Billing "+c.getAttribute("data-name")),c.getAttribute("autocomplete")&&c.setAttribute("autocomplete","billing "+c.getAttribute("autocomplete")))});let a=r.querySelector('[data-os-component="location"]');a&&a.setAttribute("data-os-component","billing-location"),i.innerHTML="",i.appendChild(r),e(this,g).info("Billing form successfully created from shipping form")}else{e(this,g).warn("Could not fix billing form - shipping form or billing container not found"),e(this,g).warn(`Shipping form found: ${!!t}, Billing container found: ${!!i}`);let r=document.querySelectorAll("[os-checkout-component]");e(this,g).warn(`Found ${r.length} checkout components:`),r.forEach(n=>{e(this,g).warn(`- ${n.getAttribute("os-checkout-component")}`)})}}catch(t){e(this,g).error("Error fixing billing form:",t)}},io=new WeakSet,Od=function(){try{document.addEventListener("payment-method-changed",t=>{e(this,g).debug(`Payment method changed to: ${t.detail.mode}`),document.querySelector("[os-payment-mode]")?.setAttribute("os-payment-mode",t.detail.mode)}),e(this,k)&&(e(this,k).addEventListener("submit",t=>s(this,ro,Dd).call(this,t)),e(this,g).debug("Form submit event listener attached")),e(this,ht)&&e(this,ht).events&&this.prospectCartHandler&&e(this,ht).events.on("prospect.cartCreated",t=>{e(this,g).info("Prospect cart created successfully",t)}),e(this,ht)&&e(this,ht).events&&e(this,ht).events.on("order.created",t=>{e(this,g).info("Order created successfully",t)})}catch(t){e(this,g).error("Error setting up event listeners:",t)}},ro=new WeakSet,Dd=function(t){if(t&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()),e(this,g).debug("Form submission intercepted by #handleSubmit"),e(this,k)){e(this,k).removeAttribute("action"),e(this,k).setAttribute("method","post");let i=r=>(r&&(r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation()),e(this,k)&&(e(this,k).removeAttribute("action"),e(this,k).setAttribute("method","post")),typeof window.stop=="function"&&window.stop(),e(this,g).debug("Form direct submission prevented"),!1);e(this,k).onsubmit=i}return this.formValidator&&!this.formValidator.validateAllFields()?(e(this,g).warn("Form validation failed, stopping submission"),!1):(this.paymentHandler?(e(this,g).debug("Delegating to paymentHandler.processPayment()"),this.paymentHandler.processPayment()):e(this,g).error("Payment handler not initialized"),!1)},so=new WeakSet,Rd=function(){try{if(!e(this,k))return;let t=e(this,k).querySelectorAll('button[type="submit"], input[type="submit"]');t.length>0?(e(this,g).debug(`Found ${t.length} submit buttons, converting to type="button"`),t.forEach((i,r)=>{i.setAttribute("type","button"),i.addEventListener("click",n=>{n.preventDefault(),e(this,g).debug(`Submit button ${r+1} clicked, delegating to payment handler`),this.paymentHandler?this.paymentHandler.processPayment():e(this,g).error("Payment handler not initialized")}),e(this,g).debug(`Converted submit button ${r+1} to type="button"`)})):e(this,g).debug("No submit buttons found in the form")}catch(t){e(this,g).error("Error disabling submit buttons:",t)}};var H,Ft,ne,no=class{constructor(t){o(this,H,void 0);o(this,Ft,void 0);o(this,ne,!1);l(this,H,t),l(this,Ft,t.logger.createModuleLogger("CAMPAIGN"))}getCampaignData(){let t=e(this,H).campaignData;return t&&!e(this,ne)&&e(this,H).events?.viewItemList&&(e(this,Ft).debug("Triggering view_item_list event from getCampaignData"),setTimeout(()=>{e(this,H).events.viewItemList(t),l(this,ne,!0)},500)),t}getCampaignName(){return e(this,H).campaignData?.name??""}getCampaignId(){return e(this,H).campaignData?.id??""}getProducts(){let t=e(this,H).campaignData?.products??[];return t.length>0&&!e(this,ne)&&e(this,H).events?.viewItemList&&(e(this,Ft).debug("Triggering view_item_list event from getProducts"),e(this,H).campaignData,setTimeout(()=>{e(this,H).events.viewItemList(e(this,H).campaignData),l(this,ne,!0)},500)),t}getProductById(t){return this.getProducts().find(i=>i.id===t)}getCurrency(){return e(this,H).campaignData?.currency??"USD"}getLocale(){return e(this,H).campaignData?.locale??"en-US"}formatPrice(t){if(typeof t!="number")return"";try{return new Intl.NumberFormat(this.getLocale(),{style:"currency",currency:this.getCurrency()}).format(t)}catch(i){return e(this,Ft).error("Error formatting price:",i),t.toString()}}triggerViewItemList(){if(!e(this,H).campaignData){e(this,Ft).warn("Cannot trigger view_item_list: No campaign data available");return}if(!e(this,H).events?.viewItemList){e(this,Ft).warn("Cannot trigger view_item_list: EventManager not initialized");return}e(this,Ft).debug("Manually triggering view_item_list event"),e(this,H).events.viewItemList(e(this,H).campaignData),l(this,ne,!0)}};H=new WeakMap,Ft=new WeakMap,ne=new WeakMap;var ot,A,V,oe,nr,gc,ao,Wd,co,Hd,ae,ri,lo,Bd,ce,si,or,pc,oo=class{constructor(t){o(this,nr);o(this,ao);o(this,co);o(this,ae);o(this,lo);o(this,ce);o(this,or);o(this,ot,void 0);o(this,A,void 0);o(this,V,void 0);o(this,oe,{});l(this,ot,t),l(this,A,t.logger.createModuleLogger("STATE")),l(this,V,s(this,nr,gc).call(this)),s(this,ao,Wd).call(this),s(this,or,pc).call(this,!1),e(this,A).info("StateManager initialized")}getState(t=null){return t?t==="cart"?{...e(this,V).cart,totals:s(this,ce,si).call(this)}:t==="cart.totals"||t.startsWith("cart.totals.")?s(this,ce,si).call(this):t.split(".").reduce((i,r)=>i?.[r]??null,e(this,V)):{...e(this,V),cart:{...e(this,V).cart,totals:s(this,ce,si).call(this)}}}setState(t,i,r=!0){let n=e(this,V),a=t.split(".");for(let[c,d]of a.entries())c===a.length-1?n[d]=i:(n[d]??(n[d]={}),n=n[d]);return t.startsWith("cart.items")&&s(this,or,pc).call(this,!1),s(this,co,Hd).call(this),r&&(s(this,ae,ri).call(this,t,i),t.startsWith("cart.items")&&s(this,ae,ri).call(this,"cart",this.getState("cart"))),this}subscribe(t,i){var r;(r=e(this,oe))[t]??(r[t]=[]),e(this,oe)[t].push(i);try{i(this.getState(t),t)}catch(n){e(this,A).error(`Error in initial subscriber callback for ${t}:`,n)}return()=>e(this,oe)[t]=e(this,oe)[t].filter(n=>n!==i)}clearState(){l(this,V,s(this,nr,gc).call(this)),sessionStorage.removeItem("os_state"),s(this,ae,ri).call(this,"*",e(this,V)),e(this,A).info("State cleared")}addToCart(t){if(!t?.id||!t.name||t.price===void 0)throw e(this,A).error("Invalid item:",t),new Error("Invalid item. Must have id, name, and price.");let i=this.getState("cart"),r=e(this,ot).campaignData?.packages?.find(d=>d.ref_id.toString()===t.id.toString()||d.external_id?.toString()===t.id.toString()),n={...t,...r&&{name:r.name||t.name,price:Number.parseFloat(r.price)||t.price,price_total:Number.parseFloat(r.price_total)||t.price*(t.quantity||1),retail_price:Number.parseFloat(r.price_retail)??void 0,retail_price_total:Number.parseFloat(r.price_retail_total)??void 0,is_recurring:r.is_recurring??!1,price_recurring:r.price_recurring?Number.parseFloat(r.price_recurring):void 0,price_recurring_total:r.price_recurring_total?Number.parseFloat(r.price_recurring_total):void 0,interval:r.interval??void 0,interval_count:r.interval_count??void 0,image:r.image||t.image,external_id:r.external_id??void 0},quantity:t.quantity||1},a=i.items.findIndex(d=>d.id===t.id),c=a>=0?s(this,lo,Bd).call(this,i.items,a,n):[...i.items,n];return this.setState("cart.items",c),e(this,A).info(`Item added to cart: ${n.name}`),e(this,ot).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}updateCartItem(t,i){let r=this.getState("cart"),n=r.items.findIndex(c=>c.id===t);if(n===-1)throw e(this,A).error(`Item not found in cart: ${t}`),new Error(`Item not found in cart: ${t}`);let a=[...r.items];return a[n]={...a[n],...i},a[n].quantity===0&&a.splice(n,1),this.setState("cart.items",a),e(this,A).info(`Cart item updated: ${t}`),e(this,ot).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}removeFromCart(t){let i=this.getState("cart").items.filter(r=>r.id!==t);return this.setState("cart.items",i),e(this,A).info(`Item removed from cart: ${t}`),e(this,ot).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}clearCart(){return this.setState("cart.items",[]),this.setState("cart.couponCode",null),this.setState("cart.shippingMethod",null),e(this,A).info("Cart cleared"),e(this,ot).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}setShippingMethod(t){return this.setState("cart.shippingMethod",t),e(this,A).info(`Shipping method set: ${t.code}`),e(this,ot).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}applyCoupon(t){return this.setState("cart.couponCode",t),e(this,A).info(`Coupon applied: ${t}`),e(this,ot).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}removeCoupon(){return this.setState("cart.couponCode",null),e(this,A).info("Coupon removed"),e(this,ot).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}isItemInCart(t){return e(this,V).cart.items.some(i=>i.id===t)}getCartForApi(){let{items:t,shippingMethod:i,couponCode:r,attribution:n}=this.getState("cart"),{email:a,firstName:c,lastName:d,phone:h}=this.getState("user");return{lines:t.map(p=>({product_id:p.id,quantity:p.quantity||1,price:p.price})),shipping_method:i?.code??null,coupon_code:r,user:{email:a,first_name:c,last_name:d,phone:h},attribution:n||{}}}async syncCartWithApi(){try{this.setState("ui.loading",!0);let t=this.getCartForApi(),i=await e(this,ot).api.createCart(t);return e(this,A).info("Cart synced with API"),e(this,ot).triggerEvent("cart.synced",{cart:i}),i}catch(t){throw e(this,A).error("Error syncing cart with API:",t),this.setState("ui.errors.cart",t.message),t}finally{this.setState("ui.loading",!1)}}};ot=new WeakMap,A=new WeakMap,V=new WeakMap,oe=new WeakMap,nr=new WeakSet,gc=function(){return{cart:{items:[],totals:{subtotal:0,retail_subtotal:0,savings:0,savings_percentage:0,shipping:0,tax:0,total:0,recurring_total:0,currency:"USD",currency_symbol:"$"},shippingMethod:null,couponCode:null,attribution:{utm_source:"",utm_medium:"",utm_campaign:"",utm_content:"",utm_term:"",gclid:"",fbclid:"",sub1:"",sub2:"",sub3:"",sub4:"",sub5:"",referrer:"",landing_page:"",user_agent:"",device_type:"",fbc:"",fbp:""}},user:{email:null,firstName:null,lastName:null,phone:null},ui:{loading:!1,currentStep:"cart",errors:{}}}},ao=new WeakSet,Wd=function(){try{let t=sessionStorage.getItem("os_state");if(t){let i=JSON.parse(t);l(this,V,{...e(this,V),...i,ui:{...e(this,V).ui}}),e(this,A).info("State loaded from sessionStorage")}}catch(t){e(this,A).error("Error loading state from sessionStorage:",t)}},co=new WeakSet,Hd=function(){try{let t={cart:{...e(this,V).cart,totals:s(this,ce,si).call(this)},user:e(this,V).user};sessionStorage.setItem("os_state",JSON.stringify(t)),e(this,A).debug("State saved to sessionStorage")}catch(t){e(this,A).error("Error saving state to sessionStorage:",t)}},ae=new WeakSet,ri=function(t,i){e(this,A).debug(`Notifying subscribers for path: ${t}`);for(let[r,n]of Object.entries(e(this,oe)))if(r===t||r==="*"||t.startsWith(`${r}.`)){let a=r==="*"?this.getState():this.getState(r);n.forEach(c=>{try{c(a,r)}catch(d){e(this,A).error(`Error in subscriber callback for ${r}:`,d)}})}},lo=new WeakSet,Bd=function(t,i,r){let n=[...t];return n[i]={...n[i],quantity:(n[i].quantity||1)+(r.quantity||1),price_total:n[i].price*(n[i].quantity||1+(r.quantity||1)),...n[i].retail_price&&{retail_price_total:n[i].retail_price*(n[i].quantity||1+(r.quantity||1))},...n[i].price_recurring&&{price_recurring_total:n[i].price_recurring*(n[i].quantity||1+(r.quantity||1))}},n},ce=new WeakSet,si=function(){let{items:t,shippingMethod:i}=e(this,V).cart,r=t.reduce((zt,at)=>zt+at.price*(at.quantity||1),0),n=t.reduce((zt,at)=>zt+(at.retail_price??at.price)*(at.quantity||1),0),a=n-r,c=n>0?a/n*100:0,d=t.reduce((zt,at)=>zt+(at.is_recurring&&at.price_recurring?at.price_recurring*(at.quantity||1):0),0),h=i?.price?Number.parseFloat(i.price):0,p=0,v=r+h+p,L=e(this,ot).campaignData?.currency??"USD",Ei={USD:"$",EUR:"â‚¬",GBP:"Â£"}[L]??"$";return{subtotal:r,retail_subtotal:n,savings:a,savings_percentage:c,shipping:h,tax:p,total:v,recurring_total:d,currency:L,currency_symbol:Ei}},or=new WeakSet,pc=function(t=!0){let i=s(this,ce,si).call(this);return e(this,V).cart.totals=i,e(this,A).debug("Cart totals recalculated"),t&&(s(this,ae,ri).call(this,"cart.totals",i),s(this,ae,ri).call(this,"cart",this.getState("cart"))),i};var ni,rt,ut,mt,mo,jd,ar,fc,go,Vd,cr,yc,lr,bc,oi,ho,kt,Nt,uo=class{constructor(t){o(this,mo);o(this,ar);o(this,go);o(this,cr);o(this,lr);o(this,oi);o(this,kt);o(this,ni,void 0);o(this,rt,void 0);o(this,ut,void 0);o(this,mt,void 0);l(this,ni,t),l(this,rt,t.state),l(this,ut,t.logger.createModuleLogger("CART")),s(this,mo,jd).call(this),e(this,ut).info("CartManager initialized")}clearCart(){try{return e(this,rt).clearCart()}catch(t){throw e(this,ut).error("Error clearing cart:",t),s(this,kt,Nt).call(this,"Error clearing cart","error"),t}}addToCart(t){return s(this,cr,yc).call(this,t)}removeFromCart(t){return s(this,oi,ho).call(this,t)}setShippingMethod(t){try{return e(this,rt).setShippingMethod(t)}catch(i){throw e(this,ut).error("Error setting shipping method:",i),s(this,kt,Nt).call(this,"Error setting shipping method","error"),i}}applyCoupon(t){try{return e(this,rt).applyCoupon(t)}catch(i){throw e(this,ut).error("Error applying coupon:",i),s(this,kt,Nt).call(this,"Error applying coupon","error"),i}}removeCoupon(){try{return e(this,rt).removeCoupon()}catch(t){throw e(this,ut).error("Error removing coupon:",t),s(this,kt,Nt).call(this,"Error removing coupon","error"),t}}async syncCartWithApi(){try{return await e(this,rt).syncCartWithApi()}catch(t){throw e(this,ut).error("Error syncing cart with API:",t),s(this,kt,Nt).call(this,"Error syncing cart with server","error"),t}}isItemInCart(t){return e(this,rt).isItemInCart?.(t)??e(this,rt).getState("cart").items.some(i=>i.id===t)}};ni=new WeakMap,rt=new WeakMap,ut=new WeakMap,mt=new WeakMap,mo=new WeakSet,jd=function(){l(this,mt,{addToCartButtons:document.querySelectorAll("[data-os-add-to-cart]"),cartCount:document.querySelectorAll("[data-os-cart-count]"),cartTotal:document.querySelectorAll("[data-os-cart-total]"),cartItems:document.querySelector("[data-os-cart-items]"),cartEmpty:document.querySelector("[data-os-cart-empty]"),cartContainer:document.querySelector("[data-os-cart-container]")}),e(this,mt).addToCartButtons.forEach(t=>{t.addEventListener("click",i=>{i.preventDefault();let r={id:t.getAttribute("data-os-product-id"),name:t.getAttribute("data-os-product-name"),price:Number.parseFloat(t.getAttribute("data-os-product-price")),quantity:Number.parseInt(t.getAttribute("data-os-product-quantity")??"1",10)};r.id&&r.name&&r.price?s(this,cr,yc).call(this,r):e(this,ut).error("Invalid product data for add to cart button")})}),e(this,rt).subscribe("cart",()=>s(this,ar,fc).call(this)),s(this,ar,fc).call(this)},ar=new WeakSet,fc=function(){let t=e(this,rt).getState("cart");e(this,mt).cartCount.forEach(n=>{let a=t.items.reduce((c,d)=>c+(d.quantity||1),0);n.textContent=a.toString(),n.classList.toggle("hidden",a===0)});let i=n=>e(this,ni).campaign?.formatPrice(n)??n.toFixed(2);e(this,mt).cartTotal.forEach(n=>n.textContent=i(t.totals.total));let r=(n,a,c=!1)=>{let d=document.querySelector(n);d&&(d.textContent=c?`${Math.round(a)}%`:i(a),c&&a===0?d.parentElement?.classList.add("hidden"):d.parentElement?.classList.remove("hidden"))};if(r("[data-os-cart-retail-subtotal]",t.totals.retail_subtotal),r("[data-os-cart-savings]",t.totals.savings,!0),r("[data-os-cart-savings-percentage]",t.totals.savings_percentage,!0),r("[data-os-cart-recurring-total]",t.totals.recurring_total,!0),r("[data-os-cart-subtotal]",t.totals.subtotal),r("[data-os-cart-shipping]",t.totals.shipping),e(this,mt).cartItems&&(e(this,mt).cartItems.innerHTML="",t.items.forEach(n=>e(this,mt).cartItems.appendChild(s(this,go,Vd).call(this,n)))),e(this,mt).cartEmpty&&e(this,mt).cartContainer){let n=t.items.length===0;e(this,mt).cartEmpty.classList.toggle("hidden",!n),e(this,mt).cartContainer.classList.toggle("hidden",n)}},go=new WeakSet,Vd=function(t){let i=L=>e(this,ni).campaign?.formatPrice(L)??L.toFixed(2),r=document.createElement("div");r.className="os-cart-item",r.setAttribute("data-os-cart-item-id",t.id);let n=i(t.price),a=t.retail_price?i(t.retail_price):"",c=i(t.price*(t.quantity||1)),d=t.retail_price?(t.retail_price-t.price)*(t.quantity||1):0,h=d?`
      <div class="os-cart-item-savings">
        <span class="os-cart-item-savings-label">You save:</span>
        <span class="os-cart-item-savings-value">${i(d)} (${Math.round(d/(t.retail_price*(t.quantity||1))*100)}%)</span>
      </div>
    `:"",p=t.is_recurring&&t.price_recurring?`
      <div class="os-cart-item-recurring">
        <span class="os-cart-item-recurring-label">Recurring:</span>
        <span class="os-cart-item-recurring-value">${i(t.price_recurring)} ${t.interval_count>1?`every ${t.interval_count} ${t.interval}s`:`per ${t.interval}`}</span>
      </div>
    `:"",v=t.image?`
      <div class="os-cart-item-image">
        <img src="${t.image}" alt="${t.name}" />
      </div>
    `:"";return r.innerHTML=`
      ${v}
      <div class="os-cart-item-details">
        <div class="os-cart-item-name">${t.name}</div>
        <div class="os-cart-item-price-container">
          <div class="os-cart-item-price">${n}</div>
          ${a?`<div class="os-cart-item-retail-price">${a}</div>`:""}
        </div>
        ${h}
        ${p}
      </div>
      <div class="os-cart-item-quantity">
        <button class="os-cart-item-decrease" data-os-cart-decrease="${t.id}">-</button>
        <span class="os-cart-item-quantity-value">${t.quantity||1}</span>
        <button class="os-cart-item-increase" data-os-cart-increase="${t.id}">+</button>
      </div>
      <div class="os-cart-item-total">${c}</div>
      <button class="os-cart-item-remove" data-os-cart-remove="${t.id}">Ã—</button>
    `,r.querySelector(`[data-os-cart-decrease="${t.id}"]`)?.addEventListener("click",()=>s(this,lr,bc).call(this,t.id,(t.quantity||1)-1)),r.querySelector(`[data-os-cart-increase="${t.id}"]`)?.addEventListener("click",()=>s(this,lr,bc).call(this,t.id,(t.quantity||1)+1)),r.querySelector(`[data-os-cart-remove="${t.id}"]`)?.addEventListener("click",()=>s(this,oi,ho).call(this,t.id)),r},cr=new WeakSet,yc=function(t){try{let i=e(this,rt).addToCart(t);return s(this,kt,Nt).call(this,`${t.name} added to cart`),i}catch(i){throw e(this,ut).error("Error adding item to cart:",i),s(this,kt,Nt).call(this,"Error adding item to cart","error"),i}},lr=new WeakSet,bc=function(t,i){try{return i<=0?s(this,oi,ho).call(this,t):e(this,rt).updateCartItem(t,{quantity:i})}catch(r){throw e(this,ut).error("Error updating cart item quantity:",r),s(this,kt,Nt).call(this,"Error updating cart","error"),r}},oi=new WeakSet,ho=function(t){try{return e(this,rt).removeFromCart(t)}catch(i){throw e(this,ut).error("Error removing item from cart:",i),s(this,kt,Nt).call(this,"Error removing item from cart","error"),i}},kt=new WeakSet,Nt=function(t,i="success"){let r=document.createElement("div");r.className=`os-message os-message-${i}`,r.textContent=t,document.body.appendChild(r),setTimeout(()=>{r.classList.add("os-message-hide"),setTimeout(()=>document.body.removeChild(r),300)},3e3)};var ai,jt,Lt,ci,X=class{static initDebugMode(){let t=new URLSearchParams(window.location.search);return l(this,jt,t.get("debugger")==="true"),e(this,jt)&&!e(this,ai)&&(this.injectDebugStyles(),l(this,Lt,localStorage.getItem("os_debug_xray_enabled")==="true")),e(this,jt)}static isDebugMode(){return e(this,jt)}static isXrayEnabled(){return e(this,Lt)}static toggleXray(t=!e(this,Lt)){return e(this,jt)?(l(this,Lt,t),localStorage.setItem("os_debug_xray_enabled",e(this,Lt).toString()),e(this,ci).forEach(i=>{i.style.display=e(this,Lt)?"block":"none"}),e(this,Lt)):!1}static injectDebugStyles(){if(e(this,ai))return;let t=document.createElement("style");t.id="os-debug-styles",t.textContent=`
      /* Common debug styles */
      .os-debug-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9999;
        border: 2px dashed rgba(255, 0, 0, 0.7);
        box-sizing: border-box;
      }
      .os-debug-label {
        position: absolute;
        top: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        font-size: 12px;
        padding: 2px 6px;
        border-radius: 0 0 0 4px;
        font-family: monospace;
        z-index: 10000;
      }
      
      /* Selector-specific styles */
      .os-debug-card-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9998;
        border: 1px solid rgba(0, 255, 255, 0.7);
        box-sizing: border-box;
      }
      .os-debug-card-label {
        position: absolute;
        top: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        font-size: 10px;
        padding: 1px 4px;
        border-radius: 0 0 0 4px;
        font-family: monospace;
        z-index: 9999;
      }
      .os--selected .os-debug-card-overlay {
        border: 2px solid rgba(0, 255, 0, 0.9);
      }
      .os--active .os-debug-card-overlay {
        background-color: rgba(255, 255, 0, 0.2);
      }
      
      /* Toggle-specific styles */
      .os-debug-toggle-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9998;
        border: 1px solid rgba(255, 165, 0, 0.7);
        box-sizing: border-box;
      }
      .os-debug-toggle-label {
        position: absolute;
        top: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        font-size: 10px;
        padding: 1px 4px;
        border-radius: 0 0 0 4px;
        font-family: monospace;
        z-index: 9999;
      }
      [data-os-active="true"] .os-debug-toggle-overlay {
        background-color: rgba(255, 165, 0, 0.3);
        border: 2px solid rgba(255, 165, 0, 0.9);
      }
      
      /* Debug bar styles */
      .os-debug-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: rgba(33, 33, 33, 0.9);
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        font-size: 14px;
        z-index: 10001;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 16px;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
      }
      
      .os-debug-bar-title {
        font-weight: 600;
        margin-right: 20px;
      }
      
      .os-debug-bar-controls {
        display: flex;
        align-items: center;
      }
      
      .os-debug-bar-control {
        margin: 0 10px;
        display: flex;
        align-items: center;
      }
      
      .os-debug-bar-toggle {
        position: relative;
        display: inline-block;
        width: 40px;
        height: 20px;
        margin-left: 8px;
      }
      
      .os-debug-bar-toggle input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      
      .os-debug-bar-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 20px;
      }
      
      .os-debug-bar-slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
      }
      
      input:checked + .os-debug-bar-slider {
        background-color: #2196F3;
      }
      
      input:checked + .os-debug-bar-slider:before {
        transform: translateX(20px);
      }
      
      .os-debug-bar-button {
        background-color: #2196F3;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 4px 10px;
        font-size: 12px;
        cursor: pointer;
        margin-left: 10px;
      }
      
      .os-debug-bar-button:hover {
        background-color: #0b7dda;
      }
    `,document.head.appendChild(t),l(this,ai,!0)}static addDebugOverlay(t,i,r,n={}){if(!e(this,jt))return;window.getComputedStyle(t).position==="static"&&(t.style.position="relative");let c=document.createElement("div");c.className=`os-debug-${r}-overlay`;let d=document.createElement("div");d.className=`os-debug-${r}-label`;let h=`ID: ${i}`;Object.entries(n).forEach(([p,v])=>{h+=` | ${p}: ${v}`}),d.textContent=h,e(this,Lt)||(c.style.display="none",d.style.display="none"),t.appendChild(c),t.appendChild(d),e(this,ci).push(c),e(this,ci).push(d)}};ai=new WeakMap,jt=new WeakMap,Lt=new WeakMap,ci=new WeakMap,o(X,ai,!1),o(X,jt,!1),o(X,Lt,!1),o(X,ci,[]);var B,G,le,Vt,ke,yo,Gd,bo,Kd,vo,Jd,So,Yd,li,po,wo,Xd,dr,vc,hr,Sc,ur,wc,fo=class{constructor(t){o(this,yo);o(this,bo);o(this,vo);o(this,So);o(this,li);o(this,wo);o(this,dr);o(this,hr);o(this,ur);o(this,B,void 0);o(this,G,void 0);o(this,le,{});o(this,Vt,{});o(this,ke,!1);l(this,B,t),l(this,G,t.logger.createModuleLogger("SELECTOR")),l(this,ke,X.initDebugMode()),s(this,yo,Gd).call(this),e(this,G).info("SelectorManager initialized"),e(this,ke)&&e(this,G).info("Debug mode enabled for selectors")}};B=new WeakMap,G=new WeakMap,le=new WeakMap,Vt=new WeakMap,ke=new WeakMap,yo=new WeakSet,Gd=function(){document.querySelectorAll('[data-os-component="selector"][data-os-selection-mode="swap"]').forEach(t=>s(this,bo,Kd).call(this,t)),setTimeout(()=>s(this,ur,wc).call(this),0),e(this,B).state?.subscribe("cart",()=>s(this,ur,wc).call(this))},bo=new WeakSet,Kd=function(t){let i=t.getAttribute("data-os-id");if(!i){e(this,G).warn("Selector missing data-os-id",t);return}let r=t.getAttribute("data-os-selection-mode")||"swap";e(this,le)[i]={element:t,items:[],mode:r},e(this,Vt)[i]=null,t.querySelectorAll('[data-os-element="card"]').forEach(n=>s(this,vo,Jd).call(this,i,n)),e(this,ke)&&X.addDebugOverlay(t,i,"overlay",{Mode:r})},vo=new WeakSet,Jd=function(t,i){let r=i.getAttribute("data-os-package");if(!r){e(this,G).warn("Card missing data-os-package",i);return}let a=i.querySelector(".pb-quantity__price.pb--current")?.textContent.trim()??"$0.00 USD",c=Number.parseFloat(a.match(/\$(\d+\.\d+)/)?.[1]??"0"),h=i.querySelector(".card-title")?.textContent.trim()??`Package ${r}`,p=Number.parseInt(i.getAttribute("data-os-quantity")??"1",10),v=i.getAttribute("data-os-selected")==="true",L={element:i,packageId:r,quantity:p,price:c,name:h,isPreSelected:v};e(this,le)[t].items.push(L),i.addEventListener("click",()=>s(this,So,Yd).call(this,t,L)),e(this,ke)&&X.addDebugOverlay(i,r,"card",{Price:`$${c}`,Qty:p,PreSel:v?"Yes":"No"})},So=new WeakSet,Yd=function(t,i){let r=e(this,Vt)[t];s(this,li,po).call(this,t,i),s(this,wo,Xd).call(this,t,r)},li=new WeakSet,po=function(t,i){e(this,Vt)[t]!==i&&(e(this,le)[t].items.forEach(r=>{r.element.classList.remove("os--selected"),r.element.setAttribute("data-os-selected","false"),r.isSelected=!1}),i.element.classList.add("os--selected"),i.element.setAttribute("data-os-selected","true"),i.isSelected=!0,e(this,Vt)[t]=i,e(this,G).debug(`Selected item ${i.packageId} in selector ${t}`))},wo=new WeakSet,Xd=function(t,i){if(!e(this,B).cart){e(this,G).error("Cart manager not available");return}let r=e(this,Vt)[t];r&&(i&&i.packageId!==r.packageId&&s(this,hr,Sc).call(this,i),e(this,B).cart.isItemInCart(r.packageId)||s(this,dr,vc).call(this,r))},dr=new WeakSet,vc=function(t){if(!e(this,B).cart){e(this,G).error("Cart manager not available in addItemToCart");return}if(typeof e(this,B).cart.addToCart!="function"){e(this,G).error("addToCart is not a function on this.#app.cart:",e(this,B).cart);return}e(this,G).info(`Adding item ${t.packageId} to cart`),e(this,B).cart.addToCart({id:t.packageId,name:t.name,price:t.price,quantity:t.quantity,type:"package"}),t.element.classList.add("os--active"),t.element.setAttribute("data-os-active","true")},hr=new WeakSet,Sc=function(t){if(!e(this,B).cart){e(this,G).error("Cart manager not available in removeItemFromCart");return}if(typeof e(this,B).cart.removeFromCart!="function"){e(this,G).error("removeFromCart is not a function on this.#app.cart:",e(this,B).cart);return}e(this,G).info(`Removing item ${t.packageId} from cart`),e(this,B).cart.removeFromCart(t.packageId),t.element.classList.remove("os--active"),t.element.setAttribute("data-os-active","false")},ur=new WeakSet,wc=function(){if(!e(this,B).cart){e(this,G).debug("Cart manager not available for sync");return}if(!e(this,B).state?.getState("cart")){e(this,G).debug("Cart state not available");return}e(this,G).debug("Syncing with cart, this.#app.cart:",e(this,B).cart),Object.keys(e(this,le)).forEach(i=>{let r=e(this,le)[i].items,n=r.filter(a=>e(this,B).cart.isItemInCart(a.packageId));if(n.length>0){let a=n[0];s(this,li,po).call(this,i,a),n.forEach(c=>{c.packageId!==a.packageId&&s(this,hr,Sc).call(this,c)})}else if(!e(this,Vt)[i]){let a=r.find(c=>c.isPreSelected);a&&(s(this,li,po).call(this,i,a),s(this,dr,vc).call(this,a))}r.forEach(a=>{let c=e(this,B).cart.isItemInCart(a.packageId);a.element.classList.toggle("os--active",c),a.element.setAttribute("data-os-active",c.toString())})})};var di,St,Z,hi,Eo,Zd,xo,Qd,ko,th,To,eh,mr,_c,ui,_o,Ao,ih,gr,Cc,$o,rh,Io,sh,Co=class{constructor(t){o(this,Eo);o(this,xo);o(this,ko);o(this,To);o(this,mr);o(this,ui);o(this,Ao);o(this,gr);o(this,$o);o(this,Io);o(this,di,{});o(this,St,void 0);o(this,Z,void 0);o(this,hi,!1);l(this,St,t),l(this,Z,t.logger.createModuleLogger("TOGGLE")),l(this,hi,X.initDebugMode()),s(this,Eo,Zd).call(this),e(this,St).state.subscribe("cart",()=>s(this,Ao,ih).call(this)),e(this,Z).info("ToggleManager initialized"),e(this,hi)&&e(this,Z).info("Debug mode enabled for toggle items")}};di=new WeakMap,St=new WeakMap,Z=new WeakMap,hi=new WeakMap,Eo=new WeakSet,Zd=function(){let t=document.querySelectorAll('[data-os-action="toggle-item"]');if(!t.length){e(this,Z).debug("No toggle item buttons found in the DOM");return}e(this,Z).info(`Found ${t.length} toggle item buttons`),t.forEach(i=>s(this,xo,Qd).call(this,i))},xo=new WeakSet,Qd=function(t){let i=t.getAttribute("data-os-package");if(!i){e(this,Z).warn("Toggle item missing data-os-package attribute",t);return}let r=Number.parseInt(t.getAttribute("data-os-quantity")??"1",10),n=t.getAttribute("data-os-id")??`toggle-${i}`;e(this,di)[n]={element:t,packageId:i,quantity:r},s(this,ui,_o).call(this,t,i),t.addEventListener("click",a=>{a.preventDefault(),s(this,To,eh).call(this,n)}),e(this,hi)&&s(this,ko,th).call(this,t,n,i,r),e(this,Z).debug(`Initialized toggle item ${n} for package ${i}`)},ko=new WeakSet,th=function(t,i,r,n){let a=s(this,mr,_c).call(this,r),c=a?a.price:"N/A";X.addDebugOverlay(t,i,"toggle",{Package:r,Qty:n,Price:c})},To=new WeakSet,eh=function(t){let i=e(this,di)[t];if(!i){e(this,Z).error(`Toggle item ${t} not found`);return}let{packageId:r,quantity:n,element:a}=i,c=s(this,gr,Cc).call(this,r);if(c)s(this,Io,sh).call(this,r),e(this,Z).info(`Toggled OFF item ${r}`);else{let d=s(this,mr,_c).call(this,r);if(!d){e(this,Z).error(`Package ${r} not found in campaign data`);return}s(this,$o,rh).call(this,{id:r,name:d.name,price:Number.parseFloat(d.price),quantity:n,type:"package"}),e(this,Z).info(`Toggled ON item ${r}`)}s(this,ui,_o).call(this,a,r),e(this,St).triggerEvent("toggle.changed",{toggleId:t,packageId:r,isActive:!c})},mr=new WeakSet,_c=function(t){return e(this,St).campaignData?.packages?e(this,St).campaignData.packages.find(i=>i.ref_id.toString()===t.toString())??null:(e(this,Z).error("Campaign data not available"),null)},ui=new WeakSet,_o=function(t,i){let r=s(this,gr,Cc).call(this,i);t.classList.toggle("os--active",r),t.setAttribute("data-os-active",r.toString())},Ao=new WeakSet,ih=function(){Object.values(e(this,di)).forEach(({element:t,packageId:i})=>s(this,ui,_o).call(this,t,i))},gr=new WeakSet,Cc=function(t){return e(this,St).state.getState("cart").items.some(i=>i.id===t)},$o=new WeakSet,rh=function(t){if(!e(this,St).cart){e(this,Z).error("Cart manager not available");return}e(this,St).cart.addToCart(t)},Io=new WeakSet,sh=function(t){if(!e(this,St).cart){e(this,Z).error("Cart manager not available");return}e(this,St).cart.removeFromCart(t)};var Te,gt,Gt,Kt,Ae,pr,Fo,nh,No,oh,fr,Ec,mi,Lo,gi,Po,yr,xc,Uo,ah,pi,qo,Mo=class{constructor(t){o(this,Fo);o(this,No);o(this,fr);o(this,mi);o(this,gi);o(this,yr);o(this,Uo);o(this,pi);o(this,Te,void 0);o(this,gt,void 0);o(this,Gt,!1);o(this,Kt,null);o(this,Ae,null);o(this,pr,!1);l(this,Te,t),l(this,gt,t.logger.createModuleLogger("DEBUG")),l(this,pr,X.initDebugMode()),s(this,Fo,nh).call(this),e(this,gt).info("DebugManager initialized")}};Te=new WeakMap,gt=new WeakMap,Gt=new WeakMap,Kt=new WeakMap,Ae=new WeakMap,pr=new WeakMap,Fo=new WeakSet,nh=function(){window.showMiniCart=()=>s(this,mi,Lo).call(this),window.hideMiniCart=()=>s(this,gi,Po).call(this),window.toggleMiniCart=()=>s(this,yr,xc).call(this),window.toggleXray=t=>s(this,fr,Ec).call(this,t),e(this,pr)&&(e(this,gt).info("Debug mode activated via URL parameter"),s(this,No,oh).call(this),localStorage.getItem("os_debug_mini_cart_visible")==="true"&&s(this,mi,Lo).call(this)),e(this,Te).state?.subscribe("cart",()=>{e(this,Gt)&&s(this,pi,qo).call(this)}),e(this,gt).debug("Debug methods exposed to window object")},No=new WeakSet,oh=function(){if(e(this,Ae))return;let t=document.createElement("div");t.className="os-debug-bar";let i=document.createElement("div");i.className="os-debug-bar-left";let r=document.createElement("span");r.className="os-debug-bar-title",r.textContent="29next Debug Tools",i.appendChild(r);let n=document.createElement("div");n.className="os-debug-bar-controls";let a=document.createElement("div");a.className="os-debug-bar-control";let c=document.createElement("span");c.textContent="X-ray View";let d=document.createElement("label");d.className="os-debug-bar-toggle";let h=document.createElement("input");h.type="checkbox",h.checked=X.isXrayEnabled(),h.addEventListener("change",()=>s(this,fr,Ec).call(this,h.checked));let p=document.createElement("span");p.className="os-debug-bar-slider",d.append(h,p),a.append(c,d);let v=document.createElement("div");v.className="os-debug-bar-control";let L=document.createElement("button");L.className="os-debug-bar-button",L.textContent="Toggle Mini-Cart",L.addEventListener("click",()=>s(this,yr,xc).call(this)),v.appendChild(L),n.append(a,v),t.append(i,n),document.body.appendChild(t),l(this,Ae,t)},fr=new WeakSet,Ec=function(t){let i=X.toggleXray(t);if(e(this,Ae)){let r=e(this,Ae).querySelector('input[type="checkbox"]');r&&(r.checked=i)}return e(this,gt).info(`X-ray view ${i?"enabled":"disabled"}`),i},mi=new WeakSet,Lo=function(){if(e(this,Gt)){e(this,gt).debug("Mini-cart already visible");return}e(this,gt).info("Showing mini-cart widget"),e(this,Kt)??l(this,Kt,s(this,Uo,ah).call(this)),e(this,Kt).style.display="block",l(this,Gt,!0),localStorage.setItem("os_debug_mini_cart_visible","true"),s(this,pi,qo).call(this)},gi=new WeakSet,Po=function(){if(!e(this,Gt)){e(this,gt).debug("Mini-cart already hidden");return}e(this,gt).info("Hiding mini-cart widget"),e(this,Kt)&&(e(this,Kt).style.display="none"),l(this,Gt,!1),localStorage.setItem("os_debug_mini_cart_visible","false")},yr=new WeakSet,xc=function(){e(this,Gt)?s(this,gi,Po).call(this):s(this,mi,Lo).call(this)},Uo=new WeakSet,ah=function(){let t=document.createElement("div");t.className="os-debug-mini-cart",t.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      width: 300px;
      max-height: 400px;
      overflow-y: auto;
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      z-index: 9999;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      font-size: 14px;
      display: none;
    `;let i=document.createElement("div");i.className="os-debug-mini-cart-header",i.style.cssText=`
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      background-color: #f5f5f5;
      border-bottom: 1px solid #eee;
    `;let r=document.createElement("div");r.className="os-debug-mini-cart-title",r.textContent="Debug Mini-Cart",r.style.fontWeight="600";let n=document.createElement("div");n.style.display="flex",n.style.alignItems="center";let a=document.createElement("button");a.className="os-debug-mini-cart-refresh",a.textContent="â†»",a.title="Refresh cart data",a.style.cssText=`
      background: none;
      border: none;
      font-size: 16px;
      cursor: pointer;
      padding: 0 8px;
      line-height: 1;
      color: #666;
    `,a.addEventListener("click",()=>{s(this,pi,qo).call(this),e(this,gt).info("Mini-cart data refreshed manually")});let c=document.createElement("button");c.className="os-debug-mini-cart-close",c.textContent="Ã—",c.style.cssText=`
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      padding: 0;
      line-height: 1;
    `,c.addEventListener("click",()=>s(this,gi,Po).call(this)),n.append(a,c),i.append(r,n);let d=document.createElement("div");d.className="os-debug-mini-cart-content",d.style.padding="15px";let h=document.createElement("div");return h.className="os-debug-mini-cart-footer",h.style.cssText=`
      padding: 10px 15px;
      background-color: #f5f5f5;
      border-top: 1px solid #eee;
      font-size: 12px;
      color: #666;
      text-align: center;
    `,h.textContent="Use window.hideMiniCart() to hide this widget",t.append(i,d,h),document.body.appendChild(t),t},pi=new WeakSet,qo=function(){if(!e(this,Kt))return;let t=e(this,Kt).querySelector(".os-debug-mini-cart-content");if(!t)return;let i=e(this,Te).state?.getState("cart");if(!i){t.innerHTML='<div style="color: #999; text-align: center;">Cart data not available</div>';return}e(this,gt).debug("Updating mini-cart with cart data:",i);let r=a=>e(this,Te).campaign?.formatPrice(a)??`$${a.toFixed(2)}`,n="";i.items?.length?(n+='<div style="margin-bottom: 15px;">',n+='<div style="font-weight: 600; margin-bottom: 10px;">Items:</div>',n+='<ul style="list-style: none; padding: 0; margin: 0;">',i.items.forEach(a=>{n+=`
          <li style="padding: 5px 0; border-bottom: 1px solid #eee;">
            <div style="display: flex; justify-content: space-between;">
              <div style="font-weight: 500;">${a.name}</div>
              <div>${a.quantity} Ã— ${r(a.price)}</div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
              <div style="color: #666; font-size: 12px;">ID: ${a.id}</div>
              <div style="font-weight: 500;">${r(a.price*a.quantity)}</div>
            </div>
          </li>
        `}),n+="</ul></div>"):n+='<div style="color: #999; text-align: center; margin-bottom: 15px;">Cart is empty</div>',i.totals?(n+="<div>",n+='<div style="font-weight: 600; margin-bottom: 10px;">Totals:</div>',n+='<ul style="list-style: none; padding: 0; margin: 0;">',n+=`
        <li style="display: flex; justify-content: space-between; padding: 3px 0;">
          <div>Subtotal:</div>
          <div>${r(i.totals.subtotal)}</div>
        </li>
      `,i.totals.retail_subtotal>i.totals.subtotal&&(n+=`
          <li style="display: flex; justify-content: space-between; padding: 3px 0;">
            <div>Retail Subtotal:</div>
            <div>${r(i.totals.retail_subtotal)}</div>
          </li>
        `,i.totals.savings&&(n+=`
            <li style="display: flex; justify-content: space-between; padding: 3px 0; color: #e53935;">
              <div>Savings:</div>
              <div>${r(i.totals.savings)} (${Math.round(i.totals.savings_percentage)}%)</div>
            </li>
          `)),i.totals.shipping>0&&(n+=`
          <li style="display: flex; justify-content: space-between; padding: 3px 0;">
            <div>Shipping:</div>
            <div>${r(i.totals.shipping)}</div>
          </li>
        `),i.totals.recurring_total>0&&(n+=`
          <li style="display: flex; justify-content: space-between; padding: 3px 0; color: #2196f3;">
            <div>Recurring Total:</div>
            <div>${r(i.totals.recurring_total)}</div>
          </li>
        `),n+=`
        <li style="display: flex; justify-content: space-between; padding: 3px 0; font-weight: 600; margin-top: 5px; border-top: 1px solid #eee;">
          <div>Total:</div>
          <div>${r(i.totals.total)}</div>
        </li>
      `,n+="</ul></div>"):n+='<div style="color: #999; text-align: center; margin-bottom: 15px;">Cart totals not available</div>',t.innerHTML=n};var Oo,st,de,Do,br,kc,Ro,ch,Wo,lh,Ho,dh,vr,Tc,zo=class{constructor(t){o(this,br);o(this,Ro);o(this,Wo);o(this,Ho);o(this,vr);o(this,Oo,void 0);o(this,st,void 0);o(this,de,new Map);o(this,Do,"os-timer-");l(this,Oo,t),l(this,st,t.logger.createModuleLogger("TIMER")),s(this,br,kc).call(this),e(this,st).infoWithTime("TimerManager initialized")}refreshTimers(){e(this,st).infoWithTime("Refreshing timers"),e(this,de).forEach(t=>{t.intervalId&&(clearInterval(t.intervalId),t.intervalId=null)}),e(this,de).clear(),s(this,br,kc).call(this)}getTimers(){return e(this,de)}};Oo=new WeakMap,st=new WeakMap,de=new WeakMap,Do=new WeakMap,br=new WeakSet,kc=function(){e(this,st).infoWithTime("Initializing timers");let t=document.querySelectorAll('[data-os-element="timer"]');if(t.length===0){e(this,st).debugWithTime("No timer elements found on page");return}e(this,st).debugWithTime(`Found ${t.length} timer elements`),t.forEach(i=>{s(this,Ro,ch).call(this,i)})},Ro=new WeakSet,ch=function(t){let i=t.closest('[data-os-element="timer-text"]');i||e(this,st).warnWithTime('Timer element has no parent with data-os-element="timer-text", using default configuration');let r=s(this,Wo,lh).call(this,t,i);if(!r.duration){e(this,st).warnWithTime(`Timer element is missing duration, skipping: ${t.outerHTML}`);return}let n=i?i.innerHTML:null,a=+new Date,c=r.persistenceId;if(c){let p=e(this,Do)+c,v=parseInt(localStorage.getItem(p)||"");v>0?(a=v,e(this,st).debugWithTime(`Loaded persisted timer start time for ${c}: ${new Date(a).toISOString()}`)):(localStorage.setItem(p,String(a)),e(this,st).debugWithTime(`Saved new timer start time for ${c}: ${new Date(a).toISOString()}`))}else e(this,st).debugWithTime(`Timer has no persistence ID, it will reset with every page load: ${t.outerHTML}`);let d={element:t,parentElement:i,config:r,startTime:a,intervalId:null,originalParentContent:n};e(this,de).set(t,d);let h=()=>{let v=(+new Date-a)/1e3,L=Math.round(r.duration-v);if(L<=0){L=0,r.expiryText?i&&r.replaceEntireContent?i.innerHTML=r.expiryText:t.innerText=r.expiryText:t.innerText="00:00",d.intervalId&&(clearInterval(d.intervalId),d.intervalId=null),e(this,de).delete(t),s(this,vr,Tc).call(this,"expired",t,{timerElement:t,parentElement:i,config:r});return}let Ei=Math.floor(L/3600);L-=Ei*3600;let zt=Math.floor(L/60);L-=zt*60;let at=s(this,Ho,dh).call(this,Ei,zt,L,r.format);t.innerText=at,s(this,vr,Tc).call(this,"updated",t,{timerElement:t,parentElement:i,config:r,remaining:{hours:Ei,minutes:zt,seconds:L},formattedTime:at})};h(),d.intervalId=setInterval(h,1e3),e(this,st).debugWithTime(`Timer initialized: ${r.duration} seconds, persistence ID: ${r.persistenceId||"none"}`)},Wo=new WeakSet,lh=function(t,i){let r={duration:0,persistenceId:null,expiryText:null,format:"auto",replaceEntireContent:!1};return t.dataset.osDuration?r.duration=parseInt(t.dataset.osDuration):i?.dataset.osTimerDuration&&(r.duration=parseInt(i.dataset.osTimerDuration)),t.dataset.osPersistenceId?r.persistenceId=t.dataset.osPersistenceId:i?.dataset.osTimerPersistenceId&&(r.persistenceId=i.dataset.osTimerPersistenceId),t.dataset.osExpiryText?r.expiryText=t.dataset.osExpiryText:i?.dataset.osTimerExpiryText&&(r.expiryText=i.dataset.osTimerExpiryText),t.dataset.osFormat?r.format=t.dataset.osFormat:i?.dataset.osTimerFormat&&(r.format=i.dataset.osTimerFormat),(t.dataset.osReplaceEntireContent==="true"||i?.dataset.osTimerReplaceEntireContent==="true")&&(r.replaceEntireContent=!0),r.expiryText&&(r.expiryText.includes("<")||r.expiryText.includes(">"))&&(r.replaceEntireContent=!0),r},Ho=new WeakSet,dh=function(t,i,r,n){let a=c=>c.toString().padStart(2,"0");return n==="hh:mm:ss"||n==="auto"&&t>0?`${a(t)}:${a(i)}:${a(r)}`:n==="mm:ss"||n==="auto"&&i>0?`${a(i)}:${a(r)}`:n==="ss"?a(r):`${a(i)}:${a(r)}`},vr=new WeakSet,Tc=function(t,i,r={}){let n=new CustomEvent(`os:timer.${t}`,{bubbles:!0,cancelable:!0,detail:{...r,manager:this}});i.dispatchEvent(n),document.dispatchEvent(n),e(this,st).debugWithTime(`Timer event triggered: ${t}`)};var fi,pt,yi,Sr,Ac,jo,hh,Vo,uh,Bo=class{constructor(t){o(this,Sr);o(this,jo);o(this,Vo);o(this,fi,void 0);o(this,pt,void 0);o(this,yi,new Map);l(this,fi,t),l(this,pt,t.logger.createModuleLogger("DISPLAY")),s(this,Sr,Ac).call(this),e(this,fi).state.subscribe("cart",()=>this.refreshDisplayElements()),e(this,pt).infoWithTime("DisplayManager initialized")}refreshDisplayElements(){e(this,pt).debugWithTime("Refreshing display elements");let i=e(this,fi).state.getState("cart").items.map(r=>r.id.toString());e(this,yi).forEach((r,n)=>{s(this,jo,hh).call(this,n,r,i)})}refresh(){e(this,pt).infoWithTime("Manually refreshing display elements"),e(this,yi).clear(),s(this,Sr,Ac).call(this)}};fi=new WeakMap,pt=new WeakMap,yi=new WeakMap,Sr=new WeakSet,Ac=function(){e(this,pt).infoWithTime("Initializing display elements");let t=document.querySelectorAll('[data-os-cart="swap-display"]');if(t.length===0){e(this,pt).debugWithTime("No swap display containers found on page");return}e(this,pt).debugWithTime(`Found ${t.length} swap display containers`),t.forEach((i,r)=>{let n=i.dataset.osId||`auto-container-${r}`,a=i.querySelectorAll('[data-os-in-cart="display"]');if(a.length===0){e(this,pt).warnWithTime(`Container ${n} has no display elements`);return}e(this,yi).set(i,{id:n,elements:Array.from(a).map(c=>({element:c,packageId:c.dataset.osPackage}))}),e(this,pt).debugWithTime(`Initialized container ${n} with ${a.length} display elements`)}),this.refreshDisplayElements()},jo=new WeakSet,hh=function(t,i,r){let{id:n,elements:a}=i,c=!1;for(let{element:d,packageId:h}of a)h&&r.includes(h)?(d.style.display="block",c=!0,e(this,pt).debugWithTime(`Showing element for package ${h} in container ${n}`)):d.style.display="none";!c&&a.length>0,s(this,Vo,uh).call(this,"updated",t,{containerId:n,hasVisibleElement:c,visiblePackageIds:a.filter(({element:d})=>d.style.display==="block").map(({packageId:d})=>d)})},Vo=new WeakSet,uh=function(t,i,r={}){let n=new CustomEvent(`os:display.${t}`,{bubbles:!0,cancelable:!0,detail:{...r,manager:this}});i.dispatchEvent(n),document.dispatchEvent(n),e(this,pt).debugWithTime(`Display event triggered: ${t}`)};var he,b,S,Ut,bi,wr,$c,Ko,mh,Jo,gh,Yo,ph,Xo,fh,Zo,yh,Qo,bh,ta,vh,ea,Sh,ft,Tt,ia,wh,ra,_h,Ic,du,Go=class{constructor(t){o(this,wr);o(this,Ko);o(this,Jo);o(this,Yo);o(this,Xo);o(this,Zo);o(this,Qo);o(this,ta);o(this,ea);o(this,ft);o(this,ia);o(this,ra);o(this,Ic);o(this,he,void 0);o(this,b,void 0);o(this,S,{lineDisplays:[],summaryContainers:[],savingsBars:[],shippingBars:[],grandTotals:[],summaryBars:[],summaryPanels:[],summaryTexts:[],summaryIcons:[],compareTotalElements:[]});o(this,Ut,{currencySymbol:"$",showComparePricing:!0,showProductImages:!0,showTaxPendingMessage:!0});o(this,bi,null);l(this,he,t),l(this,b,t.logger.createModuleLogger("CART_DISPLAY")),s(this,wr,$c).call(this),e(this,he).state.subscribe("cart",()=>this.updateCartDisplay()),e(this,b).infoWithTime("CartDisplayManager initialized")}updateCartDisplay(){e(this,b).debugWithTime("Updating cart display");let t=e(this,he).state.getState("cart");if(!t){e(this,b).warnWithTime("Cart data not available");return}e(this,b).debugWithTime(`Cart data: ${JSON.stringify(t)}`),s(this,Yo,ph).call(this,t.items),s(this,Zo,yh).call(this,t.totals),s(this,Qo,bh).call(this,t.totals.shipping,t.shippingMethod),s(this,ta,vh).call(this,t.totals),s(this,ea,Sh).call(this,t.totals.total),s(this,ra,_h).call(this,t.totals),e(this,b).debugWithTime("Cart display updated")}refresh(){e(this,b).infoWithTime("Manually refreshing cart display"),s(this,wr,$c).call(this)}};he=new WeakMap,b=new WeakMap,S=new WeakMap,Ut=new WeakMap,bi=new WeakMap,wr=new WeakSet,$c=function(){if(e(this,b).infoWithTime("Initializing cart display"),e(this,S).lineDisplays=document.querySelectorAll('[data-os-cart-summary="line-display"]'),e(this,S).summaryContainers=document.querySelectorAll('[data-os-cart="summary"]'),e(this,S).savingsBars=document.querySelectorAll('[data-os-cart-summary="savings"]'),e(this,S).shippingBars=document.querySelectorAll('[data-os-cart-summary="shipping-bar"]'),e(this,S).grandTotals=document.querySelectorAll('[data-os-cart-summary="grand-total"]'),e(this,S).summaryBars=document.querySelectorAll('[os-checkout-element="summary-bar"]'),e(this,S).summaryPanels=document.querySelectorAll('[os-checkout-element="summary-mobile"]'),e(this,S).summaryTexts=document.querySelectorAll('[os-checkout-element="summary-text"]'),e(this,S).summaryIcons=document.querySelectorAll("[os-summary-icon]"),e(this,S).compareTotalElements=document.querySelectorAll('[data-os-cart-summary="compare-total"]'),e(this,b).debugWithTime(`Line displays found: ${e(this,S).lineDisplays.length}`),e(this,b).debugWithTime(`Summary containers found: ${e(this,S).summaryContainers.length}`),e(this,b).debugWithTime(`Savings bars found: ${e(this,S).savingsBars.length}`),e(this,b).debugWithTime(`Shipping bars found: ${e(this,S).shippingBars.length}`),e(this,b).debugWithTime(`Grand total elements found: ${e(this,S).grandTotals.length}`),e(this,b).debugWithTime(`Summary bars found: ${e(this,S).summaryBars.length}`),e(this,b).debugWithTime(`Summary panels found: ${e(this,S).summaryPanels.length}`),e(this,b).debugWithTime(`Summary texts found: ${e(this,S).summaryTexts.length}`),e(this,b).debugWithTime(`Summary icons found: ${e(this,S).summaryIcons.length}`),e(this,b).debugWithTime(`Compare total elements found: ${e(this,S).compareTotalElements.length}`),e(this,S).summaryContainers.length>0){let i=e(this,S).summaryContainers[0];e(this,Ut).showComparePricing=i.dataset.showComparePricing!=="false",e(this,Ut).showProductImages=i.dataset.showProductImages!=="false",e(this,Ut).showTaxPendingMessage=i.dataset.showTaxPendingMessage!=="false",e(this,Ut).currencySymbol=i.dataset.currencySymbol||"$"}let t=document.querySelector('[data-os-cart-summary="line-item"]');t&&l(this,bi,t.cloneNode(!0)),s(this,Ko,mh).call(this),e(this,b).debugWithTime("Cart display elements initialized"),this.updateCartDisplay()},Ko=new WeakSet,mh=function(){let{summaryBars:t,summaryPanels:i,summaryTexts:r,summaryIcons:n}=e(this,S);if(!t.length||!i.length){e(this,b).debugWithTime("Summary toggle elements not found, skipping initialization");return}e(this,b).debugWithTime("Initializing summary toggle"),i.forEach((a,c)=>{if(a.classList.add("no-transition"),!a.classList.contains("cc-expanded")){a.style.height="0",a.style.opacity="0",a.style.overflow="hidden";let d=r[c];d&&(d.textContent="Show Order Summary")}requestAnimationFrame(()=>{a.classList.remove("no-transition"),a.style.transition="height 0.3s ease-out, opacity 0.25s ease-out"})}),t.forEach((a,c)=>{a.addEventListener("click",d=>{d.preventDefault(),s(this,Jo,gh).call(this,c)})}),window.addEventListener("resize",s(this,ia,wh).call(this,()=>{i.forEach(a=>{a.classList.contains("cc-expanded")&&(a.style.height="auto")})},250)),e(this,b).debugWithTime("Summary toggle initialized")},Jo=new WeakSet,gh=function(t=0){let{summaryPanels:i,summaryTexts:r,summaryIcons:n}=e(this,S),a=i[t],c=r[t],d=n[t];if(!a)return;if(!a.classList.contains("cc-expanded"))a.classList.add("cc-expanded"),a.style.height=`${a.scrollHeight}px`,a.style.opacity="1",c&&(c.textContent="Hide Order Summary"),d&&(d.style.transform="rotate(180deg)"),a.addEventListener("transitionend",()=>{a.classList.contains("cc-expanded")&&(a.style.height="auto")},{once:!0}),e(this,b).debugWithTime("Summary panel expanded");else{let p=a.scrollHeight;a.style.height=`${p}px`,a.offsetHeight,a.style.height="0",a.style.opacity="0",c&&(c.textContent="Show Order Summary"),d&&(d.style.transform="rotate(0deg)"),a.addEventListener("transitionend",()=>{a.style.height==="0px"&&a.classList.remove("cc-expanded")},{once:!0}),e(this,b).debugWithTime("Summary panel collapsed")}},Yo=new WeakSet,ph=function(t){if(!e(this,S).lineDisplays.length||!e(this,bi)){e(this,b).warnWithTime("Line displays or template not found");return}if(!t||t.length===0){e(this,b).debugWithTime("No items in cart");return}e(this,S).lineDisplays.forEach(r=>{r.innerHTML="",t.forEach(n=>{let a=s(this,Xo,fh).call(this,n);r.appendChild(a)})});let i=document.querySelectorAll('[data-os-cart-summary="summary-scroll"]');if(i.length){let r=t.length>2;i.forEach(n=>{n.classList.toggle("hide",!r)})}},Xo=new WeakSet,fh=function(t){let i=e(this,bi).cloneNode(!0),r=i.querySelector('[data-os-cart-summary="line-title"]');if(r&&(r.textContent=t.name),e(this,Ut).showProductImages){let h=i.querySelector('[data-os-cart-summary="line-image"]');h&&t.image&&(h.src=t.image,h.alt=t.name)}let n=i.querySelector('[os-cart="line_item-qty"]');n&&(n.textContent=t.quantity||1);let a=i.querySelector('[data-os-cart-summary="line-compare"]'),c=i.querySelector('[data-os-cart-summary="line-sale"]');a&&t.retail_price&&e(this,Ut).showComparePricing?(a.textContent=s(this,ft,Tt).call(this,t.retail_price*(t.quantity||1)),a.classList.remove("hide")):a&&a.classList.add("hide"),c&&(c.textContent=s(this,ft,Tt).call(this,t.price*(t.quantity||1)));let d=i.querySelector('[data-os-cart-summary="line-saving-percent"]');if(d&&t.retail_price){let h=Math.round((1-t.price/t.retail_price)*100);if(h>0){let p=d.dataset.osFormat||"default",v=`${h}% OFF`;p==="parenthesis"&&(v=`(${h}% OFF)`),d.textContent=v,d.classList.remove("hide")}else d.classList.add("hide")}else d&&d.classList.add("hide");return i},Zo=new WeakSet,yh=function(t){},Qo=new WeakSet,bh=function(t,i){if(!e(this,S).shippingBars.length){e(this,b).warnWithTime("Shipping bars not found");return}e(this,S).shippingBars.forEach(r=>{let n=r.querySelector('[data-os-cart-summary="shipping-compare"]'),a=r.querySelector('[data-os-cart-summary="shipping-current"]');n&&a&&(t===0&&i?.standard_cost>0?(n.textContent=s(this,ft,Tt).call(this,i.standard_cost),a.textContent="FREE",n.classList.remove("hide")):t>0?(a.textContent=s(this,ft,Tt).call(this,t),n.classList.add("hide")):(a.textContent="FREE",n.classList.add("hide")))})},ta=new WeakSet,vh=function(t){if(!e(this,S).savingsBars.length){e(this,b).warnWithTime("Savings bars not found");return}e(this,S).savingsBars.forEach(n=>{let a=n.querySelector('[data-os-cart-summary="savings-amount"]'),c=n.querySelector('[data-os-cart-summary="savings-percentage"]');t.savings>0&&t.savings_percentage>0?(a&&(a.textContent=s(this,ft,Tt).call(this,t.savings),e(this,b).debugWithTime(`Updated savings amount to: ${s(this,ft,Tt).call(this,t.savings)}`)),c&&(c.textContent=`${Math.round(t.savings_percentage)}% OFF`,e(this,b).debugWithTime(`Updated savings percentage to: ${Math.round(t.savings_percentage)}% OFF`)),n.classList.remove("hide")):n.classList.add("hide")});let i=document.querySelectorAll('[data-os-cart-summary="savings-amount"]'),r=document.querySelectorAll('[data-os-cart-summary="savings-percentage"]');t.savings>0&&t.savings_percentage>0&&(i.forEach(n=>{n.textContent=s(this,ft,Tt).call(this,t.savings)}),r.forEach(n=>{n.textContent=`${Math.round(t.savings_percentage)}% OFF`}))},ea=new WeakSet,Sh=function(t){if(!e(this,S).grandTotals.length){e(this,b).warnWithTime("Grand total elements not found");return}e(this,S).grandTotals.forEach(i=>{i.textContent=s(this,ft,Tt).call(this,t)}),e(this,b).debugWithTime(`Updated grand total to: ${s(this,ft,Tt).call(this,t)}`)},ft=new WeakSet,Tt=function(t){return e(this,he).campaign?.formatPrice?e(this,he).campaign.formatPrice(t):`${e(this,Ut).currencySymbol}${t.toFixed(2)} USD`},ia=new WeakSet,wh=function(t,i){let r;return function(...a){let c=()=>{clearTimeout(r),t(...a)};clearTimeout(r),r=setTimeout(c,i)}},ra=new WeakSet,_h=function(t){if(!e(this,S).compareTotalElements.length){e(this,b).debugWithTime("No compare-total elements found");return}e(this,b).debugWithTime("Updating compare-total elements"),e(this,b).debugWithTime(`Cart totals: ${JSON.stringify(t)}`),e(this,S).compareTotalElements.forEach(i=>{let r=i.dataset.totalType||"retail",n=null;switch(r){case"retail":n=t.retail_subtotal;break;case"recurring":n=t.recurring_total;break;case"subtotal_compare":case"original":case"msrp":n=t[r]||null;break;default:n=t.retail_subtotal}n&&n>t.total?(i.textContent=s(this,ft,Tt).call(this,n),i.classList.remove("hide"),e(this,b).debugWithTime(`Updated compare-total (${r}) to: ${s(this,ft,Tt).call(this,n)}`)):(i.classList.add("hide"),e(this,b).debugWithTime(`Hiding compare-total element (${r}): compareValue=${n}, total=${t.total}`))})},Ic=new WeakSet,du=function(t){return document.querySelectorAll(`[${t}]`)};var $,x,C,oa,aa,Ch,ca,Eh,la,xh,vi,sa,da,kh,_r,Lc,ha,Th,ua,Ah,ma,$h,D,j,Cr,Pc,ga,Ih,pa,Lh,na=class{constructor(t){o(this,aa);o(this,ca);o(this,la);o(this,vi);o(this,da);o(this,_r);o(this,ha);o(this,ua);o(this,ma);o(this,D);o(this,Cr);o(this,ga);o(this,pa);o(this,$,void 0);o(this,x,void 0);o(this,C,{});o(this,oa,!1);l(this,$,t),l(this,x,t.logger.createModuleLogger("ATTRIBUTION")),s(this,aa,Ch).call(this)}updateAttributionData(t){t.metadata&&e(this,C).metadata&&(t.metadata={...e(this,C).metadata,...t.metadata}),t.funnel&&e(this,x).debug(`Updating funnel value to: ${t.funnel}`),l(this,C,{...e(this,C),...t}),s(this,vi,sa).call(this),e(this,x).debug("Attribution data updated",t),e(this,$).events&&e(this,$).events.trigger("attribution.updated",{attribution:e(this,C)})}getAttributionData(){return{...e(this,C)}}getAttributionForApi(){return{affiliate:e(this,C).affiliate,funnel:e(this,C).funnel,gclid:e(this,C).gclid,metadata:e(this,C).metadata,utm_source:e(this,C).utm_source,utm_medium:e(this,C).utm_medium,utm_campaign:e(this,C).utm_campaign,utm_content:e(this,C).utm_content,utm_term:e(this,C).utm_term,subaffiliate1:e(this,C).subaffiliate1,subaffiliate2:e(this,C).subaffiliate2,subaffiliate3:e(this,C).subaffiliate3,subaffiliate4:e(this,C).subaffiliate4,subaffiliate5:e(this,C).subaffiliate5}}debug(){console.group("AttributionManager Debug Info");let t=document.querySelector('meta[name="os-tracking-tag"][data-tag-name="funnel_name"]'),i=t?t.getAttribute("data-tag-value"):"",r=e(this,$).campaign?.getCampaignName()||e(this,$).campaignData?.name||"";e(this,C).affiliate,e(this,C).funnel,console.group("API Formatted Attribution Data (What gets sent to API)");let n=this.getAttributionForApi();n.affiliate,n.funnel,n.gclid,n.utm_source,n.utm_medium,n.utm_campaign,n.utm_content,n.utm_term,n.subaffiliate1,n.subaffiliate2,n.subaffiliate3,n.subaffiliate4,n.subaffiliate5,console.group("Metadata Object:"),n.metadata.domain,n.metadata.device,n.metadata.device_type,n.metadata.fb_fbp,n.metadata.fb_fbc,n.metadata.fb_pixel_id,n.metadata,console.groupEnd(),console.groupEnd(),e(this,C),new URLSearchParams(window.location.search).toString(),console.group("Tracking Tags");let a=document.querySelectorAll('meta[name="os-tracking-tag"]');return a.length>0&&a.forEach(c=>{`${c.getAttribute("data-tag-name")}${c.getAttribute("data-tag-value")}`,c.getAttribute("data-persist")}),console.groupEnd(),t&&t.getAttribute("data-tag-value"),e(this,$).campaignData?.name,e(this,$).state&&e(this,$).state.getState("attribution"),console.groupEnd(),"Attribution debug info logged to console."}};$=new WeakMap,x=new WeakMap,C=new WeakMap,oa=new WeakMap,aa=new WeakSet,Ch=function(){e(this,x).info("Initializing AttributionManager"),s(this,ca,Eh).call(this),s(this,vi,sa).call(this),s(this,ua,Ah).call(this),l(this,oa,!0),e(this,x).info("AttributionManager initialized successfully")},ca=new WeakSet,Eh=function(){let t=document.querySelector('meta[name="os-tracking-tag"][data-tag-name="funnel_name"]'),i=t?t.getAttribute("data-tag-value"):"",r=e(this,$).campaign?.getCampaignName()||e(this,$).campaignData?.name||"",n=i||r;e(this,x).debug(`Using funnel value: ${n} (from ${i?"meta tag":"campaign name"})`);let a=s(this,D,j).call(this,"affid")||s(this,D,j).call(this,"aff")||"",c=s(this,Cr,Pc).call(this,"_fbc")||"",d=s(this,Cr,Pc).call(this,"_fbp")||"",h=s(this,pa,Lh).call(this),p={landing_page:window.location.href||"",referrer:document.referrer||"",device:navigator.userAgent||"",device_type:s(this,ga,Ih).call(this),timestamp:Date.now(),domain:window.location.hostname,fb_fbp:d,fb_fbc:c,fb_pixel_id:h},v=s(this,D,j).call(this,"fbclid")||"";v&&(p.fbclid=v),s(this,la,xh).call(this,p),l(this,C,{affiliate:a,funnel:n,gclid:s(this,D,j).call(this,"gclid")||"",metadata:p,utm_source:s(this,D,j).call(this,"utm_source")||"",utm_medium:s(this,D,j).call(this,"utm_medium")||"",utm_campaign:s(this,D,j).call(this,"utm_campaign")||"",utm_content:s(this,D,j).call(this,"utm_content")||"",utm_term:s(this,D,j).call(this,"utm_term")||"",fbclid:v,subaffiliate1:s(this,D,j).call(this,"subaffiliate1")||s(this,D,j).call(this,"sub1")||"",subaffiliate2:s(this,D,j).call(this,"subaffiliate2")||s(this,D,j).call(this,"sub2")||"",subaffiliate3:s(this,D,j).call(this,"subaffiliate3")||s(this,D,j).call(this,"sub3")||"",subaffiliate4:s(this,D,j).call(this,"subaffiliate4")||s(this,D,j).call(this,"sub4")||"",subaffiliate5:s(this,D,j).call(this,"subaffiliate5")||s(this,D,j).call(this,"sub5")||"",first_visit_timestamp:s(this,ha,Th).call(this),current_visit_timestamp:Date.now()}),e(this,x).debug("Attribution data collected",e(this,C)),!r&&e(this,$).events&&e(this,x).debug("Campaign data not available yet, will update when loaded")},la=new WeakSet,xh=function(t){let i=document.querySelectorAll('meta[name="os-tracking-tag"]');e(this,x).debug(`Found ${i.length} tracking tags`),i.forEach(r=>{let n=r.getAttribute("data-tag-name"),a=r.getAttribute("data-tag-value"),c=r.getAttribute("data-persist")==="true";if(n&&a&&(t[n]=a,e(this,x).debug(`Added tracking tag: ${n} = ${a}`),c))try{sessionStorage.setItem(`os_tag_${n}`,a),e(this,x).debug(`Persisted tracking tag: ${n} = ${a}`)}catch(d){e(this,x).error(`Error persisting tracking tag ${n}:`,d)}})},vi=new WeakSet,sa=function(){if(!e(this,$).state){e(this,x).warn("State manager not available, attribution data will not be stored");return}e(this,$).state.setState("cart.attribution",e(this,C)),e(this,$).state.setState("attribution",this.getAttributionForApi()),e(this,x).info("Attribution data stored in state"),s(this,da,kh).call(this)},da=new WeakSet,kh=function(){try{localStorage.setItem("os_attribution",JSON.stringify(e(this,C))),e(this,x).debug("Attribution data persisted to localStorage")}catch(t){e(this,x).error("Error persisting attribution data to localStorage:",t)}},_r=new WeakSet,Lc=function(){try{let t=localStorage.getItem("os_attribution");if(t)return JSON.parse(t)}catch(t){e(this,x).error("Error loading attribution data from localStorage:",t)}return{}},ha=new WeakSet,Th=function(){let t=s(this,_r,Lc).call(this);return t.first_visit_timestamp?t.first_visit_timestamp:Date.now()},ua=new WeakSet,Ah=function(){window.addEventListener("popstate",()=>{let t=e(this,C).metadata||{};t.landing_page=window.location.href,this.updateAttributionData({metadata:t})}),e(this,$).events&&(e(this,$).events.on("campaign.loaded",t=>{if(t&&t.campaign){let i=e(this,$).campaign?.getCampaignName()||t.campaign.name||"";if(!i){e(this,x).warn("Campaign loaded but name is not available");return}e(this,x).info(`Campaign loaded: ${i}`);let r=document.querySelector('meta[name="os-tracking-tag"][data-tag-name="funnel_name"]'),n=r?r.getAttribute("data-tag-value"):"",a=n||i;this.updateAttributionData({funnel:a}),s(this,ma,$h).call(this),e(this,x).debug(`Updated funnel to: ${a} (from ${n?"meta tag":"campaign name"})`)}}),e(this,$).events.on("prospect.cartCreated",()=>{let t=e(this,C).metadata||{};t.conversion_timestamp=Date.now(),this.updateAttributionData({metadata:t}),e(this,x).debug("Cart created, updated metadata with conversion timestamp")}))},ma=new WeakSet,$h=function(){e(this,x).info("Reinitializing attribution data with campaign information");let t=e(this,$).campaign?.getCampaignName()||e(this,$).campaignData?.name||"";if(!t){e(this,x).warn("Cannot reinitialize attribution data: Campaign name not available");return}let i=document.querySelector('meta[name="os-tracking-tag"][data-tag-name="funnel_name"]'),r=i?i.getAttribute("data-tag-value"):"",n=r||t;e(this,x).debug(`Using funnel value: ${n} (from ${r?"meta tag":"campaign name"})`),e(this,C).funnel=n,s(this,vi,sa).call(this),e(this,x).info(`Attribution data reinitialized with funnel: ${n}`),e(this,$).events&&e(this,$).events.trigger("attribution.updated",{attribution:e(this,C)})},D=new WeakSet,j=function(t){let i=new URLSearchParams(window.location.search);if(i.has(t)){let n=i.get(t);try{sessionStorage.setItem(t,n)}catch(a){e(this,x).error(`Error storing ${t} in sessionStorage:`,a)}return n}try{if(sessionStorage.getItem(t))return sessionStorage.getItem(t)}catch(n){e(this,x).error(`Error reading ${t} from sessionStorage:`,n)}try{if(localStorage.getItem(t))return localStorage.getItem(t)}catch(n){e(this,x).error(`Error reading ${t} from localStorage:`,n)}let r=s(this,_r,Lc).call(this);return r[t]?r[t]:""},Cr=new WeakSet,Pc=function(t){let r=`; ${document.cookie}`.split(`; ${t}=`);return r.length===2?r.pop().split(";").shift():""},ga=new WeakSet,Ih=function(){let t=navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)?"mobile":"desktop"},pa=new WeakSet,Lh=function(){let t=document.querySelector('meta[name="facebook-domain-verification"]');if(t){let r=t.getAttribute("content");if(r&&r.includes("=")){let n=r.split("=");if(n.length>1)return n[1]}}let i=document.querySelectorAll("script");for(let r of i){let n=r.textContent||"";if(n.includes("fbq(")&&n.includes("init")){let a=n.match(/fbq\s*\(\s*['"]init['"],\s*['"](\d+)['"]/);if(a&&a[1])return a[1]}}return""};var Pt,f,ya,J,ba,$e,va,Ph,Sa,qh,wa,Mh,_a,Fh,Ca,Nh,Ea,Uh,ue,Si,fa=class{constructor(t){o(this,va);o(this,Sa);o(this,wa);o(this,_a);o(this,Ca);o(this,Ea);o(this,ue);o(this,Pt,void 0);o(this,f,void 0);o(this,ya,!1);o(this,J,{gtm:{enabled:!1,initialized:!1},fbPixel:{enabled:!1,initialized:!1},ga4:{enabled:!1,initialized:!1}});o(this,ba,!1);o(this,$e,new Set);l(this,Pt,t),l(this,f,t.logger.createModuleLogger("EVENT")),l(this,ba,t.options?.debug||!1),this.init()}init(){e(this,f).info("Initializing EventManager"),s(this,wa,Mh).call(this),s(this,_a,Fh).call(this),s(this,va,Ph).call(this),l(this,ya,!0),e(this,f).info("EventManager initialized")}viewItemList(t){if(e(this,f).debug("viewItemList called with campaign data:",t?"present":"missing"),!t||!t.packages||t.packages.length===0){e(this,f).warn("Cannot fire view_item_list event: No packages found in campaign data");return}e(this,f).debug(`Found ${t.packages.length} packages in campaign data`);let i=t.packages.map(n=>({item_id:n.external_id||n.ref_id,item_name:n.name,price:parseFloat(n.price)||0,currency:t.currency||"USD",quantity:1})),r={event:"view_item_list",ecommerce:{currency:t.currency||"USD",items:i}};e(this,f).debug("Firing view_item_list event with data:",r),s(this,ue,Si).call(this,"view_item_list",r)}addToCart(t){let i=!t.items&&!t.totals,r=[],n="USD",a=0;if(i){if(e(this,f).debug("addToCart called with single package, converting to cart format"),!t){e(this,f).warn("Cannot fire add_to_cart event: No package data provided");return}let d=t,h={item_id:d.external_id||d.ref_id||d.id,item_name:d.name,price:parseFloat(d.price)||0,currency:d.currency||e(this,Pt).getCampaignData()?.currency||"USD",quantity:d.quantity||1};r=[h],n=h.currency,a=h.price*h.quantity}else{if(!t||!t.items||t.items.length===0){e(this,f).warn("Cannot fire add_to_cart event: No items in cart");return}r=t.items.map(d=>({item_id:d.external_id||d.id,item_name:d.name,price:parseFloat(d.price)||0,currency:t.totals?.currency||"USD",quantity:d.quantity||1})),n=t.totals?.currency||"USD",a=t.totals?.total||0}let c={event:"add_to_cart",ecommerce:{currency:n,value:a,items:r}};s(this,ue,Si).call(this,"add_to_cart",c)}purchase(t,i=!1){if(!t||!t.lines||t.lines.length===0){e(this,f).warn("Cannot fire purchase event: No items in order");return}let r=t.number||t.ref_id;if(!i&&r&&e(this,$e).has(r)){e(this,f).info(`Purchase event for order ${r} already fired, skipping`);return}let n=t.lines.map(d=>({item_id:d.product_id||d.id,item_name:d.product_title||d.name,price:parseFloat(d.price_incl_tax||d.price)||0,currency:t.currency||"USD",quantity:d.quantity||1})),a=s(this,Ca,Nh).call(this,t),c={event:"purchase",ecommerce:{transaction_id:r,value:parseFloat(t.total_incl_tax||t.total)||0,tax:parseFloat(t.total_tax)||0,shipping:parseFloat(t.shipping_incl_tax||t.shipping)||0,currency:t.currency||"USD",coupon:t.vouchers?.length>0?t.vouchers[0].code:"",...a,items:n}};s(this,ue,Si).call(this,"purchase",c),r&&(e(this,$e).add(r),s(this,Sa,qh).call(this),e(this,f).debug(`Marked order ${r} as processed`))}viewItem(t){if(!t){e(this,f).warn("Cannot fire view_item event: No package data provided");return}let i={item_id:t.ref_id||t.external_id||t.id,item_name:t.name,price:parseFloat(t.price)||0,currency:t.currency||e(this,Pt).getCampaignData()?.currency||"USD",quantity:1},r={event:"view_item",ecommerce:{currency:i.currency,value:i.price,items:[i]}};s(this,ue,Si).call(this,"view_item",r)}beginCheckout(){let t=e(this,Pt).state.getState("cart");if(!t||!t.items||t.items.length===0){e(this,f).warn("Cannot fire begin_checkout event: No items in cart");return}let i=t.items.map(n=>({item_id:n.external_id||n.id,item_name:n.name,price:parseFloat(n.price)||0,currency:t.totals?.currency||"USD",quantity:n.quantity||1})),r={event:"begin_checkout",ecommerce:{currency:t.totals?.currency||"USD",value:t.totals?.total||0,items:i}};s(this,ue,Si).call(this,"begin_checkout",r)}fireCustomEvent(t,i={}){if(!t){e(this,f).warn("Cannot fire custom event: No event name provided");return}let r={event:t,...i};e(this,f).debug(`Firing custom event: ${t}`,r),e(this,J).gtm.enabled&&(window.dataLayer=window.dataLayer||[],window.dataLayer.push(r),e(this,f).debug(`Custom event ${t} fired to Google Tag Manager`)),e(this,J).fbPixel.enabled&&typeof window.fbq=="function"&&(window.fbq("trackCustom",t,i),e(this,f).debug(`Custom event ${t} fired to Facebook Pixel`)),e(this,J).ga4.enabled&&typeof window.gtag=="function"&&(window.gtag("event",t,i),e(this,f).debug(`Custom event ${t} fired to Google Analytics 4`));let n=new CustomEvent(`os:${t}`,{bubbles:!0,detail:r});document.dispatchEvent(n)}setPlatformEnabled(t,i){e(this,J)[t]?(e(this,J)[t].enabled=i,e(this,f).info(`${t} ${i?"enabled":"disabled"}`)):e(this,f).warn(`Unknown platform: ${t}`)}getPlatformStatus(){return{...e(this,J)}}};Pt=new WeakMap,f=new WeakMap,ya=new WeakMap,J=new WeakMap,ba=new WeakMap,$e=new WeakMap,va=new WeakSet,Ph=function(){try{let t=sessionStorage.getItem("os_processed_order_ids");if(t){let i=JSON.parse(t);Array.isArray(i)&&(i.forEach(r=>e(this,$e).add(r)),e(this,f).debug(`Loaded ${i.length} processed order IDs from sessionStorage`))}}catch(t){e(this,f).error("Error loading processed order IDs from sessionStorage:",t)}},Sa=new WeakSet,qh=function(){try{let t=Array.from(e(this,$e));sessionStorage.setItem("os_processed_order_ids",JSON.stringify(t)),e(this,f).debug(`Saved ${t.length} processed order IDs to sessionStorage`)}catch(t){e(this,f).error("Error saving processed order IDs to sessionStorage:",t)}},wa=new WeakSet,Mh=function(){typeof window.dataLayer<"u"?(e(this,J).gtm.enabled=!0,e(this,J).gtm.initialized=!0,e(this,f).info("Google Tag Manager detected")):e(this,f).info("Google Tag Manager not detected"),typeof window.fbq<"u"?(e(this,J).fbPixel.enabled=!0,e(this,J).fbPixel.initialized=!0,e(this,f).info("Facebook Pixel detected")):e(this,f).info("Facebook Pixel not detected"),typeof window.gtag<"u"?(e(this,J).ga4.enabled=!0,e(this,J).ga4.initialized=!0,e(this,f).info("Google Analytics 4 detected")):e(this,f).info("Google Analytics 4 not detected")},_a=new WeakSet,Fh=function(){e(this,Pt).on("campaign.loaded",t=>{e(this,f).debug("Campaign loaded event received, firing view_item_list"),t&&t.campaign?this.viewItemList(t.campaign):e(this,f).warn("Campaign loaded event received but no campaign data found")}),e(this,Pt).on("cart.updated",t=>{t.cart&&t.cart.items&&t.cart.items.length>0&&this.addToCart(t.cart)}),e(this,Pt).on("order.created",t=>{this.purchase(t)}),e(this,Pt).on("order.loaded",t=>{t.order&&(e(this,f).info("Order loaded on receipt page, checking if purchase event needed"),this.purchase(t.order))})},Ca=new WeakSet,Nh=function(t){let i={};return t.user&&(t.user.first_name&&(i.firstname=t.user.first_name),t.user.last_name&&(i.lastname=t.user.last_name),t.user.email&&(i.email_hash=s(this,Ea,Uh).call(this,t.user.email))),t.shipping_address&&(i.city=t.shipping_address.line4||"",i.state=t.shipping_address.state||"",i.zipcode=t.shipping_address.postcode||"",i.country=t.shipping_address.country||""),i},Ea=new WeakSet,Uh=function(t){let i=0;if(t.length===0)return i.toString();for(let r=0;r<t.length;r++){let n=t.charCodeAt(r);i=(i<<5)-i+n,i=i&i}return i.toString()},ue=new WeakSet,Si=function(t,i){if(e(this,f).debug(`Firing ${t} event`,i),e(this,J).gtm.enabled?(window.dataLayer=window.dataLayer||[],e(this,f).debug("Clearing previous ecommerce data in dataLayer"),window.dataLayer.push({ecommerce:null}),`${t}`,window.dataLayer.push(i),e(this,f).debug(`${t} event fired to Google Tag Manager`)):(e(this,f).warn(`Cannot fire ${t} event to GTM: GTM not enabled`),window.dataLayer=window.dataLayer||[],window.dataLayer.push({ecommerce:null}),window.dataLayer.push(i)),e(this,J).fbPixel.enabled){switch(t){case"view_item_list":window.fbq("track","ViewContent",{content_type:"product_group",content_ids:i.ecommerce.items.map(n=>n.item_id),currency:i.ecommerce.currency});break;case"add_to_cart":window.fbq("track","AddToCart",{content_type:"product_group",content_ids:i.ecommerce.items.map(n=>n.item_id),currency:i.ecommerce.currency,value:i.ecommerce.value});break;case"purchase":window.fbq("track","Purchase",{content_type:"product_group",content_ids:i.ecommerce.items.map(n=>n.item_id),currency:i.ecommerce.currency,value:i.ecommerce.value});break}e(this,f).debug(`${t} event fired to Facebook Pixel`)}e(this,J).ga4.enabled&&(window.gtag("event",t,{currency:i.ecommerce.currency,value:i.ecommerce.value,items:i.ecommerce.items}),e(this,f).debug(`${t} event fired to Google Analytics 4`));let r=new CustomEvent(`os:${t}`,{bubbles:!0,detail:i});document.dispatchEvent(r)};var qc=class{constructor(){this.cleanupInitialState(),this.init()}cleanupInitialState(){document.querySelectorAll('[pb-component="accordion"]').forEach(t=>{let i=t.querySelector('[pb-accordion-element="group"]');if(!i)return;let r=i.querySelectorAll('[pb-accordion-element="accordion"]');r.forEach(a=>{let c=a.querySelector('[pb-accordion-element="content"]'),d=a.querySelector('[pb-accordion-element="trigger"]'),h=a.querySelector('[pb-accordion-element="arrow"]'),p=a.querySelector('[pb-accordion-element="plus"]');c&&(c.style.maxHeight="0",c.style.opacity="0",c.style.visibility="hidden",c.style.display="none"),d&&d.setAttribute("aria-expanded","false"),a.classList.remove("is-active-accordion"),c?.classList.remove("is-active-accordion"),h&&h.classList.remove("is-active-accordion"),p&&p.classList.remove("is-active-accordion")});let n=i.getAttribute("pb-accordion-initial");if(n&&n!=="none"){let a=r[parseInt(n)-1];a&&this.openAccordion(a)}})}init(){document.querySelectorAll('[pb-component="accordion"]').forEach(t=>{let i=t.querySelector('[pb-accordion-element="group"]');i&&i.addEventListener("click",r=>this.handleClick(r,i))})}handleClick(t,i){let r=t.target.closest('[pb-accordion-element="accordion"]');if(!r)return;let n=r.classList.contains("is-active-accordion");i.getAttribute("pb-accordion-single")==="true"&&i.querySelectorAll('[pb-accordion-element="accordion"]').forEach(c=>{c!==r&&c.classList.contains("is-active-accordion")&&this.closeAccordion(c)}),n?this.closeAccordion(r):this.openAccordion(r)}openAccordion(t){let i=t.querySelector('[pb-accordion-element="trigger"]'),r=t.querySelector('[pb-accordion-element="content"]'),n=t.querySelector('[pb-accordion-element="arrow"]'),a=t.querySelector('[pb-accordion-element="plus"]');r.style.visibility="visible",r.style.display="block",r.offsetHeight;let c=r.scrollHeight;requestAnimationFrame(()=>{r.style.maxHeight=`${c}px`,r.style.opacity="1",i.setAttribute("aria-expanded","true"),t.classList.add("is-active-accordion"),r.classList.add("is-active-accordion"),n&&n.classList.add("is-active-accordion"),a&&a.classList.add("is-active-accordion")}),r.addEventListener("transitionend",()=>{t.classList.contains("is-active-accordion")&&(r.style.maxHeight="none")},{once:!0})}closeAccordion(t){let i=t.querySelector('[pb-accordion-element="trigger"]'),r=t.querySelector('[pb-accordion-element="content"]'),n=t.querySelector('[pb-accordion-element="arrow"]'),a=t.querySelector('[pb-accordion-element="plus"]');r.style.maxHeight=`${r.scrollHeight}px`,r.style.display="block",r.offsetHeight,requestAnimationFrame(()=>{r.style.maxHeight="0",r.style.opacity="0",i.setAttribute("aria-expanded","false"),t.classList.remove("is-active-accordion"),r.classList.remove("is-active-accordion"),n&&n.classList.remove("is-active-accordion"),a&&a.classList.remove("is-active-accordion")}),r.addEventListener("transitionend",()=>{t.classList.contains("is-active-accordion")||(r.style.visibility="hidden",r.style.display="none")},{once:!0})}},zh=()=>document.querySelector('[pb-component="accordion"]')?new qc:null;var Mc=class{constructor(){this.config={enabled:!0,applyToExternalLinks:!1,excludedDomains:[],paramsToCopy:[]},this.loadConfig()}loadConfig(){window.osConfig&&window.osConfig.utmTransfer&&(this.config={...this.config,...window.osConfig.utmTransfer}),(this.config.paramsToCopy===null||this.config.paramsToCopy===void 0)&&(this.config.paramsToCopy=[]),JSON.stringify(this.config)}init(){if(!this.config.enabled)return;let t=new URLSearchParams(window.location.search);if(t.toString()==="")return;let i=[];t.forEach((a,c)=>{i.push(`${c}=${a}`)}),`${i.join(", ")}`;let r=t;if(Array.isArray(this.config.paramsToCopy)&&this.config.paramsToCopy.length>0&&(`${this.config.paramsToCopy.join(", ")}`,r=new URLSearchParams,this.config.paramsToCopy.forEach(a=>{t.has(a)&&(r.append(a,t.get(a)),`${a}${t.get(a)}`)}),r.toString()===""))return;let n=document.querySelectorAll("a");`${n.length}`,n.forEach(a=>{a.addEventListener("click",c=>{this.applyParamsToLink(a,r)})})}applyParamsToLink(t,i=null){if(!t||!t.getAttribute){console.error("UTM Transfer: Invalid link element provided");return}let r=t.getAttribute("href");if(!r||r.startsWith("#")||r.startsWith("javascript:")||r.startsWith("mailto:")||r.startsWith("tel:"))return;if(r.includes("://")&&!r.includes(window.location.hostname)){if(!this.config.applyToExternalLinks)return;if(this.config.excludedDomains&&this.config.excludedDomains.length>0){for(let h of this.config.excludedDomains)if(r.includes(h))return}}let a=i||new URLSearchParams(window.location.search);if(a.toString()==="")return;let c;try{c=new URL(r,window.location.origin)}catch{console.error("UTM Transfer: Invalid URL:",r);return}let d=new URLSearchParams(c.search);a.forEach((h,p)=>{d.has(p)||d.append(p,h)}),c.search=d.toString(),t.setAttribute("href",c.toString()),this.config.debug&&`${r}${c.toString()}`}},Oh=()=>{let m=new Mc;return m.init(),m};var Ci,Pe,W,Pa,Vh,qa,Gh,Ma,Kh,Fa,Jh,Na,Yh,Ua,Xh,za,Zh,Oa,Qh,Da,tu,Ra,eu,Pr=class{constructor(t={}){o(this,Pa);o(this,qa);o(this,Ma);o(this,Fa);o(this,Na);o(this,Ua);o(this,za);o(this,Oa);o(this,Da);o(this,Ra);o(this,Ci,!1);o(this,Pe,!1);o(this,W,null);this.options={debug:!1,autoInit:!0,googleMapsApiKey:"YOUR_API_KEY_HERE",...t},this.logger=new Fr(this.options.debug),this.coreLogger=this.logger.createModuleLogger("CORE"),this.api=new qr(this),this.config=s(this,Pa,Vh).call(this),this.state=new oo(this),this.attribution=new na(this),this.cart=new uo(this),this.campaign=new no(this),this.events={on:(i,r)=>this.on(i,r),once:(i,r)=>this.once(i,r),off:(i,r)=>this.off(i,r),trigger:(i,r)=>this.triggerEvent(i,r)},this.options.autoInit&&this.init()}on(t,i){let r=n=>{try{i(n.detail)}catch(a){this.coreLogger.error(`Error in event callback for "${t}":`,a)}};return document.addEventListener(`os:${t}`,r),this.coreLogger.debug(`Event listener registered for "${t}"`),this}once(t,i){let r=n=>{try{i(n.detail)}catch(a){this.coreLogger.error(`Error in one-time event callback for "${t}":`,a)}document.removeEventListener(`os:${t}`,r)};return document.addEventListener(`os:${t}`,r),this.coreLogger.debug(`One-time event listener registered for "${t}"`),this}off(t,i){return document.removeEventListener(`os:${t}`,i),this}async init(){this.coreLogger.info("Initializing 29next client"),this.api.init(),typeof window.on29NextReady<"u"&&!Array.isArray(window.on29NextReady)&&(this.coreLogger.warn("window.on29NextReady is not an array, resetting it"),window.on29NextReady=[]),await s(this,Ma,Kh).call(this),await s(this,qa,Gh).call(this),l(this,Pe,s(this,za,Zh).call(this)),e(this,Pe)&&s(this,Oa,Qh).call(this),s(this,Fa,Jh).call(this),s(this,Ra,eu).call(this),l(this,Ci,!0),this.triggerEvent("initialized",{client:this}),await s(this,Na,Yh).call(this)}triggerEvent(t,i={}){this.coreLogger.debug(`Triggering event: ${t}`);let r={...i,timestamp:Date.now(),client:this},n=new CustomEvent(`os:${t}`,{bubbles:!0,cancelable:!0,detail:r});return document.dispatchEvent(n),n}getCampaignData(){return e(this,W)}get isInitialized(){return e(this,Ci)}get isCheckoutPage(){return e(this,Pe)}debugTriggerViewItemList(){return e(this,W)?this.events.viewItemList?(window.dataLayer=window.dataLayer||[],window.dataLayer.push({ecommerce:null}),this.events.viewItemList(e(this,W)),{success:!0,message:"view_item_list event triggered",campaignData:e(this,W)}):(console.error("âŒ events.viewItemList not available"),{success:!1,message:"Event manager not initialized"}):(console.error("âŒ No campaign data available"),{success:!1,message:"No campaign data"})}isReady(){return e(this,Ci)&&e(this,W)!==null&&Array.isArray(e(this,W).packages)}onReady(t){if(!t||typeof t!="function")return this;if(this.isReady())try{t(this)}catch(i){this.coreLogger.error("Error in onReady callback:",i)}else this.once("initialized",()=>{this.isReady()&&t(this)});return this}};Ci=new WeakMap,Pe=new WeakMap,W=new WeakMap,Pa=new WeakSet,Vh=function(){let t={apiKey:null,campaignId:null,debug:this.options.debug},i=document.querySelector('meta[name="os-api-key"]');t.apiKey=i?.getAttribute("content")??null,this.coreLogger.info(`API key: ${t.apiKey?"âœ“ Set":"âœ— Not set"}`);let r=document.querySelector('meta[name="os-campaign-id"]');return t.campaignId=r?.getAttribute("content")??null,this.coreLogger.info(`Campaign ID: ${t.campaignId?"âœ“ Set":"âœ— Not set"}`),document.querySelector('meta[name="os-debug"]')?.getAttribute("content")==="true"&&(t.debug=!0,this.logger.setDebug(!0),this.coreLogger.info("Debug mode: âœ“ Enabled")),t},qa=new WeakSet,Gh=async function(){if(typeof google<"u"&&typeof google.maps<"u"){this.coreLogger.debug("Google Maps API already loaded");return}return this.coreLogger.debug("Loading Google Maps API..."),new Promise(t=>{let i=document.createElement("script");i.src=`https://maps.googleapis.com/maps/api/js?key=${this.options.googleMapsApiKey}&libraries=places`,i.async=!0,i.defer=!0,i.onload=()=>{this.coreLogger.debug("Google Maps API loaded successfully"),t()},i.onerror=()=>{this.coreLogger.error("Failed to load Google Maps API"),t()},document.head.appendChild(i)})},Ma=new WeakSet,Kh=async function(){try{this.coreLogger.info("Fetching campaign data..."),l(this,W,await this.api.getCampaign()),l(this,W,e(this,W)||{packages:[]}),e(this,W).packages=e(this,W).packages||[],this.campaignData=e(this,W),this.coreLogger.info("Campaign data retrieved successfully"),window.osConfig=window.osConfig||{},window.osConfig.campaign=e(this,W),window.dataLayer=window.dataLayer||[],this.triggerEvent("campaign.loaded",{campaign:e(this,W)})}catch(t){this.coreLogger.error("Failed to retrieve campaign data:",t),l(this,W,{name:"Default Campaign",packages:[],currency:"USD",locale:"en-US"}),this.campaignData=e(this,W)}},Fa=new WeakSet,Jh=function(){this.selector=new fo(this),this.toggle=new Co(this),this.timer=new zo(this),this.display=new Bo(this),this.eventManager=new fa(this),(e(this,Pe)||document.querySelector('[data-os-cart="line-display"]')||document.querySelector('[os-cart="checkout-summary"]')||document.querySelector('[data-os-cart-summary="grand-total"]'))&&(this.coreLogger.info("Cart display elements detected, initializing CartDisplayManager"),this.cartDisplay=new Go(this)),this.debug=new Mo(this),Object.assign(this.events,{emit:(t,i)=>this.triggerEvent(t,i),viewItemList:t=>this.eventManager.viewItemList(t||e(this,W)),viewItem:t=>this.eventManager.viewItem(t),addToCart:t=>this.eventManager.addToCart(t),beginCheckout:()=>this.eventManager.beginCheckout(),purchase:(t,i)=>this.eventManager.purchase(t,i),fireCustomEvent:(t,i)=>this.eventManager.fireCustomEvent(t,i)})},Na=new WeakSet,Yh=async function(){this.events.viewItemList(e(this,W)),await new Promise(t=>setTimeout(t,800)),s(this,Ua,Xh).call(this)},Ua=new WeakSet,Xh=function(){let t=document.querySelector('div[os-element="preloader"]');t&&(this.coreLogger.info("Hiding preloader element"),t.style.transition="opacity 0.5s ease",t.style.opacity="0",t.style.pointerEvents="none",this.coreLogger.debug("Preloader hidden"))},za=new WeakSet,Zh=function(){let i=document.querySelector('meta[name="os-page-type"]')?.getAttribute("content");return i==="checkout"||!i&&document.querySelector('form[os-checkout="form"]')?(this.coreLogger.info("Checkout page detected"),!0):(i==="receipt"&&(this.coreLogger.info("Receipt page detected"),s(this,Da,tu).call(this)),!1)},Oa=new WeakSet,Qh=function(){this.checkout=new Wn(this.api,this.coreLogger,this)},Da=new WeakSet,tu=function(){Promise.resolve().then(()=>(jh(),Bh)).then(t=>{let i=t.ReceiptPage;this.receipt=new i(this.api,this.coreLogger,this),this.coreLogger.info("Receipt page initialized");let r=new URLSearchParams(window.location.search).get("ref_id");r&&this.api.getOrder(r).then(n=>{n&&this.triggerEvent("order.loaded",{order:n})}).catch(n=>this.coreLogger.error("Failed to load order data:",n))}).catch(t=>this.coreLogger.error("Failed to load ReceiptPage module:",t))},Ra=new WeakSet,eu=function(){this.coreLogger.info("Initializing UI utilities");try{let t=zh();t&&(this.pbAccordion=t,this.coreLogger.info("PBAccordion initialized"))}catch(t){this.coreLogger.error("Failed to initialize PBAccordion:",t)}try{let t=Oh();t&&(this.utmTransfer=t,this.coreLogger.info("UTM parameter transfer initialized"))}catch(t){this.coreLogger.error("Failed to initialize UTM transfer:",t)}};var iu=()=>{try{if(document.querySelector('meta[name="os-disable-auto-init"]'))return;let m={apiKey:document.querySelector('meta[name="os-api-key"]')?.getAttribute("content")??null,campaignId:document.querySelector('meta[name="os-campaign-id"]')?.getAttribute("content")??null,debug:document.querySelector('meta[name="os-debug"]')?.getAttribute("content")==="true",paypalClientId:document.querySelector('meta[name="os-paypal-client-id"]')?.getAttribute("content")??null};JSON.stringify({apiKey:m.apiKey?"âœ“ Set":"âœ— Not set",campaignId:m.campaignId?"âœ“ Set":"âœ— Not set",debug:m.debug}),window.on29NextReady=Array.isArray(window.on29NextReady)?window.on29NextReady:[];let t=[...window.on29NextReady];window.twentyNineNext=new Pr(m),t.forEach(i=>{window.twentyNineNext.onReady(i)}),window.on29NextReady={push:i=>window.twentyNineNext.onReady(i)}}catch(m){console.error("29next Client: Error during initialization",m)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",iu):iu();return cu(hu);})();
