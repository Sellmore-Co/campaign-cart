"use strict";var TwentyNineNext=(()=>{var id=Object.defineProperty;var Lp=Object.getOwnPropertyDescriptor;var Ip=Object.getOwnPropertyNames;var qp=Object.prototype.hasOwnProperty;var Fp=(c,e)=>()=>(c&&(e=c(c=0)),e);var fu=(c,e)=>{for(var i in e)id(c,i,{get:e[i],enumerable:!0})},Mp=(c,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Ip(e))!qp.call(c,s)&&s!==i&&id(c,s,{get:()=>e[s],enumerable:!(r=Lp(e,s))||r.enumerable});return c};var Np=c=>Mp(id({},"__esModule",{value:!0}),c);var rd=(c,e,i)=>{if(!e.has(c))throw TypeError("Cannot "+i)};var t=(c,e,i)=>(rd(c,e,"read from private field"),i?i.call(c):e.get(c)),o=(c,e,i)=>{if(e.has(c))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(c):e.set(c,i)},u=(c,e,i,r)=>(rd(c,e,"write to private field"),r?r.call(c,i):e.set(c,i),i);var yu=(c,e,i,r)=>({set _(s){u(c,e,s,i)},get _(){return t(c,e,r)}}),n=(c,e,i)=>(rd(c,e,"access private method"),i);var mp={};fu(mp,{ReceiptPage:()=>du});var Fr,Ti,Oc,T,nn,on,Uc,H,Y,Rc,dp,zc,up,Dc,hp,Bc,gp,oe,ue,$i,sn,an,uu,ln,hu,cn,gu,dn,mu,ii,qr,un,pu,du,pp=Fp(()=>{"use strict";du=class{constructor(e,i,r){o(this,H);o(this,Rc);o(this,zc);o(this,Dc);o(this,Bc);o(this,oe);o(this,$i);o(this,an);o(this,ln);o(this,cn);o(this,dn);o(this,ii);o(this,un);o(this,Fr,void 0);o(this,Ti,void 0);o(this,Oc,void 0);o(this,T,null);o(this,nn,!1);o(this,on,!1);o(this,Uc,!1);u(this,Fr,e),u(this,Ti,i),u(this,Oc,r);let s=document.querySelector('meta[name="os-debug"]');u(this,Uc,s?.getAttribute("content")==="true"),n(this,H,Y).call(this,"info","ReceiptPage component created"),this.init()}async init(){if(t(this,on)){n(this,H,Y).call(this,"info","Receipt page already initialized, skipping");return}n(this,H,Y).call(this,"info","Initializing Receipt Page"),u(this,on,!0);let i=new URLSearchParams(window.location.search).get("ref_id");if(!i){n(this,H,Y).call(this,"error","No ref_id found in URL parameters"),n(this,un,pu).call(this,"Order reference not found. Please check your URL.");return}n(this,H,Y).call(this,"info",`Found ref_id in URL: ${i}`);try{await n(this,Rc,dp).call(this,i),n(this,zc,up).call(this)}catch(r){n(this,H,Y).call(this,"error","Error initializing receipt page:",r),n(this,un,pu).call(this,"Failed to load order details. Please try again later.")}}};Fr=new WeakMap,Ti=new WeakMap,Oc=new WeakMap,T=new WeakMap,nn=new WeakMap,on=new WeakMap,Uc=new WeakMap,H=new WeakSet,Y=function(e,i,...r){try{t(this,Ti)&&typeof t(this,Ti)[e]=="function"?t(this,Ti)[e](i,...r):console[e]?console[e](i,...r):(`${e.toUpperCase()}${i}`,[...r])}catch(s){console.error("Error logging message:",s)}},Rc=new WeakSet,dp=async function(e){if(n(this,H,Y).call(this,"info",`Fetching order details for ref_id: ${e}`),t(this,nn)&&t(this,T))return n(this,H,Y).call(this,"info","Order already fetched, using cached data"),t(this,T);try{if(!t(this,Fr))throw new Error("API client not available");return n(this,H,Y).call(this,"debug","Making API request to fetch order details"),u(this,T,await t(this,Fr).getOrder(e)),u(this,nn,!0),n(this,H,Y).call(this,"info","Order details fetched successfully"),n(this,H,Y).call(this,"debug","Order data:",t(this,T)),t(this,T)}catch(i){throw n(this,H,Y).call(this,"error",`Error fetching order details for ref_id ${e}:`,i),i}},zc=new WeakSet,up=function(){if(!t(this,T)){n(this,H,Y).call(this,"error","No order data available to update receipt content");return}n(this,H,Y).call(this,"info","Updating receipt content with order details"),n(this,oe,ue).call(this,"fname",t(this,T).user?.first_name||""),t(this,T).billing_address&&(n(this,oe,ue).call(this,"billing_fname",`${t(this,T).billing_address.first_name} ${t(this,T).billing_address.last_name}`),n(this,oe,ue).call(this,"billing_address",n(this,an,uu).call(this,t(this,T).billing_address)),n(this,oe,ue).call(this,"billing_location",n(this,ln,hu).call(this,t(this,T).billing_address)),n(this,oe,ue).call(this,"billing_country",n(this,cn,gu).call(this,t(this,T).billing_address.country)||"")),t(this,T).shipping_address&&(n(this,oe,ue).call(this,"shipping_fname",`${t(this,T).shipping_address.first_name} ${t(this,T).shipping_address.last_name}`),n(this,oe,ue).call(this,"shipping_address",n(this,an,uu).call(this,t(this,T).shipping_address)),n(this,oe,ue).call(this,"shipping_location",n(this,ln,hu).call(this,t(this,T).shipping_address)),n(this,oe,ue).call(this,"shipping_country",n(this,cn,gu).call(this,t(this,T).shipping_address.country)||""));let e=n(this,Dc,hp).call(this);n(this,oe,ue).call(this,"payment_method",e),n(this,Bc,gp).call(this);let i=t(this,T).shipping_method||"Standard Shipping";if(n(this,oe,ue).call(this,"shipping-method",i),n(this,oe,ue).call(this,"shipping_method",i),t(this,T).shipping_excl_tax!==void 0){let a=n(this,ii,qr).call(this,parseFloat(t(this,T).shipping_excl_tax));n(this,oe,ue).call(this,"shipping-price",a);let l=document.querySelector('[data-os-receipt="shipping-container"]');l&&(l.style.display="flex")}let r=document.querySelector('[data-os-receipt="tax-container"]');if(r){let a=parseFloat(t(this,T).total_tax||0);a>0?(r.style.display="flex",n(this,oe,ue).call(this,"taxes",n(this,ii,qr).call(this,a))):r.style.display="none"}let s=n(this,ii,qr).call(this,parseFloat(t(this,T).total_incl_tax)||0);n(this,oe,ue).call(this,"total",s),n(this,oe,ue).call(this,"order_number",t(this,T).number||""),n(this,oe,ue).call(this,"order_reference",t(this,T).ref_id||""),n(this,H,Y).call(this,"info","Receipt content updated successfully")},Dc=new WeakSet,hp=function(){return t(this,T).payment_detail&&t(this,T).payment_detail.payment_method?n(this,dn,mu).call(this,t(this,T).payment_detail.payment_method):t(this,T).payment_method?n(this,dn,mu).call(this,t(this,T).payment_method):"Credit Card"},Bc=new WeakSet,gp=function(){if(!t(this,T).lines||!Array.isArray(t(this,T).lines)){n(this,H,Y).call(this,"warn","No order lines available");return}let e=document.querySelector('[data-os-receipt="order-lines"]');if(!e){n(this,H,Y).call(this,"warn","Order lines container not found in DOM");return}e.innerHTML="";let i=document.querySelector('[data-os-receipt="product-line"]'),r=i?i.outerHTML:`
      <div data-os-receipt="product-line" class="cart-summary__line">
        <div class="cart-summary__line-item">
          <div data-os-receipt="line-title" class="cart-line__title"></div>
          <div data-os-receipt="line-saving" class="cart-line__discount"></div>
        </div>
        <div class="cart-summary__line-item">
          <p data-os-receipt="line-compare" class="pb-cart__line-price pb--compare"></p>
          <p data-os-receipt="line-subtotal" class="pb-cart__line-price"></p>
        </div>
      </div>
    `;t(this,T).lines.forEach(s=>{let a=document.createElement("div");a.innerHTML=r;let l=a.firstElementChild,d=s.product_title||s.title||s.package_title||"Product";if(n(this,$i,sn).call(this,l,"line-title",d),s.price_excl_tax_excl_discounts&&parseFloat(s.price_excl_tax_excl_discounts)>parseFloat(s.price_excl_tax)){let g=parseFloat(s.price_excl_tax_excl_discounts),m=parseFloat(s.price_excl_tax),p=Math.round((1-m/g)*100);n(this,$i,sn).call(this,l,"line-saving",`(${p}% OFF)`),n(this,$i,sn).call(this,l,"line-compare",n(this,ii,qr).call(this,g))}else{let g=l.querySelector('[data-os-receipt="line-saving"]'),m=l.querySelector('[data-os-receipt="line-compare"]');g&&(g.style.display="none"),m&&(m.style.display="none")}let h=parseFloat(s.price_excl_tax)||0;n(this,$i,sn).call(this,l,"line-subtotal",n(this,ii,qr).call(this,h)),e.appendChild(l)})},oe=new WeakSet,ue=function(e,i){let r=document.querySelectorAll(`[data-os-receipt="${e}"]`);if(r.length===0){n(this,H,Y).call(this,"debug",`No elements found with data-os-receipt="${e}"`);return}r.forEach(s=>{s.textContent=i})},$i=new WeakSet,sn=function(e,i,r){let s=e.querySelector(`[data-os-receipt="${i}"]`);if(!s){n(this,H,Y).call(this,"debug",`No element found with data-os-receipt="${i}" in node`);return}s.textContent=r},an=new WeakSet,uu=function(e){let i="";return e.line1&&(i+=e.line1),e.line2&&(i+=i?`, ${e.line2}`:e.line2),i},ln=new WeakSet,hu=function(e){let i=[];return e.line4&&i.push(e.line4),e.state&&i.push(e.state),e.postcode&&i.push(e.postcode),i.join(", ")},cn=new WeakSet,gu=function(e){return{US:"United States",CA:"Canada",GB:"United Kingdom",AU:"Australia",NZ:"New Zealand"}[e]||e},dn=new WeakSet,mu=function(e){return{card_token:"Credit Card",paypal:"PayPal",apple_pay:"Apple Pay",google_pay:"Google Pay",credit:"Credit Card",card:"Credit Card"}[e]||e},ii=new WeakSet,qr=function(e){let i=t(this,T).currency||"USD",r=parseFloat(e);if(isNaN(r))return n(this,H,Y).call(this,"warn",`Invalid amount for currency formatting: ${e}`),`$0.00 ${i}`;try{return new Intl.NumberFormat("en-US",{style:"currency",currency:i}).format(r)}catch(s){return n(this,H,Y).call(this,"error",`Error formatting currency: ${s}`),`$${r.toFixed(2)} ${i}`}},un=new WeakSet,pu=function(e){n(this,H,Y).call(this,"error",`Displaying error message: ${e}`);let i=document.querySelector(".receipt-content")||document.body,r=document.createElement("div");r.className="receipt-error",r.style.color="red",r.style.padding="20px",r.style.margin="20px 0",r.style.border="1px solid red",r.style.borderRadius="5px",r.style.backgroundColor="rgba(255, 0, 0, 0.1)",r.textContent=e,i.prepend(r)}});var af={};fu(af,{TwentyNineNext:()=>hn});var De,yt,Rr,_,mn,bu,Nt,qi,zr,sd,gn=class{constructor(e){o(this,mn);o(this,Nt);o(this,zr);o(this,De,void 0);o(this,yt,void 0);o(this,Rr,"https://campaigns.apps.29next.com/api/v1");o(this,_,void 0);u(this,De,e),u(this,_,e.logger.createModuleLogger("API"))}init(){if(t(this,_).info("Initializing ApiClient"),u(this,yt,t(this,De).config.apiKey),t(this,yt))t(this,_).info("API key is set");else{let r=document.querySelector('meta[name="os-api-key"]');u(this,yt,r?.getAttribute("content")),t(this,_).info(t(this,yt)?"API key retrieved from meta tag":"API key is not set")}let i=document.querySelector('meta[name="os-proxy-url"]')?.getAttribute("content");i&&(u(this,Rr,i),t(this,_).info(`Using proxy URL: ${i}`))}async getCampaign(){try{let e=await n(this,Nt,qi).call(this,"campaigns/");if(t(this,_).debug("Campaign data received"),Array.isArray(e)&&e.length>0)return e[0];if(e?.name)return e;throw new Error("No valid campaign data found")}catch(e){return t(this,_).error("Error fetching campaign:",e),t(this,_).warn("Using fallback empty campaign object"),{name:"Default Campaign",currency:"USD",packages:[],formatPrice:i=>`$${Number.parseFloat(i).toFixed(2)}`}}}async createCart(e){t(this,_).debug("Creating cart",e),e.attribution?t(this,_).debug("Cart already has attribution data:",e.attribution):(e.attribution=n(this,zr,sd).call(this),t(this,_).debug("Added attribution data to cart:",e.attribution));try{let i=await n(this,Nt,qi).call(this,"carts/","POST",e);return t(this,_).info("Cart created successfully",i),i}catch(i){throw t(this,_).error("Error creating cart",i),i}}async createOrder(e){t(this,_).debug("Creating order",e),e.attribution?t(this,_).debug("Order already has attribution data:",e.attribution):(e.attribution=n(this,zr,sd).call(this),t(this,_).debug("Added attribution data to order:",e.attribution)),(e.payment_token==="test_card"||e.payment_detail&&e.payment_detail.card_token==="test_card")&&(t(this,_).debug("Using test card token for order"),e.payment_detail=e.payment_detail||{},e.payment_detail.payment_method="card_token",e.payment_detail.card_token="test_card",e.payment_token&&delete e.payment_token);try{let i=await n(this,Nt,qi).call(this,"orders/","POST",e);return t(this,_).info("Order created successfully",i),i.ref_id&&(sessionStorage.setItem("order_ref_id",i.ref_id),t(this,_).debug(`Order reference ID stored: ${i.ref_id}`)),i}catch(i){throw t(this,_).error("Error creating order",i),i}}async getOrder(e){if(!e)throw new Error("Order reference is required");return t(this,_).debug(`Fetching order with ref: ${e}`),n(this,Nt,qi).call(this,`orders/${e}/`)}async createOrderUpsell(e,i){if(!e)throw new Error("Order reference is required");t(this,_).debug(`Adding upsell to order ref: ${e}`,i);let r={lines:Array.isArray(i.lines)?i.lines:[{package_id:i.package_id,quantity:i.quantity||1}]};i.payment_detail&&(r.payment_detail=i.payment_detail);try{let s=await n(this,Nt,qi).call(this,`orders/${e}/upsells/`,"POST",r);return t(this,_).info("Upsell added successfully",s),s}catch(s){throw t(this,_).error("Error adding upsell to order",s),s}}getNextPageUrlFromMeta(e=null){let i=document.querySelector('meta[name="os-next-page"]');if(!i||!i.getAttribute("content"))return t(this,_).debug("No meta tag found for next page URL"),null;let r=i.getAttribute("content");t(this,_).debug(`Found meta tag with next page URL: ${r}`);let s=r.startsWith("http")?new URL(r):new URL(r,`${location.protocol}//${location.host}`);return e&&s.searchParams.append("ref_id",e),s.href}async processPayment(e,i){t(this,_).debug(`Processing ${i} payment for order`);let r={credit:"card_token",paypal:"paypal",apple_pay:"apple_pay",google_pay:"google_pay"};if(e.payment_detail=e.payment_detail??{},e.payment_detail.payment_method=r[i]??i,i==="credit"&&!e.payment_detail.card_token)throw new Error("Credit card payment requires a card token");if(i!=="credit"&&delete e.payment_detail.card_token,!e.success_url){let s=this.getNextPageUrlFromMeta(e.ref_id);s?(e.success_url=s,t(this,_).debug(`Set success_url from meta tag: ${e.success_url}`)):t(this,_).debug("No meta tag found for success_url, API will use order_status_url as fallback")}if(!e.payment_failed_url){let s=new URL(window.location.href);s.searchParams.set("payment_failed","true"),s.searchParams.set("payment_method",i),e.payment_failed_url=s.href,t(this,_).debug(`Set payment_failed_url to: ${e.payment_failed_url}`)}return this.createOrder(e)}getNextUrlFromOrderResponse(e){t(this,_).debug("Getting next URL for redirect");let i=e.ref_id;if(e.payment_complete_url)return t(this,_).debug(`Using payment complete URL from API: ${e.payment_complete_url}`),e.payment_complete_url;let r=this.getNextPageUrlFromMeta(i);return r||(e.order_status_url?(t(this,_).debug(`Using order status URL from API: ${e.order_status_url}`),e.order_status_url):(t(this,_).warn("No order_status_url found in API response - using fallback URL"),`${window.location.origin}/checkout/confirmation/?ref_id=${i||""}`))}};De=new WeakMap,yt=new WeakMap,Rr=new WeakMap,_=new WeakMap,mn=new WeakSet,bu=function(e){let i=e.startsWith("/")?e.slice(1):e;return`${t(this,Rr)}/${i}`},Nt=new WeakSet,qi=async function(e,i="GET",r=null){if(!t(this,yt)){if(t(this,_).warn("API key is not set"),e==="campaigns/")return t(this,_).info("Returning mock campaign data since API key is not set"),[{name:"Mock Campaign",id:"mock-campaign",currency:"USD",locale:"en-US",packages:[],products:[]}];throw new Error("API key is required")}let s=n(this,mn,bu).call(this,e),a={method:i,mode:"cors",credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:t(this,yt)}};i!=="GET"&&r&&(a.body=JSON.stringify(r)),t(this,_).debug(`Making ${i} request to ${s}`,i!=="GET"?{requestData:r}:{});try{let l=await fetch(s,a);if(t(this,_).debug(`Received response from ${s} with status ${l.status}`),!l.ok){let h=await l.json().catch(()=>({}));throw t(this,_).error(`API error response from ${s}:`,h),new Error(JSON.stringify(h))}let d=await l.json();return t(this,_).debug(`Successfully processed response from ${s}`),d}catch(l){throw t(this,_).error(`API request failed: ${e}`,l),l.message?.match(/NetworkError|Failed to fetch|Network request failed/)&&t(this,_).warn("This appears to be a CORS issue. Make sure the API endpoint allows cross-origin requests."),l}},zr=new WeakSet,sd=function(){if(t(this,De).attribution)return typeof t(this,De).attribution.getAttributionForApi=="function"?t(this,De).attribution.getAttributionForApi():t(this,De).attribution.getAttributionData();if(t(this,De).state){let e=t(this,De).state.getState("attribution");return e||t(this,De).state.getState("cart.attribution")||{}}return{}};var Ot,Ut,Fi,fn,vu,yn,wu,bn,Su,vn,_u,wn,xu,Sn,Cu,_n,Eu,xn,ku,pn=class{constructor(e=!1){o(this,fn);o(this,yn);o(this,bn);o(this,vn);o(this,wn);o(this,Sn);o(this,_n);o(this,xn);o(this,Ot,void 0);o(this,Ut,"29next");o(this,Fi,0);u(this,Ot,e),this.setStartupTime()}setDebug(e){u(this,Ot,e)}setStartupTime(){u(this,Fi,+new Date),window.twentyNineNextStartupTime=t(this,Fi)}getElapsedTime(){return+new Date-t(this,Fi)}createModuleLogger(e){let i=`${t(this,Ut)} [${e}]`;return{debug:(...r)=>n(this,vn,_u).call(this,i,...r),info:(...r)=>n(this,fn,vu).call(this,i,...r),warn:(...r)=>n(this,yn,wu).call(this,i,...r),error:(...r)=>n(this,bn,Su).call(this,i,...r),debugWithTime:(...r)=>n(this,xn,ku).call(this,i,...r),infoWithTime:(...r)=>n(this,wn,xu).call(this,i,...r),warnWithTime:(...r)=>n(this,Sn,Cu).call(this,i,...r),errorWithTime:(...r)=>n(this,_n,Eu).call(this,i,...r)}}logWithTime(e,...i){let r=this.getElapsedTime();`${t(this,Ut)}${r}${e}`,[...i]}warnWithTime(e,...i){let r=this.getElapsedTime();console.warn(`%c${t(this,Ut)} +${r}ms%c ${e}`,"color: #ff9900; font-weight: bold;","color: inherit;",...i)}errorWithTime(e,...i){let r=this.getElapsedTime();console.error(`%c${t(this,Ut)} +${r}ms%c ${e}`,"color: #cc0000; font-weight: bold;","color: inherit;",...i)}debugWithTime(e,...i){if(t(this,Ot)){let r=this.getElapsedTime();console.debug(`%c${t(this,Ut)}:debug +${r}ms%c ${e}`,"color: #666666; font-weight: bold;","color: inherit;",...i)}}};Ot=new WeakMap,Ut=new WeakMap,Fi=new WeakMap,fn=new WeakSet,vu=function(e,i,...r){`${e}${i}`,[...r]},yn=new WeakSet,wu=function(e,i,...r){console.warn(`%c${e}%c ${i}`,"color: #ff9900; font-weight: bold;","color: inherit;",...r)},bn=new WeakSet,Su=function(e,i,...r){console.error(`%c${e}%c ${i}`,"color: #cc0000; font-weight: bold;","color: inherit;",...r)},vn=new WeakSet,_u=function(e,i,...r){t(this,Ot)&&console.debug(`%c${e}:debug%c ${i}`,"color: #666666; font-weight: bold;","color: inherit;",...r)},wn=new WeakSet,xu=function(e,i,...r){let s=this.getElapsedTime();`${e}${s}${i}`,[...r]},Sn=new WeakSet,Cu=function(e,i,...r){let s=this.getElapsedTime();console.warn(`%c${e} +${s}ms%c ${i}`,"color: #ff9900; font-weight: bold;","color: inherit;",...r)},_n=new WeakSet,Eu=function(e,i,...r){let s=this.getElapsedTime();console.error(`%c${e} +${s}ms%c ${i}`,"color: #cc0000; font-weight: bold;","color: inherit;",...r)},xn=new WeakSet,ku=function(e,i,...r){if(t(this,Ot)){let s=this.getElapsedTime();console.debug(`%c${e}:debug +${s}ms%c ${i}`,"color: #666666; font-weight: bold;","color: inherit;",...r)}};var kn,he,ge,ke,Me,j,An,Au,Tn,Tu,Dr,nd,$n,$u,Mi,Cn,Pn,Pu,Ln,Lu,Br,od,In,Iu,Vr,ad,qn,qu,Fn,Fu,Mn,Mu,En=class{constructor(e,i){o(this,An);o(this,Tn);o(this,Dr);o(this,$n);o(this,Mi);o(this,Pn);o(this,Ln);o(this,Br);o(this,In);o(this,Vr);o(this,qn);o(this,Fn);o(this,Mn);o(this,kn,void 0);o(this,he,void 0);o(this,ge,void 0);o(this,ke,[]);o(this,Me,{});o(this,j,void 0);u(this,kn,e),u(this,he,i),u(this,ge,n(this,Tn,Tu).call(this)),u(this,j,{shippingCountry:document.querySelector('[os-checkout-field="country"]'),shippingState:document.querySelector('[os-checkout-field="province"]'),billingCountry:document.querySelector('[os-checkout-field="billing-country"]'),billingState:document.querySelector('[os-checkout-field="billing-province"]')}),n(this,Ln,Lu).call(this),t(this,j).shippingCountry||t(this,j).billingCountry?(t(this,he).info("AddressHandler initialized"),n(this,An,Au).call(this)):t(this,he).warn("No country selects found")}};kn=new WeakMap,he=new WeakMap,ge=new WeakMap,ke=new WeakMap,Me=new WeakMap,j=new WeakMap,An=new WeakSet,Au=async function(){await n(this,In,Iu).call(this),await Promise.all([t(this,j).shippingCountry&&n(this,Dr,nd).call(this,t(this,j).shippingCountry,t(this,j).shippingState),t(this,j).billingCountry&&n(this,Dr,nd).call(this,t(this,j).billingCountry,t(this,j).billingState)]),n(this,$n,$u).call(this),n(this,qn,qu).call(this),n(this,Fn,Fu).call(this)},Tn=new WeakSet,Tu=function(){return{defaultCountry:window.osConfig?.addressConfig?.defaultCountry??document.querySelector('meta[name="os-address-default-country"]')?.content??"US",showCountries:window.osConfig?.addressConfig?.showCountries??document.querySelector('meta[name="os-address-show-countries"]')?.content?.split(",").map(e=>e.trim())??[],dontShowStates:window.osConfig?.addressConfig?.dontShowStates??document.querySelector('meta[name="os-address-dont-show-states"]')?.content?.split(",").map(e=>e.trim())??[],countries:window.osConfig?.addressConfig?.countries??[]}},Dr=new WeakSet,nd=async function(e,i){e.innerHTML='<option value="">Select Country</option>'+t(this,ke).map(r=>`<option value="${r.iso2}">${r.name}</option>`).join(""),e.value=t(this,ge).defaultCountry,i&&e.value&&await n(this,Mi,Cn).call(this,i,e.value),t(this,he).debug(`Country select initialized with default ${t(this,ge).defaultCountry}`)},$n=new WeakSet,$u=function(){[[t(this,j).shippingCountry,t(this,j).shippingState],[t(this,j).billingCountry,t(this,j).billingState]].forEach(([i,r])=>{i?.addEventListener("change",()=>r&&n(this,Mi,Cn).call(this,r,i.value))})},Mi=new WeakSet,Cn=async function(e,i,r=!1){if(!i)return e.innerHTML='<option value="">Select State/Province</option>';let s=t(this,Me)[i]||await n(this,Vr,ad).call(this,i);r&&await s,n(this,Pn,Pu).call(this,e,s),t(this,he).debug(`State select updated for ${i}`)},Pn=new WeakSet,Pu=function(e,i){let r=e.value||e.getAttribute("data-pending-state")||"";e.innerHTML='<option value="">Select State/Province</option>'+i.map(s=>`<option value="${s.iso2}">${s.name}</option>`).join(""),e.parentElement.style.display=i.length?"":"none",r&&Array.from(e.options).some(s=>s.value===r)&&(e.value=r)},Ln=new WeakSet,Lu=function(){let e=i=>{let r=JSON.parse(localStorage.getItem(i)??"{}");return Date.now()-(r.timestamp??0)<864e5?r:{}};u(this,ke,e("os_countries_cache").countries??[]),t(this,ke).length&&t(this,ge).showCountries.length&&(u(this,ke,t(this,ke).filter(i=>t(this,ge).showCountries.includes(i.iso2))),t(this,he).debug(`Filtered cached countries to: ${t(this,ge).showCountries.join(", ")}`)),u(this,Me,e("os_states_cache").states??{}),t(this,he).debug(`Loaded cached data: ${t(this,ke).length} countries, ${Object.keys(t(this,Me)).length} state sets`)},Br=new WeakSet,od=function(e,i){localStorage.setItem(e,JSON.stringify({...i,timestamp:Date.now()}))},In=new WeakSet,Iu=async function(){t(this,ke).length||(u(this,ke,t(this,ge).countries.length?t(this,ge).countries.map(e=>({iso2:e.iso2||e.code,name:e.name})):(await(await fetch("https://api.countrystatecity.in/v1/countries",{headers:{"X-CSCAPI-KEY":"c2R3MzNhYmpvYUJPdmhkUlE5TUJWYUtJUGs2TTlNU3cyRmxmVW9wVQ=="}})).json()).filter(e=>!t(this,ge).showCountries.length||t(this,ge).showCountries.includes(e.iso2))),t(this,ke).sort((e,i)=>e.name.localeCompare(i.name)),n(this,Br,od).call(this,"os_countries_cache",{countries:t(this,ke)}),t(this,he).info(`Loaded ${t(this,ke).length} countries`))},Vr=new WeakSet,ad=async function(e){if(t(this,Me)[e])return t(this,Me)[e];try{let i=(await(await fetch(`https://api.countrystatecity.in/v1/countries/${e}/states`,{headers:{"X-CSCAPI-KEY":"c2R3MzNhYmpvYUJPdmhkUlE5TUJWYUtJUGs2TTlNU3cyRmxmVW9wVQ=="}})).json()).filter(r=>!t(this,ge).dontShowStates.includes(r.iso2));return t(this,Me)[e]=i,n(this,Br,od).call(this,"os_states_cache",{states:t(this,Me)}),t(this,he).debug(`Loaded ${i.length} states for ${e}`),i}catch(i){return t(this,he).error(`Failed to load states for ${e}:`,i),t(this,Me)[e]=e==="US"?[]:[],t(this,Me)[e]}},qn=new WeakSet,qu=async function(){if(t(this,j).shippingCountry?.value||t(this,j).billingCountry?.value)return;let e=t(this,ge).defaultCountry||(await Promise.any(["https://ipapi.co/json/","https://ipinfo.io/json"].map(i=>fetch(i).then(r=>r.json()))))?.country_code;[t(this,j).shippingCountry,t(this,j).billingCountry].forEach(i=>{i&&(i.value=e,i.dispatchEvent(new Event("change")))}),t(this,he).debug(`User country detected/set to ${e}`)},Fn=new WeakSet,Fu=function(){let e=Object.values(t(this,j)).filter(Boolean),i=new MutationObserver(r=>{r.forEach(s=>{if(s.attributeName==="value"&&s.target.value){let a=s.target===t(this,j).shippingCountry?t(this,j).shippingState:t(this,j).billingState;a&&n(this,Mi,Cn).call(this,a,s.target.value,!0),t(this,he).debug(`Autocomplete detected on ${s.target.getAttribute("os-checkout-field")}`)}})});e.forEach(r=>i.observe(r,{attributes:!0,attributeFilter:["value"]})),n(this,Mn,Mu).call(this),t(this,he).debug("Autocomplete detection set up")},Mn=new WeakSet,Mu=function(){let e=t(this,ge).showCountries.length?t(this,ge).showCountries:["US","CA","GB","AU"];e.forEach(i=>!t(this,Me)[i]&&n(this,Vr,ad).call(this,i)),t(this,he).debug(`Preloading states for ${e.join(", ")}`)};var Ni,Rt,Nn,Wr,oi,jr,Gr,On,Nu,Ae,Be,Un,Ou,Rn,Uu,Kr,ld,Yr,cd,zn,Ru,Dn,zu,Bn,Du,Vn,Bu,gd,Op,Jr,dd,ai,Hr,Zr,ud,Hn,Vu,Wn,Hu,jn,Wu,Gn,ju,Kn,Gu,Ve,ot,Yn,Ku,Xr,hd,Jn,Yu,Zn,Ju,Xn,Zu,Qn,Xu,Oi=class{constructor(e={}){o(this,On);o(this,Ae);o(this,Un);o(this,Rn);o(this,Kr);o(this,Yr);o(this,zn);o(this,Dn);o(this,Bn);o(this,Vn);o(this,gd);o(this,Jr);o(this,ai);o(this,Zr);o(this,Hn);o(this,Wn);o(this,jn);o(this,Gn);o(this,Kn);o(this,Ve);o(this,Yn);o(this,Xr);o(this,Jn);o(this,Zn);o(this,Xn);o(this,Qn);o(this,Ni,void 0);o(this,Rt,void 0);o(this,Nn,{});o(this,Wr,!1);o(this,oi,!1);o(this,jr,!1);o(this,Gr,!1);u(this,Wr,e.debugMode||!1),u(this,Ni,e.logger||console),u(this,Rt,n(this,On,Nu).call(this)),u(this,oi,typeof Spreedly<"u"),t(this,Rt)&&n(this,Un,Ou).call(this)}validateAllFields(e=this.getSelectedPaymentMethod()){t(this,Wr)&&n(this,Dn,zu).call(this,e);let i=["credit","credit-card"].includes(e),r=!0,s=Array.from(document.querySelectorAll('[os-checkout-validate="required"]')),a=n(this,Bn,Du).call(this,s,i),l=!0;i&&(l=this.validateCreditCard());let d=n(this,Zn,Ju).call(this);return a?(n(this,Xr,hd).call(this,a),r=!1):d?r=!1:l||(r=!1),r}clearErrorForField(e){if(!e)return;e.classList.remove("error"),(e.closest(".frm-flds")||e.closest(".form-group")||e.parentElement)?.querySelector(".pb-input-error")?.remove();let r=e.getAttribute("os-checkout-field");if(["cc-number","cvv"].includes(r)){let s=`spreedly-${r==="cc-number"?"number":"cvv"}`,a=document.getElementById(s);a&&(a.classList.remove("error"),a.closest(".frm-flds")?.querySelector(".pb-input-error")?.remove())}}clearAllErrors(){u(this,Nn,{}),document.querySelectorAll(".error").forEach(e=>e.classList.remove("error")),document.querySelectorAll(".pb-input-error").forEach(e=>e.remove()),n(this,Zr,ud).call(this)}isSameAsShipping(){let e=document.querySelector('[os-checkout-field="same-as-shipping"] input[type="checkbox"]')||document.querySelector('[os-input-field="use-shipping-address"] input[type="checkbox"]')||document.querySelector("#use_shipping_address");return e?e.checked:!0}getSelectedPaymentMethod(){return document.querySelector('input[name="payment_method"]:checked')?.value||document.querySelector('input[name="combo_mode"]:checked')?.value||"credit"}getFormValues(){let e={};return t(this,Rt).querySelectorAll("input, select, textarea").forEach(i=>{if(["button","submit"].includes(i.type)||i.disabled||!i.name)return;let r=i.getAttribute("os-checkout-field")||i.name;if(i.type==="checkbox")e[r]=i.checked;else if(i.type==="radio")i.checked&&(e[r]=i.value);else if(r.includes(".")){let[s,a]=r.split(".");e[s]=e[s]||{},e[s][a]=i.value}else e[r]=i.value}),e}validateCreditCard(){let e=!0,[i,r]=n(this,Jr,dd).call(this);if(n(this,ai,Hr).call(this,i,"month")||(e=!1),n(this,ai,Hr).call(this,r,"year")||(e=!1),t(this,oi)&&typeof Spreedly.validate=="function"){let s=document.getElementById("spreedly-number"),a=document.getElementById("spreedly-cvv"),l=s?.classList.contains("spreedly-valid"),d=a?.classList.contains("spreedly-valid");Spreedly.validate(),!l&&s&&(n(this,Ve,ot).call(this,s,"Please enter a valid credit card number"),e=!1),!d&&a&&(n(this,Ve,ot).call(this,a,"Please enter a valid security code (CVV)"),e=!1)}else{let s=document.querySelector('[os-checkout-field="cc-number"]'),a=document.querySelector('[os-checkout-field="cvv"]');s?.value.trim()||(n(this,Ve,ot).call(this,s,"Please enter a credit card number"),e=!1),a?.value.trim()||(n(this,Ve,ot).call(this,a,"Please enter a security code (CVV)"),e=!1)}return e}};Ni=new WeakMap,Rt=new WeakMap,Nn=new WeakMap,Wr=new WeakMap,oi=new WeakMap,jr=new WeakMap,Gr=new WeakMap,On=new WeakSet,Nu=function(){let e=document.querySelector('form[os-checkout="form"]')||document.querySelector("form#combo_form");return e||n(this,Ae,Be).call(this,"warn","No checkout form found"),e},Ae=new WeakSet,Be=function(e,i,...r){try{(t(this,Ni)?.[e]||console[e]||console.log).call(console,`[${e.toUpperCase()}] ${i}`,...r)}catch(s){console.error("Error logging:",s)}},Un=new WeakSet,Ou=function(){t(this,Rt).addEventListener("submit",e=>n(this,zn,Ru).call(this,e)),document.querySelector('[os-checkout-payment="combo"]')?.addEventListener("click",()=>{this.validateAllFields()&&t(this,Rt).submit()}),document.addEventListener("payment-method-changed",()=>this.clearAllErrors()),t(this,oi)&&typeof Spreedly.on=="function"&&n(this,Rn,Uu).call(this),n(this,Xn,Zu).call(this)},Rn=new WeakSet,Uu=function(){Object.entries({ready:()=>{u(this,Gr,!0),n(this,Ae,Be).call(this,"debug","Spreedly is ready")},paymentMethod:(i,r)=>{u(this,jr,!0),n(this,Ae,Be).call(this,"debug","Spreedly payment method created"),n(this,Zr,ud).call(this)},validation:i=>{n(this,Ae,Be).call(this,"debug",`Spreedly field validation: ${i.fieldType} ${i.valid?"valid":"invalid"}`);let r=document.getElementById(`spreedly-${i.fieldType}`);if(r&&(r.classList.toggle("spreedly-valid",i.valid),r.classList.toggle("error",!i.valid)),i.valid)this.clearErrorForField(r);else{let s=n(this,Kr,ld).call(this,i.fieldType);n(this,Yr,cd).call(this,{attribute:i.fieldType,message:s})}},errors:i=>{u(this,jr,!1),n(this,Ae,Be).call(this,"debug","Spreedly validation errors:",i),i.forEach(r=>n(this,Yr,cd).call(this,r))},fieldEvent:(i,r,s,a)=>{let l=document.getElementById(`spreedly-${i}`);if(r==="input"&&l){let d=i==="number"?a.validNumber:a.validCvv;if(l.classList.toggle("spreedly-valid",d),l.classList.toggle("error",!d),d)this.clearErrorForField(l);else{let h=n(this,Kr,ld).call(this,i);n(this,Ve,ot).call(this,l,h)}}}}).forEach(([i,r])=>Spreedly.on(i,r))},Kr=new WeakSet,ld=function(e){return{number:"Please enter a valid credit card number",cvv:"Please enter a valid security code (CVV)"}[e]||`Invalid ${e}`},Yr=new WeakSet,cd=function(e){let i={number:"spreedly-number",card_number:"spreedly-number",cvv:"spreedly-cvv",month:"cc-month",year:"cc-year",full_name:"cc-name",first_name:"cc-name",last_name:"cc-name"},r=document.getElementById(i[e.attribute])||document.querySelector(`[os-checkout-field="${i[e.attribute]}"]`);r&&n(this,Ve,ot).call(this,r,e.message)},zn=new WeakSet,Ru=function(e){this.validateAllFields()||(e.preventDefault(),n(this,Ae,Be).call(this,"warn","Form validation failed"))},Dn=new WeakSet,zu=function(e){n(this,Ae,Be).call(this,"debug","Starting field validation for payment method:",e),n(this,Ae,Be).call(this,"debug","Same as shipping:",this.isSameAsShipping()),n(this,Ae,Be).call(this,"debug","Spreedly enabled:",t(this,oi)),n(this,Ae,Be).call(this,"debug","Spreedly ready:",t(this,Gr))},Bn=new WeakSet,Du=function(e,i){let r=null;for(let s of e){let a=s.getAttribute("os-checkout-field");if(n(this,Vn,Bu).call(this,a,i)){this.clearErrorForField(s);continue}let l=s.previousElementSibling?.textContent||a||s.placeholder;n(this,Hn,Vu).call(this,s,l)||(r=r||s)}return r},Vn=new WeakSet,Bu=function(e,i){return this.isSameAsShipping()&&e?.startsWith("billing-")||i&&["cc-number","cvv"].includes(e)},gd=new WeakSet,Op=function(){let[e,i]=n(this,Jr,dd).call(this);return n(this,ai,Hr).call(this,e,"month")&&n(this,ai,Hr).call(this,i,"year")},Jr=new WeakSet,dd=function(){let e=['[os-checkout-field="cc-month"]','[os-checkout-field="exp-month"]',"#credit_card_exp_month"],i=['[os-checkout-field="cc-year"]','[os-checkout-field="exp-year"]',"#credit_card_exp_year"];return[e.map(r=>document.querySelector(r)).find(Boolean),i.map(r=>document.querySelector(r)).find(Boolean)]},ai=new WeakSet,Hr=function(e,i){return!e||!e.value?(n(this,Ae,Be).call(this,"error",`${i} field is empty`),n(this,Ve,ot).call(this,e,`Please select an expiration ${i}`),!1):!0},Zr=new WeakSet,ud=function(){["cc-number","cvv"].forEach(e=>this.clearErrorForField(document.querySelector(`[os-checkout-field="${e}"]`))),["spreedly-number","spreedly-cvv"].forEach(e=>this.clearErrorForField(document.getElementById(e)))},Hn=new WeakSet,Vu=function(e,i){if(!e)return!0;let r=e.value.trim(),s=n(this,jn,Wu).call(this,e,r,n(this,Wn,Hu).call(this,e,i));return s.isValid?this.clearErrorForField(e):n(this,Ve,ot).call(this,e,s.errorMessage),s.isValid},Wn=new WeakSet,Hu=function(e,i){let r=e.getAttribute("os-checkout-field")||e.name;return{fname:"First Name",lname:"Last Name",email:"Email",phone:"Phone Number",address1:"Address",address2:"Apartment or Suite",city:"City",province:"State/Province",postal:"ZIP/Postal Code",country:"Country","cc-number":"Credit Card Number",cvv:"Security Code","cc-month":"Expiration Month","cc-year":"Expiration Year","cc-name":"Name on Card","exp-month":"Expiration Month","exp-year":"Expiration Year","billing-fname":"Billing First Name","billing-lname":"Billing Last Name","billing-address1":"Billing Address","billing-address2":"Billing Apartment or Suite","billing-city":"Billing City","billing-province":"Billing State/Province","billing-postal":"Billing ZIP/Postal Code","billing-country":"Billing Country","billing-phone":"Billing Phone Number"}[r]||i||r},jn=new WeakSet,Wu=function(e,i,r){let s=e.tagName.toLowerCase(),a=e.getAttribute("os-checkout-field")||e.name;return s==="select"?{isValid:!!i,errorMessage:`Please select a ${r}`}:e.type==="tel"&&e.iti?i.trim()?{isValid:e.iti.isValidNumber(),errorMessage:"Please enter a valid US phone number (e.g. 555-555-5555)"}:{isValid:!0,errorMessage:""}:i?a&&(a.includes("city")||a.endsWith("-city"))?n(this,Gn,ju).call(this,i,r):a&&(a.includes("zip")||a.includes("postal")||a.endsWith("-zip"))?n(this,Kn,Gu).call(this,i,a):e.type==="email"?{isValid:n(this,Jn,Yu).call(this,i),errorMessage:"Please enter a valid email address"}:{isValid:!0,errorMessage:""}:{isValid:!1,errorMessage:`Please enter your ${r}`}},Gn=new WeakSet,ju=function(e,i){return{isValid:/^[a-zA-Z\s]{2,24}$/.test(e),errorMessage:"Please enter a valid city name (2-24 letters, no numbers or special characters)"}},Kn=new WeakSet,Gu=function(e,i="Zip"){let s=/(^\d{5}$)|(^\d{5}-\d{4}$)/.test(e);return{isValid:s,errorMessage:s?"":"Field must be a valid US Zip code."}},Ve=new WeakSet,ot=function(e,i){if(!e)return;e.classList.add("error");let r=e.closest(".frm-flds")||e.closest(".form-group")||e.parentElement,s=n(this,Yn,Ku).call(this,r);s.textContent=i,Object.assign(s.style,{color:"red",fontSize:"0.875rem",marginTop:"0.25rem"}),e.hasErrorListener||(e.hasErrorListener=!0,["input","change"].forEach(a=>e.addEventListener(a,()=>this.clearErrorForField(e))),e.type==="tel"&&e.iti&&e.addEventListener("countrychange",()=>this.clearErrorForField(e)))},Yn=new WeakSet,Ku=function(e){let i=e.querySelector(".pb-input-error");return i||(i=document.createElement("div"),i.className="pb-input-error",e.appendChild(i)),i},Xr=new WeakSet,hd=function(e){e&&(window.scrollTo({top:e.getBoundingClientRect().top+window.pageYOffset-100,behavior:"smooth"}),setTimeout(()=>e.focus(),500))},Jn=new WeakSet,Yu=function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},Zn=new WeakSet,Ju=function(){let e=Array.from(document.querySelectorAll('input[type="tel"]')),i=!1;for(let r of e){if(!r.value.trim()||!r.iti)continue;if(r.iti.isValidNumber())this.clearErrorForField(r);else{let a=r.iti.getValidationError(),d={0:"Please enter a valid US phone number (e.g. 555-555-5555)",1:"Invalid country code",2:"Phone number is too short",3:"Phone number is too long",4:"Please enter a valid phone number",5:"Invalid phone number format"}[a]||"Please enter a valid US phone number";n(this,Ve,ot).call(this,r,d),i||(n(this,Xr,hd).call(this,r),i=!0)}}return i},Xn=new WeakSet,Zu=function(){[...document.querySelectorAll('[os-checkout-field="postal"]'),...document.querySelectorAll('[os-checkout-field="billing-postal"]'),...document.querySelectorAll('[os-checkout-field="zip"]')].forEach(i=>{i&&(i.addEventListener("input",r=>n(this,Qn,Xu).call(this,r)),t(this,Ni).debug(`ZIP code formatting setup for: ${i.getAttribute("os-checkout-field")||i.name||"unknown"}`))})},Qn=new WeakSet,Xu=function(e){let i=e.target,r=i.selectionStart,s=i.value,a=s.replace(/[^\d-]/g,"");if(a.length>5){let l=a.slice(0,5);if(a.charAt(5)!=="-"){let d=a.slice(5).replace(/-/g,"");a=`${l}-${d}`}else{let d=a.slice(6).replace(/-/g,"");a=`${l}-${d}`}}if(a.includes("-")){let[l,d]=a.split("-");a=`${l.slice(0,5)}-${d.slice(0,4)}`}else a=a.slice(0,5);if(a!==s){i.value=a;let l=a.length-s.length;i.setSelectionRange(r+l,r+l)}};var Qr,es,Ui,Ri,fe,zi,Di,L,io,ro,Qu,so,eh,no,th,ts,md,oo,ih,ao,rh,lo,sh,is,pd,Bi,eo,N,z,to=class{constructor(e,i={}){o(this,ro);o(this,so);o(this,no);o(this,ts);o(this,oo);o(this,ao);o(this,lo);o(this,is);o(this,Bi);o(this,N);o(this,Qr,void 0);o(this,es,!1);o(this,Ui,!1);o(this,Ri,null);o(this,fe,null);o(this,zi,null);o(this,Di,null);o(this,L,null);o(this,io,null);if(u(this,Qr,e),u(this,es,i.debug||!1),u(this,io,i.app||null),n(this,ro,Qu).call(this),!e){n(this,N,z).call(this,"error","No environment key provided to SpreedlyManager");return}n(this,N,z).call(this,"debug",`SpreedlyManager initialized with environment key: ${e}`),n(this,so,eh).call(this)}clearAllErrors(){n(this,Bi,eo).call(this,"number"),n(this,Bi,eo).call(this,"cvv");let e=document.querySelector('[os-checkout-field="cc-month"]')||document.querySelector('[os-checkout-field="exp-month"]')||document.querySelector("#credit_card_exp_month"),i=document.querySelector('[os-checkout-field="cc-year"]')||document.querySelector('[os-checkout-field="exp-year"]')||document.querySelector("#credit_card_exp_year");if(e){e.classList.remove("error");let s=(e.closest(".frm-flds")||e.parentElement).querySelector(".pb-input-error");s&&s.remove()}if(i){i.classList.remove("error");let s=(i.closest(".frm-flds")||i.parentElement).querySelector(".pb-input-error");s&&s.remove()}}tokenizeCard(e){if(n(this,N,z).call(this,"debug","Tokenizing card with data:",{...e,full_name:e.full_name,month:e.month,year:e.year}),this.clearAllErrors(),!e.full_name||!e.month||!e.year){n(this,N,z).call(this,"error","Missing required card data");let i=[];e.full_name||i.push({attribute:"full_name",message:"Cardholder name is required"}),e.month||i.push({attribute:"month",message:"Expiration month is required"}),e.year||i.push({attribute:"year",message:"Expiration year is required"}),n(this,is,pd).call(this,i),t(this,fe)&&t(this,fe).call(this,i.map(r=>r.message));return}if(!t(this,Ui)){n(this,N,z).call(this,"error","Spreedly is not ready yet"),t(this,fe)&&t(this,fe).call(this,["Payment system is not ready yet. Please try again in a moment."]);return}try{Spreedly.tokenizeCreditCard(e),n(this,N,z).call(this,"debug","Card tokenization initiated")}catch(i){n(this,N,z).call(this,"error","Error tokenizing card",i),t(this,fe)&&t(this,fe).call(this,["An error occurred while processing your card. Please try again."])}}setOnReady(e){u(this,Ri,e),t(this,Ui)&&e&&e()}setOnError(e){u(this,fe,e)}setOnPaymentMethod(e){u(this,zi,e)}setOnValidation(e){u(this,Di,e)}};Qr=new WeakMap,es=new WeakMap,Ui=new WeakMap,Ri=new WeakMap,fe=new WeakMap,zi=new WeakMap,Di=new WeakMap,L=new WeakMap,io=new WeakMap,ro=new WeakSet,Qu=function(){u(this,L,{fieldType:{number:"text",cvv:"text"},numberFormat:"prettyFormat",placeholder:{number:"Credit Card Number",cvv:"CVV *"},labels:{number:"Card Number",cvv:"CVV"},titles:{number:"Credit card number",cvv:"Card verification value"},styling:{number:'color: #212529; font-size: .925rem; font-weight: 400; width: 100%; height:100%; font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue","Noto Sans","Liberation Sans",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";',cvv:'color: #212529; font-size: .925rem; font-weight: 400; width: 100%; height: 100%; font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue","Noto Sans","Liberation Sans",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";'},placeholder_styling:"",required:{number:!0,cvv:!0},autocomplete:!0}),window.osConfig&&window.osConfig.spreedlyConfig&&(n(this,N,z).call(this,"debug","Found global Spreedly configuration",window.osConfig.spreedlyConfig),window.osConfig.spreedlyConfig.fieldType&&(t(this,L).fieldType={...t(this,L).fieldType,...window.osConfig.spreedlyConfig.fieldType}),window.osConfig.spreedlyConfig.numberFormat&&(t(this,L).numberFormat=window.osConfig.spreedlyConfig.numberFormat),window.osConfig.spreedlyConfig.placeholder&&(t(this,L).placeholder={...t(this,L).placeholder,...window.osConfig.spreedlyConfig.placeholder}),window.osConfig.spreedlyConfig.labels&&(t(this,L).labels={...t(this,L).labels,...window.osConfig.spreedlyConfig.labels}),window.osConfig.spreedlyConfig.titles&&(t(this,L).titles={...t(this,L).titles,...window.osConfig.spreedlyConfig.titles}),window.osConfig.spreedlyConfig.styling&&(t(this,L).styling={...t(this,L).styling,...window.osConfig.spreedlyConfig.styling}),window.osConfig.spreedlyConfig.placeholder_styling&&(t(this,L).placeholder_styling=window.osConfig.spreedlyConfig.placeholder_styling),window.osConfig.spreedlyConfig.required&&(t(this,L).required={...t(this,L).required,...window.osConfig.spreedlyConfig.required}),window.osConfig.spreedlyConfig.hasOwnProperty("autocomplete")&&(t(this,L).autocomplete=window.osConfig.spreedlyConfig.autocomplete)),n(this,N,z).call(this,"debug","Spreedly configuration initialized",t(this,L))},so=new WeakSet,eh=function(){typeof Spreedly>"u"?(n(this,N,z).call(this,"debug","Spreedly not loaded, loading script..."),n(this,no,th).call(this).then(()=>{n(this,N,z).call(this,"debug","Spreedly script loaded"),n(this,ts,md).call(this)}).catch(e=>{n(this,N,z).call(this,"error","Failed to load Spreedly script",e),t(this,fe)&&t(this,fe).call(this,["Failed to load Spreedly. Please refresh the page and try again."])})):(n(this,N,z).call(this,"debug","Spreedly already loaded"),n(this,ts,md).call(this))},no=new WeakSet,th=function(){return new Promise((e,i)=>{let r=document.createElement("script");r.src="https://core.spreedly.com/iframe/iframe-v1.min.js",r.async=!0,r.onload=e,r.onerror=i,document.head.appendChild(r)})},ts=new WeakSet,md=function(){try{n(this,N,z).call(this,"debug","Setting up Spreedly..."),n(this,ao,rh).call(this),Spreedly.init(t(this,Qr),{numberEl:"spreedly-number",cvvEl:"spreedly-cvv"}),Spreedly.on("ready",()=>{n(this,N,z).call(this,"debug","Spreedly iframe ready"),n(this,oo,ih).call(this),u(this,Ui,!0),t(this,Ri)&&t(this,Ri).call(this)}),n(this,lo,sh).call(this),n(this,N,z).call(this,"debug","Spreedly setup complete")}catch(e){n(this,N,z).call(this,"error","Error setting up Spreedly",e),t(this,fe)&&t(this,fe).call(this,["Failed to set up Spreedly. Please refresh the page and try again."])}},oo=new WeakSet,ih=function(){try{n(this,N,z).call(this,"debug","Applying Spreedly configuration..."),Spreedly.setFieldType("number",t(this,L).fieldType.number),Spreedly.setFieldType("cvv",t(this,L).fieldType.cvv),Spreedly.setNumberFormat(t(this,L).numberFormat),Spreedly.setPlaceholder("number",t(this,L).placeholder.number),Spreedly.setPlaceholder("cvv",t(this,L).placeholder.cvv),Spreedly.setLabel("number",t(this,L).labels.number),Spreedly.setLabel("cvv",t(this,L).labels.cvv),Spreedly.setTitle("number",t(this,L).titles.number),Spreedly.setTitle("cvv",t(this,L).titles.cvv),Spreedly.setStyle("number",t(this,L).styling.number),Spreedly.setStyle("cvv",t(this,L).styling.cvv),t(this,L).placeholder_styling&&Spreedly.setStyle("placeholder",t(this,L).placeholder_styling),t(this,L).required.number&&Spreedly.setRequiredAttribute("number"),t(this,L).required.cvv&&Spreedly.setRequiredAttribute("cvv"),t(this,L).autocomplete||Spreedly.toggleAutoComplete(),n(this,N,z).call(this,"debug","Spreedly configuration applied")}catch(e){n(this,N,z).call(this,"error","Error applying Spreedly configuration",e)}},ao=new WeakSet,rh=function(){try{n(this,N,z).call(this,"debug","Preparing HTML structure for Spreedly iframe fields");let e=document.querySelector('[os-checkout-field="cc-number"]'),i=document.querySelector('[os-checkout-field="cvv"]');if(!e||!i){n(this,N,z).call(this,"error","Could not find credit card fields");return}e.id="spreedly-number",i.id="spreedly-cvv",e.setAttribute("data-spreedly","number"),i.setAttribute("data-spreedly","cvv"),n(this,N,z).call(this,"debug","HTML structure prepared for Spreedly iframe fields - using existing DOM elements")}catch(e){n(this,N,z).call(this,"error","Error preparing HTML structure for Spreedly iframe fields",e)}},lo=new WeakSet,sh=function(){Spreedly.on("errors",e=>{n(this,N,z).call(this,"error","Spreedly validation errors:",e);let i=e.map(r=>r.message);t(this,fe)&&t(this,fe).call(this,i),n(this,is,pd).call(this,e)}),Spreedly.on("paymentMethod",(e,i)=>{n(this,N,z).call(this,"debug","Spreedly payment method created:",e),this.clearAllErrors(),t(this,zi)&&t(this,zi).call(this,e,i)}),Spreedly.on("validation",e=>{n(this,N,z).call(this,"debug","Spreedly field validation:",e),n(this,Bi,eo).call(this,e.fieldType),t(this,Di)&&t(this,Di).call(this,e)})},is=new WeakSet,pd=function(e){e.forEach(i=>{let r=i.attribute,s=null;if(r==="number"||r==="card_number"?s=document.getElementById("spreedly-number"):r==="cvv"?s=document.getElementById("spreedly-cvv"):r==="month"||r==="year"?s=document.querySelector(`[os-checkout-field="cc-${r}"]`)||document.querySelector(`[os-checkout-field="exp-${r}"]`)||document.querySelector(`#credit_card_exp_${r}`):(r==="full_name"||r==="first_name"||r==="last_name")&&(s=document.querySelector('[os-checkout-field="cc-name"]')),s){s.classList.add("error");let a=s.closest(".frm-flds")||s.parentElement,l=a.querySelector(".pb-input-error");l||(l=document.createElement("div"),l.className="pb-input-error",a.appendChild(l)),l.textContent=i.message,l.style.color="red",l.style.fontSize="0.875rem",l.style.marginTop="0.25rem"}})},Bi=new WeakSet,eo=function(e){let i=null;if(e==="number"||e==="card_number"?i=document.getElementById("spreedly-number"):e==="cvv"&&(i=document.getElementById("spreedly-cvv")),i){i.classList.remove("error");let s=(i.closest(".frm-flds")||i.parentElement).querySelector(".pb-input-error");s&&s.remove()}},N=new WeakSet,z=function(e,i,r){if(t(this,es)||e==="error"){let s="[SpreedlyManager]";r?console[e](`${s} ${i}`,r):console[e](`${s} ${i}`)}};var zt,He,li,G,Vi,Hi,co,nh,uo,oh,We=class{constructor({callback:e,logger:i}={}){o(this,co);o(this,uo);o(this,zt,["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"]);o(this,He,0);o(this,li,void 0);o(this,G,void 0);o(this,Vi,void 0);o(this,Hi,void 0);u(this,Vi,i),u(this,Hi,e),n(this,co,nh).call(this),n(this,uo,oh).call(this),t(this,Vi)&&t(this,Vi).debug("KonamiCodeHandler initialized")}static setTestMode(){return sessionStorage.setItem("konami_test_mode","true"),!0}static isTestMode(){return sessionStorage.getItem("konami_test_mode")==="true"}static clearTestMode(){sessionStorage.removeItem("konami_test_mode")}static getTestOrderData(e,i,r){try{let s=e?.cart?.items||[],a=i?i():1,l=s.length>0&&r?r(s):[{package_id:a||1,quantity:1}];return{user:{email:"test@test.com",first_name:"Test",last_name:"Order"},shipping_address:{first_name:"Test",last_name:"Order",line1:"Test Address 123",line2:"",line3:"",line4:"Tempe",state:"AZ",postcode:"85281",country:"US",phone_number:"+14807581224"},billing_address:{first_name:"Test",last_name:"Order",line1:"Test Address 123",line2:"",line3:"",line4:"Tempe",state:"AZ",postcode:"85281",country:"US",phone_number:"+14807581224"},shipping_method:1,attribution:e?.cart?.attribution||{},lines:l,success_url:window.location.origin+"/checkout/confirmation/"}}catch(s){return console.error("Error getting Konami test order data:",s),null}}static showActivationMessage(){let e=document.createElement("div");return e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.background="rgba(0, 0, 0, 0.8)",e.style.color="#fff",e.style.padding="20px",e.style.borderRadius="10px",e.style.zIndex="9999",e.style.textAlign="center",e.style.fontFamily="monospace",e.style.fontSize="18px",e.innerHTML=`
      <h3>ðŸŽ® KONAMI CODE ACTIVATED! ðŸŽ®</h3>
      <p>Creating test order with predefined data:</p>
      <p style="font-size: 14px; margin-top: 10px; text-align: left;">
        Email: test@test.com<br>
        Name: Test Order<br>
        Address: Test Address 123<br>
        City: Tempe, AZ 85281<br>
        Country: US<br>
        Phone: +14807581224<br>
        Card: 4111111111111111 (test mode)
      </p>
    `,document.body.appendChild(e),e}};zt=new WeakMap,He=new WeakMap,li=new WeakMap,G=new WeakMap,Vi=new WeakMap,Hi=new WeakMap,co=new WeakSet,nh=function(){u(this,G,document.createElement("div")),t(this,G).style.position="fixed",t(this,G).style.bottom="10px",t(this,G).style.right="10px",t(this,G).style.background="rgba(0, 0, 0, 0.7)",t(this,G).style.color="#fff",t(this,G).style.padding="5px 10px",t(this,G).style.borderRadius="5px",t(this,G).style.fontFamily="monospace",t(this,G).style.fontSize="12px",t(this,G).style.zIndex="9999",t(this,G).style.display="none",t(this,G).textContent="Konami: 0/"+t(this,zt).length,document.body.appendChild(t(this,G))},uo=new WeakSet,oh=function(){document.addEventListener("keydown",e=>{e.key===t(this,zt)[t(this,He)]?(yu(this,He)._++,t(this,He)>=4&&(t(this,G).style.display="block",t(this,G).textContent=`Konami: ${t(this,He)}/${t(this,zt).length}`),t(this,He)===t(this,zt).length&&(t(this,Hi)&&t(this,Hi).call(this),u(this,He,0),setTimeout(()=>{t(this,G).style.display="none"},500)),t(this,He)>=4&&(clearTimeout(t(this,li)),u(this,li,setTimeout(()=>{t(this,G).style.display="none"},3e3)))):t(this,He)>0&&(u(this,He,0),t(this,G).style.display==="block"&&(t(this,G).textContent=`Konami: 0/${t(this,zt).length}`,clearTimeout(t(this,li)),u(this,li,setTimeout(()=>{t(this,G).style.display="none"},1500))))})};var Oe,Gi,Ue,Z,at,vt,je,wt,Ki,Cd,Se,St,mo,ah,po,lh,di,rs,fo,ch,yo,dh,x,C,bo,uh,vo,hh,wo,gh,So,mh,_o,ph,xo,fh,Co,yh,Eo,bh,ss,fd,ns,yd,os,bd,Je,bt,ko,vh,Ao,wh,To,Sh,$o,_h,Po,xh,as,vd,Dt,Wi,ls,wd,cs,Sd,Lo,Ch,ds,_d,_t,ci,Io,Eh,qo,kh,Fo,Ah,_e,Ne,Mo,Th,us,xd,No,$h,Oo,Ph,Uo,Lh,Ro,Ih,zo,qh,Bt,ji,Yi,ho,Do,Fh,Bo,Mh,go=class{constructor(e,i,r){o(this,mo);o(this,po);o(this,di);o(this,fo);o(this,yo);o(this,x);o(this,bo);o(this,vo);o(this,wo);o(this,So);o(this,_o);o(this,xo);o(this,Co);o(this,Eo);o(this,ss);o(this,ns);o(this,os);o(this,Je);o(this,ko);o(this,Ao);o(this,To);o(this,$o);o(this,Po);o(this,as);o(this,Dt);o(this,ls);o(this,cs);o(this,Lo);o(this,ds);o(this,_t);o(this,Io);o(this,qo);o(this,Fo);o(this,_e);o(this,Mo);o(this,us);o(this,No);o(this,Oo);o(this,Uo);o(this,Ro);o(this,zo);o(this,Bt);o(this,Yi);o(this,Do);o(this,Bo);o(this,Oe,void 0);o(this,Gi,void 0);o(this,Ue,void 0);o(this,Z,void 0);o(this,at,null);o(this,vt,null);o(this,je,"credit-card");o(this,wt,!1);o(this,Ki,!1);o(this,Cd,{visa:"4111111111111111",mastercard:"5555555555554444",amex:"378282246310005",discover:"6011111111111117"});o(this,Se,{paypal:null,applePay:null,googlePay:null});o(this,St,{applePay:!1,googlePay:!1});u(this,Oe,e),u(this,Gi,i),u(this,Ue,r),u(this,Z,n(this,mo,ah).call(this)),t(this,Z)&&(n(this,po,lh).call(this),n(this,yo,dh).call(this),u(this,vt,new Oi({debugMode:t(this,Ki),logger:t(this,Gi)})),t(this,Z).__formValidator=t(this,vt),n(this,bo,uh).call(this),n(this,wo,gh).call(this),n(this,Uo,Lh).call(this),n(this,Do,Fh).call(this))}setKonamiTestMode(){return We.setTestMode(),n(this,x,C).call(this,"info","ðŸŽ® Konami code test mode activated"),!0}processPayment(){let e=We.isTestMode();if(e&&(We.clearTestMode(),n(this,x,C).call(this,"info","ðŸŽ® Processing payment in Konami test mode")),t(this,wt)){n(this,x,C).call(this,"warn","Payment already processing");return}n(this,us,xd).call(this),n(this,ns,yd).call(this),u(this,wt,!0),n(this,x,C).call(this,"debug",`Processing payment with method: ${t(this,je)}`);try{if(e){n(this,os,bd).call(this);let r=We.getTestOrderData(t(this,Ue)?.state?.getState(),n(this,as,vd).bind(this),n(this,ds,_d).bind(this));if(!r){n(this,Je,bt).call(this);return}n(this,_t,ci).call(this,{...r,payment_detail:{payment_method:"card_token",card_token:"test_card",test_card_number:"6011111111111117"}});return}if(!t(this,vt).validateAllFields(t(this,je))){u(this,wt,!1),n(this,Je,bt).call(this);return}n(this,os,bd).call(this);let i=n(this,Dt,Wi).call(this);if(!i)return;if(n(this,ss,fd).call(this)){n(this,_t,ci).call(this,{...i,payment_detail:{payment_method:"card_token",card_token:"test_card"}});return}switch(t(this,je)){case"credit-card":case"credit":n(this,ko,vh).call(this);break;case"paypal":n(this,Po,xh).call(this);break;default:n(this,_e,Ne).call(this,`Unknown payment method: ${t(this,je)}`)}}catch(i){n(this,x,C).call(this,"error","Error processing payment:",i),n(this,_e,Ne).call(this,"Unexpected error occurred"),n(this,Je,bt).call(this)}}processExpressCheckout(e){n(this,x,C).call(this,"info",`Processing ${e} express checkout`);let i;switch(e){case"paypal":i=t(this,Se).paypal;break;case"apple_pay":i=t(this,Se).applePay;break;case"google_pay":i=t(this,Se).googlePay;break;default:n(this,x,C).call(this,"error",`Unknown express checkout method: ${e}`);return}n(this,Bt,ji).call(this,i,!0);try{let r=t(this,Ue).state.getState("cart");if(!r||!r.items||r.items.length===0){n(this,x,C).call(this,"error",`Cannot process ${e} checkout: cart is empty`),n(this,Yi,ho).call(this,"Your cart is empty. Please add items to your cart before checking out.",i);return}let s={lines:r.items.map(l=>({package_id:l.id,quantity:l.quantity||1,is_upsell:!!l.is_upsell})),payment_detail:{payment_method:e},attribution:t(this,Ue).attribution?.getAttributionData()||r.attribution||{},shipping_method:(r.shippingMethod?.id||1).toString()};if(t(this,Oe)){let l=t(this,Oe).getNextPageUrlFromMeta();l?(s.success_url=l,n(this,x,C).call(this,"debug",`Express checkout success URL set from meta tag: ${l}`)):n(this,x,C).call(this,"debug","No meta tag found for express checkout success_url, API will use order_status_url")}let a=new URL(window.location.href);a.searchParams.set("payment_failed","true"),a.searchParams.set("payment_method",e),s.payment_failed_url=a.href,n(this,x,C).call(this,"debug",`Express checkout payment_failed_url set to: ${s.payment_failed_url}`),r.vouchers&&r.vouchers.length>0&&(s.vouchers=r.vouchers.map(l=>l.code||l)),n(this,x,C).call(this,"debug","Express checkout order data:",s),t(this,Oe).createOrder(s).then(l=>{if(n(this,x,C).call(this,"debug",`${e} express checkout order created:`,l),l.payment_complete_url)t(this,Ue).triggerEvent("express.checkout.started",{method:e,order:l}),window.location.href=l.payment_complete_url;else throw new Error("No payment URL returned from API")}).catch(l=>{n(this,x,C).call(this,"error",`${e} express checkout error:`,l),n(this,Yi,ho).call(this,`There was an error processing your ${e.replace("_"," ")} payment. Please try again or use a different payment method.`,i)})}catch(r){n(this,x,C).call(this,"error",`Error in ${e} express checkout:`,r),n(this,Yi,ho).call(this,"An unexpected error occurred. Please try again.",i)}}resetExpressButtons(){n(this,Bt,ji).call(this,t(this,Se).paypal,!1),n(this,Bt,ji).call(this,t(this,Se).applePay,!1),n(this,Bt,ji).call(this,t(this,Se).googlePay,!1)}};Oe=new WeakMap,Gi=new WeakMap,Ue=new WeakMap,Z=new WeakMap,at=new WeakMap,vt=new WeakMap,je=new WeakMap,wt=new WeakMap,Ki=new WeakMap,Cd=new WeakMap,Se=new WeakMap,St=new WeakMap,mo=new WeakSet,ah=function(){let e=document.querySelector('form[os-checkout="form"]')||document.querySelector("form#combo_form");return e||n(this,x,C).call(this,"warn","No checkout form found"),e},po=new WeakSet,lh=function(){t(this,Z).removeAttribute("action"),t(this,Z).setAttribute("method","post");let e=document.createElement("input");e.type="hidden",e.name="prevent_serialization",e.value="true",t(this,Z).appendChild(e),t(this,Z).addEventListener("submit",n(this,di,rs).bind(this),!0),t(this,Z).onsubmit=n(this,di,rs).bind(this),n(this,fo,ch).call(this)},di=new WeakSet,rs=function(e){return e&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()),t(this,Z).removeAttribute("action"),t(this,Z).setAttribute("method","post"),window.stop?.(),n(this,x,C).call(this,"debug","Form submission prevented"),!1},fo=new WeakSet,ch=function(){try{t(this,Z).querySelectorAll('button[type="submit"], input[type="submit"]').forEach((i,r)=>{i.setAttribute("type","button"),i.addEventListener("click",s=>{s.preventDefault(),n(this,x,C).call(this,"debug",`Submit button ${r+1} clicked`),this.processPayment()})})}catch(e){n(this,x,C).call(this,"error","Error converting submit buttons:",e)}},yo=new WeakSet,dh=function(){let e=document.querySelector('[os-checkout-payment="combo"]');if(!e){n(this,x,C).call(this,"warn","Checkout button not found");return}let i=e.cloneNode(!0);e.parentNode.replaceChild(i,e),i.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation(),t(this,Z).onsubmit=n(this,di,rs).bind(this),t(this,Z).removeAttribute("action"),t(this,Z).setAttribute("method","post"),n(this,x,C).call(this,"debug","Checkout button clicked"),setTimeout(()=>this.processPayment(),0)})},x=new WeakSet,C=function(e,i,...r){try{(t(this,Gi)?.[e]||console[e]||console.log).call(console,`[${e.toUpperCase()}] ${i}`,...r)}catch(s){console.error("Error logging:",s)}},bo=new WeakSet,uh=function(){try{let e=document.querySelector('[os-checkout-field="payment-method"]')||document.querySelector('input[name="combo_mode"]:checked');if(!e){n(this,x,C).call(this,"warn","Payment method selector not found");return}u(this,je,e.value||"credit-card"),n(this,vo,hh).call(this)}catch(e){n(this,x,C).call(this,"error","Error initializing payment methods:",e)}},vo=new WeakSet,hh=function(){let e=document.querySelectorAll('input[name="combo_mode"]'),i=r=>{u(this,je,r.target.value),n(this,x,C).call(this,"debug",`Payment method changed to: ${t(this,je)}`),document.dispatchEvent(new CustomEvent("payment-method-changed",{detail:{mode:t(this,je)}}))};e.length>0?e.forEach(r=>r.addEventListener("change",i)):document.querySelector('[os-checkout-field="payment-method"]')?.addEventListener("change",i)},wo=new WeakSet,gh=function(){try{let e=document.querySelector('meta[name="spreedly-environment-key"]')?.content||document.querySelector('meta[name="os-payment-env-key"]')?.content;if(!e){n(this,x,C).call(this,"warn","Spreedly environment key not found");return}u(this,at,new to(e,{debug:t(this,Ki),app:t(this,Ue)})),n(this,So,mh).call(this),n(this,xo,fh).call(this)}catch(e){n(this,x,C).call(this,"error","Error initializing Spreedly:",e)}},So=new WeakSet,mh=function(){t(this,at).setOnReady(()=>n(this,x,C).call(this,"debug","Spreedly ready")),t(this,at).setOnError(e=>{n(this,x,C).call(this,"error","Spreedly errors:",e),u(this,wt,!1),n(this,Je,bt).call(this);let i=n(this,_o,ph).call(this,e);n(this,_e,Ne).call(this,i)}),t(this,at).setOnPaymentMethod((e,i)=>{n(this,x,C).call(this,"debug","Spreedly payment method token received:",e),n(this,_t,ci).call(this,{payment_token:e,payment_method:"credit-card",...n(this,Dt,Wi).call(this)})})},_o=new WeakSet,ph=function(e){if(!e||e.length===0)return"An unknown error occurred with your payment method";let i={"The card number is not a valid credit card number":"Please enter a valid credit card number","Credit card number entered is not valid":"Please enter a valid credit card number","The card number is too short":"The card number you entered is too short","The card number is too long":"The card number you entered is too long","The card security code is invalid":"Please enter a valid security code (CVV)","The card security code is too short":"The security code (CVV) is too short","The card security code is too long":"The security code (CVV) is too long","The card has expired":"This card has expired. Please use a different card","The card expiration month is invalid":"Please select a valid expiration month","The card expiration year is invalid":"Please select a valid expiration year"};for(let r of e)for(let[s,a]of Object.entries(i))if(r.includes(s))return a;return e[0]},xo=new WeakSet,fh=function(){try{let[e,i]=n(this,Co,yh).call(this);n(this,Eo,bh).call(this,e,i)}catch(e){n(this,x,C).call(this,"error","Error initializing expiration fields:",e)}},Co=new WeakSet,yh=function(){let e=['[os-checkout-field="cc-month"]','[os-checkout-field="exp-month"]',"#credit_card_exp_month"],i=['[os-checkout-field="cc-year"]','[os-checkout-field="exp-year"]',"#credit_card_exp_year"];return[e.map(r=>document.querySelector(r)).find(Boolean),i.map(r=>document.querySelector(r)).find(Boolean)]},Eo=new WeakSet,bh=function(e,i){if(e){e.innerHTML='<option value="">Month</option>';for(let r=1;r<=12;r++){let s=r.toString().padStart(2,"0");e.appendChild(new Option(s,s))}}if(i){i.innerHTML='<option value="">Year</option>';let r=new Date().getFullYear();for(let s=0;s<20;s++){let a=r+s;i.appendChild(new Option(a,a))}}},ss=new WeakSet,fd=function(){return new URLSearchParams(window.location.search).get("test")==="true"||We.isTestMode()},ns=new WeakSet,yd=function(){t(this,Z)?.removeAttribute("action"),t(this,Z)?.setAttribute("method","post"),t(this,Z).onsubmit=n(this,di,rs).bind(this),t(this,Z)?.querySelectorAll('button[type="submit"], input[type="submit"]').forEach(e=>{e.disabled=!0,e.setAttribute("type","button")})},os=new WeakSet,bd=function(){let e=document.querySelector('[os-checkout-payment="combo"]');e&&(e.disabled=!0,e.classList.add("is-submitting"))},Je=new WeakSet,bt=function(){let e=document.querySelector('[os-checkout-payment="combo"]');e&&(e.disabled=!1,e.classList.remove("is-submitting")),u(this,wt,!1)},ko=new WeakSet,vh=function(){if(!t(this,at)){n(this,_e,Ne).call(this,"Credit card processing unavailable");return}let[e,i,r]=n(this,Ao,wh).call(this);if(n(this,To,Sh).call(this)||n(this,ss,fd).call(this)){n(this,$o,_h).call(this,e,i,r);return}if(!t(this,vt).validateCreditCard()&&(n(this,x,C).call(this,"debug","Credit card validation failed on initial check"),!i||!r)){u(this,wt,!1),n(this,Je,bt).call(this);return}t(this,at).tokenizeCard({full_name:e||"",month:i,year:r}),t(this,at).setOnPaymentMethod((s,a)=>{n(this,_t,ci).call(this,{payment_token:s,payment_method:"credit-card",...n(this,Dt,Wi).call(this)})})},Ao=new WeakSet,wh=function(){let e=!t(this,vt).isSameAsShipping(),i=document.querySelector(`[os-checkout-field="${e?"billing-fname":"fname"}"]`)?.value||"",r=document.querySelector(`[os-checkout-field="${e?"billing-lname":"lname"}"]`)?.value||"",s=l=>l.charAt(0).toUpperCase()+l.slice(1).toLowerCase();return[`${s(i)} ${s(r)}`.trim(),document.querySelector('[os-checkout-field="cc-month"]')?.value||document.querySelector('[os-checkout-field="exp-month"]')?.value||document.querySelector("#credit_card_exp_month")?.value||"",document.querySelector('[os-checkout-field="cc-year"]')?.value||document.querySelector('[os-checkout-field="exp-year"]')?.value||document.querySelector("#credit_card_exp_year")?.value||""]},To=new WeakSet,Sh=function(){let e=new URLSearchParams(window.location.search);return(t(this,Ki)||e.get("debug")==="true")&&e.has("test-card")},$o=new WeakSet,_h=function(e,i,r){let s=document.querySelector('[os-checkout-field="cc-number"]')?.value||document.querySelector("#credit_card_number")?.value;if(!s){n(this,_e,Ne).call(this,"Please enter a credit card number");return}n(this,_t,ci).call(this,{payment_token:`test_card_token_${Date.now()}`,payment_method:"credit-card",test_card_number:s,...n(this,Dt,Wi).call(this)})},Po=new WeakSet,xh=function(){n(this,_t,ci).call(this,{payment_method:"paypal",...n(this,Dt,Wi).call(this)})},as=new WeakSet,vd=function(){let e=new URLSearchParams(window.location.search),i=e.get("package_id")||e.get("pid");return i&&parseInt(i,10)||null},Dt=new WeakSet,Wi=function(){try{let e=n(this,ls,wd).call(this,["fname","lname","address1","address2","city","province","postal","country","phone"]),i=t(this,vt).isSameAsShipping()?null:n(this,ls,wd).call(this,["billing-fname","billing-lname","billing-address1","billing-address2","billing-city","billing-province","billing-postal","billing-country","billing-phone"]),r=n(this,cs,Sd).call(this,e),s=i?n(this,cs,Sd).call(this,i):{...r};if(!t(this,Ue)?.state)return n(this,_e,Ne).call(this,"Cart data missing"),null;let a=t(this,Ue).state.getState();return a.cart?.items?.length?{user:{email:a.user?.email||"",first_name:a.user?.firstName||r.first_name,last_name:a.user?.lastName||r.last_name},shipping_address:r,billing_address:s,shipping_method:n(this,Lo,Ch).call(this,a),attribution:a.cart.attribution||{},lines:n(this,ds,_d).call(this,a.cart.items)}:(n(this,_e,Ne).call(this,"Cart is empty"),null)}catch(e){return n(this,x,C).call(this,"error","Error getting order data:",e),n(this,_e,Ne).call(this,"Error preparing order"),null}},ls=new WeakSet,wd=function(e){let i={};return e.forEach(r=>{let s=document.querySelector(`[os-checkout-field="${r}"]`)?.value;s&&(i[r.replace("billing-","")]=s)}),i},cs=new WeakSet,Sd=function(e){return{first_name:e.fname||"",last_name:e.lname||"",line1:e.address1||"",line2:e.address2||"",line3:"",line4:e.city||"",state:e.province||"",postcode:e.postal||"",country:e.country||"",phone_number:e.phone||""}},Lo=new WeakSet,Ch=function(e){let i=e.cart?.shippingMethod;return typeof i=="number"?i:parseInt(i,10)||1},ds=new WeakSet,_d=function(e){return e.map(i=>{let r=parseInt(i.id||i.external_id,10)||n(this,as,vd).call(this);if(!r)throw new Error(`Invalid package ID for item: ${i.name}`);let s={package_id:r,quantity:i.quantity||1};return i.is_upsell===!0&&(s.is_upsell=!0,n(this,x,C).call(this,"debug",`Adding line item with is_upsell=true: ${r}`)),s})},_t=new WeakSet,ci=function(e){if(!e||!t(this,Oe)){n(this,_e,Ne).call(this,"Cannot create order"),n(this,Je,bt).call(this);return}n(this,ns,yd).call(this);let i=n(this,Io,Eh).call(this,e);t(this,Oe).createOrder(i).then(r=>n(this,No,$h).call(this,r)).catch(r=>n(this,_e,Ne).call(this,n(this,qo,kh).call(this,r))).finally(()=>n(this,Je,bt).call(this))},Io=new WeakSet,Eh=function(e){let i={...e};if(!i.success_url&&t(this,Oe)){let r=t(this,Oe).getNextPageUrlFromMeta(e.ref_id);r&&(i.success_url=r)}if(!i.payment_failed_url){let r=new URL(window.location.href);r.searchParams.set("payment_failed","true"),e.payment_method?r.searchParams.set("payment_method",e.payment_method):i.payment_detail?.payment_method&&r.searchParams.set("payment_method",i.payment_detail.payment_method),i.payment_failed_url=r.href,n(this,x,C).call(this,"debug",`Set payment_failed_url to: ${i.payment_failed_url}`)}return e.payment_token&&(i.payment_detail={card_token:e.payment_token},delete i.payment_token),e.payment_method&&(i.payment_detail=i.payment_detail||{},i.payment_detail.payment_method={"credit-card":"card_token",credit:"card_token",paypal:"paypal"}[e.payment_method]||e.payment_method,delete i.payment_method),i.shipping_method=parseInt(i.shipping_method,10)||1,i.billing_address=i.billing_address||i.shipping_address,i},qo=new WeakSet,kh=function(e){try{let i=JSON.parse(e.message);if(i?.payment_details)return n(this,Fo,Ah).call(this,i);if(i?.message)return`Order creation failed: ${Array.isArray(i.message)?i.message.map(r=>Object.entries(r).map(([s,a])=>`${s}: ${a}`).join(", ")).join(", "):Object.entries(i.message).map(([r,s])=>`${r}: ${s}`).join(", ")}`}catch{return e.message||"Unknown error"}return"Order creation failed"},Fo=new WeakSet,Ah=function(e){let i=e.payment_response_code,r=e.payment_details;return{3005:"The card number you entered is invalid. Please check and try again.",3006:"The card expiration date is invalid. Please check and try again.",3007:"The card security code (CVV) is invalid. Please check and try again.",3008:"The card has been declined. Please try another payment method.",3009:"This card has expired. Please use a different card.",3010:"The card has insufficient funds. Please try another payment method."}[i]||r||"There was a problem processing your payment. Please try again."},_e=new WeakSet,Ne=function(e){n(this,Je,bt).call(this),n(this,us,xd).call(this),t(this,je)==="credit-card"&&(e.includes("card")||e.includes("Card")||e.includes("CVV"))&&n(this,Mo,Th).call(this,e);let r=document.querySelector('[os-checkout-element="spreedly-error"]');if(r){let s=r.querySelector('[data-os-message="error"]');s&&(s.textContent=e,r.style.display="flex")}else{let s=document.querySelector('[os-checkout-element="payment-error"]');s?(s.textContent=e,s.style.display="block",s.scrollIntoView({behavior:"smooth",block:"center"})):alert(`Payment Error: ${e}`)}},Mo=new WeakSet,Th=function(e){let i='[os-checkout-field="cc-number"]',r="#credit_card_number";e.toLowerCase().includes("cvv")||e.toLowerCase().includes("security code")?(i='[os-checkout-field="cc-cvv"]',r="#credit_card_cvv"):(e.toLowerCase().includes("expiration")||e.toLowerCase().includes("expired"))&&(i='[os-checkout-field="cc-month"], [os-checkout-field="cc-year"]',r="#credit_card_exp_month, #credit_card_exp_year");let s=i.split(",").map(d=>d.trim()),a=r.split(",").map(d=>d.trim());[...s,...a].forEach(d=>{let h=document.querySelector(d);if(!h)return;let g=h.closest(".form-group")||h.parentElement;if(!g)return;h.classList.add("is-invalid");let m=g.querySelector(".invalid-feedback");m||(m=document.createElement("div"),m.className="invalid-feedback",g.appendChild(m)),m.textContent=e,m.style.display="block"});let l=document.querySelector(s[0])||document.querySelector(a[0]);l&&(l.focus(),l.scrollIntoView({behavior:"smooth",block:"center"}))},us=new WeakSet,xd=function(){['[os-checkout-field="cc-number"]',"#credit_card_number",'[os-checkout-field="cc-cvv"]',"#credit_card_cvv",'[os-checkout-field="cc-month"]',"#credit_card_exp_month",'[os-checkout-field="cc-year"]',"#credit_card_exp_year"].forEach(r=>{let s=document.querySelector(r);if(!s)return;s.classList.remove("is-invalid");let a=s.closest(".form-group")||s.parentElement;if(a){let l=a.querySelector(".invalid-feedback");l&&(l.style.display="none")}});let i=document.querySelector('[os-checkout-element="payment-error"]');i&&(i.style.display="none")},No=new WeakSet,$h=function(e){if(sessionStorage.setItem("order_reference",e.ref_id),sessionStorage.setItem(`pending_purchase_event_${e.ref_id}`,"true"),t(this,Ue)?.triggerEvent?.("order.created",e),e.payment_complete_url){n(this,x,C).call(this,"debug",`Redirecting to payment gateway: ${e.payment_complete_url}`),window.location.href=e.payment_complete_url;return}let i=n(this,Oo,Ph).call(this,e);window.location.href=i},Oo=new WeakSet,Ph=function(e){if(t(this,Oe))return t(this,Oe).getNextUrlFromOrderResponse(e);let i=document.querySelector('meta[name="os-next-page"]')?.content;if(i){let r=i.startsWith("http")?i:new URL(i,window.location.origin).href;return`${r}${r.includes("?")?"&":"?"}ref_id=${e.ref_id}`}return e.order_status_url?e.order_status_url:e.confirmation_url||`${window.location.origin}/checkout/confirmation/?ref_id=${e.ref_id}`},Uo=new WeakSet,Lh=function(){try{n(this,Ro,Ih).call(this);let e=document.querySelector('[os-checkout-payment="paypal"]');if(e&&(e.addEventListener("click",i=>{i.preventDefault(),this.processExpressCheckout("paypal")}),t(this,Se).paypal=e),t(this,St).applePay){let i=document.querySelector('[os-checkout-payment="apple-pay"]');i&&(i.addEventListener("click",r=>{r.preventDefault(),this.processExpressCheckout("apple_pay")}),t(this,Se).applePay=i)}else{let i=document.querySelector('[os-checkout-payment="apple-pay"]');i&&(i.style.display="none")}if(t(this,St).googlePay){let i=document.querySelector('[os-checkout-payment="google-pay"]');i&&(i.addEventListener("click",r=>{r.preventDefault(),this.processExpressCheckout("google_pay")}),t(this,Se).googlePay=i)}else{let i=document.querySelector('[os-checkout-payment="google-pay"]');i&&(i.style.display="none")}if(!n(this,zo,qh).call(this)){let i=document.querySelector('[os-checkout-container="express-checkout"]');i&&(i.style.display="none")}}catch(e){n(this,x,C).call(this,"error","Error initializing express checkout:",e)}},Ro=new WeakSet,Ih=function(){window.ApplePaySession&&window.ApplePaySession.canMakePayments&&(t(this,St).applePay=window.ApplePaySession.canMakePayments(),n(this,x,C).call(this,"debug",`Apple Pay support: ${t(this,St).applePay}`)),t(this,St).googlePay=!!(window.chrome&&window.chrome.runtime),n(this,x,C).call(this,"debug",`Google Pay support: ${t(this,St).googlePay}`)},zo=new WeakSet,qh=function(){return!!(t(this,Se).paypal||t(this,Se).applePay||t(this,Se).googlePay)},Bt=new WeakSet,ji=function(e,i){if(e)if(i){if(e.setAttribute("disabled","disabled"),e.classList.add("processing"),!e.dataset.originalHtml){e.dataset.originalHtml=e.innerHTML;let r=document.createElement("div");r.className="payment-btn-spinner",r.innerHTML='<div class="spinner"></div>',e.innerHTML="",e.appendChild(r)}}else e.removeAttribute("disabled"),e.classList.remove("processing"),e.dataset.originalHtml&&(e.innerHTML=e.dataset.originalHtml,delete e.dataset.originalHtml)},Yi=new WeakSet,ho=function(e,i){n(this,Bt,ji).call(this,i,!1);let r=document.querySelector(".express-checkout-wrapper");if(!r)return;let s=r.querySelector(".express-checkout-error");s||(s=document.createElement("div"),s.className="express-checkout-error",r.appendChild(s)),s.textContent=e,s.style.display="block",setTimeout(()=>{s.style.display="none"},5e3),t(this,Ue).triggerEvent("express.checkout.error",{message:e})},Do=new WeakSet,Fh=function(){try{let e=new URLSearchParams(window.location.search);if(e.get("payment_failed")==="true"){let r=e.get("payment_method"),s="Your payment could not be processed. Please try again or use a different payment method.";r&&(s=`Your ${{paypal:"PayPal",apple_pay:"Apple Pay",google_pay:"Google Pay",card_token:"credit card","credit-card":"credit card",credit:"credit card"}[r]||r} payment could not be processed. Please try again or use a different payment method.`),["paypal","apple_pay","google_pay"].includes(r)?n(this,Bo,Mh).call(this,s,r):n(this,_e,Ne).call(this,s);let l=new URL(window.location.href);l.searchParams.delete("payment_failed"),l.searchParams.delete("payment_method"),window.history.replaceState({},document.title,l.href)}}catch(e){n(this,x,C).call(this,"error","Error checking payment failed parameters:",e)}},Bo=new WeakSet,Mh=function(e,i){try{let r=document.querySelector('[os-checkout-element="top-error-banner"]');if(r){let s=r.querySelector("div");s?s.textContent=e:r.textContent=e,r.style.display="flex",r.scrollIntoView({behavior:"smooth",block:"center"})}else{r=document.createElement("div"),r.setAttribute("os-checkout-element","top-error-banner"),r.className="checkout-error-banner",r.style.width="100%",r.style.padding="12px 16px",r.style.backgroundColor="#fff3cd",r.style.color="#856404",r.style.borderRadius="4px",r.style.marginBottom="20px",r.style.border="1px solid #ffeeba",r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="space-between";let s=document.createElement("div");s.textContent=e;let a=document.createElement("button");a.textContent="Ã—",a.style.background="none",a.style.border="none",a.style.fontSize="20px",a.style.fontWeight="bold",a.style.cursor="pointer",a.style.marginLeft="10px",a.addEventListener("click",()=>{r.style.display="none"}),r.appendChild(s),r.appendChild(a);let l=t(this,Z);if(l)l.insertBefore(r,l.firstChild);else{let d=document.querySelector('[os-checkout-container="form"]')||document.querySelector(".checkout-form")||document.querySelector(".checkout-container");if(d)d.insertBefore(r,d.firstChild);else{let h=document.querySelector("main")||document.body;h.insertBefore(r,h.firstChild)}}r.scrollIntoView({behavior:"smooth",block:"center"})}n(this,x,C).call(this,"debug",`Displayed top banner error for ${i}: ${e}`)}catch(r){n(this,x,C).call(this,"error","Error displaying top banner error:",r),n(this,_e,Ne).call(this,e)}};var Ho,X,Re,q,ui,Ze,hi,xt,Ct,Xe,lt,Wo,Nh,Q,re,jo,Oh,gi,hs,ms,Ed,Go,Uh,Ko,Rh,Yo,zh,Jo,Dh,Vt,Ji,mi,gs,kd,Up,Vo=class{constructor(e){o(this,Wo);o(this,Q);o(this,jo);o(this,gi);o(this,ms);o(this,Go);o(this,Ko);o(this,Yo);o(this,Jo);o(this,Vt);o(this,mi);o(this,kd);o(this,Ho,void 0);o(this,X,void 0);o(this,Re,void 0);o(this,q,void 0);o(this,ui,{});o(this,Ze,{});o(this,hi,{fname:"billing-fname",lname:"billing-lname",address1:"billing-address1",address2:"billing-address2",city:"billing-city",province:"billing-province",postal:"billing-postal",country:"billing-country",phone:"billing-phone"});o(this,xt,!1);o(this,Ct,null);o(this,Xe,null);o(this,lt,null);u(this,Ho,e),e?.logger?typeof e.logger.debug=="function"&&typeof e.logger.info=="function"&&typeof e.logger.warn=="function"&&typeof e.logger.error=="function"?u(this,X,e.logger):u(this,X,e.logger.createModuleLogger?e.logger.createModuleLogger("BILLING"):console):u(this,X,console),n(this,Wo,Nh).call(this)}copyShippingToBilling(){try{Object.entries(t(this,ui)).forEach(([e,i])=>{let r=t(this,hi)[e],s=t(this,Ze)[r];s&&i&&(s.value=i.value,s.dispatchEvent(new Event("change",{bubbles:!0})))}),t(this,Ze)["billing-address1"]&&t(this,Ze)["billing-address1"].value&&t(this,Ze)["billing-address1"].value.length>0&&n(this,Vt,Ji).call(this),n(this,Q,re).call(this,"Copied shipping address to billing address")}catch(e){n(this,ms,Ed).call(this,"Error copying shipping to billing:",e)}}getBillingAddressData(){if(t(this,Re)&&t(this,Re).checked)return null;let e={};return Object.entries(t(this,Ze)).forEach(([i,r])=>{let s=i.replace("billing-","");e[s]=r.value}),e}isSameAsShipping(){let e=t(this,Re)?t(this,Re).checked:!0;return n(this,Q,re).call(this,`Billing address is ${e?"same as":"different from"} shipping`),e}};Ho=new WeakMap,X=new WeakMap,Re=new WeakMap,q=new WeakMap,ui=new WeakMap,Ze=new WeakMap,hi=new WeakMap,xt=new WeakMap,Ct=new WeakMap,Xe=new WeakMap,lt=new WeakMap,Wo=new WeakSet,Nh=function(){try{if(u(this,Re,document.querySelector('[os-checkout-field="same-as-shipping"]')||document.querySelector('[name="use_shipping_address"]')||document.querySelector("#use_shipping_address")),u(this,q,document.querySelector('[os-checkout-element="different-billing-address"]')),u(this,Xe,document.querySelector('[data-os-component="billing-location"]')),u(this,lt,document.querySelector('[os-checkout-field="billing-address1"]')),!t(this,Re)){n(this,gi,hs).call(this,'Same as shipping checkbox not found. Tried multiple selectors including [name="use_shipping_address"] and #use_shipping_address');let e=document.querySelectorAll('input[type="checkbox"]');n(this,Q,re).call(this,`Found ${e.length} checkboxes on the page:`),e.forEach((i,r)=>{n(this,Q,re).call(this,`Checkbox ${r+1}: id=${i.id}, name=${i.name}, class=${i.className}`)});return}if(!t(this,q))if(n(this,gi,hs).call(this,'Billing form container not found with selector [os-checkout-element="different-billing-address"]'),u(this,q,document.querySelector(".billing_form-container")),t(this,q))n(this,jo,Oh).call(this,"Found billing form container with alternative selector .billing_form-container");else return;n(this,Q,re).call(this,"BillingAddressHandler initialized"),n(this,Ko,Rh).call(this),u(this,Ct,t(this,Re).checked),n(this,mi,gs).call(this,t(this,Ct),!1),n(this,Go,Uh).call(this),n(this,Yo,zh).call(this)}catch(e){n(this,ms,Ed).call(this,"Error initializing BillingAddressHandler:",e)}},Q=new WeakSet,re=function(e,...i){typeof t(this,X).debug=="function"?t(this,X).debug(e,...i):typeof t(this,X).log=="function"&&t(this,X).log(e,...i)},jo=new WeakSet,Oh=function(e,...i){typeof t(this,X).info=="function"?t(this,X).info(e,...i):typeof t(this,X).log=="function"&&t(this,X).log(e,...i)},gi=new WeakSet,hs=function(e,...i){typeof t(this,X).warn=="function"?t(this,X).warn(e,...i):typeof t(this,X).log=="function"&&t(this,X).log(`WARNING: ${e}`,...i)},ms=new WeakSet,Ed=function(e,i){typeof t(this,X).error=="function"?t(this,X).error(e,i):typeof t(this,X).log=="function"?t(this,X).log(`ERROR: ${e}`,i):console.error(e,i)},Go=new WeakSet,Uh=function(){if(!t(this,Xe)){n(this,gi,hs).call(this,'Billing location component not found with selector [data-os-component="billing-location"]');return}if(!t(this,lt)){n(this,gi,hs).call(this,'Billing address1 field not found with selector [os-checkout-field="billing-address1"]');return}t(this,Xe).classList.add("cc-hidden"),n(this,Q,re).call(this,"Billing location component initially hidden")},Ko=new WeakSet,Rh=function(){Object.keys(t(this,hi)).forEach(e=>{let i=document.querySelector(`[os-checkout-field="${e}"]`);i&&(t(this,ui)[e]=i)}),Object.values(t(this,hi)).forEach(e=>{let i=document.querySelector(`[os-checkout-field="${e}"]`);i&&(t(this,Ze)[e]=i)}),n(this,Q,re).call(this,`Cached ${Object.keys(t(this,ui)).length} shipping fields and ${Object.keys(t(this,Ze)).length} billing fields`)},Yo=new WeakSet,zh=function(){t(this,Re).addEventListener("change",e=>{t(this,xt)||(u(this,Ct,e.target.checked),n(this,mi,gs).call(this,e.target.checked,!0),e.target.checked&&this.copyShippingToBilling(),n(this,Q,re).call(this,`Billing address changed: ${e.target.checked?"Same as shipping":"Different from shipping"}`))}),document.addEventListener("payment-method-changed",()=>{t(this,Ct)!==null&&!t(this,xt)&&(n(this,mi,gs).call(this,t(this,Ct),!1),n(this,Q,re).call(this,`Payment method changed, billing address state: ${t(this,Ct)?"Same as shipping":"Different from shipping"}`))}),document.addEventListener("location-fields-shown",()=>{t(this,Xe)&&(n(this,Vt,Ji).call(this),n(this,Q,re).call(this,"Location fields shown by AddressAutocomplete, showing billing location component as well"))}),Object.entries(t(this,ui)).forEach(([e,i])=>{i.addEventListener("change",()=>{if(t(this,Re).checked){let r=t(this,hi)[e],s=t(this,Ze)[r];s&&(s.value=i.value,s.dispatchEvent(new Event("change",{bubbles:!0})))}})}),t(this,lt)&&t(this,Xe)&&(t(this,lt).addEventListener("input",()=>{t(this,lt).value.length>=3&&n(this,Vt,Ji).call(this)}),n(this,Jo,Dh).call(this))},Jo=new WeakSet,Dh=function(){new MutationObserver(i=>{i.forEach(r=>{r.type==="attributes"&&(r.attributeName==="value"||r.attributeName==="autocomplete-value")&&t(this,lt).value.length>0&&(n(this,Vt,Ji).call(this),n(this,Q,re).call(this,"Autocomplete detected on billing address field"))})}).observe(t(this,lt),{attributes:!0,attributeFilter:["value","autocomplete-value"]}),document.addEventListener("google-places-autocomplete-filled",i=>{i.detail&&i.detail.field==="billing-address1"&&(n(this,Vt,Ji).call(this),n(this,Q,re).call(this,"Google Places autocomplete detected on billing address field"))}),n(this,Q,re).call(this,"Billing address autocomplete detection set up")},Vt=new WeakSet,Ji=function(){t(this,Xe)&&t(this,Xe).classList.contains("cc-hidden")&&(t(this,Xe).classList.remove("cc-hidden"),n(this,Q,re).call(this,"Billing location component shown"))},mi=new WeakSet,gs=function(e,i=!0){if(!t(this,q)||t(this,xt))return;u(this,xt,!0),t(this,q).style.transition||(t(this,q).style.transition="height 0.3s ease-out, opacity 0.3s ease-out");let r=s=>{s.propertyName==="height"&&(e||(t(this,q).style.height="auto"),t(this,q).style.overflow="",u(this,xt,!1),t(this,q).removeEventListener("transitionend",r),n(this,Q,re).call(this,`Billing form transition completed: ${e?"collapsed":"expanded"}`))};i?(t(this,q).removeEventListener("transitionend",r),e?(t(this,q).style.height=`${t(this,q).scrollHeight}px`,t(this,q).style.overflow="hidden",requestAnimationFrame(()=>{t(this,q).style.height="0px",t(this,q).style.opacity="0",n(this,Q,re).call(this,"Collapsing billing form")}),t(this,q).addEventListener("transitionend",r),t(this,q).addEventListener("transitionend",s=>{s.propertyName==="height"&&e&&(t(this,q).style.display="none",n(this,Q,re).call(this,"Billing form hidden after collapse"))},{once:!0})):(t(this,q).style.display="flex",t(this,q).style.height="0px",t(this,q).style.overflow="hidden",requestAnimationFrame(()=>{let s=t(this,q).scrollHeight;t(this,q).style.height=`${s}px`,t(this,q).style.opacity="1",n(this,Q,re).call(this,`Expanding billing form to height: ${s}px`)}),t(this,q).addEventListener("transitionend",r))):(t(this,q).style.display=e?"none":"flex",t(this,q).style.height=e?"0":"auto",t(this,q).style.opacity=e?"0":"1",t(this,q).style.overflow="",u(this,xt,!1),n(this,Q,re).call(this,`Set billing form without animation: ${e?"hidden":"visible"}`))},kd=new WeakSet,Up=function(){n(this,mi,gs).call(this,t(this,Re).checked,!1)};var Ht,pi,Zi,Xi,Wt,Xo,Qo,Bh,ps,Ad,Zo=class{constructor(e){o(this,Qo);o(this,ps);o(this,Ht,void 0);o(this,pi,void 0);o(this,Zi,void 0);o(this,Xi,void 0);o(this,Wt,new Map);o(this,Xo,null);u(this,Ht,e),u(this,pi,document.querySelector("[os-payment-mode]")),u(this,Zi,document.querySelectorAll('input[name="combo_mode"]')),u(this,Xi,document.querySelectorAll('[os-checkout-element$="-form"]')),t(this,pi)&&t(this,Zi).length>0?(t(this,Ht).debug("PaymentSelector initialized with elements found"),n(this,Qo,Bh).call(this)):t(this,Ht).warn("PaymentSelector elements not found")}};Ht=new WeakMap,pi=new WeakMap,Zi=new WeakMap,Xi=new WeakMap,Wt=new WeakMap,Xo=new WeakMap,Qo=new WeakSet,Bh=function(){let e=document.querySelector('input[name="combo_mode"]:checked');e&&t(this,pi)&&n(this,ps,Ad).call(this,e.value,!1),t(this,Zi).forEach(i=>i.addEventListener("change",r=>n(this,ps,Ad).call(this,r.target.value,!0))),t(this,Ht).debug("PaymentSelector event listeners attached")},ps=new WeakSet,Ad=function(e,i=!0){t(this,Ht).debug(`Setting payment mode to: ${e}, animate: ${i}`),t(this,pi)?.setAttribute("os-payment-mode",e),u(this,Xo,e),t(this,Xi).forEach(r=>{r.style.transition="none",r.offsetHeight,r.style.transition=""}),t(this,Xi).forEach(r=>{let a=r.getAttribute("os-checkout-element")===`${e}-form`;if(t(this,Wt).has(r)){let l=t(this,Wt).get(r);r.removeEventListener("transitionend",l),t(this,Wt).delete(r)}if(i){r.style.display="block",r.style.overflow="hidden";let l=r.scrollHeight;r.style.height=`${l}px`,r.offsetHeight;let d=h=>{h.propertyName==="height"&&(a?(r.style.height="auto",r.style.overflow=""):r.style.display="none",t(this,Wt).delete(r))};t(this,Wt).set(r,d),r.addEventListener("transitionend",d,{once:!0}),requestAnimationFrame(()=>{r.style.height=a?`${r.scrollHeight}px`:"0",r.style.opacity=a?"1":"0"})}else r.style.transition="none",Object.assign(r.style,{display:a?"block":"none",height:a?"auto":"0",opacity:a?"1":"0",overflow:""}),r.offsetHeight,r.style.transition=""}),document.dispatchEvent(new CustomEvent("payment-method-changed",{detail:{mode:e}}))};var ae,Qi,Qe,yi,ta,Vh,ia,Hh,Et,fi,ra,Wh,ys,Td,sa,jh,na,Gh,bs,$d,bi,fs,oa,Kh,ea=class{constructor(e,i={}){o(this,ta);o(this,ia);o(this,Et);o(this,ra);o(this,ys);o(this,sa);o(this,na);o(this,bs);o(this,bi);o(this,oa);o(this,ae,void 0);o(this,Qi,!1);o(this,Qe,void 0);o(this,yi,void 0);u(this,ae,e),u(this,yi,i.enableGoogleMapsAutocomplete!==!1),u(this,Qe,{shipping:{address:document.querySelector('[os-checkout-field="address1"]'),city:document.querySelector('[os-checkout-field="city"]'),state:document.querySelector('[os-checkout-field="province"]'),zip:document.querySelector('[os-checkout-field="postal"]'),country:document.querySelector('[os-checkout-field="country"]')},billing:{address:document.querySelector('[os-checkout-field="billing-address1"]'),city:document.querySelector('[os-checkout-field="billing-city"]'),state:document.querySelector('[os-checkout-field="billing-province"]'),zip:document.querySelector('[os-checkout-field="billing-postal"]'),country:document.querySelector('[os-checkout-field="billing-country"]')},locations:document.querySelectorAll('[data-os-component="location"]')}),t(this,ae).info(`AddressAutocomplete initialized (autocomplete ${t(this,yi)?"enabled":"disabled"})`),n(this,ia,Hh).call(this),n(this,ta,Vh).call(this)}};ae=new WeakMap,Qi=new WeakMap,Qe=new WeakMap,yi=new WeakMap,ta=new WeakSet,Vh=async function(){if(n(this,oa,Kh).call(this),!t(this,yi))return t(this,ae).debug("Google Maps autocomplete disabled, using basic field listeners"),n(this,bi,fs).call(this);await n(this,ys,Td).call(this)},ia=new WeakSet,Hh=function(){t(this,Qi)||(t(this,Qe).locations.forEach(e=>e.classList.add("cc-hidden")),t(this,ae).debug("Location fields hidden"))},Et=new WeakSet,fi=function(){t(this,Qi)||(t(this,Qe).locations.forEach(e=>e.classList.remove("cc-hidden")),u(this,Qi,!0),document.dispatchEvent(new CustomEvent("location-fields-shown")),t(this,ae).debug("Location fields shown"))},ra=new WeakSet,Wh=function(){return!!window.google?.maps?.places},ys=new WeakSet,Td=async function(e=0){return t(this,yi)?n(this,ra,Wh).call(this)?(t(this,ae).debug("Google Maps API available"),n(this,sa,jh).call(this)):e>=3?(t(this,ae).warn("Google Maps API unavailable after 3 attempts"),n(this,bi,fs).call(this)):(t(this,ae).debug(`Retrying Google Maps check, attempt ${e+1}`),await new Promise(i=>setTimeout(i,1e3*1.5**e)),n(this,ys,Td).call(this,e+1)):n(this,bi,fs).call(this)},sa=new WeakSet,jh=function(){let{shipping:e,billing:i}=t(this,Qe);[e,i].forEach(r=>{r.address&&(n(this,na,Gh).call(this,r.address,r),t(this,ae).debug(`Autocomplete set up for ${r.address.getAttribute("os-checkout-field")}`))})},na=new WeakSet,Gh=function(e,i){try{let r=new google.maps.places.Autocomplete(e,{types:["address"],fields:["address_components","formatted_address"]});r.addListener("place_changed",()=>{let s=r.getPlace();if(!s.address_components)return;n(this,Et,fi).call(this);let a=Object.fromEntries(s.address_components.map(l=>[l.types[0],{long:l.long_name,short:l.short_name}]));if(i.address.value=[a.street_number?.long,a.route?.long].filter(Boolean).join(" "),i.city&&(i.city.value=a.locality?.long??""),i.zip&&(i.zip.value=a.postal_code?.long??""),i.country&&a.country){let l=a.country.short;i.country.value!==l&&(i.country.value=l,i.country.dispatchEvent(new Event("change",{bubbles:!0})),t(this,ae).debug(`Country set to ${l}`)),i.state&&a.administrative_area_level_1&&n(this,bs,$d).call(this,i.state,a.administrative_area_level_1.short)}[i.address,i.city,i.zip].forEach(l=>l?.dispatchEvent(new Event("change",{bubbles:!0})))}),e.addEventListener("blur",()=>e.value.length>10&&n(this,Et,fi).call(this)),e.addEventListener("keydown",s=>s.key==="Enter"&&s.preventDefault())}catch(r){t(this,ae).error("Autocomplete setup failed:",r),n(this,bi,fs).call(this)}},bs=new WeakSet,$d=async function(e,i,r=0){if(r>=5){t(this,ae).warn(`Failed to set state ${i} after 5 attempts`);return}await new Promise(a=>setTimeout(a,300*1.5**r)),Array.from(e.options).some(a=>a.value===i)?(e.value=i,e.dispatchEvent(new Event("change",{bubbles:!0})),t(this,ae).debug(`State set to ${i}`)):n(this,bs,$d).call(this,e,i,r+1)},bi=new WeakSet,fs=function(){[t(this,Qe).shipping.address,t(this,Qe).billing.address].forEach(e=>{e?.addEventListener("blur",()=>e.value.length>10&&n(this,Et,fi).call(this))}),t(this,ae).debug("Basic field listeners set up")},oa=new WeakSet,Kh=function(){let e=document.createElement("style");e.textContent=`
        @keyframes onAutoFillStart { from { opacity: 0.99; } to { opacity: 1; } }
        input:-webkit-autofill { animation-name: onAutoFillStart; }
      `,document.head.appendChild(e),[t(this,Qe).shipping.address,t(this,Qe).billing.address].filter(Boolean).forEach(r=>{r.addEventListener("input",()=>r.value.length>10&&n(this,Et,fi).call(this)),r.addEventListener("change",()=>r.value.length>0&&n(this,Et,fi).call(this)),r.addEventListener("animationstart",s=>{s.animationName==="onAutoFillStart"&&(t(this,ae).debug(`Autofill detected on ${r.getAttribute("os-checkout-field")}`),n(this,Et,fi).call(this))})}),t(this,ae).debug("Autofill detection initialized")};var xe,er,la,Yh,vs,Pd,ca,Jh,da,Zh,ws,Ld,Ss,Id,ua,Xh,ha,Qh,aa=class{constructor(e){o(this,la);o(this,vs);o(this,ca);o(this,da);o(this,ws);o(this,Ss);o(this,ua);o(this,ha);o(this,xe,void 0);o(this,er,!!window.intlTelInput);u(this,xe,e),t(this,er)?(t(this,xe).info("intlTelInput available, initializing phone inputs"),n(this,vs,Pd).call(this)):(t(this,xe).warn("intlTelInput not found, loading dynamically"),n(this,la,Yh).call(this).then(()=>n(this,vs,Pd).call(this)))}};xe=new WeakMap,er=new WeakMap,la=new WeakSet,Yh=async function(){let e=[{tag:"link",rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css"},{tag:"script",src:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js",async:!0},{tag:"script",src:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",async:!0}];await Promise.all(e.map(({tag:i,...r})=>{let s=document.createElement(i);return Object.assign(s,r),document.head.appendChild(s),i==="link"?Promise.resolve():new Promise(a=>s.onload=a)})),u(this,er,!0),t(this,xe).debug("intlTelInput and utils loaded")},vs=new WeakSet,Pd=function(){if(!t(this,er))return;let e=document.querySelectorAll('input[type="tel"]');t(this,xe).info(`Found ${e.length} phone inputs`),e.forEach((i,r)=>n(this,ca,Jh).call(this,i,r+1))},ca=new WeakSet,Jh=function(e,i){try{let r=window.intlTelInput(e,{utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",separateDialCode:!0,onlyCountries:["us"],initialCountry:"us",allowDropdown:!1,dropdownContainer:document.body,useFullscreenPopup:!0,formatOnDisplay:!0,autoPlaceholder:"aggressive",customContainer:"iti-tel-input",autoFormat:!0,nationalMode:!0});e.iti=r,t(this,xe).debug(`Phone input ${i} (${e.getAttribute("os-checkout-field")??"unknown"}) initialized`),n(this,ua,Xh).call(this,e,r),n(this,ha,Qh).call(this,e,r),e.addEventListener("input",()=>{let s=e.value.trim();if(s){let h=s.replace(/\D/g,""),g="";if(h.length>0&&(h.length<=3?g=`(${h}`:h.length<=6?g=`(${h.slice(0,3)}) ${h.slice(3)}`:g=`(${h.slice(0,3)}) ${h.slice(3,6)}-${h.slice(6,10)}`),e.value!==g){let m=e.selectionStart,p=e.value.length;if(e.value=g,m!==null){let b=g.length-p;e.setSelectionRange(m+b,m+b)}}}let a=r.isValidNumber(),l=r.getNumberType(),d=r.getValidationError();if(!s){n(this,ws,Ld).call(this,e);return}console.group("Phone Number Validation"),r.getNumber(),n(this,Ss,Id).call(this,l),console.groupEnd(),t(this,xe).debug("Phone validation:",{number:s,isValid:a,formattedNumber:r.getNumber(),type:n(this,Ss,Id).call(this,l),error:d})}),e.addEventListener("blur",()=>{let s=e.value.trim();if(s){let a=r.isValidNumber();a&&(e.value=r.getNumber(intlTelInputUtils.numberFormat.NATIONAL)),r.getNumber(),a?n(this,ws,Ld).call(this,e):n(this,da,Zh).call(this,e,"Please enter a valid US phone number (e.g. 555-555-5555)")}})}catch(r){t(this,xe).error(`Error initializing phone input ${i}:`,r)}},da=new WeakSet,Zh=function(e,i){e.classList.add("error");let r=e.closest(".iti");r&&(r.classList.add("error"),r.style.border="1px solid red");let s=e.closest(".frm-flds")||e.closest(".form-group"),a=s.querySelector(".pb-input-error");a||(a=document.createElement("div"),a.className="pb-input-error",s.appendChild(a)),a.textContent=i,Object.assign(a.style,{color:"red",fontSize:"0.875rem",marginTop:"0.25rem",display:"block",position:"relative",clear:"both"})},ws=new WeakSet,Ld=function(e){e.classList.remove("error");let i=e.closest(".iti");i&&(i.classList.remove("error"),i.style.border="");let s=(e.closest(".frm-flds")||e.closest(".form-group")).querySelector(".pb-input-error");s&&s.remove()},Ss=new WeakSet,Id=function(e){return{0:"FIXED_LINE",1:"MOBILE",2:"FIXED_LINE_OR_MOBILE",3:"TOLL_FREE",4:"PREMIUM_RATE",5:"SHARED_COST",6:"VOIP",7:"PERSONAL_NUMBER",8:"PAGER",9:"UAN",10:"UNKNOWN"}[e]||"UNKNOWN"},ua=new WeakSet,Xh=function(e,i){let r=e.getAttribute("os-checkout-field");if(!r){t(this,xe).warn("Phone input missing os-checkout-field attribute");return}let s=document.querySelector(r==="phone"?'[os-checkout-field="country"]':'[os-checkout-field="billing-country"]');if(!s){t(this,xe).warn(`Country select not found for ${r}`);return}s.value!=="US"&&(s.value="US",s.dispatchEvent(new Event("change",{bubbles:!0})),t(this,xe).debug("Country select updated to US"))},ha=new WeakSet,Qh=function(e,i){e.validatePhone=()=>e.value.trim()?i.isValidNumber():!e.hasAttribute("required"),e.getFormattedNumber=()=>i.getNumber(),e.closest("form")?.addEventListener("submit",()=>{e.value.trim()&&i.isValidNumber()&&(e.value=i.getNumber(),t(this,xe).debug(`Formatted phone number set to ${e.value} on submit`))})};var ee,E,fa,tr,ct,dt,jt,ya,ir,rr,f,ba,va,eg,wa,tg,Sa,ig,sr,ga,_a,rg,xa,sg,Ca,ng,Ea,og,ka,ag,Aa,lg,Ta,cg,$a,dg,Pa,ug,nr,ma,_s,qd,La,hg,pa=class{constructor(e){o(this,va);o(this,wa);o(this,Sa);o(this,sr);o(this,_a);o(this,xa);o(this,Ca);o(this,Ea);o(this,ka);o(this,Aa);o(this,Ta);o(this,$a);o(this,Pa);o(this,nr);o(this,_s);o(this,La);o(this,ee,void 0);o(this,E,void 0);o(this,fa,!1);o(this,tr,!1);o(this,ct,!1);o(this,dt,!1);o(this,jt,null);o(this,ya,3e3);o(this,ir,null);o(this,rr,{firstName:'[os-checkout-field="fname"]',lastName:'[os-checkout-field="lname"]',email:'[os-checkout-field="email"]',phone:'[os-checkout-field="phone"]',address1:'[os-checkout-field="address1"]',address2:'[os-checkout-field="address2"]',city:'[os-checkout-field="city"]',province:'[os-checkout-field="province"]',postal:'[os-checkout-field="postal"]',country:'[os-checkout-field="country"]'});o(this,f,{firstName:null,lastName:null,email:null,phone:null,address1:null,address2:null,city:null,province:null,postal:null,country:null});o(this,ba,/^[^\s@]+@[^\s@]+\.[^\s@]+$/);u(this,ee,e),t(this,ee)&&t(this,ee).logger?u(this,E,t(this,ee).logger.createModuleLogger("PROSPECT")):u(this,E,{debug:(i,r)=>console.log(`[PROSPECT DEBUG] ${i}`,r!==void 0?r:""),info:(i,r)=>console.info(`[PROSPECT INFO] ${i}`,r!==void 0?r:""),warn:(i,r)=>console.warn(`[PROSPECT WARN] ${i}`,r!==void 0?r:""),error:(i,r)=>console.error(`[PROSPECT ERROR] ${i}`,r!==void 0?r:"")}),n(this,va,eg).call(this)}triggerBeginCheckout(){return t(this,ee)&&t(this,ee).events?t(this,dt)?(t(this,E).debug("beginCheckout event already fired, skipping"),!1):(t(this,E).info("Manually triggering beginCheckout event"),t(this,ee).events.beginCheckout(),u(this,dt,!0),!0):(t(this,E).warn("Cannot trigger beginCheckout event: Events manager not available"),!1)}resetBeginCheckoutFlag(){return u(this,dt,!1),t(this,E).debug("Reset beginCheckout flag"),!0}};ee=new WeakMap,E=new WeakMap,fa=new WeakMap,tr=new WeakMap,ct=new WeakMap,dt=new WeakMap,jt=new WeakMap,ya=new WeakMap,ir=new WeakMap,rr=new WeakMap,f=new WeakMap,ba=new WeakMap,va=new WeakSet,eg=function(){t(this,E).info("Initializing ProspectCartHandler"),n(this,wa,tg).call(this),t(this,f).email&&(t(this,f).firstName||t(this,f).lastName)?(n(this,Sa,ig).call(this),u(this,fa,!0),t(this,E).info("ProspectCartHandler initialized successfully")):t(this,E).warn("Required form fields not found, ProspectCartHandler not initialized")},wa=new WeakSet,tg=function(){Object.keys(t(this,rr)).forEach(e=>{if(t(this,f)[e]=document.querySelector(t(this,rr)[e]),!t(this,f)[e]){let i=t(this,rr)[e].replace("os-checkout-field","data-os-field");t(this,f)[e]=document.querySelector(i)}t(this,f)[e]?t(this,E).debug(`Found ${e} field`):t(this,E).debug(`${e} field not found`)})},Sa=new WeakSet,ig=function(){t(this,f).email&&t(this,f).email.addEventListener("blur",()=>n(this,sr,ga).call(this)),t(this,f).firstName&&t(this,f).firstName.addEventListener("blur",()=>n(this,sr,ga).call(this)),t(this,f).lastName&&t(this,f).lastName.addEventListener("blur",()=>n(this,sr,ga).call(this));let e=document.querySelector('form[os-checkout="form"]');e&&e.addEventListener("submit",()=>{u(this,ct,!0),t(this,jt)&&clearTimeout(t(this,jt))}),t(this,E).debug("Event listeners attached to form fields")},sr=new WeakSet,ga=function(){t(this,tr)||t(this,ct)||(t(this,jt)&&clearTimeout(t(this,jt)),n(this,_a,rg).call(this),u(this,jt,setTimeout(()=>{n(this,xa,sg).call(this)},t(this,ya))))},_a=new WeakSet,rg=function(){if(t(this,dt))return;let e=t(this,f).email&&t(this,f).email.value&&t(this,f).email.value.trim().length>0,i=t(this,f).firstName&&t(this,f).firstName.value&&t(this,f).firstName.value.trim().length>0||t(this,f).lastName&&t(this,f).lastName.value&&t(this,f).lastName.value.trim().length>0;(e||i)&&(t(this,E).debug("User has started entering checkout information, firing beginCheckout event"),t(this,ee).events&&(t(this,ee).events.beginCheckout(),u(this,dt,!0),t(this,E).info("beginCheckout event fired")))},xa=new WeakSet,sg=function(){if(t(this,tr)||t(this,ct)){t(this,E).debug("Cart already created or attempted, skipping");return}if(!n(this,Ca,ng).call(this)){t(this,E).debug("Not enough information to create a cart");return}let e=n(this,Ea,og).call(this);if(t(this,ir)&&n(this,ka,ag).call(this,e,t(this,ir))){t(this,E).debug("Form data has not changed since last attempt, skipping");return}u(this,ir,e),u(this,ct,!0),n(this,Aa,lg).call(this)},Ca=new WeakSet,ng=function(){if(!(t(this,f).email&&t(this,f).email.value&&t(this,ba).test(t(this,f).email.value)))return t(this,E).debug("Email is missing or invalid"),!1;let i=t(this,f).firstName&&t(this,f).firstName.value&&t(this,f).firstName.value.trim().length>=2,r=t(this,f).lastName&&t(this,f).lastName.value&&t(this,f).lastName.value.trim().length>=2;return!i&&!r?(t(this,E).debug("First name and last name are missing or too short"),!1):(t(this,E).debug("Minimum required fields are present"),!0)},Ea=new WeakSet,og=function(){let e={};return Object.keys(t(this,f)).forEach(i=>{t(this,f)[i]&&(e[i]=t(this,f)[i].value)}),e},ka=new WeakSet,ag=function(e,i){return e.email===i.email&&e.firstName===i.firstName&&e.lastName===i.lastName},Aa=new WeakSet,lg=function(){t(this,E).info("Creating prospect cart");let e=t(this,ee).state.getState("cart");if(!e||!e.items||e.items.length===0){t(this,E).warn("No cart items available, skipping cart creation"),u(this,ct,!1);return}let i=e.attribution||{};t(this,E).debug("Using attribution data from state",i);let r=t(this,f).firstName?t(this,f).firstName.value:"",s=t(this,f).lastName?t(this,f).lastName.value:"",a=t(this,f).email?t(this,f).email.value:"",l=n(this,_s,qd).call(this);n(this,Ta,cg).call(this,a,r,s,l);let d={lines:e.items.map(g=>{let m={package_id:g.id,quantity:g.quantity||1};return g.is_upsell===!0&&(m.is_upsell=!0,t(this,E).debug(`Adding upsell item to prospect cart: ${g.id}`)),m}),user:{first_name:r,last_name:s,email:a},attribution:i};l?d.user.phone_number=l:t(this,E).warn("Invalid phone number format - sending cart without phone number"),e.shippingMethod&&(d.shipping_method=e.shippingMethod.code||e.shippingMethod.id);let h=n(this,Pa,ug).call(this);h&&Object.keys(h).length>0?n(this,$a,dg).call(this,h)?(t(this,E).debug("Adding valid address data to cart"),d.address=h):t(this,E).info("Address data is incomplete or invalid - sending cart with user info only"):t(this,E).debug("No address data available - sending cart with user info only"),n(this,La,hg).call(this,d)},Ta=new WeakSet,cg=function(e,i,r,s){if(!t(this,ee).state){t(this,E).warn("State manager not available, cannot update user state");return}try{let a=t(this,ee).state.getState("user")||{},l={...a,email:e||a.email,firstName:i||a.firstName,lastName:r||a.lastName,phone:s||a.phone};t(this,ee).state.setState("user",l),t(this,E).debug("Updated user state with user information",l)}catch(a){t(this,E).error("Error updating user state:",a)}},$a=new WeakSet,dg=function(e){return e.country==="US"&&(!e.postcode||!n(this,nr,ma).call(this,e.postcode,"US"))?(t(this,E).warn("US address requires a valid postal code"),!1):!0},Pa=new WeakSet,ug=function(){let e=t(this,f).country&&t(this,f).country.value?t(this,f).country.value:"",i=t(this,f).postal&&t(this,f).postal.value?t(this,f).postal.value:"";if(e==="US"&&i&&!n(this,nr,ma).call(this,i,e))return t(this,E).warn(`Invalid postal code for US: ${i} - omitting all address data`),null;let r={};t(this,f).firstName&&t(this,f).firstName.value&&(r.first_name=t(this,f).firstName.value),t(this,f).lastName&&t(this,f).lastName.value&&(r.last_name=t(this,f).lastName.value);let s=n(this,_s,qd).call(this);return s&&(r.phone_number=s),t(this,f).address1&&t(this,f).address1.value&&(r.line1=t(this,f).address1.value),t(this,f).address2&&t(this,f).address2.value&&(r.line2=t(this,f).address2.value),t(this,f).city&&t(this,f).city.value&&(r.line4=t(this,f).city.value),t(this,f).province&&t(this,f).province.value&&(r.state=t(this,f).province.value),e&&(r.country=e),i&&(!e||n(this,nr,ma).call(this,i,e))&&(r.postcode=i),r},nr=new WeakSet,ma=function(e,i){if(!e||!i)return!0;switch(i.toUpperCase()){case"US":return/^\d{5}(-\d{4})?$/.test(e);case"CA":return/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/.test(e);case"GB":case"UK":return/^[A-Z]{1,2}[0-9][A-Z0-9]? ?[0-9][A-Z]{2}$/i.test(e);case"AU":return/^\d{4}$/.test(e);case"NZ":return/^\d{4}$/.test(e);case"DE":return/^\d{5}$/.test(e);case"FR":return/^\d{5}$/.test(e);default:return e.trim().length>0}},_s=new WeakSet,qd=function(){if(!t(this,f).phone)return"";if(t(this,f).phone.iti&&typeof t(this,f).phone.iti.getNumber=="function"){let r=t(this,f).phone.iti.getNumber();return t(this,f).phone.iti.isValidNumber()?r:""}let e=t(this,f).phone.value;return e&&/^\+?[1-9]\d{1,14}$/.test(e.replace(/\D/g,""))?e:""},La=new WeakSet,hg=function(e){if(!t(this,ee).api||typeof t(this,ee).api.createCart!="function"){t(this,E).error("API client not available"),u(this,ct,!1);return}t(this,E).debug("Sending cart data to API",e),t(this,ee).api.createCart(e).then(i=>{t(this,E).info("Prospect cart created successfully",i),u(this,tr,!0),t(this,ee).events&&(t(this,ee).events.trigger("prospect.cartCreated",{cart:i}),t(this,dt)?t(this,E).debug("beginCheckout event already fired, skipping"):(t(this,E).info("Triggering beginCheckout event for analytics"),t(this,ee).events.beginCheckout(),u(this,dt,!0)))}).catch(i=>{t(this,E).error("Error creating prospect cart",i),u(this,ct,!1)})};var xs,v,O,Ce,qa,Fa,gg,Ma,mg,Na,pg,Oa,fg,Ua,yg,Ra,bg,za,vg,Da,wg,Ba,Sg,Va,_g,Ha,xg,Wa,Cg,ja,Eg,Ga,kg,Ka,Ag,Ia=class{constructor(e,i,r){o(this,Fa);o(this,Ma);o(this,Na);o(this,Oa);o(this,Ua);o(this,Ra);o(this,za);o(this,Da);o(this,Ba);o(this,Va);o(this,Ha);o(this,Wa);o(this,ja);o(this,Ga);o(this,Ka);o(this,xs,void 0);o(this,v,void 0);o(this,O,void 0);o(this,Ce,void 0);o(this,qa,void 0);if(u(this,xs,e),u(this,v,i),u(this,Ce,r),u(this,O,document.querySelector('form[os-checkout="form"]')||document.querySelector("form#combo_form")),!t(this,O)){t(this,v).warn('No checkout form found with [os-checkout="form"] selector or form#combo_form');return}t(this,O).removeAttribute("action"),t(this,O).setAttribute("method","post"),t(this,O).setAttribute("novalidate","novalidate");let s=document.createElement("input");s.type="hidden",s.name="js_enabled",s.value="true",t(this,O).appendChild(s);let a=document.createElement("input");a.type="hidden",a.name="prevent_serialization",a.value="true",t(this,O).appendChild(a);let l=d=>(d&&(d.preventDefault(),d.stopPropagation(),d.stopImmediatePropagation()),t(this,O).removeAttribute("action"),t(this,O).setAttribute("method","post"),typeof window.stop=="function"&&window.stop(),t(this,v).debug("Form direct submission prevented"),!1);t(this,O).addEventListener("submit",l,!0),t(this,O).onsubmit=l,n(this,Ka,Ag).call(this),t(this,v).debug("CheckoutPage initialized with form found"),n(this,Fa,gg).call(this),n(this,Ma,mg).call(this)}};xs=new WeakMap,v=new WeakMap,O=new WeakMap,Ce=new WeakMap,qa=new WeakMap,Fa=new WeakSet,gg=function(){try{n(this,Wa,Cg).call(this),n(this,Oa,fg).call(this),n(this,Ua,yg).call(this),n(this,Ra,bg).call(this),n(this,za,vg).call(this),n(this,Da,wg).call(this),n(this,Ba,Sg).call(this),n(this,Va,_g).call(this),n(this,Ha,xg).call(this),n(this,ja,Eg).call(this),document.dispatchEvent(new CustomEvent("os:checkout.ready",{detail:{checkoutPage:this}})),t(this,v).info("Checkout page components initialized successfully")}catch(e){t(this,v).error("Error initializing checkout components",e)}},Ma=new WeakSet,mg=function(){try{u(this,qa,new We({callback:()=>n(this,Na,pg).call(this),logger:t(this,v)})),t(this,v).debug("Konami code handler initialized")}catch(e){t(this,v).error("Error initializing Konami code handler:",e)}},Na=new WeakSet,pg=function(){try{t(this,v).info("ðŸŽ® Konami code activated! Creating test order...");let e=We.showActivationMessage();setTimeout(()=>{document.body.removeChild(e),this.paymentHandler?(We.setTestMode(),this.paymentHandler.processPayment(),t(this,v).info("Konami code test order initiated")):(t(this,v).error("Payment handler not initialized, cannot create test order"),alert("Could not create test order: Payment handler not initialized"))},2e3)}catch(e){t(this,v).error("Error triggering Konami code Easter egg:",e)}},Oa=new WeakSet,fg=function(){try{this.addressHandler=new En(t(this,O),t(this,v))}catch(e){t(this,v).error("Error initializing AddressHandler",e)}},Ua=new WeakSet,yg=function(){try{this.billingAddressHandler=new Vo(t(this,Ce)),t(this,O)&&this.billingAddressHandler&&(t(this,O).__billingAddressHandler=this.billingAddressHandler,t(this,v).debug("BillingAddressHandler initialized and attached to form"))}catch(e){t(this,v).error("Error initializing BillingAddressHandler",e)}},Ra=new WeakSet,bg=function(){try{this.paymentSelector=new Zo(t(this,v))}catch(e){t(this,v).error("Error initializing PaymentSelector",e)}},za=new WeakSet,vg=function(){try{this.formValidator=new Oi({debugMode:window.location.search.includes("debug=true"),logger:t(this,v)}),t(this,O)&&this.formValidator&&(t(this,O).__formValidator=this.formValidator,t(this,v).debug("FormValidator initialized and attached to form"))}catch(e){t(this,v).error("Error initializing FormValidator",e)}},Da=new WeakSet,wg=function(){try{this.paymentHandler=new go(t(this,xs),t(this,v),t(this,Ce))}catch(e){t(this,v).error("Error initializing PaymentHandler",e)}},Ba=new WeakSet,Sg=function(){try{let e={enableGoogleMapsAutocomplete:t(this,Ce).options.enableGoogleMapsAutocomplete};this.addressAutocomplete=new ea(t(this,v),e)}catch(e){t(this,v).error("Error initializing AddressAutocomplete",e)}},Va=new WeakSet,_g=function(){try{this.phoneInputHandler=new aa(t(this,v))}catch(e){t(this,v).error("Error initializing PhoneInputHandler",e)}},Ha=new WeakSet,xg=function(){try{t(this,Ce)?(this.prospectCartHandler=new pa(t(this,Ce)),t(this,v).info("ProspectCartHandler initialized")):t(this,v).warn("App instance not provided, ProspectCartHandler not initialized")}catch(e){t(this,v).error("Error initializing ProspectCartHandler",e)}},Wa=new WeakSet,Cg=function(){try{t(this,v).info("Fixing billing form by duplicating shipping form");let e=document.querySelector('[os-checkout-component="shipping-form"]'),i=document.querySelector('[os-checkout-component="billing-form"]');if(e&&i){t(this,v).info("Found shipping form and billing container");let r=e.cloneNode(!0),s={fname:"billing-fname",lname:"billing-lname",address1:"billing-address1",address2:"billing-address2",city:"billing-city",province:"billing-province",postal:"billing-postal",country:"billing-country",phone:"billing-phone"};r.querySelectorAll("input, select").forEach(l=>{let d=l.getAttribute("os-checkout-field");d&&s[d]&&(l.setAttribute("os-checkout-field",s[d]),l.id&&(l.id="billing_"+l.id),l.name&&(l.name="billing_"+l.name),l.getAttribute("data-name")&&l.setAttribute("data-name","Billing "+l.getAttribute("data-name")),l.getAttribute("autocomplete")&&l.setAttribute("autocomplete","billing "+l.getAttribute("autocomplete")))});let a=r.querySelector('[data-os-component="location"]');a&&a.setAttribute("data-os-component","billing-location"),i.innerHTML="",i.appendChild(r),t(this,v).info("Billing form successfully created from shipping form")}else{t(this,v).warn("Could not fix billing form - shipping form or billing container not found"),t(this,v).warn(`Shipping form found: ${!!e}, Billing container found: ${!!i}`);let r=document.querySelectorAll("[os-checkout-component]");t(this,v).warn(`Found ${r.length} checkout components:`),r.forEach(s=>{t(this,v).warn(`- ${s.getAttribute("os-checkout-component")}`)})}}catch(e){t(this,v).error("Error fixing billing form:",e)}},ja=new WeakSet,Eg=function(){try{document.addEventListener("payment-method-changed",e=>{t(this,v).debug(`Payment method changed to: ${e.detail.mode}`),document.querySelector("[os-payment-mode]")?.setAttribute("os-payment-mode",e.detail.mode)}),t(this,O)&&(t(this,O).addEventListener("submit",e=>n(this,Ga,kg).call(this,e)),t(this,v).debug("Form submit event listener attached")),t(this,Ce)&&t(this,Ce).events&&this.prospectCartHandler&&t(this,Ce).events.on("prospect.cartCreated",e=>{t(this,v).info("Prospect cart created successfully",e)}),t(this,Ce)&&t(this,Ce).events&&t(this,Ce).events.on("order.created",e=>{t(this,v).info("Order created successfully",e)})}catch(e){t(this,v).error("Error setting up event listeners:",e)}},Ga=new WeakSet,kg=function(e){if(e&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()),t(this,v).debug("Form submission intercepted by #handleSubmit"),t(this,O)){t(this,O).removeAttribute("action"),t(this,O).setAttribute("method","post");let i=r=>(r&&(r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation()),t(this,O)&&(t(this,O).removeAttribute("action"),t(this,O).setAttribute("method","post")),typeof window.stop=="function"&&window.stop(),t(this,v).debug("Form direct submission prevented"),!1);t(this,O).onsubmit=i}return this.formValidator&&!this.formValidator.validateAllFields()?(t(this,v).warn("Form validation failed, stopping submission"),!1):(this.paymentHandler?(t(this,v).debug("Delegating to paymentHandler.processPayment()"),this.paymentHandler.processPayment()):t(this,v).error("Payment handler not initialized"),!1)},Ka=new WeakSet,Ag=function(){try{if(!t(this,O))return;let e=t(this,O).querySelectorAll('button[type="submit"], input[type="submit"]');e.length>0?(t(this,v).debug(`Found ${e.length} submit buttons, converting to type="button"`),e.forEach((i,r)=>{i.setAttribute("type","button"),i.addEventListener("click",s=>{s.preventDefault(),t(this,v).debug(`Submit button ${r+1} clicked, delegating to payment handler`),this.paymentHandler?this.paymentHandler.processPayment():t(this,v).error("Payment handler not initialized")}),t(this,v).debug(`Converted submit button ${r+1} to type="button"`)})):t(this,v).debug("No submit buttons found in the form")}catch(e){t(this,v).error("Error disabling submit buttons:",e)}};var se,ut,Gt,Ya=class{constructor(e){o(this,se,void 0);o(this,ut,void 0);o(this,Gt,!1);u(this,se,e),u(this,ut,e.logger.createModuleLogger("CAMPAIGN"))}getCampaignData(){let e=t(this,se).campaignData;return e&&!t(this,Gt)&&t(this,se).events?.viewItemList&&(t(this,ut).debug("Triggering view_item_list event from getCampaignData"),setTimeout(()=>{t(this,se).events.viewItemList(e),u(this,Gt,!0)},500)),e}getCampaignName(){return t(this,se).campaignData?.name??""}getCampaignId(){return t(this,se).campaignData?.id??""}getProducts(){let e=t(this,se).campaignData?.products??[];return e.length>0&&!t(this,Gt)&&t(this,se).events?.viewItemList&&(t(this,ut).debug("Triggering view_item_list event from getProducts"),t(this,se).campaignData,setTimeout(()=>{t(this,se).events.viewItemList(t(this,se).campaignData),u(this,Gt,!0)},500)),e}getProductById(e){return this.getProducts().find(i=>i.id===e)}getCurrency(){return t(this,se).campaignData?.currency??"USD"}getLocale(){return t(this,se).campaignData?.locale??"en-US"}formatPrice(e){if(typeof e!="number")return"";try{return new Intl.NumberFormat(this.getLocale(),{style:"currency",currency:this.getCurrency()}).format(e)}catch(i){return t(this,ut).error("Error formatting price:",i),e.toString()}}triggerViewItemList(){if(!t(this,se).campaignData){t(this,ut).warn("Cannot trigger view_item_list: No campaign data available");return}if(!t(this,se).events?.viewItemList){t(this,ut).warn("Cannot trigger view_item_list: EventManager not initialized");return}t(this,ut).debug("Manually triggering view_item_list event"),t(this,se).events.viewItemList(t(this,se).campaignData),u(this,Gt,!0)}};se=new WeakMap,ut=new WeakMap,Gt=new WeakMap;var Ee,B,le,Kt,Cs,Fd,Za,Tg,Xa,$g,Yt,or,Qa,Pg,Jt,ar,Es,Md,Ja=class{constructor(e){o(this,Cs);o(this,Za);o(this,Xa);o(this,Yt);o(this,Qa);o(this,Jt);o(this,Es);o(this,Ee,void 0);o(this,B,void 0);o(this,le,void 0);o(this,Kt,{});u(this,Ee,e),u(this,B,e.logger.createModuleLogger("STATE")),u(this,le,n(this,Cs,Fd).call(this)),n(this,Za,Tg).call(this),n(this,Es,Md).call(this,!1),t(this,B).info("StateManager initialized")}getState(e=null){return e?e==="cart"?{...t(this,le).cart,totals:n(this,Jt,ar).call(this)}:e==="cart.totals"||e.startsWith("cart.totals.")?n(this,Jt,ar).call(this):e.split(".").reduce((i,r)=>i?.[r]??null,t(this,le)):{...t(this,le),cart:{...t(this,le).cart,totals:n(this,Jt,ar).call(this)}}}setState(e,i,r=!0){let s=t(this,le),a=e.split(".");for(let[l,d]of a.entries())l===a.length-1?s[d]=i:(s[d]??(s[d]={}),s=s[d]);return e.startsWith("cart.items")&&n(this,Es,Md).call(this,!1),n(this,Xa,$g).call(this),r&&(n(this,Yt,or).call(this,e,i),e.startsWith("cart.items")&&n(this,Yt,or).call(this,"cart",this.getState("cart"))),this}subscribe(e,i){var r;(r=t(this,Kt))[e]??(r[e]=[]),t(this,Kt)[e].push(i);try{i(this.getState(e),e)}catch(s){t(this,B).error(`Error in initial subscriber callback for ${e}:`,s)}return()=>t(this,Kt)[e]=t(this,Kt)[e].filter(s=>s!==i)}clearState(){u(this,le,n(this,Cs,Fd).call(this)),sessionStorage.removeItem("os_state"),n(this,Yt,or).call(this,"*",t(this,le)),t(this,B).info("State cleared")}addToCart(e){if(!e?.id||!e.name||e.price===void 0)throw t(this,B).error("Invalid item:",e),new Error("Invalid item. Must have id, name, and price.");let i=this.getState("cart"),r=t(this,Ee).campaignData?.packages?.find(d=>d.ref_id.toString()===e.id.toString()||d.external_id?.toString()===e.id.toString()),s={...e,...r&&{name:r.name||e.name,price:Number.parseFloat(r.price)||e.price,price_total:Number.parseFloat(r.price_total)||e.price*(e.quantity||1),retail_price:Number.parseFloat(r.price_retail)??void 0,retail_price_total:Number.parseFloat(r.price_retail_total)??void 0,is_recurring:r.is_recurring??!1,price_recurring:r.price_recurring?Number.parseFloat(r.price_recurring):void 0,price_recurring_total:r.price_recurring_total?Number.parseFloat(r.price_recurring_total):void 0,interval:r.interval??void 0,interval_count:r.interval_count??void 0,image:r.image||e.image,external_id:r.external_id??void 0},quantity:e.quantity||1},a=i.items.findIndex(d=>d.id===e.id),l=a>=0?n(this,Qa,Pg).call(this,i.items,a,s):[...i.items,s];return this.setState("cart.items",l),t(this,B).info(`Item added to cart: ${s.name}`),t(this,Ee).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}updateCartItem(e,i){let r=this.getState("cart"),s=r.items.findIndex(l=>l.id===e);if(s===-1)throw t(this,B).error(`Item not found in cart: ${e}`),new Error(`Item not found in cart: ${e}`);let a=[...r.items];return a[s]={...a[s],...i},a[s].quantity===0&&a.splice(s,1),this.setState("cart.items",a),t(this,B).info(`Cart item updated: ${e}`),t(this,Ee).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}removeFromCart(e){let i=this.getState("cart").items.filter(r=>r.id!==e);return this.setState("cart.items",i),t(this,B).info(`Item removed from cart: ${e}`),t(this,Ee).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}clearCart(){return this.setState("cart.items",[]),this.setState("cart.couponCode",null),this.setState("cart.shippingMethod",null),t(this,B).info("Cart cleared"),t(this,Ee).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}setShippingMethod(e){return this.setState("cart.shippingMethod",e),t(this,B).info(`Shipping method set: ${e.code}`),t(this,Ee).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}applyCoupon(e){return this.setState("cart.couponCode",e),t(this,B).info(`Coupon applied: ${e}`),t(this,Ee).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}removeCoupon(){return this.setState("cart.couponCode",null),t(this,B).info("Coupon removed"),t(this,Ee).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}isItemInCart(e){return t(this,le).cart.items.some(i=>i.id===e)}getCartForApi(){let{items:e,shippingMethod:i,couponCode:r,attribution:s}=this.getState("cart"),{email:a,firstName:l,lastName:d,phone:h}=this.getState("user");return{lines:e.map(g=>({product_id:g.id,quantity:g.quantity||1,price:g.price})),shipping_method:i?.code??null,coupon_code:r,user:{email:a,first_name:l,last_name:d,phone:h},attribution:s||{}}}async syncCartWithApi(){try{this.setState("ui.loading",!0);let e=this.getCartForApi(),i=await t(this,Ee).api.createCart(e);return t(this,B).info("Cart synced with API"),t(this,Ee).triggerEvent("cart.synced",{cart:i}),i}catch(e){throw t(this,B).error("Error syncing cart with API:",e),this.setState("ui.errors.cart",e.message),e}finally{this.setState("ui.loading",!1)}}};Ee=new WeakMap,B=new WeakMap,le=new WeakMap,Kt=new WeakMap,Cs=new WeakSet,Fd=function(){return{cart:{items:[],totals:{subtotal:0,retail_subtotal:0,savings:0,savings_percentage:0,shipping:0,tax:0,total:0,recurring_total:0,currency:"USD",currency_symbol:"$"},shippingMethod:null,couponCode:null,attribution:{utm_source:"",utm_medium:"",utm_campaign:"",utm_content:"",utm_term:"",gclid:"",fbclid:"",sub1:"",sub2:"",sub3:"",sub4:"",sub5:"",referrer:"",landing_page:"",user_agent:"",device_type:"",fbc:"",fbp:""}},user:{email:null,firstName:null,lastName:null,phone:null},ui:{loading:!1,currentStep:"cart",errors:{}}}},Za=new WeakSet,Tg=function(){try{let e=sessionStorage.getItem("os_state");if(e){let i=JSON.parse(e);u(this,le,{...t(this,le),...i,ui:{...t(this,le).ui}}),t(this,B).info("State loaded from sessionStorage")}}catch(e){t(this,B).error("Error loading state from sessionStorage:",e)}},Xa=new WeakSet,$g=function(){try{let e={cart:{...t(this,le).cart,totals:n(this,Jt,ar).call(this)},user:t(this,le).user};sessionStorage.setItem("os_state",JSON.stringify(e)),t(this,B).debug("State saved to sessionStorage")}catch(e){t(this,B).error("Error saving state to sessionStorage:",e)}},Yt=new WeakSet,or=function(e,i){t(this,B).debug(`Notifying subscribers for path: ${e}`);for(let[r,s]of Object.entries(t(this,Kt)))if(r===e||r==="*"||e.startsWith(`${r}.`)){let a=r==="*"?this.getState():this.getState(r);s.forEach(l=>{try{l(a,r)}catch(d){t(this,B).error(`Error in subscriber callback for ${r}:`,d)}})}},Qa=new WeakSet,Pg=function(e,i,r){let s=[...e];return s[i]={...s[i],quantity:(s[i].quantity||1)+(r.quantity||1),price_total:s[i].price*(s[i].quantity||1+(r.quantity||1)),...s[i].retail_price&&{retail_price_total:s[i].retail_price*(s[i].quantity||1+(r.quantity||1))},...s[i].price_recurring&&{price_recurring_total:s[i].price_recurring*(s[i].quantity||1+(r.quantity||1))}},s},Jt=new WeakSet,ar=function(){let{items:e,shippingMethod:i}=t(this,le).cart,r=e.reduce((b,y)=>b+(y.price_total??y.price*(y.quantity||1)),0),s=e.reduce((b,y)=>b+(y.retail_price_total??(y.retail_price??y.price)*(y.quantity||1)),0),a=s-r,l=s>0?a/s*100:0,d=e.reduce((b,y)=>b+(y.is_recurring&&y.price_recurring?y.price_recurring*(y.quantity||1):0),0),h=i?.price?Number.parseFloat(i.price):0,g=0,m=r+h+g,p=t(this,Ee).campaignData?.currency??"USD",S={USD:"$",EUR:"â‚¬",GBP:"Â£"}[p]??"$";return{subtotal:r,retail_subtotal:s,savings:a,savings_percentage:l,shipping:h,tax:g,total:m,recurring_total:d,currency:p,currency_symbol:S}},Es=new WeakSet,Md=function(e=!0){let i=n(this,Jt,ar).call(this);return t(this,le).cart.totals=i,t(this,B).debug("Cart totals recalculated"),e&&(n(this,Yt,or).call(this,"cart.totals",i),n(this,Yt,or).call(this,"cart",this.getState("cart"))),i};var lr,ye,Te,$e,il,Lg,ks,Nd,rl,Ig,As,Od,Ts,Ud,cr,el,tl=class{constructor(e){o(this,il);o(this,ks);o(this,rl);o(this,As);o(this,Ts);o(this,cr);o(this,lr,void 0);o(this,ye,void 0);o(this,Te,void 0);o(this,$e,void 0);u(this,lr,e),u(this,ye,e.state),u(this,Te,e.logger.createModuleLogger("CART")),n(this,il,Lg).call(this),t(this,Te).info("CartManager initialized")}clearCart(){try{return t(this,ye).clearCart()}catch(e){throw t(this,Te).error("Error clearing cart:",e),e}}addToCart(e){return n(this,As,Od).call(this,e)}removeFromCart(e){return n(this,cr,el).call(this,e)}setShippingMethod(e){try{return t(this,ye).setShippingMethod(e)}catch(i){throw t(this,Te).error("Error setting shipping method:",i),i}}applyCoupon(e){try{return t(this,ye).applyCoupon(e)}catch(i){throw t(this,Te).error("Error applying coupon:",i),i}}removeCoupon(){try{return t(this,ye).removeCoupon()}catch(e){throw t(this,Te).error("Error removing coupon:",e),e}}async syncCartWithApi(){try{return await t(this,ye).syncCartWithApi()}catch(e){throw t(this,Te).error("Error syncing cart with API:",e),e}}isItemInCart(e){return t(this,ye).isItemInCart?.(e)??t(this,ye).getState("cart").items.some(i=>i.id===e)}};lr=new WeakMap,ye=new WeakMap,Te=new WeakMap,$e=new WeakMap,il=new WeakSet,Lg=function(){u(this,$e,{addToCartButtons:document.querySelectorAll("[data-os-add-to-cart]"),cartCount:document.querySelectorAll("[data-os-cart-count]"),cartTotal:document.querySelectorAll("[data-os-cart-total]"),cartItems:document.querySelector("[data-os-cart-items]"),cartEmpty:document.querySelector("[data-os-cart-empty]"),cartContainer:document.querySelector("[data-os-cart-container]")}),t(this,$e).addToCartButtons.forEach(e=>{e.addEventListener("click",i=>{i.preventDefault();let r={id:e.getAttribute("data-os-product-id"),name:e.getAttribute("data-os-product-name"),price:Number.parseFloat(e.getAttribute("data-os-product-price")),quantity:Number.parseInt(e.getAttribute("data-os-product-quantity")??"1",10)};r.id&&r.name&&r.price?n(this,As,Od).call(this,r):t(this,Te).error("Invalid product data for add to cart button")})}),t(this,ye).subscribe("cart",()=>n(this,ks,Nd).call(this)),n(this,ks,Nd).call(this)},ks=new WeakSet,Nd=function(){let e=t(this,ye).getState("cart");t(this,$e).cartCount.forEach(s=>{let a=e.items.reduce((l,d)=>l+(d.quantity||1),0);s.textContent=a.toString(),s.classList.toggle("hidden",a===0)});let i=s=>t(this,lr).campaign?.formatPrice(s)??s.toFixed(2);t(this,$e).cartTotal.forEach(s=>s.textContent=i(e.totals.total));let r=(s,a,l=!1)=>{let d=document.querySelector(s);d&&(d.textContent=l?`${Math.round(a)}%`:i(a),l&&a===0?d.parentElement?.classList.add("hidden"):d.parentElement?.classList.remove("hidden"))};if(r("[data-os-cart-retail-subtotal]",e.totals.retail_subtotal),r("[data-os-cart-savings]",e.totals.savings,!0),r("[data-os-cart-savings-percentage]",e.totals.savings_percentage,!0),r("[data-os-cart-recurring-total]",e.totals.recurring_total,!0),r("[data-os-cart-subtotal]",e.totals.subtotal),r("[data-os-cart-shipping]",e.totals.shipping),t(this,$e).cartItems&&(t(this,$e).cartItems.innerHTML="",e.items.forEach(s=>t(this,$e).cartItems.appendChild(n(this,rl,Ig).call(this,s)))),t(this,$e).cartEmpty&&t(this,$e).cartContainer){let s=e.items.length===0;t(this,$e).cartEmpty.classList.toggle("hidden",!s),t(this,$e).cartContainer.classList.toggle("hidden",s)}},rl=new WeakSet,Ig=function(e){let i=p=>t(this,lr).campaign?.formatPrice(p)??p.toFixed(2),r=document.createElement("div");r.className="os-cart-item",r.setAttribute("data-os-cart-item-id",e.id);let s=i(e.price),a=e.retail_price?i(e.retail_price):"",l=i(e.price*(e.quantity||1)),d=e.retail_price?(e.retail_price-e.price)*(e.quantity||1):0,h=d?`
      <div class="os-cart-item-savings">
        <span class="os-cart-item-savings-label">You save:</span>
        <span class="os-cart-item-savings-value">${i(d)} (${Math.round(d/(e.retail_price*(e.quantity||1))*100)}%)</span>
      </div>
    `:"",g=e.is_recurring&&e.price_recurring?`
      <div class="os-cart-item-recurring">
        <span class="os-cart-item-recurring-label">Recurring:</span>
        <span class="os-cart-item-recurring-value">${i(e.price_recurring)} ${e.interval_count>1?`every ${e.interval_count} ${e.interval}s`:`per ${e.interval}`}</span>
      </div>
    `:"",m=e.image?`
      <div class="os-cart-item-image">
        <img src="${e.image}" alt="${e.name}" />
      </div>
    `:"";return r.innerHTML=`
      ${m}
      <div class="os-cart-item-details">
        <div class="os-cart-item-name">${e.name}</div>
        <div class="os-cart-item-price-container">
          <div class="os-cart-item-price">${s}</div>
          ${a?`<div class="os-cart-item-retail-price">${a}</div>`:""}
        </div>
        ${h}
        ${g}
      </div>
      <div class="os-cart-item-quantity">
        <button class="os-cart-item-decrease" data-os-cart-decrease="${e.id}">-</button>
        <span class="os-cart-item-quantity-value">${e.quantity||1}</span>
        <button class="os-cart-item-increase" data-os-cart-increase="${e.id}">+</button>
      </div>
      <div class="os-cart-item-total">${l}</div>
      <button class="os-cart-item-remove" data-os-cart-remove="${e.id}">Ã—</button>
    `,r.querySelector(`[data-os-cart-decrease="${e.id}"]`)?.addEventListener("click",()=>n(this,Ts,Ud).call(this,e.id,(e.quantity||1)-1)),r.querySelector(`[data-os-cart-increase="${e.id}"]`)?.addEventListener("click",()=>n(this,Ts,Ud).call(this,e.id,(e.quantity||1)+1)),r.querySelector(`[data-os-cart-remove="${e.id}"]`)?.addEventListener("click",()=>n(this,cr,el).call(this,e.id)),r},As=new WeakSet,Od=function(e){try{return t(this,ye).addToCart(e)}catch(i){throw t(this,Te).error("Error adding item to cart:",i),i}},Ts=new WeakSet,Ud=function(e,i){try{return i<=0?n(this,cr,el).call(this,e):t(this,ye).updateCartItem(e,{quantity:i})}catch(r){throw t(this,Te).error("Error updating cart item quantity:",r),r}},cr=new WeakSet,el=function(e){try{return t(this,ye).removeFromCart(e)}catch(i){throw t(this,Te).error("Error removing item from cart:",i),i}};var dr,kt,et,ur,me=class{static initDebugMode(){let e=new URLSearchParams(window.location.search);return u(this,kt,e.get("debugger")==="true"),t(this,kt)&&!t(this,dr)&&(this.injectDebugStyles(),u(this,et,localStorage.getItem("os_debug_xray_enabled")==="true")),t(this,kt)}static isDebugMode(){return t(this,kt)}static isXrayEnabled(){return t(this,et)}static toggleXray(e=!t(this,et)){return t(this,kt)?(u(this,et,e),localStorage.setItem("os_debug_xray_enabled",t(this,et).toString()),t(this,ur).forEach(i=>{i.style.display=t(this,et)?"block":"none"}),t(this,et)):!1}static injectDebugStyles(){if(t(this,dr))return;let e=document.createElement("style");e.id="os-debug-styles",e.textContent=`
      /* Common debug styles */
      .os-debug-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9999;
        border: 2px dashed rgba(255, 0, 0, 0.7);
        box-sizing: border-box;
      }
      .os-debug-label {
        position: absolute;
        top: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        font-size: 12px;
        padding: 2px 6px;
        border-radius: 0 0 0 4px;
        font-family: monospace;
        z-index: 10000;
      }
      
      /* Selector-specific styles */
      .os-debug-card-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9998;
        border: 1px solid rgba(0, 255, 255, 0.7);
        box-sizing: border-box;
      }
      .os-debug-card-label {
        position: absolute;
        top: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        font-size: 10px;
        padding: 1px 4px;
        border-radius: 0 0 0 4px;
        font-family: monospace;
        z-index: 9999;
      }
      .os--selected .os-debug-card-overlay {
        border: 2px solid rgba(0, 255, 0, 0.9);
      }
      .os--active .os-debug-card-overlay {
        background-color: rgba(255, 255, 0, 0.2);
      }
      
      /* Toggle-specific styles */
      .os-debug-toggle-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9998;
        border: 1px solid rgba(255, 165, 0, 0.7);
        box-sizing: border-box;
      }
      .os-debug-toggle-label {
        position: absolute;
        top: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        font-size: 10px;
        padding: 1px 4px;
        border-radius: 0 0 0 4px;
        font-family: monospace;
        z-index: 9999;
      }
      [data-os-active="true"] .os-debug-toggle-overlay {
        background-color: rgba(255, 165, 0, 0.3);
        border: 2px solid rgba(255, 165, 0, 0.9);
      }
      
      /* Upsell styles */
      .os-debug-upsell-overlay {
        border: 2px dashed rgba(76, 175, 80, 0.9) !important;
      }
      .os-debug-upsell-label {
        background-color: rgba(76, 175, 80, 0.9) !important;
      }
      .os-debug-upsell-badge {
        display: inline-block;
        background-color: rgba(76, 175, 80, 0.9);
        color: white;
        font-size: 9px;
        padding: 1px 3px;
        border-radius: 2px;
        margin-left: 4px;
        vertical-align: middle;
      }
      
      /* Debug bar styles */
      .os-debug-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: rgba(33, 33, 33, 0.9);
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        font-size: 14px;
        z-index: 10001;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 16px;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
      }
      
      .os-debug-bar-title {
        font-weight: 600;
        margin-right: 20px;
      }
      
      .os-debug-bar-controls {
        display: flex;
        align-items: center;
      }
      
      .os-debug-bar-control {
        margin: 0 10px;
        display: flex;
        align-items: center;
      }
      
      .os-debug-bar-toggle {
        position: relative;
        display: inline-block;
        width: 40px;
        height: 20px;
        margin-left: 8px;
      }
      
      .os-debug-bar-toggle input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      
      .os-debug-bar-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 20px;
      }
      
      .os-debug-bar-slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
      }
      
      input:checked + .os-debug-bar-slider {
        background-color: #2196F3;
      }
      
      input:checked + .os-debug-bar-slider:before {
        transform: translateX(20px);
      }
      
      .os-debug-bar-button {
        background-color: #2196F3;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 4px 10px;
        font-size: 12px;
        cursor: pointer;
        margin-left: 10px;
      }
      
      .os-debug-bar-button:hover {
        background-color: #0b7dda;
      }
    `,document.head.appendChild(e),u(this,dr,!0)}static addDebugOverlay(e,i,r,s={}){if(!t(this,kt))return;window.getComputedStyle(e).position==="static"&&(e.style.position="relative");let l=document.createElement("div");l.className=`os-debug-${r}-overlay`;let d=document.createElement("div");d.className=`os-debug-${r}-label`,s.Upsell==="Yes"&&(l.classList.add("os-debug-upsell-overlay"),d.classList.add("os-debug-upsell-label"));let g=`ID: ${i}`;Object.entries(s).forEach(([m,p])=>{m==="Upsell"&&p==="Yes"?g+=` | ${m}: <span class="os-debug-upsell-badge">UPSELL</span>`:g+=` | ${m}: ${p}`}),d.innerHTML=g,t(this,et)||(l.style.display="none",d.style.display="none"),e.appendChild(l),e.appendChild(d),t(this,ur).push(l),t(this,ur).push(d)}};dr=new WeakMap,kt=new WeakMap,et=new WeakMap,ur=new WeakMap,o(me,dr,!1),o(me,kt,!1),o(me,et,!1),o(me,ur,[]);var V,F,ht,Tt,vi,ol,qg,al,Fg,ll,Mg,cl,Ng,hr,sl,dl,Og,$s,Rd,Ps,zd,Ls,Dd,ul,Ug,hl,Rg,Bd,Rp,tt,At,nl=class{constructor(e){o(this,ol);o(this,al);o(this,ll);o(this,cl);o(this,hr);o(this,dl);o(this,$s);o(this,Ps);o(this,Ls);o(this,ul);o(this,hl);o(this,Bd);o(this,tt);o(this,V,void 0);o(this,F,void 0);o(this,ht,{});o(this,Tt,{});o(this,vi,!1);u(this,V,e),u(this,F,e.logger.createModuleLogger("SELECTOR")),u(this,vi,me.initDebugMode()),n(this,ol,qg).call(this),t(this,F).info("SelectorManager initialized"),t(this,vi)&&t(this,F).info("Debug mode enabled for selectors")}initUnitPricing(){t(this,F).info("Initializing unit pricing for selectors"),setTimeout(()=>{Object.keys(t(this,ht)).forEach(e=>{n(this,ul,Ug).call(this,e)})},100)}refreshUnitPricing(){this.initUnitPricing()}};V=new WeakMap,F=new WeakMap,ht=new WeakMap,Tt=new WeakMap,vi=new WeakMap,ol=new WeakSet,qg=function(){document.querySelectorAll('[data-os-component="selector"][data-os-selection-mode="swap"]').forEach(e=>n(this,al,Fg).call(this,e)),setTimeout(()=>n(this,Ls,Dd).call(this),0),t(this,V).state?.subscribe("cart",()=>n(this,Ls,Dd).call(this)),this.initUnitPricing()},al=new WeakSet,Fg=function(e){let i=e.getAttribute("data-os-id");if(!i){t(this,F).warn("Selector missing data-os-id",e);return}let r=e.getAttribute("data-os-selection-mode")||"swap";t(this,ht)[i]={element:e,items:[],mode:r},t(this,Tt)[i]=null,e.querySelectorAll('[data-os-element="card"]').forEach(s=>n(this,ll,Mg).call(this,i,s)),t(this,vi)&&me.addDebugOverlay(e,i,"overlay",{Mode:r})},ll=new WeakSet,Mg=function(e,i){let r=i.getAttribute("data-os-package");if(!r){t(this,F).warn("Card missing data-os-package",i);return}let a=i.querySelector(".pb-quantity__price.pb--current")?.textContent.trim()??"$0.00 USD",l=Number.parseFloat(a.match(/\$(\d+\.\d+)/)?.[1]??"0"),h=i.querySelector(".card-title")?.textContent.trim()??`Package ${r}`,g=Number.parseInt(i.getAttribute("data-os-quantity")??"1",10),m=i.getAttribute("data-os-selected")==="true",p={element:i,packageId:r,quantity:g,price:l,name:h,isPreSelected:m};t(this,ht)[e].items.push(p),i.addEventListener("click",()=>n(this,cl,Ng).call(this,e,p)),t(this,vi)&&me.addDebugOverlay(i,r,"card",{Price:`$${l}`,Qty:g,PreSel:m?"Yes":"No"})},cl=new WeakSet,Ng=function(e,i){let r=t(this,Tt)[e];n(this,hr,sl).call(this,e,i),n(this,dl,Og).call(this,e,r)},hr=new WeakSet,sl=function(e,i){t(this,Tt)[e]!==i&&(t(this,ht)[e].items.forEach(r=>{r.element.classList.remove("os--selected"),r.element.setAttribute("data-os-selected","false"),r.isSelected=!1}),i.element.classList.add("os--selected"),i.element.setAttribute("data-os-selected","true"),i.isSelected=!0,t(this,Tt)[e]=i,t(this,F).debug(`Selected item ${i.packageId} in selector ${e}`))},dl=new WeakSet,Og=function(e,i){if(!t(this,V).cart){t(this,F).error("Cart manager not available");return}let r=t(this,Tt)[e];r&&(i&&i.packageId!==r.packageId&&n(this,Ps,zd).call(this,i),t(this,V).cart.isItemInCart(r.packageId)||n(this,$s,Rd).call(this,r))},$s=new WeakSet,Rd=function(e){if(!t(this,V).cart){t(this,F).error("Cart manager not available in addItemToCart");return}if(typeof t(this,V).cart.addToCart!="function"){t(this,F).error("addToCart is not a function on this.#app.cart:",t(this,V).cart);return}t(this,F).info(`Adding item ${e.packageId} to cart`),t(this,V).cart.addToCart({id:e.packageId,name:e.name,price:e.price,quantity:e.quantity,type:"package"}),e.element.classList.add("os--active"),e.element.setAttribute("data-os-active","true")},Ps=new WeakSet,zd=function(e){if(!t(this,V).cart){t(this,F).error("Cart manager not available in removeItemFromCart");return}if(typeof t(this,V).cart.removeFromCart!="function"){t(this,F).error("removeFromCart is not a function on this.#app.cart:",t(this,V).cart);return}t(this,F).info(`Removing item ${e.packageId} from cart`),t(this,V).cart.removeFromCart(e.packageId),e.element.classList.remove("os--active"),e.element.setAttribute("data-os-active","false")},Ls=new WeakSet,Dd=function(){if(!t(this,V).cart){t(this,F).debug("Cart manager not available for sync");return}if(!t(this,V).state?.getState("cart")){t(this,F).debug("Cart state not available");return}t(this,F).debug("Syncing with cart, this.#app.cart:",t(this,V).cart),Object.keys(t(this,ht)).forEach(i=>{let r=t(this,ht)[i].items,s=r.filter(a=>t(this,V).cart.isItemInCart(a.packageId));if(s.length>0){let a=s[0];n(this,hr,sl).call(this,i,a),s.forEach(l=>{l.packageId!==a.packageId&&n(this,Ps,zd).call(this,l)})}else if(!t(this,Tt)[i]){let a=r.find(l=>l.isPreSelected);a&&(n(this,hr,sl).call(this,i,a),n(this,$s,Rd).call(this,a))}r.forEach(a=>{let l=t(this,V).cart.isItemInCart(a.packageId);a.element.classList.toggle("os--active",l),a.element.setAttribute("data-os-active",l.toString())})})},ul=new WeakSet,Ug=function(e){let i=t(this,ht)[e];if(!i){t(this,F).warn(`Selector ${e} not found for unit pricing`);return}let r=t(this,V)?.campaignData;if(!r||!r.packages){t(this,F).warn("Campaign data not available for unit pricing");return}i.items.forEach(s=>{n(this,hl,Rg).call(this,s,r.packages)})},hl=new WeakSet,Rg=function(e,i){let r=i.find(I=>I.ref_id.toString()===e.packageId.toString()||I.external_id&&I.external_id.toString()===e.packageId.toString());if(!r){t(this,F).debug(`Package data not found for item ${e.packageId}`);return}let s=e.element;t(this,F).debug(`Processing unit pricing for package ${e.packageId}:`,{packageId:e.packageId,name:r.name,price:r.price,price_total:r.price_total,price_retail:r.price_retail,price_retail_total:r.price_retail_total,qty:r.qty});let a=r.qty||1,l=Number.parseFloat(r.price_total)||Number.parseFloat(r.price)*a,d=Number.parseFloat(r.price_retail_total)||Number.parseFloat(r.price_retail)*a||l,h=l/a,g=d/a,m=g-h,p=g>0?m/g*100:0,S=d-l,b=d>0?S/d*100:0;t(this,F).debug(`Calculated prices for package ${e.packageId}:`,{totalUnits:a,totalPrice:l,totalRetailPrice:d,totalSavings:S,totalSavingsPercentage:b,unitPrice:h,unitRetailPrice:g,unitSavings:m,unitSavingsPercentage:p});let y=I=>t(this,V).campaign?.formatPrice?t(this,V).campaign.formatPrice(I):`$${I.toFixed(2)}`,P=new Set,U=s.querySelectorAll("[data-divide-by]");U.length>0&&(t(this,F).debug(`Found ${U.length} elements with data-divide-by in card ${e.packageId}`),U.forEach(I=>{let R=parseFloat(I.getAttribute("data-divide-by"));if(!isNaN(R)&&R>0){let W=I.getAttribute("data-card-price");if(!W){t(this,F).debug("Skipping element with data-divide-by but no data-card-price attribute");return}let D;switch(W){case"each-sale":D=h/R;break;case"each-regular":D=g/R;break;case"saving-amount":D=m/R;break;case"saving-percentage":D=p;break;case"total-sale":D=l/R;break;case"total-regular":D=d/R;break;case"total-saving-amount":D=S/R;break;case"total-saving-percentage":D=b;break;default:t(this,F).debug(`Unknown price type: ${W}`);return}let K;W.includes("percentage")?K=`${Math.round(D)}%`:K=y(D),t(this,F).debug(`Setting price for element with data-divide-by="${R}":`,{attributeType:W,originalValue:I.textContent,calculatedValue:D,formattedValue:K,element:I.outerHTML}),I.textContent=K,P.add(I),t(this,F).debug(`Updated element with data-divide-by="${R}" for ${W}: ${K}`)}})),n(this,tt,At).call(this,s,"each-sale",y(h),P),n(this,tt,At).call(this,s,"each-regular",y(g),P),n(this,tt,At).call(this,s,"saving-amount",y(m),P),n(this,tt,At).call(this,s,"saving-percentage",`${Math.round(p)}%`,P),n(this,tt,At).call(this,s,"total-sale",y(l),P),n(this,tt,At).call(this,s,"total-regular",y(d),P),n(this,tt,At).call(this,s,"total-saving-amount",y(S),P),n(this,tt,At).call(this,s,"total-saving-percentage",`${Math.round(b)}%`,P),t(this,F).debug(`Updated pricing for card ${e.packageId}: ${y(h)} per unit, ${y(l)} total`)},Bd=new WeakSet,Rp=function(e){return t(this,V).campaign?.formatPrice?t(this,V).campaign.formatPrice(e):`$${e.toFixed(2)}`},tt=new WeakSet,At=function(e,i,r,s=new Set){let a=e.querySelectorAll(`[data-card-price="${i}"]`);a.length>0&&a.forEach(l=>{if(s.has(l))return;l.textContent=r;let d=l.getAttribute("data-hide-if-zero")==="true",h=parseFloat(r.replace(/[^0-9.-]+/g,""));if(d&&h<=0){l.style.display="none";let g=l.closest('[data-container="true"]');g&&(g.style.display="none")}else{l.style.display="";let g=l.closest('[data-container="true"]');g&&(g.style.display="")}})};var gr,ze,pe,mr,pl,zg,fl,Dg,yl,Bg,bl,Vg,Is,Vd,pr,gl,vl,Hg,qs,Hd,wl,Wg,Sl,jg,ml=class{constructor(e){o(this,pl);o(this,fl);o(this,yl);o(this,bl);o(this,Is);o(this,pr);o(this,vl);o(this,qs);o(this,wl);o(this,Sl);o(this,gr,{});o(this,ze,void 0);o(this,pe,void 0);o(this,mr,!1);u(this,ze,e),u(this,pe,e.logger.createModuleLogger("TOGGLE")),u(this,mr,me.initDebugMode()),n(this,pl,zg).call(this),t(this,ze).state.subscribe("cart",()=>n(this,vl,Hg).call(this)),t(this,pe).info("ToggleManager initialized"),t(this,mr)&&t(this,pe).info("Debug mode enabled for toggle items")}};gr=new WeakMap,ze=new WeakMap,pe=new WeakMap,mr=new WeakMap,pl=new WeakSet,zg=function(){let e=document.querySelectorAll('[data-os-action="toggle-item"]');if(!e.length){t(this,pe).debug("No toggle item buttons found in the DOM");return}t(this,pe).info(`Found ${e.length} toggle item buttons`),e.forEach(i=>n(this,fl,Dg).call(this,i))},fl=new WeakSet,Dg=function(e){let i=e.getAttribute("data-os-package");if(!i){t(this,pe).warn("Toggle item missing data-os-package attribute",e);return}let r=Number.parseInt(e.getAttribute("data-os-quantity")??"1",10),s=e.getAttribute("data-os-id")??`toggle-${i}`;t(this,gr)[s]={element:e,packageId:i,quantity:r},n(this,pr,gl).call(this,e,i),e.addEventListener("click",a=>{a.preventDefault(),n(this,bl,Vg).call(this,s)}),t(this,mr)&&n(this,yl,Bg).call(this,e,s,i,r),t(this,pe).debug(`Initialized toggle item ${s} for package ${i}`)},yl=new WeakSet,Bg=function(e,i,r,s){let a=n(this,Is,Vd).call(this,r),l=a?a.price:"N/A",d=e.hasAttribute("data-os-upsell")?e.getAttribute("data-os-upsell")==="true":e.closest("[data-os-upsell-section]")!==null;me.addDebugOverlay(e,i,"toggle",{Package:r,Qty:s,Price:l,Upsell:d?"Yes":"No"})},bl=new WeakSet,Vg=function(e){let i=t(this,gr)[e];if(!i){t(this,pe).error(`Toggle item ${e} not found`);return}let{packageId:r,quantity:s,element:a}=i,l=n(this,qs,Hd).call(this,r);if(l)n(this,Sl,jg).call(this,r),t(this,pe).info(`Toggled OFF item ${r}`);else{let d=n(this,Is,Vd).call(this,r);if(!d){t(this,pe).error(`Package ${r} not found in campaign data`);return}let h=a.hasAttribute("data-os-upsell")?a.getAttribute("data-os-upsell")==="true":a.closest("[data-os-upsell-section]")!==null;n(this,wl,Wg).call(this,{id:r,name:d.name,price:Number.parseFloat(d.price),quantity:s,type:"package",is_upsell:h}),t(this,pe).info(`Toggled ON item ${r}${h?" (upsell)":""}`)}n(this,pr,gl).call(this,a,r),t(this,ze).triggerEvent("toggle.changed",{toggleId:e,packageId:r,isActive:!l})},Is=new WeakSet,Vd=function(e){return t(this,ze).campaignData?.packages?t(this,ze).campaignData.packages.find(i=>i.ref_id.toString()===e.toString())??null:(t(this,pe).error("Campaign data not available"),null)},pr=new WeakSet,gl=function(e,i){let r=n(this,qs,Hd).call(this,i);e.classList.toggle("os--active",r),e.setAttribute("data-os-active",r.toString())},vl=new WeakSet,Hg=function(){Object.values(t(this,gr)).forEach(({element:e,packageId:i})=>n(this,pr,gl).call(this,e,i))},qs=new WeakSet,Hd=function(e){return t(this,ze).state.getState("cart").items.some(i=>i.id===e)},wl=new WeakSet,Wg=function(e){if(!t(this,ze).cart){t(this,pe).error("Cart manager not available");return}t(this,ze).cart.addToCart(e)},Sl=new WeakSet,jg=function(e){if(!t(this,ze).cart){t(this,pe).error("Cart manager not available");return}t(this,ze).cart.removeFromCart(e)};var wi,Pe,$t,Pt,Si,Fs,kl,Gg,Al,Kg,Ms,Wd,fr,_l,yr,xl,Ns,jd,Tl,Yg,br,Cl,El=class{constructor(e){o(this,kl);o(this,Al);o(this,Ms);o(this,fr);o(this,yr);o(this,Ns);o(this,Tl);o(this,br);o(this,wi,void 0);o(this,Pe,void 0);o(this,$t,!1);o(this,Pt,null);o(this,Si,null);o(this,Fs,!1);u(this,wi,e),u(this,Pe,e.logger.createModuleLogger("DEBUG")),u(this,Fs,me.initDebugMode()),n(this,kl,Gg).call(this),t(this,Pe).info("DebugManager initialized")}};wi=new WeakMap,Pe=new WeakMap,$t=new WeakMap,Pt=new WeakMap,Si=new WeakMap,Fs=new WeakMap,kl=new WeakSet,Gg=function(){window.showMiniCart=()=>n(this,fr,_l).call(this),window.hideMiniCart=()=>n(this,yr,xl).call(this),window.toggleMiniCart=()=>n(this,Ns,jd).call(this),window.toggleXray=e=>n(this,Ms,Wd).call(this,e),t(this,Fs)&&(t(this,Pe).info("Debug mode activated via URL parameter"),n(this,Al,Kg).call(this),localStorage.getItem("os_debug_mini_cart_visible")==="true"&&n(this,fr,_l).call(this)),t(this,wi).state?.subscribe("cart",()=>{t(this,$t)&&n(this,br,Cl).call(this)}),t(this,Pe).debug("Debug methods exposed to window object")},Al=new WeakSet,Kg=function(){if(t(this,Si))return;let e=document.createElement("div");e.className="os-debug-bar";let i=document.createElement("div");i.className="os-debug-bar-left";let r=document.createElement("span");r.className="os-debug-bar-title",r.textContent="29next Debug Tools",i.appendChild(r);let s=document.createElement("div");s.className="os-debug-bar-controls";let a=document.createElement("div");a.className="os-debug-bar-control";let l=document.createElement("span");l.textContent="X-ray View";let d=document.createElement("label");d.className="os-debug-bar-toggle";let h=document.createElement("input");h.type="checkbox",h.checked=me.isXrayEnabled(),h.addEventListener("change",()=>n(this,Ms,Wd).call(this,h.checked));let g=document.createElement("span");g.className="os-debug-bar-slider",d.append(h,g),a.append(l,d);let m=document.createElement("div");m.className="os-debug-bar-control";let p=document.createElement("button");p.className="os-debug-bar-button",p.textContent="Toggle Mini-Cart",p.addEventListener("click",()=>n(this,Ns,jd).call(this)),m.appendChild(p),s.append(a,m),e.append(i,s),document.body.appendChild(e),u(this,Si,e)},Ms=new WeakSet,Wd=function(e){let i=me.toggleXray(e);if(t(this,Si)){let r=t(this,Si).querySelector('input[type="checkbox"]');r&&(r.checked=i)}return t(this,Pe).info(`X-ray view ${i?"enabled":"disabled"}`),i},fr=new WeakSet,_l=function(){if(t(this,$t)){t(this,Pe).debug("Mini-cart already visible");return}t(this,Pe).info("Showing mini-cart widget"),t(this,Pt)??u(this,Pt,n(this,Tl,Yg).call(this)),t(this,Pt).style.display="block",u(this,$t,!0),localStorage.setItem("os_debug_mini_cart_visible","true"),n(this,br,Cl).call(this)},yr=new WeakSet,xl=function(){if(!t(this,$t)){t(this,Pe).debug("Mini-cart already hidden");return}t(this,Pe).info("Hiding mini-cart widget"),t(this,Pt)&&(t(this,Pt).style.display="none"),u(this,$t,!1),localStorage.setItem("os_debug_mini_cart_visible","false")},Ns=new WeakSet,jd=function(){t(this,$t)?n(this,yr,xl).call(this):n(this,fr,_l).call(this)},Tl=new WeakSet,Yg=function(){let e=document.createElement("div");e.className="os-debug-mini-cart",e.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      width: 300px;
      max-height: 400px;
      overflow-y: auto;
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      z-index: 9999;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      font-size: 14px;
      display: none;
    `;let i=document.createElement("div");i.className="os-debug-mini-cart-header",i.style.cssText=`
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      background-color: #f5f5f5;
      border-bottom: 1px solid #eee;
    `;let r=document.createElement("div");r.className="os-debug-mini-cart-title",r.textContent="Debug Mini-Cart",r.style.fontWeight="600";let s=document.createElement("div");s.style.display="flex",s.style.alignItems="center";let a=document.createElement("button");a.className="os-debug-mini-cart-refresh",a.textContent="â†»",a.title="Refresh cart data",a.style.cssText=`
      background: none;
      border: none;
      font-size: 16px;
      cursor: pointer;
      padding: 0 8px;
      line-height: 1;
      color: #666;
    `,a.addEventListener("click",()=>{n(this,br,Cl).call(this),t(this,Pe).info("Mini-cart data refreshed manually")});let l=document.createElement("button");l.className="os-debug-mini-cart-close",l.textContent="Ã—",l.style.cssText=`
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      padding: 0;
      line-height: 1;
    `,l.addEventListener("click",()=>n(this,yr,xl).call(this)),s.append(a,l),i.append(r,s);let d=document.createElement("div");d.className="os-debug-mini-cart-content",d.style.padding="15px";let h=document.createElement("div");return h.className="os-debug-mini-cart-footer",h.style.cssText=`
      padding: 10px 15px;
      background-color: #f5f5f5;
      border-top: 1px solid #eee;
      font-size: 12px;
      color: #666;
      text-align: center;
    `,h.textContent="Use window.hideMiniCart() to hide this widget",e.append(i,d,h),document.body.appendChild(e),e},br=new WeakSet,Cl=function(){if(!t(this,Pt))return;let e=t(this,Pt).querySelector(".os-debug-mini-cart-content");if(!e)return;let i=t(this,wi).state?.getState("cart");if(!i){e.innerHTML='<div style="color: #999; text-align: center;">Cart data not available</div>';return}t(this,Pe).debug("Updating mini-cart with cart data:",i);let r=a=>t(this,wi).campaign?.formatPrice(a)??`$${a.toFixed(2)}`,s="";i.items?.length?(s+='<div style="margin-bottom: 15px;">',s+='<div style="font-weight: 600; margin-bottom: 10px;">Items:</div>',s+='<ul style="list-style: none; padding: 0; margin: 0;">',i.items.forEach(a=>{let l=!!a.is_upsell,d=l?'<span style="display: inline-block; background-color: #4CAF50; color: white; font-size: 10px; padding: 2px 5px; border-radius: 3px; margin-left: 5px;">UPSELL</span>':"";s+=`
          <li style="padding: 5px 0; border-bottom: 1px solid #eee; ${l?"background-color: rgba(76, 175, 80, 0.1);":""}">
            <div style="display: flex; justify-content: space-between;">
              <div style="font-weight: 500;">${a.name}${d}</div>
              <div>${a.quantity} Ã— ${r(a.price)}</div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
              <div style="color: #666; font-size: 12px;">
                ID: ${a.id}
                ${l?'<span style="color: #4CAF50; margin-left: 5px;">âœ“ is_upsell=true</span>':""}
              </div>
              <div style="font-weight: 500;">${r(a.price*a.quantity)}</div>
            </div>
          </li>
        `}),s+="</ul></div>"):s+='<div style="color: #999; text-align: center; margin-bottom: 15px;">Cart is empty</div>',i.totals?(s+="<div>",s+='<div style="font-weight: 600; margin-bottom: 10px;">Totals:</div>',s+='<ul style="list-style: none; padding: 0; margin: 0;">',s+=`
        <li style="display: flex; justify-content: space-between; padding: 3px 0;">
          <div>Subtotal:</div>
          <div>${r(i.totals.subtotal)}</div>
        </li>
      `,i.totals.retail_subtotal>i.totals.subtotal&&(s+=`
          <li style="display: flex; justify-content: space-between; padding: 3px 0;">
            <div>Retail Subtotal:</div>
            <div>${r(i.totals.retail_subtotal)}</div>
          </li>
        `,i.totals.savings&&(s+=`
            <li style="display: flex; justify-content: space-between; padding: 3px 0; color: #e53935;">
              <div>Savings:</div>
              <div>${r(i.totals.savings)} (${Math.round(i.totals.savings_percentage)}%)</div>
            </li>
          `)),i.totals.shipping>0&&(s+=`
          <li style="display: flex; justify-content: space-between; padding: 3px 0;">
            <div>Shipping:</div>
            <div>${r(i.totals.shipping)}</div>
          </li>
        `),i.totals.recurring_total>0&&(s+=`
          <li style="display: flex; justify-content: space-between; padding: 3px 0; color: #2196f3;">
            <div>Recurring Total:</div>
            <div>${r(i.totals.recurring_total)}</div>
          </li>
        `),s+=`
        <li style="display: flex; justify-content: space-between; padding: 3px 0; font-weight: 600; margin-top: 5px; border-top: 1px solid #eee;">
          <div>Total:</div>
          <div>${r(i.totals.total)}</div>
        </li>
      `,s+="</ul></div>"):s+='<div style="color: #999; text-align: center; margin-bottom: 15px;">Cart totals not available</div>',e.innerHTML=s};var Pl,be,Zt,Ll,Os,Gd,Il,Jg,ql,Zg,Fl,Xg,Us,Kd,$l=class{constructor(e){o(this,Os);o(this,Il);o(this,ql);o(this,Fl);o(this,Us);o(this,Pl,void 0);o(this,be,void 0);o(this,Zt,new Map);o(this,Ll,"os-timer-");u(this,Pl,e),u(this,be,e.logger.createModuleLogger("TIMER")),n(this,Os,Gd).call(this),t(this,be).infoWithTime("TimerManager initialized")}refreshTimers(){t(this,be).infoWithTime("Refreshing timers"),t(this,Zt).forEach(e=>{e.intervalId&&(clearInterval(e.intervalId),e.intervalId=null)}),t(this,Zt).clear(),n(this,Os,Gd).call(this)}getTimers(){return t(this,Zt)}};Pl=new WeakMap,be=new WeakMap,Zt=new WeakMap,Ll=new WeakMap,Os=new WeakSet,Gd=function(){t(this,be).infoWithTime("Initializing timers");let e=document.querySelectorAll('[data-os-element="timer"]');if(e.length===0){t(this,be).debugWithTime("No timer elements found on page");return}t(this,be).debugWithTime(`Found ${e.length} timer elements`),e.forEach(i=>{n(this,Il,Jg).call(this,i)})},Il=new WeakSet,Jg=function(e){let i=e.closest('[data-os-element="timer-text"]');i||t(this,be).warnWithTime('Timer element has no parent with data-os-element="timer-text", using default configuration');let r=n(this,ql,Zg).call(this,e,i);if(!r.duration){t(this,be).warnWithTime(`Timer element is missing duration, skipping: ${e.outerHTML}`);return}let s=i?i.innerHTML:null,a=+new Date,l=r.persistenceId;if(l){let g=t(this,Ll)+l,m=parseInt(localStorage.getItem(g)||"");m>0?(a=m,t(this,be).debugWithTime(`Loaded persisted timer start time for ${l}: ${new Date(a).toISOString()}`)):(localStorage.setItem(g,String(a)),t(this,be).debugWithTime(`Saved new timer start time for ${l}: ${new Date(a).toISOString()}`))}else t(this,be).debugWithTime(`Timer has no persistence ID, it will reset with every page load: ${e.outerHTML}`);let d={element:e,parentElement:i,config:r,startTime:a,intervalId:null,originalParentContent:s};t(this,Zt).set(e,d);let h=()=>{let m=(+new Date-a)/1e3,p=Math.round(r.duration-m);if(p<=0){p=0,r.expiryText?i&&r.replaceEntireContent?i.innerHTML=r.expiryText:e.innerText=r.expiryText:e.innerText="00:00",d.intervalId&&(clearInterval(d.intervalId),d.intervalId=null),t(this,Zt).delete(e),n(this,Us,Kd).call(this,"expired",e,{timerElement:e,parentElement:i,config:r});return}let S=Math.floor(p/3600);p-=S*3600;let b=Math.floor(p/60);p-=b*60;let y=n(this,Fl,Xg).call(this,S,b,p,r.format);e.innerText=y,n(this,Us,Kd).call(this,"updated",e,{timerElement:e,parentElement:i,config:r,remaining:{hours:S,minutes:b,seconds:p},formattedTime:y})};h(),d.intervalId=setInterval(h,1e3),t(this,be).debugWithTime(`Timer initialized: ${r.duration} seconds, persistence ID: ${r.persistenceId||"none"}`)},ql=new WeakSet,Zg=function(e,i){let r={duration:0,persistenceId:null,expiryText:null,format:"auto",replaceEntireContent:!1};return e.dataset.osDuration?r.duration=parseInt(e.dataset.osDuration):i?.dataset.osTimerDuration&&(r.duration=parseInt(i.dataset.osTimerDuration)),e.dataset.osPersistenceId?r.persistenceId=e.dataset.osPersistenceId:i?.dataset.osTimerPersistenceId&&(r.persistenceId=i.dataset.osTimerPersistenceId),e.dataset.osExpiryText?r.expiryText=e.dataset.osExpiryText:i?.dataset.osTimerExpiryText&&(r.expiryText=i.dataset.osTimerExpiryText),e.dataset.osFormat?r.format=e.dataset.osFormat:i?.dataset.osTimerFormat&&(r.format=i.dataset.osTimerFormat),(e.dataset.osReplaceEntireContent==="true"||i?.dataset.osTimerReplaceEntireContent==="true")&&(r.replaceEntireContent=!0),r.expiryText&&(r.expiryText.includes("<")||r.expiryText.includes(">"))&&(r.replaceEntireContent=!0),r},Fl=new WeakSet,Xg=function(e,i,r,s){let a=l=>l.toString().padStart(2,"0");return s==="hh:mm:ss"||s==="auto"&&e>0?`${a(e)}:${a(i)}:${a(r)}`:s==="mm:ss"||s==="auto"&&i>0?`${a(i)}:${a(r)}`:s==="ss"?a(r):`${a(i)}:${a(r)}`},Us=new WeakSet,Kd=function(e,i,r={}){let s=new CustomEvent(`os:timer.${e}`,{bubbles:!0,cancelable:!0,detail:{...r,manager:this}});i.dispatchEvent(s),document.dispatchEvent(s),t(this,be).debugWithTime(`Timer event triggered: ${e}`)};var vr,Le,wr,Rs,Yd,Nl,Qg,Ol,em,Ml=class{constructor(e){o(this,Rs);o(this,Nl);o(this,Ol);o(this,vr,void 0);o(this,Le,void 0);o(this,wr,new Map);u(this,vr,e),u(this,Le,e.logger.createModuleLogger("DISPLAY")),n(this,Rs,Yd).call(this),t(this,vr).state.subscribe("cart",()=>this.refreshDisplayElements()),t(this,Le).infoWithTime("DisplayManager initialized")}refreshDisplayElements(){t(this,Le).debugWithTime("Refreshing display elements");let i=t(this,vr).state.getState("cart").items.map(r=>r.id.toString());t(this,wr).forEach((r,s)=>{n(this,Nl,Qg).call(this,s,r,i)})}refresh(){t(this,Le).infoWithTime("Manually refreshing display elements"),t(this,wr).clear(),n(this,Rs,Yd).call(this)}};vr=new WeakMap,Le=new WeakMap,wr=new WeakMap,Rs=new WeakSet,Yd=function(){t(this,Le).infoWithTime("Initializing display elements");let e=document.querySelectorAll('[data-os-cart="swap-display"]');if(e.length===0){t(this,Le).debugWithTime("No swap display containers found on page");return}t(this,Le).debugWithTime(`Found ${e.length} swap display containers`),e.forEach((i,r)=>{let s=i.dataset.osId||`auto-container-${r}`,a=i.querySelectorAll('[data-os-in-cart="display"]');if(a.length===0){t(this,Le).warnWithTime(`Container ${s} has no display elements`);return}t(this,wr).set(i,{id:s,elements:Array.from(a).map(l=>({element:l,packageId:l.dataset.osPackage}))}),t(this,Le).debugWithTime(`Initialized container ${s} with ${a.length} display elements`)}),this.refreshDisplayElements()},Nl=new WeakSet,Qg=function(e,i,r){let{id:s,elements:a}=i,l=!1;for(let{element:d,packageId:h}of a)h&&r.includes(h)?(d.style.display="block",l=!0,t(this,Le).debugWithTime(`Showing element for package ${h} in container ${s}`)):d.style.display="none";!l&&a.length>0,n(this,Ol,em).call(this,"updated",e,{containerId:s,hasVisibleElement:l,visiblePackageIds:a.filter(({element:d})=>d.style.display==="block").map(({packageId:d})=>d)})},Ol=new WeakSet,em=function(e,i,r={}){let s=new CustomEvent(`os:display.${e}`,{bubbles:!0,cancelable:!0,detail:{...r,manager:this}});i.dispatchEvent(s),document.dispatchEvent(s),t(this,Le).debugWithTime(`Display event triggered: ${e}`)};var Xt,k,A,gt,Sr,zs,Jd,Rl,tm,zl,im,Dl,rm,Bl,sm,Vl,nm,Hl,om,Wl,am,jl,lm,ve,Ie,Gl,cm,Kl,dm,Zd,zp,Ul=class{constructor(e){o(this,zs);o(this,Rl);o(this,zl);o(this,Dl);o(this,Bl);o(this,Vl);o(this,Hl);o(this,Wl);o(this,jl);o(this,ve);o(this,Gl);o(this,Kl);o(this,Zd);o(this,Xt,void 0);o(this,k,void 0);o(this,A,{lineDisplays:[],summaryContainers:[],savingsBars:[],shippingBars:[],grandTotals:[],subtotals:[],summaryBars:[],summaryPanels:[],summaryTexts:[],summaryIcons:[],compareTotalElements:[]});o(this,gt,{currencySymbol:"$",showComparePricing:!0,showProductImages:!0,showTaxPendingMessage:!0});o(this,Sr,null);u(this,Xt,e),u(this,k,e.logger.createModuleLogger("CART_DISPLAY")),n(this,zs,Jd).call(this),t(this,Xt).state.subscribe("cart",()=>this.updateCartDisplay()),t(this,k).infoWithTime("CartDisplayManager initialized")}updateCartDisplay(){t(this,k).debugWithTime("Updating cart display");let e=t(this,Xt).state.getState("cart");if(!e){t(this,k).warnWithTime("Cart data not available");return}t(this,k).debugWithTime(`Cart data: ${JSON.stringify(e)}`),n(this,Dl,rm).call(this,e.items),n(this,Vl,nm).call(this,e.totals),n(this,Hl,om).call(this,e.totals.shipping,e.shippingMethod),n(this,Wl,am).call(this,e.totals),n(this,jl,lm).call(this,e.totals.total),n(this,Kl,dm).call(this,e.totals),t(this,k).debugWithTime("Cart display updated")}refresh(){t(this,k).infoWithTime("Manually refreshing cart display"),n(this,zs,Jd).call(this)}};Xt=new WeakMap,k=new WeakMap,A=new WeakMap,gt=new WeakMap,Sr=new WeakMap,zs=new WeakSet,Jd=function(){if(t(this,k).infoWithTime("Initializing cart display"),t(this,A).lineDisplays=document.querySelectorAll('[data-os-cart-summary="line-display"]'),t(this,A).summaryContainers=document.querySelectorAll('[data-os-cart="summary"]'),t(this,A).savingsBars=document.querySelectorAll('[data-os-cart-summary="savings"]'),t(this,A).shippingBars=document.querySelectorAll('[data-os-cart-summary="shipping-bar"]'),t(this,A).grandTotals=document.querySelectorAll('[data-os-cart-summary="grand-total"]'),t(this,A).subtotals=document.querySelectorAll('[data-os-cart-summary="subtotal"]'),t(this,A).summaryBars=document.querySelectorAll('[os-checkout-element="summary-bar"]'),t(this,A).summaryPanels=document.querySelectorAll('[os-checkout-element="summary-mobile"]'),t(this,A).summaryTexts=document.querySelectorAll('[os-checkout-element="summary-text"]'),t(this,A).summaryIcons=document.querySelectorAll("[os-summary-icon]"),t(this,A).compareTotalElements=document.querySelectorAll('[data-os-cart-summary="compare-total"]'),t(this,k).debugWithTime(`Line displays found: ${t(this,A).lineDisplays.length}`),t(this,k).debugWithTime(`Summary containers found: ${t(this,A).summaryContainers.length}`),t(this,k).debugWithTime(`Savings bars found: ${t(this,A).savingsBars.length}`),t(this,k).debugWithTime(`Shipping bars found: ${t(this,A).shippingBars.length}`),t(this,k).debugWithTime(`Grand total elements found: ${t(this,A).grandTotals.length}`),t(this,k).debugWithTime(`Subtotal elements found: ${t(this,A).subtotals.length}`),t(this,k).debugWithTime(`Summary bars found: ${t(this,A).summaryBars.length}`),t(this,k).debugWithTime(`Summary panels found: ${t(this,A).summaryPanels.length}`),t(this,k).debugWithTime(`Summary texts found: ${t(this,A).summaryTexts.length}`),t(this,k).debugWithTime(`Summary icons found: ${t(this,A).summaryIcons.length}`),t(this,k).debugWithTime(`Compare total elements found: ${t(this,A).compareTotalElements.length}`),t(this,A).summaryContainers.length>0){let i=t(this,A).summaryContainers[0];t(this,gt).showComparePricing=i.dataset.showComparePricing!=="false",t(this,gt).showProductImages=i.dataset.showProductImages!=="false",t(this,gt).showTaxPendingMessage=i.dataset.showTaxPendingMessage!=="false",t(this,gt).currencySymbol=i.dataset.currencySymbol||"$"}let e=document.querySelector('[data-os-cart-summary="line-item"]');e&&u(this,Sr,e.cloneNode(!0)),n(this,Rl,tm).call(this),t(this,k).debugWithTime("Cart display elements initialized"),this.updateCartDisplay()},Rl=new WeakSet,tm=function(){let{summaryBars:e,summaryPanels:i,summaryTexts:r,summaryIcons:s}=t(this,A);if(!e.length||!i.length){t(this,k).debugWithTime("Summary toggle elements not found, skipping initialization");return}t(this,k).debugWithTime("Initializing summary toggle"),i.forEach((a,l)=>{if(a.classList.add("no-transition"),!a.classList.contains("cc-expanded")){a.style.height="0",a.style.opacity="0",a.style.overflow="hidden";let d=r[l];d&&(d.textContent="Show Order Summary")}requestAnimationFrame(()=>{a.classList.remove("no-transition"),a.style.transition="height 0.3s ease-out, opacity 0.25s ease-out"})}),e.forEach((a,l)=>{a.addEventListener("click",d=>{d.preventDefault(),n(this,zl,im).call(this,l)})}),window.addEventListener("resize",n(this,Gl,cm).call(this,()=>{i.forEach(a=>{a.classList.contains("cc-expanded")&&(a.style.height="auto")})},250)),t(this,k).debugWithTime("Summary toggle initialized")},zl=new WeakSet,im=function(e=0){let{summaryPanels:i,summaryTexts:r,summaryIcons:s}=t(this,A),a=i[e],l=r[e],d=s[e];if(!a)return;if(!a.classList.contains("cc-expanded"))a.classList.add("cc-expanded"),a.style.height=`${a.scrollHeight}px`,a.style.opacity="1",l&&(l.textContent="Hide Order Summary"),d&&(d.style.transform="rotate(180deg)"),a.addEventListener("transitionend",()=>{a.classList.contains("cc-expanded")&&(a.style.height="auto")},{once:!0}),t(this,k).debugWithTime("Summary panel expanded");else{let g=a.scrollHeight;a.style.height=`${g}px`,a.offsetHeight,a.style.height="0",a.style.opacity="0",l&&(l.textContent="Show Order Summary"),d&&(d.style.transform="rotate(0deg)"),a.addEventListener("transitionend",()=>{a.style.height==="0px"&&a.classList.remove("cc-expanded")},{once:!0}),t(this,k).debugWithTime("Summary panel collapsed")}},Dl=new WeakSet,rm=function(e){if(!t(this,A).lineDisplays.length||!t(this,Sr)){t(this,k).warnWithTime("Line displays or template not found");return}if(!e||e.length===0){t(this,k).debugWithTime("No items in cart");return}t(this,A).lineDisplays.forEach(r=>{r.innerHTML="",e.forEach(s=>{let a=n(this,Bl,sm).call(this,s);r.appendChild(a)})});let i=document.querySelectorAll('[data-os-cart-summary="summary-scroll"]');if(i.length){let r=e.length>2;i.forEach(s=>{s.classList.toggle("hide",!r)})}},Bl=new WeakSet,sm=function(e){let i=t(this,Sr).cloneNode(!0),r=i.querySelector('[data-os-cart-summary="line-title"]');if(r&&(r.textContent=e.name),t(this,gt).showProductImages){let h=i.querySelector('[data-os-cart-summary="line-image"]');h&&e.image&&(h.src=e.image,h.alt=e.name)}let s=i.querySelector('[os-cart="line_item-qty"]');s&&(s.textContent=e.quantity||1);let a=i.querySelector('[data-os-cart-summary="line-compare"]'),l=i.querySelector('[data-os-cart-summary="line-sale"]');a&&e.retail_price&&t(this,gt).showComparePricing?(a.textContent=n(this,ve,Ie).call(this,e.retail_price*(e.quantity||1)),a.classList.remove("hide")):a&&a.classList.add("hide"),l&&(l.textContent=n(this,ve,Ie).call(this,e.price*(e.quantity||1)));let d=i.querySelector('[data-os-cart-summary="line-saving-percent"]');if(d&&e.retail_price){let h=Math.round((1-e.price/e.retail_price)*100);if(h>0){let g=d.dataset.osFormat||"default",m=`${h}% OFF`;g==="parenthesis"&&(m=`(${h}% OFF)`),d.textContent=m,d.classList.remove("hide")}else d.classList.add("hide")}else d&&d.classList.add("hide");return i},Vl=new WeakSet,nm=function(e){e&&t(this,A).subtotals.length&&(t(this,A).subtotals.forEach(i=>{i.textContent=n(this,ve,Ie).call(this,e.subtotal)}),t(this,k).debugWithTime(`Updated subtotal to: ${n(this,ve,Ie).call(this,e.subtotal)}`))},Hl=new WeakSet,om=function(e,i){if(!t(this,A).shippingBars.length){t(this,k).warnWithTime("Shipping bars not found");return}t(this,A).shippingBars.forEach(r=>{let s=r.querySelector('[data-os-cart-summary="shipping-compare"]'),a=r.querySelector('[data-os-cart-summary="shipping-current"]');s&&a&&(e===0&&i?.standard_cost>0?(s.textContent=n(this,ve,Ie).call(this,i.standard_cost),a.textContent="FREE",s.classList.remove("hide")):e>0?(a.textContent=n(this,ve,Ie).call(this,e),s.classList.add("hide")):(a.textContent="FREE",s.classList.add("hide")))})},Wl=new WeakSet,am=function(e){if(!t(this,A).savingsBars.length){t(this,k).warnWithTime("Savings bars not found");return}t(this,A).savingsBars.forEach(s=>{let a=s.querySelector('[data-os-cart-summary="savings-amount"]'),l=s.querySelector('[data-os-cart-summary="savings-percentage"]');e.savings>0&&e.savings_percentage>0?(a&&(a.textContent=n(this,ve,Ie).call(this,e.savings),t(this,k).debugWithTime(`Updated savings amount to: ${n(this,ve,Ie).call(this,e.savings)}`)),l&&(l.textContent=`${Math.round(e.savings_percentage)}% OFF`,t(this,k).debugWithTime(`Updated savings percentage to: ${Math.round(e.savings_percentage)}% OFF`)),s.classList.remove("hide")):s.classList.add("hide")});let i=document.querySelectorAll('[data-os-cart-summary="savings-amount"]'),r=document.querySelectorAll('[data-os-cart-summary="savings-percentage"]');e.savings>0&&e.savings_percentage>0&&(i.forEach(s=>{s.textContent=n(this,ve,Ie).call(this,e.savings)}),r.forEach(s=>{s.textContent=`${Math.round(e.savings_percentage)}% OFF`}))},jl=new WeakSet,lm=function(e){if(!t(this,A).grandTotals.length){t(this,k).warnWithTime("Grand total elements not found");return}t(this,A).grandTotals.forEach(i=>{i.textContent=n(this,ve,Ie).call(this,e)}),t(this,k).debugWithTime(`Updated grand total to: ${n(this,ve,Ie).call(this,e)}`)},ve=new WeakSet,Ie=function(e){return t(this,Xt).campaign?.formatPrice?t(this,Xt).campaign.formatPrice(e):`${t(this,gt).currencySymbol}${e.toFixed(2)} USD`},Gl=new WeakSet,cm=function(e,i){let r;return function(...a){let l=()=>{clearTimeout(r),e(...a)};clearTimeout(r),r=setTimeout(l,i)}},Kl=new WeakSet,dm=function(e){if(!t(this,A).compareTotalElements.length){t(this,k).debugWithTime("No compare-total elements found");return}t(this,k).debugWithTime("Updating compare-total elements"),t(this,k).debugWithTime(`Cart totals: ${JSON.stringify(e)}`),t(this,A).compareTotalElements.forEach(i=>{let r=i.dataset.totalType||"retail",s=null;switch(r){case"retail":s=e.retail_subtotal;break;case"recurring":s=e.recurring_total;break;case"subtotal_compare":case"original":case"msrp":s=e[r]||null;break;default:s=e.retail_subtotal}s&&s>e.total?(i.textContent=n(this,ve,Ie).call(this,s),i.classList.remove("hide"),t(this,k).debugWithTime(`Updated compare-total (${r}) to: ${n(this,ve,Ie).call(this,s)}`)):(i.classList.add("hide"),t(this,k).debugWithTime(`Hiding compare-total element (${r}): compareValue=${s}, total=${e.total}`))})},Zd=new WeakSet,zp=function(e){return document.querySelectorAll(`[${e}]`)};var ce,M,$,Zl,Xl,um,Ql,hm,ec,gm,tc,mm,_r,Yl,ic,pm,Ds,Xd,rc,fm,sc,ym,te,ne,Bs,Qd,nc,bm,oc,vm,Jl=class{constructor(e){o(this,Xl);o(this,Ql);o(this,ec);o(this,tc);o(this,_r);o(this,ic);o(this,Ds);o(this,rc);o(this,sc);o(this,te);o(this,Bs);o(this,nc);o(this,oc);o(this,ce,void 0);o(this,M,void 0);o(this,$,{});o(this,Zl,!1);u(this,ce,e),u(this,M,e.logger.createModuleLogger("ATTRIBUTION")),n(this,Xl,um).call(this)}updateAttributionData(e){e.metadata&&t(this,$).metadata&&(e.metadata={...t(this,$).metadata,...e.metadata}),e.funnel&&t(this,M).debug(`Updating funnel value to: ${e.funnel}`),u(this,$,{...t(this,$),...e}),n(this,_r,Yl).call(this),t(this,M).debug("Attribution data updated",e),t(this,ce).events&&t(this,ce).events.trigger("attribution.updated",{attribution:t(this,$)})}getAttributionData(){return{...t(this,$)}}getAttributionForApi(){let e=t(this,$).metadata?.everflow_transaction_id||"";return{affiliate:t(this,$).affiliate,funnel:t(this,$).funnel,gclid:t(this,$).gclid,metadata:t(this,$).metadata,everflow_transaction_id:e,utm_source:t(this,$).utm_source,utm_medium:t(this,$).utm_medium,utm_campaign:t(this,$).utm_campaign,utm_content:t(this,$).utm_content,utm_term:t(this,$).utm_term,subaffiliate1:t(this,$).subaffiliate1,subaffiliate2:t(this,$).subaffiliate2,subaffiliate3:t(this,$).subaffiliate3,subaffiliate4:t(this,$).subaffiliate4,subaffiliate5:t(this,$).subaffiliate5}}debug(){console.group("AttributionManager Debug Info");let e=document.querySelector('meta[name="os-tracking-tag"][data-tag-name="funnel_name"]'),i=e?e.getAttribute("data-tag-value"):"",r=t(this,ce).campaign?.getCampaignName()||t(this,ce).campaignData?.name||"";t(this,$).affiliate,t(this,$).funnel,localStorage.getItem("evclid"),sessionStorage.getItem("evclid"),t(this,$).metadata?.everflow_transaction_id,typeof window.EF<"u",console.group("API Formatted Attribution Data (What gets sent to API)");let s=this.getAttributionForApi();s.affiliate,s.funnel,s.gclid,s.utm_source,s.utm_medium,s.utm_campaign,s.utm_content,s.utm_term,s.subaffiliate1,s.subaffiliate2,s.subaffiliate3,s.subaffiliate4,s.subaffiliate5,console.group("Metadata Object:"),s.metadata.domain,s.metadata.device,s.metadata.device_type,s.metadata.fb_fbp,s.metadata.fb_fbc,s.metadata.fb_pixel_id,s.metadata,console.groupEnd(),console.groupEnd(),t(this,$),new URLSearchParams(window.location.search).toString(),console.group("Tracking Tags");let a=document.querySelectorAll('meta[name="os-tracking-tag"]');return a.length>0&&a.forEach(l=>{`${l.getAttribute("data-tag-name")}${l.getAttribute("data-tag-value")}`,l.getAttribute("data-persist")}),console.groupEnd(),e&&e.getAttribute("data-tag-value"),t(this,ce).campaignData?.name,t(this,ce).state&&t(this,ce).state.getState("attribution"),console.groupEnd(),"Attribution debug info logged to console."}setFunnelName(e){return e?(t(this,$).funnel=e,n(this,_r,Yl).call(this),t(this,M).info(`Funnel name set to: ${e}`),!0):(t(this,M).warn("Cannot set empty funnel name"),!1)}setEverflowClickId(e){if(!e)return t(this,M).warn("Cannot set empty Everflow click ID"),!1;localStorage.setItem("evclid",e),sessionStorage.setItem("evclid",e);let i=t(this,$).metadata||{};return i.everflow_transaction_id=e,this.updateAttributionData({metadata:i}),t(this,M).info(`Everflow click ID set to: ${e}`),!0}};ce=new WeakMap,M=new WeakMap,$=new WeakMap,Zl=new WeakMap,Xl=new WeakSet,um=function(){t(this,M).info("Initializing AttributionManager"),n(this,Ql,hm).call(this),n(this,_r,Yl).call(this),n(this,sc,ym).call(this),u(this,Zl,!0),t(this,M).info("AttributionManager initialized successfully")},Ql=new WeakSet,hm=function(){let e={landing_page:window.location.href||"",referrer:document.referrer||"",device:navigator.userAgent||"",device_type:n(this,nc,bm).call(this),timestamp:Date.now(),domain:window.location.hostname,fb_fbp:n(this,Bs,Qd).call(this,"_fbp")||"",fb_fbc:n(this,Bs,Qd).call(this,"_fbc")||"",fb_pixel_id:n(this,oc,vm).call(this)},i=n(this,te,ne).call(this,"fbclid")||"";i&&(e.fbclid=i),n(this,ec,gm).call(this,e),n(this,tc,mm).call(this,e);let r=n(this,te,ne).call(this,"affid")||n(this,te,ne).call(this,"aff")||"";u(this,$,{affiliate:r,funnel:"",gclid:n(this,te,ne).call(this,"gclid")||"",metadata:e,utm_source:n(this,te,ne).call(this,"utm_source")||"",utm_medium:n(this,te,ne).call(this,"utm_medium")||"",utm_campaign:n(this,te,ne).call(this,"utm_campaign")||"",utm_content:n(this,te,ne).call(this,"utm_content")||"",utm_term:n(this,te,ne).call(this,"utm_term")||"",fbclid:i,subaffiliate1:n(this,te,ne).call(this,"subaffiliate1")||n(this,te,ne).call(this,"sub1")||"",subaffiliate2:n(this,te,ne).call(this,"subaffiliate2")||n(this,te,ne).call(this,"sub2")||"",subaffiliate3:n(this,te,ne).call(this,"subaffiliate3")||n(this,te,ne).call(this,"sub3")||"",subaffiliate4:n(this,te,ne).call(this,"subaffiliate4")||n(this,te,ne).call(this,"sub4")||"",subaffiliate5:n(this,te,ne).call(this,"subaffiliate5")||n(this,te,ne).call(this,"sub5")||"",first_visit_timestamp:n(this,rc,fm).call(this),current_visit_timestamp:Date.now()}),t(this,M).debug("Attribution data collected")},ec=new WeakSet,gm=function(e){let i=new URLSearchParams(window.location.search),r=localStorage.getItem("evclid");if(i.has("evclid")?(r=i.get("evclid"),localStorage.setItem("evclid",r),sessionStorage.setItem("evclid",r),t(this,M).debug(`Everflow click ID found in URL: ${r}`)):!r&&sessionStorage.getItem("evclid")&&(r=sessionStorage.getItem("evclid"),localStorage.setItem("evclid",r),t(this,M).debug(`Everflow click ID found in sessionStorage: ${r}`)),i.has("sg_evclid")){let s=i.get("sg_evclid");sessionStorage.setItem("sg_evclid",s),localStorage.setItem("sg_evclid",s),e.sg_evclid=s,t(this,M).debug(`SG Everflow click ID found: ${s}`)}else localStorage.getItem("sg_evclid")&&(e.sg_evclid=localStorage.getItem("sg_evclid"));r&&(e.everflow_transaction_id=r,t(this,M).debug(`Added Everflow transaction ID to metadata: ${r}`))},tc=new WeakSet,mm=function(e){let i=document.querySelectorAll('meta[name="os-tracking-tag"]');t(this,M).debug(`Found ${i.length} tracking tags`),i.forEach(r=>{let s=r.getAttribute("data-tag-name"),a=r.getAttribute("data-tag-value"),l=r.getAttribute("data-persist")==="true";if(s&&a&&(e[s]=a,t(this,M).debug(`Added tracking tag: ${s} = ${a}`),l))try{sessionStorage.setItem(`os_tag_${s}`,a),t(this,M).debug(`Persisted tracking tag: ${s} = ${a}`)}catch(d){t(this,M).error(`Error persisting tracking tag ${s}:`,d)}})},_r=new WeakSet,Yl=function(){if(!t(this,ce).state){t(this,M).warn("State manager not available, attribution data will not be stored");return}t(this,ce).state.setState("cart.attribution",t(this,$)),t(this,ce).state.setState("attribution",this.getAttributionForApi()),n(this,ic,pm).call(this),t(this,ce).events&&t(this,ce).events.trigger("attribution.updated",{attribution:t(this,$)}),t(this,M).debug("Attribution data stored in state")},ic=new WeakSet,pm=function(){try{localStorage.setItem("os_attribution",JSON.stringify(t(this,$))),t(this,M).debug("Attribution data persisted to localStorage")}catch(e){t(this,M).error("Error persisting attribution data to localStorage:",e)}},Ds=new WeakSet,Xd=function(){try{let e=localStorage.getItem("os_attribution");if(e)return JSON.parse(e)}catch(e){t(this,M).error("Error loading attribution data from localStorage:",e)}return{}},rc=new WeakSet,fm=function(){let e=n(this,Ds,Xd).call(this);return e.first_visit_timestamp?e.first_visit_timestamp:Date.now()},sc=new WeakSet,ym=function(){window.addEventListener("popstate",()=>{let e=t(this,$).metadata||{};e.landing_page=window.location.href,this.updateAttributionData({metadata:e})}),t(this,ce).events&&(t(this,ce).events.on("campaign.loaded",e=>{if(e&&e.campaign&&e.campaign.name&&!t(this,$).funnel){let r=document.querySelector('meta[name="os-tracking-tag"][data-tag-name="funnel_name"]')?.getAttribute("data-tag-value")||e.campaign.name;this.setFunnelName(r)}}),t(this,ce).events.on("prospect.cartCreated",()=>{let e=t(this,$).metadata||{};e.conversion_timestamp=Date.now(),this.updateAttributionData({metadata:e}),t(this,M).debug("Cart created, updated metadata with conversion timestamp")}))},te=new WeakSet,ne=function(e){let i=new URLSearchParams(window.location.search);if(i.has(e)){let s=i.get(e);try{sessionStorage.setItem(e,s)}catch(a){t(this,M).error(`Error storing ${e} in sessionStorage:`,a)}return s}try{if(sessionStorage.getItem(e))return sessionStorage.getItem(e)}catch(s){t(this,M).error(`Error reading ${e} from sessionStorage:`,s)}try{if(localStorage.getItem(e))return localStorage.getItem(e)}catch(s){t(this,M).error(`Error reading ${e} from localStorage:`,s)}let r=n(this,Ds,Xd).call(this);return r[e]?r[e]:""},Bs=new WeakSet,Qd=function(e){let r=`; ${document.cookie}`.split(`; ${e}=`);return r.length===2?r.pop().split(";").shift():""},nc=new WeakSet,bm=function(){let e=navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)?"mobile":"desktop"},oc=new WeakSet,vm=function(){let e=document.querySelector('meta[name="os-facebook-pixel"]');if(e){let r=e.getAttribute("content");if(r)return t(this,M).debug(`Facebook Pixel ID found from os-facebook-pixel meta tag: ${r}`),r}let i=document.querySelectorAll("script");for(let r of i){let s=r.textContent||"";if(s.includes("fbq(")&&s.includes("init")){let a=s.match(/fbq\s*\(\s*['"]init['"],\s*['"](\d+)['"]/);if(a&&a[1])return a[1]}}return""};var mt,w,Vs,de,lc,Lt,cc,wm,dc,Sm,uc,_m,hc,xm,gc,Cm,mc,Em,Qt,xr,ac=class{constructor(e){o(this,cc);o(this,dc);o(this,uc);o(this,hc);o(this,gc);o(this,mc);o(this,Qt);o(this,mt,void 0);o(this,w,void 0);o(this,Vs,!1);o(this,de,{gtm:{enabled:!1,initialized:!1},fbPixel:{enabled:!1,initialized:!1},ga4:{enabled:!1,initialized:!1}});o(this,lc,!1);o(this,Lt,new Set);u(this,mt,e),u(this,w,e.logger.createModuleLogger("EVENT")),u(this,lc,e.options?.debug||!1),this.init()}init(){t(this,w).info("Initializing EventManager"),n(this,uc,_m).call(this),n(this,hc,xm).call(this),n(this,cc,wm).call(this),u(this,Vs,!0),t(this,w).info("EventManager initialized")}viewItemList(e){if(t(this,w).debug("viewItemList called with campaign data:",e?"present":"missing"),!e||!e.packages||e.packages.length===0){t(this,w).warn("Cannot fire view_item_list event: No packages found in campaign data");return}t(this,w).debug(`Found ${e.packages.length} packages in campaign data`);let i=e.packages.map(s=>({item_id:s.external_id||s.ref_id,item_name:s.name,price:parseFloat(s.price)||0,currency:e.currency||"USD",quantity:1})),r={event:"view_item_list",ecommerce:{currency:e.currency||"USD",items:i}};t(this,w).debug("Firing view_item_list event with data:",r),n(this,Qt,xr).call(this,"view_item_list",r)}addToCart(e){let i=!e.items&&!e.totals,r=[],s="USD",a=0;if(i){if(t(this,w).debug("addToCart called with single package, converting to cart format"),!e){t(this,w).warn("Cannot fire add_to_cart event: No package data provided");return}let d=e,h={item_id:d.external_id||d.ref_id||d.id,item_name:d.name,price:parseFloat(d.price)||0,currency:d.currency||t(this,mt).getCampaignData()?.currency||"USD",quantity:d.quantity||1};r=[h],s=h.currency,a=h.price*h.quantity}else{if(!e||!e.items||e.items.length===0){t(this,w).warn("Cannot fire add_to_cart event: No items in cart");return}r=e.items.map(d=>({item_id:d.external_id||d.id,item_name:d.name,price:parseFloat(d.price)||0,currency:e.totals?.currency||"USD",quantity:d.quantity||1})),s=e.totals?.currency||"USD",a=e.totals?.total||0}let l={event:"add_to_cart",ecommerce:{currency:s,value:a,items:r}};n(this,Qt,xr).call(this,"add_to_cart",l)}purchase(e,i=!1){if(!e||!e.lines||e.lines.length===0){t(this,w).warn("Cannot fire purchase event: No items in order");return}let r=e.number||e.ref_id;if(t(this,w).debug(`Purchase method called for order ${r}, force=${i}, already processed=${t(this,Lt).has(r)}`),!i&&r&&t(this,Lt).has(r)){t(this,w).info(`Purchase event for order ${r} already fired, skipping`);return}t(this,w).info(`Preparing to fire purchase event for order ${r}`);let s=e.lines.map(d=>({item_id:d.product_id||d.id,item_name:d.product_title||d.name,price:parseFloat(d.price_incl_tax||d.price)||0,currency:e.currency||"USD",quantity:d.quantity||1})),a=n(this,gc,Cm).call(this,e),l={event:"purchase",ecommerce:{transaction_id:r,value:parseFloat(e.total_incl_tax||e.total)||0,tax:parseFloat(e.total_tax)||0,shipping:parseFloat(e.shipping_incl_tax||e.shipping)||0,currency:e.currency||"USD",coupon:e.vouchers?.length>0?e.vouchers[0].code:"",...a,items:s}};n(this,Qt,xr).call(this,"purchase",l),r&&(t(this,Lt).add(r),n(this,dc,Sm).call(this),t(this,w).debug(`Marked order ${r} as processed, total processed orders: ${t(this,Lt).size}`))}viewItem(e){if(!e){t(this,w).warn("Cannot fire view_item event: No package data provided");return}let i={item_id:e.ref_id||e.external_id||e.id,item_name:e.name,price:parseFloat(e.price)||0,currency:e.currency||t(this,mt).getCampaignData()?.currency||"USD",quantity:1},r={event:"view_item",ecommerce:{currency:i.currency,value:i.price,items:[i]}};n(this,Qt,xr).call(this,"view_item",r)}beginCheckout(){let e=t(this,mt).state.getState("cart");if(!e||!e.items||e.items.length===0){t(this,w).warn("Cannot fire begin_checkout event: No items in cart");return}let i=e.items.map(s=>({item_id:s.external_id||s.id,item_name:s.name,price:parseFloat(s.price)||0,currency:e.totals?.currency||"USD",quantity:s.quantity||1})),r={event:"begin_checkout",ecommerce:{currency:e.totals?.currency||"USD",value:e.totals?.total||0,items:i}};n(this,Qt,xr).call(this,"begin_checkout",r)}fireCustomEvent(e,i={}){if(!e){t(this,w).warn("Cannot fire custom event: No event name provided");return}let r={event:e,...i};t(this,w).debug(`Firing custom event: ${e}`,r),t(this,de).gtm.enabled&&(window.dataLayer=window.dataLayer||[],window.dataLayer.push(r),t(this,w).debug(`Custom event ${e} fired to Google Tag Manager`)),t(this,de).fbPixel.enabled&&typeof window.fbq=="function"&&(window.fbq("trackCustom",e,i),t(this,w).debug(`Custom event ${e} fired to Facebook Pixel`)),t(this,de).ga4.enabled&&typeof window.gtag=="function"&&(window.gtag("event",e,i),t(this,w).debug(`Custom event ${e} fired to Google Analytics 4`));let s=new CustomEvent(`os:${e}`,{bubbles:!0,detail:r});document.dispatchEvent(s)}setPlatformEnabled(e,i){t(this,de)[e]?(t(this,de)[e].enabled=i,t(this,w).info(`${e} ${i?"enabled":"disabled"}`)):t(this,w).warn(`Unknown platform: ${e}`)}getPlatformStatus(){return{...t(this,de)}}get isInitialized(){return t(this,Vs)}};mt=new WeakMap,w=new WeakMap,Vs=new WeakMap,de=new WeakMap,lc=new WeakMap,Lt=new WeakMap,cc=new WeakSet,wm=function(){try{let e=sessionStorage.getItem("os_processed_order_ids");if(e){let i=JSON.parse(e);Array.isArray(i)&&(i.forEach(r=>t(this,Lt).add(r)),t(this,w).debug(`Loaded ${i.length} processed order IDs from sessionStorage`))}}catch(e){t(this,w).error("Error loading processed order IDs from sessionStorage:",e)}},dc=new WeakSet,Sm=function(){try{let e=Array.from(t(this,Lt));sessionStorage.setItem("os_processed_order_ids",JSON.stringify(e)),t(this,w).debug(`Saved ${e.length} processed order IDs to sessionStorage`)}catch(e){t(this,w).error("Error saving processed order IDs to sessionStorage:",e)}},uc=new WeakSet,_m=function(){typeof window.dataLayer<"u"?(t(this,de).gtm.enabled=!0,t(this,de).gtm.initialized=!0,t(this,w).info("Google Tag Manager detected")):t(this,w).info("Google Tag Manager not detected"),typeof window.fbq<"u"?(t(this,de).fbPixel.enabled=!0,t(this,de).fbPixel.initialized=!0,t(this,w).info("Facebook Pixel detected")):t(this,w).info("Facebook Pixel not detected"),typeof window.gtag<"u"?(t(this,de).ga4.enabled=!0,t(this,de).ga4.initialized=!0,t(this,w).info("Google Analytics 4 detected")):t(this,w).info("Google Analytics 4 not detected")},hc=new WeakSet,xm=function(){t(this,mt).on("campaign.loaded",e=>{t(this,w).debug("Campaign loaded event received, firing view_item_list"),e&&e.campaign?this.viewItemList(e.campaign):t(this,w).warn("Campaign loaded event received but no campaign data found")}),t(this,mt).on("cart.updated",e=>{e.cart&&e.cart.items&&e.cart.items.length>0&&this.addToCart(e.cart)}),t(this,mt).on("order.loaded",e=>{t(this,w).debug("Received order.loaded event with data:",JSON.stringify(e,null,2)),e.order?(t(this,w).info("Order loaded on receipt page, checking if purchase event needed"),this.purchase(e.order)):t(this,w).warn("Order.loaded event received but no order data found",e)})},gc=new WeakSet,Cm=function(e){let i={};return e.user&&(e.user.first_name&&(i.firstname=e.user.first_name),e.user.last_name&&(i.lastname=e.user.last_name),e.user.email&&(i.email_hash=n(this,mc,Em).call(this,e.user.email))),e.shipping_address&&(i.city=e.shipping_address.line4||"",i.state=e.shipping_address.state||"",i.zipcode=e.shipping_address.postcode||"",i.country=e.shipping_address.country||""),i},mc=new WeakSet,Em=function(e){let i=0;if(e.length===0)return i.toString();for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);i=(i<<5)-i+s,i=i&i}return i.toString()},Qt=new WeakSet,xr=function(e,i){if(t(this,w).debug(`Firing ${e} event`,i),t(this,de).gtm.enabled?(window.dataLayer=window.dataLayer||[],t(this,w).debug("Clearing previous ecommerce data in dataLayer"),window.dataLayer.push({ecommerce:null}),`${e}`,window.dataLayer.push(i),t(this,w).debug(`${e} event fired to Google Tag Manager`)):(t(this,w).warn(`Cannot fire ${e} event to GTM: GTM not enabled`),window.dataLayer=window.dataLayer||[],window.dataLayer.push({ecommerce:null}),window.dataLayer.push(i)),t(this,de).fbPixel.enabled){switch(e){case"view_item_list":window.fbq("track","ViewContent",{content_type:"product_group",content_ids:i.ecommerce.items.map(s=>s.item_id),currency:i.ecommerce.currency});break;case"add_to_cart":window.fbq("track","AddToCart",{content_type:"product_group",content_ids:i.ecommerce.items.map(s=>s.item_id),currency:i.ecommerce.currency,value:i.ecommerce.value});break;case"purchase":window.fbq("track","Purchase",{content_type:"product_group",content_ids:i.ecommerce.items.map(s=>s.item_id),currency:i.ecommerce.currency,value:i.ecommerce.value});break}t(this,w).debug(`${e} event fired to Facebook Pixel`)}t(this,de).ga4.enabled&&(window.gtag("event",e,{currency:i.ecommerce.currency,value:i.ecommerce.value,items:i.ecommerce.items}),t(this,w).debug(`${e} event fired to Google Analytics 4`));let r=new CustomEvent(`os:${e}`,{bubbles:!0,detail:i});document.dispatchEvent(r)};var _i=Math.min,ei=Math.max,Ws=Math.round;var it=c=>({x:c,y:c}),Dp={left:"right",right:"left",bottom:"top",top:"bottom"},Bp={start:"end",end:"start"};function fc(c,e,i){return ei(c,_i(e,i))}function Cr(c,e){return typeof c=="function"?c(e):c}function ti(c){return c.split("-")[0]}function Er(c){return c.split("-")[1]}function eu(c){return c==="x"?"y":"x"}function yc(c){return c==="y"?"height":"width"}function xi(c){return["top","bottom"].includes(ti(c))?"y":"x"}function bc(c){return eu(xi(c))}function km(c,e,i){i===void 0&&(i=!1);let r=Er(c),s=bc(c),a=yc(s),l=s==="x"?r===(i?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[a]>e.floating[a]&&(l=Hs(l)),[l,Hs(l)]}function Am(c){let e=Hs(c);return[pc(c),e,pc(e)]}function pc(c){return c.replace(/start|end/g,e=>Bp[e])}function Vp(c,e,i){let r=["left","right"],s=["right","left"],a=["top","bottom"],l=["bottom","top"];switch(c){case"top":case"bottom":return i?e?s:r:e?r:s;case"left":case"right":return e?a:l;default:return[]}}function Tm(c,e,i,r){let s=Er(c),a=Vp(ti(c),i==="start",r);return s&&(a=a.map(l=>l+"-"+s),e&&(a=a.concat(a.map(pc)))),a}function Hs(c){return c.replace(/left|right|bottom|top/g,e=>Dp[e])}function Hp(c){return{top:0,right:0,bottom:0,left:0,...c}}function tu(c){return typeof c!="number"?Hp(c):{top:c,right:c,bottom:c,left:c}}function Ci(c){let{x:e,y:i,width:r,height:s}=c;return{width:r,height:s,top:i,left:e,right:e+r,bottom:i+s,x:e,y:i}}function $m(c,e,i){let{reference:r,floating:s}=c,a=xi(e),l=bc(e),d=yc(l),h=ti(e),g=a==="y",m=r.x+r.width/2-s.width/2,p=r.y+r.height/2-s.height/2,S=r[d]/2-s[d]/2,b;switch(h){case"top":b={x:m,y:r.y-s.height};break;case"bottom":b={x:m,y:r.y+r.height};break;case"right":b={x:r.x+r.width,y:p};break;case"left":b={x:r.x-s.width,y:p};break;default:b={x:r.x,y:r.y}}switch(Er(e)){case"start":b[l]-=S*(i&&g?-1:1);break;case"end":b[l]+=S*(i&&g?-1:1);break}return b}var Pm=async(c,e,i)=>{let{placement:r="bottom",strategy:s="absolute",middleware:a=[],platform:l}=i,d=a.filter(Boolean),h=await(l.isRTL==null?void 0:l.isRTL(e)),g=await l.getElementRects({reference:c,floating:e,strategy:s}),{x:m,y:p}=$m(g,r,h),S=r,b={},y=0;for(let P=0;P<d.length;P++){let{name:U,fn:I}=d[P],{x:R,y:W,data:D,reset:K}=await I({x:m,y:p,initialPlacement:r,placement:S,strategy:s,middlewareData:b,rects:g,platform:l,elements:{reference:c,floating:e}});m=R??m,p=W??p,b={...b,[U]:{...b[U],...D}},K&&y<=50&&(y++,typeof K=="object"&&(K.placement&&(S=K.placement),K.rects&&(g=K.rects===!0?await l.getElementRects({reference:c,floating:e,strategy:s}):K.rects),{x:m,y:p}=$m(g,S,h)),P=-1)}return{x:m,y:p,placement:S,strategy:s,middlewareData:b}};async function iu(c,e){var i;e===void 0&&(e={});let{x:r,y:s,platform:a,rects:l,elements:d,strategy:h}=c,{boundary:g="clippingAncestors",rootBoundary:m="viewport",elementContext:p="floating",altBoundary:S=!1,padding:b=0}=Cr(e,c),y=tu(b),U=d[S?p==="floating"?"reference":"floating":p],I=Ci(await a.getClippingRect({element:(i=await(a.isElement==null?void 0:a.isElement(U)))==null||i?U:U.contextElement||await(a.getDocumentElement==null?void 0:a.getDocumentElement(d.floating)),boundary:g,rootBoundary:m,strategy:h})),R=p==="floating"?{x:r,y:s,width:l.floating.width,height:l.floating.height}:l.reference,W=await(a.getOffsetParent==null?void 0:a.getOffsetParent(d.floating)),D=await(a.isElement==null?void 0:a.isElement(W))?await(a.getScale==null?void 0:a.getScale(W))||{x:1,y:1}:{x:1,y:1},K=Ci(a.convertOffsetParentRelativeRectToViewportRelativeRect?await a.convertOffsetParentRelativeRectToViewportRelativeRect({elements:d,rect:R,offsetParent:W,strategy:h}):R);return{top:(I.top-K.top+y.top)/D.y,bottom:(K.bottom-I.bottom+y.bottom)/D.y,left:(I.left-K.left+y.left)/D.x,right:(K.right-I.right+y.right)/D.x}}var Lm=c=>({name:"arrow",options:c,async fn(e){let{x:i,y:r,placement:s,rects:a,platform:l,elements:d,middlewareData:h}=e,{element:g,padding:m=0}=Cr(c,e)||{};if(g==null)return{};let p=tu(m),S={x:i,y:r},b=bc(s),y=yc(b),P=await l.getDimensions(g),U=b==="y",I=U?"top":"left",R=U?"bottom":"right",W=U?"clientHeight":"clientWidth",D=a.reference[y]+a.reference[b]-S[b]-a.floating[y],K=S[b]-a.reference[b],Li=await(l.getOffsetParent==null?void 0:l.getOffsetParent(g)),ri=Li?Li[W]:0;(!ri||!await(l.isElement==null?void 0:l.isElement(Li)))&&(ri=d.floating[W]||a.floating[y]);let Nr=D/2-K/2,si=ri/2-P[y]/2-1,qt=_i(p[I],si),Or=_i(p[R],si),ni=qt,Ur=ri-P[y]-Or,we=ri/2-P[y]/2+Nr,Ii=fc(ni,we,Ur),ft=!h.arrow&&Er(s)!=null&&we!==Ii&&a.reference[y]/2-(we<ni?qt:Or)-P[y]/2<0,nt=ft?we<ni?we-ni:we-Ur:0;return{[b]:S[b]+nt,data:{[b]:Ii,centerOffset:we-Ii-nt,...ft&&{alignmentOffset:nt}},reset:ft}}});var Im=function(c){return c===void 0&&(c={}),{name:"flip",options:c,async fn(e){var i,r;let{placement:s,middlewareData:a,rects:l,initialPlacement:d,platform:h,elements:g}=e,{mainAxis:m=!0,crossAxis:p=!0,fallbackPlacements:S,fallbackStrategy:b="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:P=!0,...U}=Cr(c,e);if((i=a.arrow)!=null&&i.alignmentOffset)return{};let I=ti(s),R=xi(d),W=ti(d)===d,D=await(h.isRTL==null?void 0:h.isRTL(g.floating)),K=S||(W||!P?[Hs(d)]:Am(d)),Li=y!=="none";!S&&Li&&K.push(...Tm(d,P,y,D));let ri=[d,...K],Nr=await iu(e,U),si=[],qt=((r=a.flip)==null?void 0:r.overflows)||[];if(m&&si.push(Nr[I]),p){let we=km(s,l,D);si.push(Nr[we[0]],Nr[we[1]])}if(qt=[...qt,{placement:s,overflows:si}],!si.every(we=>we<=0)){var Or,ni;let we=(((Or=a.flip)==null?void 0:Or.index)||0)+1,Ii=ri[we];if(Ii)return{data:{index:we,overflows:qt},reset:{placement:Ii}};let ft=(ni=qt.filter(nt=>nt.overflows[0]<=0).sort((nt,Ft)=>nt.overflows[1]-Ft.overflows[1])[0])==null?void 0:ni.placement;if(!ft)switch(b){case"bestFit":{var Ur;let nt=(Ur=qt.filter(Ft=>{if(Li){let Mt=xi(Ft.placement);return Mt===R||Mt==="y"}return!0}).map(Ft=>[Ft.placement,Ft.overflows.filter(Mt=>Mt>0).reduce((Mt,Pp)=>Mt+Pp,0)]).sort((Ft,Mt)=>Ft[1]-Mt[1])[0])==null?void 0:Ur[0];nt&&(ft=nt);break}case"initialPlacement":ft=d;break}if(s!==ft)return{reset:{placement:ft}}}return{}}}};async function Wp(c,e){let{placement:i,platform:r,elements:s}=c,a=await(r.isRTL==null?void 0:r.isRTL(s.floating)),l=ti(i),d=Er(i),h=xi(i)==="y",g=["left","top"].includes(l)?-1:1,m=a&&h?-1:1,p=Cr(e,c),{mainAxis:S,crossAxis:b,alignmentAxis:y}=typeof p=="number"?{mainAxis:p,crossAxis:0,alignmentAxis:null}:{mainAxis:p.mainAxis||0,crossAxis:p.crossAxis||0,alignmentAxis:p.alignmentAxis};return d&&typeof y=="number"&&(b=d==="end"?y*-1:y),h?{x:b*m,y:S*g}:{x:S*g,y:b*m}}var qm=function(c){return c===void 0&&(c=0),{name:"offset",options:c,async fn(e){var i,r;let{x:s,y:a,placement:l,middlewareData:d}=e,h=await Wp(e,c);return l===((i=d.offset)==null?void 0:i.placement)&&(r=d.arrow)!=null&&r.alignmentOffset?{}:{x:s+h.x,y:a+h.y,data:{...h,placement:l}}}}},Fm=function(c){return c===void 0&&(c={}),{name:"shift",options:c,async fn(e){let{x:i,y:r,placement:s}=e,{mainAxis:a=!0,crossAxis:l=!1,limiter:d={fn:U=>{let{x:I,y:R}=U;return{x:I,y:R}}},...h}=Cr(c,e),g={x:i,y:r},m=await iu(e,h),p=xi(ti(s)),S=eu(p),b=g[S],y=g[p];if(a){let U=S==="y"?"top":"left",I=S==="y"?"bottom":"right",R=b+m[U],W=b-m[I];b=fc(R,b,W)}if(l){let U=p==="y"?"top":"left",I=p==="y"?"bottom":"right",R=y+m[U],W=y-m[I];y=fc(R,y,W)}let P=d.fn({...e,[S]:b,[p]:y});return{...P,data:{x:P.x-i,y:P.y-r,enabled:{[S]:a,[p]:l}}}}}};function wc(){return typeof window<"u"}function Ei(c){return Nm(c)?(c.nodeName||"").toLowerCase():"#document"}function qe(c){var e;return(c==null||(e=c.ownerDocument)==null?void 0:e.defaultView)||window}function pt(c){var e;return(e=(Nm(c)?c.ownerDocument:c.document)||window.document)==null?void 0:e.documentElement}function Nm(c){return wc()?c instanceof Node||c instanceof qe(c).Node:!1}function Ge(c){return wc()?c instanceof Element||c instanceof qe(c).Element:!1}function rt(c){return wc()?c instanceof HTMLElement||c instanceof qe(c).HTMLElement:!1}function Mm(c){return!wc()||typeof ShadowRoot>"u"?!1:c instanceof ShadowRoot||c instanceof qe(c).ShadowRoot}function kr(c){let{overflow:e,overflowX:i,overflowY:r,display:s}=Ke(c);return/auto|scroll|overlay|hidden|clip/.test(e+r+i)&&!["inline","contents"].includes(s)}function Om(c){return["table","td","th"].includes(Ei(c))}function js(c){return[":popover-open",":modal"].some(e=>{try{return c.matches(e)}catch{return!1}})}function Sc(c){let e=_c(),i=Ge(c)?Ke(c):c;return["transform","translate","scale","rotate","perspective"].some(r=>i[r]?i[r]!=="none":!1)||(i.containerType?i.containerType!=="normal":!1)||!e&&(i.backdropFilter?i.backdropFilter!=="none":!1)||!e&&(i.filter?i.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(i.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(i.contain||"").includes(r))}function Um(c){let e=It(c);for(;rt(e)&&!ki(e);){if(Sc(e))return e;if(js(e))return null;e=It(e)}return null}function _c(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function ki(c){return["html","body","#document"].includes(Ei(c))}function Ke(c){return qe(c).getComputedStyle(c)}function Gs(c){return Ge(c)?{scrollLeft:c.scrollLeft,scrollTop:c.scrollTop}:{scrollLeft:c.scrollX,scrollTop:c.scrollY}}function It(c){if(Ei(c)==="html")return c;let e=c.assignedSlot||c.parentNode||Mm(c)&&c.host||pt(c);return Mm(e)?e.host:e}function Rm(c){let e=It(c);return ki(e)?c.ownerDocument?c.ownerDocument.body:c.body:rt(e)&&kr(e)?e:Rm(e)}function vc(c,e,i){var r;e===void 0&&(e=[]),i===void 0&&(i=!0);let s=Rm(c),a=s===((r=c.ownerDocument)==null?void 0:r.body),l=qe(s);if(a){let d=xc(l);return e.concat(l,l.visualViewport||[],kr(s)?s:[],d&&i?vc(d):[])}return e.concat(s,vc(s,[],i))}function xc(c){return c.parent&&Object.getPrototypeOf(c.parent)?c.frameElement:null}function Bm(c){let e=Ke(c),i=parseFloat(e.width)||0,r=parseFloat(e.height)||0,s=rt(c),a=s?c.offsetWidth:i,l=s?c.offsetHeight:r,d=Ws(i)!==a||Ws(r)!==l;return d&&(i=a,r=l),{width:i,height:r,$:d}}function Vm(c){return Ge(c)?c:c.contextElement}function Ar(c){let e=Vm(c);if(!rt(e))return it(1);let i=e.getBoundingClientRect(),{width:r,height:s,$:a}=Bm(e),l=(a?Ws(i.width):i.width)/r,d=(a?Ws(i.height):i.height)/s;return(!l||!Number.isFinite(l))&&(l=1),(!d||!Number.isFinite(d))&&(d=1),{x:l,y:d}}var jp=it(0);function Hm(c){let e=qe(c);return!_c()||!e.visualViewport?jp:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Gp(c,e,i){return e===void 0&&(e=!1),!i||e&&i!==qe(c)?!1:e}function Ks(c,e,i,r){e===void 0&&(e=!1),i===void 0&&(i=!1);let s=c.getBoundingClientRect(),a=Vm(c),l=it(1);e&&(r?Ge(r)&&(l=Ar(r)):l=Ar(c));let d=Gp(a,i,r)?Hm(a):it(0),h=(s.left+d.x)/l.x,g=(s.top+d.y)/l.y,m=s.width/l.x,p=s.height/l.y;if(a){let S=qe(a),b=r&&Ge(r)?qe(r):r,y=S,P=xc(y);for(;P&&r&&b!==y;){let U=Ar(P),I=P.getBoundingClientRect(),R=Ke(P),W=I.left+(P.clientLeft+parseFloat(R.paddingLeft))*U.x,D=I.top+(P.clientTop+parseFloat(R.paddingTop))*U.y;h*=U.x,g*=U.y,m*=U.x,p*=U.y,h+=W,g+=D,y=qe(P),P=xc(y)}}return Ci({width:m,height:p,x:h,y:g})}function su(c,e){let i=Gs(c).scrollLeft;return e?e.left+i:Ks(pt(c)).left+i}function Wm(c,e,i){i===void 0&&(i=!1);let r=c.getBoundingClientRect(),s=r.left+e.scrollLeft-(i?0:su(c,r)),a=r.top+e.scrollTop;return{x:s,y:a}}function Kp(c){let{elements:e,rect:i,offsetParent:r,strategy:s}=c,a=s==="fixed",l=pt(r),d=e?js(e.floating):!1;if(r===l||d&&a)return i;let h={scrollLeft:0,scrollTop:0},g=it(1),m=it(0),p=rt(r);if((p||!p&&!a)&&((Ei(r)!=="body"||kr(l))&&(h=Gs(r)),rt(r))){let b=Ks(r);g=Ar(r),m.x=b.x+r.clientLeft,m.y=b.y+r.clientTop}let S=l&&!p&&!a?Wm(l,h,!0):it(0);return{width:i.width*g.x,height:i.height*g.y,x:i.x*g.x-h.scrollLeft*g.x+m.x+S.x,y:i.y*g.y-h.scrollTop*g.y+m.y+S.y}}function Yp(c){return Array.from(c.getClientRects())}function Jp(c){let e=pt(c),i=Gs(c),r=c.ownerDocument.body,s=ei(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),a=ei(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight),l=-i.scrollLeft+su(c),d=-i.scrollTop;return Ke(r).direction==="rtl"&&(l+=ei(e.clientWidth,r.clientWidth)-s),{width:s,height:a,x:l,y:d}}function Zp(c,e){let i=qe(c),r=pt(c),s=i.visualViewport,a=r.clientWidth,l=r.clientHeight,d=0,h=0;if(s){a=s.width,l=s.height;let g=_c();(!g||g&&e==="fixed")&&(d=s.offsetLeft,h=s.offsetTop)}return{width:a,height:l,x:d,y:h}}function Xp(c,e){let i=Ks(c,!0,e==="fixed"),r=i.top+c.clientTop,s=i.left+c.clientLeft,a=rt(c)?Ar(c):it(1),l=c.clientWidth*a.x,d=c.clientHeight*a.y,h=s*a.x,g=r*a.y;return{width:l,height:d,x:h,y:g}}function zm(c,e,i){let r;if(e==="viewport")r=Zp(c,i);else if(e==="document")r=Jp(pt(c));else if(Ge(e))r=Xp(e,i);else{let s=Hm(c);r={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return Ci(r)}function jm(c,e){let i=It(c);return i===e||!Ge(i)||ki(i)?!1:Ke(i).position==="fixed"||jm(i,e)}function Qp(c,e){let i=e.get(c);if(i)return i;let r=vc(c,[],!1).filter(d=>Ge(d)&&Ei(d)!=="body"),s=null,a=Ke(c).position==="fixed",l=a?It(c):c;for(;Ge(l)&&!ki(l);){let d=Ke(l),h=Sc(l);!h&&d.position==="fixed"&&(s=null),(a?!h&&!s:!h&&d.position==="static"&&!!s&&["absolute","fixed"].includes(s.position)||kr(l)&&!h&&jm(c,l))?r=r.filter(m=>m!==l):s=d,l=It(l)}return e.set(c,r),r}function ef(c){let{element:e,boundary:i,rootBoundary:r,strategy:s}=c,l=[...i==="clippingAncestors"?js(e)?[]:Qp(e,this._c):[].concat(i),r],d=l[0],h=l.reduce((g,m)=>{let p=zm(e,m,s);return g.top=ei(p.top,g.top),g.right=_i(p.right,g.right),g.bottom=_i(p.bottom,g.bottom),g.left=ei(p.left,g.left),g},zm(e,d,s));return{width:h.right-h.left,height:h.bottom-h.top,x:h.left,y:h.top}}function tf(c){let{width:e,height:i}=Bm(c);return{width:e,height:i}}function rf(c,e,i){let r=rt(e),s=pt(e),a=i==="fixed",l=Ks(c,!0,a,e),d={scrollLeft:0,scrollTop:0},h=it(0);if(r||!r&&!a)if((Ei(e)!=="body"||kr(s))&&(d=Gs(e)),r){let S=Ks(e,!0,a,e);h.x=S.x+e.clientLeft,h.y=S.y+e.clientTop}else s&&(h.x=su(s));let g=s&&!r&&!a?Wm(s,d):it(0),m=l.left+d.scrollLeft-h.x-g.x,p=l.top+d.scrollTop-h.y-g.y;return{x:m,y:p,width:l.width,height:l.height}}function ru(c){return Ke(c).position==="static"}function Dm(c,e){if(!rt(c)||Ke(c).position==="fixed")return null;if(e)return e(c);let i=c.offsetParent;return pt(c)===i&&(i=i.ownerDocument.body),i}function Gm(c,e){let i=qe(c);if(js(c))return i;if(!rt(c)){let s=It(c);for(;s&&!ki(s);){if(Ge(s)&&!ru(s))return s;s=It(s)}return i}let r=Dm(c,e);for(;r&&Om(r)&&ru(r);)r=Dm(r,e);return r&&ki(r)&&ru(r)&&!Sc(r)?i:r||Um(c)||i}var sf=async function(c){let e=this.getOffsetParent||Gm,i=this.getDimensions,r=await i(c.floating);return{reference:rf(c.reference,await e(c.floating),c.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function nf(c){return Ke(c).direction==="rtl"}var of={convertOffsetParentRelativeRectToViewportRelativeRect:Kp,getDocumentElement:pt,getClippingRect:ef,getOffsetParent:Gm,getElementRects:sf,getClientRects:Yp,getDimensions:tf,getScale:Ar,isElement:Ge,isRTL:nf};var Km=qm;var Ym=Fm,Jm=Im;var Zm=Lm;var Xm=(c,e,i)=>{let r=new Map,s={platform:of,...i},a={...s.platform,_c:r};return Pm(c,e,{...s,platform:a})};var kc,Ai,Fe,Tr,Ys,$r,Pr,Js,Lr,Ac,Qm,Tc,ep,$c,tp,Zs,nu,Ir,Cc,Ec=class{constructor(e){o(this,Ac);o(this,Tc);o(this,$c);o(this,Zs);o(this,Ir);o(this,kc,void 0);o(this,Ai,void 0);o(this,Fe,void 0);o(this,Tr,void 0);o(this,Ys,void 0);o(this,$r,null);o(this,Pr,null);o(this,Js,null);o(this,Lr,!1);u(this,kc,e),u(this,Ai,e.logger.createModuleLogger("TOOLTIP")),n(this,Ac,Qm).call(this),t(this,Ai).info("TooltipManager initialized")}};kc=new WeakMap,Ai=new WeakMap,Fe=new WeakMap,Tr=new WeakMap,Ys=new WeakMap,$r=new WeakMap,Pr=new WeakMap,Js=new WeakMap,Lr=new WeakMap,Ac=new WeakSet,Qm=function(){t(this,Lr)||(u(this,Fe,n(this,Tc,ep).call(this)),u(this,Tr,t(this,Fe).querySelector("#checkout-tooltip-arrow")),u(this,Ys,t(this,Fe).querySelector("#checkout-tooltip-text")),n(this,$c,tp).call(this),u(this,Lr,!0),t(this,Ai).info("Tooltip system initialized with floating-ui"))},Tc=new WeakSet,ep=function(){let e=document.getElementById("checkout-tooltip");if(e)return e;let i=document.createElement("div");i.setAttribute("role","tooltip"),i.id="checkout-tooltip",i.style.display="none";let r=document.createElement("div");r.id="checkout-tooltip-text",i.appendChild(r);let s=document.createElement("div");return s.id="checkout-tooltip-arrow",i.appendChild(s),document.body.appendChild(i),i},$c=new WeakSet,tp=function(){document.addEventListener("mouseover",e=>{let i=e.target.closest("[data-os-tooltip]");i&&(clearTimeout(t(this,Pr)),u(this,Pr,setTimeout(()=>{n(this,Zs,nu).call(this,i)},200)))}),document.addEventListener("mouseout",e=>{e.target.closest("[data-os-tooltip]")&&(clearTimeout(t(this,Pr)),n(this,Ir,Cc).call(this))}),document.addEventListener("focus",e=>{let i=e.target.closest("[data-os-tooltip]");i&&n(this,Zs,nu).call(this,i)},!0),document.addEventListener("blur",e=>{e.target.closest("[data-os-tooltip]")&&n(this,Ir,Cc).call(this)},!0),document.addEventListener("keydown",e=>{e.key==="Escape"&&t(this,$r)&&n(this,Ir,Cc).call(this)})},Zs=new WeakSet,nu=function(e){if(!t(this,Lr)){t(this,Ai).warn("Cannot show tooltip: system not initialized");return}clearTimeout(t(this,Js)),u(this,$r,e);let i=e.getAttribute("data-os-tooltip"),r=e.getAttribute("data-os-tooltip-position")||"top";t(this,Ys).textContent=i,t(this,Fe).style.display="block",Xm(e,t(this,Fe),{placement:r,middleware:[Km(8),Jm({fallbackPlacements:["top","right","bottom","left"]}),Ym({padding:5}),Zm({element:t(this,Tr)})]}).then(({x:s,y:a,placement:l,middlewareData:d})=>{Object.assign(t(this,Fe).style,{left:`${s}px`,top:`${a}px`});let{x:h,y:g}=d.arrow,m={top:"bottom",right:"left",bottom:"top",left:"right"}[l.split("-")[0]];Object.assign(t(this,Tr).style,{left:h!=null?`${h}px`:"",top:g!=null?`${g}px`:"",right:"",bottom:"",[m]:"-4px"}),requestAnimationFrame(()=>{t(this,Fe).classList.add("checkout-tooltip-visible")})})},Ir=new WeakSet,Cc=function(){t(this,Fe)&&(t(this,Fe).classList.remove("checkout-tooltip-visible"),u(this,Js,setTimeout(()=>{t(this,Fe).classList.contains("checkout-tooltip-visible")||(t(this,Fe).style.display="none"),u(this,$r,null)},200)))};var Pc,ie,Qs,en,Ye,st,Lc,ip,Ic,rp,qc,sp,Fc,np,tn,ou,Mc,op,rn,au,Nc,ap,Xs=class{constructor(e){o(this,Lc);o(this,Ic);o(this,qc);o(this,Fc);o(this,tn);o(this,Mc);o(this,rn);o(this,Nc);o(this,Pc,void 0);o(this,ie,void 0);o(this,Qs,void 0);o(this,en,void 0);o(this,Ye,{});o(this,st,null);u(this,Pc,e),u(this,ie,e.logger.createModuleLogger("UPSELL")),u(this,Qs,e.state),u(this,en,e.api),n(this,Lc,ip).call(this),t(this,ie).info("UpsellManager initialized")}async acceptUpsell(e,i=1,r){if(!t(this,st)){t(this,ie).error("Cannot accept upsell: No order reference ID found");return}t(this,ie).info(`Accepting upsell: Package ${e}, Quantity ${i}`),n(this,tn,ou).call(this);try{document.body.classList.add("os-loading");let s={lines:[{package_id:Number(e),quantity:Number(i),is_upsell:!0}]},a=await t(this,en).createOrderUpsell(t(this,st),s);t(this,ie).info("Upsell successfully added to order",a),n(this,rn,au).call(this,r)}catch(s){t(this,ie).error("Error accepting upsell:",s),document.body.classList.remove("os-loading"),n(this,Mc,op).call(this),n(this,Nc,ap).call(this,"There was an error processing your upsell. Please try again.")}}declineUpsell(e){t(this,ie).info("Declining upsell offer"),n(this,tn,ou).call(this),n(this,rn,au).call(this,e)}};Pc=new WeakMap,ie=new WeakMap,Qs=new WeakMap,en=new WeakMap,Ye=new WeakMap,st=new WeakMap,Lc=new WeakSet,ip=function(){u(this,st,n(this,Ic,rp).call(this)),t(this,st)?(t(this,ie).info(`Order reference ID found: ${t(this,st)}`),t(this,Qs).setState("order.ref_id",t(this,st))):t(this,ie).warn("No order reference ID found, upsell functionality will be limited"),n(this,qc,sp).call(this),n(this,Fc,np).call(this)},Ic=new WeakSet,rp=function(){let i=new URLSearchParams(window.location.search).get("ref_id");return i?(t(this,ie).debug("Getting order ref_id from URL parameters:",i),sessionStorage.setItem("order_ref_id",i)):(i=sessionStorage.getItem("order_ref_id"),t(this,ie).debug("Getting order ref_id from sessionStorage:",i)),i},qc=new WeakSet,sp=function(){u(this,Ye,{acceptButtons:document.querySelectorAll('[data-os-upsell="accept"]'),declineButtons:document.querySelectorAll('[data-os-upsell="decline"]')}),t(this,ie).debug(`Found ${t(this,Ye).acceptButtons.length} accept buttons and ${t(this,Ye).declineButtons.length} decline buttons`)},Fc=new WeakSet,np=function(){t(this,Ye).acceptButtons.forEach(e=>{e.addEventListener("click",i=>{i.preventDefault();let r=e.getAttribute("data-os-package-id"),s=parseInt(e.getAttribute("data-os-quantity")||"1",10),a=e.getAttribute("data-os-next-url");if(!r){t(this,ie).error("No package ID specified for upsell accept button");return}this.acceptUpsell(r,s,a)})}),t(this,Ye).declineButtons.forEach(e=>{e.addEventListener("click",i=>{i.preventDefault();let r=e.getAttribute("data-os-next-url");r?this.declineUpsell(r):t(this,ie).error("No next URL specified for upsell decline button")})})},tn=new WeakSet,ou=function(){t(this,ie).debug("Disabling upsell buttons"),t(this,Ye).acceptButtons.forEach(e=>{e.style.pointerEvents="none",e.classList.add("os-button-disabled")}),t(this,Ye).declineButtons.forEach(e=>{e.style.pointerEvents="none",e.classList.add("os-button-disabled")})},Mc=new WeakSet,op=function(){t(this,ie).debug("Re-enabling upsell buttons"),t(this,Ye).acceptButtons.forEach(e=>{e.style.pointerEvents="",e.classList.remove("os-button-disabled")}),t(this,Ye).declineButtons.forEach(e=>{e.style.pointerEvents="",e.classList.remove("os-button-disabled")})},rn=new WeakSet,au=function(e){if(!e){t(this,ie).warn("No URL provided for redirect");return}let i=new URL(e,window.location.origin);t(this,st)&&!i.searchParams.has("ref_id")&&i.searchParams.append("ref_id",t(this,st)),t(this,ie).info(`Redirecting to ${i.href}`),window.location.href=i.href},Nc=new WeakSet,ap=function(e){let i=document.querySelector("[data-os-error-container]");i?(i.textContent=e,i.style.display="block"):alert(e)};var lu=class{constructor(){this.cleanupInitialState(),this.init()}cleanupInitialState(){document.querySelectorAll('[pb-component="accordion"]').forEach(e=>{let i=e.querySelector('[pb-accordion-element="group"]');if(!i)return;let r=i.querySelectorAll('[pb-accordion-element="accordion"]');r.forEach(a=>{let l=a.querySelector('[pb-accordion-element="content"]'),d=a.querySelector('[pb-accordion-element="trigger"]'),h=a.querySelector('[pb-accordion-element="arrow"]'),g=a.querySelector('[pb-accordion-element="plus"]');l&&(l.style.maxHeight="0",l.style.opacity="0",l.style.visibility="hidden",l.style.display="none"),d&&d.setAttribute("aria-expanded","false"),a.classList.remove("is-active-accordion"),l?.classList.remove("is-active-accordion"),h&&h.classList.remove("is-active-accordion"),g&&g.classList.remove("is-active-accordion")});let s=i.getAttribute("pb-accordion-initial");if(s&&s!=="none"){let a=r[parseInt(s)-1];a&&this.openAccordion(a)}})}init(){document.querySelectorAll('[pb-component="accordion"]').forEach(e=>{let i=e.querySelector('[pb-accordion-element="group"]');i&&i.addEventListener("click",r=>this.handleClick(r,i))})}handleClick(e,i){let r=e.target.closest('[pb-accordion-element="accordion"]');if(!r)return;let s=r.classList.contains("is-active-accordion");i.getAttribute("pb-accordion-single")==="true"&&i.querySelectorAll('[pb-accordion-element="accordion"]').forEach(l=>{l!==r&&l.classList.contains("is-active-accordion")&&this.closeAccordion(l)}),s?this.closeAccordion(r):this.openAccordion(r)}openAccordion(e){let i=e.querySelector('[pb-accordion-element="trigger"]'),r=e.querySelector('[pb-accordion-element="content"]'),s=e.querySelector('[pb-accordion-element="arrow"]'),a=e.querySelector('[pb-accordion-element="plus"]');r.style.visibility="visible",r.style.display="block",r.offsetHeight;let l=r.scrollHeight;requestAnimationFrame(()=>{r.style.maxHeight=`${l}px`,r.style.opacity="1",i.setAttribute("aria-expanded","true"),e.classList.add("is-active-accordion"),r.classList.add("is-active-accordion"),s&&s.classList.add("is-active-accordion"),a&&a.classList.add("is-active-accordion")}),r.addEventListener("transitionend",()=>{e.classList.contains("is-active-accordion")&&(r.style.maxHeight="none")},{once:!0})}closeAccordion(e){let i=e.querySelector('[pb-accordion-element="trigger"]'),r=e.querySelector('[pb-accordion-element="content"]'),s=e.querySelector('[pb-accordion-element="arrow"]'),a=e.querySelector('[pb-accordion-element="plus"]');r.style.maxHeight=`${r.scrollHeight}px`,r.style.display="block",r.offsetHeight,requestAnimationFrame(()=>{r.style.maxHeight="0",r.style.opacity="0",i.setAttribute("aria-expanded","false"),e.classList.remove("is-active-accordion"),r.classList.remove("is-active-accordion"),s&&s.classList.remove("is-active-accordion"),a&&a.classList.remove("is-active-accordion")}),r.addEventListener("transitionend",()=>{e.classList.contains("is-active-accordion")||(r.style.visibility="hidden",r.style.display="none")},{once:!0})}},lp=()=>document.querySelector('[pb-component="accordion"]')?new lu:null;var cu=class{constructor(){this.config={enabled:!0,applyToExternalLinks:!1,excludedDomains:[],paramsToCopy:[]},this.loadConfig()}loadConfig(){window.osConfig&&window.osConfig.utmTransfer&&(this.config={...this.config,...window.osConfig.utmTransfer}),(this.config.paramsToCopy===null||this.config.paramsToCopy===void 0)&&(this.config.paramsToCopy=[]),JSON.stringify(this.config)}init(){if(!this.config.enabled)return;let e=new URLSearchParams(window.location.search);if(e.toString()==="")return;let i=[];e.forEach((a,l)=>{i.push(`${l}=${a}`)}),`${i.join(", ")}`;let r=e;if(Array.isArray(this.config.paramsToCopy)&&this.config.paramsToCopy.length>0&&(`${this.config.paramsToCopy.join(", ")}`,r=new URLSearchParams,this.config.paramsToCopy.forEach(a=>{e.has(a)&&(r.append(a,e.get(a)),`${a}${e.get(a)}`)}),r.toString()===""))return;let s=document.querySelectorAll("a");`${s.length}`,s.forEach(a=>{a.addEventListener("click",l=>{this.applyParamsToLink(a,r)})})}applyParamsToLink(e,i=null){if(!e||!e.getAttribute){console.error("UTM Transfer: Invalid link element provided");return}let r=e.getAttribute("href");if(!r||r.startsWith("#")||r.startsWith("javascript:")||r.startsWith("mailto:")||r.startsWith("tel:"))return;if(r.includes("://")&&!r.includes(window.location.hostname)){if(!this.config.applyToExternalLinks)return;if(this.config.excludedDomains&&this.config.excludedDomains.length>0){for(let h of this.config.excludedDomains)if(r.includes(h))return}}let a=i||new URLSearchParams(window.location.search);if(a.toString()==="")return;let l;try{l=new URL(r,window.location.origin)}catch{console.error("UTM Transfer: Invalid URL:",r);return}let d=new URLSearchParams(l.search);a.forEach((h,g)=>{d.has(g)||d.append(g,h)}),l.search=d.toString(),e.setAttribute("href",l.toString()),this.config.debug&&`${r}${l.toString()}`}},cp=()=>{let c=new cu;return c.init(),c};var Mr,Pi,J,Vc,fp,Hc,yp,Wc,bp,jc,vp,Gc,wp,Kc,Sp,Yc,_p,Jc,xp,Zc,Cp,Xc,Ep,Qc,kp,ed,Ap,td,Tp,hn=class{constructor(e={}){o(this,Vc);o(this,Hc);o(this,Wc);o(this,jc);o(this,Gc);o(this,Kc);o(this,Yc);o(this,Jc);o(this,Zc);o(this,Xc);o(this,Qc);o(this,ed);o(this,td);o(this,Mr,!1);o(this,Pi,!1);o(this,J,null);let i=window.osConfig?.googleMaps||{};this.options={debug:!1,autoInit:!0,googleMapsApiKey:i.apiKey||"YOUR_API_KEY_HERE",googleMapsRegion:i.region||"US",enableGoogleMapsAutocomplete:i.enableAutocomplete!==!1,...e},this.logger=new pn(this.options.debug),this.coreLogger=this.logger.createModuleLogger("CORE"),this.api=new gn(this),this.config=n(this,Vc,fp).call(this),this.state=new Ja(this),this.attribution=new Jl(this),this.cart=new tl(this),this.campaign=new Ya(this),this.upsell=new Xs(this),this.events={on:(r,s)=>this.on(r,s),once:(r,s)=>this.once(r,s),off:(r,s)=>this.off(r,s),trigger:(r,s)=>this.triggerEvent(r,s)},this.options.autoInit&&this.init()}on(e,i){let r=s=>{try{i(s.detail)}catch(a){this.coreLogger.error(`Error in event callback for "${e}":`,a)}};return document.addEventListener(`os:${e}`,r),this.coreLogger.debug(`Event listener registered for "${e}"`),this}once(e,i){let r=s=>{try{i(s.detail)}catch(a){this.coreLogger.error(`Error in one-time event callback for "${e}":`,a)}document.removeEventListener(`os:${e}`,r)};return document.addEventListener(`os:${e}`,r),this.coreLogger.debug(`One-time event listener registered for "${e}"`),this}off(e,i){return document.removeEventListener(`os:${e}`,i),this}async init(){this.coreLogger.info("Initializing 29next client"),this.api.init(),typeof window.on29NextReady<"u"&&!Array.isArray(window.on29NextReady)&&(this.coreLogger.warn("window.on29NextReady is not an array, resetting it"),window.on29NextReady=[]),await n(this,jc,vp).call(this),await n(this,Wc,bp).call(this),u(this,Pi,n(this,Jc,xp).call(this)),t(this,Pi)&&n(this,Zc,Cp).call(this),n(this,Gc,wp).call(this),n(this,ed,Ap).call(this),await n(this,td,Tp).call(this),u(this,Mr,!0),this.triggerEvent("initialized",{client:this}),await n(this,Kc,Sp).call(this)}triggerEvent(e,i={}){this.coreLogger.debug(`Triggering event: ${e}`);let r={...i,timestamp:Date.now(),client:this};e==="order.loaded"&&this.coreLogger.debug("Event data for order.loaded:",JSON.stringify(r,null,2));let s=new CustomEvent(`os:${e}`,{bubbles:!0,cancelable:!0,detail:r});return document.dispatchEvent(s),s}getCampaignData(){return t(this,J)}get isInitialized(){return t(this,Mr)}get isCheckoutPage(){return t(this,Pi)}debugTriggerViewItemList(){return t(this,J)?this.events.viewItemList?(window.dataLayer=window.dataLayer||[],window.dataLayer.push({ecommerce:null}),this.events.viewItemList(t(this,J)),{success:!0,message:"view_item_list event triggered",campaignData:t(this,J)}):(console.error("âŒ events.viewItemList not available"),{success:!1,message:"Event manager not initialized"}):(console.error("âŒ No campaign data available"),{success:!1,message:"No campaign data"})}isReady(){return t(this,Mr)&&t(this,J)!==null&&Array.isArray(t(this,J).packages)}onReady(e){if(!e||typeof e!="function")return this;if(this.isReady())try{e(this)}catch(i){this.coreLogger.error("Error in onReady callback:",i)}else this.once("initialized",()=>{this.isReady()&&e(this)});return this}};Mr=new WeakMap,Pi=new WeakMap,J=new WeakMap,Vc=new WeakSet,fp=function(){let e={apiKey:null,campaignId:null,debug:this.options.debug},i=document.querySelector('meta[name="os-api-key"]');e.apiKey=i?.getAttribute("content")??null,this.coreLogger.info(`API key: ${e.apiKey?"âœ“ Set":"âœ— Not set"}`);let r=document.querySelector('meta[name="os-campaign-id"]');return e.campaignId=r?.getAttribute("content")??null,this.coreLogger.info(`Campaign ID: ${e.campaignId?"âœ“ Set":"âœ— Not set"}`),document.querySelector('meta[name="os-debug"]')?.getAttribute("content")==="true"&&(e.debug=!0,this.logger.setDebug(!0),this.coreLogger.info("Debug mode: âœ“ Enabled")),n(this,Hc,yp).call(this),e},Hc=new WeakSet,yp=function(){window.osConfig=window.osConfig||{},window.osConfig.spreedlyConfig?this.coreLogger.info("Found custom Spreedly configuration"):(this.coreLogger.debug("Initializing default Spreedly configuration"),window.osConfig.spreedlyConfig={fieldType:{number:"text",cvv:"text"},numberFormat:"prettyFormat",placeholder:{number:"Credit Card Number",cvv:"CVV *"},labels:{number:"Card Number",cvv:"CVV"}})},Wc=new WeakSet,bp=async function(){if(!this.options.enableGoogleMapsAutocomplete){this.coreLogger.debug("Google Maps Autocomplete is disabled in configuration");return}if(typeof google<"u"&&typeof google.maps<"u"){this.coreLogger.debug("Google Maps API already loaded");return}return this.coreLogger.debug("Loading Google Maps API..."),new Promise(e=>{let i=document.createElement("script"),r=this.options.googleMapsRegion?`&region=${this.options.googleMapsRegion}`:"";i.src=`https://maps.googleapis.com/maps/api/js?key=${this.options.googleMapsApiKey}&libraries=places${r}`,i.async=!0,i.defer=!0,i.onload=()=>{this.coreLogger.debug("Google Maps API loaded successfully"),e()},i.onerror=()=>{this.coreLogger.error("Failed to load Google Maps API"),e()},document.head.appendChild(i)})},jc=new WeakSet,vp=async function(){try{if(this.coreLogger.info("Fetching campaign data..."),u(this,J,await this.api.getCampaign()),u(this,J,t(this,J)||{packages:[]}),t(this,J).packages=t(this,J).packages||[],this.campaignData=t(this,J),this.coreLogger.info("Campaign data retrieved successfully"),window.osConfig=window.osConfig||{},window.osConfig.campaign=t(this,J),window.dataLayer=window.dataLayer||[],t(this,J).name&&this.attribution){let i=document.querySelector('meta[name="os-tracking-tag"][data-tag-name="funnel_name"]')?.getAttribute("data-tag-value")||t(this,J).name;this.attribution.setFunnelName(i)}this.triggerEvent("campaign.loaded",{campaign:t(this,J)})}catch(e){this.coreLogger.error("Failed to retrieve campaign data:",e),u(this,J,{name:"Default Campaign",packages:[],currency:"USD",locale:"en-US"}),this.campaignData=t(this,J)}},Gc=new WeakSet,wp=function(){this.selector=new nl(this),this.toggle=new ml(this),this.timer=new $l(this),this.display=new Ml(this),this.eventManager=new ac(this),this.tooltip=new Ec(this),(t(this,Pi)||document.querySelector('[data-os-cart="line-display"]')||document.querySelector('[os-cart="checkout-summary"]')||document.querySelector('[data-os-cart-summary="grand-total"]'))&&(this.coreLogger.info("Cart display elements detected, initializing CartDisplayManager"),this.cartDisplay=new Ul(this)),this.debug=new El(this),Object.assign(this.events,{emit:(e,i)=>this.triggerEvent(e,i),viewItemList:e=>this.eventManager.viewItemList(e||t(this,J)),viewItem:e=>this.eventManager.viewItem(e),addToCart:e=>this.eventManager.addToCart(e),beginCheckout:()=>this.eventManager.beginCheckout(),purchase:(e,i)=>this.eventManager.purchase(e,i),fireCustomEvent:(e,i)=>this.eventManager.fireCustomEvent(e,i)})},Kc=new WeakSet,Sp=async function(){this.events.viewItemList(t(this,J)),await new Promise(e=>setTimeout(e,800)),n(this,Yc,_p).call(this)},Yc=new WeakSet,_p=function(){let e=document.querySelector('div[os-element="preloader"]');e&&(this.coreLogger.info("Hiding preloader element"),e.style.transition="opacity 0.5s ease",e.style.opacity="0",e.style.pointerEvents="none",this.coreLogger.debug("Preloader hidden"))},Jc=new WeakSet,xp=function(){let i=document.querySelector('meta[name="os-page-type"]')?.getAttribute("content");return i==="checkout"||!i&&document.querySelector('form[os-checkout="form"]')?(this.coreLogger.info("Checkout page detected"),!0):(i==="receipt"&&(this.coreLogger.info("Receipt page detected"),n(this,Xc,Ep).call(this)),(i==="upsell"||document.querySelector("[data-os-upsell]"))&&(this.coreLogger.info("Upsell page detected"),n(this,Qc,kp).call(this)),!1)},Zc=new WeakSet,Cp=function(){this.checkout=new Ia(this.api,this.coreLogger,this)},Xc=new WeakSet,Ep=function(){Promise.resolve().then(()=>(pp(),mp)).then(e=>{let i=e.ReceiptPage;this.receipt=new i(this.api,this.coreLogger,this),this.coreLogger.info("Receipt page initialized")}).catch(e=>this.coreLogger.error("Failed to load ReceiptPage module:",e))},Qc=new WeakSet,kp=function(){this.coreLogger.info("Initializing upsell page"),this.upsell||(this.upsell=new Xs(this),this.coreLogger.info("UpsellManager initialized for upsell page")),this.triggerEvent("upsell.pageview",{ref_id:new URLSearchParams(window.location.search).get("ref_id")||sessionStorage.getItem("order_ref_id")})},ed=new WeakSet,Ap=function(){this.coreLogger.info("Initializing UI utilities");try{let e=lp();e&&(this.pbAccordion=e,this.coreLogger.info("PBAccordion initialized"))}catch(e){this.coreLogger.error("Failed to initialize PBAccordion:",e)}try{let e=cp();e&&(this.utmTransfer=e,this.coreLogger.info("UTM parameter transfer initialized"))}catch(e){this.coreLogger.error("Failed to initialize UTM transfer:",e)}},td=new WeakSet,Tp=async function(){let e=new URLSearchParams(window.location.search).get("ref_id");if(!e)return;if(this.coreLogger.debug(`Checking for pending purchase events for ref_id: ${e}`),sessionStorage.getItem(`pending_purchase_event_${e}`)==="true"){this.coreLogger.info(`Found pending purchase event for order ${e}`);let r=this.eventManager&&this.eventManager.isInitialized;if(this.coreLogger.debug(`EventManager ready: ${r}`),!r){this.coreLogger.warn("EventManager not ready yet, will not trigger order.loaded event");return}try{let s=await this.api.getOrder(e);s?(this.coreLogger.info(`Triggering order.loaded event for pending purchase ${e}`),this.triggerEvent("order.loaded",{order:s}),this.coreLogger.info(`Triggered order.loaded event for pending purchase ${e}`),sessionStorage.removeItem(`pending_purchase_event_${e}`),this.coreLogger.debug(`Removed pending purchase flag for order ${e}`)):this.coreLogger.warn(`Could not fetch order data for pending purchase ${e}`)}catch(s){this.coreLogger.error(`Failed to load order data for pending purchase ${e}:`,s)}}else this.coreLogger.debug(`No pending purchase event for order ${e}`)};var $p=()=>{try{if(document.querySelector('meta[name="os-disable-auto-init"]'))return;let c={apiKey:document.querySelector('meta[name="os-api-key"]')?.getAttribute("content")??null,campaignId:document.querySelector('meta[name="os-campaign-id"]')?.getAttribute("content")??null,debug:document.querySelector('meta[name="os-debug"]')?.getAttribute("content")==="true",paypalClientId:document.querySelector('meta[name="os-paypal-client-id"]')?.getAttribute("content")??null};JSON.stringify({apiKey:c.apiKey?"âœ“ Set":"âœ— Not set",campaignId:c.campaignId?"âœ“ Set":"âœ— Not set",debug:c.debug}),window.on29NextReady=Array.isArray(window.on29NextReady)?window.on29NextReady:[];let e=[...window.on29NextReady];window.twentyNineNext=new hn(c),e.forEach(i=>{window.twentyNineNext.onReady(i)}),window.on29NextReady={push:i=>window.twentyNineNext.onReady(i)}}catch(c){console.error("29next Client: Error during initialization",c)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",$p):$p();return Np(af);})();
//# sourceMappingURL=29next.min.js.map
