"use strict";var TwentyNineNext=(()=>{var kd=Object.defineProperty;var bf=Object.getOwnPropertyDescriptor;var vf=Object.getOwnPropertyNames;var wf=Object.prototype.hasOwnProperty;var ju=(l,e)=>()=>(l&&(e=l(l=0)),e);var Gu=(l,e)=>{for(var i in e)kd(l,i,{get:e[i],enumerable:!0})},Sf=(l,e,i,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of vf(e))!wf.call(l,r)&&r!==i&&kd(l,r,{get:()=>e[r],enumerable:!(s=bf(e,r))||s.enumerable});return l};var _f=l=>Sf(kd({},"__esModule",{value:!0}),l);var $d=(l,e,i)=>{if(!e.has(l))throw TypeError("Cannot "+i)};var t=(l,e,i)=>($d(l,e,"read from private field"),i?i.call(l):e.get(l)),a=(l,e,i)=>{if(e.has(l))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(l):e.set(l,i)},h=(l,e,i,s)=>($d(l,e,"write to private field"),s?s.call(l,i):e.set(l,i),i);var Ku=(l,e,i,s)=>({set _(r){h(l,e,r,i)},get _(){return t(l,e,s)}}),n=(l,e,i)=>($d(l,e,"access private method"),i);var Fu=ju(()=>{"use strict"});var Qm={};Gu(Qm,{ReceiptPage:()=>Du});var zs,Oi,ad,M,yn,bn,cd,Z,ee,ld,Jm,dd,Ym,ud,Zm,hd,Xm,pe,ye,Ri,fn,vn,zu,wn,Wu,Sn,Bu,_n,Vu,li,Ds,Cn,Hu,Du,ef=ju(()=>{"use strict";Fu();Du=class{constructor(e,i,s){a(this,Z);a(this,ld);a(this,dd);a(this,ud);a(this,hd);a(this,pe);a(this,Ri);a(this,vn);a(this,wn);a(this,Sn);a(this,_n);a(this,li);a(this,Cn);a(this,zs,void 0);a(this,Oi,void 0);a(this,ad,void 0);a(this,M,null);a(this,yn,!1);a(this,bn,!1);a(this,cd,!1);h(this,zs,e),h(this,Oi,i),h(this,ad,s);let r=document.querySelector('meta[name="os-debug"]');h(this,cd,r?.getAttribute("content")==="true"),n(this,Z,ee).call(this,"info","ReceiptPage component created"),this.init()}async init(){if(t(this,bn)){n(this,Z,ee).call(this,"info","Receipt page already initialized, skipping");return}n(this,Z,ee).call(this,"info","Initializing Receipt Page"),h(this,bn,!0);let i=new URLSearchParams(window.location.search).get("ref_id");if(!i){n(this,Z,ee).call(this,"error","No ref_id found in URL parameters"),n(this,Cn,Hu).call(this,"Order reference not found. Please check your URL.");return}n(this,Z,ee).call(this,"info",`Found ref_id in URL: ${i}`);try{await n(this,ld,Jm).call(this,i),n(this,dd,Ym).call(this)}catch(s){n(this,Z,ee).call(this,"error","Error initializing receipt page:",s),n(this,Cn,Hu).call(this,"Failed to load order details. Please try again later.")}}};zs=new WeakMap,Oi=new WeakMap,ad=new WeakMap,M=new WeakMap,yn=new WeakMap,bn=new WeakMap,cd=new WeakMap,Z=new WeakSet,ee=function(e,i,...s){try{t(this,Oi)&&typeof t(this,Oi)[e]=="function"?t(this,Oi)[e](i,...s):console[e]?console[e](i,...s):(`${e.toUpperCase()}${i}`,[...s])}catch(r){console.error("Error logging message:",r)}},ld=new WeakSet,Jm=async function(e){if(n(this,Z,ee).call(this,"info",`Fetching order details for ref_id: ${e}`),t(this,yn)&&t(this,M))return n(this,Z,ee).call(this,"info","Order already fetched, using cached data"),t(this,M);try{if(!t(this,zs))throw new Error("API client not available");return n(this,Z,ee).call(this,"debug","Making API request to fetch order details"),h(this,M,await t(this,zs).getOrder(e)),h(this,yn,!0),n(this,Z,ee).call(this,"info","Order details fetched successfully"),n(this,Z,ee).call(this,"debug","Order data:",t(this,M)),t(this,M)}catch(i){throw n(this,Z,ee).call(this,"error",`Error fetching order details for ref_id ${e}:`,i),i}},dd=new WeakSet,Ym=function(){if(!t(this,M)){n(this,Z,ee).call(this,"error","No order data available to update receipt content");return}n(this,Z,ee).call(this,"info","Updating receipt content with order details"),n(this,pe,ye).call(this,"fname",t(this,M).user?.first_name||""),t(this,M).billing_address&&(n(this,pe,ye).call(this,"billing_fname",`${t(this,M).billing_address.first_name} ${t(this,M).billing_address.last_name}`),n(this,pe,ye).call(this,"billing_address",n(this,vn,zu).call(this,t(this,M).billing_address)),n(this,pe,ye).call(this,"billing_location",n(this,wn,Wu).call(this,t(this,M).billing_address)),n(this,pe,ye).call(this,"billing_country",n(this,Sn,Bu).call(this,t(this,M).billing_address.country)||"")),t(this,M).shipping_address&&(n(this,pe,ye).call(this,"shipping_fname",`${t(this,M).shipping_address.first_name} ${t(this,M).shipping_address.last_name}`),n(this,pe,ye).call(this,"shipping_address",n(this,vn,zu).call(this,t(this,M).shipping_address)),n(this,pe,ye).call(this,"shipping_location",n(this,wn,Wu).call(this,t(this,M).shipping_address)),n(this,pe,ye).call(this,"shipping_country",n(this,Sn,Bu).call(this,t(this,M).shipping_address.country)||""));let e=n(this,ud,Zm).call(this);n(this,pe,ye).call(this,"payment_method",e),n(this,hd,Xm).call(this);let i=t(this,M).shipping_method||"Standard Shipping";if(n(this,pe,ye).call(this,"shipping-method",i),n(this,pe,ye).call(this,"shipping_method",i),t(this,M).shipping_excl_tax!==void 0){let o=n(this,li,Ds).call(this,parseFloat(t(this,M).shipping_excl_tax));n(this,pe,ye).call(this,"shipping-price",o);let c=document.querySelector('[data-os-receipt="shipping-container"]');c&&(c.style.display="flex")}let s=document.querySelector('[data-os-receipt="tax-container"]');if(s){let o=parseFloat(t(this,M).total_tax||0);o>0?(s.style.display="flex",n(this,pe,ye).call(this,"taxes",n(this,li,Ds).call(this,o))):s.style.display="none"}let r=n(this,li,Ds).call(this,parseFloat(t(this,M).total_incl_tax)||0);n(this,pe,ye).call(this,"total",r),n(this,pe,ye).call(this,"order_number",t(this,M).number||""),n(this,pe,ye).call(this,"order_reference",t(this,M).ref_id||""),n(this,Z,ee).call(this,"info","Receipt content updated successfully")},ud=new WeakSet,Zm=function(){return t(this,M).payment_detail&&t(this,M).payment_detail.payment_method?n(this,_n,Vu).call(this,t(this,M).payment_detail.payment_method):t(this,M).payment_method?n(this,_n,Vu).call(this,t(this,M).payment_method):"Credit Card"},hd=new WeakSet,Xm=function(){if(!t(this,M).lines||!Array.isArray(t(this,M).lines)){n(this,Z,ee).call(this,"warn","No order lines available");return}let e=document.querySelector('[data-os-receipt="order-lines"]');if(!e){n(this,Z,ee).call(this,"warn","Order lines container not found in DOM");return}e.innerHTML="";let i=document.querySelector('[data-os-receipt="product-line"]'),s=i?i.outerHTML:`
      <div data-os-receipt="product-line" class="cart-summary__line">
        <div class="cart-summary__line-item">
          <div data-os-receipt="line-title" class="cart-line__title"></div>
          <div data-os-receipt="line-saving" class="cart-line__discount"></div>
        </div>
        <div class="cart-summary__line-item">
          <p data-os-receipt="line-compare" class="pb-cart__line-price pb--compare"></p>
          <p data-os-receipt="line-subtotal" class="pb-cart__line-price"></p>
        </div>
      </div>
    `;t(this,M).lines.forEach(r=>{let o=document.createElement("div");o.innerHTML=s;let c=o.firstElementChild,d=r.product_title||r.title||r.package_title||"Product";if(n(this,Ri,fn).call(this,c,"line-title",d),r.price_excl_tax_excl_discounts&&parseFloat(r.price_excl_tax_excl_discounts)>parseFloat(r.price_excl_tax)){let p=parseFloat(r.price_excl_tax_excl_discounts),g=parseFloat(r.price_excl_tax),m=Math.round((1-g/p)*100);n(this,Ri,fn).call(this,c,"line-saving",`(${m}% OFF)`),n(this,Ri,fn).call(this,c,"line-compare",n(this,li,Ds).call(this,p))}else{let p=c.querySelector('[data-os-receipt="line-saving"]'),g=c.querySelector('[data-os-receipt="line-compare"]');p&&(p.style.display="none"),g&&(g.style.display="none")}let u=parseFloat(r.price_excl_tax)||0;n(this,Ri,fn).call(this,c,"line-subtotal",n(this,li,Ds).call(this,u)),e.appendChild(c)})},pe=new WeakSet,ye=function(e,i){let s=document.querySelectorAll(`[data-os-receipt="${e}"]`);if(s.length===0){n(this,Z,ee).call(this,"debug",`No elements found with data-os-receipt="${e}"`);return}s.forEach(r=>{r.textContent=i})},Ri=new WeakSet,fn=function(e,i,s){let r=e.querySelector(`[data-os-receipt="${i}"]`);if(!r){n(this,Z,ee).call(this,"debug",`No element found with data-os-receipt="${i}" in node`);return}r.textContent=s},vn=new WeakSet,zu=function(e){let i="";return e.line1&&(i+=e.line1),e.line2&&(i+=i?`, ${e.line2}`:e.line2),i},wn=new WeakSet,Wu=function(e){let i=[];return e.line4&&i.push(e.line4),e.state&&i.push(e.state),e.postcode&&i.push(e.postcode),i.join(", ")},Sn=new WeakSet,Bu=function(e){return{US:"United States",CA:"Canada",GB:"United Kingdom",AU:"Australia",NZ:"New Zealand"}[e]||e},_n=new WeakSet,Vu=function(e){return{card_token:"Credit Card",paypal:"PayPal",apple_pay:"Apple Pay",google_pay:"Google Pay",credit:"Credit Card",card:"Credit Card"}[e]||e},li=new WeakSet,Ds=function(e){let i=t(this,M).currency||"USD",s=parseFloat(e);if(isNaN(s))return n(this,Z,ee).call(this,"warn",`Invalid amount for currency formatting: ${e}`),`$0.00 ${i}`;try{return new Intl.NumberFormat("en-US",{style:"currency",currency:i}).format(s)}catch(r){return n(this,Z,ee).call(this,"error",`Error formatting currency: ${r}`),`$${s.toFixed(2)} ${i}`}},Cn=new WeakSet,Hu=function(e){n(this,Z,ee).call(this,"error",`Displaying error message: ${e}`);let i=document.querySelector(".receipt-content")||document.body,s=document.createElement("div");s.className="receipt-error",s.style.color="red",s.style.padding="20px",s.style.margin="20px 0",s.style.border="1px solid red",s.style.borderRadius="5px",s.style.backgroundColor="rgba(255, 0, 0, 0.1)",s.textContent=e,i.prepend(s)}});var Kf={};Gu(Kf,{TwentyNineNext:()=>xn});var st,$t,hi,js,E,An,Ju,kn,Yu,$n,Zu,Gt,Wi,Gs,Td,En=class{constructor(e){a(this,An);a(this,kn);a(this,$n);a(this,Gt);a(this,Gs);a(this,st,void 0);a(this,$t,void 0);a(this,hi,void 0);a(this,js,"https://campaigns.apps.29next.com/api/v1");a(this,E,void 0);h(this,st,e),h(this,E,e.logger.createModuleLogger("API"))}init(){if(t(this,E).info("Initializing ApiClient"),n(this,An,Ju).call(this),h(this,hi,n(this,kn,Yu).call(this)),t(this,hi))h(this,$t,t(this,hi)),t(this,E).info(`Using campaign ID as API key: ${t(this,$t)}`);else{let s=document.querySelector('meta[name="os-api-key"]');h(this,$t,s?.getAttribute("content")),t(this,E).info(t(this,$t)?"API key retrieved from meta tag":"API key is not set")}let i=document.querySelector('meta[name="os-proxy-url"]')?.getAttribute("content");i&&(h(this,js,i),t(this,E).info(`Using proxy URL: ${i}`))}async getCampaign(){try{let e=await n(this,Gt,Wi).call(this,"campaigns/");if(t(this,E).debug("Campaign data received"),Array.isArray(e)&&e.length>0)return e[0];if(e?.name)return e;throw new Error("No valid campaign data found")}catch(e){return t(this,E).error("Error fetching campaign:",e),t(this,E).warn("Using fallback empty campaign object"),{name:"Default Campaign",currency:"USD",packages:[],formatPrice:i=>`$${Number.parseFloat(i).toFixed(2)}`}}}getCampaignId(){return t(this,hi)}async createCart(e){t(this,E).debug("Creating cart",e),e.attribution?t(this,E).debug("Cart already has attribution data:",e.attribution):(e.attribution=n(this,Gs,Td).call(this),t(this,E).debug("Added attribution data to cart:",e.attribution));try{let i=await n(this,Gt,Wi).call(this,"carts/","POST",e);return t(this,E).info("Cart created successfully",i),i}catch(i){throw t(this,E).error("Error creating cart",i),i}}async createOrder(e){if(t(this,E).info("Sending /order/create payload:",e),e.attribution?t(this,E).debug("Order already has attribution data:",e.attribution):(e.attribution=n(this,Gs,Td).call(this),t(this,E).debug("Added attribution data to order:",e.attribution)),e.vouchers){if(Array.isArray(e.vouchers)&&e.vouchers.length>0){let i=e.vouchers[0];typeof i=="object"&&i!==null&&(e.vouchers=e.vouchers.map(s=>typeof s=="string"?s:s&&s.code?s.code:String(s)),t(this,E).debug("Converted voucher objects to string codes for API:",e.vouchers))}Array.isArray(e.vouchers)||(typeof e.vouchers=="string"?e.vouchers=[e.vouchers]:(t(this,E).warn("Invalid vouchers format, removing:",e.vouchers),delete e.vouchers)),e.vouchers&&t(this,E).debug("Final vouchers format for API:",e.vouchers)}(e.payment_token==="test_card"||e.payment_detail&&e.payment_detail.card_token==="test_card")&&(t(this,E).debug("Using test card token for order"),e.payment_detail=e.payment_detail||{},e.payment_detail.payment_method="card_token",e.payment_detail.card_token="test_card",e.payment_token&&delete e.payment_token);try{let i=await n(this,Gt,Wi).call(this,"orders/","POST",e);return t(this,E).info("Order created successfully",i),i.ref_id&&(sessionStorage.setItem("order_ref_id",i.ref_id),t(this,E).debug(`Order reference ID stored: ${i.ref_id}`)),i}catch(i){throw t(this,E).error("Error creating order",i),i}}async getOrder(e){if(!e)throw new Error("Order reference is required");return t(this,E).debug(`Fetching order with ref: ${e}`),n(this,Gt,Wi).call(this,`orders/${e}/`)}async createOrderUpsell(e,i){if(!e)throw new Error("Order reference is required");t(this,E).debug(`Adding upsell to order ref: ${e}`,i);let s={lines:Array.isArray(i.lines)?i.lines:[{package_id:i.package_id,quantity:i.quantity||1}]};i.payment_detail&&(s.payment_detail=i.payment_detail);try{let r=await n(this,Gt,Wi).call(this,`orders/${e}/upsells/`,"POST",s);return t(this,E).info("Upsell added successfully",r),r}catch(r){throw t(this,E).error("Error adding upsell to order",r),r}}getNextPageUrlFromMeta(e=null){let i=document.querySelector('meta[name="os-next-page"]');if(!i||!i.getAttribute("content"))return t(this,E).debug("No meta tag found for next page URL"),null;let s=i.getAttribute("content");t(this,E).debug(`Found meta tag with next page URL: ${s}`);let r=s.startsWith("http")?new URL(s):new URL(s,`${location.protocol}//${location.host}`);return e&&r.searchParams.append("ref_id",e),r.href}async processPayment(e,i){t(this,E).debug(`Processing ${i} payment for order`);let s={credit:"card_token",paypal:"paypal",apple_pay:"apple_pay",google_pay:"google_pay"};if(e.payment_detail=e.payment_detail??{},e.payment_detail.payment_method=s[i]??i,i==="credit"&&!e.payment_detail.card_token)throw new Error("Credit card payment requires a card token");if(i!=="credit"&&delete e.payment_detail.card_token,!e.success_url){let r=this.getNextPageUrlFromMeta(e.ref_id);r?(e.success_url=r,t(this,E).debug(`Set success_url from meta tag: ${e.success_url}`)):t(this,E).debug("No meta tag found for success_url, API will use order_status_url as fallback")}if(!e.payment_failed_url){let r=new URL(window.location.href);r.searchParams.set("payment_failed","true"),r.searchParams.set("payment_method",i),e.payment_failed_url=r.href,t(this,E).debug(`Set payment_failed_url to: ${e.payment_failed_url}`)}return this.createOrder(e)}getNextUrlFromOrderResponse(e){t(this,E).debug("Getting next URL for redirect");let i=e.ref_id;if(e.payment_complete_url)return t(this,E).debug(`Using payment complete URL from API: ${e.payment_complete_url}`),e.payment_complete_url;let s=this.getNextPageUrlFromMeta(i);return s||(e.order_status_url?(t(this,E).debug(`Using order status URL from API: ${e.order_status_url}`),e.order_status_url):(t(this,E).warn("No order_status_url found in API response - using fallback URL"),`${window.location.origin}/checkout/confirmation/?ref_id=${i||""}`))}};st=new WeakMap,$t=new WeakMap,hi=new WeakMap,js=new WeakMap,E=new WeakMap,An=new WeakSet,Ju=function(){let i=new URLSearchParams(window.location.search).get("campaignId");i&&(t(this,E).info(`Found campaignId in URL: ${i}`),sessionStorage.setItem("os-campaign-id",i),t(this,E).info("Saved campaignId to session storage"))},kn=new WeakSet,Yu=function(){let e=sessionStorage.getItem("os-campaign-id");if(e)return t(this,E).info(`Using campaign ID from session storage: ${e}`),e;let s=document.querySelector('meta[name="os-campaign-id"]')?.getAttribute("content")??null;return s?(t(this,E).info(`Using campaign ID from meta tag: ${s}`),s):(t(this,E).warn("No campaign ID found in session storage or meta tag"),null)},$n=new WeakSet,Zu=function(e){let i=e.startsWith("/")?e.slice(1):e;return`${t(this,js)}/${i}`},Gt=new WeakSet,Wi=async function(e,i="GET",s=null){if(!t(this,$t)){if(t(this,E).warn("API key is not set"),e==="campaigns/")return t(this,E).info("Returning mock campaign data since API key is not set"),[{name:"Mock Campaign",id:"mock-campaign",currency:"USD",locale:"en-US",packages:[],products:[]}];throw new Error("API key is required")}let r=n(this,$n,Zu).call(this,e),o={method:i,mode:"cors",credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:t(this,$t)}};i!=="GET"&&s&&(o.body=JSON.stringify(s)),t(this,E).debug(`Making ${i} request to ${r}`,i!=="GET"?{requestData:s}:{});try{let c=await fetch(r,o);if(t(this,E).debug(`Received response from ${r} with status ${c.status}`),!c.ok){let u=await c.json().catch(()=>({}));throw t(this,E).error(`API error response from ${r}:`,u),new Error(JSON.stringify(u))}let d=await c.json();return t(this,E).debug(`Successfully processed response from ${r}`),d}catch(c){throw t(this,E).error(`API request failed: ${e}`,c),c.message?.match(/NetworkError|Failed to fetch|Network request failed/)&&t(this,E).warn("This appears to be a CORS issue. Make sure the API endpoint allows cross-origin requests."),c}},Gs=new WeakSet,Td=function(){if(t(this,st).attribution)return typeof t(this,st).attribution.getAttributionForApi=="function"?t(this,st).attribution.getAttributionForApi():t(this,st).attribution.getAttributionData();if(t(this,st).state){let e=t(this,st).state.getState("attribution");return e||t(this,st).state.getState("cart.attribution")||{}}return{}};var Kt,Jt,Bi,Pn,Xu,Ln,Qu,In,eh,qn,th,Mn,ih,Fn,sh,Nn,rh,Un,nh,Tn=class{constructor(e=!1){a(this,Pn);a(this,Ln);a(this,In);a(this,qn);a(this,Mn);a(this,Fn);a(this,Nn);a(this,Un);a(this,Kt,void 0);a(this,Jt,"29next");a(this,Bi,0);h(this,Kt,e),this.setStartupTime()}setDebug(e){h(this,Kt,e)}setStartupTime(){h(this,Bi,+new Date),window.twentyNineNextStartupTime=t(this,Bi)}getElapsedTime(){return+new Date-t(this,Bi)}createModuleLogger(e){let i=`${t(this,Jt)} [${e}]`;return{debug:(...s)=>n(this,qn,th).call(this,i,...s),info:(...s)=>n(this,Pn,Xu).call(this,i,...s),warn:(...s)=>n(this,Ln,Qu).call(this,i,...s),error:(...s)=>n(this,In,eh).call(this,i,...s),debugWithTime:(...s)=>n(this,Un,nh).call(this,i,...s),infoWithTime:(...s)=>n(this,Mn,ih).call(this,i,...s),warnWithTime:(...s)=>n(this,Fn,sh).call(this,i,...s),errorWithTime:(...s)=>n(this,Nn,rh).call(this,i,...s)}}logWithTime(e,...i){let s=this.getElapsedTime();`${t(this,Jt)}${s}${e}`,[...i]}warnWithTime(e,...i){let s=this.getElapsedTime();console.warn(`%c${t(this,Jt)} +${s}ms%c ${e}`,"color: #ff9900; font-weight: bold;","color: inherit;",...i)}errorWithTime(e,...i){let s=this.getElapsedTime();console.error(`%c${t(this,Jt)} +${s}ms%c ${e}`,"color: #cc0000; font-weight: bold;","color: inherit;",...i)}debugWithTime(e,...i){if(t(this,Kt)){let s=this.getElapsedTime();console.debug(`%c${t(this,Jt)}:debug +${s}ms%c ${e}`,"color: #666666; font-weight: bold;","color: inherit;",...i)}}};Kt=new WeakMap,Jt=new WeakMap,Bi=new WeakMap,Pn=new WeakSet,Xu=function(e,i,...s){`${e}${i}`,[...s]},Ln=new WeakSet,Qu=function(e,i,...s){console.warn(`%c${e}%c ${i}`,"color: #ff9900; font-weight: bold;","color: inherit;",...s)},In=new WeakSet,eh=function(e,i,...s){console.error(`%c${e}%c ${i}`,"color: #cc0000; font-weight: bold;","color: inherit;",...s)},qn=new WeakSet,th=function(e,i,...s){t(this,Kt)&&console.debug(`%c${e}:debug%c ${i}`,"color: #666666; font-weight: bold;","color: inherit;",...s)},Mn=new WeakSet,ih=function(e,i,...s){let r=this.getElapsedTime();`${e}${r}${i}`,[...s]},Fn=new WeakSet,sh=function(e,i,...s){let r=this.getElapsedTime();console.warn(`%c${e} +${r}ms%c ${i}`,"color: #ff9900; font-weight: bold;","color: inherit;",...s)},Nn=new WeakSet,rh=function(e,i,...s){let r=this.getElapsedTime();console.error(`%c${e} +${r}ms%c ${i}`,"color: #cc0000; font-weight: bold;","color: inherit;",...s)},Un=new WeakSet,nh=function(e,i,...s){if(t(this,Kt)){let r=this.getElapsedTime();console.debug(`%c${e}:debug +${r}ms%c ${i}`,"color: #666666; font-weight: bold;","color: inherit;",...s)}};var Dn,fe,be,Ie,De,K,zn,oh,Wn,ah,Ks,Pd,Bn,ch,Js,Ld,Vi,On,Vn,lh,Hn,dh,Ys,Id,jn,uh,Zs,qd,Gn,hh,Kn,ph,Jn,gh,Rn=class{constructor(e,i){a(this,zn);a(this,Wn);a(this,Ks);a(this,Bn);a(this,Js);a(this,Vi);a(this,Vn);a(this,Hn);a(this,Ys);a(this,jn);a(this,Zs);a(this,Gn);a(this,Kn);a(this,Jn);a(this,Dn,void 0);a(this,fe,void 0);a(this,be,void 0);a(this,Ie,[]);a(this,De,{});a(this,K,void 0);h(this,Dn,e),h(this,fe,i),h(this,be,n(this,Wn,ah).call(this)),h(this,K,{shippingCountry:document.querySelector('[os-checkout-field="country"]'),shippingState:document.querySelector('[os-checkout-field="province"]'),billingCountry:document.querySelector('[os-checkout-field="billing-country"]'),billingState:document.querySelector('[os-checkout-field="billing-province"]')}),n(this,Hn,dh).call(this),t(this,K).shippingCountry||t(this,K).billingCountry?(t(this,fe).info("AddressHandler initialized"),n(this,zn,oh).call(this)):t(this,fe).warn("No country selects found")}};Dn=new WeakMap,fe=new WeakMap,be=new WeakMap,Ie=new WeakMap,De=new WeakMap,K=new WeakMap,zn=new WeakSet,oh=async function(){await n(this,jn,uh).call(this),await Promise.all([t(this,K).shippingCountry&&n(this,Ks,Pd).call(this,t(this,K).shippingCountry,t(this,K).shippingState),t(this,K).billingCountry&&n(this,Ks,Pd).call(this,t(this,K).billingCountry,t(this,K).billingState)]),n(this,Bn,ch).call(this),n(this,Gn,hh).call(this),n(this,Kn,ph).call(this)},Wn=new WeakSet,ah=function(){return{defaultCountry:window.osConfig?.addressConfig?.defaultCountry??document.querySelector('meta[name="os-address-default-country"]')?.content??"US",showCountries:window.osConfig?.addressConfig?.showCountries??document.querySelector('meta[name="os-address-show-countries"]')?.content?.split(",").map(e=>e.trim())??[],dontShowStates:window.osConfig?.addressConfig?.dontShowStates??document.querySelector('meta[name="os-address-dont-show-states"]')?.content?.split(",").map(e=>e.trim())??[],countries:window.osConfig?.addressConfig?.countries??[]}},Ks=new WeakSet,Pd=async function(e,i){e.innerHTML='<option value="">Select Country</option>'+t(this,Ie).map(r=>`<option value="${r.iso2}">${r.name}</option>`).join(""),e.value=t(this,be).defaultCountry,i&&e.value&&await n(this,Vi,On).call(this,i,e.value);let s=e===t(this,K).shippingCountry?"shipping":"billing";n(this,Js,Ld).call(this,e.value,s),t(this,fe).debug(`Country select initialized with default ${t(this,be).defaultCountry}`)},Bn=new WeakSet,ch=function(){[[t(this,K).shippingCountry,t(this,K).shippingState],[t(this,K).billingCountry,t(this,K).billingState]].forEach(([i,s])=>{i?.addEventListener("change",()=>{s&&n(this,Vi,On).call(this,s,i.value),n(this,Js,Ld).call(this,i.value,i===t(this,K).shippingCountry?"shipping":"billing")})})},Js=new WeakSet,Ld=function(e,i="shipping"){let s=i==="billing"?"billing-":"",r=document.querySelector(`[os-checkout-field="${s}postal"]`),o=document.querySelector(`[os-checkout-field="${s}province"]`),c=o?.closest(".select-form-wrapper")?.querySelector("select")||o;if(e==="CA"){if(r&&(r.placeholder="Postal Code*",r.setAttribute("pattern","^[A-Za-z]\\d[A-Za-z][ -]?\\d[A-Za-z]\\d$"),r.setAttribute("maxlength","7")),c){let d=c.querySelector('option[value=""]');d&&(d.textContent="Select Province")}}else if(r&&(r.placeholder="ZIP Code*",r.setAttribute("pattern","(^\\d{5}$)|(^\\d{5}-\\d{4}$)"),r.setAttribute("maxlength","10")),c){let d=c.querySelector('option[value=""]');d&&(d.textContent="Select State")}t(this,fe).debug(`Updated field labels for ${i} address to ${e} format`)},Vi=new WeakSet,On=async function(e,i,s=!1){if(!i)return e.innerHTML='<option value="">Select State</option>';let r=t(this,De)[i]||await n(this,Zs,qd).call(this,i);s&&await r,n(this,Vn,lh).call(this,e,r),t(this,fe).debug(`State select updated for ${i}`)},Vn=new WeakSet,lh=function(e,i){let s=e.value||e.getAttribute("data-pending-state")||"";e.innerHTML='<option value="">Select State</option>'+i.map(r=>`<option value="${r.iso2}">${r.name}</option>`).join(""),e.parentElement.style.display=i.length?"":"none",s&&Array.from(e.options).some(r=>r.value===s)&&(e.value=s)},Hn=new WeakSet,dh=function(){let e=i=>{let s=JSON.parse(localStorage.getItem(i)??"{}");return Date.now()-(s.timestamp??0)<864e5?s:{}};h(this,Ie,e("os_countries_cache").countries??[]),t(this,Ie).length&&t(this,be).showCountries.length&&(h(this,Ie,t(this,Ie).filter(i=>t(this,be).showCountries.includes(i.iso2))),t(this,fe).debug(`Filtered cached countries to: ${t(this,be).showCountries.join(", ")}`)),h(this,De,e("os_states_cache").states??{}),t(this,fe).debug(`Loaded cached data: ${t(this,Ie).length} countries, ${Object.keys(t(this,De)).length} state sets`)},Ys=new WeakSet,Id=function(e,i){localStorage.setItem(e,JSON.stringify({...i,timestamp:Date.now()}))},jn=new WeakSet,uh=async function(){t(this,Ie).length||(h(this,Ie,t(this,be).countries.length?t(this,be).countries.map(e=>({iso2:e.iso2||e.code,name:e.name})):(await(await fetch("https://api.countrystatecity.in/v1/countries",{headers:{"X-CSCAPI-KEY":"c2R3MzNhYmpvYUJPdmhkUlE5TUJWYUtJUGs2TTlNU3cyRmxmVW9wVQ=="}})).json()).filter(e=>!t(this,be).showCountries.length||t(this,be).showCountries.includes(e.iso2))),t(this,Ie).sort((e,i)=>e.name.localeCompare(i.name)),n(this,Ys,Id).call(this,"os_countries_cache",{countries:t(this,Ie)}),t(this,fe).info(`Loaded ${t(this,Ie).length} countries`))},Zs=new WeakSet,qd=async function(e){if(t(this,De)[e])return t(this,De)[e];try{let i=(await(await fetch(`https://api.countrystatecity.in/v1/countries/${e}/states`,{headers:{"X-CSCAPI-KEY":"c2R3MzNhYmpvYUJPdmhkUlE5TUJWYUtJUGs2TTlNU3cyRmxmVW9wVQ=="}})).json()).filter(s=>!t(this,be).dontShowStates.includes(s.iso2));return i.sort((s,r)=>s.name.localeCompare(r.name)),t(this,De)[e]=i,n(this,Ys,Id).call(this,"os_states_cache",{states:t(this,De)}),t(this,fe).debug(`Loaded and sorted ${i.length} states for ${e}`),i}catch(i){return t(this,fe).error(`Failed to load states for ${e}:`,i),t(this,De)[e]=e==="US"?[]:[],t(this,De)[e]}},Gn=new WeakSet,hh=async function(){if(t(this,K).shippingCountry?.value||t(this,K).billingCountry?.value)return;let e=t(this,be).defaultCountry||(await Promise.any(["https://ipapi.co/json/","https://ipinfo.io/json"].map(i=>fetch(i).then(s=>s.json()))))?.country_code;[t(this,K).shippingCountry,t(this,K).billingCountry].forEach(i=>{i&&(i.value=e,i.dispatchEvent(new Event("change")))}),t(this,fe).debug(`User country detected/set to ${e}`)},Kn=new WeakSet,ph=function(){let e=Object.values(t(this,K)).filter(Boolean),i=new MutationObserver(s=>{s.forEach(r=>{if(r.attributeName==="value"&&r.target.value){let o=r.target===t(this,K).shippingCountry?t(this,K).shippingState:t(this,K).billingState;o&&n(this,Vi,On).call(this,o,r.target.value,!0),t(this,fe).debug(`Autocomplete detected on ${r.target.getAttribute("os-checkout-field")}`)}})});e.forEach(s=>i.observe(s,{attributes:!0,attributeFilter:["value"]})),n(this,Jn,gh).call(this),t(this,fe).debug("Autocomplete detection set up")},Jn=new WeakSet,gh=function(){let e=t(this,be).showCountries.length?t(this,be).showCountries:["US","CA","GB","AU"];e.forEach(i=>!t(this,De)[i]&&n(this,Zs,qd).call(this,i)),t(this,fe).debug(`Preloading states for ${e.join(", ")}`)};var Hi,Yt,Yn,Qs,pi,er,tr,Zn,mh,qe,Je,Xn,fh,Qn,yh,ir,Md,eo,bh,to,vh,io,wh,so,Sh,ro,_h,Od,Cf,sr,Fd,gi,Xs,rr,Nd,no,Ch,oo,xh,ao,Eh,co,Ah,lo,kh,ze,rt,uo,$h,nr,Ud,ho,Th,po,Ph,go,Lh,mo,Ih,ji=class{constructor(e={}){a(this,Zn);a(this,qe);a(this,Xn);a(this,Qn);a(this,ir);a(this,eo);a(this,to);a(this,io);a(this,so);a(this,ro);a(this,Od);a(this,sr);a(this,gi);a(this,rr);a(this,no);a(this,oo);a(this,ao);a(this,co);a(this,lo);a(this,ze);a(this,uo);a(this,nr);a(this,ho);a(this,po);a(this,go);a(this,mo);a(this,Hi,void 0);a(this,Yt,void 0);a(this,Yn,{});a(this,Qs,!1);a(this,pi,!1);a(this,er,!1);a(this,tr,!1);h(this,Qs,e.debugMode||!1),h(this,Hi,e.logger||console),h(this,Yt,n(this,Zn,mh).call(this)),h(this,pi,typeof Spreedly<"u"),t(this,Yt)&&n(this,Xn,fh).call(this)}validateAllFields(e=this.getSelectedPaymentMethod()){t(this,Qs)&&n(this,io,wh).call(this,e);let i=["credit","credit-card"].includes(e),s=!0,r=Array.from(document.querySelectorAll('[os-checkout-validate="required"]')),o=n(this,so,Sh).call(this,r,i),c=!0;i&&(c=this.validateCreditCard());let d=n(this,po,Ph).call(this);return o?(n(this,nr,Ud).call(this,o),s=!1):d?s=!1:c||(s=!1),s}clearErrorForField(e){if(!e)return;e.classList.remove("error"),(e.closest(".frm-flds")||e.closest(".form-group")||e.parentElement)?.querySelector(".pb-input-error")?.remove();let s=e.getAttribute("os-checkout-field");if(["cc-number","cvv"].includes(s)){let r=`spreedly-${s==="cc-number"?"number":"cvv"}`,o=document.getElementById(r);o&&(o.classList.remove("error"),o.closest(".frm-flds")?.querySelector(".pb-input-error")?.remove())}}clearAllErrors(){h(this,Yn,{}),document.querySelectorAll(".error").forEach(e=>e.classList.remove("error")),document.querySelectorAll(".pb-input-error").forEach(e=>e.remove()),n(this,rr,Nd).call(this)}isSameAsShipping(){let e=document.querySelector('[os-checkout-field="same-as-shipping"] input[type="checkbox"]')||document.querySelector('[os-input-field="use-shipping-address"] input[type="checkbox"]')||document.querySelector("#use_shipping_address");return e?e.checked:!0}getSelectedPaymentMethod(){return document.querySelector('input[name="payment_method"]:checked')?.value||document.querySelector('input[name="combo_mode"]:checked')?.value||"credit"}getFormValues(){let e={};return t(this,Yt).querySelectorAll("input, select, textarea").forEach(i=>{if(["button","submit"].includes(i.type)||i.disabled||!i.name)return;let s=i.getAttribute("os-checkout-field")||i.name;if(i.type==="checkbox")e[s]=i.checked;else if(i.type==="radio")i.checked&&(e[s]=i.value);else if(s.includes(".")){let[r,o]=s.split(".");e[r]=e[r]||{},e[r][o]=i.value}else e[s]=i.value}),e}validateCreditCard(){let e=!0,[i,s]=n(this,sr,Fd).call(this);if(n(this,gi,Xs).call(this,i,"month")||(e=!1),n(this,gi,Xs).call(this,s,"year")||(e=!1),t(this,pi)&&typeof Spreedly.validate=="function"){let r=document.getElementById("spreedly-number"),o=document.getElementById("spreedly-cvv"),c=r?.classList.contains("spreedly-valid"),d=o?.classList.contains("spreedly-valid");Spreedly.validate(),!c&&r&&(n(this,ze,rt).call(this,r,"Please enter a valid credit card number"),e=!1),!d&&o&&(n(this,ze,rt).call(this,o,"Please enter a valid security code (CVV)"),e=!1)}else{let r=document.querySelector('[os-checkout-field="cc-number"]'),o=document.querySelector('[os-checkout-field="cvv"]');r?.value.trim()||(n(this,ze,rt).call(this,r,"Please enter a credit card number"),e=!1),o?.value.trim()||(n(this,ze,rt).call(this,o,"Please enter a security code (CVV)"),e=!1)}return e}};Hi=new WeakMap,Yt=new WeakMap,Yn=new WeakMap,Qs=new WeakMap,pi=new WeakMap,er=new WeakMap,tr=new WeakMap,Zn=new WeakSet,mh=function(){let e=document.querySelector('form[os-checkout="form"]')||document.querySelector("form#combo_form");return e||n(this,qe,Je).call(this,"warn","No checkout form found"),e},qe=new WeakSet,Je=function(e,i,...s){try{(t(this,Hi)?.[e]||console[e]||console.log).call(console,`[${e.toUpperCase()}] ${i}`,...s)}catch(r){console.error("Error logging:",r)}},Xn=new WeakSet,fh=function(){t(this,Yt).addEventListener("submit",e=>n(this,to,vh).call(this,e)),document.querySelector('[os-checkout-payment="combo"]')?.addEventListener("click",()=>{this.validateAllFields()&&t(this,Yt).submit()}),document.addEventListener("payment-method-changed",()=>this.clearAllErrors()),t(this,pi)&&typeof Spreedly.on=="function"&&n(this,Qn,yh).call(this),n(this,go,Lh).call(this)},Qn=new WeakSet,yh=function(){Object.entries({ready:()=>{h(this,tr,!0),n(this,qe,Je).call(this,"debug","Spreedly is ready")},paymentMethod:(i,s)=>{h(this,er,!0),n(this,qe,Je).call(this,"debug","Spreedly payment method created"),n(this,rr,Nd).call(this)},validation:i=>{n(this,qe,Je).call(this,"debug",`Spreedly field validation: ${i.fieldType} ${i.valid?"valid":"invalid"}`);let s=document.getElementById(`spreedly-${i.fieldType}`);if(s)if(s.classList.toggle("spreedly-valid",i.valid),s._pendingValidation)if(s._pendingValidation=!1,!i.valid&&i.inputData&&i.inputData.length>0){s.classList.add("error");let r=n(this,ir,Md).call(this,i.fieldType);n(this,ze,rt).call(this,s,r)}else s.classList.remove("error"),this.clearErrorForField(s);else i.valid?(s.classList.remove("error"),this.clearErrorForField(s)):s.classList.remove("spreedly-valid")},errors:i=>{h(this,er,!1),n(this,qe,Je).call(this,"debug","Spreedly validation errors:",i),i.forEach(s=>n(this,eo,bh).call(this,s))},fieldEvent:(i,s,r,o)=>{let c=document.getElementById(`spreedly-${i}`);if(!c)return;let d=i==="number"?o.validNumber:o.validCvv;if(s==="input")c._validationTimeout&&clearTimeout(c._validationTimeout),d?(c.classList.add("spreedly-valid"),c.classList.remove("error"),this.clearErrorForField(c)):(c.classList.remove("spreedly-valid"),c._validationTimeout=setTimeout(()=>{typeof Spreedly<"u"&&typeof Spreedly.validate=="function"&&(c._pendingValidation=!0,Spreedly.validate())},1e3));else if(s==="blur"){if(c._validationTimeout&&clearTimeout(c._validationTimeout),d)c.classList.add("spreedly-valid"),c.classList.remove("error"),this.clearErrorForField(c);else if(o&&(o.length>0||o.number&&o.number.length>0||o.cardNumber&&o.cardNumber.length>0||o.cvv&&o.cvv.length>0)){c.classList.remove("spreedly-valid"),c.classList.add("error");let p=n(this,ir,Md).call(this,i);n(this,ze,rt).call(this,c,p)}}else s==="focus"&&(c.classList.remove("error"),this.clearErrorForField(c))}}).forEach(([i,s])=>Spreedly.on(i,s))},ir=new WeakSet,Md=function(e){return{number:"Please enter a valid credit card number",cvv:"Please enter a valid security code (CVV)"}[e]||`Invalid ${e}`},eo=new WeakSet,bh=function(e){let i={number:"spreedly-number",card_number:"spreedly-number",cvv:"spreedly-cvv",month:"cc-month",year:"cc-year",full_name:"cc-name",first_name:"cc-name",last_name:"cc-name"},s=document.getElementById(i[e.attribute])||document.querySelector(`[os-checkout-field="${i[e.attribute]}"]`);s&&n(this,ze,rt).call(this,s,e.message)},to=new WeakSet,vh=function(e){this.validateAllFields()||(e.preventDefault(),n(this,qe,Je).call(this,"warn","Form validation failed"))},io=new WeakSet,wh=function(e){n(this,qe,Je).call(this,"debug","Starting field validation for payment method:",e),n(this,qe,Je).call(this,"debug","Same as shipping:",this.isSameAsShipping()),n(this,qe,Je).call(this,"debug","Spreedly enabled:",t(this,pi)),n(this,qe,Je).call(this,"debug","Spreedly ready:",t(this,tr))},so=new WeakSet,Sh=function(e,i){let s=null;for(let r of e){let o=r.getAttribute("os-checkout-field");if(n(this,ro,_h).call(this,o,i)){this.clearErrorForField(r);continue}let c=r.previousElementSibling?.textContent||o||r.placeholder;n(this,no,Ch).call(this,r,c)||(s=s||r)}return s},ro=new WeakSet,_h=function(e,i){return this.isSameAsShipping()&&e?.startsWith("billing-")||i&&["cc-number","cvv"].includes(e)},Od=new WeakSet,Cf=function(){let[e,i]=n(this,sr,Fd).call(this);return n(this,gi,Xs).call(this,e,"month")&&n(this,gi,Xs).call(this,i,"year")},sr=new WeakSet,Fd=function(){let e=['[os-checkout-field="cc-month"]','[os-checkout-field="exp-month"]',"#credit_card_exp_month"],i=['[os-checkout-field="cc-year"]','[os-checkout-field="exp-year"]',"#credit_card_exp_year"];return[e.map(s=>document.querySelector(s)).find(Boolean),i.map(s=>document.querySelector(s)).find(Boolean)]},gi=new WeakSet,Xs=function(e,i){return!e||!e.value?(n(this,qe,Je).call(this,"error",`${i} field is empty`),n(this,ze,rt).call(this,e,`Please select an expiration ${i}`),!1):!0},rr=new WeakSet,Nd=function(){["cc-number","cvv"].forEach(e=>this.clearErrorForField(document.querySelector(`[os-checkout-field="${e}"]`))),["spreedly-number","spreedly-cvv"].forEach(e=>this.clearErrorForField(document.getElementById(e)))},no=new WeakSet,Ch=function(e,i){if(!e)return!0;let s=e.value.trim(),r=n(this,ao,Eh).call(this,e,s,n(this,oo,xh).call(this,e,i));return r.isValid?this.clearErrorForField(e):n(this,ze,rt).call(this,e,r.errorMessage),r.isValid},oo=new WeakSet,xh=function(e,i){let s=e.getAttribute("os-checkout-field")||e.name;return{fname:"First Name",lname:"Last Name",email:"Email",phone:"Phone Number",address1:"Address",address2:"Apartment or Suite",city:"City",province:"State/Province",postal:"ZIP/Postal Code",country:"Country","cc-number":"Credit Card Number",cvv:"Security Code","cc-month":"Expiration Month","cc-year":"Expiration Year","cc-name":"Name on Card","exp-month":"Expiration Month","exp-year":"Expiration Year","billing-fname":"Billing First Name","billing-lname":"Billing Last Name","billing-address1":"Billing Address","billing-address2":"Billing Apartment or Suite","billing-city":"Billing City","billing-province":"Billing State/Province","billing-postal":"Billing ZIP/Postal Code","billing-country":"Billing Country","billing-phone":"Billing Phone Number"}[s]||i||s},ao=new WeakSet,Eh=function(e,i,s){let r=e.tagName.toLowerCase(),o=e.getAttribute("os-checkout-field")||e.name;return r==="select"?{isValid:!!i,errorMessage:`Please select a ${s}`}:e.type==="tel"&&e.iti?i.trim()?{isValid:e.iti.isValidNumber(),errorMessage:"Please enter a valid US phone number (e.g. 555-555-5555)"}:{isValid:!0,errorMessage:""}:i?o&&(o.includes("city")||o.endsWith("-city"))?n(this,co,Ah).call(this,i,s):o&&(o.includes("zip")||o.includes("postal")||o.endsWith("-zip"))?n(this,lo,kh).call(this,i,o):e.type==="email"?{isValid:n(this,ho,Th).call(this,i),errorMessage:"Please enter a valid email address"}:{isValid:!0,errorMessage:""}:{isValid:!1,errorMessage:`Please enter your ${s}`}},co=new WeakSet,Ah=function(e,i){return{isValid:/^[a-zA-Z\s]{2,24}$/.test(e),errorMessage:"Please enter a valid city name (2-24 letters, no numbers or special characters)"}},lo=new WeakSet,kh=function(e,i="Zip"){let s;i.includes("billing")?s=document.querySelector('[os-checkout-field="billing-country"]'):s=document.querySelector('[os-checkout-field="country"]');let r=s?.value||"US",o,c;switch(r){case"CA":o=/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,c="Please enter a valid Canadian postal code (e.g. K1A 0B1)";break;case"US":default:o=/(^\d{5}$)|(^\d{5}-\d{4}$)/,c="Field must be a valid US Zip code.";break}let d=o.test(e);return{isValid:d,errorMessage:d?"":c}},ze=new WeakSet,rt=function(e,i){if(!e)return;e.classList.add("error");let s=e.closest(".frm-flds")||e.closest(".form-group")||e.parentElement,r=n(this,uo,$h).call(this,s);r.textContent=i,Object.assign(r.style,{color:"red",fontSize:"0.875rem",marginTop:"0.25rem"}),e.hasErrorListener||(e.hasErrorListener=!0,["input","change"].forEach(o=>e.addEventListener(o,()=>this.clearErrorForField(e))),e.type==="tel"&&e.iti&&e.addEventListener("countrychange",()=>this.clearErrorForField(e)))},uo=new WeakSet,$h=function(e){let i=e.querySelector(".pb-input-error");return i||(i=document.createElement("div"),i.className="pb-input-error",e.appendChild(i)),i},nr=new WeakSet,Ud=function(e){e&&(window.scrollTo({top:e.getBoundingClientRect().top+window.pageYOffset-100,behavior:"smooth"}),setTimeout(()=>e.focus(),500))},ho=new WeakSet,Th=function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},po=new WeakSet,Ph=function(){let e=Array.from(document.querySelectorAll('input[type="tel"]')),i=!1;for(let s of e){if(!s.value.trim()||!s.iti)continue;if(s.iti.isValidNumber())this.clearErrorForField(s);else{let o=s.iti.getValidationError(),d={0:"Please enter a valid US phone number (e.g. 555-555-5555)",1:"Invalid country code",2:"Phone number is too short",3:"Phone number is too long",4:"Please enter a valid phone number",5:"Invalid phone number format"}[o]||"Please enter a valid US phone number";n(this,ze,rt).call(this,s,d),i||(n(this,nr,Ud).call(this,s),i=!0)}}return i},go=new WeakSet,Lh=function(){[...document.querySelectorAll('[os-checkout-field="postal"]'),...document.querySelectorAll('[os-checkout-field="billing-postal"]'),...document.querySelectorAll('[os-checkout-field="zip"]')].forEach(i=>{i&&(i.addEventListener("input",s=>n(this,mo,Ih).call(this,s)),t(this,Hi).debug(`ZIP code formatting setup for: ${i.getAttribute("os-checkout-field")||i.name||"unknown"}`))})},mo=new WeakSet,Ih=function(e){let i=e.target,s=i.selectionStart,r=i.value,o=i.getAttribute("os-checkout-field")||"",c;o.includes("billing")?c=document.querySelector('[os-checkout-field="billing-country"]'):c=document.querySelector('[os-checkout-field="country"]');let d=c?.value||"US",u=r;if(d==="CA")u=r.toUpperCase().replace(/[^A-Z0-9]/g,""),u.length>3?u=u.slice(0,3)+" "+u.slice(3,6):u=u.slice(0,6);else{if(u=r.replace(/[^\d-]/g,""),u.length>5){let p=u.slice(0,5);if(u.charAt(5)!=="-"){let g=u.slice(5).replace(/-/g,"");u=`${p}-${g}`}else{let g=u.slice(6).replace(/-/g,"");u=`${p}-${g}`}}if(u.includes("-")){let[p,g]=u.split("-");u=`${p.slice(0,5)}-${g.slice(0,4)}`}else u=u.slice(0,5)}if(u!==r){i.value=u;let p=u.length-r.length;i.setSelectionRange(s+p,s+p)}};var or,ar,Gi,Ki,Ce,Ji,Yi,U,bo,vo,qh,wo,Mh,So,Fh,cr,Rd,_o,Nh,Co,Uh,xo,Oh,lr,Dd,Zi,fo,D,H,yo=class{constructor(e,i={}){a(this,vo);a(this,wo);a(this,So);a(this,cr);a(this,_o);a(this,Co);a(this,xo);a(this,lr);a(this,Zi);a(this,D);a(this,or,void 0);a(this,ar,!1);a(this,Gi,!1);a(this,Ki,null);a(this,Ce,null);a(this,Ji,null);a(this,Yi,null);a(this,U,null);a(this,bo,null);if(h(this,or,e),h(this,ar,i.debug||!1),h(this,bo,i.app||null),n(this,vo,qh).call(this),!e){n(this,D,H).call(this,"error","No environment key provided to SpreedlyManager");return}n(this,D,H).call(this,"debug",`SpreedlyManager initialized with environment key: ${e}`),n(this,wo,Mh).call(this)}clearAllErrors(){n(this,Zi,fo).call(this,"number"),n(this,Zi,fo).call(this,"cvv");let e=document.querySelector('[os-checkout-field="cc-month"]')||document.querySelector('[os-checkout-field="exp-month"]')||document.querySelector("#credit_card_exp_month"),i=document.querySelector('[os-checkout-field="cc-year"]')||document.querySelector('[os-checkout-field="exp-year"]')||document.querySelector("#credit_card_exp_year");if(e){e.classList.remove("error");let r=(e.closest(".frm-flds")||e.parentElement).querySelector(".pb-input-error");r&&r.remove()}if(i){i.classList.remove("error");let r=(i.closest(".frm-flds")||i.parentElement).querySelector(".pb-input-error");r&&r.remove()}}tokenizeCard(e){if(n(this,D,H).call(this,"debug","Tokenizing card with data:",{...e,full_name:e.full_name,month:e.month,year:e.year}),this.clearAllErrors(),!e.full_name||!e.month||!e.year){n(this,D,H).call(this,"error","Missing required card data");let i=[];e.full_name||i.push({attribute:"full_name",message:"Cardholder name is required"}),e.month||i.push({attribute:"month",message:"Expiration month is required"}),e.year||i.push({attribute:"year",message:"Expiration year is required"}),n(this,lr,Dd).call(this,i),t(this,Ce)&&t(this,Ce).call(this,i.map(s=>s.message));return}if(!t(this,Gi)){n(this,D,H).call(this,"error","Spreedly is not ready yet"),t(this,Ce)&&t(this,Ce).call(this,["Payment system is not ready yet. Please try again in a moment."]);return}try{Spreedly.tokenizeCreditCard(e),n(this,D,H).call(this,"debug","Card tokenization initiated")}catch(i){n(this,D,H).call(this,"error","Error tokenizing card",i),t(this,Ce)&&t(this,Ce).call(this,["An error occurred while processing your card. Please try again."])}}setOnReady(e){h(this,Ki,e),t(this,Gi)&&e&&e()}setOnError(e){h(this,Ce,e)}setOnPaymentMethod(e){h(this,Ji,e)}setOnValidation(e){h(this,Yi,e)}};or=new WeakMap,ar=new WeakMap,Gi=new WeakMap,Ki=new WeakMap,Ce=new WeakMap,Ji=new WeakMap,Yi=new WeakMap,U=new WeakMap,bo=new WeakMap,vo=new WeakSet,qh=function(){h(this,U,{fieldType:{number:"text",cvv:"text"},numberFormat:"prettyFormat",placeholder:{number:"Credit Card Number",cvv:"CVV *"},labels:{number:"Card Number",cvv:"CVV"},titles:{number:"Credit card number",cvv:"Card verification value"},styling:{number:'color: #212529; font-size: .925rem; font-weight: 400; width: 100%; height:100%; font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue","Noto Sans","Liberation Sans",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";',cvv:'color: #212529; font-size: .925rem; font-weight: 400; width: 100%; height: 100%; font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue","Noto Sans","Liberation Sans",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";'},placeholder_styling:"",required:{number:!0,cvv:!0},autocomplete:!0}),window.osConfig&&window.osConfig.spreedlyConfig&&(n(this,D,H).call(this,"debug","Found global Spreedly configuration",window.osConfig.spreedlyConfig),window.osConfig.spreedlyConfig.fieldType&&(t(this,U).fieldType={...t(this,U).fieldType,...window.osConfig.spreedlyConfig.fieldType}),window.osConfig.spreedlyConfig.numberFormat&&(t(this,U).numberFormat=window.osConfig.spreedlyConfig.numberFormat),window.osConfig.spreedlyConfig.placeholder&&(t(this,U).placeholder={...t(this,U).placeholder,...window.osConfig.spreedlyConfig.placeholder}),window.osConfig.spreedlyConfig.labels&&(t(this,U).labels={...t(this,U).labels,...window.osConfig.spreedlyConfig.labels}),window.osConfig.spreedlyConfig.titles&&(t(this,U).titles={...t(this,U).titles,...window.osConfig.spreedlyConfig.titles}),window.osConfig.spreedlyConfig.styling&&(t(this,U).styling={...t(this,U).styling,...window.osConfig.spreedlyConfig.styling}),window.osConfig.spreedlyConfig.placeholder_styling&&(t(this,U).placeholder_styling=window.osConfig.spreedlyConfig.placeholder_styling),window.osConfig.spreedlyConfig.required&&(t(this,U).required={...t(this,U).required,...window.osConfig.spreedlyConfig.required}),window.osConfig.spreedlyConfig.hasOwnProperty("autocomplete")&&(t(this,U).autocomplete=window.osConfig.spreedlyConfig.autocomplete)),n(this,D,H).call(this,"debug","Spreedly configuration initialized",t(this,U))},wo=new WeakSet,Mh=function(){typeof Spreedly>"u"?(n(this,D,H).call(this,"debug","Spreedly not loaded, loading script..."),n(this,So,Fh).call(this).then(()=>{n(this,D,H).call(this,"debug","Spreedly script loaded"),n(this,cr,Rd).call(this)}).catch(e=>{n(this,D,H).call(this,"error","Failed to load Spreedly script",e),t(this,Ce)&&t(this,Ce).call(this,["Failed to load Spreedly. Please refresh the page and try again."])})):(n(this,D,H).call(this,"debug","Spreedly already loaded"),n(this,cr,Rd).call(this))},So=new WeakSet,Fh=function(){return new Promise((e,i)=>{let s=document.createElement("script");s.src="https://core.spreedly.com/iframe/iframe-v1.min.js",s.async=!0,s.onload=e,s.onerror=i,document.head.appendChild(s)})},cr=new WeakSet,Rd=function(){try{n(this,D,H).call(this,"debug","Setting up Spreedly..."),n(this,Co,Uh).call(this),Spreedly.init(t(this,or),{numberEl:"spreedly-number",cvvEl:"spreedly-cvv"}),Spreedly.on("ready",()=>{n(this,D,H).call(this,"debug","Spreedly iframe ready"),n(this,_o,Nh).call(this),h(this,Gi,!0),t(this,Ki)&&t(this,Ki).call(this)}),n(this,xo,Oh).call(this),n(this,D,H).call(this,"debug","Spreedly setup complete")}catch(e){n(this,D,H).call(this,"error","Error setting up Spreedly",e),t(this,Ce)&&t(this,Ce).call(this,["Failed to set up Spreedly. Please refresh the page and try again."])}},_o=new WeakSet,Nh=function(){try{n(this,D,H).call(this,"debug","Applying Spreedly configuration..."),Spreedly.setFieldType("number",t(this,U).fieldType.number),Spreedly.setFieldType("cvv",t(this,U).fieldType.cvv),Spreedly.setNumberFormat(t(this,U).numberFormat),Spreedly.setPlaceholder("number",t(this,U).placeholder.number),Spreedly.setPlaceholder("cvv",t(this,U).placeholder.cvv),Spreedly.setLabel("number",t(this,U).labels.number),Spreedly.setLabel("cvv",t(this,U).labels.cvv),Spreedly.setTitle("number",t(this,U).titles.number),Spreedly.setTitle("cvv",t(this,U).titles.cvv),Spreedly.setStyle("number",t(this,U).styling.number),Spreedly.setStyle("cvv",t(this,U).styling.cvv),t(this,U).placeholder_styling&&Spreedly.setStyle("placeholder",t(this,U).placeholder_styling),t(this,U).required.number&&Spreedly.setRequiredAttribute("number"),t(this,U).required.cvv&&Spreedly.setRequiredAttribute("cvv"),t(this,U).autocomplete||Spreedly.toggleAutoComplete(),n(this,D,H).call(this,"debug","Spreedly configuration applied")}catch(e){n(this,D,H).call(this,"error","Error applying Spreedly configuration",e)}},Co=new WeakSet,Uh=function(){try{n(this,D,H).call(this,"debug","Preparing HTML structure for Spreedly iframe fields");let e=document.querySelector('[os-checkout-field="cc-number"]'),i=document.querySelector('[os-checkout-field="cvv"]');if(!e||!i){n(this,D,H).call(this,"error","Could not find credit card fields");return}e.id="spreedly-number",i.id="spreedly-cvv",e.setAttribute("data-spreedly","number"),i.setAttribute("data-spreedly","cvv"),n(this,D,H).call(this,"debug","HTML structure prepared for Spreedly iframe fields - using existing DOM elements")}catch(e){n(this,D,H).call(this,"error","Error preparing HTML structure for Spreedly iframe fields",e)}},xo=new WeakSet,Oh=function(){Spreedly.on("errors",e=>{n(this,D,H).call(this,"error","Spreedly validation errors:",e);let i=e.map(s=>s.message);t(this,Ce)&&t(this,Ce).call(this,i),n(this,lr,Dd).call(this,e)}),Spreedly.on("paymentMethod",(e,i)=>{n(this,D,H).call(this,"debug","Spreedly payment method created:",e),this.clearAllErrors(),t(this,Ji)&&t(this,Ji).call(this,e,i)}),Spreedly.on("validation",e=>{n(this,D,H).call(this,"debug","Spreedly field validation:",e),n(this,Zi,fo).call(this,e.fieldType),t(this,Yi)&&t(this,Yi).call(this,e)})},lr=new WeakSet,Dd=function(e){e.forEach(i=>{let s=i.attribute,r=null;if(s==="number"||s==="card_number"?r=document.getElementById("spreedly-number"):s==="cvv"?r=document.getElementById("spreedly-cvv"):s==="month"||s==="year"?r=document.querySelector(`[os-checkout-field="cc-${s}"]`)||document.querySelector(`[os-checkout-field="exp-${s}"]`)||document.querySelector(`#credit_card_exp_${s}`):(s==="full_name"||s==="first_name"||s==="last_name")&&(r=document.querySelector('[os-checkout-field="cc-name"]')),r){r.classList.add("error");let o=r.closest(".frm-flds")||r.parentElement,c=o.querySelector(".pb-input-error");c||(c=document.createElement("div"),c.className="pb-input-error",o.appendChild(c)),c.textContent=i.message,c.style.color="red",c.style.fontSize="0.875rem",c.style.marginTop="0.25rem"}})},Zi=new WeakSet,fo=function(e){let i=null;if(e==="number"||e==="card_number"?i=document.getElementById("spreedly-number"):e==="cvv"&&(i=document.getElementById("spreedly-cvv")),i){i.classList.remove("error");let r=(i.closest(".frm-flds")||i.parentElement).querySelector(".pb-input-error");r&&r.remove()}},D=new WeakSet,H=function(e,i,s){if(t(this,ar)||e==="error"){let r="[SpreedlyManager]";s?console[e](`${r} ${i}`,s):console[e](`${r} ${i}`)}};var Zt,Ye,mi,X,Xi,Qi,Eo,Rh,Ao,Dh,Ze=class{constructor({callback:e,logger:i}={}){a(this,Eo);a(this,Ao);a(this,Zt,["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"]);a(this,Ye,0);a(this,mi,void 0);a(this,X,void 0);a(this,Xi,void 0);a(this,Qi,void 0);h(this,Xi,i),h(this,Qi,e),n(this,Eo,Rh).call(this),n(this,Ao,Dh).call(this),t(this,Xi)&&t(this,Xi).debug("KonamiCodeHandler initialized")}static setTestMode(){return sessionStorage.setItem("konami_test_mode","true"),!0}static isTestMode(){return sessionStorage.getItem("konami_test_mode")==="true"}static clearTestMode(){sessionStorage.removeItem("konami_test_mode")}static getTestOrderData(e,i,s){try{let r=e?.cart?.items||[],o=i?i():1,c=r.length>0&&s?s(r):[{package_id:o||1,quantity:1}],d=e?.cart?.shippingMethod,u=parseInt(d?.ref_id,10)||1;return{user:{email:"test@test.com",first_name:"Test",last_name:"Order"},shipping_address:{first_name:"Test",last_name:"Order",line1:"Test Address 123",line2:"",line3:"",line4:"Tempe",state:"AZ",postcode:"85281",country:"US",phone_number:"+14807581224"},billing_address:{first_name:"Test",last_name:"Order",line1:"Test Address 123",line2:"",line3:"",line4:"Tempe",state:"AZ",postcode:"85281",country:"US",phone_number:"+14807581224"},shipping_method:u,attribution:e?.cart?.attribution||{},lines:c,success_url:window.location.origin+"/checkout/confirmation/"}}catch(r){return console.error("Error getting Konami test order data:",r),null}}static showActivationMessage(){let e=document.createElement("div");return e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.background="rgba(0, 0, 0, 0.8)",e.style.color="#fff",e.style.padding="20px",e.style.borderRadius="10px",e.style.zIndex="9999",e.style.textAlign="center",e.style.fontFamily="monospace",e.style.fontSize="18px",e.innerHTML=`
      <h3> KONAMI CODE ACTIVATED! </h3>
      <p>Creating test order with predefined data:</p>
      <p style="font-size: 14px; margin-top: 10px; text-align: left;">
        Email: test@test.com<br>
        Name: Test Order<br>
        Address: Test Address 123<br>
        City: Tempe, AZ 85281<br>
        Country: US<br>
        Phone: +14807581224<br>
        Card: 4111111111111111 (test mode)
      </p>
    `,document.body.appendChild(e),e}};Zt=new WeakMap,Ye=new WeakMap,mi=new WeakMap,X=new WeakMap,Xi=new WeakMap,Qi=new WeakMap,Eo=new WeakSet,Rh=function(){h(this,X,document.createElement("div")),t(this,X).style.position="fixed",t(this,X).style.bottom="10px",t(this,X).style.right="10px",t(this,X).style.background="rgba(0, 0, 0, 0.7)",t(this,X).style.color="#fff",t(this,X).style.padding="5px 10px",t(this,X).style.borderRadius="5px",t(this,X).style.fontFamily="monospace",t(this,X).style.fontSize="12px",t(this,X).style.zIndex="9999",t(this,X).style.display="none",t(this,X).textContent="Konami: 0/"+t(this,Zt).length,document.body.appendChild(t(this,X))},Ao=new WeakSet,Dh=function(){document.addEventListener("keydown",e=>{e.key===t(this,Zt)[t(this,Ye)]?(Ku(this,Ye)._++,t(this,Ye)>=4&&(t(this,X).style.display="block",t(this,X).textContent=`Konami: ${t(this,Ye)}/${t(this,Zt).length}`),t(this,Ye)===t(this,Zt).length&&(t(this,Qi)&&t(this,Qi).call(this),h(this,Ye,0),setTimeout(()=>{t(this,X).style.display="none"},500)),t(this,Ye)>=4&&(clearTimeout(t(this,mi)),h(this,mi,setTimeout(()=>{t(this,X).style.display="none"},3e3)))):t(this,Ye)>0&&(h(this,Ye,0),t(this,X).style.display==="block"&&(t(this,X).textContent=`Konami: 0/${t(this,Zt).length}`,clearTimeout(t(this,mi)),h(this,mi,setTimeout(()=>{t(this,X).style.display="none"},1500))))})};var Be,is,xe,te,yt,Pt,Xe,Lt,ss,Yd,Te,bt,To,zh,Po,Wh,yi,dr,Lo,Bh,Io,Vh,b,w,qo,Hh,Mo,jh,Fo,Gh,No,Kh,Uo,Jh,Oo,Yh,Ro,Zh,Do,Xh,ur,zd,hr,Wd,pr,Bd,nt,Tt,zo,Qh,Wo,ep,Bo,tp,Vo,ip,Ho,sp,gr,Vd,Xt,es,mr,Hd,fr,jd,yr,Gd,br,Kd,It,fi,jo,rp,Go,np,Ko,op,Jo,ap,Pe,We,Yo,cp,vr,Jd,Zo,lp,Xo,dp,Qo,up,ea,hp,ta,pp,Qt,ts,rs,ko,ia,gp,sa,mp,$o=class{constructor(e,i,s){a(this,To);a(this,Po);a(this,yi);a(this,Lo);a(this,Io);a(this,b);a(this,qo);a(this,Mo);a(this,Fo);a(this,No);a(this,Uo);a(this,Oo);a(this,Ro);a(this,Do);a(this,ur);a(this,hr);a(this,pr);a(this,nt);a(this,zo);a(this,Wo);a(this,Bo);a(this,Vo);a(this,Ho);a(this,gr);a(this,Xt);a(this,mr);a(this,fr);a(this,yr);a(this,br);a(this,It);a(this,jo);a(this,Go);a(this,Ko);a(this,Jo);a(this,Pe);a(this,Yo);a(this,vr);a(this,Zo);a(this,Xo);a(this,Qo);a(this,ea);a(this,ta);a(this,Qt);a(this,rs);a(this,ia);a(this,sa);a(this,Be,void 0);a(this,is,void 0);a(this,xe,void 0);a(this,te,void 0);a(this,yt,null);a(this,Pt,null);a(this,Xe,"credit-card");a(this,Lt,!1);a(this,ss,!1);a(this,Yd,{visa:"4111111111111111",mastercard:"5555555555554444",amex:"378282246310005",discover:"6011111111111117"});a(this,Te,{paypal:null,applePay:null,googlePay:null});a(this,bt,{applePay:!1,googlePay:!1});h(this,Be,e),h(this,is,i),h(this,xe,s),h(this,te,n(this,To,zh).call(this)),t(this,te)&&(n(this,Po,Wh).call(this),n(this,Io,Vh).call(this),h(this,Pt,new ji({debugMode:t(this,ss),logger:t(this,is)})),t(this,te).__formValidator=t(this,Pt),n(this,qo,Hh).call(this),n(this,Fo,Gh).call(this),n(this,Qo,up).call(this),n(this,ia,gp).call(this))}setKonamiTestMode(){return Ze.setTestMode(),n(this,b,w).call(this,"info"," Konami code test mode activated"),!0}processPayment(){let e=Ze.isTestMode();if(e&&(Ze.clearTestMode(),n(this,b,w).call(this,"info"," Processing payment in Konami test mode")),t(this,Lt)){n(this,b,w).call(this,"warn","Payment already processing");return}n(this,vr,Jd).call(this),n(this,hr,Wd).call(this),h(this,Lt,!0),n(this,b,w).call(this,"debug",`Processing payment with method: ${t(this,Xe)}`);try{if(e){n(this,pr,Bd).call(this);let s=Ze.getTestOrderData(t(this,xe)?.state?.getState(),n(this,gr,Vd).bind(this),n(this,br,Kd).bind(this));if(!s){n(this,nt,Tt).call(this);return}n(this,It,fi).call(this,{...s,payment_detail:{payment_method:"card_token",card_token:"test_card",test_card_number:"6011111111111117"}});return}if(!t(this,Pt).validateAllFields(t(this,Xe))){h(this,Lt,!1),n(this,nt,Tt).call(this);return}n(this,pr,Bd).call(this);let i=n(this,Xt,es).call(this);if(!i)return;if(n(this,ur,zd).call(this)){n(this,It,fi).call(this,{...i,payment_detail:{payment_method:"card_token",card_token:"test_card"}});return}switch(t(this,Xe)){case"credit-card":case"credit":n(this,zo,Qh).call(this);break;case"paypal":n(this,Ho,sp).call(this);break;default:n(this,Pe,We).call(this,`Unknown payment method: ${t(this,Xe)}`)}}catch(i){n(this,b,w).call(this,"error","Error processing payment:",i),n(this,Pe,We).call(this,"Unexpected error occurred"),n(this,nt,Tt).call(this)}}processExpressCheckout(e){n(this,b,w).call(this,"info",`Processing ${e} express checkout`);let i;switch(e){case"paypal":i=t(this,Te).paypal;break;case"apple_pay":i=t(this,Te).applePay;break;case"google_pay":i=t(this,Te).googlePay;break;default:n(this,b,w).call(this,"error",`Unknown express checkout method: ${e}`);return}n(this,Qt,ts).call(this,i,!0);try{let s=t(this,xe).state.getState("cart");if(!s||!s.items||s.items.length===0){n(this,b,w).call(this,"error",`Cannot process ${e} checkout: cart is empty`),n(this,rs,ko).call(this,"Your cart is empty. Please add items to your cart before checking out.",i);return}let r={lines:s.items.map(c=>({package_id:c.id,quantity:c.quantity||1,is_upsell:!!c.is_upsell})),payment_detail:{payment_method:e},attribution:t(this,xe).attribution?.getAttributionData()||s.attribution||{},shipping_method:n(this,yr,Gd).call(this,t(this,xe).state.getState())};if(t(this,Be)){let c=t(this,Be).getNextPageUrlFromMeta();c?(r.success_url=c,n(this,b,w).call(this,"debug",`Express checkout success URL set from meta tag: ${c}`)):n(this,b,w).call(this,"debug","No meta tag found for express checkout success_url, API will use order_status_url")}let o=new URL(window.location.href);o.searchParams.set("payment_failed","true"),o.searchParams.set("payment_method",e),r.payment_failed_url=o.href,n(this,b,w).call(this,"debug",`Express checkout payment_failed_url set to: ${r.payment_failed_url}`),s.vouchers&&s.vouchers.length>0?(r.vouchers=s.vouchers.map(c=>typeof c=="string"?c:c&&c.code?c.code:String(c)),n(this,b,w).call(this,"debug",`Using vouchers from cart for express checkout: ${JSON.stringify(r.vouchers)}`)):s.couponDetails&&s.couponCode?(r.vouchers=[s.couponCode],n(this,b,w).call(this,"debug",`Using coupon code for express checkout: ${s.couponCode}`)):s.couponCode&&(r.vouchers=[s.couponCode],n(this,b,w).call(this,"debug",`Using legacy coupon code for express checkout: ${s.couponCode}`)),n(this,b,w).call(this,"debug","Express checkout order data:",r),t(this,Be).createOrder(r).then(c=>{if(n(this,b,w).call(this,"debug",`${e} express checkout order created:`,c),c.payment_complete_url)t(this,xe).triggerEvent("express.checkout.started",{method:e,order:c}),window.location.href=c.payment_complete_url;else throw new Error("No payment URL returned from API")}).catch(c=>{n(this,b,w).call(this,"error",`${e} express checkout error:`,c),n(this,rs,ko).call(this,`There was an error processing your ${e.replace("_"," ")} payment. Please try again or use a different payment method.`,i)})}catch(s){n(this,b,w).call(this,"error",`Error in ${e} express checkout:`,s),n(this,rs,ko).call(this,"An unexpected error occurred. Please try again.",i)}}resetExpressButtons(){n(this,Qt,ts).call(this,t(this,Te).paypal,!1),n(this,Qt,ts).call(this,t(this,Te).applePay,!1),n(this,Qt,ts).call(this,t(this,Te).googlePay,!1)}};Be=new WeakMap,is=new WeakMap,xe=new WeakMap,te=new WeakMap,yt=new WeakMap,Pt=new WeakMap,Xe=new WeakMap,Lt=new WeakMap,ss=new WeakMap,Yd=new WeakMap,Te=new WeakMap,bt=new WeakMap,To=new WeakSet,zh=function(){let e=document.querySelector('form[os-checkout="form"]')||document.querySelector("form#combo_form");return e||n(this,b,w).call(this,"warn","No checkout form found"),e},Po=new WeakSet,Wh=function(){t(this,te).removeAttribute("action"),t(this,te).setAttribute("method","post");let e=document.createElement("input");e.type="hidden",e.name="prevent_serialization",e.value="true",t(this,te).appendChild(e),t(this,te).addEventListener("submit",n(this,yi,dr).bind(this),!0),t(this,te).onsubmit=n(this,yi,dr).bind(this),n(this,Lo,Bh).call(this)},yi=new WeakSet,dr=function(e){return e&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()),t(this,te).removeAttribute("action"),t(this,te).setAttribute("method","post"),window.stop?.(),n(this,b,w).call(this,"debug","Form submission prevented"),!1},Lo=new WeakSet,Bh=function(){try{t(this,te).querySelectorAll('button[type="submit"], input[type="submit"]').forEach((i,s)=>{i.setAttribute("type","button"),i.addEventListener("click",r=>{r.preventDefault(),n(this,b,w).call(this,"debug",`Submit button ${s+1} clicked`),this.processPayment()})})}catch(e){n(this,b,w).call(this,"error","Error converting submit buttons:",e)}},Io=new WeakSet,Vh=function(){let e=document.querySelector('[os-checkout-payment="combo"]');if(!e){n(this,b,w).call(this,"warn","Checkout button not found");return}let i=e.cloneNode(!0);e.parentNode.replaceChild(i,e),i.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation(),t(this,te).onsubmit=n(this,yi,dr).bind(this),t(this,te).removeAttribute("action"),t(this,te).setAttribute("method","post"),n(this,b,w).call(this,"debug","Checkout button clicked"),setTimeout(()=>this.processPayment(),0)})},b=new WeakSet,w=function(e,i,...s){try{(t(this,is)?.[e]||console[e]||console.log).call(console,`[${e.toUpperCase()}] ${i}`,...s)}catch(r){console.error("Error logging:",r)}},qo=new WeakSet,Hh=function(){try{let e=document.querySelector('[os-checkout-field="payment-method"]')||document.querySelector('input[name="combo_mode"]:checked');if(!e){n(this,b,w).call(this,"warn","Payment method selector not found");return}h(this,Xe,e.value||"credit-card"),n(this,Mo,jh).call(this)}catch(e){n(this,b,w).call(this,"error","Error initializing payment methods:",e)}},Mo=new WeakSet,jh=function(){let e=document.querySelectorAll('input[name="combo_mode"]'),i=s=>{h(this,Xe,s.target.value),n(this,b,w).call(this,"debug",`Payment method changed to: ${t(this,Xe)}`),document.dispatchEvent(new CustomEvent("payment-method-changed",{detail:{mode:t(this,Xe)}}))};e.length>0?e.forEach(s=>s.addEventListener("change",i)):document.querySelector('[os-checkout-field="payment-method"]')?.addEventListener("change",i)},Fo=new WeakSet,Gh=function(){try{let e=document.querySelector('meta[name="spreedly-environment-key"]')?.content||document.querySelector('meta[name="os-payment-env-key"]')?.content;if(!e){n(this,b,w).call(this,"warn","Spreedly environment key not found");return}h(this,yt,new yo(e,{debug:t(this,ss),app:t(this,xe)})),n(this,No,Kh).call(this),n(this,Oo,Yh).call(this)}catch(e){n(this,b,w).call(this,"error","Error initializing Spreedly:",e)}},No=new WeakSet,Kh=function(){t(this,yt).setOnReady(()=>n(this,b,w).call(this,"debug","Spreedly ready")),t(this,yt).setOnError(e=>{n(this,b,w).call(this,"error","Spreedly errors:",e),h(this,Lt,!1),n(this,nt,Tt).call(this);let i=n(this,Uo,Jh).call(this,e);n(this,Pe,We).call(this,i)}),t(this,yt).setOnPaymentMethod((e,i)=>{n(this,b,w).call(this,"debug","Spreedly payment method token received:",e),n(this,It,fi).call(this,{payment_token:e,payment_method:"credit-card",...n(this,Xt,es).call(this)})})},Uo=new WeakSet,Jh=function(e){if(!e||e.length===0)return"An unknown error occurred with your payment method";let i={"The card number is not a valid credit card number":"Please enter a valid credit card number","Credit card number entered is not valid":"Please enter a valid credit card number","The card number is too short":"The card number you entered is too short","The card number is too long":"The card number you entered is too long","The card security code is invalid":"Please enter a valid security code (CVV)","The card security code is too short":"The security code (CVV) is too short","The card security code is too long":"The security code (CVV) is too long","The card has expired":"This card has expired. Please use a different card","The card expiration month is invalid":"Please select a valid expiration month","The card expiration year is invalid":"Please select a valid expiration year"};for(let s of e)for(let[r,o]of Object.entries(i))if(s.includes(r))return o;return e[0]},Oo=new WeakSet,Yh=function(){try{let[e,i]=n(this,Ro,Zh).call(this);n(this,Do,Xh).call(this,e,i)}catch(e){n(this,b,w).call(this,"error","Error initializing expiration fields:",e)}},Ro=new WeakSet,Zh=function(){let e=['[os-checkout-field="cc-month"]','[os-checkout-field="exp-month"]',"#credit_card_exp_month"],i=['[os-checkout-field="cc-year"]','[os-checkout-field="exp-year"]',"#credit_card_exp_year"];return[e.map(s=>document.querySelector(s)).find(Boolean),i.map(s=>document.querySelector(s)).find(Boolean)]},Do=new WeakSet,Xh=function(e,i){if(e){e.innerHTML='<option value="">Month</option>';for(let s=1;s<=12;s++){let r=s.toString().padStart(2,"0");e.appendChild(new Option(r,r))}}if(i){i.innerHTML='<option value="">Year</option>';let s=new Date().getFullYear();for(let r=0;r<20;r++){let o=s+r;i.appendChild(new Option(o,o))}}},ur=new WeakSet,zd=function(){return new URLSearchParams(window.location.search).get("test")==="true"||Ze.isTestMode()},hr=new WeakSet,Wd=function(){t(this,te)?.removeAttribute("action"),t(this,te)?.setAttribute("method","post"),t(this,te).onsubmit=n(this,yi,dr).bind(this),t(this,te)?.querySelectorAll('button[type="submit"], input[type="submit"]').forEach(e=>{e.disabled=!0,e.setAttribute("type","button")})},pr=new WeakSet,Bd=function(){let e=document.querySelector('[os-checkout-payment="combo"]');e&&(e.disabled=!0,e.classList.add("is-submitting"))},nt=new WeakSet,Tt=function(){let e=document.querySelector('[os-checkout-payment="combo"]');e&&(e.disabled=!1,e.classList.remove("is-submitting")),h(this,Lt,!1)},zo=new WeakSet,Qh=function(){if(!t(this,yt)){n(this,Pe,We).call(this,"Credit card processing unavailable");return}let[e,i,s]=n(this,Wo,ep).call(this);if(n(this,Bo,tp).call(this)||n(this,ur,zd).call(this)){n(this,Vo,ip).call(this,e,i,s);return}if(!t(this,Pt).validateCreditCard()&&(n(this,b,w).call(this,"debug","Credit card validation failed on initial check"),!i||!s)){h(this,Lt,!1),n(this,nt,Tt).call(this);return}t(this,yt).tokenizeCard({full_name:e||"",month:i,year:s}),t(this,yt).setOnPaymentMethod((r,o)=>{n(this,It,fi).call(this,{payment_token:r,payment_method:"credit-card",...n(this,Xt,es).call(this)})})},Wo=new WeakSet,ep=function(){let e=!t(this,Pt).isSameAsShipping(),i=document.querySelector(`[os-checkout-field="${e?"billing-fname":"fname"}"]`)?.value||"",s=document.querySelector(`[os-checkout-field="${e?"billing-lname":"lname"}"]`)?.value||"",r=c=>c.charAt(0).toUpperCase()+c.slice(1).toLowerCase();return[`${r(i)} ${r(s)}`.trim(),document.querySelector('[os-checkout-field="cc-month"]')?.value||document.querySelector('[os-checkout-field="exp-month"]')?.value||document.querySelector("#credit_card_exp_month")?.value||"",document.querySelector('[os-checkout-field="cc-year"]')?.value||document.querySelector('[os-checkout-field="exp-year"]')?.value||document.querySelector("#credit_card_exp_year")?.value||""]},Bo=new WeakSet,tp=function(){let e=new URLSearchParams(window.location.search);return(t(this,ss)||e.get("debug")==="true")&&e.has("test-card")},Vo=new WeakSet,ip=function(e,i,s){let r=document.querySelector('[os-checkout-field="cc-number"]')?.value||document.querySelector("#credit_card_number")?.value;if(!r){n(this,Pe,We).call(this,"Please enter a credit card number");return}n(this,It,fi).call(this,{payment_token:`test_card_token_${Date.now()}`,payment_method:"credit-card",test_card_number:r,...n(this,Xt,es).call(this)})},Ho=new WeakSet,sp=function(){n(this,It,fi).call(this,{payment_method:"paypal",...n(this,Xt,es).call(this)})},gr=new WeakSet,Vd=function(){let e=new URLSearchParams(window.location.search),i=e.get("package_id")||e.get("pid");return i&&parseInt(i,10)||null},Xt=new WeakSet,es=function(){try{let e=n(this,mr,Hd).call(this,["fname","lname","address1","address2","city","province","postal","country","phone"]),i=t(this,Pt).isSameAsShipping()?null:n(this,mr,Hd).call(this,["billing-fname","billing-lname","billing-address1","billing-address2","billing-city","billing-province","billing-postal","billing-country","billing-phone"]),s=n(this,fr,jd).call(this,e),r=i?n(this,fr,jd).call(this,i):{...s};if(!t(this,xe)?.state)return n(this,Pe,We).call(this,"Cart data missing"),null;let o=t(this,xe).state.getState();if(!o.cart?.items?.length)return n(this,Pe,We).call(this,"Cart is empty"),null;let c={user:{email:o.user?.email||"",first_name:o.user?.firstName||s.first_name,last_name:o.user?.lastName||s.last_name},shipping_address:s,billing_address:r,shipping_method:n(this,yr,Gd).call(this,o),attribution:o.cart.attribution||{},lines:n(this,br,Kd).call(this,o.cart.items)};return o.cart.vouchers&&o.cart.vouchers.length>0?(c.vouchers=o.cart.vouchers.map(d=>typeof d=="string"?d:d&&d.code?d.code:String(d)),n(this,b,w).call(this,"debug",`Using vouchers from cart: ${JSON.stringify(c.vouchers)}`)):o.cart.couponDetails&&o.cart.couponCode?(c.vouchers=[o.cart.couponCode],n(this,b,w).call(this,"debug",`Using coupon code: ${o.cart.couponCode}`)):o.cart.couponCode&&(c.vouchers=[o.cart.couponCode],n(this,b,w).call(this,"debug",`Using legacy coupon code: ${o.cart.couponCode}`)),c}catch(e){return n(this,b,w).call(this,"error","Error getting order data:",e),n(this,Pe,We).call(this,"Error preparing order"),null}},mr=new WeakSet,Hd=function(e){let i={};return e.forEach(s=>{let r=document.querySelector(`[os-checkout-field="${s}"]`)?.value;r&&(i[s.replace("billing-","")]=r)}),i},fr=new WeakSet,jd=function(e){return{first_name:e.fname||"",last_name:e.lname||"",line1:e.address1||"",line2:e.address2||"",line3:"",line4:e.city||"",state:e.province||"",postcode:e.postal||"",country:e.country||"",phone_number:e.phone||""}},yr=new WeakSet,Gd=function(e){let s=e.cart?.shippingMethod?.ref_id;return parseInt(s,10)||1},br=new WeakSet,Kd=function(e){return e.map(i=>{let s=parseInt(i.id||i.external_id,10)||n(this,gr,Vd).call(this);if(!s)throw new Error(`Invalid package ID for item: ${i.name}`);let r={package_id:s,quantity:i.quantity||1};return i.is_upsell===!0&&(r.is_upsell=!0,n(this,b,w).call(this,"debug",`Adding line item with is_upsell=true: ${s}`)),r})},It=new WeakSet,fi=function(e){if(!e||!t(this,Be)){n(this,Pe,We).call(this,"Cannot create order"),n(this,nt,Tt).call(this);return}n(this,hr,Wd).call(this);let i=n(this,jo,rp).call(this,e);e.vouchers?n(this,b,w).call(this,"debug","Original vouchers in orderData:",e.vouchers):n(this,b,w).call(this,"warn","No vouchers found in original orderData"),i.vouchers?n(this,b,w).call(this,"debug","Formatted vouchers in formattedOrderData:",i.vouchers):n(this,b,w).call(this,"warn","No vouchers found in formattedOrderData - they may have been lost during formatting"),t(this,Be).createOrder(i).then(s=>n(this,Zo,lp).call(this,s)).catch(s=>n(this,Pe,We).call(this,n(this,Go,np).call(this,s))).finally(()=>n(this,nt,Tt).call(this))},jo=new WeakSet,rp=function(e){let i={...e};if(!i.success_url&&t(this,Be)){let s=t(this,Be).getNextPageUrlFromMeta(e.ref_id);s&&(i.success_url=s)}if(!i.payment_failed_url){let s=new URL(window.location.href);s.searchParams.set("payment_failed","true"),e.payment_method?s.searchParams.set("payment_method",e.payment_method):i.payment_detail?.payment_method&&s.searchParams.set("payment_method",i.payment_detail.payment_method),i.payment_failed_url=s.href,n(this,b,w).call(this,"debug",`Set payment_failed_url to: ${i.payment_failed_url}`)}if(e.payment_token&&(i.payment_detail=i.payment_detail||{},i.payment_detail.card_token=e.payment_token,delete i.payment_token),e.payment_method&&(i.payment_detail=i.payment_detail||{},i.payment_detail.payment_method={"credit-card":"card_token",credit:"card_token",paypal:"paypal"}[e.payment_method]||e.payment_method,delete i.payment_method),i.billing_address=i.billing_address||i.shipping_address,!i.vouchers&&e.vouchers&&(i.vouchers=[...e.vouchers],n(this,b,w).call(this,"debug","Restored vouchers from original order data",i.vouchers)),!i.vouchers&&t(this,xe)?.state){let s=t(this,xe).state.getState("cart");s.couponDetails&&s.couponCode?(i.vouchers=[s.couponCode],n(this,b,w).call(this,"debug","Added coupon code from cart state as fallback",i.vouchers)):s.couponCode&&(i.vouchers=[s.couponCode],n(this,b,w).call(this,"debug","Added coupon code from cart state as fallback",i.vouchers))}return i.vouchers&&Array.isArray(i.vouchers)&&(i.vouchers=i.vouchers.map(s=>typeof s=="string"?s:s&&s.code?s.code:String(s)),n(this,b,w).call(this,"debug","Ensured all vouchers are strings",i.vouchers)),i},Go=new WeakSet,np=function(e){try{let i=JSON.parse(e.message);if(i?.payment_details)return n(this,Jo,ap).call(this,i);if(typeof i?.voucher=="string")return i.voucher;if(i?.message)return typeof i.message=="string"?`Order creation failed: ${i.message}`:`Order creation failed: ${Array.isArray(i.message)?i.message.map(o=>typeof o=="object"?Object.entries(o).map(([c,d])=>`${c}: ${d}`).join(", "):String(o)).join("; "):typeof i.message=="object"?Object.entries(i.message).map(([o,c])=>`${o}: ${c}`).join(", "):String(i.message)}`;let s="";for(let r in i)Object.prototype.hasOwnProperty.call(i,r)&&r!=="ref_id"&&r!=="payment_details"&&r!=="message"&&typeof i[r]=="string"&&(s+=(s?"; ":"")+`${n(this,Ko,op).call(this,r)}: ${i[r]}`);if(s)return s}catch(i){return n(this,b,w).call(this,"warn",`Error parsing or formatting API error message: ${i.message}`,e.message),typeof e.message=="string"&&!e.message.startsWith("{")&&!e.message.startsWith("[")?e.message:"An error occurred while processing your request. Please check the details and try again."}return"Order creation failed. Please contact support if the issue persists."},Ko=new WeakSet,op=function(e){return e.replace(/_/g," ").replace(/\w\S*/g,i=>i.charAt(0).toUpperCase()+i.substr(1).toLowerCase())},Jo=new WeakSet,ap=function(e){let i=e.payment_response_code,s=e.payment_details;return{3005:"The card number you entered is invalid. Please check and try again.",3006:"The card expiration date is invalid. Please check and try again.",3007:"The card security code (CVV) is invalid. Please check and try again.",3008:"The card has been declined. Please try another payment method.",3009:"This card has expired. Please use a different card.",3010:"The card has insufficient funds. Please try another payment method."}[i]||s||"There was a problem processing your payment. Please try again."},Pe=new WeakSet,We=function(e){n(this,nt,Tt).call(this),n(this,vr,Jd).call(this),t(this,Xe)==="credit-card"&&(e.includes("card")||e.includes("Card")||e.includes("CVV"))&&n(this,Yo,cp).call(this,e);let s=document.querySelector('[os-checkout-element="spreedly-error"]');if(s){let r=s.querySelector('[data-os-message="error"]');r&&(r.textContent=e,s.style.display="flex")}else{let r=document.querySelector('[os-checkout-element="payment-error"]');r?(r.textContent=e,r.style.display="block",r.scrollIntoView({behavior:"smooth",block:"center"})):alert(`Payment Error: ${e}`)}},Yo=new WeakSet,cp=function(e){let i='[os-checkout-field="cc-number"]',s="#credit_card_number";e.toLowerCase().includes("cvv")||e.toLowerCase().includes("security code")?(i='[os-checkout-field="cc-cvv"]',s="#credit_card_cvv"):(e.toLowerCase().includes("expiration")||e.toLowerCase().includes("expired"))&&(i='[os-checkout-field="cc-month"], [os-checkout-field="cc-year"]',s="#credit_card_exp_month, #credit_card_exp_year");let r=i.split(",").map(d=>d.trim()),o=s.split(",").map(d=>d.trim());[...r,...o].forEach(d=>{let u=document.querySelector(d);if(!u)return;let p=u.closest(".form-group")||u.parentElement;if(!p)return;u.classList.add("is-invalid");let g=p.querySelector(".invalid-feedback");g||(g=document.createElement("div"),g.className="invalid-feedback",p.appendChild(g)),g.textContent=e,g.style.display="block"});let c=document.querySelector(r[0])||document.querySelector(o[0]);c&&(c.focus(),c.scrollIntoView({behavior:"smooth",block:"center"}))},vr=new WeakSet,Jd=function(){['[os-checkout-field="cc-number"]',"#credit_card_number",'[os-checkout-field="cc-cvv"]',"#credit_card_cvv",'[os-checkout-field="cc-month"]',"#credit_card_exp_month",'[os-checkout-field="cc-year"]',"#credit_card_exp_year"].forEach(s=>{let r=document.querySelector(s);if(!r)return;r.classList.remove("is-invalid");let o=r.closest(".form-group")||r.parentElement;if(o){let c=o.querySelector(".invalid-feedback");c&&(c.style.display="none")}});let i=document.querySelector('[os-checkout-element="payment-error"]');i&&(i.style.display="none")},Zo=new WeakSet,lp=function(e){if(sessionStorage.setItem("order_reference",e.ref_id),sessionStorage.setItem(`pending_purchase_event_${e.ref_id}`,"true"),t(this,xe)?.triggerEvent?.("order.created",e),e.payment_complete_url){n(this,b,w).call(this,"debug",`Redirecting to payment gateway: ${e.payment_complete_url}`),window.location.href=e.payment_complete_url;return}let i=n(this,Xo,dp).call(this,e);window.location.href=i},Xo=new WeakSet,dp=function(e){if(t(this,Be))return t(this,Be).getNextUrlFromOrderResponse(e);let i=document.querySelector('meta[name="os-next-page"]')?.content;if(i){let s=i.startsWith("http")?i:new URL(i,window.location.origin).href;return`${s}${s.includes("?")?"&":"?"}ref_id=${e.ref_id}`}return e.order_status_url?e.order_status_url:e.confirmation_url||`${window.location.origin}/checkout/confirmation/?ref_id=${e.ref_id}`},Qo=new WeakSet,up=function(){try{n(this,ea,hp).call(this);let e=document.querySelector('[os-checkout-payment="paypal"]');if(e&&(e.addEventListener("click",i=>{i.preventDefault(),this.processExpressCheckout("paypal")}),t(this,Te).paypal=e),t(this,bt).applePay){let i=document.querySelector('[os-checkout-payment="apple-pay"]');i&&(i.addEventListener("click",s=>{s.preventDefault(),this.processExpressCheckout("apple_pay")}),t(this,Te).applePay=i)}else{let i=document.querySelector('[os-checkout-payment="apple-pay"]');i&&(i.style.display="none")}if(t(this,bt).googlePay){let i=document.querySelector('[os-checkout-payment="google-pay"]');i&&(i.addEventListener("click",s=>{s.preventDefault(),this.processExpressCheckout("google_pay")}),t(this,Te).googlePay=i)}else{let i=document.querySelector('[os-checkout-payment="google-pay"]');i&&(i.style.display="none")}if(!n(this,ta,pp).call(this)){let i=document.querySelector('[os-checkout-container="express-checkout"]');i&&(i.style.display="none")}}catch(e){n(this,b,w).call(this,"error","Error initializing express checkout:",e)}},ea=new WeakSet,hp=function(){let e=window.innerWidth>=1024;window.ApplePaySession&&window.ApplePaySession.canMakePayments?(t(this,bt).applePay=!0,n(this,b,w).call(this,"debug","Apple Pay is supported on this device")):e?(t(this,bt).applePay=!0,n(this,b,w).call(this,"debug","Apple Pay enabled on desktop (QR code flow)")):(t(this,bt).applePay=!1,n(this,b,w).call(this,"debug","Apple Pay is not supported on this device"));let i=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),s=/Android/.test(navigator.userAgent),r=/Edg/.test(navigator.userAgent),o=/iPhone|iPad|iPod/.test(navigator.userAgent)||/Mac/.test(navigator.userAgent)&&"ontouchend"in document,c=/Mac/.test(navigator.userAgent)&&!("ontouchend"in document);i||s||r||o||c||e?(t(this,bt).googlePay=!0,n(this,b,w).call(this,"debug","Google Pay is supported on this device")):(t(this,bt).googlePay=!1,n(this,b,w).call(this,"debug","Google Pay is not supported on this device")),n(this,b,w).call(this,"debug",`User Agent: ${navigator.userAgent}`),n(this,b,w).call(this,"debug",`Vendor: ${navigator.vendor}`),n(this,b,w).call(this,"debug",`Screen width: ${window.innerWidth}px (Desktop: ${e})`)},ta=new WeakSet,pp=function(){return!!(t(this,Te).paypal||t(this,Te).applePay||t(this,Te).googlePay)},Qt=new WeakSet,ts=function(e,i){if(e)if(i){if(e.setAttribute("disabled","disabled"),e.classList.add("processing"),!e.dataset.originalHtml){e.dataset.originalHtml=e.innerHTML;let s=document.createElement("div");s.className="payment-btn-spinner",s.innerHTML='<div class="spinner"></div>',e.innerHTML="",e.appendChild(s)}}else e.removeAttribute("disabled"),e.classList.remove("processing"),e.dataset.originalHtml&&(e.innerHTML=e.dataset.originalHtml,delete e.dataset.originalHtml)},rs=new WeakSet,ko=function(e,i){n(this,Qt,ts).call(this,i,!1);let s=document.querySelector(".express-checkout-wrapper");if(!s)return;let r=s.querySelector(".express-checkout-error");r||(r=document.createElement("div"),r.className="express-checkout-error",s.appendChild(r)),r.textContent=e,r.style.display="block",setTimeout(()=>{r.style.display="none"},5e3),t(this,xe).triggerEvent("express.checkout.error",{message:e})},ia=new WeakSet,gp=function(){try{let e=new URLSearchParams(window.location.search);if(e.get("payment_failed")==="true"){let s=e.get("payment_method"),r="Your payment could not be processed. Please try again or use a different payment method.";s&&(r=`Your ${{paypal:"PayPal",apple_pay:"Apple Pay",google_pay:"Google Pay",card_token:"credit card","credit-card":"credit card",credit:"credit card"}[s]||s} payment could not be processed. Please try again or use a different payment method.`),["paypal","apple_pay","google_pay"].includes(s)?n(this,sa,mp).call(this,r,s):n(this,Pe,We).call(this,r);let c=new URL(window.location.href);c.searchParams.delete("payment_failed"),c.searchParams.delete("payment_method"),window.history.replaceState({},document.title,c.href)}}catch(e){n(this,b,w).call(this,"error","Error checking payment failed parameters:",e)}},sa=new WeakSet,mp=function(e,i){try{let s=document.querySelector('[os-checkout-element="top-error-banner"]');if(s){let r=s.querySelector("div");r?r.textContent=e:s.textContent=e,s.style.display="flex",s.scrollIntoView({behavior:"smooth",block:"center"})}else{s=document.createElement("div"),s.setAttribute("os-checkout-element","top-error-banner"),s.className="checkout-error-banner",s.style.width="100%",s.style.padding="12px 16px",s.style.backgroundColor="#fff3cd",s.style.color="#856404",s.style.borderRadius="4px",s.style.marginBottom="20px",s.style.border="1px solid #ffeeba",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="space-between";let r=document.createElement("div");r.textContent=e;let o=document.createElement("button");o.textContent="",o.style.background="none",o.style.border="none",o.style.fontSize="20px",o.style.fontWeight="bold",o.style.cursor="pointer",o.style.marginLeft="10px",o.addEventListener("click",()=>{s.style.display="none"}),s.appendChild(r),s.appendChild(o);let c=t(this,te);if(c)c.insertBefore(s,c.firstChild);else{let d=document.querySelector('[os-checkout-container="form"]')||document.querySelector(".checkout-form")||document.querySelector(".checkout-container");if(d)d.insertBefore(s,d.firstChild);else{let u=document.querySelector("main")||document.body;u.insertBefore(s,u.firstChild)}}s.scrollIntoView({behavior:"smooth",block:"center"})}n(this,b,w).call(this,"debug",`Displayed top banner error for ${i}: ${e}`)}catch(s){n(this,b,w).call(this,"error","Error displaying top banner error:",s),n(this,Pe,We).call(this,e)}};var na,ie,Ve,O,bi,ot,vi,qt,Mt,at,vt,oa,fp,se,le,aa,yp,wi,wr,_r,Zd,ca,bp,la,vp,da,wp,ua,Sp,ei,ns,Si,Sr,Xd,xf,ra=class{constructor(e){a(this,oa);a(this,se);a(this,aa);a(this,wi);a(this,_r);a(this,ca);a(this,la);a(this,da);a(this,ua);a(this,ei);a(this,Si);a(this,Xd);a(this,na,void 0);a(this,ie,void 0);a(this,Ve,void 0);a(this,O,void 0);a(this,bi,{});a(this,ot,{});a(this,vi,{fname:"billing-fname",lname:"billing-lname",address1:"billing-address1",address2:"billing-address2",city:"billing-city",province:"billing-province",postal:"billing-postal",country:"billing-country",phone:"billing-phone"});a(this,qt,!1);a(this,Mt,null);a(this,at,null);a(this,vt,null);h(this,na,e),e?.logger?typeof e.logger.debug=="function"&&typeof e.logger.info=="function"&&typeof e.logger.warn=="function"&&typeof e.logger.error=="function"?h(this,ie,e.logger):h(this,ie,e.logger.createModuleLogger?e.logger.createModuleLogger("BILLING"):console):h(this,ie,console),n(this,oa,fp).call(this)}copyShippingToBilling(){try{Object.entries(t(this,bi)).forEach(([e,i])=>{let s=t(this,vi)[e],r=t(this,ot)[s];r&&i&&(r.value=i.value,r.dispatchEvent(new Event("change",{bubbles:!0})))}),t(this,ot)["billing-address1"]&&t(this,ot)["billing-address1"].value&&t(this,ot)["billing-address1"].value.length>0&&n(this,ei,ns).call(this),n(this,se,le).call(this,"Copied shipping address to billing address")}catch(e){n(this,_r,Zd).call(this,"Error copying shipping to billing:",e)}}getBillingAddressData(){if(t(this,Ve)&&t(this,Ve).checked)return null;let e={};return Object.entries(t(this,ot)).forEach(([i,s])=>{let r=i.replace("billing-","");e[r]=s.value}),e}isSameAsShipping(){let e=t(this,Ve)?t(this,Ve).checked:!0;return n(this,se,le).call(this,`Billing address is ${e?"same as":"different from"} shipping`),e}};na=new WeakMap,ie=new WeakMap,Ve=new WeakMap,O=new WeakMap,bi=new WeakMap,ot=new WeakMap,vi=new WeakMap,qt=new WeakMap,Mt=new WeakMap,at=new WeakMap,vt=new WeakMap,oa=new WeakSet,fp=function(){try{if(h(this,Ve,document.querySelector('[os-checkout-field="same-as-shipping"]')||document.querySelector('[name="use_shipping_address"]')||document.querySelector("#use_shipping_address")),h(this,O,document.querySelector('[os-checkout-element="different-billing-address"]')),h(this,at,document.querySelector('[data-os-component="billing-location"]')),h(this,vt,document.querySelector('[os-checkout-field="billing-address1"]')),!t(this,Ve)){n(this,wi,wr).call(this,'Same as shipping checkbox not found. Tried multiple selectors including [name="use_shipping_address"] and #use_shipping_address');let e=document.querySelectorAll('input[type="checkbox"]');n(this,se,le).call(this,`Found ${e.length} checkboxes on the page:`),e.forEach((i,s)=>{n(this,se,le).call(this,`Checkbox ${s+1}: id=${i.id}, name=${i.name}, class=${i.className}`)});return}if(!t(this,O))if(n(this,wi,wr).call(this,'Billing form container not found with selector [os-checkout-element="different-billing-address"]'),h(this,O,document.querySelector(".billing_form-container")),t(this,O))n(this,aa,yp).call(this,"Found billing form container with alternative selector .billing_form-container");else return;n(this,se,le).call(this,"BillingAddressHandler initialized"),n(this,la,vp).call(this),h(this,Mt,t(this,Ve).checked),n(this,Si,Sr).call(this,t(this,Mt),!1),n(this,ca,bp).call(this),n(this,da,wp).call(this)}catch(e){n(this,_r,Zd).call(this,"Error initializing BillingAddressHandler:",e)}},se=new WeakSet,le=function(e,...i){typeof t(this,ie).debug=="function"?t(this,ie).debug(e,...i):typeof t(this,ie).log=="function"&&t(this,ie).log(e,...i)},aa=new WeakSet,yp=function(e,...i){typeof t(this,ie).info=="function"?t(this,ie).info(e,...i):typeof t(this,ie).log=="function"&&t(this,ie).log(e,...i)},wi=new WeakSet,wr=function(e,...i){typeof t(this,ie).warn=="function"?t(this,ie).warn(e,...i):typeof t(this,ie).log=="function"&&t(this,ie).log(`WARNING: ${e}`,...i)},_r=new WeakSet,Zd=function(e,i){typeof t(this,ie).error=="function"?t(this,ie).error(e,i):typeof t(this,ie).log=="function"?t(this,ie).log(`ERROR: ${e}`,i):console.error(e,i)},ca=new WeakSet,bp=function(){if(!t(this,at)){n(this,wi,wr).call(this,'Billing location component not found with selector [data-os-component="billing-location"]');return}if(!t(this,vt)){n(this,wi,wr).call(this,'Billing address1 field not found with selector [os-checkout-field="billing-address1"]');return}t(this,at).classList.add("cc-hidden"),n(this,se,le).call(this,"Billing location component initially hidden")},la=new WeakSet,vp=function(){Object.keys(t(this,vi)).forEach(e=>{let i=document.querySelector(`[os-checkout-field="${e}"]`);i&&(t(this,bi)[e]=i)}),Object.values(t(this,vi)).forEach(e=>{let i=document.querySelector(`[os-checkout-field="${e}"]`);i&&(t(this,ot)[e]=i)}),n(this,se,le).call(this,`Cached ${Object.keys(t(this,bi)).length} shipping fields and ${Object.keys(t(this,ot)).length} billing fields`)},da=new WeakSet,wp=function(){t(this,Ve).addEventListener("change",e=>{t(this,qt)||(h(this,Mt,e.target.checked),n(this,Si,Sr).call(this,e.target.checked,!0),e.target.checked&&this.copyShippingToBilling(),n(this,se,le).call(this,`Billing address changed: ${e.target.checked?"Same as shipping":"Different from shipping"}`))}),document.addEventListener("payment-method-changed",()=>{t(this,Mt)!==null&&!t(this,qt)&&(n(this,Si,Sr).call(this,t(this,Mt),!1),n(this,se,le).call(this,`Payment method changed, billing address state: ${t(this,Mt)?"Same as shipping":"Different from shipping"}`))}),document.addEventListener("location-fields-shown",()=>{t(this,at)&&(n(this,ei,ns).call(this),n(this,se,le).call(this,"Location fields shown by AddressAutocomplete, showing billing location component as well"))}),Object.entries(t(this,bi)).forEach(([e,i])=>{i.addEventListener("change",()=>{if(t(this,Ve).checked){let s=t(this,vi)[e],r=t(this,ot)[s];r&&(r.value=i.value,r.dispatchEvent(new Event("change",{bubbles:!0})))}})}),t(this,vt)&&t(this,at)&&(t(this,vt).addEventListener("input",()=>{t(this,vt).value.length>=3&&n(this,ei,ns).call(this)}),n(this,ua,Sp).call(this))},ua=new WeakSet,Sp=function(){new MutationObserver(i=>{i.forEach(s=>{s.type==="attributes"&&(s.attributeName==="value"||s.attributeName==="autocomplete-value")&&t(this,vt).value.length>0&&(n(this,ei,ns).call(this),n(this,se,le).call(this,"Autocomplete detected on billing address field"))})}).observe(t(this,vt),{attributes:!0,attributeFilter:["value","autocomplete-value"]}),document.addEventListener("google-places-autocomplete-filled",i=>{i.detail&&i.detail.field==="billing-address1"&&(n(this,ei,ns).call(this),n(this,se,le).call(this,"Google Places autocomplete detected on billing address field"))}),n(this,se,le).call(this,"Billing address autocomplete detection set up")},ei=new WeakSet,ns=function(){t(this,at)&&t(this,at).classList.contains("cc-hidden")&&(t(this,at).classList.remove("cc-hidden"),n(this,se,le).call(this,"Billing location component shown"))},Si=new WeakSet,Sr=function(e,i=!0){if(!t(this,O)||t(this,qt))return;h(this,qt,!0),t(this,O).style.transition||(t(this,O).style.transition="height 0.3s ease-out, opacity 0.3s ease-out");let s=r=>{r.propertyName==="height"&&(e||(t(this,O).style.height="auto"),t(this,O).style.overflow="",h(this,qt,!1),t(this,O).removeEventListener("transitionend",s),n(this,se,le).call(this,`Billing form transition completed: ${e?"collapsed":"expanded"}`))};i?(t(this,O).removeEventListener("transitionend",s),e?(t(this,O).style.height=`${t(this,O).scrollHeight}px`,t(this,O).style.overflow="hidden",requestAnimationFrame(()=>{t(this,O).style.height="0px",t(this,O).style.opacity="0",n(this,se,le).call(this,"Collapsing billing form")}),t(this,O).addEventListener("transitionend",s),t(this,O).addEventListener("transitionend",r=>{r.propertyName==="height"&&e&&(t(this,O).style.display="none",n(this,se,le).call(this,"Billing form hidden after collapse"))},{once:!0})):(t(this,O).style.display="flex",t(this,O).style.height="0px",t(this,O).style.overflow="hidden",requestAnimationFrame(()=>{let r=t(this,O).scrollHeight;t(this,O).style.height=`${r}px`,t(this,O).style.opacity="1",n(this,se,le).call(this,`Expanding billing form to height: ${r}px`)}),t(this,O).addEventListener("transitionend",s))):(t(this,O).style.display=e?"none":"flex",t(this,O).style.height=e?"0":"auto",t(this,O).style.opacity=e?"0":"1",t(this,O).style.overflow="",h(this,qt,!1),n(this,se,le).call(this,`Set billing form without animation: ${e?"hidden":"visible"}`))},Xd=new WeakSet,xf=function(){n(this,Si,Sr).call(this,t(this,Ve).checked,!1)};var wt,Ft,os,as,ti,pa,ga,_p,Cr,Qd,ha=class{constructor(e){a(this,ga);a(this,Cr);a(this,wt,void 0);a(this,Ft,void 0);a(this,os,void 0);a(this,as,void 0);a(this,ti,new Map);a(this,pa,null);h(this,wt,e),h(this,Ft,document.querySelector("[os-payment-mode]")),h(this,os,document.querySelectorAll('input[name="combo_mode"]')),h(this,as,document.querySelectorAll('[os-checkout-element$="-form"]')),t(this,Ft)&&t(this,os).length>0?(t(this,wt).debug("PaymentSelector initialized with elements found"),n(this,ga,_p).call(this)):t(this,wt).warn("PaymentSelector elements not found")}};wt=new WeakMap,Ft=new WeakMap,os=new WeakMap,as=new WeakMap,ti=new WeakMap,pa=new WeakMap,ga=new WeakSet,_p=function(){let e=document.querySelector('input[name="combo_mode"]:checked');e&&t(this,Ft)&&n(this,Cr,Qd).call(this,e.value,!1),t(this,os).forEach(i=>i.addEventListener("change",s=>n(this,Cr,Qd).call(this,s.target.value,!0))),t(this,wt).debug("PaymentSelector event listeners attached")},Cr=new WeakSet,Qd=function(e,i=!0){t(this,wt).debug(`Setting payment mode to: ${e}, animate: ${i}`),t(this,Ft)?.setAttribute("os-payment-mode",e),h(this,pa,e);let s=t(this,Ft)?.querySelector(".cc-header"),r=t(this,Ft)?.querySelector(".paypal-header");s?.classList.remove("os--active"),r?.classList.remove("os--active"),e==="credit"&&s?(s.classList.add("os--active"),t(this,wt).debug("Added os--active to .cc-header")):e==="paypal"&&r&&(r.classList.add("os--active"),t(this,wt).debug("Added os--active to .paypal-header")),t(this,as).forEach(o=>{o.style.transition="none",o.offsetHeight,o.style.transition=""}),t(this,as).forEach(o=>{let d=o.getAttribute("os-checkout-element")===`${e}-form`;if(t(this,ti).has(o)){let u=t(this,ti).get(o);o.removeEventListener("transitionend",u),t(this,ti).delete(o)}if(i){o.style.display="block",o.style.overflow="hidden";let u=o.scrollHeight;o.style.height=`${u}px`,o.offsetHeight;let p=g=>{g.propertyName==="height"&&(d?(o.style.height="auto",o.style.overflow=""):o.style.display="none",t(this,ti).delete(o))};t(this,ti).set(o,p),o.addEventListener("transitionend",p,{once:!0}),requestAnimationFrame(()=>{o.style.height=d?`${o.scrollHeight}px`:"0",o.style.opacity=d?"1":"0"})}else o.style.transition="none",Object.assign(o.style,{display:d?"block":"none",height:d?"auto":"0",opacity:d?"1":"0",overflow:""}),o.offsetHeight,o.style.transition=""}),document.dispatchEvent(new CustomEvent("payment-method-changed",{detail:{mode:e}}))};var de,cs,ct,Ci,ls,fa,Cp,ya,xp,Nt,_i,ba,Ep,Er,eu,va,Ap,wa,kp,Ar,tu,xi,xr,Sa,$p,ma=class{constructor(e,i={}){a(this,fa);a(this,ya);a(this,Nt);a(this,ba);a(this,Er);a(this,va);a(this,wa);a(this,Ar);a(this,xi);a(this,Sa);a(this,de,void 0);a(this,cs,!1);a(this,ct,void 0);a(this,Ci,void 0);a(this,ls,{});h(this,de,e),h(this,Ci,i.enableGoogleMapsAutocomplete!==!1),h(this,ct,{shipping:{address:document.querySelector('[os-checkout-field="address1"]'),city:document.querySelector('[os-checkout-field="city"]'),state:document.querySelector('[os-checkout-field="province"]'),zip:document.querySelector('[os-checkout-field="postal"]'),country:document.querySelector('[os-checkout-field="country"]')},billing:{address:document.querySelector('[os-checkout-field="billing-address1"]'),city:document.querySelector('[os-checkout-field="billing-city"]'),state:document.querySelector('[os-checkout-field="billing-province"]'),zip:document.querySelector('[os-checkout-field="billing-postal"]'),country:document.querySelector('[os-checkout-field="billing-country"]')},locations:document.querySelectorAll('[data-os-component="location"]')}),t(this,de).info(`AddressAutocomplete initialized (autocomplete ${t(this,Ci)?"enabled":"disabled"})`),n(this,ya,xp).call(this),n(this,fa,Cp).call(this)}};de=new WeakMap,cs=new WeakMap,ct=new WeakMap,Ci=new WeakMap,ls=new WeakMap,fa=new WeakSet,Cp=async function(){if(n(this,Sa,$p).call(this),!t(this,Ci))return t(this,de).debug("Google Maps autocomplete disabled, using basic field listeners"),n(this,xi,xr).call(this);await n(this,Er,eu).call(this)},ya=new WeakSet,xp=function(){t(this,cs)||(t(this,ct).locations.forEach(e=>e.classList.add("cc-hidden")),t(this,de).debug("Location fields hidden"))},Nt=new WeakSet,_i=function(){t(this,cs)||(t(this,ct).locations.forEach(e=>e.classList.remove("cc-hidden")),h(this,cs,!0),document.dispatchEvent(new CustomEvent("location-fields-shown")),t(this,de).debug("Location fields shown"))},ba=new WeakSet,Ep=function(){return!!window.google?.maps?.places},Er=new WeakSet,eu=async function(e=0){return t(this,Ci)?n(this,ba,Ep).call(this)?(t(this,de).debug("Google Maps API available"),n(this,va,Ap).call(this)):e>=3?(t(this,de).warn("Google Maps API unavailable after 3 attempts"),n(this,xi,xr).call(this)):(t(this,de).debug(`Retrying Google Maps check, attempt ${e+1}`),await new Promise(i=>setTimeout(i,1e3*1.5**e)),n(this,Er,eu).call(this,e+1)):n(this,xi,xr).call(this)},va=new WeakSet,Ap=function(){let{shipping:e,billing:i}=t(this,ct);[e,i].forEach(s=>{s.address&&(n(this,wa,kp).call(this,s.address,s),t(this,de).debug(`Autocomplete set up for ${s.address.getAttribute("os-checkout-field")}`))}),e.country&&e.country.addEventListener("change",()=>{let s=t(this,ls).address1;s&&e.country.value&&e.country.value.length===2&&s.setComponentRestrictions({country:e.country.value})}),i.country&&i.country.addEventListener("change",()=>{let s=t(this,ls)["billing-address1"];s&&i.country.value&&i.country.value.length===2&&s.setComponentRestrictions({country:i.country.value})})},wa=new WeakSet,kp=function(e,i){try{let s=i.country?.value||window.osConfig?.addressConfig?.defaultCountry||document.querySelector('meta[name="os-address-default-country"]')?.content||"US",r={types:["address"],fields:["address_components","formatted_address"]};r.componentRestrictions={country:s},t(this,de).debug(`Autocomplete for ${e.getAttribute("os-checkout-field")} restricted to: ${s}`);let o=new google.maps.places.Autocomplete(e,r),c=e.getAttribute("os-checkout-field");t(this,ls)[c]=o,o.addListener("place_changed",()=>{let d=o.getPlace();if(!d.address_components)return;n(this,Nt,_i).call(this);let u=Object.fromEntries(d.address_components.map(p=>[p.types[0],{long:p.long_name,short:p.short_name}]));if(i.address.value=[u.street_number?.long,u.route?.long].filter(Boolean).join(" "),i.city&&(i.city.value=u.locality?.long??""),i.zip&&(i.zip.value=u.postal_code?.long??""),i.country&&u.country){let p=u.country.short;i.country.value!==p&&(i.country.value=p,i.country.dispatchEvent(new Event("change",{bubbles:!0})),t(this,de).debug(`Country set to ${p}`)),i.state&&u.administrative_area_level_1&&n(this,Ar,tu).call(this,i.state,u.administrative_area_level_1.short)}[i.address,i.city,i.zip].forEach(p=>p?.dispatchEvent(new Event("change",{bubbles:!0})))}),e.addEventListener("blur",()=>e.value.length>10&&n(this,Nt,_i).call(this)),e.addEventListener("keydown",d=>d.key==="Enter"&&d.preventDefault())}catch(s){t(this,de).error("Autocomplete setup failed:",s),n(this,xi,xr).call(this)}},Ar=new WeakSet,tu=async function(e,i,s=0){if(s>=5){t(this,de).warn(`Failed to set state ${i} after 5 attempts`);return}await new Promise(o=>setTimeout(o,300*1.5**s)),Array.from(e.options).some(o=>o.value===i)?(e.value=i,e.dispatchEvent(new Event("change",{bubbles:!0})),t(this,de).debug(`State set to ${i}`)):n(this,Ar,tu).call(this,e,i,s+1)},xi=new WeakSet,xr=function(){[t(this,ct).shipping.address,t(this,ct).billing.address].forEach(e=>{e?.addEventListener("blur",()=>e.value.length>10&&n(this,Nt,_i).call(this))}),t(this,de).debug("Basic field listeners set up")},Sa=new WeakSet,$p=function(){let e=document.createElement("style");e.textContent=`
        @keyframes onAutoFillStart { from { opacity: 0.99; } to { opacity: 1; } }
        input:-webkit-autofill { animation-name: onAutoFillStart; }
      `,document.head.appendChild(e),[t(this,ct).shipping.address,t(this,ct).billing.address].filter(Boolean).forEach(s=>{s.addEventListener("input",()=>s.value.length>10&&n(this,Nt,_i).call(this)),s.addEventListener("change",()=>s.value.length>0&&n(this,Nt,_i).call(this)),s.addEventListener("animationstart",r=>{r.animationName==="onAutoFillStart"&&(t(this,de).debug(`Autofill detected on ${s.getAttribute("os-checkout-field")}`),n(this,Nt,_i).call(this))})}),t(this,de).debug("Autofill detection initialized")};var Ee,ds,Ca,Tp,kr,iu,xa,Pp,Ea,Lp,$r,su,Tr,ru,Aa,Ip,ka,qp,$a,Mp,_a=class{constructor(e){a(this,Ca);a(this,kr);a(this,xa);a(this,Ea);a(this,$r);a(this,Tr);a(this,Aa);a(this,ka);a(this,$a);a(this,Ee,void 0);a(this,ds,!!window.intlTelInput);h(this,Ee,e),t(this,ds)?(t(this,Ee).info("intlTelInput available, initializing phone inputs"),n(this,kr,iu).call(this)):(t(this,Ee).warn("intlTelInput not found, loading dynamically"),n(this,Ca,Tp).call(this).then(()=>n(this,kr,iu).call(this)))}};Ee=new WeakMap,ds=new WeakMap,Ca=new WeakSet,Tp=async function(){let e=[{tag:"link",rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css"},{tag:"script",src:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js",async:!0},{tag:"script",src:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",async:!0}];await Promise.all(e.map(({tag:i,...s})=>{let r=document.createElement(i);return Object.assign(r,s),document.head.appendChild(r),i==="link"?Promise.resolve():new Promise(o=>r.onload=o)})),h(this,ds,!0),t(this,Ee).debug("intlTelInput and utils loaded")},kr=new WeakSet,iu=function(){if(!t(this,ds))return;let e=document.querySelectorAll('input[type="tel"]');t(this,Ee).info(`Found ${e.length} phone inputs`),e.forEach((i,s)=>n(this,xa,Pp).call(this,i,s+1))},xa=new WeakSet,Pp=function(e,i){try{let s=window.intlTelInput(e,{utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",separateDialCode:!0,onlyCountries:["us","ca"],initialCountry:"us",allowDropdown:!1,dropdownContainer:document.body,useFullscreenPopup:!0,formatOnDisplay:!0,autoPlaceholder:"aggressive",customContainer:"iti-tel-input",autoFormat:!0,nationalMode:!0});e.iti=s,t(this,Ee).debug(`Phone input ${i} (${e.getAttribute("os-checkout-field")??"unknown"}) initialized`),n(this,Aa,Ip).call(this,e,s),n(this,$a,Mp).call(this,e,s),n(this,ka,qp).call(this,e,s),e.addEventListener("input",()=>{let r=e.value.trim();if(r){let p=s.getSelectedCountryData().iso2?.toUpperCase(),g=r.replace(/\D/g,""),m="";if(p==="CA"?g.length>0&&(g.length<=3?m=g:g.length<=6?m=`${g.slice(0,3)}-${g.slice(3)}`:m=`${g.slice(0,3)}-${g.slice(3,6)}-${g.slice(6,10)}`):g.length>0&&(g.length<=3?m=`(${g}`:g.length<=6?m=`(${g.slice(0,3)}) ${g.slice(3)}`:m=`(${g.slice(0,3)}) ${g.slice(3,6)}-${g.slice(6,10)}`),e.value!==m){let v=e.selectionStart,y=e.value.length;if(e.value=m,v!==null){let _=m.length-y;e.setSelectionRange(v+_,v+_)}}}let o=s.isValidNumber(),c=s.getNumberType(),d=s.getValidationError();if(!r){n(this,$r,su).call(this,e);return}console.group("Phone Number Validation"),s.getNumber(),n(this,Tr,ru).call(this,c),console.groupEnd(),t(this,Ee).debug("Phone validation:",{number:r,isValid:o,formattedNumber:s.getNumber(),type:n(this,Tr,ru).call(this,c),error:d})}),e.addEventListener("blur",()=>{let r=e.value.trim();if(r){let o=s.isValidNumber();if(o&&(e.value=s.getNumber(intlTelInputUtils.numberFormat.NATIONAL)),s.getNumber(),o)n(this,$r,su).call(this,e);else{let u=s.getSelectedCountryData().iso2?.toUpperCase()==="CA"?"Please enter a valid Canadian phone number (e.g. 416-555-5555)":"Please enter a valid US phone number (e.g. 555-555-5555)";n(this,Ea,Lp).call(this,e,u)}}})}catch(s){t(this,Ee).error(`Error initializing phone input ${i}:`,s)}},Ea=new WeakSet,Lp=function(e,i){e.classList.add("error");let s=e.closest(".iti");s&&(s.classList.add("error"),s.style.border="1px solid red");let r=e.closest(".frm-flds")||e.closest(".form-group"),o=r.querySelector(".pb-input-error");o||(o=document.createElement("div"),o.className="pb-input-error",r.appendChild(o)),o.textContent=i,Object.assign(o.style,{color:"red",fontSize:"0.875rem",marginTop:"0.25rem",display:"block",position:"relative",clear:"both"})},$r=new WeakSet,su=function(e){e.classList.remove("error");let i=e.closest(".iti");i&&(i.classList.remove("error"),i.style.border="");let r=(e.closest(".frm-flds")||e.closest(".form-group")).querySelector(".pb-input-error");r&&r.remove()},Tr=new WeakSet,ru=function(e){return{0:"FIXED_LINE",1:"MOBILE",2:"FIXED_LINE_OR_MOBILE",3:"TOLL_FREE",4:"PREMIUM_RATE",5:"SHARED_COST",6:"VOIP",7:"PERSONAL_NUMBER",8:"PAGER",9:"UAN",10:"UNKNOWN"}[e]||"UNKNOWN"},Aa=new WeakSet,Ip=function(e,i){let s=e.getAttribute("os-checkout-field");if(!s){t(this,Ee).warn("Phone input missing os-checkout-field attribute");return}let r=document.querySelector(s==="phone"?'[os-checkout-field="country"]':'[os-checkout-field="billing-country"]');if(!r){t(this,Ee).warn(`Country select not found for ${s}`);return}let o=r.value;o&&(o==="US"||o==="CA")&&(i.setCountry(o.toLowerCase()),t(this,Ee).debug(`Phone input country set to ${o}`))},ka=new WeakSet,qp=function(e,i){let s=e.getAttribute("os-checkout-field");if(!s)return;let r=document.querySelector(s==="phone"?'[os-checkout-field="country"]':'[os-checkout-field="billing-country"]');r&&r.addEventListener("change",()=>{let o=r.value;if(o&&(o==="US"||o==="CA")&&(i.setCountry(o.toLowerCase()),t(this,Ee).debug(`Phone input country changed to ${o}`),e.value)){let c=e.value.replace(/\D/g,"");e.value=c,e.dispatchEvent(new Event("input",{bubbles:!0}))}})},$a=new WeakSet,Mp=function(e,i){e.validatePhone=()=>e.value.trim()?i.isValidNumber():!e.hasAttribute("required"),e.getFormattedNumber=()=>i.getNumber(),e.closest("form")?.addEventListener("submit",()=>{e.value.trim()&&i.isValidNumber()&&(e.value=i.getNumber(),t(this,Ee).debug(`Formatted phone number set to ${e.value} on submit`))})};var re,I,Ia,us,St,_t,ii,qa,hs,ps,f,Ma,Fa,Fp,Na,Np,Ua,Up,gs,Ta,Oa,Op,Ra,Rp,Da,Dp,za,zp,Wa,Wp,Ba,Bp,Va,Vp,ou,Ef,au,Af,ms,Pa,Pr,nu,Ha,Hp,La=class{constructor(e){a(this,Fa);a(this,Na);a(this,Ua);a(this,gs);a(this,Oa);a(this,Ra);a(this,Da);a(this,za);a(this,Wa);a(this,Ba);a(this,Va);a(this,ou);a(this,au);a(this,ms);a(this,Pr);a(this,Ha);a(this,re,void 0);a(this,I,void 0);a(this,Ia,!1);a(this,us,!1);a(this,St,!1);a(this,_t,!1);a(this,ii,null);a(this,qa,3e3);a(this,hs,null);a(this,ps,{firstName:'[os-checkout-field="fname"]',lastName:'[os-checkout-field="lname"]',email:'[os-checkout-field="email"]',phone:'[os-checkout-field="phone"]',address1:'[os-checkout-field="address1"]',address2:'[os-checkout-field="address2"]',city:'[os-checkout-field="city"]',province:'[os-checkout-field="province"]',postal:'[os-checkout-field="postal"]',country:'[os-checkout-field="country"]'});a(this,f,{firstName:null,lastName:null,email:null,phone:null,address1:null,address2:null,city:null,province:null,postal:null,country:null});a(this,Ma,/^[^\s@]+@[^\s@]+\.[^\s@]+$/);h(this,re,e),t(this,re)&&t(this,re).logger?h(this,I,t(this,re).logger.createModuleLogger("PROSPECT")):h(this,I,{debug:(i,s)=>console.log(`[PROSPECT DEBUG] ${i}`,s!==void 0?s:""),info:(i,s)=>console.info(`[PROSPECT INFO] ${i}`,s!==void 0?s:""),warn:(i,s)=>console.warn(`[PROSPECT WARN] ${i}`,s!==void 0?s:""),error:(i,s)=>console.error(`[PROSPECT ERROR] ${i}`,s!==void 0?s:"")}),n(this,Fa,Fp).call(this)}triggerBeginCheckout(){return t(this,re)&&t(this,re).events?t(this,_t)?(t(this,I).debug("beginCheckout event already fired, skipping"),!1):(t(this,I).info("Manually triggering beginCheckout event"),t(this,re).events.beginCheckout(),h(this,_t,!0),!0):(t(this,I).warn("Cannot trigger beginCheckout event: Events manager not available"),!1)}resetBeginCheckoutFlag(){return h(this,_t,!1),t(this,I).debug("Reset beginCheckout flag"),!0}};re=new WeakMap,I=new WeakMap,Ia=new WeakMap,us=new WeakMap,St=new WeakMap,_t=new WeakMap,ii=new WeakMap,qa=new WeakMap,hs=new WeakMap,ps=new WeakMap,f=new WeakMap,Ma=new WeakMap,Fa=new WeakSet,Fp=function(){t(this,I).info("Initializing ProspectCartHandler"),n(this,Na,Np).call(this),t(this,f).email&&(t(this,f).firstName||t(this,f).lastName)?(n(this,Ua,Up).call(this),h(this,Ia,!0),t(this,I).info("ProspectCartHandler initialized successfully")):t(this,I).warn("Required form fields not found, ProspectCartHandler not initialized")},Na=new WeakSet,Np=function(){Object.keys(t(this,ps)).forEach(e=>{if(t(this,f)[e]=document.querySelector(t(this,ps)[e]),!t(this,f)[e]){let i=t(this,ps)[e].replace("os-checkout-field","data-os-field");t(this,f)[e]=document.querySelector(i)}t(this,f)[e]?t(this,I).debug(`Found ${e} field`):t(this,I).debug(`${e} field not found`)})},Ua=new WeakSet,Up=function(){t(this,f).email&&t(this,f).email.addEventListener("blur",()=>n(this,gs,Ta).call(this)),t(this,f).firstName&&t(this,f).firstName.addEventListener("blur",()=>n(this,gs,Ta).call(this)),t(this,f).lastName&&t(this,f).lastName.addEventListener("blur",()=>n(this,gs,Ta).call(this));let e=document.querySelector('form[os-checkout="form"]');e&&e.addEventListener("submit",()=>{h(this,St,!0),t(this,ii)&&clearTimeout(t(this,ii))}),t(this,I).debug("Event listeners attached to form fields")},gs=new WeakSet,Ta=function(){t(this,us)||t(this,St)||(t(this,ii)&&clearTimeout(t(this,ii)),n(this,Oa,Op).call(this),h(this,ii,setTimeout(()=>{n(this,Ra,Rp).call(this)},t(this,qa))))},Oa=new WeakSet,Op=function(){if(t(this,_t))return;let e=t(this,f).email&&t(this,f).email.value&&t(this,f).email.value.trim().length>0,i=t(this,f).firstName&&t(this,f).firstName.value&&t(this,f).firstName.value.trim().length>0||t(this,f).lastName&&t(this,f).lastName.value&&t(this,f).lastName.value.trim().length>0;(e||i)&&(t(this,I).debug("User has started entering checkout information, firing beginCheckout event"),t(this,re).events&&(t(this,re).events.beginCheckout(),h(this,_t,!0),t(this,I).info("beginCheckout event fired")))},Ra=new WeakSet,Rp=function(){if(t(this,us)||t(this,St)){t(this,I).debug("Cart already created or attempted, skipping");return}if(!n(this,Da,Dp).call(this)){t(this,I).debug("Not enough information to create a cart");return}let e=n(this,za,zp).call(this);if(t(this,hs)&&n(this,Wa,Wp).call(this,e,t(this,hs))){t(this,I).debug("Form data has not changed since last attempt, skipping");return}h(this,hs,e),h(this,St,!0),n(this,Ba,Bp).call(this)},Da=new WeakSet,Dp=function(){if(!(t(this,f).email&&t(this,f).email.value&&t(this,Ma).test(t(this,f).email.value)))return t(this,I).debug("Email is missing or invalid"),!1;let i=t(this,f).firstName&&t(this,f).firstName.value&&t(this,f).firstName.value.trim().length>=2,s=t(this,f).lastName&&t(this,f).lastName.value&&t(this,f).lastName.value.trim().length>=2;return!i&&!s?(t(this,I).debug("First name and last name are missing or too short"),!1):(t(this,I).debug("Minimum required fields are present"),!0)},za=new WeakSet,zp=function(){let e={};return Object.keys(t(this,f)).forEach(i=>{t(this,f)[i]&&(e[i]=t(this,f)[i].value)}),e},Wa=new WeakSet,Wp=function(e,i){return e.email===i.email&&e.firstName===i.firstName&&e.lastName===i.lastName},Ba=new WeakSet,Bp=function(){t(this,I).info("Creating prospect cart");let e=t(this,re).state.getState("cart");if(!e||!e.items||e.items.length===0){t(this,I).warn("No cart items available, skipping cart creation"),h(this,St,!1);return}let i=e.attribution||{};t(this,I).debug("Using attribution data from state",i);let s=t(this,f).firstName?t(this,f).firstName.value:"",r=t(this,f).lastName?t(this,f).lastName.value:"",o=t(this,f).email?t(this,f).email.value:"",c=n(this,Pr,nu).call(this);n(this,Va,Vp).call(this,o,s,r,c);let d={lines:e.items.map(u=>{let p={package_id:u.id,quantity:u.quantity||1};return u.is_upsell===!0&&(p.is_upsell=!0,t(this,I).debug(`Adding upsell item to prospect cart: ${u.id}`)),p}),user:{first_name:s,last_name:r,email:o},attribution:i};c?d.user.phone_number=c:t(this,I).warn("Invalid phone number format - sending cart without phone number"),e.shippingMethod&&(d.shipping_method=e.shippingMethod.ref_id||(e.shippingMethod.id?parseInt(e.shippingMethod.id,10):1)),t(this,I).debug("Omitting address data for prospect cart creation"),n(this,Ha,Hp).call(this,d)},Va=new WeakSet,Vp=function(e,i,s,r){if(!t(this,re).state){t(this,I).warn("State manager not available, cannot update user state");return}try{let o=t(this,re).state.getState("user")||{},c={...o,email:e||o.email,firstName:i||o.firstName,lastName:s||o.lastName,phone:r||o.phone};t(this,re).state.setState("user",c),t(this,I).debug("Updated user state with user information",c)}catch(o){t(this,I).error("Error updating user state:",o)}},ou=new WeakSet,Ef=function(e){return e.country==="US"&&(!e.postcode||!n(this,ms,Pa).call(this,e.postcode,"US"))?(t(this,I).warn("US address requires a valid postal code"),!1):!0},au=new WeakSet,Af=function(){let e=t(this,f).country&&t(this,f).country.value?t(this,f).country.value:"",i=t(this,f).postal&&t(this,f).postal.value?t(this,f).postal.value:"";if(e==="US"&&i&&!n(this,ms,Pa).call(this,i,e))return t(this,I).warn(`Invalid postal code for US: ${i} - omitting all address data`),null;let s={};t(this,f).firstName&&t(this,f).firstName.value&&(s.first_name=t(this,f).firstName.value),t(this,f).lastName&&t(this,f).lastName.value&&(s.last_name=t(this,f).lastName.value);let r=n(this,Pr,nu).call(this);return r&&(s.phone_number=r),t(this,f).address1&&t(this,f).address1.value&&(s.line1=t(this,f).address1.value),t(this,f).address2&&t(this,f).address2.value&&(s.line2=t(this,f).address2.value),t(this,f).city&&t(this,f).city.value&&(s.line4=t(this,f).city.value),t(this,f).province&&t(this,f).province.value&&(s.state=t(this,f).province.value),e&&(s.country=e),i&&(!e||n(this,ms,Pa).call(this,i,e))&&(s.postcode=i),s},ms=new WeakSet,Pa=function(e,i){if(!e||!i)return!0;switch(i.toUpperCase()){case"US":return/^\d{5}(-\d{4})?$/.test(e);case"CA":return/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/.test(e);case"GB":case"UK":return/^[A-Z]{1,2}[0-9][A-Z0-9]? ?[0-9][A-Z]{2}$/i.test(e);case"AU":return/^\d{4}$/.test(e);case"NZ":return/^\d{4}$/.test(e);case"DE":return/^\d{5}$/.test(e);case"FR":return/^\d{5}$/.test(e);default:return e.trim().length>0}},Pr=new WeakSet,nu=function(){if(!t(this,f).phone)return"";if(t(this,f).phone.iti&&typeof t(this,f).phone.iti.getNumber=="function"){let s=t(this,f).phone.iti.getNumber();return t(this,f).phone.iti.isValidNumber()?s:""}let e=t(this,f).phone.value;return e&&/^\+?[1-9]\d{1,14}$/.test(e.replace(/\D/g,""))?e:""},Ha=new WeakSet,Hp=function(e){if(!t(this,re).api||typeof t(this,re).api.createCart!="function"){t(this,I).error("API client not available"),h(this,St,!1);return}t(this,I).debug("Sending cart data to API",e),t(this,re).api.createCart(e).then(i=>{t(this,I).info("Prospect cart created successfully",i),h(this,us,!0),t(this,re).events&&(t(this,re).events.trigger("prospect.cartCreated",{cart:i}),t(this,_t)?t(this,I).debug("beginCheckout event already fired, skipping"):(t(this,I).info("Triggering beginCheckout event for analytics"),t(this,re).events.beginCheckout(),h(this,_t,!0)))}).catch(i=>{t(this,I).error("Error creating prospect cart",i),h(this,St,!1)})};var Ei,He,fs,si,Ka,jp,Ja,Gp,Ya,Kp,ys,ja,Ga=class{constructor(e){a(this,Ka);a(this,Ja);a(this,Ya);a(this,ys);a(this,Ei,void 0);a(this,He,void 0);a(this,fs,void 0);a(this,si,void 0);if(h(this,Ei,e),h(this,He,e.logger.createModuleLogger("SHIPPING_SELECTOR")),h(this,fs,document.querySelector('[os-component="shipping-mode"]')),!t(this,fs)){t(this,He).warn('Shipping selector container [os-component="shipping-mode"] not found.');return}h(this,si,n(this,Ka,jp).call(this)),t(this,si).length>0?(t(this,He).debug(`Found ${t(this,si).length} shipping methods.`),n(this,Ja,Gp).call(this)):t(this,He).warn("No shipping methods found within the container.")}};Ei=new WeakMap,He=new WeakMap,fs=new WeakMap,si=new WeakMap,Ka=new WeakSet,jp=function(){let e=[];return t(this,fs).querySelectorAll(".shipping-method").forEach(i=>{let s=i.querySelector('input[name="shipping_method"][type="radio"]');s?e.push({element:i,input:s,id:s.value}):t(this,He).warn("Shipping method element found without a radio input.",i)}),e},Ja=new WeakSet,Gp=function(){t(this,si).forEach(e=>{e.input.addEventListener("change",()=>n(this,Ya,Kp).call(this,e.id))}),n(this,ys,ja).call(this),t(this,Ei).state.subscribe("cart.shippingMethod",()=>n(this,ys,ja).call(this)),t(this,He).debug("ShippingSelector initialized and event listeners attached.")},Ya=new WeakSet,Kp=function(e){t(this,He).info(`Shipping method selected via UI: ${e}`);try{t(this,Ei).cart.setShippingMethod(e)}catch(i){t(this,He).error(`Failed to set shipping method ${e}:`,i),n(this,ys,ja).call(this)}},ys=new WeakSet,ja=function(){let i=t(this,Ei).state.getState("cart.shippingMethod")?.ref_id?.toString();t(this,He).debug(`Syncing UI with cart state. Current shipping ID: ${i}`),t(this,si).forEach(s=>{let r=s.id===i;s.element.classList.toggle("os--active",r),s.input.checked!==r&&(s.input.checked=r),t(this,He).debug(`Method ID ${s.id}: selected=${r}, input.checked=${s.input.checked}`)})};var Lr,S,z,Ae,Xa,Qa,Jp,ec,Yp,tc,Zp,ic,Xp,sc,Qp,rc,eg,nc,tg,oc,ig,ac,sg,cc,rg,lc,ng,dc,og,uc,ag,hc,cg,pc,lg,gc,dg,Za=class{constructor(e,i,s){a(this,Qa);a(this,ec);a(this,tc);a(this,ic);a(this,sc);a(this,rc);a(this,nc);a(this,oc);a(this,ac);a(this,cc);a(this,lc);a(this,dc);a(this,uc);a(this,hc);a(this,pc);a(this,gc);a(this,Lr,void 0);a(this,S,void 0);a(this,z,void 0);a(this,Ae,void 0);a(this,Xa,void 0);if(h(this,Lr,e),h(this,S,i),h(this,Ae,s),h(this,z,document.querySelector('form[os-checkout="form"]')||document.querySelector("form#combo_form")),!t(this,z)){t(this,S).warn('No checkout form found with [os-checkout="form"] selector or form#combo_form');return}t(this,z).removeAttribute("action"),t(this,z).setAttribute("method","post"),t(this,z).setAttribute("novalidate","novalidate");let r=document.createElement("input");r.type="hidden",r.name="js_enabled",r.value="true",t(this,z).appendChild(r);let o=document.createElement("input");o.type="hidden",o.name="prevent_serialization",o.value="true",t(this,z).appendChild(o);let c=d=>(d&&(d.preventDefault(),d.stopPropagation(),d.stopImmediatePropagation()),t(this,z).removeAttribute("action"),t(this,z).setAttribute("method","post"),typeof window.stop=="function"&&window.stop(),t(this,S).debug("Form direct submission prevented"),!1);t(this,z).addEventListener("submit",c,!0),t(this,z).onsubmit=c,n(this,gc,dg).call(this),t(this,S).debug("CheckoutPage initialized with form found"),n(this,Qa,Jp).call(this),n(this,ec,Yp).call(this)}};Lr=new WeakMap,S=new WeakMap,z=new WeakMap,Ae=new WeakMap,Xa=new WeakMap,Qa=new WeakSet,Jp=function(){try{n(this,uc,ag).call(this),n(this,ic,Xp).call(this),n(this,sc,Qp).call(this),n(this,rc,eg).call(this),n(this,nc,tg).call(this),n(this,oc,ig).call(this),n(this,ac,sg).call(this),n(this,cc,rg).call(this),n(this,lc,ng).call(this),n(this,dc,og).call(this),n(this,hc,cg).call(this),document.dispatchEvent(new CustomEvent("os:checkout.ready",{detail:{checkoutPage:this}})),t(this,S).info("Checkout page components initialized successfully")}catch(e){t(this,S).error("Error initializing checkout components",e)}},ec=new WeakSet,Yp=function(){try{h(this,Xa,new Ze({callback:()=>n(this,tc,Zp).call(this),logger:t(this,S)})),t(this,S).debug("Konami code handler initialized")}catch(e){t(this,S).error("Error initializing Konami code handler:",e)}},tc=new WeakSet,Zp=function(){try{t(this,S).info(" Konami code activated! Creating test order...");let e=Ze.showActivationMessage();setTimeout(()=>{document.body.removeChild(e),this.paymentHandler?(Ze.setTestMode(),this.paymentHandler.processPayment(),t(this,S).info("Konami code test order initiated")):(t(this,S).error("Payment handler not initialized, cannot create test order"),alert("Could not create test order: Payment handler not initialized"))},2e3)}catch(e){t(this,S).error("Error triggering Konami code Easter egg:",e)}},ic=new WeakSet,Xp=function(){try{this.addressHandler=new Rn(t(this,z),t(this,S))}catch(e){t(this,S).error("Error initializing AddressHandler",e)}},sc=new WeakSet,Qp=function(){try{this.billingAddressHandler=new ra(t(this,Ae)),t(this,z)&&this.billingAddressHandler&&(t(this,z).__billingAddressHandler=this.billingAddressHandler,t(this,S).debug("BillingAddressHandler initialized and attached to form"))}catch(e){t(this,S).error("Error initializing BillingAddressHandler",e)}},rc=new WeakSet,eg=function(){try{this.paymentSelector=new ha(t(this,S))}catch(e){t(this,S).error("Error initializing PaymentSelector",e)}},nc=new WeakSet,tg=function(){try{this.formValidator=new ji({debugMode:window.location.search.includes("debug=true"),logger:t(this,S)}),t(this,z)&&this.formValidator&&(t(this,z).__formValidator=this.formValidator,t(this,S).debug("FormValidator initialized and attached to form"))}catch(e){t(this,S).error("Error initializing FormValidator",e)}},oc=new WeakSet,ig=function(){try{this.paymentHandler=new $o(t(this,Lr),t(this,S),t(this,Ae))}catch(e){t(this,S).error("Error initializing PaymentHandler",e)}},ac=new WeakSet,sg=function(){try{this.shippingSelector=new Ga(t(this,Ae))}catch(e){t(this,S).error("Error initializing ShippingSelector",e)}},cc=new WeakSet,rg=function(){try{let e={enableGoogleMapsAutocomplete:t(this,Ae).options.enableGoogleMapsAutocomplete};this.addressAutocomplete=new ma(t(this,S),e)}catch(e){t(this,S).error("Error initializing AddressAutocomplete",e)}},lc=new WeakSet,ng=function(){try{this.phoneInputHandler=new _a(t(this,S))}catch(e){t(this,S).error("Error initializing PhoneInputHandler",e)}},dc=new WeakSet,og=function(){try{t(this,Ae)?(this.prospectCartHandler=new La(t(this,Ae)),t(this,S).info("ProspectCartHandler initialized")):t(this,S).warn("App instance not provided, ProspectCartHandler not initialized")}catch(e){t(this,S).error("Error initializing ProspectCartHandler",e)}},uc=new WeakSet,ag=function(){try{t(this,S).info("Fixing billing form by duplicating shipping form");let e=document.querySelector('[os-checkout-component="shipping-form"]'),i=document.querySelector('[os-checkout-component="billing-form"]');if(e&&i){t(this,S).info("Found shipping form and billing container");let s=e.cloneNode(!0),r={fname:"billing-fname",lname:"billing-lname",address1:"billing-address1",address2:"billing-address2",city:"billing-city",province:"billing-province",postal:"billing-postal",country:"billing-country",phone:"billing-phone"};s.querySelectorAll("input, select").forEach(c=>{let d=c.getAttribute("os-checkout-field");d&&r[d]&&(c.setAttribute("os-checkout-field",r[d]),c.id&&(c.id="billing_"+c.id),c.name&&(c.name="billing_"+c.name),c.getAttribute("data-name")&&c.setAttribute("data-name","Billing "+c.getAttribute("data-name")),c.getAttribute("autocomplete")&&c.setAttribute("autocomplete","billing "+c.getAttribute("autocomplete")))});let o=s.querySelector('[data-os-component="location"]');o&&o.setAttribute("data-os-component","billing-location"),i.innerHTML="",i.appendChild(s),t(this,S).info("Billing form successfully created from shipping form")}else{t(this,S).warn("Could not fix billing form - shipping form or billing container not found"),t(this,S).warn(`Shipping form found: ${!!e}, Billing container found: ${!!i}`);let s=document.querySelectorAll("[os-checkout-component]");t(this,S).warn(`Found ${s.length} checkout components:`),s.forEach(r=>{t(this,S).warn(`- ${r.getAttribute("os-checkout-component")}`)})}}catch(e){t(this,S).error("Error fixing billing form:",e)}},hc=new WeakSet,cg=function(){try{document.addEventListener("payment-method-changed",e=>{t(this,S).debug(`Payment method changed to: ${e.detail.mode}`),document.querySelector("[os-payment-mode]")?.setAttribute("os-payment-mode",e.detail.mode)}),t(this,z)&&(t(this,z).addEventListener("submit",e=>n(this,pc,lg).call(this,e)),t(this,S).debug("Form submit event listener attached")),t(this,Ae)&&t(this,Ae).events&&this.prospectCartHandler&&t(this,Ae).events.on("prospect.cartCreated",e=>{t(this,S).info("Prospect cart created successfully",e)}),t(this,Ae)&&t(this,Ae).events&&t(this,Ae).events.on("order.created",e=>{t(this,S).info("Order created successfully",e)})}catch(e){t(this,S).error("Error setting up event listeners:",e)}},pc=new WeakSet,lg=function(e){if(e&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()),t(this,S).debug("Form submission intercepted by #handleSubmit"),t(this,z)){t(this,z).removeAttribute("action"),t(this,z).setAttribute("method","post");let i=s=>(s&&(s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation()),t(this,z)&&(t(this,z).removeAttribute("action"),t(this,z).setAttribute("method","post")),typeof window.stop=="function"&&window.stop(),t(this,S).debug("Form direct submission prevented"),!1);t(this,z).onsubmit=i}return this.formValidator&&!this.formValidator.validateAllFields()?(t(this,S).warn("Form validation failed, stopping submission"),!1):(this.paymentHandler?(t(this,S).debug("Delegating to paymentHandler.processPayment()"),this.paymentHandler.processPayment()):t(this,S).error("Payment handler not initialized"),!1)},gc=new WeakSet,dg=function(){try{if(!t(this,z))return;let e=t(this,z).querySelectorAll('button[type="submit"], input[type="submit"]');e.length>0?(t(this,S).debug(`Found ${e.length} submit buttons, converting to type="button"`),e.forEach((i,s)=>{i.setAttribute("type","button"),i.addEventListener("click",r=>{r.preventDefault(),t(this,S).debug(`Submit button ${s+1} clicked, delegating to payment handler`),this.paymentHandler?this.paymentHandler.processPayment():t(this,S).error("Payment handler not initialized")}),t(this,S).debug(`Converted submit button ${s+1} to type="button"`)})):t(this,S).debug("No submit buttons found in the form")}catch(e){t(this,S).error("Error disabling submit buttons:",e)}};var ve,Ct,fc,mc=class{constructor(e){a(this,ve,void 0);a(this,Ct,void 0);a(this,fc,!1);h(this,ve,e),h(this,Ct,e.logger.createModuleLogger("CAMPAIGN"))}getCampaignData(){return t(this,ve).campaignData}getCampaignName(){return t(this,ve).campaignData?.name??""}getCampaignId(){return t(this,ve).campaignData?.id??""}getProducts(){return t(this,ve).campaignData?.products??[]}getProductById(e){return this.getProducts().find(i=>i.id===e)}getCurrency(){return t(this,ve).campaignData?.currency??"USD"}getLocale(){return t(this,ve).campaignData?.locale??"en-US"}formatPrice(e){if(typeof e!="number")return"";try{return new Intl.NumberFormat(this.getLocale(),{style:"currency",currency:this.getCurrency()}).format(e)}catch(i){return t(this,Ct).error("Error formatting price:",i),e.toString()}}triggerViewItemList(){if(!t(this,ve).campaignData){t(this,Ct).warn("Cannot trigger view_item_list: No campaign data available");return}if(!t(this,ve).eventManager){t(this,Ct).warn("Cannot trigger view_item_list: EventManager not found");return}typeof t(this,ve).eventManager.viewVisibleItemList=="function"?(t(this,Ct).debug("Manually triggering viewVisibleItemList event"),t(this,ve).eventManager.viewVisibleItemList()):t(this,ve).events?.viewItemList?(t(this,Ct).debug("Falling back to events.viewItemList method"),t(this,ve).events.viewItemList(t(this,ve).campaignData)):t(this,Ct).warn("No suitable method found to trigger view_item_list event"),h(this,fc,!0)}};ve=new WeakMap,Ct=new WeakMap,fc=new WeakMap;var je,A,W,ri,Ai,Ir,bc,ug,Mr,cu,ki,qr,Fr,lu,vc,hg,wc,pg,yc=class{constructor(e){a(this,Ai);a(this,bc);a(this,Mr);a(this,ki);a(this,Fr);a(this,vc);a(this,wc);a(this,je,void 0);a(this,A,void 0);a(this,W,void 0);a(this,ri,{});h(this,je,e),h(this,A,e.logger.createModuleLogger("STATE")),h(this,W,n(this,Ai,Ir).call(this)),n(this,bc,ug).call(this),t(this,A).info("StateManager initialized (core state loaded)")}finalizeInitializationAndRecalculate(){t(this,A).info("[StateManager] Finalizing initialization: performing initial cart calculations."),n(this,Fr,lu).call(this,!0,"cart.initialLoad")}getState(e=null){return e?e.split(".").reduce((i,s)=>i?.[s]??null,t(this,W)):t(this,W)}setState(e,i,s=!0){let r=t(this,W),o=e.split("."),c=t(this,W),d=o[0];for(let[p,g]of o.entries())p===o.length-1?(r[g]=i,d=g):(r[g]??(r[g]={}),c=r,r=r[g]);return e.startsWith("cart.items")||e==="cart.couponDetails"||e==="cart.couponCode"||e.startsWith("cart.shippingMethod")?n(this,Fr,lu).call(this,s,e):(n(this,Mr,cu).call(this),s&&n(this,ki,qr).call(this,e,i)),this}subscribe(e,i){var s;(s=t(this,ri))[e]??(s[e]=[]),t(this,ri)[e].push(i);try{i(this.getState(e),e)}catch(r){t(this,A).error(`Error in initial subscriber callback for ${e}:`,r)}return()=>t(this,ri)[e]=t(this,ri)[e].filter(r=>r!==i)}clearState(){h(this,W,n(this,Ai,Ir).call(this)),sessionStorage.removeItem("os_state"),n(this,ki,qr).call(this,"*",t(this,W)),t(this,A).info("State cleared")}addToCart(e){if(!e?.id)throw t(this,A).error("Invalid item for addToCart:",e),new Error("Invalid item. Must have id.");t(this,A).debugWithTime(`[StateManager] addToCart: Input item: ${JSON.stringify(e)}`);let i=t(this,je).campaignData?.packages?.find(u=>u.ref_id.toString()===e.id.toString());if(!i&&!e.match_by_ref_id_only&&(i=t(this,je).campaignData?.packages?.find(u=>u.external_id?.toString()===e.id.toString()),i&&t(this,A).debugWithTime(`[StateManager] No ref_id match found, falling back to external_id match for: ${e.id}`)),t(this,A).debugWithTime(`[StateManager] addToCart: Found packageData: ${JSON.stringify(i)}`),i&&(!e.name||e.price===void 0))e={...e,name:i.name,price:parseFloat(i.price)},t(this,A).debugWithTime(`[StateManager] Auto-populated item from packageData: ${JSON.stringify(e)}`);else if(!e.name||e.price===void 0)throw t(this,A).error("Invalid item for addToCart and no matching package found:",e),new Error("Invalid item. Must have id, name, and price, or a valid package id.");let s=i?.ref_id?.toString()||e.id.toString(),r=e.quantity||1,o;if(i)t(this,A).debugWithTime(`[StateManager] Using packageData for item ${e.id}. PackageData price: ${i.price}, price_total: ${i.price_total}, qty: ${i.qty}`),o={...e,id:e.id.toString(),package_id:s,name:i.name||e.name,quantity:r,price:Number.parseFloat(i.price),price_total:Number.parseFloat(i.price_total),retail_price:Number.parseFloat(i.price_retail)??void 0,retail_price_total:Number.parseFloat(i.price_retail_total)??void 0,is_recurring:i.is_recurring??!1,price_recurring:i.price_recurring?Number.parseFloat(i.price_recurring):void 0,price_recurring_total:i.price_recurring_total?Number.parseFloat(i.price_recurring_total):void 0,interval:i.interval??void 0,interval_count:i.interval_count??void 0,image:i.image||e.image,external_id:i.external_id??void 0,applied_coupon_discount_amount:parseFloat(e.applied_coupon_discount_amount||"0.00")},o.price_total==null&&o.price!=null&&(i.qty||1)>0&&(o.price_total=o.price*(i.qty||1),t(this,A).debugWithTime(`[StateManager] Calculated price_total for package item: ${o.price_total}`)),o.retail_price_total==null&&o.retail_price!=null&&(i.qty||1)>0&&(o.retail_price_total=o.retail_price*(i.qty||1),t(this,A).debugWithTime(`[StateManager] Calculated retail_price_total for package item: ${o.retail_price_total}`));else{t(this,A).debugWithTime(`[StateManager] No packageData found for item id ${e.id}. Using input item data directly.`);let u=Number.parseFloat(e.price),p=Number.parseFloat(e.retail_price)??void 0;o={...e,id:e.id.toString(),package_id:s,quantity:r,price:u,price_total:Number.parseFloat(e.price_total??(u*r).toFixed(2)),retail_price:p,retail_price_total:Number.parseFloat(e.retail_price_total??(p?(p*r).toFixed(2):void 0))??void 0,applied_coupon_discount_amount:parseFloat(e.applied_coupon_discount_amount||"0.00")}}t(this,A).debugWithTime(`[StateManager] addToCart: Final item data before adding to cart: ${JSON.stringify(o)}`);let c=t(this,W).cart.items.findIndex(u=>u.id===o.id&&u.package_id===o.package_id),d;return c>=0?(d=t(this,W).cart.items.map((u,p)=>{if(p===c){let g=(u.quantity||1)+r;return{...u,...o,quantity:g,price_total:o.price?o.price*(i?.qty||1)*g:0,retail_price_total:o.retail_price?o.retail_price*(i?.qty||1)*g:void 0,price_recurring_total:o.price_recurring?o.price_recurring*(i?.qty||1)*g:void 0}}return u}),t(this,A).debugWithTime(`[StateManager] Updated existing item: ${o.name}, new quantity: ${d[c].quantity}`)):(d=[...t(this,W).cart.items,o],t(this,A).debugWithTime(`[StateManager] Added new item: ${o.name}`)),this.setState("cart.items",d),t(this,A).info(`Item added/updated in cart: ${o.name}`),this.getState("cart")}updateCartItem(e,i){let s=this.getState("cart"),r=s.items.findIndex(c=>c.id===e);if(r===-1)throw t(this,A).error(`Item not found in cart: ${e}`),new Error(`Item not found in cart: ${e}`);let o=[...s.items];return o[r]={...o[r],...i},o[r].quantity===0&&o.splice(r,1),this.setState("cart.items",o),t(this,A).info(`Cart item updated: ${e}`),this.getState("cart")}removeFromCart(e){let i=this.getState("cart").items.filter(s=>s.id!==e);return this.setState("cart.items",i),t(this,A).info(`Item removed from cart: ${e}`),this.getState("cart")}clearCart(){return this.setState("cart.items",[]),this.setState("cart.couponCode",null),this.setState("cart.couponDetails",null),this.setState("cart.shippingMethod",null),t(this,A).info("Cart cleared"),this.getState("cart")}setShippingMethod(e){return this.setState("cart.shippingMethod",e),t(this,A).info(`Shipping method set: ${e.code}`),this.getState("cart")}applyCoupon(e,i="percentage",s=0,r=[]){return this.setState("cart.couponDetails",{code:e,type:i,value:parseFloat(s),applicable_product_ids:r}),this.setState("cart.couponCode",e),t(this,A).info(`Attempted to apply coupon: ${e}`),this.getState("cart")}removeCoupon(){return this.setState("cart.couponDetails",null),this.setState("cart.couponCode",null),t(this,A).info("Coupon removed"),this.getState("cart")}isItemInCart(e){return t(this,W).cart.items.some(i=>i.id===e)}getCartForApi(){let{items:e,shippingMethod:i,couponCode:s,couponDetails:r,attribution:o}=this.getState("cart"),{email:c,firstName:d,lastName:u,phone:p}=this.getState("user"),g=[];return s&&(r&&r.type&&r.value!==void 0?g.push({code:s,type:r.type,value:r.value}):g.push(s)),{lines:e.map(m=>({product_id:m.id,quantity:m.quantity||1,price:m.price})),shipping_method:i?.ref_id??null,coupon_code:s,vouchers:g,user:{email:c,first_name:d,last_name:u,phone:p},attribution:o||{}}}async syncCartWithApi(){try{this.setState("ui.loading",!0);let e=this.getCartForApi(),i=await t(this,je).api.createCart(e);return t(this,A).info("Cart synced with API"),t(this,je).triggerEvent("cart.synced",{cart:i}),i}catch(e){throw t(this,A).error("Error syncing cart with API:",e),this.setState("ui.errors.cart",e.message),e}finally{this.setState("ui.loading",!1)}}};je=new WeakMap,A=new WeakMap,W=new WeakMap,ri=new WeakMap,Ai=new WeakSet,Ir=function(){return{cart:{items:[],totals:{subtotal:0,retail_subtotal:0,savings:0,savings_percentage:0,shipping:0,tax:0,total:0,recurring_total:0,discount:0,coupon_savings:0,currency:"USD",currency_symbol:"$"},shippingMethod:null,couponCode:null,couponDetails:null,attribution:{utm_source:"",utm_medium:"",utm_campaign:"",utm_content:"",utm_term:"",gclid:"",fbclid:"",sub1:"",sub2:"",sub3:"",sub4:"",sub5:"",referrer:"",landing_page:"",user_agent:"",device_type:"",fbc:"",fbp:""}},user:{email:null,firstName:null,lastName:null,phone:null},ui:{loading:!1,currentStep:"cart",errors:{}}}},bc=new WeakSet,ug=function(){try{let e=sessionStorage.getItem("os_state");if(e){let i=JSON.parse(e);i.cart&&Array.isArray(i.cart.items)?i.cart.items=i.cart.items.map(s=>({...s,applied_coupon_discount_amount:parseFloat(s.applied_coupon_discount_amount||"0.00")})):i.cart&&(i.cart.items=[]),h(this,W,{...t(this,W),...i,ui:{...t(this,W).ui}}),t(this,A).info("State loaded from sessionStorage")}}catch(e){t(this,A).error("Error loading state from sessionStorage:",e)}},Mr=new WeakSet,cu=function(){try{let e={cart:t(this,W).cart,user:t(this,W).user};sessionStorage.setItem("os_state",JSON.stringify(e)),t(this,A).debug("State saved to sessionStorage")}catch(e){t(this,A).error("Error saving state to sessionStorage:",e)}},ki=new WeakSet,qr=function(e,i){t(this,A).debug(`Notifying subscribers for path: ${e}`);for(let[s,r]of Object.entries(t(this,ri)))if(s===e||s==="*"||e.startsWith(`${s}.`)){let o=s==="*"?this.getState():this.getState(s);r.forEach(c=>{try{c(o,s)}catch(d){t(this,A).error(`Error in subscriber callback for ${s}:`,d)}})}},Fr=new WeakSet,lu=function(e=!0,i="cart"){if(t(this,A).debug(`[StateManager] Processing cart updates triggered by: ${i}`),t(this,je).discount)n(this,vc,hg).call(this),n(this,wc,pg).call(this);else{t(this,A).warn("[StateManager] #processCartUpdates: DiscountManager (this.#app.discount) not available yet. Skipping discount calculations for now.");let{items:s,shippingMethod:r}=t(this,W).cart,c=(Array.isArray(s)?s:[]).reduce((p,g)=>p+(g.price_total??g.price*(g.quantity||1)),0),d=r?.price?Number.parseFloat(r.price):0,u=0;t(this,W).cart.totals={...n(this,Ai,Ir).call(this).cart.totals,subtotal:c,original_subtotal:c,total:c+d+u,shipping:d},t(this,A).debug("[StateManager] Basic cart totals recalculated without coupon logic.")}if(n(this,Mr,cu).call(this),e){if(i!=="cart"&&i!=="cart.initialLoad"){let s=i.split(".").reduce((r,o)=>r?.[o]??null,t(this,W));n(this,ki,qr).call(this,i,s)}n(this,ki,qr).call(this,"cart",this.getState("cart"))}},vc=new WeakSet,hg=function(){if(!t(this,je).discount){t(this,A).warn("[StateManager] #updateItemAppliedDiscounts: DiscountManager not available. Skipping."),t(this,W).cart.items=(t(this,W).cart.items||[]).map(s=>({...s,applied_coupon_discount_amount:s.applied_coupon_discount_amount||0}));return}let{items:e,couponDetails:i}=t(this,W).cart;if(!Array.isArray(e)){t(this,A).warn("[StateManager] #updateItemAppliedDiscounts: cart.items is not an array.");return}t(this,A).debugWithTime(`[SM.#updateItemAppliedDiscounts] Start. Coupon: ${i?.code}.`),t(this,W).cart.items=e.map(s=>{let r=0,o=s.price_total!=null?s.price_total:(s.price||0)*(s.quantity||1);if(i&&i.code){let c=!1;i.applicable_product_ids&&i.applicable_product_ids.length>0?(i.applicable_product_ids.includes(s.package_id?.toString())||i.applicable_product_ids.includes(s.id?.toString()))&&(c=!0):c=!0,c&&(i.type==="percentage"?r=o*(i.value/100):i.type==="fixed"&&(i.applicable_product_ids&&i.applicable_product_ids.length>0?r=Math.min(o,i.value):r=0))}return{...s,applied_coupon_discount_amount:parseFloat(r.toFixed(2))}}),t(this,A).debugWithTime("[StateManager] Updated per-item applied_coupon_discount_amount.")},wc=new WeakSet,pg=function(){if(!t(this,je).discount){t(this,A).warn("[StateManager] #recalculateCart: DiscountManager not available. Skipping full total recalc.");let P=(t(this,W).cart.items||[]).reduce((q,L)=>q+(L.price_total??L.price*(L.quantity||1)),0);t(this,W).cart.totals={...n(this,Ai,Ir).call(this).cart.totals,subtotal:P,original_subtotal:P,total:P};return}let{items:e,shippingMethod:i,couponDetails:s}=t(this,W).cart,r=Array.isArray(e)?e:[];t(this,A).debugWithTime(`[SM.#recalculateCart] Start. Coupon: ${s?.code}. Item count: ${r.length}`);let o=r.reduce((P,q)=>P+(q.price_total??q.price*(q.quantity||1)),0),c=0;s&&s.code?(c=t(this,je).discount.calculateDiscount(s,o,r),t(this,A).debugWithTime(`[SM.#recalculateCart] DiscountManager returned totalDiscountFromCoupon: ${c}`)):t(this,A).debugWithTime("[SM.#recalculateCart] No active coupon or discount manager for total discount calc.");let d=o-c,u=r.reduce((P,q)=>P+(q.retail_price_total??(q.retail_price??q.price)*(q.quantity||1)),0),p=u-d,g=u>0?p/u*100:0,m=r.reduce((P,q)=>P+(q.is_recurring&&q.price_recurring?q.price_recurring*(q.quantity||1):0),0),v=i?.price?Number.parseFloat(i.price):0;s&&s.type==="free_shipping"&&(v=0);let y=0,k=d+v+y,_=t(this,je).campaignData?.currency??"USD",T={USD:"$",EUR:"",GBP:""}[_]??"$";t(this,W).cart.totals={subtotal:d,original_subtotal:o,retail_subtotal:u,savings:p,savings_percentage:g,shipping:v,tax:y,total:k,recurring_total:m,discount:c,coupon_savings:c,currency:_,currency_symbol:T},t(this,A).debug("[StateManager] Cart totals recalculated.")};var Le,we,ge,Me,xc,gg,Nr,du,Ec,mg,bs,Sc,Ur,uu,vs,_c,Cc=class{constructor(e){a(this,xc);a(this,Nr);a(this,Ec);a(this,bs);a(this,Ur);a(this,vs);a(this,Le,void 0);a(this,we,void 0);a(this,ge,void 0);a(this,Me,void 0);h(this,Le,e),h(this,we,e.state),h(this,ge,e.logger.createModuleLogger("CART")),n(this,xc,gg).call(this),t(this,ge).info("CartManager initialized")}clearCart(){try{return t(this,we).clearCart()}catch(e){throw t(this,ge).error("Error clearing cart:",e),e}}addToCart(e){return n(this,bs,Sc).call(this,e)}addToCartByRefId(e,i=1){try{let s=t(this,Le).campaignData?.packages?.find(o=>o.ref_id.toString()===e.toString());if(!s)throw t(this,ge).error(`Package with ref_id ${e} not found in campaign data`),new Error(`Package with ref_id ${e} not found`);let r={id:s.ref_id.toString(),ref_id:s.ref_id.toString(),name:s.name,price:parseFloat(s.price),quantity:i,type:"package",match_by_ref_id_only:!0};return n(this,bs,Sc).call(this,r)}catch(s){throw t(this,ge).error(`Error adding item by ref_id ${e}:`,s),s}}removeFromCart(e){return n(this,vs,_c).call(this,e)}setShippingMethod(e){try{let i=t(this,Le).campaignData;if(!i||!Array.isArray(i.shipping_methods))throw t(this,ge).error("Campaign data or shipping methods not available."),new Error("Shipping methods not loaded.");let s=i.shipping_methods.find(r=>r.ref_id?.toString()===e?.toString());if(!s)throw t(this,ge).error(`Shipping method with ID ${e} not found.`),new Error(`Shipping method ID ${e} not found.`);return t(this,ge).info("Setting shipping method to:",s),t(this,we).setShippingMethod(s)}catch(i){throw t(this,ge).error("Error setting shipping method:",i),i}}applyCoupon(e,i="percentage",s=0,r=[]){try{let o=t(this,we).applyCoupon(e,i,s,r);return t(this,Le).selector&&typeof t(this,Le).selector.refreshUnitPricing=="function"&&setTimeout(()=>t(this,Le).selector.refreshUnitPricing(),10),o}catch(o){throw t(this,ge).error("Error applying coupon:",o),o}}removeCoupon(){try{let e=t(this,we).removeCoupon();return t(this,Le).selector&&typeof t(this,Le).selector.refreshUnitPricing=="function"&&setTimeout(()=>t(this,Le).selector.refreshUnitPricing(),10),e}catch(e){throw t(this,ge).error("Error removing coupon:",e),e}}getCouponDetails(){return t(this,we).getState("cart").couponDetails}async syncCartWithApi(){try{return await t(this,we).syncCartWithApi()}catch(e){throw t(this,ge).error("Error syncing cart with API:",e),e}}isItemInCart(e){return t(this,we).isItemInCart?.(e)??t(this,we).getState("cart").items.some(i=>i.id===e)}};Le=new WeakMap,we=new WeakMap,ge=new WeakMap,Me=new WeakMap,xc=new WeakSet,gg=function(){h(this,Me,{addToCartButtons:document.querySelectorAll("[data-os-add-to-cart]"),cartCount:document.querySelectorAll("[data-os-cart-count]"),cartTotal:document.querySelectorAll("[data-os-cart-total]"),cartItems:document.querySelector("[data-os-cart-items]"),cartEmpty:document.querySelector("[data-os-cart-empty]"),cartContainer:document.querySelector("[data-os-cart-container]")}),t(this,Me).addToCartButtons.forEach(e=>{e.addEventListener("click",i=>{i.preventDefault();let s={id:e.getAttribute("data-os-product-id"),name:e.getAttribute("data-os-product-name"),price:Number.parseFloat(e.getAttribute("data-os-product-price")),quantity:Number.parseInt(e.getAttribute("data-os-product-quantity")??"1",10)};s.id&&s.name&&s.price?n(this,bs,Sc).call(this,s):t(this,ge).error("Invalid product data for add to cart button")})}),t(this,we).subscribe("cart",()=>n(this,Nr,du).call(this)),n(this,Nr,du).call(this)},Nr=new WeakSet,du=function(){let e=t(this,we).getState("cart");t(this,Me).cartCount.forEach(c=>{let d=e.items.reduce((u,p)=>u+(p.quantity||1),0);c.textContent=d.toString(),c.classList.toggle("hidden",d===0)});let i=c=>t(this,Le).campaign?.formatPrice(c)??c.toFixed(2);t(this,Me).cartTotal.forEach(c=>c.textContent=i(e.totals.total));let s=(c,d,u=!1)=>{let p=document.querySelector(c);p&&(p.textContent=u?`${Math.round(d)}%`:i(d),u&&d===0?p.parentElement?.classList.add("hidden"):p.parentElement?.classList.remove("hidden"))};s("[data-os-cart-retail-subtotal]",e.totals.retail_subtotal),s("[data-os-cart-savings]",e.totals.savings,!0),s("[data-os-cart-savings-percentage]",e.totals.savings_percentage,!0),s("[data-os-cart-recurring-total]",e.totals.recurring_total,!0),s("[data-os-cart-subtotal]",e.totals.subtotal),s("[data-os-cart-shipping]",e.totals.shipping),s("[data-os-cart-original-subtotal]",e.totals.original_subtotal),s("[data-os-cart-discount]",e.totals.discount),s("[data-os-cart-coupon-savings]",e.totals.coupon_savings);let r=document.querySelector("[data-os-cart-coupon]"),o=document.querySelector("[data-os-cart-coupon-container]");if(r&&o&&(e.couponDetails&&e.couponCode?(r.textContent=t(this,Le).discount?.getCouponDisplayText(e.couponDetails)||e.couponCode,o.classList.remove("hidden")):o.classList.add("hidden")),t(this,Me).cartItems&&(t(this,Me).cartItems.innerHTML="",e.items.forEach(c=>t(this,Me).cartItems.appendChild(n(this,Ec,mg).call(this,c)))),t(this,Me).cartEmpty&&t(this,Me).cartContainer){let c=e.items.length===0;t(this,Me).cartEmpty.classList.toggle("hidden",!c),t(this,Me).cartContainer.classList.toggle("hidden",c)}},Ec=new WeakSet,mg=function(e){let i=m=>t(this,Le).campaign?.formatPrice(m)??m.toFixed(2),s=document.createElement("div");s.className="os-cart-item",s.setAttribute("data-os-cart-item-id",e.id);let r=i(e.price),o=e.retail_price?i(e.retail_price):"",c=i(e.price*(e.quantity||1)),d=e.retail_price?(e.retail_price-e.price)*(e.quantity||1):0,u=d?`
      <div class="os-cart-item-savings">
        <span class="os-cart-item-savings-label">You save:</span>
        <span class="os-cart-item-savings-value">${i(d)} (${Math.round(d/(e.retail_price*(e.quantity||1))*100)}%)</span>
      </div>
    `:"",p=e.is_recurring&&e.price_recurring?`
      <div class="os-cart-item-recurring">
        <span class="os-cart-item-recurring-label">Recurring:</span>
        <span class="os-cart-item-recurring-value">${i(e.price_recurring)} ${e.interval_count>1?`every ${e.interval_count} ${e.interval}s`:`per ${e.interval}`}</span>
      </div>
    `:"",g=e.image?`
      <div class="os-cart-item-image">
        <img src="${e.image}" alt="${e.name}" />
      </div>
    `:"";return s.innerHTML=`
      ${g}
      <div class="os-cart-item-details">
        <div class="os-cart-item-name">${e.name}</div>
        <div class="os-cart-item-price-container">
          <div class="os-cart-item-price">${r}</div>
          ${o?`<div class="os-cart-item-retail-price">${o}</div>`:""}
        </div>
        ${u}
        ${p}
      </div>
      <div class="os-cart-item-quantity">
        <button class="os-cart-item-decrease" data-os-cart-decrease="${e.id}">-</button>
        <span class="os-cart-item-quantity-value">${e.quantity||1}</span>
        <button class="os-cart-item-increase" data-os-cart-increase="${e.id}">+</button>
      </div>
      <div class="os-cart-item-total">${c}</div>
      <button class="os-cart-item-remove" data-os-cart-remove="${e.id}"></button>
    `,s.querySelector(`[data-os-cart-decrease="${e.id}"]`)?.addEventListener("click",()=>n(this,Ur,uu).call(this,e.id,(e.quantity||1)-1)),s.querySelector(`[data-os-cart-increase="${e.id}"]`)?.addEventListener("click",()=>n(this,Ur,uu).call(this,e.id,(e.quantity||1)+1)),s.querySelector(`[data-os-cart-remove="${e.id}"]`)?.addEventListener("click",()=>n(this,vs,_c).call(this,e.id)),s},bs=new WeakSet,Sc=function(e){try{return t(this,we).addToCart(e)}catch(i){throw t(this,ge).error("Error adding item to cart:",i),i}},Ur=new WeakSet,uu=function(e,i){try{return i<=0?n(this,vs,_c).call(this,e):t(this,we).updateCartItem(e,{quantity:i})}catch(s){throw t(this,ge).error("Error updating cart item quantity:",s),s}},vs=new WeakSet,_c=function(e){try{return t(this,we).removeFromCart(e)}catch(i){throw t(this,ge).error("Error removing item from cart:",i),i}};var ws,Ut,lt,Ss,Se=class{static initDebugMode(){let e=new URLSearchParams(window.location.search);return h(this,Ut,e.get("debugger")==="true"),t(this,Ut)&&!t(this,ws)&&(this.injectDebugStyles(),h(this,lt,localStorage.getItem("os_debug_xray_enabled")==="true")),t(this,Ut)}static isDebugMode(){return t(this,Ut)}static isXrayEnabled(){return t(this,lt)}static toggleXray(e=!t(this,lt)){return t(this,Ut)?(h(this,lt,e),localStorage.setItem("os_debug_xray_enabled",t(this,lt).toString()),t(this,Ss).forEach(i=>{i.style.display=t(this,lt)?"block":"none"}),t(this,lt)):!1}static injectDebugStyles(){if(t(this,ws))return;let e=document.createElement("style");e.id="os-debug-styles",e.textContent=`
      /* Common debug styles */
      .os-debug-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9999;
        border: 2px dashed rgba(255, 0, 0, 0.7);
        box-sizing: border-box;
      }
      .os-debug-label {
        position: absolute;
        top: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        font-size: 12px;
        padding: 2px 6px;
        border-radius: 0 0 0 4px;
        font-family: monospace;
        z-index: 10000;
      }
      
      /* Selector-specific styles */
      .os-debug-card-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9998;
        border: 1px solid rgba(0, 255, 255, 0.7);
        box-sizing: border-box;
      }
      .os-debug-card-label {
        position: absolute;
        top: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        font-size: 10px;
        padding: 1px 4px;
        border-radius: 0 0 0 4px;
        font-family: monospace;
        z-index: 9999;
      }
      .os--selected .os-debug-card-overlay {
        border: 2px solid rgba(0, 255, 0, 0.9);
      }
      .os--active .os-debug-card-overlay {
        background-color: rgba(255, 255, 0, 0.2);
      }
      
      /* Toggle-specific styles */
      .os-debug-toggle-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9998;
        border: 1px solid rgba(255, 165, 0, 0.7);
        box-sizing: border-box;
      }
      .os-debug-toggle-label {
        position: absolute;
        top: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        font-size: 10px;
        padding: 1px 4px;
        border-radius: 0 0 0 4px;
        font-family: monospace;
        z-index: 9999;
      }
      [data-os-active="true"] .os-debug-toggle-overlay {
        background-color: rgba(255, 165, 0, 0.3);
        border: 2px solid rgba(255, 165, 0, 0.9);
      }
      
      /* Upsell styles */
      .os-debug-upsell-overlay {
        border: 2px dashed rgba(76, 175, 80, 0.9) !important;
      }
      .os-debug-upsell-label {
        background-color: rgba(76, 175, 80, 0.9) !important;
      }
      .os-debug-upsell-badge {
        display: inline-block;
        background-color: rgba(76, 175, 80, 0.9);
        color: white;
        font-size: 9px;
        padding: 1px 3px;
        border-radius: 2px;
        margin-left: 4px;
        vertical-align: middle;
      }
      
      /* Debug bar styles */
      .os-debug-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: rgba(33, 33, 33, 0.9);
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        font-size: 14px;
        z-index: 10001;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 16px;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
      }
      
      .os-debug-bar-title {
        font-weight: 600;
        margin-right: 20px;
      }
      
      .os-debug-bar-controls {
        display: flex;
        align-items: center;
      }
      
      .os-debug-bar-control {
        margin: 0 10px;
        display: flex;
        align-items: center;
      }
      
      .os-debug-bar-toggle {
        position: relative;
        display: inline-block;
        width: 40px;
        height: 20px;
        margin-left: 8px;
      }
      
      .os-debug-bar-toggle input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      
      .os-debug-bar-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 20px;
      }
      
      .os-debug-bar-slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
      }
      
      input:checked + .os-debug-bar-slider {
        background-color: #2196F3;
      }
      
      input:checked + .os-debug-bar-slider:before {
        transform: translateX(20px);
      }
      
      .os-debug-bar-button {
        background-color: #2196F3;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 4px 10px;
        font-size: 12px;
        cursor: pointer;
        margin-left: 10px;
      }
      
      .os-debug-bar-button:hover {
        background-color: #0b7dda;
      }
    `,document.head.appendChild(e),h(this,ws,!0)}static addDebugOverlay(e,i,s,r={}){if(!t(this,Ut))return;window.getComputedStyle(e).position==="static"&&(e.style.position="relative");let c=document.createElement("div");c.className=`os-debug-${s}-overlay`;let d=document.createElement("div");d.className=`os-debug-${s}-label`,r.Upsell==="Yes"&&(c.classList.add("os-debug-upsell-overlay"),d.classList.add("os-debug-upsell-label"));let p=`ID: ${i}`;Object.entries(r).forEach(([g,m])=>{g==="Upsell"&&m==="Yes"?p+=` | ${g}: <span class="os-debug-upsell-badge">UPSELL</span>`:p+=` | ${g}: ${m}`}),d.innerHTML=p,t(this,lt)||(c.style.display="none",d.style.display="none"),e.appendChild(c),e.appendChild(d),t(this,Ss).push(c),t(this,Ss).push(d)}};ws=new WeakMap,Ut=new WeakMap,lt=new WeakMap,Ss=new WeakMap,a(Se,ws,!1),a(Se,Ut,!1),a(Se,lt,!1),a(Se,Ss,[]);var F,$,dt,ut,$i,$c,fg,Tc,yg,Pc,bg,Lc,vg,_s,Ac,Ic,wg,Or,hu,Rr,pu,Dr,gu,qc,Sg,Mc,_g,mu,kf,ht,Ot,kc=class{constructor(e){a(this,$c);a(this,Tc);a(this,Pc);a(this,Lc);a(this,_s);a(this,Ic);a(this,Or);a(this,Rr);a(this,Dr);a(this,qc);a(this,Mc);a(this,mu);a(this,ht);a(this,F,void 0);a(this,$,void 0);a(this,dt,{});a(this,ut,{});a(this,$i,!1);h(this,F,e),h(this,$,e.logger.createModuleLogger("SELECTOR")),h(this,$i,Se.initDebugMode()),n(this,$c,fg).call(this),t(this,$).info("SelectorManager initialized"),t(this,$i)&&t(this,$).info("Debug mode enabled for selectors")}initUnitPricing(){t(this,$).info("Initializing unit pricing for selectors"),setTimeout(()=>{Object.keys(t(this,dt)).forEach(e=>{n(this,qc,Sg).call(this,e)})},100)}refreshUnitPricing(){this.initUnitPricing()}triggerViewItemList(){let e=t(this,F).getCampaignData();if(!e||!e.packages||e.packages.length===0){t(this,$).warn("Cannot trigger view_item_list: No packages in campaign data");return}let i=new Set,s=[];if(Object.values(t(this,dt)).forEach(r=>{r.items.forEach(o=>{o.packageId&&i.add(o.packageId.toString())})}),t(this,$).debug(`Found ${i.size} unique package IDs in selectors`),e.packages.forEach(r=>{let o=r.ref_id?.toString(),c=r.external_id?.toString();(i.has(o)||i.has(c))&&s.push(r)}),s.length>0){t(this,$).info(`Triggering view_item_list for ${s.length} visible packages`);let r={...e,packages:s};t(this,F).eventManager?.viewItemList?(t(this,F).eventManager.viewItemList(r),t(this,$).debug("Used eventManager.viewItemList to fire event")):t(this,F).events?.viewItemList?(t(this,F).events.viewItemList(r),t(this,$).debug("Used events.viewItemList to fire event")):t(this,$).warn("No suitable method found to trigger view_item_list")}else t(this,$).warn("No matching packages found between selectors and campaign data")}};F=new WeakMap,$=new WeakMap,dt=new WeakMap,ut=new WeakMap,$i=new WeakMap,$c=new WeakSet,fg=function(){document.querySelectorAll('[data-os-component="selector"][data-os-selection-mode="swap"]').forEach(e=>n(this,Tc,yg).call(this,e)),setTimeout(()=>n(this,Dr,gu).call(this),0),t(this,F).state?.subscribe("cart",()=>n(this,Dr,gu).call(this)),this.initUnitPricing(),setTimeout(()=>this.triggerViewItemList(),100)},Tc=new WeakSet,yg=function(e){let i=e.getAttribute("data-os-id");if(!i){t(this,$).warn("Selector missing data-os-id",e);return}let s=e.getAttribute("data-os-selection-mode")||"swap";t(this,dt)[i]={element:e,items:[],mode:s},t(this,ut)[i]=null,e.querySelectorAll('[data-os-element="card"]').forEach(r=>n(this,Pc,bg).call(this,i,r)),t(this,$i)&&Se.addDebugOverlay(e,i,"overlay",{Mode:s})},Pc=new WeakSet,bg=function(e,i){let s=i.getAttribute("data-os-package");if(!s){t(this,$).warn("Card missing data-os-package",i);return}let r=i.getAttribute("data-os-shipping-id"),c=i.querySelector(".pb-quantity__price.pb--current")?.textContent.trim()??"$0.00 USD",d=Number.parseFloat(c.match(/\$(\d+\.\d+)/)?.[1]??"0"),p=i.querySelector(".card-title")?.textContent.trim()??`Package ${s}`,g=Number.parseInt(i.getAttribute("data-os-quantity")??"1",10),m=i.getAttribute("data-os-selected")==="true",v={element:i,packageId:s,quantity:g,price:d,name:p,isPreSelected:m,shippingId:r};t(this,dt)[e].items.push(v),i.addEventListener("click",()=>n(this,Lc,vg).call(this,e,v)),t(this,$i)&&Se.addDebugOverlay(i,s,"card",{Price:`$${d}`,Qty:g,PreSel:m?"Yes":"No",ShipID:r||"None"})},Lc=new WeakSet,vg=function(e,i){let s=t(this,ut)[e];if(n(this,_s,Ac).call(this,e,i),n(this,Ic,wg).call(this,e,s),i.shippingId!==null&&i.shippingId!==void 0){t(this,$).info(`Setting shipping method to ${i.shippingId} based on selected card ${i.packageId}`);try{t(this,F).cart.setShippingMethod(i.shippingId)}catch(r){t(this,$).error(`Failed to set shipping method ${i.shippingId}:`,r)}}},_s=new WeakSet,Ac=function(e,i){t(this,ut)[e]!==i&&(t(this,dt)[e].items.forEach(s=>{s.element.classList.remove("os--selected"),s.element.setAttribute("data-os-selected","false"),s.isSelected=!1}),i.element.classList.add("os--selected"),i.element.setAttribute("data-os-selected","true"),i.isSelected=!0,t(this,ut)[e]=i,t(this,$).debug(`Selected item ${i.packageId} in selector ${e}`))},Ic=new WeakSet,wg=function(e,i){if(!t(this,F).cart){t(this,$).error("Cart manager not available");return}let s=t(this,ut)[e];if(!s)return;i&&i.packageId!==s.packageId&&n(this,Rr,pu).call(this,i),t(this,F).cart.isItemInCart(s.packageId)||n(this,Or,hu).call(this,s);let r=t(this,ut)[e];if(r&&r.shippingId!==null&&r.shippingId!==void 0&&t(this,F).state?.getState("cart")?.shippingMethod?.ref_id?.toString()!==r.shippingId.toString()){t(this,$).info(`Syncing shipping method to ${r.shippingId} for selected item ${r.packageId}`);try{t(this,F).cart.setShippingMethod(r.shippingId)}catch(c){t(this,$).error(`Failed to sync shipping method ${r.shippingId}:`,c)}}},Or=new WeakSet,hu=function(e){if(!t(this,F).cart){t(this,$).error("Cart manager not available in addItemToCart");return}if(typeof t(this,F).cart.addToCart!="function"){t(this,$).error("addToCart is not a function on this.#app.cart:",t(this,F).cart);return}t(this,$).info(`Adding item ${e.packageId} to cart`),t(this,F).cart.addToCart({id:e.packageId,name:e.name,price:e.price,quantity:e.quantity,type:"package"}),e.element.classList.add("os--active"),e.element.setAttribute("data-os-active","true")},Rr=new WeakSet,pu=function(e){if(!t(this,F).cart){t(this,$).error("Cart manager not available in removeItemFromCart");return}if(typeof t(this,F).cart.removeFromCart!="function"){t(this,$).error("removeFromCart is not a function on this.#app.cart:",t(this,F).cart);return}t(this,$).info(`Removing item ${e.packageId} from cart`),t(this,F).cart.removeFromCart(e.packageId),e.element.classList.remove("os--active"),e.element.setAttribute("data-os-active","false")},Dr=new WeakSet,gu=function(){if(!t(this,F).cart){t(this,$).debug("Cart manager not available for sync");return}if(!t(this,F).state?.getState("cart")){t(this,$).debug("Cart state not available");return}t(this,$).debug("Syncing with cart, this.#app.cart:",t(this,F).cart),Object.keys(t(this,dt)).forEach(i=>{let s=t(this,dt)[i].items,r=s.filter(c=>t(this,F).cart.isItemInCart(c.packageId));if(r.length>0){let c=r[0];n(this,_s,Ac).call(this,i,c),r.forEach(d=>{d.packageId!==c.packageId&&n(this,Rr,pu).call(this,d)})}else if(!t(this,ut)[i]){let c=s.find(d=>d.isPreSelected);c&&(n(this,_s,Ac).call(this,i,c),n(this,Or,hu).call(this,c))}s.forEach(c=>{let d=t(this,F).cart.isItemInCart(c.packageId);c.element.classList.toggle("os--active",d),c.element.setAttribute("data-os-active",d.toString())});let o=t(this,ut)[i];if(o&&o.shippingId!==null&&o.shippingId!==void 0&&t(this,F).state?.getState("cart")?.shippingMethod?.ref_id?.toString()!==o.shippingId.toString()){t(this,$).info(`Syncing shipping method to ${o.shippingId} for selected item ${o.packageId}`);try{t(this,F).cart.setShippingMethod(o.shippingId)}catch(d){t(this,$).error(`Failed to sync shipping method ${o.shippingId}:`,d)}}})},qc=new WeakSet,Sg=function(e){let i=t(this,dt)[e];if(!i){t(this,$).warn(`Selector ${e} not found for unit pricing`);return}let s=t(this,F)?.campaignData;if(!s||!s.packages){t(this,$).warn("Campaign data not available for unit pricing");return}i.items.forEach(r=>{n(this,Mc,_g).call(this,r,s.packages)})},Mc=new WeakSet,_g=function(e,i){let s=i.find(L=>L.ref_id.toString()===e.packageId.toString()||L.external_id&&L.external_id.toString()===e.packageId.toString());if(!s){t(this,$).debug(`Package data not found for item ${e.packageId}`);return}let r=e.element;t(this,$).debug(`Processing unit pricing for package ${e.packageId}:`,{packageId:e.packageId,name:s.name,price:s.price,price_total:s.price_total,price_retail:s.price_retail,price_retail_total:s.price_retail_total,qty:s.qty});let o=s.qty||1,c=Number.parseFloat(s.price_total)||Number.parseFloat(s.price)*o,d=Number.parseFloat(s.price_retail_total)||Number.parseFloat(s.price_retail)*o||c,u=t(this,F).cart?.getCouponDetails?.(),p=c;if(u){if(t(this,$).debug("Active coupon found for unit pricing calculations:",u),u.type==="percentage"&&u.value>0){let L=u.value/100;p=c*(1-L),t(this,$).debug(`Applied ${u.value}% discount to package price: ${c} -> ${p}`)}else if(u.type==="fixed"&&u.value>0){let L=t(this,F).state?.getState("cart");if(L&&L.totals&&L.totals.original_subtotal>0){let j=L.totals.original_subtotal,G=c/j,ce=u.value*G;p=Math.max(0,c-ce),t(this,$).debug(`Applied proportional fixed discount (${ce.toFixed(2)}) to package price: ${c} -> ${p}`)}}}c=p;let g=c/o,m=d/o,v=m-g,y=m>0?v/m*100:0,k=d-c,_=d>0?k/d*100:0;t(this,$).debug(`Calculated prices for package ${e.packageId}:`,{totalUnits:o,totalPrice:c,totalRetailPrice:d,totalSavings:k,totalSavingsPercentage:_,unitPrice:g,unitRetailPrice:m,unitSavings:v,unitSavingsPercentage:y});let T=L=>t(this,F).campaign?.formatPrice?t(this,F).campaign.formatPrice(L):`$${L.toFixed(2)}`,P=new Set,q=r.querySelectorAll("[data-divide-by]");q.length>0&&(t(this,$).debug(`Found ${q.length} elements with data-divide-by in card ${e.packageId}`),q.forEach(L=>{let j=parseFloat(L.getAttribute("data-divide-by"));if(!isNaN(j)&&j>0){let G=L.getAttribute("data-card-price");if(!G){t(this,$).debug("Skipping element with data-divide-by but no data-card-price attribute");return}let ce;switch(G){case"each-sale":ce=g/j;break;case"each-regular":ce=m/j;break;case"saving-amount":ce=v/j;break;case"saving-percentage":ce=y;break;case"total-sale":ce=c/j;break;case"total-regular":ce=d/j;break;case"total-saving-amount":ce=k/j;break;case"total-saving-percentage":ce=_;break;default:t(this,$).debug(`Unknown price type: ${G}`);return}let Re;G.includes("percentage")?Re=`${Math.round(ce)}%`:Re=T(ce),t(this,$).debug(`Setting price for element with data-divide-by="${j}":`,{attributeType:G,originalValue:L.textContent,calculatedValue:ce,formattedValue:Re,element:L.outerHTML}),L.textContent=Re,P.add(L),t(this,$).debug(`Updated element with data-divide-by="${j}" for ${G}: ${Re}`)}})),n(this,ht,Ot).call(this,r,"each-sale",T(g),P),n(this,ht,Ot).call(this,r,"each-regular",T(m),P),n(this,ht,Ot).call(this,r,"saving-amount",T(v),P),n(this,ht,Ot).call(this,r,"saving-percentage",`${Math.round(y)}%`,P),n(this,ht,Ot).call(this,r,"total-sale",T(c),P),n(this,ht,Ot).call(this,r,"total-regular",T(d),P),n(this,ht,Ot).call(this,r,"total-saving-amount",T(k),P),n(this,ht,Ot).call(this,r,"total-saving-percentage",`${Math.round(_)}%`,P),t(this,$).debug(`Updated pricing for card ${e.packageId}: ${T(g)} per unit, ${T(c)} total`)},mu=new WeakSet,kf=function(e){return t(this,F).campaign?.formatPrice?t(this,F).campaign.formatPrice(e):`$${e.toFixed(2)}`},ht=new WeakSet,Ot=function(e,i,s,r=new Set){let o=e.querySelectorAll(`[data-card-price="${i}"]`);o.length>0&&o.forEach(c=>{if(r.has(c))return;c.textContent=s;let d=c.getAttribute("data-hide-if-zero")==="true",u=parseFloat(s.replace(/[^0-9.-]+/g,""));if(d&&u<=0){c.style.display="none";let p=c.closest('[data-container="true"]');p&&(p.style.display="none")}else{c.style.display="";let p=c.closest('[data-container="true"]');p&&(p.style.display="")}})};var Qe,Ge,Q,Cs,Nc,Cg,Uc,xg,Oc,Eg,Rc,Ag,zr,fu,Wr,yu,Dc,kg,Br,bu,zc,$g,Wc,Tg,Fc=class{constructor(e){a(this,Nc);a(this,Uc);a(this,Oc);a(this,Rc);a(this,zr);a(this,Wr);a(this,Dc);a(this,Br);a(this,zc);a(this,Wc);a(this,Qe,{});a(this,Ge,void 0);a(this,Q,void 0);a(this,Cs,!1);h(this,Ge,e),h(this,Q,e.logger.createModuleLogger("TOGGLE")),h(this,Cs,Se.initDebugMode()),n(this,Nc,Cg).call(this),t(this,Ge).state.subscribe("cart",()=>n(this,Wr,yu).call(this)),t(this,Q).info("ToggleManager initialized"),t(this,Cs)&&t(this,Q).info("Debug mode enabled for toggle items")}};Qe=new WeakMap,Ge=new WeakMap,Q=new WeakMap,Cs=new WeakMap,Nc=new WeakSet,Cg=function(){let e=document.querySelectorAll('[data-os-action="toggle-item"]');if(!e.length){t(this,Q).debug("No toggle item buttons found.");return}t(this,Q).info(`Found ${e.length} toggle item button elements.`),e.forEach(i=>n(this,Uc,xg).call(this,i)),n(this,Wr,yu).call(this)},Uc=new WeakSet,xg=function(e){let i=e.getAttribute("data-os-package");if(!i){t(this,Q).warn("Toggle element missing data-os-package attribute",e);return}let s=Number.parseInt(e.getAttribute("data-os-quantity")??"1",10);t(this,Qe)[i]?t(this,Qe)[i].quantity!==s&&t(this,Q).warn(`Toggle button for package ${i} has different quantity (${s}) than previously registered (${t(this,Qe)[i].quantity}). Using first quantity found.`):(t(this,Qe)[i]={packageId:i,quantity:s,elements:[]},t(this,Q).debug(`[INIT] Creating new toggle registration for packageId: ${i}`)),t(this,Qe)[i].elements.push(e),t(this,Q).debugWithTime(`[INIT] Registered element for packageId: ${i}. Total elements for this package: ${t(this,Qe)[i].elements.length}`),e.addEventListener("click",r=>{r.preventDefault(),n(this,Rc,Ag).call(this,i,e)}),t(this,Cs)&&n(this,Oc,Eg).call(this,e,i,s)},Oc=new WeakSet,Eg=function(e,i,s){let r=n(this,zr,fu).call(this,i),o=r?r.price:"N/A",c=e.hasAttribute("data-os-upsell")?e.getAttribute("data-os-upsell")==="true":e.closest("[data-os-upsell-section]")!==null;Se.addDebugOverlay(e,`toggle-${i}-${t(this,Qe)[i]?.elements.length||0}`,"toggle",{Package:i,Qty:s,Price:o,Upsell:c?"Yes":"No"})},Rc=new WeakSet,Ag=function(e,i){let s=t(this,Qe)[e];if(!s){t(this,Q).error(`Toggle package info for packageId ${e} not found`);return}let{quantity:r}=s,o=n(this,Br,bu).call(this,e);if(o)n(this,Wc,Tg).call(this,e),t(this,Q).info(`Toggled OFF item ${e}`);else{let c=n(this,zr,fu).call(this,e);if(!c){t(this,Q).error(`Package ${e} not found in campaign data`);return}let d=i.hasAttribute("data-os-upsell")?i.getAttribute("data-os-upsell")==="true":i.closest("[data-os-upsell-section]")!==null;n(this,zc,$g).call(this,{id:e,name:c.name,price:Number.parseFloat(c.price),quantity:r,type:"package",is_upsell:d}),t(this,Q).info(`Toggled ON item ${e}${d?" (upsell)":""}`)}t(this,Ge).triggerEvent("toggle.changed",{packageId:e,isActive:!o})},zr=new WeakSet,fu=function(e){return t(this,Ge).campaignData?.packages?t(this,Ge).campaignData.packages.find(i=>i.ref_id?.toString()===e?.toString()||i.id?.toString()===e?.toString())??null:(t(this,Q).error("Campaign data not available"),null)},Wr=new WeakSet,yu=function(){t(this,Q).debugWithTime("[UPDATE_ALL] Cart state changed. Updating ALL package toggle UIs."),Object.values(t(this,Qe)).forEach(e=>{n(this,Dc,kg).call(this,e)})},Dc=new WeakSet,kg=function(e){let{packageId:i,elements:s}=e;if(!s||s.length===0)return;let r=n(this,Br,bu).call(this,i);t(this,Q).debugWithTime(`[UPDATE_PKG_UI] Updating UI for package ${i}. IsInCart: ${r}. Element count: ${s.length}`),s.forEach(o=>{o.classList.toggle("os--active",r),o.setAttribute("data-os-active",r.toString());let c=o.closest("[data-os-toggle-wrapper]");c?(c.classList.toggle("os--active",r),t(this,Q).debugWithTime(`  > Toggled wrapper class for element of package ${i}`)):t(this,Q).debugWithTime(`  > No wrapper found via closest() for element of package ${i}`)})},Br=new WeakSet,bu=function(e){let s=(t(this,Ge).state.getState("cart")?.items||[]).some(r=>r.package_id?.toString()===e?.toString());return t(this,Q).debugWithTime(`[isItemInCart] Checking for packageId: "${e}". Found: ${s}`),s},zc=new WeakSet,$g=function(e){if(!t(this,Ge).cart){t(this,Q).error("Cart manager not available");return}t(this,Ge).cart.addToCart(e)},Wc=new WeakSet,Tg=function(e){if(!t(this,Ge).cart){t(this,Q).error("Cart manager not available");return}t(this,Ge).cart.removeFromCart(e)};var Ti,Fe,Rt,Dt,Pi,Vr,Gc,Pg,Kc,Lg,Hr,vu,xs,Bc,Es,Vc,jr,wu,Jc,Ig,As,Hc,jc=class{constructor(e){a(this,Gc);a(this,Kc);a(this,Hr);a(this,xs);a(this,Es);a(this,jr);a(this,Jc);a(this,As);a(this,Ti,void 0);a(this,Fe,void 0);a(this,Rt,!1);a(this,Dt,null);a(this,Pi,null);a(this,Vr,!1);h(this,Ti,e),h(this,Fe,e.logger.createModuleLogger("DEBUG")),h(this,Vr,Se.initDebugMode()),n(this,Gc,Pg).call(this),t(this,Fe).info("DebugManager initialized")}};Ti=new WeakMap,Fe=new WeakMap,Rt=new WeakMap,Dt=new WeakMap,Pi=new WeakMap,Vr=new WeakMap,Gc=new WeakSet,Pg=function(){window.showMiniCart=()=>n(this,xs,Bc).call(this),window.hideMiniCart=()=>n(this,Es,Vc).call(this),window.toggleMiniCart=()=>n(this,jr,wu).call(this),window.toggleXray=e=>n(this,Hr,vu).call(this,e),t(this,Vr)&&(t(this,Fe).info("Debug mode activated via URL parameter"),n(this,Kc,Lg).call(this),localStorage.getItem("os_debug_mini_cart_visible")==="true"&&n(this,xs,Bc).call(this)),t(this,Ti).state?.subscribe("cart",()=>{t(this,Rt)&&n(this,As,Hc).call(this)}),t(this,Fe).debug("Debug methods exposed to window object")},Kc=new WeakSet,Lg=function(){if(t(this,Pi))return;let e=document.createElement("div");e.className="os-debug-bar";let i=document.createElement("div");i.className="os-debug-bar-left";let s=document.createElement("span");s.className="os-debug-bar-title",s.textContent="29next Debug Tools",i.appendChild(s);let r=document.createElement("div");r.className="os-debug-bar-controls";let o=document.createElement("div");o.className="os-debug-bar-control";let c=document.createElement("span");c.textContent="X-ray View";let d=document.createElement("label");d.className="os-debug-bar-toggle";let u=document.createElement("input");u.type="checkbox",u.checked=Se.isXrayEnabled(),u.addEventListener("change",()=>n(this,Hr,vu).call(this,u.checked));let p=document.createElement("span");p.className="os-debug-bar-slider",d.append(u,p),o.append(c,d);let g=document.createElement("div");g.className="os-debug-bar-control";let m=document.createElement("button");m.className="os-debug-bar-button",m.textContent="Toggle Mini-Cart",m.addEventListener("click",()=>n(this,jr,wu).call(this)),g.appendChild(m),r.append(o,g),e.append(i,r),document.body.appendChild(e),h(this,Pi,e)},Hr=new WeakSet,vu=function(e){let i=Se.toggleXray(e);if(t(this,Pi)){let s=t(this,Pi).querySelector('input[type="checkbox"]');s&&(s.checked=i)}return t(this,Fe).info(`X-ray view ${i?"enabled":"disabled"}`),i},xs=new WeakSet,Bc=function(){if(t(this,Rt)){t(this,Fe).debug("Mini-cart already visible");return}t(this,Fe).info("Showing mini-cart widget"),t(this,Dt)??h(this,Dt,n(this,Jc,Ig).call(this)),t(this,Dt).style.display="block",h(this,Rt,!0),localStorage.setItem("os_debug_mini_cart_visible","true"),n(this,As,Hc).call(this)},Es=new WeakSet,Vc=function(){if(!t(this,Rt)){t(this,Fe).debug("Mini-cart already hidden");return}t(this,Fe).info("Hiding mini-cart widget"),t(this,Dt)&&(t(this,Dt).style.display="none"),h(this,Rt,!1),localStorage.setItem("os_debug_mini_cart_visible","false")},jr=new WeakSet,wu=function(){t(this,Rt)?n(this,Es,Vc).call(this):n(this,xs,Bc).call(this)},Jc=new WeakSet,Ig=function(){let e=document.createElement("div");e.className="os-debug-mini-cart",e.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      width: 300px;
      max-height: 400px;
      overflow-y: auto;
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      z-index: 9999;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      font-size: 14px;
      display: none;
    `;let i=document.createElement("div");i.className="os-debug-mini-cart-header",i.style.cssText=`
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      background-color: #f5f5f5;
      border-bottom: 1px solid #eee;
    `;let s=document.createElement("div");s.className="os-debug-mini-cart-title",s.textContent="Debug Mini-Cart",s.style.fontWeight="600";let r=document.createElement("div");r.style.display="flex",r.style.alignItems="center";let o=document.createElement("button");o.className="os-debug-mini-cart-refresh",o.textContent="",o.title="Refresh cart data",o.style.cssText=`
      background: none;
      border: none;
      font-size: 16px;
      cursor: pointer;
      padding: 0 8px;
      line-height: 1;
      color: #666;
    `,o.addEventListener("click",()=>{n(this,As,Hc).call(this),t(this,Fe).info("Mini-cart data refreshed manually")});let c=document.createElement("button");c.className="os-debug-mini-cart-close",c.textContent="",c.style.cssText=`
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      padding: 0;
      line-height: 1;
    `,c.addEventListener("click",()=>n(this,Es,Vc).call(this)),r.append(o,c),i.append(s,r);let d=document.createElement("div");d.className="os-debug-mini-cart-content",d.style.padding="15px";let u=document.createElement("div");return u.className="os-debug-mini-cart-footer",u.style.cssText=`
      padding: 10px 15px;
      background-color: #f5f5f5;
      border-top: 1px solid #eee;
      font-size: 12px;
      color: #666;
      text-align: center;
    `,u.textContent="Use window.hideMiniCart() to hide this widget",e.append(i,d,u),document.body.appendChild(e),e},As=new WeakSet,Hc=function(){if(!t(this,Dt))return;let e=t(this,Dt).querySelector(".os-debug-mini-cart-content");if(!e)return;let i=t(this,Ti).state?.getState("cart");if(!i){e.innerHTML='<div style="color: #999; text-align: center;">Cart data not available</div>';return}t(this,Fe).debug("Updating mini-cart with cart data:",i);let s=o=>t(this,Ti).campaign?.formatPrice(o)??`$${o.toFixed(2)}`,r="";if(i.items?.length?(r+='<div style="margin-bottom: 15px;">',r+='<div style="font-weight: 600; margin-bottom: 10px;">Items:</div>',r+='<ul style="list-style: none; padding: 0; margin: 0;">',i.items.forEach(o=>{let c=!!o.is_upsell,d=c?'<span style="display: inline-block; background-color: #4CAF50; color: white; font-size: 10px; padding: 2px 5px; border-radius: 3px; margin-left: 5px;">UPSELL</span>':"";r+=`
          <li style="padding: 5px 0; border-bottom: 1px solid #eee; ${c?"background-color: rgba(76, 175, 80, 0.1);":""}">
            <div style="display: flex; justify-content: space-between;">
              <div style="font-weight: 500;">${o.name}${d}</div>
              <div>${o.quantity}  ${s(o.price)}</div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
              <div style="color: #666; font-size: 12px;">
                ID: ${o.id}
                ${c?'<span style="color: #4CAF50; margin-left: 5px;"> is_upsell=true</span>':""}
              </div>
              <div style="font-weight: 500;">${s(o.price*o.quantity)}</div>
            </div>
          </li>
        `}),r+="</ul></div>"):r+='<div style="color: #999; text-align: center; margin-bottom: 15px;">Cart is empty</div>',i.totals){if(r+="<div>",r+='<div style="font-weight: 600; margin-bottom: 10px;">Totals:</div>',r+='<ul style="list-style: none; padding: 0; margin: 0;">',i.totals.original_subtotal&&i.totals.original_subtotal>i.totals.subtotal&&(r+=`
          <li style="display: flex; justify-content: space-between; padding: 3px 0;">
            <div>Original Subtotal:</div>
            <div>${s(i.totals.original_subtotal)}</div>
          </li>
        `),r+=`
        <li style="display: flex; justify-content: space-between; padding: 3px 0;">
          <div>Subtotal:</div>
          <div>${s(i.totals.subtotal)}</div>
        </li>
      `,i.couponCode){let o=i.couponDetails?.type||"unknown",c=i.couponDetails?.value,d=i.couponCode;o&&c!==void 0&&(o==="percentage"?d+=` (${c}% off)`:o==="fixed"?d+=` ($${c} off)`:o==="free_shipping"&&(d+=" (Free shipping)")),r+=`
          <li style="display: flex; justify-content: space-between; padding: 3px 0; color: #4CAF50;">
            <div>Voucher:</div>
            <div>${d}</div>
          </li>
        `,i.totals.discount>0&&(r+=`
            <li style="display: flex; justify-content: space-between; padding: 3px 0; color: #4CAF50;">
              <div>Discount:</div>
              <div>-${s(i.totals.discount)}</div>
            </li>
          `)}i.totals.retail_subtotal>i.totals.subtotal&&(r+=`
          <li style="display: flex; justify-content: space-between; padding: 3px 0;">
            <div>Retail Subtotal:</div>
            <div>${s(i.totals.retail_subtotal)}</div>
          </li>
        `,i.totals.savings&&(r+=`
            <li style="display: flex; justify-content: space-between; padding: 3px 0; color: #e53935;">
              <div>Savings:</div>
              <div>${s(i.totals.savings)} (${Math.round(i.totals.savings_percentage)}%)</div>
            </li>
          `)),i.totals.shipping>0?r+=`
          <li style="display: flex; justify-content: space-between; padding: 3px 0;">
            <div>Shipping:</div>
            <div>${s(i.totals.shipping)}</div>
          </li>
        `:i.totals.shipping===0&&i.couponDetails?.type==="free_shipping"&&(r+=`
          <li style="display: flex; justify-content: space-between; padding: 3px 0; color: #4CAF50;">
            <div>Shipping:</div>
            <div>FREE</div>
          </li>
        `),i.totals.recurring_total>0&&(r+=`
          <li style="display: flex; justify-content: space-between; padding: 3px 0; color: #2196f3;">
            <div>Recurring Total:</div>
            <div>${s(i.totals.recurring_total)}</div>
          </li>
        `),r+=`
        <li style="display: flex; justify-content: space-between; padding: 3px 0; font-weight: 600; margin-top: 5px; border-top: 1px solid #eee;">
          <div>Total:</div>
          <div>${s(i.totals.total)}</div>
        </li>
      `,r+="</ul></div>"}else r+='<div style="color: #999; text-align: center; margin-bottom: 15px;">Cart totals not available</div>';e.innerHTML=r};var Zc,ke,ni,Xc,Gr,Su,Qc,qg,el,Mg,tl,Fg,Kr,_u,Yc=class{constructor(e){a(this,Gr);a(this,Qc);a(this,el);a(this,tl);a(this,Kr);a(this,Zc,void 0);a(this,ke,void 0);a(this,ni,new Map);a(this,Xc,"os-timer-");h(this,Zc,e),h(this,ke,e.logger.createModuleLogger("TIMER")),n(this,Gr,Su).call(this),t(this,ke).infoWithTime("TimerManager initialized")}refreshTimers(){t(this,ke).infoWithTime("Refreshing timers"),t(this,ni).forEach(e=>{e.intervalId&&(clearInterval(e.intervalId),e.intervalId=null)}),t(this,ni).clear(),n(this,Gr,Su).call(this)}getTimers(){return t(this,ni)}};Zc=new WeakMap,ke=new WeakMap,ni=new WeakMap,Xc=new WeakMap,Gr=new WeakSet,Su=function(){t(this,ke).infoWithTime("Initializing timers");let e=document.querySelectorAll('[data-os-element="timer"]');if(e.length===0){t(this,ke).debugWithTime("No timer elements found on page");return}t(this,ke).debugWithTime(`Found ${e.length} timer elements`),e.forEach(i=>{n(this,Qc,qg).call(this,i)})},Qc=new WeakSet,qg=function(e){let i=e.closest('[data-os-element="timer-text"]');i||t(this,ke).warnWithTime('Timer element has no parent with data-os-element="timer-text", using default configuration');let s=n(this,el,Mg).call(this,e,i);if(!s.duration){t(this,ke).warnWithTime(`Timer element is missing duration, skipping: ${e.outerHTML}`);return}let r=i?i.innerHTML:null,o=+new Date,c=s.persistenceId;if(c){let p=t(this,Xc)+c,g=parseInt(localStorage.getItem(p)||"");g>0?(o=g,t(this,ke).debugWithTime(`Loaded persisted timer start time for ${c}: ${new Date(o).toISOString()}`)):(localStorage.setItem(p,String(o)),t(this,ke).debugWithTime(`Saved new timer start time for ${c}: ${new Date(o).toISOString()}`))}else t(this,ke).debugWithTime(`Timer has no persistence ID, it will reset with every page load: ${e.outerHTML}`);let d={element:e,parentElement:i,config:s,startTime:o,intervalId:null,originalParentContent:r};t(this,ni).set(e,d);let u=()=>{let g=(+new Date-o)/1e3,m=Math.round(s.duration-g);if(m<=0){m=0,s.expiryText?i&&s.replaceEntireContent?i.innerHTML=s.expiryText:e.innerText=s.expiryText:e.innerText="00:00",d.intervalId&&(clearInterval(d.intervalId),d.intervalId=null),t(this,ni).delete(e),n(this,Kr,_u).call(this,"expired",e,{timerElement:e,parentElement:i,config:s});return}let v=Math.floor(m/3600);m-=v*3600;let y=Math.floor(m/60);m-=y*60;let k=n(this,tl,Fg).call(this,v,y,m,s.format);e.innerText=k,n(this,Kr,_u).call(this,"updated",e,{timerElement:e,parentElement:i,config:s,remaining:{hours:v,minutes:y,seconds:m},formattedTime:k})};u(),d.intervalId=setInterval(u,1e3),t(this,ke).debugWithTime(`Timer initialized: ${s.duration} seconds, persistence ID: ${s.persistenceId||"none"}`)},el=new WeakSet,Mg=function(e,i){let s={duration:0,persistenceId:null,expiryText:null,format:"auto",replaceEntireContent:!1};return e.dataset.osDuration?s.duration=parseInt(e.dataset.osDuration):i?.dataset.osTimerDuration&&(s.duration=parseInt(i.dataset.osTimerDuration)),e.dataset.osPersistenceId?s.persistenceId=e.dataset.osPersistenceId:i?.dataset.osTimerPersistenceId&&(s.persistenceId=i.dataset.osTimerPersistenceId),e.dataset.osExpiryText?s.expiryText=e.dataset.osExpiryText:i?.dataset.osTimerExpiryText&&(s.expiryText=i.dataset.osTimerExpiryText),e.dataset.osFormat?s.format=e.dataset.osFormat:i?.dataset.osTimerFormat&&(s.format=i.dataset.osTimerFormat),(e.dataset.osReplaceEntireContent==="true"||i?.dataset.osTimerReplaceEntireContent==="true")&&(s.replaceEntireContent=!0),s.expiryText&&(s.expiryText.includes("<")||s.expiryText.includes(">"))&&(s.replaceEntireContent=!0),s},tl=new WeakSet,Fg=function(e,i,s,r){let o=c=>c.toString().padStart(2,"0");return r==="hh:mm:ss"||r==="auto"&&e>0?`${o(e)}:${o(i)}:${o(s)}`:r==="mm:ss"||r==="auto"&&i>0?`${o(i)}:${o(s)}`:r==="ss"?o(s):`${o(i)}:${o(s)}`},Kr=new WeakSet,_u=function(e,i,s={}){let r=new CustomEvent(`os:timer.${e}`,{bubbles:!0,cancelable:!0,detail:{...s,manager:this}});i.dispatchEvent(r),document.dispatchEvent(r),t(this,ke).debugWithTime(`Timer event triggered: ${e}`)};var ks,Ne,$s,Jr,Cu,sl,Ng,rl,Ug,il=class{constructor(e){a(this,Jr);a(this,sl);a(this,rl);a(this,ks,void 0);a(this,Ne,void 0);a(this,$s,new Map);h(this,ks,e),h(this,Ne,e.logger.createModuleLogger("DISPLAY")),n(this,Jr,Cu).call(this),t(this,ks).state.subscribe("cart",()=>this.refreshDisplayElements()),t(this,Ne).infoWithTime("DisplayManager initialized")}refreshDisplayElements(){t(this,Ne).debugWithTime("Refreshing display elements");let i=t(this,ks).state.getState("cart").items.map(s=>s.id.toString());t(this,$s).forEach((s,r)=>{n(this,sl,Ng).call(this,r,s,i)})}refresh(){t(this,Ne).infoWithTime("Manually refreshing display elements"),t(this,$s).clear(),n(this,Jr,Cu).call(this)}};ks=new WeakMap,Ne=new WeakMap,$s=new WeakMap,Jr=new WeakSet,Cu=function(){t(this,Ne).infoWithTime("Initializing display elements");let e=document.querySelectorAll('[data-os-cart="swap-display"]');if(e.length===0){t(this,Ne).debugWithTime("No swap display containers found on page");return}t(this,Ne).debugWithTime(`Found ${e.length} swap display containers`),e.forEach((i,s)=>{let r=i.dataset.osId||`auto-container-${s}`,o=i.querySelectorAll('[data-os-in-cart="display"]');if(o.length===0){t(this,Ne).warnWithTime(`Container ${r} has no display elements`);return}t(this,$s).set(i,{id:r,elements:Array.from(o).map(c=>({element:c,packageId:c.dataset.osPackage}))}),t(this,Ne).debugWithTime(`Initialized container ${r} with ${o.length} display elements`)}),this.refreshDisplayElements()},sl=new WeakSet,Ng=function(e,i,s){let{id:r,elements:o}=i,c=!1;for(let{element:d,packageId:u}of o)u&&s.includes(u)?(d.style.display="block",c=!0,t(this,Ne).debugWithTime(`Showing element for package ${u} in container ${r}`)):d.style.display="none";!c&&o.length>0,n(this,rl,Ug).call(this,"updated",e,{containerId:r,hasVisibleElement:c,visiblePackageIds:o.filter(({element:d})=>d.style.display==="block").map(({packageId:d})=>d)})},rl=new WeakSet,Ug=function(e,i,s={}){let r=new CustomEvent(`os:display.${e}`,{bubbles:!0,cancelable:!0,detail:{...s,manager:this}});i.dispatchEvent(r),document.dispatchEvent(r),t(this,Ne).debugWithTime(`Display event triggered: ${e}`)};var xt,x,B,J,zt,Yr,xu,ol,Og,al,Rg,cl,Dg,ll,zg,dl,Wg,ul,Bg,hl,Vg,pl,Hg,ne,ue,gl,jg,ml,Gg,Eu,$f,nl=class{constructor(e){a(this,Yr);a(this,ol);a(this,al);a(this,cl);a(this,ll);a(this,dl);a(this,ul);a(this,hl);a(this,pl);a(this,ne);a(this,gl);a(this,ml);a(this,Eu);a(this,xt,void 0);a(this,x,void 0);a(this,B,{lineDisplays:[],summaryContainers:[],savingsBars:[],shippingBars:[],grandTotals:[],subtotals:[],summaryBars:[],summaryPanels:[],summaryTexts:[],summaryIcons:[],compareTotalElements:[]});a(this,J,{currencySymbol:"$",showComparePricing:!0,showProductImages:!0,showTaxPendingMessage:!0,frequencyOverrides:{},priceOverrides:{}});a(this,zt,null);h(this,xt,e),h(this,x,e.logger.createModuleLogger("CART_DISPLAY")),n(this,Yr,xu).call(this),t(this,xt).state.subscribe("cart",()=>this.updateCartDisplay()),t(this,x).infoWithTime("CartDisplayManager initialized")}updateCartDisplay(){t(this,x).debugWithTime("[UPDATE] updateCartDisplay CALLED");let e=t(this,xt).state.getState("cart");if(!e){t(this,x).warnWithTime("[UPDATE] Cart data not available, returning.");return}if(!Array.isArray(e.items)){t(this,x).warnWithTime(`[UPDATE] Cart data present, but cart.items is not an array (type: ${typeof e.items}). Cannot update display.`);return}t(this,x).debugWithTime(`[UPDATE] Processing cart with ${e.items.length} items. Package IDs: ${e.items.map(i=>i?.package_id||"N/A").join(", ")}`),n(this,cl,Dg).call(this,e.items),n(this,dl,Wg).call(this,e.totals),n(this,ul,Bg).call(this,e.totals.shipping,e.shippingMethod),n(this,hl,Vg).call(this,e.totals),n(this,pl,Hg).call(this,e.totals.total),n(this,ml,Gg).call(this,e.totals),t(this,x).debugWithTime("[UPDATE] Cart display fully updated")}refresh(){t(this,x).infoWithTime("Manually refreshing cart display"),n(this,Yr,xu).call(this)}};xt=new WeakMap,x=new WeakMap,B=new WeakMap,J=new WeakMap,zt=new WeakMap,Yr=new WeakSet,xu=function(){if(t(this,x).infoWithTime("[INIT] Initializing cart display"),window.osConfig&&window.osConfig.cartDisplayConfig?(window.osConfig.cartDisplayConfig.frequencyOverrides&&(t(this,J).frequencyOverrides=window.osConfig.cartDisplayConfig.frequencyOverrides),window.osConfig.cartDisplayConfig.priceOverrides&&(t(this,J).priceOverrides=window.osConfig.cartDisplayConfig.priceOverrides),t(this,x).debugWithTime(`[INIT] Loaded cartDisplayConfig. Freq Keys: ${Object.keys(t(this,J).frequencyOverrides||{}).join(",")||"none"}, Price Keys: ${Object.keys(t(this,J).priceOverrides||{}).join(",")||"none"}`)):t(this,x).debugWithTime("[INIT] No cartDisplayConfig found in window.osConfig."),t(this,B).lineDisplays=document.querySelectorAll('[data-os-cart-summary="line-display"]'),t(this,B).summaryContainers=document.querySelectorAll('[data-os-cart="summary"]'),t(this,B).savingsBars=document.querySelectorAll('[data-os-cart-summary="savings"]'),t(this,B).shippingBars=document.querySelectorAll('[data-os-cart-summary="shipping-bar"]'),t(this,B).grandTotals=document.querySelectorAll('[data-os-cart-summary="grand-total"]'),t(this,B).subtotals=document.querySelectorAll('[data-os-cart-summary="subtotal"]'),t(this,B).summaryBars=document.querySelectorAll('[os-checkout-element="summary-bar"]'),t(this,B).summaryPanels=document.querySelectorAll('[os-checkout-element="summary-mobile"]'),t(this,B).summaryTexts=document.querySelectorAll('[os-checkout-element="summary-text"]'),t(this,B).summaryIcons=document.querySelectorAll("[os-summary-icon]"),t(this,B).compareTotalElements=document.querySelectorAll('[data-os-cart-summary="compare-total"]'),t(this,B).summaryContainers.length>0){let i=t(this,B).summaryContainers[0];t(this,J).showComparePricing=i.dataset.showComparePricing!=="false",t(this,J).showProductImages=i.dataset.showProductImages!=="false",t(this,J).showTaxPendingMessage=i.dataset.showTaxPendingMessage!=="false",t(this,J).currencySymbol=i.dataset.currencySymbol||"$"}let e=document.querySelector('[data-os-cart-summary="line-item"]');if(e){h(this,zt,e.cloneNode(!0)),t(this,x).debugWithTime("[INIT] Line item template found and cloned.");let i=!!t(this,zt).querySelector('[data-os-cart-summary="line-frequency"]'),s=!!t(this,zt).querySelector('[data-os-cart-summary="line-sale"]');t(this,x).debugWithTime(`[INIT] Template check: Has Frequency? ${i}. Has Sale Price? ${s}`)}else t(this,x).warnWithTime("[INIT] CRITICAL: Line item template NOT FOUND.");n(this,ol,Og).call(this),this.updateCartDisplay()},ol=new WeakSet,Og=function(){let{summaryBars:e,summaryPanels:i,summaryTexts:s,summaryIcons:r}=t(this,B);if(!e.length||!i.length){t(this,x).debugWithTime("Summary toggle elements not found, skipping initialization");return}t(this,x).debugWithTime("Initializing summary toggle"),i.forEach((o,c)=>{if(o.classList.add("no-transition"),!o.classList.contains("cc-expanded")){o.style.height="0",o.style.opacity="0",o.style.overflow="hidden";let d=s[c];d&&(d.textContent="Show Order Summary")}requestAnimationFrame(()=>{o.classList.remove("no-transition"),o.style.transition="height 0.3s ease-out, opacity 0.25s ease-out"})}),e.forEach((o,c)=>{o.addEventListener("click",d=>{d.preventDefault(),n(this,al,Rg).call(this,c)})}),window.addEventListener("resize",n(this,gl,jg).call(this,()=>{i.forEach(o=>{o.classList.contains("cc-expanded")&&(o.style.height="auto")})},250)),t(this,x).debugWithTime("Summary toggle initialized")},al=new WeakSet,Rg=function(e=0){let{summaryPanels:i,summaryTexts:s,summaryIcons:r}=t(this,B),o=i[e],c=s[e],d=r[e];if(!o)return;if(!o.classList.contains("cc-expanded"))o.classList.add("cc-expanded"),o.style.height=`${o.scrollHeight}px`,o.style.opacity="1",c&&(c.textContent="Hide Order Summary"),d&&(d.style.transform="rotate(180deg)"),o.addEventListener("transitionend",()=>{o.classList.contains("cc-expanded")&&(o.style.height="auto")},{once:!0}),t(this,x).debugWithTime("Summary panel expanded");else{let p=o.scrollHeight;o.style.height=`${p}px`,o.offsetHeight,o.style.height="0",o.style.opacity="0",c&&(c.textContent="Show Order Summary"),d&&(d.style.transform="rotate(0deg)"),o.addEventListener("transitionend",()=>{o.style.height==="0px"&&o.classList.remove("cc-expanded")},{once:!0}),t(this,x).debugWithTime("Summary panel collapsed")}},cl=new WeakSet,Dg=function(e){if(t(this,x).debugWithTime(`[#updateLineItems] Entered. Item count: ${e.length}.`),!t(this,B).lineDisplays.length||!t(this,zt)){t(this,x).warnWithTime("[#updateLineItems] Line displays or template not found, cannot update.");return}t(this,B).lineDisplays.forEach(s=>{s.innerHTML="";let r=s.dataset.osShowItemDiscount==="true";t(this,x).debugWithTime(`[#updateLineItems] lineDisplay ${s.classList} showDiscountedPriceOnLineItem: ${r}`),e&&e.length>0&&e.forEach(o=>{let c=n(this,ll,zg).call(this,o,r);s.appendChild(c)})});let i=document.querySelectorAll('[data-os-cart-summary="summary-scroll"]');if(i.length){let s=e&&e.length>2;i.forEach(r=>{r.classList.toggle("hide",!s)})}setTimeout(()=>{t(this,x).debugWithTime("[Direct DOM Update] Attempting..."),document.querySelectorAll('[data-os-cart-summary="line-frequency"]').forEach(o=>{let c=o.closest('[data-os-cart-summary="line-item"]');if(!c)return;let d=c.querySelector('[data-os-cart-summary="line-title"]');if(!d||!e)return;let u=d.textContent,p=e.find(g=>g.name===u);if(p){let g=p.package_id!==void 0&&p.package_id!==null?p.package_id.toString():"undefined";if(g!=="undefined"&&t(this,J).frequencyOverrides&&t(this,J).frequencyOverrides[g]){let m=t(this,J).frequencyOverrides[g];t(this,x).debugWithTime(`[Direct DOM Update] Setting frequency for "${u}" (package_id "${g}")`),o.textContent=m,o.classList.remove("hide")}}}),document.querySelectorAll('[data-os-cart-summary="line-sale"]').forEach(o=>{let c=o.closest('[data-os-cart-summary="line-item"]');if(!c)return;let d=c.querySelector('[data-os-cart-summary="line-title"]');if(!d||!e)return;let u=d.textContent,p=e.find(g=>g.name===u);if(p){let g=p.package_id!==void 0&&p.package_id!==null?p.package_id.toString():"undefined";if(g!=="undefined"&&t(this,J).priceOverrides&&t(this,J).priceOverrides[g]!==void 0){let m=t(this,J).priceOverrides[g];t(this,x).debugWithTime(`[Direct DOM Update] Setting price for "${u}" (package_id "${g}")`),o.textContent=n(this,ne,ue).call(this,m*(p.quantity||1))}}})},150)},ll=new WeakSet,zg=function(e,i=!1){if(!e)return t(this,x).warnWithTime("[#createLineItemElement] Item is null or undefined. Skipping."),document.createElement("div");if(!t(this,zt)){t(this,x).warnWithTime("[#createLineItemElement] Line item template is missing.");let _=document.createElement("div");return _.textContent="Error: Line item template missing",_}let s=e.package_id?.toString()||e.id?.toString()||"undefined";t(this,x).debugWithTime(`[#createLineItemElement] For "${e.name}", pkgId:"${s}", showDiscountedFlag:${i}, item.applied_coupon_discount_amount: ${e.applied_coupon_discount_amount}`);let r=t(this,zt).cloneNode(!0);s!=="undefined"&&(r.dataset.osPackageId=s),e.is_upsell===!0?r.dataset.osItemType="upsell":r.dataset.osItemType="standard";let o=r.querySelector('[data-os-cart-summary="line-title"]');if(o&&(o.textContent=e.name),t(this,J).showProductImages){let _=r.querySelector('[data-os-cart-summary="line-image"]');_&&e.image&&(_.src=e.image,_.alt=e.name)}let c=r.querySelector('[os-cart="line_item-qty"]');c&&(c.textContent=e.quantity||1);let d=r.querySelector('[data-os-cart-summary="line-frequency"]');if(d){let _=null;s!=="undefined"&&t(this,J).frequencyOverrides&&t(this,J).frequencyOverrides[s]?_=t(this,J).frequencyOverrides[s]:e.subscription_frequency&&(_=`Schedule: Every ${e.subscription_frequency} Days`),_?(d.textContent=_,d.classList.remove("hide")):d.classList.add("hide")}let u=r.querySelector('[data-os-cart-summary="line-compare"]'),p=r.querySelector('[data-os-cart-summary="line-sale"]'),g=e.price_total!=null?e.price_total:(e.price||0)*(e.quantity||1);s!=="undefined"&&t(this,J).priceOverrides&&t(this,J).priceOverrides[s]!==void 0&&(g=t(this,J).priceOverrides[s]*(e.quantity||1),t(this,x).debugWithTime(`[#createLineItemElement] Using CDM config price override for "${s}". New baseLinePrice: ${g}`));let m=g;if(i&&e.applied_coupon_discount_amount&&typeof e.applied_coupon_discount_amount=="number"&&e.applied_coupon_discount_amount>0){let _=e.applied_coupon_discount_amount;m=Math.max(0,g-_),t(this,x).debugWithTime(`[#createLineItemElement] Item "${e.name}" (pkgId:"${s}") applying item coupon discount. BaseLinePrice: ${g}, ItemLineDiscount: ${_}, FinalSalePriceForLine: ${m}`),p&&p.classList.add("price--coupon-applied")}else p&&p.classList.remove("price--coupon-applied");p&&(p.textContent=n(this,ne,ue).call(this,m));let v=e.retail_price_total!=null?e.retail_price_total:(e.retail_price||0)*(e.quantity||1);u&&v>0&&t(this,J).showComparePricing?v>g?(u.textContent=n(this,ne,ue).call(this,v),u.classList.remove("hide")):u.classList.add("hide"):u&&u.classList.add("hide");let y=r.querySelector('[data-os-cart-summary="line-saving-percent"]');if(y&&v>0)if(v>m){let _=Math.round((1-m/v)*100);if(_>0){let T=y.dataset.osFormat||"default",P=`${_}% OFF`;T==="parenthesis"&&(P=`(${_}% OFF)`),y.textContent=P,y.classList.remove("hide")}else y.classList.add("hide")}else y.classList.add("hide");else y&&y.classList.add("hide");let k=r.querySelector('[data-os-cart-summary="remove-line"]');return k&&k.addEventListener("click",_=>{_.preventDefault();let T=e.id?.toString();if(t(this,x).infoWithTime(`Remove button clicked for item id: ${T} (package_id: ${s})`),T&&T!=="undefined"&&t(this,xt).cart)try{t(this,xt).cart.removeFromCart(T)}catch(P){t(this,x).errorWithTime(`Error removing item id ${T} from cart:`,P)}else t(this,x).warnWithTime("Cannot remove item: item.id is undefined or cart manager not available.")}),r},dl=new WeakSet,Wg=function(e){if(e)if(t(this,B).subtotals.length&&(t(this,B).subtotals.forEach(i=>{i.textContent=n(this,ne,ue).call(this,e.subtotal)}),t(this,x).debugWithTime(`Updated subtotal to: ${n(this,ne,ue).call(this,e.subtotal)}`)),e.discount>0){let i=document.querySelectorAll('[data-os-cart-summary="discount-amount"]'),s=document.querySelectorAll('[data-os-cart-summary="discount-row"]');i.forEach(o=>{o.textContent=`-${n(this,ne,ue).call(this,e.discount)}`}),s.forEach(o=>{o.classList.remove("hide")}),t(this,x).debugWithTime(`Updated discount amount to: -${n(this,ne,ue).call(this,e.discount)}`),document.querySelectorAll('[data-os-cart-summary="original-subtotal"]').forEach(o=>{o.textContent=n(this,ne,ue).call(this,e.original_subtotal||e.subtotal+e.discount),o.classList.remove("hide")})}else document.querySelectorAll('[data-os-cart-summary="discount-row"]').forEach(r=>{r.classList.add("hide")}),document.querySelectorAll('[data-os-cart-summary="original-subtotal"]').forEach(r=>{r.classList.add("hide")})},ul=new WeakSet,Bg=function(e,i){if(!t(this,B).shippingBars.length){t(this,x).warnWithTime("Shipping bars not found");return}t(this,B).shippingBars.forEach(s=>{let r=s.querySelector('[data-os-cart-summary="shipping-compare"]'),o=s.querySelector('[data-os-cart-summary="shipping-current"]');r&&o&&(e===0&&i?.standard_cost>0?(r.textContent=n(this,ne,ue).call(this,i.standard_cost),o.textContent="FREE",r.classList.remove("hide")):e>0?(o.textContent=n(this,ne,ue).call(this,e),r.classList.add("hide")):(o.textContent="FREE",r.classList.add("hide")))})},hl=new WeakSet,Vg=function(e){if(!t(this,B).savingsBars.length){t(this,x).warnWithTime("Savings bars not found");return}t(this,B).savingsBars.forEach(r=>{let o=r.querySelector('[data-os-cart-summary="savings-amount"]'),c=r.querySelector('[data-os-cart-summary="savings-percentage"]');e.savings>0&&e.savings_percentage>0?(o&&(o.textContent=n(this,ne,ue).call(this,e.savings),t(this,x).debugWithTime(`Updated savings amount to: ${n(this,ne,ue).call(this,e.savings)}`)),c&&(c.textContent=`${Math.round(e.savings_percentage)}% OFF`,t(this,x).debugWithTime(`Updated savings percentage to: ${Math.round(e.savings_percentage)}% OFF`)),r.classList.remove("hide")):r.classList.add("hide")});let i=document.querySelectorAll('[data-os-cart-summary="savings-amount"]'),s=document.querySelectorAll('[data-os-cart-summary="savings-percentage"]');e.savings>0&&e.savings_percentage>0&&(i.forEach(r=>{r.textContent=n(this,ne,ue).call(this,e.savings)}),s.forEach(r=>{r.textContent=`${Math.round(e.savings_percentage)}% OFF`}))},pl=new WeakSet,Hg=function(e){if(!t(this,B).grandTotals.length){t(this,x).warnWithTime("Grand total elements not found");return}t(this,B).grandTotals.forEach(i=>{i.textContent=n(this,ne,ue).call(this,e)}),t(this,x).debugWithTime(`Updated grand total to: ${n(this,ne,ue).call(this,e)}`)},ne=new WeakSet,ue=function(e){return t(this,xt).campaign?.formatPrice?t(this,xt).campaign.formatPrice(e):`${t(this,J).currencySymbol}${e.toFixed(2)} USD`},gl=new WeakSet,jg=function(e,i){let s;return function(...o){let c=()=>{clearTimeout(s),e(...o)};clearTimeout(s),s=setTimeout(c,i)}},ml=new WeakSet,Gg=function(e){if(!t(this,B).compareTotalElements.length){t(this,x).debugWithTime("No compare-total elements found");return}t(this,x).debugWithTime("Updating compare-total elements"),t(this,x).debugWithTime(`Cart totals: ${JSON.stringify(e)}`),document.body.setAttribute("data-debug-cart-totals",JSON.stringify({total:e.total,subtotal:e.subtotal,original_subtotal:e.original_subtotal,retail_subtotal:e.retail_subtotal,discount:e.discount})),t(this,B).compareTotalElements.forEach(i=>{let s=i.dataset.totalType||"retail",r=null;if(e.retail_subtotal&&e.retail_subtotal>e.subtotal)r=e.retail_subtotal,t(this,x).debugWithTime(`Using retail_subtotal (${r}) as compare value - product has built-in discount`);else if(e.discount>0)r=e.original_subtotal||e.subtotal+e.discount,t(this,x).debugWithTime(`Using original_subtotal (${r}) as compare value because a coupon is applied`);else switch(s){case"retail":r=e.retail_subtotal;break;case"recurring":r=e.recurring_total;break;case"subtotal_compare":case"original":case"msrp":r=e[s]||null;break;default:r=e.retail_subtotal}if(e.retail_subtotal&&e.discount>0){let u=e.original_subtotal||e.subtotal+e.discount;e.retail_subtotal>u?(r=e.retail_subtotal,t(this,x).debugWithTime(`Using retail_subtotal (${r}) as it's higher than original_subtotal with coupon`)):(r=u,t(this,x).debugWithTime(`Using original_subtotal (${r}) as it's higher than retail_subtotal`))}let o=i.hasAttribute("data-style"),c=i.getAttribute("data-style"),d=c==="diagonal-line";t(this,x).debugWithTime(`Element ${i.outerHTML} has style? ${o}, style=${c}, isDiagonal=${d}`),t(this,x).debugWithTime(`Compare value: ${r}, Total: ${e.total}, Should show? ${r&&r>e.total}`),i.setAttribute("data-compare-value",r||"none"),d?r&&r>e.total?(i.classList.add("diagonal-strike"),i.textContent=n(this,ne,ue).call(this,r),i.classList.remove("hide"),t(this,x).debugWithTime(`Updated diagonal-line compare-total to: ${n(this,ne,ue).call(this,r)}`)):(i.classList.remove("diagonal-strike"),i.classList.add("hide")):r&&r>e.total?(i.textContent=n(this,ne,ue).call(this,r),i.classList.remove("hide"),t(this,x).debugWithTime(`Updated compare-total to: ${n(this,ne,ue).call(this,r)}`)):(i.classList.add("hide"),t(this,x).debugWithTime(`Hiding compare-total element: compareValue=${r}, total=${e.total}`))})},Eu=new WeakSet,$f=function(e){return document.querySelectorAll(`[${e}]`)};var me,R,N,bl,vl,Kg,wl,Jg,Sl,Yg,_l,Zg,Ts,fl,Cl,Xg,Zr,Au,xl,Qg,El,em,oe,he,Xr,ku,Al,tm,kl,im,yl=class{constructor(e){a(this,vl);a(this,wl);a(this,Sl);a(this,_l);a(this,Ts);a(this,Cl);a(this,Zr);a(this,xl);a(this,El);a(this,oe);a(this,Xr);a(this,Al);a(this,kl);a(this,me,void 0);a(this,R,void 0);a(this,N,{});a(this,bl,!1);h(this,me,e),h(this,R,e.logger.createModuleLogger("ATTRIBUTION")),n(this,vl,Kg).call(this)}updateAttributionData(e){e.metadata&&t(this,N).metadata&&(e.metadata={...t(this,N).metadata,...e.metadata}),e.funnel&&t(this,R).debug(`Updating funnel value to: ${e.funnel}`),h(this,N,{...t(this,N),...e}),n(this,Ts,fl).call(this),t(this,R).debug("Attribution data updated",e),t(this,me).events&&t(this,me).events.trigger("attribution.updated",{attribution:t(this,N)})}getAttributionData(){return{...t(this,N)}}getAttributionForApi(){let e=t(this,N).metadata?.everflow_transaction_id||"";return{affiliate:t(this,N).affiliate,funnel:t(this,N).funnel,gclid:t(this,N).gclid,metadata:t(this,N).metadata,everflow_transaction_id:e,utm_source:t(this,N).utm_source,utm_medium:t(this,N).utm_medium,utm_campaign:t(this,N).utm_campaign,utm_content:t(this,N).utm_content,utm_term:t(this,N).utm_term,subaffiliate1:t(this,N).subaffiliate1,subaffiliate2:t(this,N).subaffiliate2,subaffiliate3:t(this,N).subaffiliate3,subaffiliate4:t(this,N).subaffiliate4,subaffiliate5:t(this,N).subaffiliate5}}debug(){console.group("AttributionManager Debug Info");let e=document.querySelector('meta[name="os-tracking-tag"][data-tag-name="funnel_name"]'),i=e?e.getAttribute("data-tag-value"):"",s=t(this,me).campaign?.getCampaignName()||t(this,me).campaignData?.name||"";t(this,N).affiliate,t(this,N).funnel,localStorage.getItem("evclid"),sessionStorage.getItem("evclid"),t(this,N).metadata?.everflow_transaction_id,typeof window.EF<"u",console.group("API Formatted Attribution Data (What gets sent to API)");let r=this.getAttributionForApi();r.affiliate,r.funnel,r.gclid,r.utm_source,r.utm_medium,r.utm_campaign,r.utm_content,r.utm_term,r.subaffiliate1,r.subaffiliate2,r.subaffiliate3,r.subaffiliate4,r.subaffiliate5,console.group("Metadata Object:"),r.metadata.domain,r.metadata.device,r.metadata.device_type,r.metadata.fb_fbp,r.metadata.fb_fbc,r.metadata.fb_pixel_id,r.metadata,console.groupEnd(),console.groupEnd(),t(this,N),new URLSearchParams(window.location.search).toString(),console.group("Tracking Tags");let o=document.querySelectorAll('meta[name="os-tracking-tag"]');return o.length>0&&o.forEach(c=>{`${c.getAttribute("data-tag-name")}${c.getAttribute("data-tag-value")}`,c.getAttribute("data-persist")}),console.groupEnd(),e&&e.getAttribute("data-tag-value"),t(this,me).campaignData?.name,t(this,me).state&&t(this,me).state.getState("attribution"),console.groupEnd(),"Attribution debug info logged to console."}setFunnelName(e){return e?(t(this,N).funnel=e,n(this,Ts,fl).call(this),t(this,R).info(`Funnel name set to: ${e}`),!0):(t(this,R).warn("Cannot set empty funnel name"),!1)}setEverflowClickId(e){if(!e)return t(this,R).warn("Cannot set empty Everflow click ID"),!1;localStorage.setItem("evclid",e),sessionStorage.setItem("evclid",e);let i=t(this,N).metadata||{};return i.everflow_transaction_id=e,this.updateAttributionData({metadata:i}),t(this,R).info(`Everflow click ID set to: ${e}`),!0}};me=new WeakMap,R=new WeakMap,N=new WeakMap,bl=new WeakMap,vl=new WeakSet,Kg=function(){t(this,R).info("Initializing AttributionManager"),n(this,wl,Jg).call(this),n(this,Ts,fl).call(this),n(this,El,em).call(this),h(this,bl,!0),t(this,R).info("AttributionManager initialized successfully")},wl=new WeakSet,Jg=function(){let e={landing_page:window.location.href||"",referrer:document.referrer||"",device:navigator.userAgent||"",device_type:n(this,Al,tm).call(this),timestamp:Date.now(),domain:window.location.hostname,fb_fbp:n(this,Xr,ku).call(this,"_fbp")||"",fb_fbc:n(this,Xr,ku).call(this,"_fbc")||"",fb_pixel_id:n(this,kl,im).call(this)},i=n(this,oe,he).call(this,"fbclid")||"";i&&(e.fbclid=i),n(this,Sl,Yg).call(this,e),n(this,_l,Zg).call(this,e);let s=n(this,oe,he).call(this,"affid")||n(this,oe,he).call(this,"aff")||"";h(this,N,{affiliate:s,funnel:"",gclid:n(this,oe,he).call(this,"gclid")||"",metadata:e,utm_source:n(this,oe,he).call(this,"utm_source")||"",utm_medium:n(this,oe,he).call(this,"utm_medium")||"",utm_campaign:n(this,oe,he).call(this,"utm_campaign")||"",utm_content:n(this,oe,he).call(this,"utm_content")||"",utm_term:n(this,oe,he).call(this,"utm_term")||"",fbclid:i,subaffiliate1:n(this,oe,he).call(this,"subaffiliate1")||n(this,oe,he).call(this,"sub1")||"",subaffiliate2:n(this,oe,he).call(this,"subaffiliate2")||n(this,oe,he).call(this,"sub2")||"",subaffiliate3:n(this,oe,he).call(this,"subaffiliate3")||n(this,oe,he).call(this,"sub3")||"",subaffiliate4:n(this,oe,he).call(this,"subaffiliate4")||n(this,oe,he).call(this,"sub4")||"",subaffiliate5:n(this,oe,he).call(this,"subaffiliate5")||n(this,oe,he).call(this,"sub5")||"",first_visit_timestamp:n(this,xl,Qg).call(this),current_visit_timestamp:Date.now()}),t(this,R).debug("Attribution data collected")},Sl=new WeakSet,Yg=function(e){let i=new URLSearchParams(window.location.search),s=localStorage.getItem("evclid");if(i.has("evclid")?(s=i.get("evclid"),localStorage.setItem("evclid",s),sessionStorage.setItem("evclid",s),t(this,R).debug(`Everflow click ID found in URL: ${s}`)):!s&&sessionStorage.getItem("evclid")&&(s=sessionStorage.getItem("evclid"),localStorage.setItem("evclid",s),t(this,R).debug(`Everflow click ID found in sessionStorage: ${s}`)),i.has("sg_evclid")){let r=i.get("sg_evclid");sessionStorage.setItem("sg_evclid",r),localStorage.setItem("sg_evclid",r),e.sg_evclid=r,t(this,R).debug(`SG Everflow click ID found: ${r}`)}else localStorage.getItem("sg_evclid")&&(e.sg_evclid=localStorage.getItem("sg_evclid"));s&&(e.everflow_transaction_id=s,t(this,R).debug(`Added Everflow transaction ID to metadata: ${s}`))},_l=new WeakSet,Zg=function(e){let i=document.querySelectorAll('meta[name="os-tracking-tag"]');t(this,R).debug(`Found ${i.length} tracking tags`),i.forEach(s=>{let r=s.getAttribute("data-tag-name"),o=s.getAttribute("data-tag-value"),c=s.getAttribute("data-persist")==="true";if(r&&o&&(e[r]=o,t(this,R).debug(`Added tracking tag: ${r} = ${o}`),c))try{sessionStorage.setItem(`os_tag_${r}`,o),t(this,R).debug(`Persisted tracking tag: ${r} = ${o}`)}catch(d){t(this,R).error(`Error persisting tracking tag ${r}:`,d)}})},Ts=new WeakSet,fl=function(){if(!t(this,me).state){t(this,R).warn("State manager not available, attribution data will not be stored");return}t(this,me).state.setState("cart.attribution",t(this,N)),t(this,me).state.setState("attribution",this.getAttributionForApi()),n(this,Cl,Xg).call(this),t(this,me).events&&t(this,me).events.trigger("attribution.updated",{attribution:t(this,N)}),t(this,R).debug("Attribution data stored in state")},Cl=new WeakSet,Xg=function(){try{localStorage.setItem("os_attribution",JSON.stringify(t(this,N))),t(this,R).debug("Attribution data persisted to localStorage")}catch(e){t(this,R).error("Error persisting attribution data to localStorage:",e)}},Zr=new WeakSet,Au=function(){try{let e=localStorage.getItem("os_attribution");if(e)return JSON.parse(e)}catch(e){t(this,R).error("Error loading attribution data from localStorage:",e)}return{}},xl=new WeakSet,Qg=function(){let e=n(this,Zr,Au).call(this);return e.first_visit_timestamp?e.first_visit_timestamp:Date.now()},El=new WeakSet,em=function(){window.addEventListener("popstate",()=>{let e=t(this,N).metadata||{};e.landing_page=window.location.href,this.updateAttributionData({metadata:e})}),t(this,me).events&&(t(this,me).events.on("campaign.loaded",e=>{if(e&&e.campaign&&e.campaign.name&&!t(this,N).funnel){let s=document.querySelector('meta[name="os-tracking-tag"][data-tag-name="funnel_name"]')?.getAttribute("data-tag-value")||e.campaign.name;this.setFunnelName(s)}}),t(this,me).events.on("prospect.cartCreated",()=>{let e=t(this,N).metadata||{};e.conversion_timestamp=Date.now(),this.updateAttributionData({metadata:e}),t(this,R).debug("Cart created, updated metadata with conversion timestamp")}))},oe=new WeakSet,he=function(e){let i=new URLSearchParams(window.location.search);if(i.has(e)){let r=i.get(e);try{sessionStorage.setItem(e,r)}catch(o){t(this,R).error(`Error storing ${e} in sessionStorage:`,o)}return r}try{if(sessionStorage.getItem(e))return sessionStorage.getItem(e)}catch(r){t(this,R).error(`Error reading ${e} from sessionStorage:`,r)}try{if(localStorage.getItem(e))return localStorage.getItem(e)}catch(r){t(this,R).error(`Error reading ${e} from localStorage:`,r)}let s=n(this,Zr,Au).call(this);return s[e]?s[e]:""},Xr=new WeakSet,ku=function(e){let s=`; ${document.cookie}`.split(`; ${e}=`);return s.length===2?s.pop().split(";").shift():""},Al=new WeakSet,tm=function(){let e=navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)?"mobile":"desktop"},kl=new WeakSet,im=function(){let e=document.querySelector('meta[name="os-facebook-pixel"]');if(e){let s=e.getAttribute("content");if(s)return t(this,R).debug(`Facebook Pixel ID found from os-facebook-pixel meta tag: ${s}`),s}let i=document.querySelectorAll("script");for(let s of i){let r=s.textContent||"";if(r.includes("fbq(")&&r.includes("init")){let o=r.match(/fbq\s*\(\s*['"]init['"],\s*['"](\d+)['"]/);if(o&&o[1])return o[1]}}return""};var Et,C,en,Y,Tl,Wt,$u,Ke,Pl,sm,Li,Qr,Ll,rm,Il,nm,ql,om,Ml,am,Fl,cm,Nl,lm,oi,Ps,$l=class{constructor(e){a(this,Pl);a(this,Li);a(this,Ll);a(this,Il);a(this,ql);a(this,Ml);a(this,Fl);a(this,Nl);a(this,oi);a(this,Et,void 0);a(this,C,void 0);a(this,en,!1);a(this,Y,{gtm:{enabled:!1,initialized:!1},fbPixel:{enabled:!1,initialized:!1},ga4:{enabled:!1,initialized:!1}});a(this,Tl,!1);a(this,Wt,new Set);a(this,$u,!1);a(this,Ke,new Set);h(this,Et,e),h(this,C,e.logger.createModuleLogger("EVENT")),h(this,Tl,e.options?.debug||!1),this.init()}init(){t(this,C).info("Initializing EventManager"),n(this,ql,om).call(this),n(this,Pl,sm).call(this),n(this,Ml,am).call(this),n(this,Ll,rm).call(this),h(this,en,!0),t(this,C).info("EventManager initialized")}viewItemList(e){if(t(this,C).debug("viewItemList called with campaign data:",e?"present":"missing"),!e||!e.packages||e.packages.length===0){t(this,C).warn("Cannot fire view_item_list event: No packages found in campaign data");return}t(this,C).debug(`Found ${e.packages.length} packages in campaign data`);let i=e.packages.map(r=>{let o=typeof r.price=="string"?parseFloat(r.price):r.price||0;return{item_id:r.external_id||r.ref_id,item_name:r.name,price:o,currency:e.currency||"USD",quantity:r.qty||1}}),s={event:"view_item_list",ecommerce:{currency:e.currency||"USD",items:i}};t(this,C).debug("Firing view_item_list event with data:",s),n(this,oi,Ps).call(this,"view_item_list",s)}addToCart(e){let i=!e.items&&!e.totals,s=[],r="USD",o=0;if(i){if(t(this,C).debug("addToCart called with single package, converting to cart format"),!e){t(this,C).warn("Cannot fire add_to_cart event: No package data provided");return}let d=e,u={item_id:d.external_id||d.ref_id||d.id,item_name:d.name,price:parseFloat(d.price)||0,currency:d.currency||t(this,Et).getCampaignData()?.currency||"USD",quantity:d.quantity||1};s=[u],r=u.currency,o=u.price*u.quantity}else{if(!e||!e.items||e.items.length===0){t(this,C).warn("Cannot fire add_to_cart event: No items in cart");return}s=e.items.map(d=>({item_id:d.external_id||d.id,item_name:d.name,price:parseFloat(d.price)||0,currency:e.totals?.currency||"USD",quantity:d.quantity||1})),r=e.totals?.currency||"USD",o=e.totals?.total||0}let c={event:"add_to_cart",ecommerce:{currency:r,value:o,items:s}};n(this,oi,Ps).call(this,"add_to_cart",c)}purchase(e,i=!1){if(!e||!e.lines||e.lines.length===0){t(this,C).warn("Cannot fire purchase event: No items in order");return}let s=e.number||e.ref_id;if(t(this,C).debug(`Purchase method called for order ${s}, force=${i}, already processed=${t(this,Wt).has(s)}`),!i&&s&&t(this,Wt).has(s)){t(this,C).info(`Purchase event for order ${s} already fired, skipping`);return}t(this,C).info(`Preparing to fire purchase event for order ${s}`);let r=e.lines.map(d=>({item_id:d.product_id||d.id,item_name:d.product_title||d.name,price:parseFloat(d.price_incl_tax||d.price)||0,currency:e.currency||"USD",quantity:d.quantity||1})),o=n(this,Fl,cm).call(this,e),c={event:"purchase",ecommerce:{transaction_id:s,value:parseFloat(e.total_incl_tax||e.total)||0,tax:parseFloat(e.total_tax)||0,shipping:parseFloat(e.shipping_incl_tax||e.shipping)||0,currency:e.currency||"USD",coupon:e.vouchers?.length>0?e.vouchers[0].code:"",...o,items:r}};n(this,oi,Ps).call(this,"purchase",c),s&&(t(this,Wt).add(s),n(this,Il,nm).call(this),t(this,C).debug(`Marked order ${s} as processed, total processed orders: ${t(this,Wt).size}`))}viewItem(e){if(!e){t(this,C).warn("Cannot fire view_item event: No package data provided");return}let i={item_id:e.ref_id||e.external_id||e.id,item_name:e.name,price:parseFloat(e.price)||0,currency:e.currency||t(this,Et).getCampaignData()?.currency||"USD",quantity:1},s={event:"view_item",ecommerce:{currency:i.currency,value:i.price,items:[i]}};n(this,oi,Ps).call(this,"view_item",s)}beginCheckout(){let e=t(this,Et).state.getState("cart");if(!e||!e.items||e.items.length===0){t(this,C).warn("Cannot fire begin_checkout event: No items in cart");return}let i=e.items.map(r=>({item_id:r.external_id||r.id,item_name:r.name,price:parseFloat(r.price)||0,currency:e.totals?.currency||"USD",quantity:r.quantity||1})),s={event:"begin_checkout",ecommerce:{currency:e.totals?.currency||"USD",value:e.totals?.total||0,items:i}};n(this,oi,Ps).call(this,"begin_checkout",s)}fireCustomEvent(e,i={}){if(!e){t(this,C).warn("Cannot fire custom event: No event name provided");return}let s={event:e,...i};t(this,C).debug(`Firing custom event: ${e}`,s),t(this,Y).gtm.enabled&&(window.dataLayer=window.dataLayer||[],window.dataLayer.push(s),t(this,C).debug(`Custom event ${e} fired to Google Tag Manager`)),t(this,Y).fbPixel.enabled&&typeof window.fbq=="function"&&(window.fbq("trackCustom",e,i),t(this,C).debug(`Custom event ${e} fired to Facebook Pixel`)),t(this,Y).ga4.enabled&&typeof window.gtag=="function"&&(window.gtag("event",e,i),t(this,C).debug(`Custom event ${e} fired to Google Analytics 4`));let r=new CustomEvent(`os:${e}`,{bubbles:!0,detail:s});document.dispatchEvent(r)}setPlatformEnabled(e,i){t(this,Y)[e]?(t(this,Y)[e].enabled=i,t(this,C).info(`${e} ${i?"enabled":"disabled"}`)):t(this,C).warn(`Unknown platform: ${e}`)}getPlatformStatus(){return{...t(this,Y)}}disableEvent(e){t(this,Ke).add(e),t(this,C).info(`Event ${e} has been disabled`)}enableEvent(e){t(this,Ke).delete(e),t(this,C).info(`Event ${e} has been enabled`)}getDisabledEvents(){return Array.from(t(this,Ke))}get isInitialized(){return t(this,en)}};Et=new WeakMap,C=new WeakMap,en=new WeakMap,Y=new WeakMap,Tl=new WeakMap,Wt=new WeakMap,$u=new WeakMap,Ke=new WeakMap,Pl=new WeakSet,sm=function(){window.osConfig&&window.osConfig.disabledEvents&&(t(this,Ke).clear(),Array.isArray(window.osConfig.disabledEvents)?window.osConfig.disabledEvents.forEach(e=>{t(this,Ke).add(e)}):typeof window.osConfig.disabledEvents=="object"&&Object.entries(window.osConfig.disabledEvents).forEach(([e,i])=>{i&&t(this,Ke).add(e)}),t(this,Ke).size>0&&t(this,C).info(`Loaded disabled events configuration: ${Array.from(t(this,Ke)).join(", ")}`)),window.osConfig&&window.osConfig.disabledPlatforms&&Object.entries(window.osConfig.disabledPlatforms).forEach(([e,i])=>{i&&t(this,Y)[e]&&(t(this,Y)[e].enabled=!1,t(this,C).info(`Platform ${e} disabled via configuration`))})},Li=new WeakSet,Qr=function(e){if(e.includes(":")){let[i,s]=e.split(":");return t(this,Y)[i]&&!t(this,Y)[i].enabled?!0:t(this,Ke).has(e)}return t(this,Ke).has(e)},Ll=new WeakSet,rm=function(){try{let e=sessionStorage.getItem("os_processed_order_ids");if(e){let i=JSON.parse(e);Array.isArray(i)&&(i.forEach(s=>t(this,Wt).add(s)),t(this,C).debug(`Loaded ${i.length} processed order IDs from sessionStorage`))}}catch(e){t(this,C).error("Error loading processed order IDs from sessionStorage:",e)}},Il=new WeakSet,nm=function(){try{let e=Array.from(t(this,Wt));sessionStorage.setItem("os_processed_order_ids",JSON.stringify(e)),t(this,C).debug(`Saved ${e.length} processed order IDs to sessionStorage`)}catch(e){t(this,C).error("Error saving processed order IDs to sessionStorage:",e)}},ql=new WeakSet,om=function(){typeof window.dataLayer<"u"?(t(this,Y).gtm.enabled=!0,t(this,Y).gtm.initialized=!0,t(this,C).info("Google Tag Manager detected")):t(this,C).info("Google Tag Manager not detected"),typeof window.fbq<"u"?(t(this,Y).fbPixel.enabled=!0,t(this,Y).fbPixel.initialized=!0,t(this,C).info("Facebook Pixel detected")):t(this,C).info("Facebook Pixel not detected"),typeof window.gtag<"u"?(t(this,Y).ga4.enabled=!0,t(this,Y).ga4.initialized=!0,t(this,C).info("Google Analytics 4 detected")):t(this,C).info("Google Analytics 4 not detected")},Ml=new WeakSet,am=function(){let e=[];t(this,Et).on("campaign.loaded",i=>{t(this,C).debug("Campaign loaded event received, triggering viewVisibleItemList"),this.viewVisibleItemList()}),t(this,Et).on("cart.updated",i=>{if(i.cart&&i.cart.items&&i.cart.items.length>0){let s=JSON.stringify(i.cart.items.map(o=>({id:o.id,quantity:o.quantity}))),r=JSON.stringify(e);s!==r?(t(this,C).debug("Cart items changed, firing add_to_cart event"),this.addToCart(i.cart),e=i.cart.items.map(o=>({id:o.id,quantity:o.quantity}))):t(this,C).debug("Cart updated but items unchanged, not firing add_to_cart")}else e=[]}),t(this,Et).on("order.loaded",i=>{t(this,C).debug("Received order.loaded event with data:",JSON.stringify(i,null,2)),i.order?(t(this,C).info("Order loaded on receipt page, checking if purchase event needed"),this.purchase(i.order)):t(this,C).warn("Order.loaded event received but no order data found",i)})},Fl=new WeakSet,cm=function(e){let i={};return e.user&&(e.user.first_name&&(i.firstname=e.user.first_name),e.user.last_name&&(i.lastname=e.user.last_name),e.user.email&&(i.email_hash=n(this,Nl,lm).call(this,e.user.email))),e.shipping_address&&(i.city=e.shipping_address.line4||"",i.state=e.shipping_address.state||"",i.zipcode=e.shipping_address.postcode||"",i.country=e.shipping_address.country||""),i},Nl=new WeakSet,lm=function(e){let i=0;if(e.length===0)return i.toString();for(let s=0;s<e.length;s++){let r=e.charCodeAt(s);i=(i<<5)-i+r,i=i&i}return i.toString()},oi=new WeakSet,Ps=function(e,i){if(n(this,Li,Qr).call(this,e)){t(this,C).info(`Event ${e} is disabled by configuration, not firing`);return}if(t(this,C).debug(`Firing ${e} event`,i),t(this,Y).gtm.enabled&&!n(this,Li,Qr).call(this,`gtm:${e}`)?(window.dataLayer=window.dataLayer||[],t(this,C).debug("Clearing previous ecommerce data in dataLayer"),window.dataLayer.push({ecommerce:null}),`${e}`,window.dataLayer.push(i),t(this,C).debug(`${e} event fired to Google Tag Manager`)):t(this,Y).gtm.enabled?t(this,C).info(`GTM event ${e} is disabled by configuration, not firing to GTM`):(t(this,C).warn(`Cannot fire ${e} event to GTM: GTM not enabled`),window.dataLayer=window.dataLayer||[],window.dataLayer.push({ecommerce:null}),window.dataLayer.push(i)),t(this,Y).fbPixel.enabled&&!n(this,Li,Qr).call(this,`fbPixel:${e}`)){switch(e){case"view_item_list":window.fbq("track","ViewContent",{content_type:"product_group",content_ids:i.ecommerce.items.map(r=>r.item_id),currency:i.ecommerce.currency});break;case"add_to_cart":window.fbq("track","AddToCart",{content_type:"product_group",content_ids:i.ecommerce.items.map(r=>r.item_id),currency:i.ecommerce.currency,value:i.ecommerce.value});break;case"purchase":window.fbq("track","Purchase",{content_type:"product_group",content_ids:i.ecommerce.items.map(r=>r.item_id),currency:i.ecommerce.currency,value:i.ecommerce.value});break}t(this,C).debug(`${e} event fired to Facebook Pixel`)}else t(this,Y).fbPixel.enabled&&t(this,C).info(`Facebook Pixel event ${e} is disabled by configuration, not firing to FB Pixel`);t(this,Y).ga4.enabled&&!n(this,Li,Qr).call(this,`ga4:${e}`)?(window.gtag("event",e,{currency:i.ecommerce.currency,value:i.ecommerce.value,items:i.ecommerce.items}),t(this,C).debug(`${e} event fired to Google Analytics 4`)):t(this,Y).ga4.enabled&&t(this,C).info(`GA4 event ${e} is disabled by configuration, not firing to GA4`);let s=new CustomEvent(`os:${e}`,{bubbles:!0,detail:i});document.dispatchEvent(s)};var Ii=Math.min,ai=Math.max,sn=Math.round;var pt=l=>({x:l,y:l}),Tf={left:"right",right:"left",bottom:"top",top:"bottom"},Pf={start:"end",end:"start"};function Ol(l,e,i){return ai(l,Ii(e,i))}function Ls(l,e){return typeof l=="function"?l(e):l}function ci(l){return l.split("-")[0]}function Is(l){return l.split("-")[1]}function Tu(l){return l==="x"?"y":"x"}function Rl(l){return l==="y"?"height":"width"}function qi(l){return["top","bottom"].includes(ci(l))?"y":"x"}function Dl(l){return Tu(qi(l))}function dm(l,e,i){i===void 0&&(i=!1);let s=Is(l),r=Dl(l),o=Rl(r),c=r==="x"?s===(i?"end":"start")?"right":"left":s==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(c=tn(c)),[c,tn(c)]}function um(l){let e=tn(l);return[Ul(l),e,Ul(e)]}function Ul(l){return l.replace(/start|end/g,e=>Pf[e])}function Lf(l,e,i){let s=["left","right"],r=["right","left"],o=["top","bottom"],c=["bottom","top"];switch(l){case"top":case"bottom":return i?e?r:s:e?s:r;case"left":case"right":return e?o:c;default:return[]}}function hm(l,e,i,s){let r=Is(l),o=Lf(ci(l),i==="start",s);return r&&(o=o.map(c=>c+"-"+r),e&&(o=o.concat(o.map(Ul)))),o}function tn(l){return l.replace(/left|right|bottom|top/g,e=>Tf[e])}function If(l){return{top:0,right:0,bottom:0,left:0,...l}}function Pu(l){return typeof l!="number"?If(l):{top:l,right:l,bottom:l,left:l}}function Mi(l){let{x:e,y:i,width:s,height:r}=l;return{width:s,height:r,top:i,left:e,right:e+s,bottom:i+r,x:e,y:i}}function pm(l,e,i){let{reference:s,floating:r}=l,o=qi(e),c=Dl(e),d=Rl(c),u=ci(e),p=o==="y",g=s.x+s.width/2-r.width/2,m=s.y+s.height/2-r.height/2,v=s[d]/2-r[d]/2,y;switch(u){case"top":y={x:g,y:s.y-r.height};break;case"bottom":y={x:g,y:s.y+s.height};break;case"right":y={x:s.x+s.width,y:m};break;case"left":y={x:s.x-r.width,y:m};break;default:y={x:s.x,y:s.y}}switch(Is(e)){case"start":y[c]-=v*(i&&p?-1:1);break;case"end":y[c]+=v*(i&&p?-1:1);break}return y}var gm=async(l,e,i)=>{let{placement:s="bottom",strategy:r="absolute",middleware:o=[],platform:c}=i,d=o.filter(Boolean),u=await(c.isRTL==null?void 0:c.isRTL(e)),p=await c.getElementRects({reference:l,floating:e,strategy:r}),{x:g,y:m}=pm(p,s,u),v=s,y={},k=0;for(let _=0;_<d.length;_++){let{name:T,fn:P}=d[_],{x:q,y:L,data:j,reset:G}=await P({x:g,y:m,initialPlacement:s,placement:v,strategy:r,middlewareData:y,rects:p,platform:c,elements:{reference:l,floating:e}});g=q??g,m=L??m,y={...y,[T]:{...y[T],...j}},G&&k<=50&&(k++,typeof G=="object"&&(G.placement&&(v=G.placement),G.rects&&(p=G.rects===!0?await c.getElementRects({reference:l,floating:e,strategy:r}):G.rects),{x:g,y:m}=pm(p,v,u)),_=-1)}return{x:g,y:m,placement:v,strategy:r,middlewareData:y}};async function Lu(l,e){var i;e===void 0&&(e={});let{x:s,y:r,platform:o,rects:c,elements:d,strategy:u}=l,{boundary:p="clippingAncestors",rootBoundary:g="viewport",elementContext:m="floating",altBoundary:v=!1,padding:y=0}=Ls(e,l),k=Pu(y),T=d[v?m==="floating"?"reference":"floating":m],P=Mi(await o.getClippingRect({element:(i=await(o.isElement==null?void 0:o.isElement(T)))==null||i?T:T.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(d.floating)),boundary:p,rootBoundary:g,strategy:u})),q=m==="floating"?{x:s,y:r,width:c.floating.width,height:c.floating.height}:c.reference,L=await(o.getOffsetParent==null?void 0:o.getOffsetParent(d.floating)),j=await(o.isElement==null?void 0:o.isElement(L))?await(o.getScale==null?void 0:o.getScale(L))||{x:1,y:1}:{x:1,y:1},G=Mi(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:d,rect:q,offsetParent:L,strategy:u}):q);return{top:(P.top-G.top+k.top)/j.y,bottom:(G.bottom-P.bottom+k.bottom)/j.y,left:(P.left-G.left+k.left)/j.x,right:(G.right-P.right+k.right)/j.x}}var mm=l=>({name:"arrow",options:l,async fn(e){let{x:i,y:s,placement:r,rects:o,platform:c,elements:d,middlewareData:u}=e,{element:p,padding:g=0}=Ls(l,e)||{};if(p==null)return{};let m=Pu(g),v={x:i,y:s},y=Dl(r),k=Rl(y),_=await c.getDimensions(p),T=y==="y",P=T?"top":"left",q=T?"bottom":"right",L=T?"clientHeight":"clientWidth",j=o.reference[k]+o.reference[y]-v[y]-o.floating[k],G=v[y]-o.reference[y],ce=await(c.getOffsetParent==null?void 0:c.getOffsetParent(p)),Re=ce?ce[L]:0;(!Re||!await(c.isElement==null?void 0:c.isElement(ce)))&&(Re=d.floating[L]||o.floating[k]);let Bs=j/2-G/2,di=Re/2-_[k]/2-1,Vt=Ii(m[P],di),Vs=Ii(m[q],di),ui=Vt,Hs=Re-_[k]-Vs,$e=Re/2-_[k]/2+Bs,zi=Ol(ui,$e,Hs),kt=!u.arrow&&Is(r)!=null&&$e!==zi&&o.reference[k]/2-($e<ui?Vt:Vs)-_[k]/2<0,ft=kt?$e<ui?$e-ui:$e-Hs:0;return{[y]:v[y]+ft,data:{[y]:zi,centerOffset:$e-zi-ft,...kt&&{alignmentOffset:ft}},reset:kt}}});var fm=function(l){return l===void 0&&(l={}),{name:"flip",options:l,async fn(e){var i,s;let{placement:r,middlewareData:o,rects:c,initialPlacement:d,platform:u,elements:p}=e,{mainAxis:g=!0,crossAxis:m=!0,fallbackPlacements:v,fallbackStrategy:y="bestFit",fallbackAxisSideDirection:k="none",flipAlignment:_=!0,...T}=Ls(l,e);if((i=o.arrow)!=null&&i.alignmentOffset)return{};let P=ci(r),q=qi(d),L=ci(d)===d,j=await(u.isRTL==null?void 0:u.isRTL(p.floating)),G=v||(L||!_?[tn(d)]:um(d)),ce=k!=="none";!v&&ce&&G.push(...hm(d,_,k,j));let Re=[d,...G],Bs=await Lu(e,T),di=[],Vt=((s=o.flip)==null?void 0:s.overflows)||[];if(g&&di.push(Bs[P]),m){let $e=dm(r,c,j);di.push(Bs[$e[0]],Bs[$e[1]])}if(Vt=[...Vt,{placement:r,overflows:di}],!di.every($e=>$e<=0)){var Vs,ui;let $e=(((Vs=o.flip)==null?void 0:Vs.index)||0)+1,zi=Re[$e];if(zi)return{data:{index:$e,overflows:Vt},reset:{placement:zi}};let kt=(ui=Vt.filter(ft=>ft.overflows[0]<=0).sort((ft,Ht)=>ft.overflows[1]-Ht.overflows[1])[0])==null?void 0:ui.placement;if(!kt)switch(y){case"bestFit":{var Hs;let ft=(Hs=Vt.filter(Ht=>{if(ce){let jt=qi(Ht.placement);return jt===q||jt==="y"}return!0}).map(Ht=>[Ht.placement,Ht.overflows.filter(jt=>jt>0).reduce((jt,yf)=>jt+yf,0)]).sort((Ht,jt)=>Ht[1]-jt[1])[0])==null?void 0:Hs[0];ft&&(kt=ft);break}case"initialPlacement":kt=d;break}if(r!==kt)return{reset:{placement:kt}}}return{}}}};async function qf(l,e){let{placement:i,platform:s,elements:r}=l,o=await(s.isRTL==null?void 0:s.isRTL(r.floating)),c=ci(i),d=Is(i),u=qi(i)==="y",p=["left","top"].includes(c)?-1:1,g=o&&u?-1:1,m=Ls(e,l),{mainAxis:v,crossAxis:y,alignmentAxis:k}=typeof m=="number"?{mainAxis:m,crossAxis:0,alignmentAxis:null}:{mainAxis:m.mainAxis||0,crossAxis:m.crossAxis||0,alignmentAxis:m.alignmentAxis};return d&&typeof k=="number"&&(y=d==="end"?k*-1:k),u?{x:y*g,y:v*p}:{x:v*p,y:y*g}}var ym=function(l){return l===void 0&&(l=0),{name:"offset",options:l,async fn(e){var i,s;let{x:r,y:o,placement:c,middlewareData:d}=e,u=await qf(e,l);return c===((i=d.offset)==null?void 0:i.placement)&&(s=d.arrow)!=null&&s.alignmentOffset?{}:{x:r+u.x,y:o+u.y,data:{...u,placement:c}}}}},bm=function(l){return l===void 0&&(l={}),{name:"shift",options:l,async fn(e){let{x:i,y:s,placement:r}=e,{mainAxis:o=!0,crossAxis:c=!1,limiter:d={fn:T=>{let{x:P,y:q}=T;return{x:P,y:q}}},...u}=Ls(l,e),p={x:i,y:s},g=await Lu(e,u),m=qi(ci(r)),v=Tu(m),y=p[v],k=p[m];if(o){let T=v==="y"?"top":"left",P=v==="y"?"bottom":"right",q=y+g[T],L=y-g[P];y=Ol(q,y,L)}if(c){let T=m==="y"?"top":"left",P=m==="y"?"bottom":"right",q=k+g[T],L=k-g[P];k=Ol(q,k,L)}let _=d.fn({...e,[v]:y,[m]:k});return{..._,data:{x:_.x-i,y:_.y-s,enabled:{[v]:o,[m]:c}}}}}};function Wl(){return typeof window<"u"}function Fi(l){return wm(l)?(l.nodeName||"").toLowerCase():"#document"}function Ue(l){var e;return(l==null||(e=l.ownerDocument)==null?void 0:e.defaultView)||window}function At(l){var e;return(e=(wm(l)?l.ownerDocument:l.document)||window.document)==null?void 0:e.documentElement}function wm(l){return Wl()?l instanceof Node||l instanceof Ue(l).Node:!1}function et(l){return Wl()?l instanceof Element||l instanceof Ue(l).Element:!1}function gt(l){return Wl()?l instanceof HTMLElement||l instanceof Ue(l).HTMLElement:!1}function vm(l){return!Wl()||typeof ShadowRoot>"u"?!1:l instanceof ShadowRoot||l instanceof Ue(l).ShadowRoot}function qs(l){let{overflow:e,overflowX:i,overflowY:s,display:r}=tt(l);return/auto|scroll|overlay|hidden|clip/.test(e+s+i)&&!["inline","contents"].includes(r)}function Sm(l){return["table","td","th"].includes(Fi(l))}function rn(l){return[":popover-open",":modal"].some(e=>{try{return l.matches(e)}catch{return!1}})}function Bl(l){let e=Vl(),i=et(l)?tt(l):l;return["transform","translate","scale","rotate","perspective"].some(s=>i[s]?i[s]!=="none":!1)||(i.containerType?i.containerType!=="normal":!1)||!e&&(i.backdropFilter?i.backdropFilter!=="none":!1)||!e&&(i.filter?i.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(s=>(i.willChange||"").includes(s))||["paint","layout","strict","content"].some(s=>(i.contain||"").includes(s))}function _m(l){let e=Bt(l);for(;gt(e)&&!Ni(e);){if(Bl(e))return e;if(rn(e))return null;e=Bt(e)}return null}function Vl(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Ni(l){return["html","body","#document"].includes(Fi(l))}function tt(l){return Ue(l).getComputedStyle(l)}function nn(l){return et(l)?{scrollLeft:l.scrollLeft,scrollTop:l.scrollTop}:{scrollLeft:l.scrollX,scrollTop:l.scrollY}}function Bt(l){if(Fi(l)==="html")return l;let e=l.assignedSlot||l.parentNode||vm(l)&&l.host||At(l);return vm(e)?e.host:e}function Cm(l){let e=Bt(l);return Ni(e)?l.ownerDocument?l.ownerDocument.body:l.body:gt(e)&&qs(e)?e:Cm(e)}function zl(l,e,i){var s;e===void 0&&(e=[]),i===void 0&&(i=!0);let r=Cm(l),o=r===((s=l.ownerDocument)==null?void 0:s.body),c=Ue(r);if(o){let d=Hl(c);return e.concat(c,c.visualViewport||[],qs(r)?r:[],d&&i?zl(d):[])}return e.concat(r,zl(r,[],i))}function Hl(l){return l.parent&&Object.getPrototypeOf(l.parent)?l.frameElement:null}function Am(l){let e=tt(l),i=parseFloat(e.width)||0,s=parseFloat(e.height)||0,r=gt(l),o=r?l.offsetWidth:i,c=r?l.offsetHeight:s,d=sn(i)!==o||sn(s)!==c;return d&&(i=o,s=c),{width:i,height:s,$:d}}function km(l){return et(l)?l:l.contextElement}function Ms(l){let e=km(l);if(!gt(e))return pt(1);let i=e.getBoundingClientRect(),{width:s,height:r,$:o}=Am(e),c=(o?sn(i.width):i.width)/s,d=(o?sn(i.height):i.height)/r;return(!c||!Number.isFinite(c))&&(c=1),(!d||!Number.isFinite(d))&&(d=1),{x:c,y:d}}var Mf=pt(0);function $m(l){let e=Ue(l);return!Vl()||!e.visualViewport?Mf:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Ff(l,e,i){return e===void 0&&(e=!1),!i||e&&i!==Ue(l)?!1:e}function on(l,e,i,s){e===void 0&&(e=!1),i===void 0&&(i=!1);let r=l.getBoundingClientRect(),o=km(l),c=pt(1);e&&(s?et(s)&&(c=Ms(s)):c=Ms(l));let d=Ff(o,i,s)?$m(o):pt(0),u=(r.left+d.x)/c.x,p=(r.top+d.y)/c.y,g=r.width/c.x,m=r.height/c.y;if(o){let v=Ue(o),y=s&&et(s)?Ue(s):s,k=v,_=Hl(k);for(;_&&s&&y!==k;){let T=Ms(_),P=_.getBoundingClientRect(),q=tt(_),L=P.left+(_.clientLeft+parseFloat(q.paddingLeft))*T.x,j=P.top+(_.clientTop+parseFloat(q.paddingTop))*T.y;u*=T.x,p*=T.y,g*=T.x,m*=T.y,u+=L,p+=j,k=Ue(_),_=Hl(k)}}return Mi({width:g,height:m,x:u,y:p})}function qu(l,e){let i=nn(l).scrollLeft;return e?e.left+i:on(At(l)).left+i}function Tm(l,e,i){i===void 0&&(i=!1);let s=l.getBoundingClientRect(),r=s.left+e.scrollLeft-(i?0:qu(l,s)),o=s.top+e.scrollTop;return{x:r,y:o}}function Nf(l){let{elements:e,rect:i,offsetParent:s,strategy:r}=l,o=r==="fixed",c=At(s),d=e?rn(e.floating):!1;if(s===c||d&&o)return i;let u={scrollLeft:0,scrollTop:0},p=pt(1),g=pt(0),m=gt(s);if((m||!m&&!o)&&((Fi(s)!=="body"||qs(c))&&(u=nn(s)),gt(s))){let y=on(s);p=Ms(s),g.x=y.x+s.clientLeft,g.y=y.y+s.clientTop}let v=c&&!m&&!o?Tm(c,u,!0):pt(0);return{width:i.width*p.x,height:i.height*p.y,x:i.x*p.x-u.scrollLeft*p.x+g.x+v.x,y:i.y*p.y-u.scrollTop*p.y+g.y+v.y}}function Uf(l){return Array.from(l.getClientRects())}function Of(l){let e=At(l),i=nn(l),s=l.ownerDocument.body,r=ai(e.scrollWidth,e.clientWidth,s.scrollWidth,s.clientWidth),o=ai(e.scrollHeight,e.clientHeight,s.scrollHeight,s.clientHeight),c=-i.scrollLeft+qu(l),d=-i.scrollTop;return tt(s).direction==="rtl"&&(c+=ai(e.clientWidth,s.clientWidth)-r),{width:r,height:o,x:c,y:d}}function Rf(l,e){let i=Ue(l),s=At(l),r=i.visualViewport,o=s.clientWidth,c=s.clientHeight,d=0,u=0;if(r){o=r.width,c=r.height;let p=Vl();(!p||p&&e==="fixed")&&(d=r.offsetLeft,u=r.offsetTop)}return{width:o,height:c,x:d,y:u}}function Df(l,e){let i=on(l,!0,e==="fixed"),s=i.top+l.clientTop,r=i.left+l.clientLeft,o=gt(l)?Ms(l):pt(1),c=l.clientWidth*o.x,d=l.clientHeight*o.y,u=r*o.x,p=s*o.y;return{width:c,height:d,x:u,y:p}}function xm(l,e,i){let s;if(e==="viewport")s=Rf(l,i);else if(e==="document")s=Of(At(l));else if(et(e))s=Df(e,i);else{let r=$m(l);s={x:e.x-r.x,y:e.y-r.y,width:e.width,height:e.height}}return Mi(s)}function Pm(l,e){let i=Bt(l);return i===e||!et(i)||Ni(i)?!1:tt(i).position==="fixed"||Pm(i,e)}function zf(l,e){let i=e.get(l);if(i)return i;let s=zl(l,[],!1).filter(d=>et(d)&&Fi(d)!=="body"),r=null,o=tt(l).position==="fixed",c=o?Bt(l):l;for(;et(c)&&!Ni(c);){let d=tt(c),u=Bl(c);!u&&d.position==="fixed"&&(r=null),(o?!u&&!r:!u&&d.position==="static"&&!!r&&["absolute","fixed"].includes(r.position)||qs(c)&&!u&&Pm(l,c))?s=s.filter(g=>g!==c):r=d,c=Bt(c)}return e.set(l,s),s}function Wf(l){let{element:e,boundary:i,rootBoundary:s,strategy:r}=l,c=[...i==="clippingAncestors"?rn(e)?[]:zf(e,this._c):[].concat(i),s],d=c[0],u=c.reduce((p,g)=>{let m=xm(e,g,r);return p.top=ai(m.top,p.top),p.right=Ii(m.right,p.right),p.bottom=Ii(m.bottom,p.bottom),p.left=ai(m.left,p.left),p},xm(e,d,r));return{width:u.right-u.left,height:u.bottom-u.top,x:u.left,y:u.top}}function Bf(l){let{width:e,height:i}=Am(l);return{width:e,height:i}}function Vf(l,e,i){let s=gt(e),r=At(e),o=i==="fixed",c=on(l,!0,o,e),d={scrollLeft:0,scrollTop:0},u=pt(0);if(s||!s&&!o)if((Fi(e)!=="body"||qs(r))&&(d=nn(e)),s){let v=on(e,!0,o,e);u.x=v.x+e.clientLeft,u.y=v.y+e.clientTop}else r&&(u.x=qu(r));let p=r&&!s&&!o?Tm(r,d):pt(0),g=c.left+d.scrollLeft-u.x-p.x,m=c.top+d.scrollTop-u.y-p.y;return{x:g,y:m,width:c.width,height:c.height}}function Iu(l){return tt(l).position==="static"}function Em(l,e){if(!gt(l)||tt(l).position==="fixed")return null;if(e)return e(l);let i=l.offsetParent;return At(l)===i&&(i=i.ownerDocument.body),i}function Lm(l,e){let i=Ue(l);if(rn(l))return i;if(!gt(l)){let r=Bt(l);for(;r&&!Ni(r);){if(et(r)&&!Iu(r))return r;r=Bt(r)}return i}let s=Em(l,e);for(;s&&Sm(s)&&Iu(s);)s=Em(s,e);return s&&Ni(s)&&Iu(s)&&!Bl(s)?i:s||_m(l)||i}var Hf=async function(l){let e=this.getOffsetParent||Lm,i=this.getDimensions,s=await i(l.floating);return{reference:Vf(l.reference,await e(l.floating),l.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function jf(l){return tt(l).direction==="rtl"}var Gf={convertOffsetParentRelativeRectToViewportRelativeRect:Nf,getDocumentElement:At,getClippingRect:Wf,getOffsetParent:Lm,getElementRects:Hf,getClientRects:Uf,getDimensions:Bf,getScale:Ms,isElement:et,isRTL:jf};var Im=ym;var qm=bm,Mm=fm;var Fm=mm;var Nm=(l,e,i)=>{let s=new Map,r={platform:Gf,...i},o={...r.platform,_c:s};return gm(l,e,{...r,platform:o})};var Kl,Ui,Oe,Fs,an,Ns,Us,cn,Os,Jl,Um,Yl,Om,Zl,Rm,ln,Mu,Rs,jl,Gl=class{constructor(e){a(this,Jl);a(this,Yl);a(this,Zl);a(this,ln);a(this,Rs);a(this,Kl,void 0);a(this,Ui,void 0);a(this,Oe,void 0);a(this,Fs,void 0);a(this,an,void 0);a(this,Ns,null);a(this,Us,null);a(this,cn,null);a(this,Os,!1);h(this,Kl,e),h(this,Ui,e.logger.createModuleLogger("TOOLTIP")),n(this,Jl,Um).call(this),t(this,Ui).info("TooltipManager initialized")}};Kl=new WeakMap,Ui=new WeakMap,Oe=new WeakMap,Fs=new WeakMap,an=new WeakMap,Ns=new WeakMap,Us=new WeakMap,cn=new WeakMap,Os=new WeakMap,Jl=new WeakSet,Um=function(){t(this,Os)||(h(this,Oe,n(this,Yl,Om).call(this)),h(this,Fs,t(this,Oe).querySelector("#checkout-tooltip-arrow")),h(this,an,t(this,Oe).querySelector("#checkout-tooltip-text")),n(this,Zl,Rm).call(this),h(this,Os,!0),t(this,Ui).info("Tooltip system initialized with floating-ui"))},Yl=new WeakSet,Om=function(){let e=document.getElementById("checkout-tooltip");if(e)return e;let i=document.createElement("div");i.setAttribute("role","tooltip"),i.id="checkout-tooltip",i.style.display="none";let s=document.createElement("div");s.id="checkout-tooltip-text",i.appendChild(s);let r=document.createElement("div");return r.id="checkout-tooltip-arrow",i.appendChild(r),document.body.appendChild(i),i},Zl=new WeakSet,Rm=function(){document.addEventListener("mouseover",e=>{let i=e.target.closest("[data-os-tooltip]");i&&(clearTimeout(t(this,Us)),h(this,Us,setTimeout(()=>{n(this,ln,Mu).call(this,i)},200)))}),document.addEventListener("mouseout",e=>{e.target.closest("[data-os-tooltip]")&&(clearTimeout(t(this,Us)),n(this,Rs,jl).call(this))}),document.addEventListener("focus",e=>{let i=e.target.closest("[data-os-tooltip]");i&&n(this,ln,Mu).call(this,i)},!0),document.addEventListener("blur",e=>{e.target.closest("[data-os-tooltip]")&&n(this,Rs,jl).call(this)},!0),document.addEventListener("keydown",e=>{e.key==="Escape"&&t(this,Ns)&&n(this,Rs,jl).call(this)})},ln=new WeakSet,Mu=function(e){if(!t(this,Os)){t(this,Ui).warn("Cannot show tooltip: system not initialized");return}clearTimeout(t(this,cn)),h(this,Ns,e);let i=e.getAttribute("data-os-tooltip"),s=e.getAttribute("data-os-tooltip-position")||"top";t(this,an).textContent=i,t(this,Oe).style.display="block",Nm(e,t(this,Oe),{placement:s,middleware:[Im(8),Mm({fallbackPlacements:["top","right","bottom","left"]}),qm({padding:5}),Fm({element:t(this,Fs)})]}).then(({x:r,y:o,placement:c,middlewareData:d})=>{Object.assign(t(this,Oe).style,{left:`${r}px`,top:`${o}px`});let{x:u,y:p}=d.arrow,g={top:"bottom",right:"left",bottom:"top",left:"right"}[c.split("-")[0]];Object.assign(t(this,Fs).style,{left:u!=null?`${u}px`:"",top:p!=null?`${p}px`:"",right:"",bottom:"",[g]:"-4px"}),requestAnimationFrame(()=>{t(this,Oe).classList.add("checkout-tooltip-visible")})})},Rs=new WeakSet,jl=function(){t(this,Oe)&&(t(this,Oe).classList.remove("checkout-tooltip-visible"),h(this,cn,setTimeout(()=>{t(this,Oe).classList.contains("checkout-tooltip-visible")||(t(this,Oe).style.display="none"),h(this,Ns,null)},200)))};Fu();var un,V,hn,pn,it,mt,Xl,Dm,Ql,zm,ed,Wm,td,Bm,id,Vm,gn,Nu,sd,Hm,mn,Uu,rd,jm,dn=class{constructor(e){a(this,Xl);a(this,Ql);a(this,ed);a(this,td);a(this,id);a(this,gn);a(this,sd);a(this,mn);a(this,rd);a(this,un,void 0);a(this,V,void 0);a(this,hn,void 0);a(this,pn,void 0);a(this,it,{});a(this,mt,null);h(this,un,e),h(this,V,e.logger.createModuleLogger("UPSELL")),h(this,hn,e.state),h(this,pn,e.api),n(this,Xl,Dm).call(this),t(this,V).info("UpsellManager initialized")}async acceptUpsell(e,i,s){if(!t(this,mt)){t(this,V).error("Cannot accept upsell: No order reference ID found");return}if(!Array.isArray(e)||!Array.isArray(i)){t(this,V).error("packageIds and quantities must be arrays");return}if(e.length===0||e.length!==i.length){t(this,V).error("Invalid packageIds or quantities arrays");return}t(this,V).info(`Accepting upsell: Packages ${e.join(", ")}, Quantities ${i.join(", ")}`),n(this,gn,Nu).call(this);try{document.body.classList.add("os-loading");let r={lines:e.map((c,d)=>({package_id:Number(c),quantity:Number(i[d]),is_upsell:!0}))},o=await t(this,pn).createOrderUpsell(t(this,mt),r);t(this,V).info("Upsell successfully added to order",o),n(this,id,Vm).call(this,o,e,i),n(this,mn,Uu).call(this,s)}catch(r){t(this,V).error("Error accepting upsell:",r),document.body.classList.remove("os-loading"),n(this,sd,Hm).call(this),n(this,rd,jm).call(this,"There was an error processing your upsell. Please try again.")}}declineUpsell(e){t(this,V).info("Declining upsell offer"),n(this,gn,Nu).call(this),n(this,mn,Uu).call(this,e)}};un=new WeakMap,V=new WeakMap,hn=new WeakMap,pn=new WeakMap,it=new WeakMap,mt=new WeakMap,Xl=new WeakSet,Dm=function(){h(this,mt,n(this,Ql,zm).call(this)),t(this,mt)?(t(this,V).info(`Order reference ID found: ${t(this,mt)}`),t(this,hn).setState("order.ref_id",t(this,mt))):t(this,V).warn("No order reference ID found, upsell functionality will be limited"),n(this,ed,Wm).call(this),n(this,td,Bm).call(this)},Ql=new WeakSet,zm=function(){let i=new URLSearchParams(window.location.search).get("ref_id");return i?(t(this,V).debug("Getting order ref_id from URL parameters:",i),sessionStorage.setItem("order_ref_id",i)):(i=sessionStorage.getItem("order_ref_id"),t(this,V).debug("Getting order ref_id from sessionStorage:",i)),i},ed=new WeakSet,Wm=function(){h(this,it,{acceptButtons:document.querySelectorAll('[data-os-upsell="accept"]'),declineButtons:document.querySelectorAll('[data-os-upsell="decline"]')}),t(this,V).debug(`Found ${t(this,it).acceptButtons.length} accept buttons and ${t(this,it).declineButtons.length} decline buttons`)},td=new WeakSet,Bm=function(){t(this,it).acceptButtons.forEach(e=>{e.addEventListener("click",i=>{i.preventDefault();let s=e.getAttribute("data-os-package-ids"),r=e.getAttribute("data-os-quantities");if(s){let o=s.split(",").map(u=>u.trim()),c=r?r.split(",").map(u=>parseInt(u.trim(),10)):o.map(()=>1);if(o.length!==c.length){t(this,V).error("Mismatch between package IDs and quantities count");return}let d=e.getAttribute("data-os-next-url");this.acceptUpsell(o,c,d)}else{let o=e.getAttribute("data-os-package-id"),c=parseInt(e.getAttribute("data-os-quantity")||"1",10),d=e.getAttribute("data-os-next-url");if(!o){t(this,V).error("No package ID specified for upsell accept button");return}this.acceptUpsell([o],[c],d)}})}),t(this,it).declineButtons.forEach(e=>{e.addEventListener("click",i=>{i.preventDefault();let s=e.getAttribute("data-os-next-url");s?this.declineUpsell(s):t(this,V).error("No next URL specified for upsell decline button")})})},id=new WeakSet,Vm=function(e,i,s){try{let r=t(this,un).getCampaignData();if(!r||!r.packages){t(this,V).warn("Campaign data not available for upsell tracking");return}let o=[],c=0;if(i.forEach((u,p)=>{let g=r.packages.find(m=>m.ref_id.toString()===u.toString()||m.external_id?.toString()===u.toString());if(g){let m=s[p],v=parseFloat(g.price),y=v*m;c+=y,o.push({product_id:g.external_id||g.ref_id,product_title:g.name,price:v,quantity:m,is_upsell:!0})}else t(this,V).warn(`Package data not found for upsell tracking: ${u}`)}),o.length===0){t(this,V).warn("No valid packages found for upsell tracking");return}let d={number:e.number||e.ref_id,ref_id:e.ref_id,total:c,currency:r.currency||"USD",lines:o};sessionStorage.setItem("pending_upsell_purchase","true"),sessionStorage.setItem("upsell_purchase_data",JSON.stringify(d)),t(this,V).info("Stored upsell purchase data for tracking on next page load",d)}catch(r){t(this,V).error("Error storing upsell purchase data:",r)}},gn=new WeakSet,Nu=function(){t(this,V).debug("Disabling upsell buttons"),t(this,it).acceptButtons.forEach(e=>{e.style.pointerEvents="none",e.classList.add("os-button-disabled")}),t(this,it).declineButtons.forEach(e=>{e.style.pointerEvents="none",e.classList.add("os-button-disabled")})},sd=new WeakSet,Hm=function(){t(this,V).debug("Re-enabling upsell buttons"),t(this,it).acceptButtons.forEach(e=>{e.style.pointerEvents="",e.classList.remove("os-button-disabled")}),t(this,it).declineButtons.forEach(e=>{e.style.pointerEvents="",e.classList.remove("os-button-disabled")})},mn=new WeakSet,Uu=function(e){if(!e){t(this,V).warn("No URL provided for redirect");return}let i=new URL(e,window.location.origin);t(this,mt)&&!i.searchParams.has("ref_id")&&i.searchParams.append("ref_id",t(this,mt));let s=new URLSearchParams(window.location.search);s.has("debug")&&s.get("debug")==="true"&&!i.searchParams.has("debug")&&i.searchParams.append("debug","true"),t(this,V).info(`Redirecting to ${i.href}`),window.location.href=i.href},rd=new WeakSet,jm=function(e){let i=document.querySelector("[data-os-error-container]");i?(i.textContent=e,i.style.display="block"):alert(e)};var od,_e,nd=class{constructor(e){a(this,od,void 0);a(this,_e,void 0);h(this,od,e),h(this,_e,e.logger.createModuleLogger("DISCOUNT")),t(this,_e).info("DiscountManager initialized")}calculateDiscount(e,i,s=[]){if(!e||!e.code)return t(this,_e).debug("[DM.calculateDiscount] No coupon details or code provided. Returning 0."),0;t(this,_e).debugWithTime(`[DM.calculateDiscount] Start. Coupon: "${e.code}", type: ${e.type}, value: ${e.value}, originalSubtotal: ${i}, itemCount: ${s.length}`);let r=i,o="";if(e.applicable_product_ids&&Array.isArray(e.applicable_product_ids)&&e.applicable_product_ids.length>0){t(this,_e).debugWithTime(`[DM.calculateDiscount] Coupon "${e.code}" is product-specific. Applicable IDs: ${e.applicable_product_ids.join(", ")}. Cart items for check: ${JSON.stringify(s.map(u=>({id:u.id,pkgId:u.package_id})))}`);let d=s.filter(u=>e.applicable_product_ids.includes(u.package_id?.toString())||e.applicable_product_ids.includes(u.id?.toString()));if(t(this,_e).debugWithTime(`[DM.calculateDiscount] Found ${d.length} applicable items for coupon "${e.code}".`),d.length===0)return t(this,_e).info(`[DM.calculateDiscount] Coupon "${e.code}" requires specific products not found in cart. No discount applied.`),0;r=d.reduce((u,p)=>u+(p.price_total??p.price*(p.quantity||1)),0),o=` on applicable items (subtotal: ${r.toFixed(2)})`,t(this,_e).debugWithTime(`[DM.calculateDiscount] Subtotal of applicable items for "${e.code}": ${r}`)}else t(this,_e).debugWithTime(`[DM.calculateDiscount] Coupon "${e.code}" is not product-specific or no cartItems provided/needed for check.`);let c=0;switch(e.type){case"percentage":c=r*(e.value/100),t(this,_e).debug(`Applied ${e.value}% discount${o}: -${c.toFixed(2)}`);break;case"fixed":c=Math.min(r,e.value),t(this,_e).debug(`Applied fixed discount${o}: -${c.toFixed(2)}`);break;case"free_shipping":t(this,_e).debug("Applied free shipping discount (handled in shipping calculation)");break;default:t(this,_e).warn(`Unknown discount type: ${e.type}`);break}return t(this,_e).debugWithTime(`[DM.calculateDiscount] Coupon "${e.code}" calculated discountAmount: ${c.toFixed(2)}${o}. Returning this value.`),c}validateCoupon(e,i){return!0}getCouponDisplayText(e){if(!e||!e.code)return"";switch(e.type){case"percentage":return`${e.code} (${e.value}% off)`;case"fixed":return`${e.code} ($${e.value} off)`;case"free_shipping":return`${e.code} (Free shipping)`;default:return e.code}}};od=new WeakMap,_e=new WeakMap;var Ou=class{constructor(){this.cleanupInitialState(),this.init()}cleanupInitialState(){document.querySelectorAll('[pb-component="accordion"]').forEach(e=>{let i=e.querySelector('[pb-accordion-element="group"]');if(!i)return;let s=i.querySelectorAll('[pb-accordion-element="accordion"]');s.forEach(o=>{let c=o.querySelector('[pb-accordion-element="content"]'),d=o.querySelector('[pb-accordion-element="trigger"]'),u=o.querySelector('[pb-accordion-element="arrow"]'),p=o.querySelector('[pb-accordion-element="plus"]');c&&(c.style.maxHeight="0",c.style.opacity="0",c.style.visibility="hidden",c.style.display="none"),d&&d.setAttribute("aria-expanded","false"),o.classList.remove("is-active-accordion"),c?.classList.remove("is-active-accordion"),u&&u.classList.remove("is-active-accordion"),p&&p.classList.remove("is-active-accordion")});let r=i.getAttribute("pb-accordion-initial");if(r&&r!=="none"){let o=s[parseInt(r)-1];o&&this.openAccordion(o)}})}init(){document.querySelectorAll('[pb-component="accordion"]').forEach(e=>{let i=e.querySelector('[pb-accordion-element="group"]');i&&i.addEventListener("click",s=>this.handleClick(s,i))})}handleClick(e,i){let s=e.target.closest('[pb-accordion-element="accordion"]');if(!s)return;let r=s.classList.contains("is-active-accordion");i.getAttribute("pb-accordion-single")==="true"&&i.querySelectorAll('[pb-accordion-element="accordion"]').forEach(c=>{c!==s&&c.classList.contains("is-active-accordion")&&this.closeAccordion(c)}),r?this.closeAccordion(s):this.openAccordion(s)}openAccordion(e){let i=e.querySelector('[pb-accordion-element="trigger"]'),s=e.querySelector('[pb-accordion-element="content"]'),r=e.querySelector('[pb-accordion-element="arrow"]'),o=e.querySelector('[pb-accordion-element="plus"]');s.style.visibility="visible",s.style.display="block",s.offsetHeight;let c=s.scrollHeight;requestAnimationFrame(()=>{s.style.maxHeight=`${c}px`,s.style.opacity="1",i.setAttribute("aria-expanded","true"),e.classList.add("is-active-accordion"),s.classList.add("is-active-accordion"),r&&r.classList.add("is-active-accordion"),o&&o.classList.add("is-active-accordion")}),s.addEventListener("transitionend",()=>{e.classList.contains("is-active-accordion")&&(s.style.maxHeight="none")},{once:!0})}closeAccordion(e){let i=e.querySelector('[pb-accordion-element="trigger"]'),s=e.querySelector('[pb-accordion-element="content"]'),r=e.querySelector('[pb-accordion-element="arrow"]'),o=e.querySelector('[pb-accordion-element="plus"]');s.style.maxHeight=`${s.scrollHeight}px`,s.style.display="block",s.offsetHeight,requestAnimationFrame(()=>{s.style.maxHeight="0",s.style.opacity="0",i.setAttribute("aria-expanded","false"),e.classList.remove("is-active-accordion"),s.classList.remove("is-active-accordion"),r&&r.classList.remove("is-active-accordion"),o&&o.classList.remove("is-active-accordion")}),s.addEventListener("transitionend",()=>{e.classList.contains("is-active-accordion")||(s.style.visibility="hidden",s.style.display="none")},{once:!0})}},Gm=()=>document.querySelector('[pb-component="accordion"]')?new Ou:null;var Ru=class{constructor(){this.config={enabled:!0,applyToExternalLinks:!1,excludedDomains:[],paramsToCopy:[]},this.loadConfig()}loadConfig(){window.osConfig&&window.osConfig.utmTransfer&&(this.config={...this.config,...window.osConfig.utmTransfer}),(this.config.paramsToCopy===null||this.config.paramsToCopy===void 0)&&(this.config.paramsToCopy=[]),JSON.stringify(this.config)}init(){if(!this.config.enabled)return;let e=new URLSearchParams(window.location.search);if(e.toString()==="")return;let i=[];e.forEach((o,c)=>{i.push(`${c}=${o}`)}),`${i.join(", ")}`;let s=e;if(Array.isArray(this.config.paramsToCopy)&&this.config.paramsToCopy.length>0&&(`${this.config.paramsToCopy.join(", ")}`,s=new URLSearchParams,this.config.paramsToCopy.forEach(o=>{e.has(o)&&(s.append(o,e.get(o)),`${o}${e.get(o)}`)}),s.toString()===""))return;let r=document.querySelectorAll("a");`${r.length}`,r.forEach(o=>{o.addEventListener("click",c=>{this.applyParamsToLink(o,s)})})}applyParamsToLink(e,i=null){if(!e||!e.getAttribute){console.error("UTM Transfer: Invalid link element provided");return}let s=e.getAttribute("href");if(!s||s.startsWith("#")||s.startsWith("javascript:")||s.startsWith("mailto:")||s.startsWith("tel:"))return;if(s.includes("://")&&!s.includes(window.location.hostname)){if(!this.config.applyToExternalLinks)return;if(this.config.excludedDomains&&this.config.excludedDomains.length>0){for(let u of this.config.excludedDomains)if(s.includes(u))return}}let o=i||new URLSearchParams(window.location.search);if(o.toString()==="")return;let c;try{c=new URL(s,window.location.origin)}catch{console.error("UTM Transfer: Invalid URL:",s);return}let d=new URLSearchParams(c.search);o.forEach((u,p)=>{d.has(p)||d.append(p,u)}),c.search=d.toString(),e.setAttribute("href",c.toString()),this.config.debug&&`${s}${c.toString()}`}},Km=()=>{let l=new Ru;return l.init(),l};var Ws,Di,ae,pd,tf,gd,sf,md,rf,fd,nf,yd,of,bd,af,vd,cf,wd,lf,Sd,df,_d,uf,Cd,hf,xd,pf,Ed,gf,Ad,mf,xn=class{constructor(e={}){a(this,pd);a(this,gd);a(this,md);a(this,fd);a(this,yd);a(this,bd);a(this,vd);a(this,wd);a(this,Sd);a(this,_d);a(this,Cd);a(this,xd);a(this,Ed);a(this,Ad);a(this,Ws,!1);a(this,Di,!1);a(this,ae,null);let i=window.osConfig?.googleMaps||{};this.options={debug:!1,autoInit:!0,googleMapsApiKey:i.apiKey||"YOUR_API_KEY_HERE",googleMapsRegion:i.region||"US",enableGoogleMapsAutocomplete:i.enableAutocomplete!==!1,...e},this.logger=new Tn(this.options.debug),this.coreLogger=this.logger.createModuleLogger("CORE"),this.api=new En(this),this.config=n(this,pd,tf).call(this),this.state=new yc(this),this.attribution=new yl(this),this.discount=new nd(this),this.cart=new Cc(this),this.campaign=new mc(this),this.upsell=new dn(this),this.state&&typeof this.state.finalizeInitializationAndRecalculate=="function"?this.state.finalizeInitializationAndRecalculate():this.coreLogger.error("[TwentyNineNext Constructor] StateManager not ready or finalizeInitializationAndRecalculate not found!"),this.events={on:(s,r)=>this.on(s,r),once:(s,r)=>this.once(s,r),off:(s,r)=>this.off(s,r),trigger:(s,r)=>this.triggerEvent(s,r)},this.options.autoInit&&this.init()}on(e,i){let s=r=>{try{i(r.detail)}catch(o){this.coreLogger.error(`Error in event callback for "${e}":`,o)}};return document.addEventListener(`os:${e}`,s),this.coreLogger.debug(`Event listener registered for "${e}"`),this}once(e,i){let s=r=>{try{i(r.detail)}catch(o){this.coreLogger.error(`Error in one-time event callback for "${e}":`,o)}document.removeEventListener(`os:${e}`,s)};return document.addEventListener(`os:${e}`,s),this.coreLogger.debug(`One-time event listener registered for "${e}"`),this}off(e,i){return document.removeEventListener(`os:${e}`,i),this}async init(){this.coreLogger.info("Initializing 29next client (async init phase)"),this.api.init(),typeof window.on29NextReady<"u"&&!Array.isArray(window.on29NextReady)&&(this.coreLogger.warn("window.on29NextReady is not an array, resetting it"),window.on29NextReady=[]),await n(this,fd,nf).call(this),await n(this,md,rf).call(this),n(this,yd,of).call(this),await n(this,Ad,mf).call(this),h(this,Di,n(this,wd,lf).call(this)),t(this,Di)&&n(this,Sd,df).call(this),n(this,xd,pf).call(this),await n(this,Ed,gf).call(this),h(this,Ws,!0),this.triggerEvent("initialized",{client:this}),await n(this,bd,af).call(this)}triggerEvent(e,i={}){this.coreLogger.debug(`Triggering event: ${e}`);let s={...i,timestamp:Date.now(),client:this};e==="order.loaded"&&this.coreLogger.debug("Event data for order.loaded:",JSON.stringify(s,null,2));let r=new CustomEvent(`os:${e}`,{bubbles:!0,cancelable:!0,detail:s});return document.dispatchEvent(r),r}getCampaignData(){return t(this,ae)}get isInitialized(){return t(this,Ws)}get isCheckoutPage(){return t(this,Di)}debugTriggerViewItemList(){return t(this,ae)?this.events.viewItemList?(window.dataLayer=window.dataLayer||[],window.dataLayer.push({ecommerce:null}),this.events.viewItemList(t(this,ae)),{success:!0,message:"view_item_list event triggered",campaignData:t(this,ae)}):(console.error(" events.viewItemList not available"),{success:!1,message:"Event manager not initialized"}):(console.error(" No campaign data available"),{success:!1,message:"No campaign data"})}isReady(){return t(this,Ws)&&t(this,ae)!==null&&Array.isArray(t(this,ae).packages)}onReady(e){if(!e||typeof e!="function")return this;if(this.isReady())try{e(this)}catch(i){this.coreLogger.error("Error in onReady callback:",i)}else this.once("initialized",()=>{this.isReady()&&e(this)});return this}};Ws=new WeakMap,Di=new WeakMap,ae=new WeakMap,pd=new WeakSet,tf=function(){let e={apiKey:null,campaignId:null,debug:this.options.debug},s=new URLSearchParams(window.location.search).get("campaignId");if(s)this.coreLogger.info(`Found campaignId in URL: ${s}`),sessionStorage.setItem("os-campaign-id",s),e.apiKey=s,e.campaignId=s,this.coreLogger.info("Saved campaignId to session storage and using as API key");else{let o=sessionStorage.getItem("os-campaign-id");if(o)this.coreLogger.info(`Using campaign ID from session storage as API key: ${o}`),e.apiKey=o,e.campaignId=o;else{let c=document.querySelector('meta[name="os-api-key"]');e.apiKey=c?.getAttribute("content")??null,this.coreLogger.info(`API key from meta: ${e.apiKey?" Set":" Not set"}`);let d=document.querySelector('meta[name="os-campaign-id"]');e.campaignId=d?.getAttribute("content")??null,this.coreLogger.info(`Campaign ID from meta: ${e.campaignId?" Set":" Not set"}`)}}return document.querySelector('meta[name="os-debug"]')?.getAttribute("content")==="true"&&(e.debug=!0,this.logger.setDebug(!0),this.coreLogger.info("Debug mode:  Enabled")),n(this,gd,sf).call(this),e},gd=new WeakSet,sf=function(){window.osConfig=window.osConfig||{},window.osConfig.spreedlyConfig?this.coreLogger.info("Found custom Spreedly configuration"):(this.coreLogger.debug("Initializing default Spreedly configuration"),window.osConfig.spreedlyConfig={fieldType:{number:"text",cvv:"text"},numberFormat:"prettyFormat",placeholder:{number:"Credit Card Number",cvv:"CVV *"},labels:{number:"Card Number",cvv:"CVV"}})},md=new WeakSet,rf=async function(){if(!this.options.enableGoogleMapsAutocomplete){this.coreLogger.debug("Google Maps Autocomplete is disabled in configuration");return}if(typeof google<"u"&&typeof google.maps<"u"){this.coreLogger.debug("Google Maps API already loaded");return}return this.coreLogger.debug("Loading Google Maps API..."),new Promise(e=>{let i=document.createElement("script"),s=this.options.googleMapsRegion?`&region=${this.options.googleMapsRegion}`:"";i.src=`https://maps.googleapis.com/maps/api/js?key=${this.options.googleMapsApiKey}&libraries=places${s}`,i.async=!0,i.defer=!0,i.onload=()=>{this.coreLogger.debug("Google Maps API loaded successfully"),e()},i.onerror=()=>{this.coreLogger.error("Failed to load Google Maps API"),e()},document.head.appendChild(i)})},fd=new WeakSet,nf=async function(){try{if(this.coreLogger.info("Fetching campaign data..."),h(this,ae,await this.api.getCampaign()),h(this,ae,t(this,ae)||{packages:[]}),t(this,ae).packages=t(this,ae).packages||[],this.campaignData=t(this,ae),this.coreLogger.info("Campaign data retrieved successfully"),window.osConfig=window.osConfig||{},window.osConfig.campaign=t(this,ae),window.dataLayer=window.dataLayer||[],t(this,ae).name&&this.attribution){let i=document.querySelector('meta[name="os-tracking-tag"][data-tag-name="funnel_name"]')?.getAttribute("data-tag-value")||t(this,ae).name;this.attribution.setFunnelName(i)}this.triggerEvent("campaign.loaded",{campaign:t(this,ae)})}catch(e){this.coreLogger.error("Failed to retrieve campaign data:",e),h(this,ae,{name:"Default Campaign",packages:[],currency:"USD",locale:"en-US"}),this.campaignData=t(this,ae)}},yd=new WeakSet,of=function(){this.selector=new kc(this),this.toggle=new Fc(this),this.timer=new Yc(this),this.display=new il(this),this.eventManager=new $l(this),this.tooltip=new Gl(this),(t(this,Di)||document.querySelector('[data-os-cart="line-display"]')||document.querySelector('[os-cart="checkout-summary"]')||document.querySelector('[data-os-cart-summary="grand-total"]'))&&(this.coreLogger.info("Cart display elements detected, initializing CartDisplayManager"),this.cartDisplay=new nl(this)),this.debug=new jc(this),Object.assign(this.events,{emit:(e,i)=>this.triggerEvent(e,i),viewItemList:e=>this.eventManager.viewItemList(e||t(this,ae)),viewItem:e=>this.eventManager.viewItem(e),addToCart:e=>this.eventManager.addToCart(e),beginCheckout:()=>this.eventManager.beginCheckout(),purchase:(e,i)=>this.eventManager.purchase(e,i),fireCustomEvent:(e,i)=>this.eventManager.fireCustomEvent(e,i)})},bd=new WeakSet,af=async function(){await new Promise(e=>setTimeout(e,800)),n(this,vd,cf).call(this)},vd=new WeakSet,cf=function(){let e=document.querySelector('div[os-element="preloader"]');e&&(this.coreLogger.info("Hiding preloader element"),e.style.transition="opacity 0.5s ease",e.style.opacity="0",e.style.pointerEvents="none",this.coreLogger.debug("Preloader hidden"))},wd=new WeakSet,lf=function(){let i=document.querySelector('meta[name="os-page-type"]')?.getAttribute("content");return i==="checkout"||!i&&document.querySelector('form[os-checkout="form"]')?(this.coreLogger.info("Checkout page detected"),!0):(i==="receipt"&&(this.coreLogger.info("Receipt page detected"),n(this,_d,uf).call(this)),(i==="upsell"||document.querySelector("[data-os-upsell]"))&&(this.coreLogger.info("Upsell page detected"),n(this,Cd,hf).call(this)),!1)},Sd=new WeakSet,df=function(){this.checkout=new Za(this.api,this.coreLogger,this)},_d=new WeakSet,uf=function(){Promise.resolve().then(()=>(ef(),Qm)).then(e=>{let i=e.ReceiptPage;this.receipt=new i(this.api,this.coreLogger,this),this.coreLogger.info("Receipt page initialized")}).catch(e=>this.coreLogger.error("Failed to load ReceiptPage module:",e))},Cd=new WeakSet,hf=function(){this.coreLogger.info("Initializing upsell page"),this.upsell||(this.upsell=new dn(this),this.coreLogger.info("UpsellManager initialized for upsell page")),this.triggerEvent("upsell.pageview",{ref_id:new URLSearchParams(window.location.search).get("ref_id")||sessionStorage.getItem("order_ref_id")}),sessionStorage.getItem("pending_upsell_purchase")==="true"&&this.coreLogger.info("Found pending upsell purchase, will be tracked by UpsellManager")},xd=new WeakSet,pf=function(){this.coreLogger.info("Initializing UI utilities");try{let e=Gm();e&&(this.pbAccordion=e,this.coreLogger.info("PBAccordion initialized"))}catch(e){this.coreLogger.error("Failed to initialize PBAccordion:",e)}try{let e=Km();e&&(this.utmTransfer=e,this.coreLogger.info("UTM parameter transfer initialized"))}catch(e){this.coreLogger.error("Failed to initialize UTM transfer:",e)}},Ed=new WeakSet,gf=async function(){let e=new URLSearchParams(window.location.search).get("ref_id");if(!e)return;if(this.coreLogger.debug(`Checking for pending purchase events for ref_id: ${e}`),sessionStorage.getItem(`pending_purchase_event_${e}`)==="true"){this.coreLogger.info(`Found pending purchase event for order ${e}`);let s=this.eventManager&&this.eventManager.isInitialized;if(this.coreLogger.debug(`EventManager ready: ${s}`),!s){this.coreLogger.warn("EventManager not ready yet, will not trigger order.loaded event");return}try{let r=await this.api.getOrder(e);r?(this.coreLogger.info(`Triggering order.loaded event for pending purchase ${e}`),this.triggerEvent("order.loaded",{order:r}),this.coreLogger.info(`Triggered order.loaded event for pending purchase ${e}`),sessionStorage.removeItem(`pending_purchase_event_${e}`),this.coreLogger.debug(`Removed pending purchase flag for order ${e}`)):this.coreLogger.warn(`Could not fetch order data for pending purchase ${e}`)}catch(r){this.coreLogger.error(`Failed to load order data for pending purchase ${e}:`,r)}}else this.coreLogger.debug(`No pending purchase event for order ${e}`)},Ad=new WeakSet,mf=async function(){try{if(sessionStorage.getItem("pending_upsell_purchase")==="true"){this.coreLogger.info("Found pending upsell purchase, processing tracking event");let i=sessionStorage.getItem("upsell_purchase_data");if(i){let s=JSON.parse(i);if(this.eventManager&&typeof this.eventManager.purchase=="function"){if(this.coreLogger.info("Triggering purchase event for upsell",s),this.eventManager.purchase(s,!0),typeof this.eventManager.fireCustomEvent=="function"){let r={transaction_id:s.number,ref_id:s.ref_id,product_id:s.lines[0]?.product_id,product_name:s.lines[0]?.product_title,price:s.lines[0]?.price,quantity:s.lines[0]?.quantity,total:s.total,currency:s.currency};this.coreLogger.info("Triggering os_accepted_upsell custom event",r),this.eventManager.fireCustomEvent("os_accepted_upsell",r)}}else if(this.events&&typeof this.events.purchase=="function"){if(this.coreLogger.info("Triggering purchase event for upsell via events API",s),this.events.purchase(s,!0),typeof this.events.fireCustomEvent=="function"){let r={transaction_id:s.number,ref_id:s.ref_id,product_id:s.lines[0]?.product_id,product_name:s.lines[0]?.product_title,price:s.lines[0]?.price,quantity:s.lines[0]?.quantity,total:s.total,currency:s.currency};this.coreLogger.info("Triggering os_accepted_upsell custom event via events API",r),this.events.fireCustomEvent("os_accepted_upsell",r)}}else this.coreLogger.warn("No method available to track upsell purchase")}sessionStorage.removeItem("pending_upsell_purchase"),sessionStorage.removeItem("upsell_purchase_data"),this.coreLogger.debug("Cleared pending upsell purchase data")}}catch(e){this.coreLogger.error("Error checking for pending upsell purchase:",e)}};var ff=()=>{try{if(document.querySelector('meta[name="os-disable-auto-init"]'))return;let l={apiKey:document.querySelector('meta[name="os-api-key"]')?.getAttribute("content")??null,campaignId:document.querySelector('meta[name="os-campaign-id"]')?.getAttribute("content")??null,debug:document.querySelector('meta[name="os-debug"]')?.getAttribute("content")==="true",paypalClientId:document.querySelector('meta[name="os-paypal-client-id"]')?.getAttribute("content")??null};JSON.stringify({apiKey:l.apiKey?" Set":" Not set",campaignId:l.campaignId?" Set":" Not set",debug:l.debug}),window.on29NextReady=Array.isArray(window.on29NextReady)?window.on29NextReady:[];let e=[...window.on29NextReady];window.twentyNineNext=new xn(l),e.forEach(i=>{window.twentyNineNext.onReady(i)}),window.on29NextReady={push:i=>window.twentyNineNext.onReady(i)}}catch(l){console.error("29next Client: Error during initialization",l)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ff):ff();return _f(Kf);})();
