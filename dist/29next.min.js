"use strict";var TwentyNineNext=(()=>{var al=Object.defineProperty;var cg=Object.getOwnPropertyDescriptor;var lg=Object.getOwnPropertyNames;var dg=Object.prototype.hasOwnProperty;var ug=(c,t)=>()=>(c&&(t=c(c=0)),t);var pd=(c,t)=>{for(var i in t)al(c,i,{get:t[i],enumerable:!0})},hg=(c,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of lg(t))!dg.call(c,s)&&s!==i&&al(c,s,{get:()=>t[s],enumerable:!(r=cg(t,s))||r.enumerable});return c};var mg=c=>hg(al({},"__esModule",{value:!0}),c);var cl=(c,t,i)=>{if(!t.has(c))throw TypeError("Cannot "+i)};var e=(c,t,i)=>(cl(c,t,"read from private field"),i?i.call(c):t.get(c)),o=(c,t,i)=>{if(t.has(c))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(c):t.set(c,i)},u=(c,t,i,r)=>(cl(c,t,"write to private field"),r?r.call(c,i):t.set(c,i),i);var fd=(c,t,i,r)=>({set _(s){u(c,t,s,i)},get _(){return e(c,t,r)}}),n=(c,t,i)=>(cl(c,t,"access private method"),i);var Km={};pd(Km,{ReceiptPage:()=>ld});var mr,hi,Vc,A,Ps,Is,jc,O,B,Gc,Hm,Kc,Vm,Yc,jm,Jc,Gm,rt,gt,mi,Ls,qs,dd,Ms,ud,Fs,hd,Ns,md,gr,Hc,Os,gd,ld,Ym=ug(()=>{"use strict";ld=class{constructor(t,i,r){o(this,O);o(this,Gc);o(this,Kc);o(this,Yc);o(this,Jc);o(this,rt);o(this,mi);o(this,qs);o(this,Ms);o(this,Fs);o(this,Ns);o(this,gr);o(this,Os);o(this,mr,void 0);o(this,hi,void 0);o(this,Vc,void 0);o(this,A,null);o(this,Ps,!1);o(this,Is,!1);o(this,jc,!1);u(this,mr,t),u(this,hi,i),u(this,Vc,r);let s=document.querySelector('meta[name="os-debug"]');u(this,jc,s?.getAttribute("content")==="true"),n(this,O,B).call(this,"info","ReceiptPage component created"),this.init()}async init(){if(e(this,Is)){n(this,O,B).call(this,"info","Receipt page already initialized, skipping");return}n(this,O,B).call(this,"info","Initializing Receipt Page"),u(this,Is,!0);let i=new URLSearchParams(window.location.search).get("ref_id");if(!i){n(this,O,B).call(this,"error","No ref_id found in URL parameters"),n(this,Os,gd).call(this,"Order reference not found. Please check your URL.");return}n(this,O,B).call(this,"info",`Found ref_id in URL: ${i}`);try{await n(this,Gc,Hm).call(this,i),n(this,Kc,Vm).call(this)}catch(r){n(this,O,B).call(this,"error","Error initializing receipt page:",r),n(this,Os,gd).call(this,"Failed to load order details. Please try again later.")}}};mr=new WeakMap,hi=new WeakMap,Vc=new WeakMap,A=new WeakMap,Ps=new WeakMap,Is=new WeakMap,jc=new WeakMap,O=new WeakSet,B=function(t,i,...r){try{e(this,hi)&&typeof e(this,hi)[t]=="function"?e(this,hi)[t](i,...r):console[t]?console[t](i,...r):(`${t.toUpperCase()}${i}`,[...r])}catch(s){console.error("Error logging message:",s)}},Gc=new WeakSet,Hm=async function(t){if(n(this,O,B).call(this,"info",`Fetching order details for ref_id: ${t}`),e(this,Ps)&&e(this,A))return n(this,O,B).call(this,"info","Order already fetched, using cached data"),e(this,A);try{if(!e(this,mr))throw new Error("API client not available");return n(this,O,B).call(this,"debug","Making API request to fetch order details"),u(this,A,await e(this,mr).getOrder(t)),u(this,Ps,!0),n(this,O,B).call(this,"info","Order details fetched successfully"),n(this,O,B).call(this,"debug","Order data:",e(this,A)),e(this,A)}catch(i){throw n(this,O,B).call(this,"error",`Error fetching order details for ref_id ${t}:`,i),i}},Kc=new WeakSet,Vm=function(){if(!e(this,A)){n(this,O,B).call(this,"error","No order data available to update receipt content");return}n(this,O,B).call(this,"info","Updating receipt content with order details"),n(this,rt,gt).call(this,"fname",e(this,A).user?.first_name||""),e(this,A).billing_address&&(n(this,rt,gt).call(this,"billing_fname",`${e(this,A).billing_address.first_name} ${e(this,A).billing_address.last_name}`),n(this,rt,gt).call(this,"billing_address",n(this,qs,dd).call(this,e(this,A).billing_address)),n(this,rt,gt).call(this,"billing_location",n(this,Ms,ud).call(this,e(this,A).billing_address)),n(this,rt,gt).call(this,"billing_country",n(this,Fs,hd).call(this,e(this,A).billing_address.country)||"")),e(this,A).shipping_address&&(n(this,rt,gt).call(this,"shipping_fname",`${e(this,A).shipping_address.first_name} ${e(this,A).shipping_address.last_name}`),n(this,rt,gt).call(this,"shipping_address",n(this,qs,dd).call(this,e(this,A).shipping_address)),n(this,rt,gt).call(this,"shipping_location",n(this,Ms,ud).call(this,e(this,A).shipping_address)),n(this,rt,gt).call(this,"shipping_country",n(this,Fs,hd).call(this,e(this,A).shipping_address.country)||""));let t=n(this,Yc,jm).call(this);n(this,rt,gt).call(this,"payment_method",t),n(this,Jc,Gm).call(this);let i=e(this,A).shipping_method||"Standard Shipping";n(this,rt,gt).call(this,"shipping-method",i),n(this,rt,gt).call(this,"shipping_method",i);let r=n(this,gr,Hc).call(this,parseFloat(e(this,A).total_incl_tax)||0);n(this,rt,gt).call(this,"total",r),n(this,rt,gt).call(this,"order_number",e(this,A).number||""),n(this,rt,gt).call(this,"order_reference",e(this,A).ref_id||""),n(this,O,B).call(this,"info","Receipt content updated successfully")},Yc=new WeakSet,jm=function(){return e(this,A).payment_detail&&e(this,A).payment_detail.payment_method?n(this,Ns,md).call(this,e(this,A).payment_detail.payment_method):e(this,A).payment_method?n(this,Ns,md).call(this,e(this,A).payment_method):"Credit Card"},Jc=new WeakSet,Gm=function(){if(!e(this,A).lines||!Array.isArray(e(this,A).lines)){n(this,O,B).call(this,"warn","No order lines available");return}let t=document.querySelector('[data-os-receipt="order-lines"]');if(!t){n(this,O,B).call(this,"warn","Order lines container not found in DOM");return}t.innerHTML="";let i=document.querySelector('[data-os-receipt="product-line"]'),r=i?i.outerHTML:`
      <div data-os-receipt="product-line" class="cart-summary__line">
        <div class="cart-summary__line-item">
          <div data-os-receipt="line-title" class="cart-line__title"></div>
          <div data-os-receipt="line-saving" class="cart-line__discount"></div>
        </div>
        <div class="cart-summary__line-item">
          <p data-os-receipt="line-compare" class="pb-cart__line-price pb--compare"></p>
          <p data-os-receipt="line-subtotal" class="pb-cart__line-price"></p>
        </div>
      </div>
    `;e(this,A).lines.forEach(s=>{let a=document.createElement("div");a.innerHTML=r;let l=a.firstElementChild,d=s.product_title||s.title||s.package_title||"Product";if(n(this,mi,Ls).call(this,l,"line-title",d),s.price_excl_tax_excl_discounts&&parseFloat(s.price_excl_tax_excl_discounts)>parseFloat(s.price_excl_tax)){let m=parseFloat(s.price_excl_tax_excl_discounts),g=parseFloat(s.price_excl_tax),f=Math.round((1-g/m)*100);n(this,mi,Ls).call(this,l,"line-saving",`(${f}% OFF)`),n(this,mi,Ls).call(this,l,"line-compare",n(this,gr,Hc).call(this,m))}else{let m=l.querySelector('[data-os-receipt="line-saving"]'),g=l.querySelector('[data-os-receipt="line-compare"]');m&&(m.style.display="none"),g&&(g.style.display="none")}let h=parseFloat(s.price_incl_tax)||parseFloat(s.price_excl_tax)||0;n(this,mi,Ls).call(this,l,"line-subtotal",n(this,gr,Hc).call(this,h)),t.appendChild(l)})},rt=new WeakSet,gt=function(t,i){let r=document.querySelectorAll(`[data-os-receipt="${t}"]`);if(r.length===0){n(this,O,B).call(this,"debug",`No elements found with data-os-receipt="${t}"`);return}r.forEach(s=>{s.textContent=i})},mi=new WeakSet,Ls=function(t,i,r){let s=t.querySelector(`[data-os-receipt="${i}"]`);if(!s){n(this,O,B).call(this,"debug",`No element found with data-os-receipt="${i}" in node`);return}s.textContent=r},qs=new WeakSet,dd=function(t){let i="";return t.line1&&(i+=t.line1),t.line2&&(i+=i?`, ${t.line2}`:t.line2),i},Ms=new WeakSet,ud=function(t){let i=[];return t.line4&&i.push(t.line4),t.state&&i.push(t.state),t.postcode&&i.push(t.postcode),i.join(", ")},Fs=new WeakSet,hd=function(t){return{US:"United States",CA:"Canada",GB:"United Kingdom",AU:"Australia",NZ:"New Zealand"}[t]||t},Ns=new WeakSet,md=function(t){return{card_token:"Credit Card",paypal:"PayPal",apple_pay:"Apple Pay",google_pay:"Google Pay",credit:"Credit Card",card:"Credit Card"}[t]||t},gr=new WeakSet,Hc=function(t){let i=e(this,A).currency||"USD",r=parseFloat(t);if(isNaN(r))return n(this,O,B).call(this,"warn",`Invalid amount for currency formatting: ${t}`),`$0.00 ${i}`;try{return new Intl.NumberFormat("en-US",{style:"currency",currency:i}).format(r)}catch(s){return n(this,O,B).call(this,"error",`Error formatting currency: ${s}`),`$${r.toFixed(2)} ${i}`}},Os=new WeakSet,gd=function(t){n(this,O,B).call(this,"error",`Displaying error message: ${t}`);let i=document.querySelector(".receipt-content")||document.body,r=document.createElement("div");r.className="receipt-error",r.style.color="red",r.style.padding="20px",r.style.margin="20px 0",r.style.border="1px solid red",r.style.borderRadius="5px",r.style.backgroundColor="rgba(255, 0, 0, 0.1)",r.textContent=t,i.prepend(r)}});var Ng={};pd(Ng,{TwentyNineNext:()=>Rs});var qt,ne,wr,E,Us,yd,Ve,vr,Sr,ll,zs=class{constructor(t){o(this,Us);o(this,Ve);o(this,Sr);o(this,qt,void 0);o(this,ne,void 0);o(this,wr,"https://campaigns.apps.29next.com/api/v1");o(this,E,void 0);u(this,qt,t),u(this,E,t.logger.createModuleLogger("API"))}init(){if(e(this,E).info("Initializing ApiClient"),u(this,ne,e(this,qt).config.apiKey),e(this,ne))e(this,E).info("API key is set");else{let r=document.querySelector('meta[name="os-api-key"]');u(this,ne,r?.getAttribute("content")),e(this,E).info(e(this,ne)?"API key retrieved from meta tag":"API key is not set")}let i=document.querySelector('meta[name="os-proxy-url"]')?.getAttribute("content");i&&(u(this,wr,i),e(this,E).info(`Using proxy URL: ${i}`))}async getCampaign(){try{let t=await n(this,Ve,vr).call(this,"campaigns/");if(e(this,E).debug("Campaign data received"),Array.isArray(t)&&t.length>0)return t[0];if(t?.name)return t;throw new Error("No valid campaign data found")}catch(t){return e(this,E).error("Error fetching campaign:",t),e(this,E).warn("Using fallback empty campaign object"),{name:"Default Campaign",currency:"USD",packages:[],formatPrice:i=>`$${Number.parseFloat(i).toFixed(2)}`}}}async createCart(t){e(this,E).debug("Creating cart",t),t.attribution?e(this,E).debug("Cart already has attribution data:",t.attribution):(t.attribution=n(this,Sr,ll).call(this),e(this,E).debug("Added attribution data to cart:",t.attribution));try{let i=await n(this,Ve,vr).call(this,"carts/","POST",t);return e(this,E).info("Cart created successfully",i),i}catch(i){throw e(this,E).error("Error creating cart",i),i}}async createOrder(t){e(this,E).debug("Creating order",t),t.attribution?e(this,E).debug("Order already has attribution data:",t.attribution):(t.attribution=n(this,Sr,ll).call(this),e(this,E).debug("Added attribution data to order:",t.attribution)),(t.payment_token==="test_card"||t.payment_detail&&t.payment_detail.card_token==="test_card")&&(e(this,E).debug("Using test card token for order"),t.payment_detail=t.payment_detail||{},t.payment_detail.payment_method="card_token",t.payment_detail.card_token="test_card",t.payment_token&&delete t.payment_token);try{let i=await n(this,Ve,vr).call(this,"orders/","POST",t);return e(this,E).info("Order created successfully",i),i.ref_id&&(sessionStorage.setItem("order_ref_id",i.ref_id),e(this,E).debug(`Order reference ID stored: ${i.ref_id}`)),i}catch(i){throw e(this,E).error("Error creating order",i),i}}async getOrder(t){if(!t)throw new Error("Order reference is required");return e(this,E).debug(`Fetching order with ref: ${t}`),n(this,Ve,vr).call(this,`orders/${t}/`)}async processPayment(t,i){e(this,E).debug(`Processing ${i} payment for order`);let r={credit:"card_token",paypal:"paypal",apple_pay:"apple_pay",google_pay:"google_pay"};if(t.payment_detail=t.payment_detail??{},t.payment_detail.payment_method=r[i]??i,i==="credit"&&!t.payment_detail.card_token)throw new Error("Credit card payment requires a card token");return i!=="credit"&&delete t.payment_detail.card_token,this.createOrder(t)}getNextUrlFromOrderResponse(t,i="/checkout/complete"){e(this,E).debug("Getting next URL for redirect");let r=t.ref_id,s=document.querySelector('meta[name="os-next-page"]'),a=i;if(s?.getAttribute("content")){let m=s.getAttribute("content");e(this,E).debug(`Found meta tag with next page URL: ${m}`);let g=m.startsWith("http")?new URL(m):new URL(m,`${location.protocol}//${location.host}`);return r&&g.searchParams.append("ref_id",r),g.href}if(t.payment_complete_url)return t.payment_complete_url;if(t.order_status_url)return t.order_status_url;let d=location.pathname.split("/").slice(0,-1).join("/"),h=new URL(`${d}${a}`,`${location.protocol}//${location.host}`);return r&&h.searchParams.append("ref_id",r),h.href}};qt=new WeakMap,ne=new WeakMap,wr=new WeakMap,E=new WeakMap,Us=new WeakSet,yd=function(t){let i=t.startsWith("/")?t.slice(1):t;return`${e(this,wr)}/${i}`},Ve=new WeakSet,vr=async function(t,i="GET",r=null){if(!e(this,ne)){if(e(this,E).warn("API key is not set"),t==="campaigns/")return e(this,E).info("Returning mock campaign data since API key is not set"),[{name:"Mock Campaign",id:"mock-campaign",currency:"USD",locale:"en-US",packages:[],products:[]}];throw new Error("API key is required")}let s=n(this,Us,yd).call(this,t),a={method:i,mode:"cors",credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:e(this,ne)}};i!=="GET"&&r&&(a.body=JSON.stringify(r)),e(this,E).debug(`Making ${i} request to ${s}`,i!=="GET"?{requestData:r}:{});try{let l=await fetch(s,a);if(e(this,E).debug(`Received response from ${s} with status ${l.status}`),!l.ok){let h=await l.json().catch(()=>({}));throw e(this,E).error(`API error response from ${s}:`,h),new Error(JSON.stringify(h))}let d=await l.json();return e(this,E).debug(`Successfully processed response from ${s}`),d}catch(l){throw e(this,E).error(`API request failed: ${t}`,l),l.message?.match(/NetworkError|Failed to fetch|Network request failed/)&&e(this,E).warn("This appears to be a CORS issue. Make sure the API endpoint allows cross-origin requests."),l}},Sr=new WeakSet,ll=function(){if(e(this,qt).attribution)return typeof e(this,qt).attribution.getAttributionForApi=="function"?e(this,qt).attribution.getAttributionForApi():e(this,qt).attribution.getAttributionData();if(e(this,qt).state){let t=e(this,qt).state.getState("attribution");return t||e(this,qt).state.getState("cart.attribution")||{}}return{}};var Se,xe,yi,Bs,bd,Ws,vd,Hs,wd,Vs,Sd,js,xd,Gs,_d,Ks,Cd,Ys,Ed,Ds=class{constructor(t=!1){o(this,Bs);o(this,Ws);o(this,Hs);o(this,Vs);o(this,js);o(this,Gs);o(this,Ks);o(this,Ys);o(this,Se,void 0);o(this,xe,"29next");o(this,yi,0);u(this,Se,t),this.setStartupTime()}setDebug(t){u(this,Se,t)}setStartupTime(){u(this,yi,+new Date),window.twentyNineNextStartupTime=e(this,yi)}getElapsedTime(){return+new Date-e(this,yi)}createModuleLogger(t){let i=`${e(this,xe)} [${t}]`;return{debug:(...r)=>n(this,Vs,Sd).call(this,i,...r),info:(...r)=>n(this,Bs,bd).call(this,i,...r),warn:(...r)=>n(this,Ws,vd).call(this,i,...r),error:(...r)=>n(this,Hs,wd).call(this,i,...r),debugWithTime:(...r)=>n(this,Ys,Ed).call(this,i,...r),infoWithTime:(...r)=>n(this,js,xd).call(this,i,...r),warnWithTime:(...r)=>n(this,Gs,_d).call(this,i,...r),errorWithTime:(...r)=>n(this,Ks,Cd).call(this,i,...r)}}logWithTime(t,...i){let r=this.getElapsedTime();`${e(this,xe)}${r}${t}`,[...i]}warnWithTime(t,...i){let r=this.getElapsedTime();console.warn(`%c${e(this,xe)} +${r}ms%c ${t}`,"color: #ff9900; font-weight: bold;","color: inherit;",...i)}errorWithTime(t,...i){let r=this.getElapsedTime();console.error(`%c${e(this,xe)} +${r}ms%c ${t}`,"color: #cc0000; font-weight: bold;","color: inherit;",...i)}debugWithTime(t,...i){if(e(this,Se)){let r=this.getElapsedTime();console.debug(`%c${e(this,xe)}:debug +${r}ms%c ${t}`,"color: #666666; font-weight: bold;","color: inherit;",...i)}}};Se=new WeakMap,xe=new WeakMap,yi=new WeakMap,Bs=new WeakSet,bd=function(t,i,...r){`${t}${i}`,[...r]},Ws=new WeakSet,vd=function(t,i,...r){console.warn(`%c${t}%c ${i}`,"color: #ff9900; font-weight: bold;","color: inherit;",...r)},Hs=new WeakSet,wd=function(t,i,...r){console.error(`%c${t}%c ${i}`,"color: #cc0000; font-weight: bold;","color: inherit;",...r)},Vs=new WeakSet,Sd=function(t,i,...r){e(this,Se)&&console.debug(`%c${t}:debug%c ${i}`,"color: #666666; font-weight: bold;","color: inherit;",...r)},js=new WeakSet,xd=function(t,i,...r){let s=this.getElapsedTime();`${t}${s}${i}`,[...r]},Gs=new WeakSet,_d=function(t,i,...r){let s=this.getElapsedTime();console.warn(`%c${t} +${s}ms%c ${i}`,"color: #ff9900; font-weight: bold;","color: inherit;",...r)},Ks=new WeakSet,Cd=function(t,i,...r){let s=this.getElapsedTime();console.error(`%c${t} +${s}ms%c ${i}`,"color: #cc0000; font-weight: bold;","color: inherit;",...r)},Ys=new WeakSet,Ed=function(t,i,...r){if(e(this,Se)){let s=this.getElapsedTime();console.debug(`%c${t}:debug +${s}ms%c ${i}`,"color: #666666; font-weight: bold;","color: inherit;",...r)}};var Zs,ot,at,yt,Lt,R,Qs,Ad,tn,Td,xr,dl,en,kd,bi,Js,rn,$d,sn,Ld,_r,ul,nn,Pd,Cr,hl,on,Id,an,qd,cn,Md,Xs=class{constructor(t,i){o(this,Qs);o(this,tn);o(this,xr);o(this,en);o(this,bi);o(this,rn);o(this,sn);o(this,_r);o(this,nn);o(this,Cr);o(this,on);o(this,an);o(this,cn);o(this,Zs,void 0);o(this,ot,void 0);o(this,at,void 0);o(this,yt,[]);o(this,Lt,{});o(this,R,void 0);u(this,Zs,t),u(this,ot,i),u(this,at,n(this,tn,Td).call(this)),u(this,R,{shippingCountry:document.querySelector('[os-checkout-field="country"]'),shippingState:document.querySelector('[os-checkout-field="province"]'),billingCountry:document.querySelector('[os-checkout-field="billing-country"]'),billingState:document.querySelector('[os-checkout-field="billing-province"]')}),n(this,sn,Ld).call(this),e(this,R).shippingCountry||e(this,R).billingCountry?(e(this,ot).info("AddressHandler initialized"),n(this,Qs,Ad).call(this)):e(this,ot).warn("No country selects found")}};Zs=new WeakMap,ot=new WeakMap,at=new WeakMap,yt=new WeakMap,Lt=new WeakMap,R=new WeakMap,Qs=new WeakSet,Ad=async function(){await n(this,nn,Pd).call(this),await Promise.all([e(this,R).shippingCountry&&n(this,xr,dl).call(this,e(this,R).shippingCountry,e(this,R).shippingState),e(this,R).billingCountry&&n(this,xr,dl).call(this,e(this,R).billingCountry,e(this,R).billingState)]),n(this,en,kd).call(this),n(this,on,Id).call(this),n(this,an,qd).call(this)},tn=new WeakSet,Td=function(){return{defaultCountry:window.osConfig?.addressConfig?.defaultCountry??document.querySelector('meta[name="os-address-default-country"]')?.content??"US",showCountries:window.osConfig?.addressConfig?.showCountries??document.querySelector('meta[name="os-address-show-countries"]')?.content?.split(",").map(t=>t.trim())??[],dontShowStates:window.osConfig?.addressConfig?.dontShowStates??document.querySelector('meta[name="os-address-dont-show-states"]')?.content?.split(",").map(t=>t.trim())??[],countries:window.osConfig?.addressConfig?.countries??[]}},xr=new WeakSet,dl=async function(t,i){t.innerHTML='<option value="">Select Country</option>'+e(this,yt).map(r=>`<option value="${r.iso2}">${r.name}</option>`).join(""),t.value=e(this,at).defaultCountry,i&&t.value&&await n(this,bi,Js).call(this,i,t.value),e(this,ot).debug(`Country select initialized with default ${e(this,at).defaultCountry}`)},en=new WeakSet,kd=function(){[[e(this,R).shippingCountry,e(this,R).shippingState],[e(this,R).billingCountry,e(this,R).billingState]].forEach(([i,r])=>{i?.addEventListener("change",()=>r&&n(this,bi,Js).call(this,r,i.value))})},bi=new WeakSet,Js=async function(t,i,r=!1){if(!i)return t.innerHTML='<option value="">Select State/Province</option>';let s=e(this,Lt)[i]||await n(this,Cr,hl).call(this,i);r&&await s,n(this,rn,$d).call(this,t,s),e(this,ot).debug(`State select updated for ${i}`)},rn=new WeakSet,$d=function(t,i){let r=t.value||t.getAttribute("data-pending-state")||"";t.innerHTML='<option value="">Select State/Province</option>'+i.map(s=>`<option value="${s.iso2}">${s.name}</option>`).join(""),t.parentElement.style.display=i.length?"":"none",r&&Array.from(t.options).some(s=>s.value===r)&&(t.value=r)},sn=new WeakSet,Ld=function(){let t=i=>{let r=JSON.parse(localStorage.getItem(i)??"{}");return Date.now()-(r.timestamp??0)<864e5?r:{}};u(this,yt,t("os_countries_cache").countries??[]),e(this,yt).length&&e(this,at).showCountries.length&&(u(this,yt,e(this,yt).filter(i=>e(this,at).showCountries.includes(i.iso2))),e(this,ot).debug(`Filtered cached countries to: ${e(this,at).showCountries.join(", ")}`)),u(this,Lt,t("os_states_cache").states??{}),e(this,ot).debug(`Loaded cached data: ${e(this,yt).length} countries, ${Object.keys(e(this,Lt)).length} state sets`)},_r=new WeakSet,ul=function(t,i){localStorage.setItem(t,JSON.stringify({...i,timestamp:Date.now()}))},nn=new WeakSet,Pd=async function(){e(this,yt).length||(u(this,yt,e(this,at).countries.length?e(this,at).countries.map(t=>({iso2:t.iso2||t.code,name:t.name})):(await(await fetch("https://api.countrystatecity.in/v1/countries",{headers:{"X-CSCAPI-KEY":"c2R3MzNhYmpvYUJPdmhkUlE5TUJWYUtJUGs2TTlNU3cyRmxmVW9wVQ=="}})).json()).filter(t=>!e(this,at).showCountries.length||e(this,at).showCountries.includes(t.iso2))),e(this,yt).sort((t,i)=>t.name.localeCompare(i.name)),n(this,_r,ul).call(this,"os_countries_cache",{countries:e(this,yt)}),e(this,ot).info(`Loaded ${e(this,yt).length} countries`))},Cr=new WeakSet,hl=async function(t){if(e(this,Lt)[t])return e(this,Lt)[t];try{let i=(await(await fetch(`https://api.countrystatecity.in/v1/countries/${t}/states`,{headers:{"X-CSCAPI-KEY":"c2R3MzNhYmpvYUJPdmhkUlE5TUJWYUtJUGs2TTlNU3cyRmxmVW9wVQ=="}})).json()).filter(r=>!e(this,at).dontShowStates.includes(r.iso2));return e(this,Lt)[t]=i,n(this,_r,ul).call(this,"os_states_cache",{states:e(this,Lt)}),e(this,ot).debug(`Loaded ${i.length} states for ${t}`),i}catch(i){return e(this,ot).error(`Failed to load states for ${t}:`,i),e(this,Lt)[t]=t==="US"?[]:[],e(this,Lt)[t]}},on=new WeakSet,Id=async function(){if(e(this,R).shippingCountry?.value||e(this,R).billingCountry?.value)return;let t=e(this,at).defaultCountry||(await Promise.any(["https://ipapi.co/json/","https://ipinfo.io/json"].map(i=>fetch(i).then(r=>r.json()))))?.country_code;[e(this,R).shippingCountry,e(this,R).billingCountry].forEach(i=>{i&&(i.value=t,i.dispatchEvent(new Event("change")))}),e(this,ot).debug(`User country detected/set to ${t}`)},an=new WeakSet,qd=function(){let t=Object.values(e(this,R)).filter(Boolean),i=new MutationObserver(r=>{r.forEach(s=>{if(s.attributeName==="value"&&s.target.value){let a=s.target===e(this,R).shippingCountry?e(this,R).shippingState:e(this,R).billingState;a&&n(this,bi,Js).call(this,a,s.target.value,!0),e(this,ot).debug(`Autocomplete detected on ${s.target.getAttribute("os-checkout-field")}`)}})});t.forEach(r=>i.observe(r,{attributes:!0,attributeFilter:["value"]})),n(this,cn,Md).call(this),e(this,ot).debug("Autocomplete detection set up")},cn=new WeakSet,Md=function(){let t=e(this,at).showCountries.length?e(this,at).showCountries:["US","CA","GB","AU"];t.forEach(i=>!e(this,Lt)[i]&&n(this,Cr,hl).call(this,i)),e(this,ot).debug(`Preloading states for ${t.join(", ")}`)};var Ar,_e,ln,Tr,je,kr,$r,dn,Fd,bt,Mt,un,Nd,hn,Od,Lr,ml,Pr,gl,mn,Rd,gn,zd,pn,Ud,fn,Dd,yl,gg,Ir,pl,Ge,Er,qr,fl,yn,Bd,bn,Wd,vn,Hd,wn,Vd,Sn,jd,Wt,oe,xn,Gd,_n,Kd,Cn,Yd,vi=class{constructor(t={}){o(this,dn);o(this,bt);o(this,un);o(this,hn);o(this,Lr);o(this,Pr);o(this,mn);o(this,gn);o(this,pn);o(this,fn);o(this,yl);o(this,Ir);o(this,Ge);o(this,qr);o(this,yn);o(this,bn);o(this,vn);o(this,wn);o(this,Sn);o(this,Wt);o(this,xn);o(this,_n);o(this,Cn);o(this,Ar,void 0);o(this,_e,void 0);o(this,ln,{});o(this,Tr,!1);o(this,je,!1);o(this,kr,!1);o(this,$r,!1);u(this,Tr,t.debugMode||!1),u(this,Ar,t.logger||console),u(this,_e,n(this,dn,Fd).call(this)),u(this,je,typeof Spreedly<"u"),e(this,_e)&&n(this,un,Nd).call(this)}validateAllFields(t=this.getSelectedPaymentMethod()){e(this,Tr)&&n(this,gn,zd).call(this,t);let i=["credit","credit-card"].includes(t),r=Array.from(document.querySelectorAll('[os-checkout-validate="required"]')),s=n(this,pn,Ud).call(this,r,i),a=!0;return i&&(a=this.validateCreditCard()),s?(n(this,_n,Kd).call(this,s),!1):a}clearErrorForField(t){if(!t)return;t.classList.remove("error"),(t.closest(".frm-flds")||t.closest(".form-group")||t.parentElement)?.querySelector(".pb-input-error")?.remove();let r=t.getAttribute("os-checkout-field");if(["cc-number","cvv"].includes(r)){let s=`spreedly-${r==="cc-number"?"number":"cvv"}`,a=document.getElementById(s);a&&(a.classList.remove("error"),a.closest(".frm-flds")?.querySelector(".pb-input-error")?.remove())}}clearAllErrors(){u(this,ln,{}),document.querySelectorAll(".error").forEach(t=>t.classList.remove("error")),document.querySelectorAll(".pb-input-error").forEach(t=>t.remove()),n(this,qr,fl).call(this)}isSameAsShipping(){let t=document.querySelector('[os-checkout-field="same-as-shipping"] input[type="checkbox"]')||document.querySelector('[os-input-field="use-shipping-address"] input[type="checkbox"]')||document.querySelector("#use_shipping_address");return t?t.checked:!0}getSelectedPaymentMethod(){return document.querySelector('input[name="payment_method"]:checked')?.value||document.querySelector('input[name="combo_mode"]:checked')?.value||"credit"}getFormValues(){let t={};return e(this,_e).querySelectorAll("input, select, textarea").forEach(i=>{if(["button","submit"].includes(i.type)||i.disabled||!i.name)return;let r=i.getAttribute("os-checkout-field")||i.name;if(i.type==="checkbox")t[r]=i.checked;else if(i.type==="radio")i.checked&&(t[r]=i.value);else if(r.includes(".")){let[s,a]=r.split(".");t[s]=t[s]||{},t[s][a]=i.value}else t[r]=i.value}),t}validateCreditCard(){let t=!0,[i,r]=n(this,Ir,pl).call(this);if(n(this,Ge,Er).call(this,i,"month")||(t=!1),n(this,Ge,Er).call(this,r,"year")||(t=!1),e(this,je)&&typeof Spreedly.validate=="function"){let s=document.getElementById("spreedly-number"),a=document.getElementById("spreedly-cvv"),l=s?.classList.contains("spreedly-valid"),d=a?.classList.contains("spreedly-valid");Spreedly.validate(),!l&&s&&(n(this,Wt,oe).call(this,s,"Please enter a valid credit card number"),t=!1),!d&&a&&(n(this,Wt,oe).call(this,a,"Please enter a valid security code (CVV)"),t=!1)}else{let s=document.querySelector('[os-checkout-field="cc-number"]'),a=document.querySelector('[os-checkout-field="cvv"]');s?.value.trim()||(n(this,Wt,oe).call(this,s,"Please enter a credit card number"),t=!1),a?.value.trim()||(n(this,Wt,oe).call(this,a,"Please enter a security code (CVV)"),t=!1)}return t}};Ar=new WeakMap,_e=new WeakMap,ln=new WeakMap,Tr=new WeakMap,je=new WeakMap,kr=new WeakMap,$r=new WeakMap,dn=new WeakSet,Fd=function(){let t=document.querySelector('form[os-checkout="form"]')||document.querySelector("form#combo_form");return t||n(this,bt,Mt).call(this,"warn","No checkout form found"),t},bt=new WeakSet,Mt=function(t,i,...r){try{(e(this,Ar)?.[t]||console[t]||console.log).call(console,`[${t.toUpperCase()}] ${i}`,...r)}catch(s){console.error("Error logging:",s)}},un=new WeakSet,Nd=function(){e(this,_e).addEventListener("submit",t=>n(this,mn,Rd).call(this,t)),document.querySelector('[os-checkout-payment="combo"]')?.addEventListener("click",()=>{this.validateAllFields()&&e(this,_e).submit()}),document.addEventListener("payment-method-changed",()=>this.clearAllErrors()),e(this,je)&&typeof Spreedly.on=="function"&&n(this,hn,Od).call(this)},hn=new WeakSet,Od=function(){Object.entries({ready:()=>{u(this,$r,!0),n(this,bt,Mt).call(this,"debug","Spreedly is ready")},paymentMethod:(i,r)=>{u(this,kr,!0),n(this,bt,Mt).call(this,"debug","Spreedly payment method created"),n(this,qr,fl).call(this)},validation:i=>{n(this,bt,Mt).call(this,"debug",`Spreedly field validation: ${i.fieldType} ${i.valid?"valid":"invalid"}`);let r=document.getElementById(`spreedly-${i.fieldType}`);if(r&&(r.classList.toggle("spreedly-valid",i.valid),r.classList.toggle("error",!i.valid)),i.valid)this.clearErrorForField(r);else{let s=n(this,Lr,ml).call(this,i.fieldType);n(this,Pr,gl).call(this,{attribute:i.fieldType,message:s})}},errors:i=>{u(this,kr,!1),n(this,bt,Mt).call(this,"debug","Spreedly validation errors:",i),i.forEach(r=>n(this,Pr,gl).call(this,r))},fieldEvent:(i,r,s,a)=>{let l=document.getElementById(`spreedly-${i}`);if(r==="input"&&l){let d=i==="number"?a.validNumber:a.validCvv;if(l.classList.toggle("spreedly-valid",d),l.classList.toggle("error",!d),d)this.clearErrorForField(l);else{let h=n(this,Lr,ml).call(this,i);n(this,Wt,oe).call(this,l,h)}}}}).forEach(([i,r])=>Spreedly.on(i,r))},Lr=new WeakSet,ml=function(t){return{number:"Please enter a valid credit card number",cvv:"Please enter a valid security code (CVV)"}[t]||`Invalid ${t}`},Pr=new WeakSet,gl=function(t){let i={number:"spreedly-number",card_number:"spreedly-number",cvv:"spreedly-cvv",month:"cc-month",year:"cc-year",full_name:"cc-name",first_name:"cc-name",last_name:"cc-name"},r=document.getElementById(i[t.attribute])||document.querySelector(`[os-checkout-field="${i[t.attribute]}"]`);r&&n(this,Wt,oe).call(this,r,t.message)},mn=new WeakSet,Rd=function(t){this.validateAllFields()||(t.preventDefault(),n(this,bt,Mt).call(this,"warn","Form validation failed"))},gn=new WeakSet,zd=function(t){n(this,bt,Mt).call(this,"debug","Starting field validation for payment method:",t),n(this,bt,Mt).call(this,"debug","Same as shipping:",this.isSameAsShipping()),n(this,bt,Mt).call(this,"debug","Spreedly enabled:",e(this,je)),n(this,bt,Mt).call(this,"debug","Spreedly ready:",e(this,$r))},pn=new WeakSet,Ud=function(t,i){let r=null;for(let s of t){let a=s.getAttribute("os-checkout-field");if(n(this,fn,Dd).call(this,a,i)){this.clearErrorForField(s);continue}let l=s.previousElementSibling?.textContent||a||s.placeholder;n(this,yn,Bd).call(this,s,l)||(r=r||s)}return r},fn=new WeakSet,Dd=function(t,i){return this.isSameAsShipping()&&t?.startsWith("billing-")||i&&["cc-number","cvv"].includes(t)},yl=new WeakSet,gg=function(){let[t,i]=n(this,Ir,pl).call(this);return n(this,Ge,Er).call(this,t,"month")&&n(this,Ge,Er).call(this,i,"year")},Ir=new WeakSet,pl=function(){let t=['[os-checkout-field="cc-month"]','[os-checkout-field="exp-month"]',"#credit_card_exp_month"],i=['[os-checkout-field="cc-year"]','[os-checkout-field="exp-year"]',"#credit_card_exp_year"];return[t.map(r=>document.querySelector(r)).find(Boolean),i.map(r=>document.querySelector(r)).find(Boolean)]},Ge=new WeakSet,Er=function(t,i){return!t||!t.value?(n(this,bt,Mt).call(this,"error",`${i} field is empty`),n(this,Wt,oe).call(this,t,`Please select an expiration ${i}`),!1):!0},qr=new WeakSet,fl=function(){["cc-number","cvv"].forEach(t=>this.clearErrorForField(document.querySelector(`[os-checkout-field="${t}"]`))),["spreedly-number","spreedly-cvv"].forEach(t=>this.clearErrorForField(document.getElementById(t)))},yn=new WeakSet,Bd=function(t,i){if(!t)return!0;let r=t.value.trim(),s=n(this,vn,Hd).call(this,t,r,n(this,bn,Wd).call(this,t,i));return s.isValid?this.clearErrorForField(t):n(this,Wt,oe).call(this,t,s.errorMessage),s.isValid},bn=new WeakSet,Wd=function(t,i){let r=t.getAttribute("os-checkout-field")||t.name;return{fname:"First Name",lname:"Last Name",email:"Email",phone:"Phone Number",address1:"Address",address2:"Apartment or Suite",city:"City",province:"State/Province",postal:"ZIP/Postal Code",country:"Country","cc-number":"Credit Card Number",cvv:"Security Code","cc-month":"Expiration Month","cc-year":"Expiration Year","cc-name":"Name on Card","exp-month":"Expiration Month","exp-year":"Expiration Year","billing-fname":"Billing First Name","billing-lname":"Billing Last Name","billing-address1":"Billing Address","billing-address2":"Billing Apartment or Suite","billing-city":"Billing City","billing-province":"Billing State/Province","billing-postal":"Billing ZIP/Postal Code","billing-country":"Billing Country","billing-phone":"Billing Phone Number"}[r]||i||r},vn=new WeakSet,Hd=function(t,i,r){let s=t.tagName.toLowerCase(),a=t.getAttribute("os-checkout-field")||t.name;return s==="select"?{isValid:!!i,errorMessage:`Please select a ${r}`}:i?a&&(a.includes("city")||a.endsWith("-city"))?n(this,wn,Vd).call(this,i,r):a&&(a.includes("zip")||a.includes("postal")||a.endsWith("-zip"))?n(this,Sn,jd).call(this,i,r):t.type==="tel"&&t.iti?{isValid:t.iti.isValidNumber(),errorMessage:"Please enter a valid phone number"}:t.type==="email"?{isValid:n(this,Cn,Yd).call(this,i),errorMessage:"Please enter a valid email address"}:{isValid:!0,errorMessage:""}:{isValid:!1,errorMessage:`Please enter your ${r}`}},wn=new WeakSet,Vd=function(t,i){return{isValid:/^[a-zA-Z\s]{2,24}$/.test(t),errorMessage:"Please enter a valid city name (2-24 letters, no numbers or special characters)"}},Sn=new WeakSet,jd=function(t,i){return{isValid:/^\d{5}$/.test(t),errorMessage:"Please enter a valid 5-digit ZIP code"}},Wt=new WeakSet,oe=function(t,i){if(!t)return;t.classList.add("error");let r=t.closest(".frm-flds")||t.closest(".form-group")||t.parentElement,s=n(this,xn,Gd).call(this,r);s.textContent=i,Object.assign(s.style,{color:"red",fontSize:"0.875rem",marginTop:"0.25rem"}),t.hasErrorListener||(t.hasErrorListener=!0,["input","change"].forEach(a=>t.addEventListener(a,()=>this.clearErrorForField(t))),t.type==="tel"&&t.iti&&t.addEventListener("countrychange",()=>this.clearErrorForField(t)))},xn=new WeakSet,Gd=function(t){let i=t.querySelector(".pb-input-error");return i||(i=document.createElement("div"),i.className="pb-input-error",t.appendChild(i)),i},_n=new WeakSet,Kd=function(t){t&&(window.scrollTo({top:t.getBoundingClientRect().top+window.pageYOffset-100,behavior:"smooth"}),setTimeout(()=>t.focus(),500))},Cn=new WeakSet,Yd=function(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)};var Mr,Fr,wi,Si,dt,xi,_i,Tn,Jd,kn,Xd,Nr,bl,$n,Zd,Ln,Qd,Or,vl,Ci,En,I,z,An=class{constructor(t,i={}){o(this,Tn);o(this,kn);o(this,Nr);o(this,$n);o(this,Ln);o(this,Or);o(this,Ci);o(this,I);o(this,Mr,void 0);o(this,Fr,!1);o(this,wi,!1);o(this,Si,null);o(this,dt,null);o(this,xi,null);o(this,_i,null);if(u(this,Mr,t),u(this,Fr,i.debug||!1),!t){n(this,I,z).call(this,"error","No environment key provided to SpreedlyManager");return}n(this,I,z).call(this,"debug",`SpreedlyManager initialized with environment key: ${t}`),n(this,Tn,Jd).call(this)}clearAllErrors(){n(this,Ci,En).call(this,"number"),n(this,Ci,En).call(this,"cvv");let t=document.querySelector('[os-checkout-field="cc-month"]')||document.querySelector('[os-checkout-field="exp-month"]')||document.querySelector("#credit_card_exp_month"),i=document.querySelector('[os-checkout-field="cc-year"]')||document.querySelector('[os-checkout-field="exp-year"]')||document.querySelector("#credit_card_exp_year");if(t){t.classList.remove("error");let s=(t.closest(".frm-flds")||t.parentElement).querySelector(".pb-input-error");s&&s.remove()}if(i){i.classList.remove("error");let s=(i.closest(".frm-flds")||i.parentElement).querySelector(".pb-input-error");s&&s.remove()}}tokenizeCard(t){if(n(this,I,z).call(this,"debug","Tokenizing card with data:",{...t,full_name:t.full_name,month:t.month,year:t.year}),this.clearAllErrors(),!t.full_name||!t.month||!t.year){n(this,I,z).call(this,"error","Missing required card data");let i=[];t.full_name||i.push({attribute:"full_name",message:"Cardholder name is required"}),t.month||i.push({attribute:"month",message:"Expiration month is required"}),t.year||i.push({attribute:"year",message:"Expiration year is required"}),n(this,Or,vl).call(this,i),e(this,dt)&&e(this,dt).call(this,i.map(r=>r.message));return}if(!e(this,wi)){n(this,I,z).call(this,"error","Spreedly is not ready yet"),e(this,dt)&&e(this,dt).call(this,["Payment system is not ready yet. Please try again in a moment."]);return}try{Spreedly.tokenizeCreditCard(t),n(this,I,z).call(this,"debug","Card tokenization initiated")}catch(i){n(this,I,z).call(this,"error","Error tokenizing card",i),e(this,dt)&&e(this,dt).call(this,["An error occurred while processing your card. Please try again."])}}setOnReady(t){u(this,Si,t),e(this,wi)&&t&&t()}setOnError(t){u(this,dt,t)}setOnPaymentMethod(t){u(this,xi,t)}setOnValidation(t){u(this,_i,t)}};Mr=new WeakMap,Fr=new WeakMap,wi=new WeakMap,Si=new WeakMap,dt=new WeakMap,xi=new WeakMap,_i=new WeakMap,Tn=new WeakSet,Jd=function(){typeof Spreedly>"u"?(n(this,I,z).call(this,"debug","Spreedly not loaded, loading script..."),n(this,kn,Xd).call(this).then(()=>{n(this,I,z).call(this,"debug","Spreedly script loaded"),n(this,Nr,bl).call(this)}).catch(t=>{n(this,I,z).call(this,"error","Failed to load Spreedly script",t),e(this,dt)&&e(this,dt).call(this,["Failed to load Spreedly. Please refresh the page and try again."])})):(n(this,I,z).call(this,"debug","Spreedly already loaded"),n(this,Nr,bl).call(this))},kn=new WeakSet,Xd=function(){return new Promise((t,i)=>{let r=document.createElement("script");r.src="https://core.spreedly.com/iframe/iframe-v1.min.js",r.async=!0,r.onload=t,r.onerror=i,document.head.appendChild(r)})},Nr=new WeakSet,bl=function(){try{n(this,I,z).call(this,"debug","Setting up Spreedly..."),n(this,$n,Zd).call(this),Spreedly.init(e(this,Mr),{numberEl:"spreedly-number",cvvEl:"spreedly-cvv"});let t='color: #212529; font-size: 1rem; line-height: 1.5; font-weight: 400;       width: calc(100% - 20px); height: calc(100% - 2px); position: absolute;       font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue","Noto Sans","Liberation Sans",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";';Spreedly.on("ready",()=>{n(this,I,z).call(this,"debug","Spreedly iframe ready"),Spreedly.setFieldType("text"),Spreedly.setPlaceholder("cvv","CVV *"),Spreedly.setPlaceholder("number","Credit Card Number"),Spreedly.setNumberFormat("prettyFormat"),Spreedly.setStyle("cvv",t),Spreedly.setStyle("number",t),u(this,wi,!0),e(this,Si)&&e(this,Si).call(this)}),n(this,Ln,Qd).call(this),n(this,I,z).call(this,"debug","Spreedly setup complete")}catch(t){n(this,I,z).call(this,"error","Error setting up Spreedly",t),e(this,dt)&&e(this,dt).call(this,["Failed to set up Spreedly. Please refresh the page and try again."])}},$n=new WeakSet,Zd=function(){try{n(this,I,z).call(this,"debug","Preparing HTML structure for Spreedly iframe fields");let t=document.querySelector('[os-checkout-field="cc-number"]'),i=document.querySelector('[os-checkout-field="cvv"]');if(!t||!i){n(this,I,z).call(this,"error","Could not find credit card fields");return}let r=t.closest(".frm-flds"),s=i.closest(".frm-flds");if(r&&s){t.style.display="none",i.style.display="none";let a=document.createElement("div");a.id="spreedly-number",a.className="input-flds spreedly-field",r.appendChild(a);let l=document.createElement("div");l.id="spreedly-cvv",l.className="input-flds spreedly-field",s.appendChild(l);let d=document.createElement("style");d.textContent=`
          .spreedly-field {
            position: relative;
            overflow: hidden;
          }
        `,document.head.appendChild(d)}else n(this,I,z).call(this,"error","Could not find credit card field containers");n(this,I,z).call(this,"debug","HTML structure prepared for Spreedly iframe fields")}catch(t){n(this,I,z).call(this,"error","Error preparing HTML structure for Spreedly iframe fields",t)}},Ln=new WeakSet,Qd=function(){Spreedly.on("errors",t=>{n(this,I,z).call(this,"error","Spreedly validation errors:",t);let i=t.map(r=>r.message);e(this,dt)&&e(this,dt).call(this,i),n(this,Or,vl).call(this,t)}),Spreedly.on("paymentMethod",(t,i)=>{n(this,I,z).call(this,"debug","Spreedly payment method created:",t),this.clearAllErrors(),e(this,xi)&&e(this,xi).call(this,t,i)}),Spreedly.on("validation",t=>{n(this,I,z).call(this,"debug","Spreedly field validation:",t),n(this,Ci,En).call(this,t.fieldType),e(this,_i)&&e(this,_i).call(this,t)})},Or=new WeakSet,vl=function(t){t.forEach(i=>{let r=i.attribute,s=null;if(r==="number"||r==="card_number"?s=document.getElementById("spreedly-number"):r==="cvv"?s=document.getElementById("spreedly-cvv"):r==="month"||r==="year"?s=document.querySelector(`[os-checkout-field="cc-${r}"]`)||document.querySelector(`[os-checkout-field="exp-${r}"]`)||document.querySelector(`#credit_card_exp_${r}`):(r==="full_name"||r==="first_name"||r==="last_name")&&(s=document.querySelector('[os-checkout-field="cc-name"]')),s){s.classList.add("error");let a=s.closest(".frm-flds")||s.parentElement,l=a.querySelector(".pb-input-error");l||(l=document.createElement("div"),l.className="pb-input-error",a.appendChild(l)),l.textContent=i.message,l.style.color="red",l.style.fontSize="0.875rem",l.style.marginTop="0.25rem"}})},Ci=new WeakSet,En=function(t){let i=null;if(t==="number"||t==="card_number"?i=document.getElementById("spreedly-number"):t==="cvv"&&(i=document.getElementById("spreedly-cvv")),i){i.classList.remove("error");let s=(i.closest(".frm-flds")||i.parentElement).querySelector(".pb-input-error");s&&s.remove()}},I=new WeakSet,z=function(t,i,r){if(e(this,Fr)||t==="error"){let s="[SpreedlyManager]";r?console[t](`${s} ${i}`,r):console[t](`${s} ${i}`)}};var Ce,Ft,Ke,U,Ei,Ai,Pn,tu,In,eu,Nt=class{constructor({callback:t,logger:i}={}){o(this,Pn);o(this,In);o(this,Ce,["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"]);o(this,Ft,0);o(this,Ke,void 0);o(this,U,void 0);o(this,Ei,void 0);o(this,Ai,void 0);u(this,Ei,i),u(this,Ai,t),n(this,Pn,tu).call(this),n(this,In,eu).call(this),e(this,Ei)&&e(this,Ei).debug("KonamiCodeHandler initialized")}static setTestMode(){return sessionStorage.setItem("konami_test_mode","true"),!0}static isTestMode(){return sessionStorage.getItem("konami_test_mode")==="true"}static clearTestMode(){sessionStorage.removeItem("konami_test_mode")}static getTestOrderData(t,i,r){try{let s=t?.cart?.items||[],a=i?i():1,l=s.length>0&&r?r(s):[{package_id:a||1,quantity:1}];return{user:{email:"test@test.com",first_name:"Test",last_name:"Order"},shipping_address:{first_name:"Test",last_name:"Order",line1:"Test Address 123",line2:"",line3:"",line4:"Tempe",state:"AZ",postcode:"85281",country:"US",phone_number:"+14807581224"},billing_address:{first_name:"Test",last_name:"Order",line1:"Test Address 123",line2:"",line3:"",line4:"Tempe",state:"AZ",postcode:"85281",country:"US",phone_number:"+14807581224"},shipping_method:1,attribution:t?.cart?.attribution||{},lines:l,success_url:window.location.origin+"/checkout/confirmation/"}}catch(s){return console.error("Error getting Konami test order data:",s),null}}static showActivationMessage(){let t=document.createElement("div");return t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.background="rgba(0, 0, 0, 0.8)",t.style.color="#fff",t.style.padding="20px",t.style.borderRadius="10px",t.style.zIndex="9999",t.style.textAlign="center",t.style.fontFamily="monospace",t.style.fontSize="18px",t.innerHTML=`
      <h3>🎮 KONAMI CODE ACTIVATED! 🎮</h3>
      <p>Creating test order with predefined data:</p>
      <p style="font-size: 14px; margin-top: 10px; text-align: left;">
        Email: test@test.com<br>
        Name: Test Order<br>
        Address: Test Address 123<br>
        City: Tempe, AZ 85281<br>
        Country: US<br>
        Phone: +14807581224<br>
        Card: 4111111111111111 (test mode)
      </p>
    `,document.body.appendChild(t),t}};Ce=new WeakMap,Ft=new WeakMap,Ke=new WeakMap,U=new WeakMap,Ei=new WeakMap,Ai=new WeakMap,Pn=new WeakSet,tu=function(){u(this,U,document.createElement("div")),e(this,U).style.position="fixed",e(this,U).style.bottom="10px",e(this,U).style.right="10px",e(this,U).style.background="rgba(0, 0, 0, 0.7)",e(this,U).style.color="#fff",e(this,U).style.padding="5px 10px",e(this,U).style.borderRadius="5px",e(this,U).style.fontFamily="monospace",e(this,U).style.fontSize="12px",e(this,U).style.zIndex="9999",e(this,U).style.display="none",e(this,U).textContent="Konami: 0/"+e(this,Ce).length,document.body.appendChild(e(this,U))},In=new WeakSet,eu=function(){document.addEventListener("keydown",t=>{t.key===e(this,Ce)[e(this,Ft)]?(fd(this,Ft)._++,e(this,Ft)>=4&&(e(this,U).style.display="block",e(this,U).textContent=`Konami: ${e(this,Ft)}/${e(this,Ce).length}`),e(this,Ft)===e(this,Ce).length&&(e(this,Ai)&&e(this,Ai).call(this),u(this,Ft,0),setTimeout(()=>{e(this,U).style.display="none"},500)),e(this,Ft)>=4&&(clearTimeout(e(this,Ke)),u(this,Ke,setTimeout(()=>{e(this,U).style.display="none"},3e3)))):e(this,Ft)>0&&(u(this,Ft,0),e(this,U).style.display==="block"&&(e(this,U).textContent=`Konami: 0/${e(this,Ce).length}`,clearTimeout(e(this,Ke)),u(this,Ke,setTimeout(()=>{e(this,U).style.display="none"},1500))))})};var ki,$i,Ee,j,ce,Ae,Ot,le,Li,Mn,Fn,iu,Nn,ru,Ye,Rr,On,su,Rn,nu,M,D,zn,ou,Un,au,Dn,cu,Bn,lu,Wn,du,Hn,uu,Vn,hu,jn,mu,Gn,gu,Ur,wl,Dr,Sl,Ht,ae,Kn,pu,Yn,fu,Jn,yu,Xn,bu,Zn,vu,Br,xl,Te,Ti,Wr,_l,Hr,Cl,Qn,wu,Vr,El,Je,zr,to,Su,eo,xu,io,_u,Rt,Xt,ro,Cu,jr,Al,so,Eu,no,Au,qn=class{constructor(t,i,r){o(this,Fn);o(this,Nn);o(this,Ye);o(this,On);o(this,Rn);o(this,M);o(this,zn);o(this,Un);o(this,Dn);o(this,Bn);o(this,Wn);o(this,Hn);o(this,Vn);o(this,jn);o(this,Gn);o(this,Ur);o(this,Dr);o(this,Ht);o(this,Kn);o(this,Yn);o(this,Jn);o(this,Xn);o(this,Zn);o(this,Br);o(this,Te);o(this,Wr);o(this,Hr);o(this,Qn);o(this,Vr);o(this,Je);o(this,to);o(this,eo);o(this,io);o(this,Rt);o(this,ro);o(this,jr);o(this,so);o(this,no);o(this,ki,void 0);o(this,$i,void 0);o(this,Ee,void 0);o(this,j,void 0);o(this,ce,null);o(this,Ae,null);o(this,Ot,"credit-card");o(this,le,!1);o(this,Li,!1);o(this,Mn,{visa:"4111111111111111",mastercard:"5555555555554444",amex:"378282246310005",discover:"6011111111111117"});u(this,ki,t),u(this,$i,i),u(this,Ee,r),u(this,j,n(this,Fn,iu).call(this)),e(this,j)&&(n(this,Nn,ru).call(this),n(this,Rn,nu).call(this),u(this,Ae,new vi({debugMode:e(this,Li),logger:e(this,$i)})),e(this,j).__formValidator=e(this,Ae),n(this,zn,ou).call(this),n(this,Dn,cu).call(this))}setKonamiTestMode(){return Nt.setTestMode(),n(this,M,D).call(this,"info","🎮 Konami code test mode activated"),!0}processPayment(){let t=Nt.isTestMode();if(t&&(Nt.clearTestMode(),n(this,M,D).call(this,"info","🎮 Processing payment in Konami test mode")),e(this,le)){n(this,M,D).call(this,"warn","Payment already processing");return}n(this,jr,Al).call(this),n(this,Ur,wl).call(this),u(this,le,!0),n(this,M,D).call(this,"debug",`Processing payment with method: ${e(this,Ot)}`);try{if(t||n(this,Gn,gu).call(this)){n(this,Dr,Sl).call(this);let r=t?Nt.getTestOrderData(e(this,Ee)?.state?.getState(),n(this,Br,xl).bind(this),n(this,Vr,El).bind(this)):n(this,Te,Ti).call(this);if(!r){n(this,Ht,ae).call(this);return}n(this,Je,zr).call(this,{...r,payment_detail:{payment_method:"card_token",card_token:"test_card"}});return}if(!e(this,Ae).validateAllFields(e(this,Ot))){u(this,le,!1),n(this,Ht,ae).call(this);return}if(n(this,Dr,Sl).call(this),!n(this,Te,Ti).call(this))return;switch(e(this,Ot)){case"credit-card":case"credit":n(this,Kn,pu).call(this);break;case"paypal":n(this,Zn,vu).call(this);break;default:n(this,Rt,Xt).call(this,`Unknown payment method: ${e(this,Ot)}`)}}catch(i){n(this,M,D).call(this,"error","Error processing payment:",i),n(this,Rt,Xt).call(this,"Unexpected error occurred"),n(this,Ht,ae).call(this)}}};ki=new WeakMap,$i=new WeakMap,Ee=new WeakMap,j=new WeakMap,ce=new WeakMap,Ae=new WeakMap,Ot=new WeakMap,le=new WeakMap,Li=new WeakMap,Mn=new WeakMap,Fn=new WeakSet,iu=function(){let t=document.querySelector('form[os-checkout="form"]')||document.querySelector("form#combo_form");return t||n(this,M,D).call(this,"warn","No checkout form found"),t},Nn=new WeakSet,ru=function(){e(this,j).removeAttribute("action"),e(this,j).setAttribute("method","post");let t=document.createElement("input");t.type="hidden",t.name="prevent_serialization",t.value="true",e(this,j).appendChild(t),e(this,j).addEventListener("submit",n(this,Ye,Rr).bind(this),!0),e(this,j).onsubmit=n(this,Ye,Rr).bind(this),n(this,On,su).call(this)},Ye=new WeakSet,Rr=function(t){return t&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()),e(this,j).removeAttribute("action"),e(this,j).setAttribute("method","post"),window.stop?.(),n(this,M,D).call(this,"debug","Form submission prevented"),!1},On=new WeakSet,su=function(){try{e(this,j).querySelectorAll('button[type="submit"], input[type="submit"]').forEach((i,r)=>{i.setAttribute("type","button"),i.addEventListener("click",s=>{s.preventDefault(),n(this,M,D).call(this,"debug",`Submit button ${r+1} clicked`),this.processPayment()})})}catch(t){n(this,M,D).call(this,"error","Error converting submit buttons:",t)}},Rn=new WeakSet,nu=function(){let t=document.querySelector('[os-checkout-payment="combo"]');if(!t){n(this,M,D).call(this,"warn","Checkout button not found");return}let i=t.cloneNode(!0);t.parentNode.replaceChild(i,t),i.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation(),e(this,j).onsubmit=n(this,Ye,Rr).bind(this),e(this,j).removeAttribute("action"),e(this,j).setAttribute("method","post"),n(this,M,D).call(this,"debug","Checkout button clicked"),setTimeout(()=>this.processPayment(),0)})},M=new WeakSet,D=function(t,i,...r){try{(e(this,$i)?.[t]||console[t]||console.log).call(console,`[${t.toUpperCase()}] ${i}`,...r)}catch(s){console.error("Error logging:",s)}},zn=new WeakSet,ou=function(){try{let t=document.querySelector('[os-checkout-field="payment-method"]')||document.querySelector('input[name="combo_mode"]:checked');if(!t){n(this,M,D).call(this,"warn","Payment method selector not found");return}u(this,Ot,t.value||"credit-card"),n(this,Un,au).call(this)}catch(t){n(this,M,D).call(this,"error","Error initializing payment methods:",t)}},Un=new WeakSet,au=function(){let t=document.querySelectorAll('input[name="combo_mode"]'),i=r=>{u(this,Ot,r.target.value),n(this,M,D).call(this,"debug",`Payment method changed to: ${e(this,Ot)}`),document.dispatchEvent(new CustomEvent("payment-method-changed",{detail:{mode:e(this,Ot)}}))};t.length>0?t.forEach(r=>r.addEventListener("change",i)):document.querySelector('[os-checkout-field="payment-method"]')?.addEventListener("change",i)},Dn=new WeakSet,cu=function(){try{let t=document.querySelector('meta[name="spreedly-environment-key"]')?.content||document.querySelector('meta[name="os-payment-env-key"]')?.content;if(!t){n(this,M,D).call(this,"warn","Spreedly environment key not found");return}u(this,ce,new An(t,{debug:e(this,Li)})),n(this,Bn,lu).call(this),n(this,Hn,uu).call(this)}catch(t){n(this,M,D).call(this,"error","Error initializing Spreedly:",t)}},Bn=new WeakSet,lu=function(){e(this,ce).setOnReady(()=>n(this,M,D).call(this,"debug","Spreedly ready")),e(this,ce).setOnError(t=>{n(this,M,D).call(this,"error","Spreedly errors:",t),u(this,le,!1),n(this,Ht,ae).call(this);let i=n(this,Wn,du).call(this,t);n(this,Rt,Xt).call(this,i)}),e(this,ce).setOnPaymentMethod((t,i)=>{n(this,M,D).call(this,"debug","Spreedly payment method token received:",t),n(this,Je,zr).call(this,{payment_token:t,payment_method:"credit-card",...n(this,Te,Ti).call(this)})})},Wn=new WeakSet,du=function(t){if(!t||t.length===0)return"An unknown error occurred with your payment method";let i={"The card number is not a valid credit card number":"Please enter a valid credit card number","Credit card number entered is not valid":"Please enter a valid credit card number","The card number is too short":"The card number you entered is too short","The card number is too long":"The card number you entered is too long","The card security code is invalid":"Please enter a valid security code (CVV)","The card security code is too short":"The security code (CVV) is too short","The card security code is too long":"The security code (CVV) is too long","The card has expired":"This card has expired. Please use a different card","The card expiration month is invalid":"Please select a valid expiration month","The card expiration year is invalid":"Please select a valid expiration year"};for(let r of t)for(let[s,a]of Object.entries(i))if(r.includes(s))return a;return t[0]},Hn=new WeakSet,uu=function(){try{let[t,i]=n(this,Vn,hu).call(this);n(this,jn,mu).call(this,t,i)}catch(t){n(this,M,D).call(this,"error","Error initializing expiration fields:",t)}},Vn=new WeakSet,hu=function(){let t=['[os-checkout-field="cc-month"]','[os-checkout-field="exp-month"]',"#credit_card_exp_month"],i=['[os-checkout-field="cc-year"]','[os-checkout-field="exp-year"]',"#credit_card_exp_year"];return[t.map(r=>document.querySelector(r)).find(Boolean),i.map(r=>document.querySelector(r)).find(Boolean)]},jn=new WeakSet,mu=function(t,i){if(t){t.innerHTML='<option value="">Month</option>';for(let r=1;r<=12;r++){let s=r.toString().padStart(2,"0");t.appendChild(new Option(s,s))}}if(i){i.innerHTML='<option value="">Year</option>';let r=new Date().getFullYear();for(let s=0;s<20;s++){let a=r+s;i.appendChild(new Option(a,a))}}},Gn=new WeakSet,gu=function(){return new URLSearchParams(window.location.search).get("test")==="true"||Nt.isTestMode()},Ur=new WeakSet,wl=function(){e(this,j)?.removeAttribute("action"),e(this,j)?.setAttribute("method","post"),e(this,j).onsubmit=n(this,Ye,Rr).bind(this),e(this,j)?.querySelectorAll('button[type="submit"], input[type="submit"]').forEach(t=>{t.disabled=!0,t.setAttribute("type","button")})},Dr=new WeakSet,Sl=function(){let t=document.querySelector('[os-checkout-payment="combo"]');t&&(t.disabled=!0,t.classList.add("is-submitting"))},Ht=new WeakSet,ae=function(){let t=document.querySelector('[os-checkout-payment="combo"]');t&&(t.disabled=!1,t.classList.remove("is-submitting")),u(this,le,!1)},Kn=new WeakSet,pu=function(){if(!e(this,ce)){n(this,Rt,Xt).call(this,"Credit card processing unavailable");return}let[t,i,r]=n(this,Yn,fu).call(this);if(n(this,Jn,yu).call(this)){n(this,Xn,bu).call(this,t,i,r);return}if(!e(this,Ae).validateCreditCard()&&(n(this,M,D).call(this,"debug","Credit card validation failed on initial check"),!i||!r)){u(this,le,!1),n(this,Ht,ae).call(this);return}e(this,ce).tokenizeCard({full_name:t||"Test User",month:i,year:r})},Yn=new WeakSet,fu=function(){return[document.querySelector('[os-checkout-field="cc-name"]')?.value||"",document.querySelector('[os-checkout-field="cc-month"]')?.value||document.querySelector('[os-checkout-field="exp-month"]')?.value||document.querySelector("#credit_card_exp_month")?.value||"",document.querySelector('[os-checkout-field="cc-year"]')?.value||document.querySelector('[os-checkout-field="exp-year"]')?.value||document.querySelector("#credit_card_exp_year")?.value||""]},Jn=new WeakSet,yu=function(){let t=new URLSearchParams(window.location.search);return(e(this,Li)||t.get("debug")==="true")&&t.has("test-card")},Xn=new WeakSet,bu=function(t,i,r){let s=new URLSearchParams(window.location.search).get("test-card"),a=e(this,Mn)[s];a&&n(this,Je,zr).call(this,{payment_token:`test_card_token_${s}_${Date.now()}`,payment_method:"credit-card",test_card_type:s,test_card_number:a,...n(this,Te,Ti).call(this)})},Zn=new WeakSet,vu=function(){n(this,Je,zr).call(this,{payment_method:"paypal",...n(this,Te,Ti).call(this)})},Br=new WeakSet,xl=function(){let t=new URLSearchParams(window.location.search),i=t.get("package_id")||t.get("pid");return i&&parseInt(i,10)||null},Te=new WeakSet,Ti=function(){try{let t=n(this,Wr,_l).call(this,["fname","lname","address1","address2","city","province","postal","country","phone"]),i=e(this,Ae).isSameAsShipping()?null:n(this,Wr,_l).call(this,["billing-fname","billing-lname","billing-address1","billing-address2","billing-city","billing-province","billing-postal","billing-country","billing-phone"]),r=n(this,Hr,Cl).call(this,t),s=i?n(this,Hr,Cl).call(this,i):{...r};if(!e(this,Ee)?.state)return n(this,Rt,Xt).call(this,"Cart data missing"),null;let a=e(this,Ee).state.getState();return a.cart?.items?.length?{user:{email:a.user?.email||"",first_name:a.user?.firstName||r.first_name,last_name:a.user?.lastName||r.last_name},shipping_address:r,billing_address:s,shipping_method:n(this,Qn,wu).call(this,a),attribution:a.cart.attribution||{},lines:n(this,Vr,El).call(this,a.cart.items)}:(n(this,Rt,Xt).call(this,"Cart is empty"),null)}catch(t){return n(this,M,D).call(this,"error","Error getting order data:",t),n(this,Rt,Xt).call(this,"Error preparing order"),null}},Wr=new WeakSet,_l=function(t){let i={};return t.forEach(r=>{let s=document.querySelector(`[os-checkout-field="${r}"]`)?.value;s&&(i[r.replace("billing-","")]=s)}),i},Hr=new WeakSet,Cl=function(t){return{first_name:t.fname||"",last_name:t.lname||"",line1:t.address1||"",line2:t.address2||"",line3:"",line4:t.city||"",state:t.province||"",postcode:t.postal||"",country:t.country||"",phone_number:t.phone||""}},Qn=new WeakSet,wu=function(t){let i=t.cart?.shippingMethod;return typeof i=="number"?i:parseInt(i,10)||1},Vr=new WeakSet,El=function(t){return t.map(i=>{let r=parseInt(i.id||i.external_id,10)||n(this,Br,xl).call(this);if(!r)throw new Error(`Invalid package ID for item: ${i.name}`);return{package_id:r,quantity:i.quantity||1}})},Je=new WeakSet,zr=function(t){if(!t||!e(this,ki)){n(this,Rt,Xt).call(this,"Cannot create order"),n(this,Ht,ae).call(this);return}n(this,Ur,wl).call(this);let i=n(this,to,Su).call(this,t);e(this,ki).createOrder(i).then(r=>n(this,so,Eu).call(this,r)).catch(r=>n(this,Rt,Xt).call(this,n(this,eo,xu).call(this,r))).finally(()=>n(this,Ht,ae).call(this))},to=new WeakSet,Su=function(t){let i={...t,success_url:t.success_url||window.location.origin+"/checkout/confirmation/"};return t.payment_token&&(i.payment_detail={card_token:t.payment_token},delete i.payment_token),t.payment_method&&(i.payment_detail=i.payment_detail||{},i.payment_detail.payment_method={"credit-card":"card_token",credit:"card_token",paypal:"paypal"}[t.payment_method]||t.payment_method,delete i.payment_method),i.shipping_method=parseInt(i.shipping_method,10)||1,i.billing_address=i.billing_address||i.shipping_address,i},eo=new WeakSet,xu=function(t){try{let i=JSON.parse(t.message);if(i?.payment_details)return n(this,io,_u).call(this,i);if(i?.message)return`Order creation failed: ${Array.isArray(i.message)?i.message.map(r=>Object.entries(r).map(([s,a])=>`${s}: ${a}`).join(", ")).join(", "):Object.entries(i.message).map(([r,s])=>`${r}: ${s}`).join(", ")}`}catch{return t.message||"Unknown error"}return"Order creation failed"},io=new WeakSet,_u=function(t){let i=t.payment_response_code,r=t.payment_details;return{3005:"The card number you entered is invalid. Please check and try again.",3006:"The card expiration date is invalid. Please check and try again.",3007:"The card security code (CVV) is invalid. Please check and try again.",3008:"The card has been declined. Please try another payment method.",3009:"This card has expired. Please use a different card.",3010:"The card has insufficient funds. Please try another payment method."}[i]||r||"There was a problem processing your payment. Please try again."},Rt=new WeakSet,Xt=function(t){n(this,Ht,ae).call(this),n(this,jr,Al).call(this),e(this,Ot)==="credit-card"&&(t.includes("card")||t.includes("Card")||t.includes("CVV"))&&n(this,ro,Cu).call(this,t);let r=document.querySelector('[os-checkout-element="payment-error"]');if(r)r.textContent=t,r.style.display="block",r.scrollIntoView({behavior:"smooth",block:"center"});else{let s=document.querySelector(".spreedly-error")||document.querySelector("[data-spreedly-errors]");s?(s.textContent=t,s.style.display="block"):alert(`Payment Error: ${t}`)}},ro=new WeakSet,Cu=function(t){let i='[os-checkout-field="cc-number"]',r="#credit_card_number";t.toLowerCase().includes("cvv")||t.toLowerCase().includes("security code")?(i='[os-checkout-field="cc-cvv"]',r="#credit_card_cvv"):(t.toLowerCase().includes("expiration")||t.toLowerCase().includes("expired"))&&(i='[os-checkout-field="cc-month"], [os-checkout-field="cc-year"]',r="#credit_card_exp_month, #credit_card_exp_year");let s=i.split(",").map(d=>d.trim()),a=r.split(",").map(d=>d.trim());[...s,...a].forEach(d=>{let h=document.querySelector(d);if(!h)return;let m=h.closest(".form-group")||h.parentElement;if(!m)return;h.classList.add("is-invalid");let g=m.querySelector(".invalid-feedback");g||(g=document.createElement("div"),g.className="invalid-feedback",m.appendChild(g)),g.textContent=t,g.style.display="block"});let l=document.querySelector(s[0])||document.querySelector(a[0]);l&&(l.focus(),l.scrollIntoView({behavior:"smooth",block:"center"}))},jr=new WeakSet,Al=function(){['[os-checkout-field="cc-number"]',"#credit_card_number",'[os-checkout-field="cc-cvv"]',"#credit_card_cvv",'[os-checkout-field="cc-month"]',"#credit_card_exp_month",'[os-checkout-field="cc-year"]',"#credit_card_exp_year"].forEach(r=>{let s=document.querySelector(r);if(!s)return;s.classList.remove("is-invalid");let a=s.closest(".form-group")||s.parentElement;if(a){let l=a.querySelector(".invalid-feedback");l&&(l.style.display="none")}});let i=document.querySelector('[os-checkout-element="payment-error"]');i&&(i.style.display="none")},so=new WeakSet,Eu=function(t){sessionStorage.setItem("order_reference",t.ref_id),e(this,Ee)?.triggerEvent?.("order.created",t);let i=n(this,no,Au).call(this,t);window.location.href=i},no=new WeakSet,Au=function(t){let i=document.querySelector('meta[name="os-next-page"]')?.content;return i?`${i}${i.includes("?")?"&":"?"}ref_id=${t.ref_id}`:t.confirmation_url||t.order_status_url||`/checkout/confirmation/?ref_id=${t.ref_id}`};var ao,W,Pt,k,Xe,ke,Ze,de,ue,co,Tu,ut,vt,lo,ku,Kr,Tl,Yr,kl,uo,$u,ho,Lu,Qe,Gr,$l,pg,oo=class{constructor(t){o(this,co);o(this,ut);o(this,lo);o(this,Kr);o(this,Yr);o(this,uo);o(this,ho);o(this,Qe);o(this,$l);o(this,ao,void 0);o(this,W,void 0);o(this,Pt,void 0);o(this,k,void 0);o(this,Xe,{});o(this,ke,{});o(this,Ze,{fname:"billing-fname",lname:"billing-lname",address1:"billing-address1",address2:"billing-address2",city:"billing-city",province:"billing-province",postal:"billing-postal",country:"billing-country",phone:"billing-phone"});o(this,de,!1);o(this,ue,null);u(this,ao,t),t?.logger?typeof t.logger.debug=="function"&&typeof t.logger.info=="function"&&typeof t.logger.warn=="function"&&typeof t.logger.error=="function"?u(this,W,t.logger):u(this,W,t.logger.createModuleLogger?t.logger.createModuleLogger("BILLING"):console):u(this,W,console),n(this,co,Tu).call(this)}copyShippingToBilling(){try{Object.entries(e(this,Xe)).forEach(([t,i])=>{let r=e(this,Ze)[t],s=e(this,ke)[r];s&&i&&(s.value=i.value,s.dispatchEvent(new Event("change",{bubbles:!0})))}),n(this,ut,vt).call(this,"Copied shipping address to billing address")}catch(t){n(this,Yr,kl).call(this,"Error copying shipping to billing:",t)}}getBillingAddressData(){if(e(this,Pt)&&e(this,Pt).checked)return null;let t={};return Object.entries(e(this,ke)).forEach(([i,r])=>{let s=i.replace("billing-","");t[s]=r.value}),t}isSameAsShipping(){let t=e(this,Pt)?e(this,Pt).checked:!0;return n(this,ut,vt).call(this,`Billing address is ${t?"same as":"different from"} shipping`),t}};ao=new WeakMap,W=new WeakMap,Pt=new WeakMap,k=new WeakMap,Xe=new WeakMap,ke=new WeakMap,Ze=new WeakMap,de=new WeakMap,ue=new WeakMap,co=new WeakSet,Tu=function(){try{if(u(this,Pt,document.querySelector('[os-checkout-field="same-as-shipping"]')||document.querySelector('[name="use_shipping_address"]')||document.querySelector("#use_shipping_address")),u(this,k,document.querySelector('[os-checkout-element="different-billing-address"]')),!e(this,Pt)){n(this,Kr,Tl).call(this,'Same as shipping checkbox not found. Tried multiple selectors including [name="use_shipping_address"] and #use_shipping_address');let t=document.querySelectorAll('input[type="checkbox"]');n(this,ut,vt).call(this,`Found ${t.length} checkboxes on the page:`),t.forEach((i,r)=>{n(this,ut,vt).call(this,`Checkbox ${r+1}: id=${i.id}, name=${i.name}, class=${i.className}`)});return}if(!e(this,k))if(n(this,Kr,Tl).call(this,'Billing form container not found with selector [os-checkout-element="different-billing-address"]'),u(this,k,document.querySelector(".billing_form-container")),e(this,k))n(this,lo,ku).call(this,"Found billing form container with alternative selector .billing_form-container");else return;n(this,ut,vt).call(this,"BillingAddressHandler initialized"),n(this,uo,$u).call(this),u(this,ue,e(this,Pt).checked),n(this,Qe,Gr).call(this,e(this,ue),!1),n(this,ho,Lu).call(this)}catch(t){n(this,Yr,kl).call(this,"Error initializing BillingAddressHandler:",t)}},ut=new WeakSet,vt=function(t,...i){typeof e(this,W).debug=="function"?e(this,W).debug(t,...i):typeof e(this,W).log=="function"&&e(this,W).log(t,...i)},lo=new WeakSet,ku=function(t,...i){typeof e(this,W).info=="function"?e(this,W).info(t,...i):typeof e(this,W).log=="function"&&e(this,W).log(t,...i)},Kr=new WeakSet,Tl=function(t,...i){typeof e(this,W).warn=="function"?e(this,W).warn(t,...i):typeof e(this,W).log=="function"&&e(this,W).log(`WARNING: ${t}`,...i)},Yr=new WeakSet,kl=function(t,i){typeof e(this,W).error=="function"?e(this,W).error(t,i):typeof e(this,W).log=="function"?e(this,W).log(`ERROR: ${t}`,i):console.error(t,i)},uo=new WeakSet,$u=function(){Object.keys(e(this,Ze)).forEach(t=>{let i=document.querySelector(`[os-checkout-field="${t}"]`);i&&(e(this,Xe)[t]=i)}),Object.values(e(this,Ze)).forEach(t=>{let i=document.querySelector(`[os-checkout-field="${t}"]`);i&&(e(this,ke)[t]=i)}),n(this,ut,vt).call(this,`Cached ${Object.keys(e(this,Xe)).length} shipping fields and ${Object.keys(e(this,ke)).length} billing fields`)},ho=new WeakSet,Lu=function(){e(this,Pt).addEventListener("change",t=>{e(this,de)||(u(this,ue,t.target.checked),n(this,Qe,Gr).call(this,t.target.checked,!0),t.target.checked&&this.copyShippingToBilling(),n(this,ut,vt).call(this,`Billing address changed: ${t.target.checked?"Same as shipping":"Different from shipping"}`))}),document.addEventListener("payment-method-changed",()=>{e(this,ue)!==null&&!e(this,de)&&(n(this,Qe,Gr).call(this,e(this,ue),!1),n(this,ut,vt).call(this,`Payment method changed, billing address state: ${e(this,ue)?"Same as shipping":"Different from shipping"}`))}),Object.entries(e(this,Xe)).forEach(([t,i])=>{i.addEventListener("change",()=>{if(e(this,Pt).checked){let r=e(this,Ze)[t],s=e(this,ke)[r];s&&(s.value=i.value,s.dispatchEvent(new Event("change",{bubbles:!0})))}})})},Qe=new WeakSet,Gr=function(t,i=!0){if(!e(this,k)||e(this,de))return;u(this,de,!0),e(this,k).style.transition||(e(this,k).style.transition="height 0.3s ease-out, opacity 0.3s ease-out");let r=s=>{s.propertyName==="height"&&(t||(e(this,k).style.height="auto"),e(this,k).style.overflow="",u(this,de,!1),e(this,k).removeEventListener("transitionend",r),n(this,ut,vt).call(this,`Billing form transition completed: ${t?"collapsed":"expanded"}`))};i?(e(this,k).removeEventListener("transitionend",r),t?(e(this,k).style.height=`${e(this,k).scrollHeight}px`,e(this,k).style.overflow="hidden",requestAnimationFrame(()=>{e(this,k).style.height="0px",e(this,k).style.opacity="0",n(this,ut,vt).call(this,"Collapsing billing form")}),e(this,k).addEventListener("transitionend",r),e(this,k).addEventListener("transitionend",s=>{s.propertyName==="height"&&t&&(e(this,k).style.display="none",n(this,ut,vt).call(this,"Billing form hidden after collapse"))},{once:!0})):(e(this,k).style.display="flex",e(this,k).style.height="0px",e(this,k).style.overflow="hidden",requestAnimationFrame(()=>{let s=e(this,k).scrollHeight;e(this,k).style.height=`${s}px`,e(this,k).style.opacity="1",n(this,ut,vt).call(this,`Expanding billing form to height: ${s}px`)}),e(this,k).addEventListener("transitionend",r))):(e(this,k).style.display=t?"none":"flex",e(this,k).style.height=t?"0":"auto",e(this,k).style.opacity=t?"0":"1",e(this,k).style.overflow="",u(this,de,!1),n(this,ut,vt).call(this,`Set billing form without animation: ${t?"hidden":"visible"}`))},$l=new WeakSet,pg=function(){n(this,Qe,Gr).call(this,e(this,Pt).checked,!1)};var $e,ti,Pi,Ii,Le,go,po,Pu,Jr,Ll,mo=class{constructor(t){o(this,po);o(this,Jr);o(this,$e,void 0);o(this,ti,void 0);o(this,Pi,void 0);o(this,Ii,void 0);o(this,Le,new Map);o(this,go,null);u(this,$e,t),u(this,ti,document.querySelector("[os-payment-mode]")),u(this,Pi,document.querySelectorAll('input[name="combo_mode"]')),u(this,Ii,document.querySelectorAll('[os-checkout-element$="-form"]')),e(this,ti)&&e(this,Pi).length>0?(e(this,$e).debug("PaymentSelector initialized with elements found"),n(this,po,Pu).call(this)):e(this,$e).warn("PaymentSelector elements not found")}};$e=new WeakMap,ti=new WeakMap,Pi=new WeakMap,Ii=new WeakMap,Le=new WeakMap,go=new WeakMap,po=new WeakSet,Pu=function(){let t=document.querySelector('input[name="combo_mode"]:checked');t&&e(this,ti)&&n(this,Jr,Ll).call(this,t.value,!1),e(this,Pi).forEach(i=>i.addEventListener("change",r=>n(this,Jr,Ll).call(this,r.target.value,!0))),e(this,$e).debug("PaymentSelector event listeners attached")},Jr=new WeakSet,Ll=function(t,i=!0){e(this,$e).debug(`Setting payment mode to: ${t}, animate: ${i}`),e(this,ti)?.setAttribute("os-payment-mode",t),u(this,go,t),e(this,Ii).forEach(r=>{r.style.transition="none",r.offsetHeight,r.style.transition=""}),e(this,Ii).forEach(r=>{let a=r.getAttribute("os-checkout-element")===`${t}-form`;if(e(this,Le).has(r)){let l=e(this,Le).get(r);r.removeEventListener("transitionend",l),e(this,Le).delete(r)}if(i){r.style.display="block",r.style.overflow="hidden";let l=r.scrollHeight;r.style.height=`${l}px`,r.offsetHeight;let d=h=>{h.propertyName==="height"&&(a?(r.style.height="auto",r.style.overflow=""):r.style.display="none",e(this,Le).delete(r))};e(this,Le).set(r,d),r.addEventListener("transitionend",d,{once:!0}),requestAnimationFrame(()=>{r.style.height=a?`${r.scrollHeight}px`:"0",r.style.opacity=a?"1":"0"})}else r.style.transition="none",Object.assign(r.style,{display:a?"block":"none",height:a?"auto":"0",opacity:a?"1":"0",overflow:""}),r.offsetHeight,r.style.transition=""}),document.dispatchEvent(new CustomEvent("payment-method-changed",{detail:{mode:t}}))};var et,qi,Vt,yo,Iu,bo,qu,he,ei,vo,Mu,Xr,Pl,wo,Fu,So,Nu,Zr,Il,Qr,ql,xo,Ou,fo=class{constructor(t){o(this,yo);o(this,bo);o(this,he);o(this,vo);o(this,Xr);o(this,wo);o(this,So);o(this,Zr);o(this,Qr);o(this,xo);o(this,et,void 0);o(this,qi,!1);o(this,Vt,void 0);u(this,et,t),u(this,Vt,{shipping:{address:document.querySelector('[os-checkout-field="address1"]'),city:document.querySelector('[os-checkout-field="city"]'),state:document.querySelector('[os-checkout-field="province"]'),zip:document.querySelector('[os-checkout-field="postal"]'),country:document.querySelector('[os-checkout-field="country"]')},billing:{address:document.querySelector('[os-checkout-field="billing-address1"]'),city:document.querySelector('[os-checkout-field="billing-city"]'),state:document.querySelector('[os-checkout-field="billing-province"]'),zip:document.querySelector('[os-checkout-field="billing-postal"]'),country:document.querySelector('[os-checkout-field="billing-country"]')},locations:document.querySelectorAll('[data-os-component="location"]')}),e(this,et).info("AddressAutocomplete initialized"),n(this,bo,qu).call(this),n(this,yo,Iu).call(this)}};et=new WeakMap,qi=new WeakMap,Vt=new WeakMap,yo=new WeakSet,Iu=async function(){n(this,xo,Ou).call(this),await n(this,Xr,Pl).call(this)},bo=new WeakSet,qu=function(){e(this,qi)||(e(this,Vt).locations.forEach(t=>t.classList.add("cc-hidden")),e(this,et).debug("Location fields hidden"))},he=new WeakSet,ei=function(){e(this,qi)||(e(this,Vt).locations.forEach(t=>t.classList.remove("cc-hidden")),u(this,qi,!0),document.dispatchEvent(new CustomEvent("location-fields-shown")),e(this,et).debug("Location fields shown"))},vo=new WeakSet,Mu=function(){return!!window.google?.maps?.places},Xr=new WeakSet,Pl=async function(t=0){return n(this,vo,Mu).call(this)?(e(this,et).debug("Google Maps API available"),n(this,wo,Fu).call(this)):t>=3?(e(this,et).warn("Google Maps API unavailable after 3 attempts"),n(this,Qr,ql).call(this)):(e(this,et).debug(`Retrying Google Maps check, attempt ${t+1}`),await new Promise(i=>setTimeout(i,1e3*1.5**t)),n(this,Xr,Pl).call(this,t+1))},wo=new WeakSet,Fu=function(){let{shipping:t,billing:i}=e(this,Vt);[t,i].forEach(r=>{r.address&&(n(this,So,Nu).call(this,r.address,r),e(this,et).debug(`Autocomplete set up for ${r.address.getAttribute("os-checkout-field")}`))})},So=new WeakSet,Nu=function(t,i){try{let r=new google.maps.places.Autocomplete(t,{types:["address"],fields:["address_components","formatted_address"]});r.addListener("place_changed",()=>{let s=r.getPlace();if(!s.address_components)return;n(this,he,ei).call(this);let a=Object.fromEntries(s.address_components.map(l=>[l.types[0],{long:l.long_name,short:l.short_name}]));if(i.address.value=[a.street_number?.long,a.route?.long].filter(Boolean).join(" "),i.city&&(i.city.value=a.locality?.long??""),i.zip&&(i.zip.value=a.postal_code?.long??""),i.country&&a.country){let l=a.country.short;i.country.value!==l&&(i.country.value=l,i.country.dispatchEvent(new Event("change",{bubbles:!0})),e(this,et).debug(`Country set to ${l}`)),i.state&&a.administrative_area_level_1&&n(this,Zr,Il).call(this,i.state,a.administrative_area_level_1.short)}[i.address,i.city,i.zip].forEach(l=>l?.dispatchEvent(new Event("change",{bubbles:!0})))}),t.addEventListener("blur",()=>t.value.length>10&&n(this,he,ei).call(this)),t.addEventListener("keydown",s=>s.key==="Enter"&&s.preventDefault())}catch(r){e(this,et).error("Autocomplete setup failed:",r),n(this,Qr,ql).call(this)}},Zr=new WeakSet,Il=async function(t,i,r=0){if(r>=5){e(this,et).warn(`Failed to set state ${i} after 5 attempts`);return}await new Promise(a=>setTimeout(a,300*1.5**r)),Array.from(t.options).some(a=>a.value===i)?(t.value=i,t.dispatchEvent(new Event("change",{bubbles:!0})),e(this,et).debug(`State set to ${i}`)):n(this,Zr,Il).call(this,t,i,r+1)},Qr=new WeakSet,ql=function(){[e(this,Vt).shipping.address,e(this,Vt).billing.address].forEach(t=>{t?.addEventListener("blur",()=>t.value.length>10&&n(this,he,ei).call(this))}),e(this,et).debug("Basic field listeners set up")},xo=new WeakSet,Ou=function(){let t=document.createElement("style");t.textContent=`
        @keyframes onAutoFillStart { from { opacity: 0.99; } to { opacity: 1; } }
        input:-webkit-autofill { animation-name: onAutoFillStart; }
      `,document.head.appendChild(t),[e(this,Vt).shipping.address,e(this,Vt).billing.address].filter(Boolean).forEach(r=>{r.addEventListener("input",()=>r.value.length>10&&n(this,he,ei).call(this)),r.addEventListener("change",()=>r.value.length>0&&n(this,he,ei).call(this)),r.addEventListener("animationstart",s=>{s.animationName==="onAutoFillStart"&&(e(this,et).debug(`Autofill detected on ${r.getAttribute("os-checkout-field")}`),n(this,he,ei).call(this))})}),e(this,et).debug("Autofill detection initialized")};var wt,Mi,Co,Ru,ts,Ml,Eo,zu,Ao,Uu,To,Du,_o=class{constructor(t){o(this,Co);o(this,ts);o(this,Eo);o(this,Ao);o(this,To);o(this,wt,void 0);o(this,Mi,!!window.intlTelInput);u(this,wt,t),e(this,Mi)?(e(this,wt).info("intlTelInput available, initializing phone inputs"),n(this,ts,Ml).call(this)):(e(this,wt).warn("intlTelInput not found, loading dynamically"),n(this,Co,Ru).call(this).then(()=>n(this,ts,Ml).call(this)))}};wt=new WeakMap,Mi=new WeakMap,Co=new WeakSet,Ru=async function(){let t=[{tag:"link",rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css"},{tag:"script",src:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js",async:!0},{tag:"script",src:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",async:!0}];await Promise.all(t.map(({tag:i,...r})=>{let s=document.createElement(i);return Object.assign(s,r),document.head.appendChild(s),i==="link"?Promise.resolve():new Promise(a=>s.onload=a)})),u(this,Mi,!0),e(this,wt).debug("intlTelInput and utils loaded")},ts=new WeakSet,Ml=function(){if(!e(this,Mi))return;let t=document.querySelectorAll('input[type="tel"]');e(this,wt).info(`Found ${t.length} phone inputs`),t.forEach((i,r)=>n(this,Eo,zu).call(this,i,r+1))},Eo=new WeakSet,zu=function(t,i){try{let r=window.intlTelInput(t,{utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",separateDialCode:!0,onlyCountries:["us"],initialCountry:"us",allowDropdown:!1,dropdownContainer:document.body,useFullscreenPopup:!0,formatOnDisplay:!0,autoPlaceholder:"aggressive",customContainer:"iti-tel-input"});t.iti=r,e(this,wt).debug(`Phone input ${i} (${t.getAttribute("os-checkout-field")??"unknown"}) initialized`),n(this,Ao,Uu).call(this,t,r),n(this,To,Du).call(this,t,r)}catch(r){e(this,wt).error(`Error initializing phone input ${i}:`,r)}},Ao=new WeakSet,Uu=function(t,i){let r=t.getAttribute("os-checkout-field");if(!r){e(this,wt).warn("Phone input missing os-checkout-field attribute");return}let s=document.querySelector(r==="phone"?'[os-checkout-field="country"]':'[os-checkout-field="billing-country"]');if(!s){e(this,wt).warn(`Country select not found for ${r}`);return}s.value!=="US"&&(s.value="US",s.dispatchEvent(new Event("change",{bubbles:!0})),e(this,wt).debug("Country select updated to US"))},To=new WeakSet,Du=function(t,i){t.validatePhone=()=>t.value.trim()?i.isValidNumber():!t.hasAttribute("required"),t.getFormattedNumber=()=>i.getNumber(),t.closest("form")?.addEventListener("submit",()=>{t.value.trim()&&i.isValidNumber()&&(t.value=i.getNumber(),e(this,wt).debug(`Formatted phone number set to ${t.value} on submit`))})};var H,S,Po,Fi,Zt,Qt,Pe,Io,Ni,Oi,p,qo,Mo,Bu,Fo,Wu,No,Hu,Ri,ko,Oo,Vu,Ro,ju,zo,Gu,Uo,Ku,Do,Yu,Bo,Ju,Wo,Xu,Ho,Zu,Vo,Qu,zi,$o,es,Fl,jo,th,Lo=class{constructor(t){o(this,Mo);o(this,Fo);o(this,No);o(this,Ri);o(this,Oo);o(this,Ro);o(this,zo);o(this,Uo);o(this,Do);o(this,Bo);o(this,Wo);o(this,Ho);o(this,Vo);o(this,zi);o(this,es);o(this,jo);o(this,H,void 0);o(this,S,void 0);o(this,Po,!1);o(this,Fi,!1);o(this,Zt,!1);o(this,Qt,!1);o(this,Pe,null);o(this,Io,3e3);o(this,Ni,null);o(this,Oi,{firstName:'[os-checkout-field="fname"]',lastName:'[os-checkout-field="lname"]',email:'[os-checkout-field="email"]',phone:'[os-checkout-field="phone"]',address1:'[os-checkout-field="address1"]',address2:'[os-checkout-field="address2"]',city:'[os-checkout-field="city"]',province:'[os-checkout-field="province"]',postal:'[os-checkout-field="postal"]',country:'[os-checkout-field="country"]'});o(this,p,{firstName:null,lastName:null,email:null,phone:null,address1:null,address2:null,city:null,province:null,postal:null,country:null});o(this,qo,/^[^\s@]+@[^\s@]+\.[^\s@]+$/);u(this,H,t),e(this,H)&&e(this,H).logger?u(this,S,e(this,H).logger.createModuleLogger("PROSPECT")):u(this,S,{debug:(i,r)=>console.log(`[PROSPECT DEBUG] ${i}`,r!==void 0?r:""),info:(i,r)=>console.info(`[PROSPECT INFO] ${i}`,r!==void 0?r:""),warn:(i,r)=>console.warn(`[PROSPECT WARN] ${i}`,r!==void 0?r:""),error:(i,r)=>console.error(`[PROSPECT ERROR] ${i}`,r!==void 0?r:"")}),n(this,Mo,Bu).call(this)}triggerBeginCheckout(){return e(this,H)&&e(this,H).events?e(this,Qt)?(e(this,S).debug("beginCheckout event already fired, skipping"),!1):(e(this,S).info("Manually triggering beginCheckout event"),e(this,H).events.beginCheckout(),u(this,Qt,!0),!0):(e(this,S).warn("Cannot trigger beginCheckout event: Events manager not available"),!1)}resetBeginCheckoutFlag(){return u(this,Qt,!1),e(this,S).debug("Reset beginCheckout flag"),!0}};H=new WeakMap,S=new WeakMap,Po=new WeakMap,Fi=new WeakMap,Zt=new WeakMap,Qt=new WeakMap,Pe=new WeakMap,Io=new WeakMap,Ni=new WeakMap,Oi=new WeakMap,p=new WeakMap,qo=new WeakMap,Mo=new WeakSet,Bu=function(){e(this,S).info("Initializing ProspectCartHandler"),n(this,Fo,Wu).call(this),e(this,p).email&&(e(this,p).firstName||e(this,p).lastName)?(n(this,No,Hu).call(this),u(this,Po,!0),e(this,S).info("ProspectCartHandler initialized successfully")):e(this,S).warn("Required form fields not found, ProspectCartHandler not initialized")},Fo=new WeakSet,Wu=function(){Object.keys(e(this,Oi)).forEach(t=>{if(e(this,p)[t]=document.querySelector(e(this,Oi)[t]),!e(this,p)[t]){let i=e(this,Oi)[t].replace("os-checkout-field","data-os-field");e(this,p)[t]=document.querySelector(i)}e(this,p)[t]?e(this,S).debug(`Found ${t} field`):e(this,S).debug(`${t} field not found`)})},No=new WeakSet,Hu=function(){e(this,p).email&&e(this,p).email.addEventListener("blur",()=>n(this,Ri,ko).call(this)),e(this,p).firstName&&e(this,p).firstName.addEventListener("blur",()=>n(this,Ri,ko).call(this)),e(this,p).lastName&&e(this,p).lastName.addEventListener("blur",()=>n(this,Ri,ko).call(this));let t=document.querySelector('form[os-checkout="form"]');t&&t.addEventListener("submit",()=>{u(this,Zt,!0),e(this,Pe)&&clearTimeout(e(this,Pe))}),e(this,S).debug("Event listeners attached to form fields")},Ri=new WeakSet,ko=function(){e(this,Fi)||e(this,Zt)||(e(this,Pe)&&clearTimeout(e(this,Pe)),n(this,Oo,Vu).call(this),u(this,Pe,setTimeout(()=>{n(this,Ro,ju).call(this)},e(this,Io))))},Oo=new WeakSet,Vu=function(){if(e(this,Qt))return;let t=e(this,p).email&&e(this,p).email.value&&e(this,p).email.value.trim().length>0,i=e(this,p).firstName&&e(this,p).firstName.value&&e(this,p).firstName.value.trim().length>0||e(this,p).lastName&&e(this,p).lastName.value&&e(this,p).lastName.value.trim().length>0;(t||i)&&(e(this,S).debug("User has started entering checkout information, firing beginCheckout event"),e(this,H).events&&(e(this,H).events.beginCheckout(),u(this,Qt,!0),e(this,S).info("beginCheckout event fired")))},Ro=new WeakSet,ju=function(){if(e(this,Fi)||e(this,Zt)){e(this,S).debug("Cart already created or attempted, skipping");return}if(!n(this,zo,Gu).call(this)){e(this,S).debug("Not enough information to create a cart");return}let t=n(this,Uo,Ku).call(this);if(e(this,Ni)&&n(this,Do,Yu).call(this,t,e(this,Ni))){e(this,S).debug("Form data has not changed since last attempt, skipping");return}u(this,Ni,t),u(this,Zt,!0),n(this,Bo,Ju).call(this)},zo=new WeakSet,Gu=function(){if(!(e(this,p).email&&e(this,p).email.value&&e(this,qo).test(e(this,p).email.value)))return e(this,S).debug("Email is missing or invalid"),!1;let i=e(this,p).firstName&&e(this,p).firstName.value&&e(this,p).firstName.value.trim().length>=2,r=e(this,p).lastName&&e(this,p).lastName.value&&e(this,p).lastName.value.trim().length>=2;return!i&&!r?(e(this,S).debug("First name and last name are missing or too short"),!1):(e(this,S).debug("Minimum required fields are present"),!0)},Uo=new WeakSet,Ku=function(){let t={};return Object.keys(e(this,p)).forEach(i=>{e(this,p)[i]&&(t[i]=e(this,p)[i].value)}),t},Do=new WeakSet,Yu=function(t,i){return t.email===i.email&&t.firstName===i.firstName&&t.lastName===i.lastName},Bo=new WeakSet,Ju=function(){e(this,S).info("Creating prospect cart");let t=e(this,H).state.getState("cart");if(!t||!t.items||t.items.length===0){e(this,S).warn("No cart items available, skipping cart creation"),u(this,Zt,!1);return}let i=t.attribution||{};e(this,S).debug("Using attribution data from state",i);let r=e(this,p).firstName?e(this,p).firstName.value:"",s=e(this,p).lastName?e(this,p).lastName.value:"",a=e(this,p).email?e(this,p).email.value:"",l=n(this,es,Fl).call(this);n(this,Wo,Xu).call(this,a,r,s,l);let d={lines:t.items.map(m=>({package_id:m.id,quantity:m.quantity||1})),user:{first_name:r,last_name:s,email:a,phone_number:l},attribution:i};t.shippingMethod&&(d.shipping_method=t.shippingMethod.code||t.shippingMethod.id);let h=n(this,Vo,Qu).call(this);h&&Object.keys(h).length>0?n(this,Ho,Zu).call(this,h)?(e(this,S).debug("Adding valid address data to cart"),d.address=h):e(this,S).info("Address data is incomplete or invalid - sending cart with user info only"):e(this,S).debug("No address data available - sending cart with user info only"),n(this,jo,th).call(this,d)},Wo=new WeakSet,Xu=function(t,i,r,s){if(!e(this,H).state){e(this,S).warn("State manager not available, cannot update user state");return}try{let a=e(this,H).state.getState("user")||{},l={...a,email:t||a.email,firstName:i||a.firstName,lastName:r||a.lastName,phone:s||a.phone};e(this,H).state.setState("user",l),e(this,S).debug("Updated user state with user information",l)}catch(a){e(this,S).error("Error updating user state:",a)}},Ho=new WeakSet,Zu=function(t){return t.country==="US"&&(!t.postcode||!n(this,zi,$o).call(this,t.postcode,"US"))?(e(this,S).warn("US address requires a valid postal code"),!1):!0},Vo=new WeakSet,Qu=function(){let t=e(this,p).country&&e(this,p).country.value?e(this,p).country.value:"",i=e(this,p).postal&&e(this,p).postal.value?e(this,p).postal.value:"";if(t==="US"&&i&&!n(this,zi,$o).call(this,i,t))return e(this,S).warn(`Invalid postal code for US: ${i} - omitting all address data`),null;let r={};e(this,p).firstName&&e(this,p).firstName.value&&(r.first_name=e(this,p).firstName.value),e(this,p).lastName&&e(this,p).lastName.value&&(r.last_name=e(this,p).lastName.value);let s=n(this,es,Fl).call(this);return s&&(r.phone_number=s),e(this,p).address1&&e(this,p).address1.value&&(r.line1=e(this,p).address1.value),e(this,p).address2&&e(this,p).address2.value&&(r.line2=e(this,p).address2.value),e(this,p).city&&e(this,p).city.value&&(r.line4=e(this,p).city.value),e(this,p).province&&e(this,p).province.value&&(r.state=e(this,p).province.value),t&&(r.country=t),i&&(!t||n(this,zi,$o).call(this,i,t))&&(r.postcode=i),r},zi=new WeakSet,$o=function(t,i){if(!t||!i)return!0;switch(i.toUpperCase()){case"US":return/^\d{5}(-\d{4})?$/.test(t);case"CA":return/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/.test(t);case"GB":case"UK":return/^[A-Z]{1,2}[0-9][A-Z0-9]? ?[0-9][A-Z]{2}$/i.test(t);case"AU":return/^\d{4}$/.test(t);case"NZ":return/^\d{4}$/.test(t);case"DE":return/^\d{5}$/.test(t);case"FR":return/^\d{5}$/.test(t);default:return t.trim().length>0}},es=new WeakSet,Fl=function(){return e(this,p).phone?e(this,p).phone.iti&&typeof e(this,p).phone.iti.getNumber=="function"?e(this,p).phone.iti.getNumber():e(this,p).phone.value:""},jo=new WeakSet,th=function(t){if(!e(this,H).api||typeof e(this,H).api.createCart!="function"){e(this,S).error("API client not available"),u(this,Zt,!1);return}e(this,S).debug("Sending cart data to API",t),e(this,H).api.createCart(t).then(i=>{e(this,S).info("Prospect cart created successfully",i),u(this,Fi,!0),e(this,H).events&&(e(this,H).events.trigger("prospect.cartCreated",{cart:i}),e(this,Qt)?e(this,S).debug("beginCheckout event already fired, skipping"):(e(this,S).info("Triggering beginCheckout event for analytics"),e(this,H).events.beginCheckout(),u(this,Qt,!0)))}).catch(i=>{e(this,S).error("Error creating prospect cart",i),u(this,Zt,!1)})};var is,y,L,St,Ko,Yo,eh,Jo,ih,Xo,rh,Zo,sh,Qo,nh,ta,oh,ea,ah,ia,ch,ra,lh,sa,dh,na,uh,oa,hh,aa,mh,ca,gh,la,ph,Go=class{constructor(t,i,r){o(this,Yo);o(this,Jo);o(this,Xo);o(this,Zo);o(this,Qo);o(this,ta);o(this,ea);o(this,ia);o(this,ra);o(this,sa);o(this,na);o(this,oa);o(this,aa);o(this,ca);o(this,la);o(this,is,void 0);o(this,y,void 0);o(this,L,void 0);o(this,St,void 0);o(this,Ko,void 0);if(u(this,is,t),u(this,y,i),u(this,St,r),u(this,L,document.querySelector('form[os-checkout="form"]')||document.querySelector("form#combo_form")),!e(this,L)){e(this,y).warn('No checkout form found with [os-checkout="form"] selector or form#combo_form');return}e(this,L).removeAttribute("action"),e(this,L).setAttribute("method","post"),e(this,L).setAttribute("novalidate","novalidate");let s=document.createElement("input");s.type="hidden",s.name="js_enabled",s.value="true",e(this,L).appendChild(s);let a=document.createElement("input");a.type="hidden",a.name="prevent_serialization",a.value="true",e(this,L).appendChild(a);let l=d=>(d&&(d.preventDefault(),d.stopPropagation(),d.stopImmediatePropagation()),e(this,L).removeAttribute("action"),e(this,L).setAttribute("method","post"),typeof window.stop=="function"&&window.stop(),e(this,y).debug("Form direct submission prevented"),!1);e(this,L).addEventListener("submit",l,!0),e(this,L).onsubmit=l,n(this,la,ph).call(this),e(this,y).debug("CheckoutPage initialized with form found"),n(this,Yo,eh).call(this),n(this,Jo,ih).call(this)}};is=new WeakMap,y=new WeakMap,L=new WeakMap,St=new WeakMap,Ko=new WeakMap,Yo=new WeakSet,eh=function(){try{n(this,oa,hh).call(this),n(this,Zo,sh).call(this),n(this,Qo,nh).call(this),n(this,ta,oh).call(this),n(this,ea,ah).call(this),n(this,ia,ch).call(this),n(this,ra,lh).call(this),n(this,sa,dh).call(this),n(this,na,uh).call(this),n(this,aa,mh).call(this),document.dispatchEvent(new CustomEvent("os:checkout.ready",{detail:{checkoutPage:this}})),e(this,y).info("Checkout page components initialized successfully")}catch(t){e(this,y).error("Error initializing checkout components",t)}},Jo=new WeakSet,ih=function(){try{u(this,Ko,new Nt({callback:()=>n(this,Xo,rh).call(this),logger:e(this,y)})),e(this,y).debug("Konami code handler initialized")}catch(t){e(this,y).error("Error initializing Konami code handler:",t)}},Xo=new WeakSet,rh=function(){try{e(this,y).info("🎮 Konami code activated! Creating test order...");let t=Nt.showActivationMessage();setTimeout(()=>{document.body.removeChild(t),this.paymentHandler?(Nt.setTestMode(),this.paymentHandler.processPayment(),e(this,y).info("Konami code test order initiated")):(e(this,y).error("Payment handler not initialized, cannot create test order"),alert("Could not create test order: Payment handler not initialized"))},2e3)}catch(t){e(this,y).error("Error triggering Konami code Easter egg:",t)}},Zo=new WeakSet,sh=function(){try{this.addressHandler=new Xs(e(this,L),e(this,y))}catch(t){e(this,y).error("Error initializing AddressHandler",t)}},Qo=new WeakSet,nh=function(){try{this.billingAddressHandler=new oo(e(this,St)),e(this,L)&&this.billingAddressHandler&&(e(this,L).__billingAddressHandler=this.billingAddressHandler,e(this,y).debug("BillingAddressHandler initialized and attached to form"))}catch(t){e(this,y).error("Error initializing BillingAddressHandler",t)}},ta=new WeakSet,oh=function(){try{this.paymentSelector=new mo(e(this,y))}catch(t){e(this,y).error("Error initializing PaymentSelector",t)}},ea=new WeakSet,ah=function(){try{this.formValidator=new vi({debugMode:window.location.search.includes("debug=true"),logger:e(this,y)}),e(this,L)&&this.formValidator&&(e(this,L).__formValidator=this.formValidator,e(this,y).debug("FormValidator initialized and attached to form"))}catch(t){e(this,y).error("Error initializing FormValidator",t)}},ia=new WeakSet,ch=function(){try{this.paymentHandler=new qn(e(this,is),e(this,y),e(this,St))}catch(t){e(this,y).error("Error initializing PaymentHandler",t)}},ra=new WeakSet,lh=function(){try{this.addressAutocomplete=new fo(e(this,y))}catch(t){e(this,y).error("Error initializing AddressAutocomplete",t)}},sa=new WeakSet,dh=function(){try{this.phoneInputHandler=new _o(e(this,y))}catch(t){e(this,y).error("Error initializing PhoneInputHandler",t)}},na=new WeakSet,uh=function(){try{e(this,St)?(this.prospectCartHandler=new Lo(e(this,St)),e(this,y).info("ProspectCartHandler initialized")):e(this,y).warn("App instance not provided, ProspectCartHandler not initialized")}catch(t){e(this,y).error("Error initializing ProspectCartHandler",t)}},oa=new WeakSet,hh=function(){try{e(this,y).info("Fixing billing form by duplicating shipping form");let t=document.querySelector('[os-checkout-component="shipping-form"]'),i=document.querySelector('[os-checkout-component="billing-form"]');if(t&&i){e(this,y).info("Found shipping form and billing container");let r=t.cloneNode(!0),s={fname:"billing-fname",lname:"billing-lname",address1:"billing-address1",address2:"billing-address2",city:"billing-city",province:"billing-province",postal:"billing-postal",country:"billing-country",phone:"billing-phone"};r.querySelectorAll("input, select").forEach(l=>{let d=l.getAttribute("os-checkout-field");d&&s[d]&&(l.setAttribute("os-checkout-field",s[d]),l.id&&(l.id="billing_"+l.id),l.name&&(l.name="billing_"+l.name),l.getAttribute("data-name")&&l.setAttribute("data-name","Billing "+l.getAttribute("data-name")),l.getAttribute("autocomplete")&&l.setAttribute("autocomplete","billing "+l.getAttribute("autocomplete")))});let a=r.querySelector('[data-os-component="location"]');a&&a.setAttribute("data-os-component","billing-location"),i.innerHTML="",i.appendChild(r),e(this,y).info("Billing form successfully created from shipping form")}else{e(this,y).warn("Could not fix billing form - shipping form or billing container not found"),e(this,y).warn(`Shipping form found: ${!!t}, Billing container found: ${!!i}`);let r=document.querySelectorAll("[os-checkout-component]");e(this,y).warn(`Found ${r.length} checkout components:`),r.forEach(s=>{e(this,y).warn(`- ${s.getAttribute("os-checkout-component")}`)})}}catch(t){e(this,y).error("Error fixing billing form:",t)}},aa=new WeakSet,mh=function(){try{document.addEventListener("payment-method-changed",t=>{e(this,y).debug(`Payment method changed to: ${t.detail.mode}`),document.querySelector("[os-payment-mode]")?.setAttribute("os-payment-mode",t.detail.mode)}),e(this,L)&&(e(this,L).addEventListener("submit",t=>n(this,ca,gh).call(this,t)),e(this,y).debug("Form submit event listener attached")),e(this,St)&&e(this,St).events&&this.prospectCartHandler&&e(this,St).events.on("prospect.cartCreated",t=>{e(this,y).info("Prospect cart created successfully",t)}),e(this,St)&&e(this,St).events&&e(this,St).events.on("order.created",t=>{e(this,y).info("Order created successfully",t)})}catch(t){e(this,y).error("Error setting up event listeners:",t)}},ca=new WeakSet,gh=function(t){if(t&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()),e(this,y).debug("Form submission intercepted by #handleSubmit"),e(this,L)){e(this,L).removeAttribute("action"),e(this,L).setAttribute("method","post");let i=r=>(r&&(r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation()),e(this,L)&&(e(this,L).removeAttribute("action"),e(this,L).setAttribute("method","post")),typeof window.stop=="function"&&window.stop(),e(this,y).debug("Form direct submission prevented"),!1);e(this,L).onsubmit=i}return this.formValidator&&!this.formValidator.validateAllFields()?(e(this,y).warn("Form validation failed, stopping submission"),!1):(this.paymentHandler?(e(this,y).debug("Delegating to paymentHandler.processPayment()"),this.paymentHandler.processPayment()):e(this,y).error("Payment handler not initialized"),!1)},la=new WeakSet,ph=function(){try{if(!e(this,L))return;let t=e(this,L).querySelectorAll('button[type="submit"], input[type="submit"]');t.length>0?(e(this,y).debug(`Found ${t.length} submit buttons, converting to type="button"`),t.forEach((i,r)=>{i.setAttribute("type","button"),i.addEventListener("click",s=>{s.preventDefault(),e(this,y).debug(`Submit button ${r+1} clicked, delegating to payment handler`),this.paymentHandler?this.paymentHandler.processPayment():e(this,y).error("Payment handler not initialized")}),e(this,y).debug(`Converted submit button ${r+1} to type="button"`)})):e(this,y).debug("No submit buttons found in the form")}catch(t){e(this,y).error("Error disabling submit buttons:",t)}};var K,te,Ie,da=class{constructor(t){o(this,K,void 0);o(this,te,void 0);o(this,Ie,!1);u(this,K,t),u(this,te,t.logger.createModuleLogger("CAMPAIGN"))}getCampaignData(){let t=e(this,K).campaignData;return t&&!e(this,Ie)&&e(this,K).events?.viewItemList&&(e(this,te).debug("Triggering view_item_list event from getCampaignData"),setTimeout(()=>{e(this,K).events.viewItemList(t),u(this,Ie,!0)},500)),t}getCampaignName(){return e(this,K).campaignData?.name??""}getCampaignId(){return e(this,K).campaignData?.id??""}getProducts(){let t=e(this,K).campaignData?.products??[];return t.length>0&&!e(this,Ie)&&e(this,K).events?.viewItemList&&(e(this,te).debug("Triggering view_item_list event from getProducts"),e(this,K).campaignData,setTimeout(()=>{e(this,K).events.viewItemList(e(this,K).campaignData),u(this,Ie,!0)},500)),t}getProductById(t){return this.getProducts().find(i=>i.id===t)}getCurrency(){return e(this,K).campaignData?.currency??"USD"}getLocale(){return e(this,K).campaignData?.locale??"en-US"}formatPrice(t){if(typeof t!="number")return"";try{return new Intl.NumberFormat(this.getLocale(),{style:"currency",currency:this.getCurrency()}).format(t)}catch(i){return e(this,te).error("Error formatting price:",i),t.toString()}}triggerViewItemList(){if(!e(this,K).campaignData){e(this,te).warn("Cannot trigger view_item_list: No campaign data available");return}if(!e(this,K).events?.viewItemList){e(this,te).warn("Cannot trigger view_item_list: EventManager not initialized");return}e(this,te).debug("Manually triggering view_item_list event"),e(this,K).events.viewItemList(e(this,K).campaignData),u(this,Ie,!0)}};K=new WeakMap,te=new WeakMap,Ie=new WeakMap;var ft,F,Z,qe,rs,Nl,ha,fh,ma,yh,Me,Ui,ga,bh,Fe,Di,ss,Ol,ua=class{constructor(t){o(this,rs);o(this,ha);o(this,ma);o(this,Me);o(this,ga);o(this,Fe);o(this,ss);o(this,ft,void 0);o(this,F,void 0);o(this,Z,void 0);o(this,qe,{});u(this,ft,t),u(this,F,t.logger.createModuleLogger("STATE")),u(this,Z,n(this,rs,Nl).call(this)),n(this,ha,fh).call(this),n(this,ss,Ol).call(this,!1),e(this,F).info("StateManager initialized")}getState(t=null){return t?t==="cart"?{...e(this,Z).cart,totals:n(this,Fe,Di).call(this)}:t==="cart.totals"||t.startsWith("cart.totals.")?n(this,Fe,Di).call(this):t.split(".").reduce((i,r)=>i?.[r]??null,e(this,Z)):{...e(this,Z),cart:{...e(this,Z).cart,totals:n(this,Fe,Di).call(this)}}}setState(t,i,r=!0){let s=e(this,Z),a=t.split(".");for(let[l,d]of a.entries())l===a.length-1?s[d]=i:(s[d]??(s[d]={}),s=s[d]);return t.startsWith("cart.items")&&n(this,ss,Ol).call(this,!1),n(this,ma,yh).call(this),r&&(n(this,Me,Ui).call(this,t,i),t.startsWith("cart.items")&&n(this,Me,Ui).call(this,"cart",this.getState("cart"))),this}subscribe(t,i){var r;(r=e(this,qe))[t]??(r[t]=[]),e(this,qe)[t].push(i);try{i(this.getState(t),t)}catch(s){e(this,F).error(`Error in initial subscriber callback for ${t}:`,s)}return()=>e(this,qe)[t]=e(this,qe)[t].filter(s=>s!==i)}clearState(){u(this,Z,n(this,rs,Nl).call(this)),sessionStorage.removeItem("os_state"),n(this,Me,Ui).call(this,"*",e(this,Z)),e(this,F).info("State cleared")}addToCart(t){if(!t?.id||!t.name||t.price===void 0)throw e(this,F).error("Invalid item:",t),new Error("Invalid item. Must have id, name, and price.");let i=this.getState("cart"),r=e(this,ft).campaignData?.packages?.find(d=>d.ref_id.toString()===t.id.toString()||d.external_id?.toString()===t.id.toString()),s={...t,...r&&{name:r.name||t.name,price:Number.parseFloat(r.price)||t.price,price_total:Number.parseFloat(r.price_total)||t.price*(t.quantity||1),retail_price:Number.parseFloat(r.price_retail)??void 0,retail_price_total:Number.parseFloat(r.price_retail_total)??void 0,is_recurring:r.is_recurring??!1,price_recurring:r.price_recurring?Number.parseFloat(r.price_recurring):void 0,price_recurring_total:r.price_recurring_total?Number.parseFloat(r.price_recurring_total):void 0,interval:r.interval??void 0,interval_count:r.interval_count??void 0,image:r.image||t.image,external_id:r.external_id??void 0},quantity:t.quantity||1},a=i.items.findIndex(d=>d.id===t.id),l=a>=0?n(this,ga,bh).call(this,i.items,a,s):[...i.items,s];return this.setState("cart.items",l),e(this,F).info(`Item added to cart: ${s.name}`),e(this,ft).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}updateCartItem(t,i){let r=this.getState("cart"),s=r.items.findIndex(l=>l.id===t);if(s===-1)throw e(this,F).error(`Item not found in cart: ${t}`),new Error(`Item not found in cart: ${t}`);let a=[...r.items];return a[s]={...a[s],...i},a[s].quantity===0&&a.splice(s,1),this.setState("cart.items",a),e(this,F).info(`Cart item updated: ${t}`),e(this,ft).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}removeFromCart(t){let i=this.getState("cart").items.filter(r=>r.id!==t);return this.setState("cart.items",i),e(this,F).info(`Item removed from cart: ${t}`),e(this,ft).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}clearCart(){return this.setState("cart.items",[]),this.setState("cart.couponCode",null),this.setState("cart.shippingMethod",null),e(this,F).info("Cart cleared"),e(this,ft).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}setShippingMethod(t){return this.setState("cart.shippingMethod",t),e(this,F).info(`Shipping method set: ${t.code}`),e(this,ft).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}applyCoupon(t){return this.setState("cart.couponCode",t),e(this,F).info(`Coupon applied: ${t}`),e(this,ft).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}removeCoupon(){return this.setState("cart.couponCode",null),e(this,F).info("Coupon removed"),e(this,ft).triggerEvent("cart.updated",{cart:this.getState("cart")}),this.getState("cart")}isItemInCart(t){return e(this,Z).cart.items.some(i=>i.id===t)}getCartForApi(){let{items:t,shippingMethod:i,couponCode:r,attribution:s}=this.getState("cart"),{email:a,firstName:l,lastName:d,phone:h}=this.getState("user");return{lines:t.map(m=>({product_id:m.id,quantity:m.quantity||1,price:m.price})),shipping_method:i?.code??null,coupon_code:r,user:{email:a,first_name:l,last_name:d,phone:h},attribution:s||{}}}async syncCartWithApi(){try{this.setState("ui.loading",!0);let t=this.getCartForApi(),i=await e(this,ft).api.createCart(t);return e(this,F).info("Cart synced with API"),e(this,ft).triggerEvent("cart.synced",{cart:i}),i}catch(t){throw e(this,F).error("Error syncing cart with API:",t),this.setState("ui.errors.cart",t.message),t}finally{this.setState("ui.loading",!1)}}};ft=new WeakMap,F=new WeakMap,Z=new WeakMap,qe=new WeakMap,rs=new WeakSet,Nl=function(){return{cart:{items:[],totals:{subtotal:0,retail_subtotal:0,savings:0,savings_percentage:0,shipping:0,tax:0,total:0,recurring_total:0,currency:"USD",currency_symbol:"$"},shippingMethod:null,couponCode:null,attribution:{utm_source:"",utm_medium:"",utm_campaign:"",utm_content:"",utm_term:"",gclid:"",fbclid:"",sub1:"",sub2:"",sub3:"",sub4:"",sub5:"",referrer:"",landing_page:"",user_agent:"",device_type:"",fbc:"",fbp:""}},user:{email:null,firstName:null,lastName:null,phone:null},ui:{loading:!1,currentStep:"cart",errors:{}}}},ha=new WeakSet,fh=function(){try{let t=sessionStorage.getItem("os_state");if(t){let i=JSON.parse(t);u(this,Z,{...e(this,Z),...i,ui:{...e(this,Z).ui}}),e(this,F).info("State loaded from sessionStorage")}}catch(t){e(this,F).error("Error loading state from sessionStorage:",t)}},ma=new WeakSet,yh=function(){try{let t={cart:{...e(this,Z).cart,totals:n(this,Fe,Di).call(this)},user:e(this,Z).user};sessionStorage.setItem("os_state",JSON.stringify(t)),e(this,F).debug("State saved to sessionStorage")}catch(t){e(this,F).error("Error saving state to sessionStorage:",t)}},Me=new WeakSet,Ui=function(t,i){e(this,F).debug(`Notifying subscribers for path: ${t}`);for(let[r,s]of Object.entries(e(this,qe)))if(r===t||r==="*"||t.startsWith(`${r}.`)){let a=r==="*"?this.getState():this.getState(r);s.forEach(l=>{try{l(a,r)}catch(d){e(this,F).error(`Error in subscriber callback for ${r}:`,d)}})}},ga=new WeakSet,bh=function(t,i,r){let s=[...t];return s[i]={...s[i],quantity:(s[i].quantity||1)+(r.quantity||1),price_total:s[i].price*(s[i].quantity||1+(r.quantity||1)),...s[i].retail_price&&{retail_price_total:s[i].retail_price*(s[i].quantity||1+(r.quantity||1))},...s[i].price_recurring&&{price_recurring_total:s[i].price_recurring*(s[i].quantity||1+(r.quantity||1))}},s},Fe=new WeakSet,Di=function(){let{items:t,shippingMethod:i}=e(this,Z).cart,r=t.reduce((b,v)=>b+v.price*(v.quantity||1),0),s=t.reduce((b,v)=>b+(v.retail_price??v.price)*(v.quantity||1),0),a=s-r,l=s>0?a/s*100:0,d=t.reduce((b,v)=>b+(v.is_recurring&&v.price_recurring?v.price_recurring*(v.quantity||1):0),0),h=i?.price?Number.parseFloat(i.price):0,m=0,g=r+h+m,f=e(this,ft).campaignData?.currency??"USD",_={USD:"$",EUR:"€",GBP:"£"}[f]??"$";return{subtotal:r,retail_subtotal:s,savings:a,savings_percentage:l,shipping:h,tax:m,total:g,recurring_total:d,currency:f,currency_symbol:_}},ss=new WeakSet,Ol=function(t=!0){let i=n(this,Fe,Di).call(this);return e(this,Z).cart.totals=i,e(this,F).debug("Cart totals recalculated"),t&&(n(this,Me,Ui).call(this,"cart.totals",i),n(this,Me,Ui).call(this,"cart",this.getState("cart"))),i};var Bi,ht,xt,_t,ya,vh,ns,Rl,ba,wh,os,zl,as,Ul,Wi,pa,zt,ee,fa=class{constructor(t){o(this,ya);o(this,ns);o(this,ba);o(this,os);o(this,as);o(this,Wi);o(this,zt);o(this,Bi,void 0);o(this,ht,void 0);o(this,xt,void 0);o(this,_t,void 0);u(this,Bi,t),u(this,ht,t.state),u(this,xt,t.logger.createModuleLogger("CART")),n(this,ya,vh).call(this),e(this,xt).info("CartManager initialized")}clearCart(){try{return e(this,ht).clearCart()}catch(t){throw e(this,xt).error("Error clearing cart:",t),n(this,zt,ee).call(this,"Error clearing cart","error"),t}}addToCart(t){return n(this,os,zl).call(this,t)}removeFromCart(t){return n(this,Wi,pa).call(this,t)}setShippingMethod(t){try{return e(this,ht).setShippingMethod(t)}catch(i){throw e(this,xt).error("Error setting shipping method:",i),n(this,zt,ee).call(this,"Error setting shipping method","error"),i}}applyCoupon(t){try{return e(this,ht).applyCoupon(t)}catch(i){throw e(this,xt).error("Error applying coupon:",i),n(this,zt,ee).call(this,"Error applying coupon","error"),i}}removeCoupon(){try{return e(this,ht).removeCoupon()}catch(t){throw e(this,xt).error("Error removing coupon:",t),n(this,zt,ee).call(this,"Error removing coupon","error"),t}}async syncCartWithApi(){try{return await e(this,ht).syncCartWithApi()}catch(t){throw e(this,xt).error("Error syncing cart with API:",t),n(this,zt,ee).call(this,"Error syncing cart with server","error"),t}}isItemInCart(t){return e(this,ht).isItemInCart?.(t)??e(this,ht).getState("cart").items.some(i=>i.id===t)}};Bi=new WeakMap,ht=new WeakMap,xt=new WeakMap,_t=new WeakMap,ya=new WeakSet,vh=function(){u(this,_t,{addToCartButtons:document.querySelectorAll("[data-os-add-to-cart]"),cartCount:document.querySelectorAll("[data-os-cart-count]"),cartTotal:document.querySelectorAll("[data-os-cart-total]"),cartItems:document.querySelector("[data-os-cart-items]"),cartEmpty:document.querySelector("[data-os-cart-empty]"),cartContainer:document.querySelector("[data-os-cart-container]")}),e(this,_t).addToCartButtons.forEach(t=>{t.addEventListener("click",i=>{i.preventDefault();let r={id:t.getAttribute("data-os-product-id"),name:t.getAttribute("data-os-product-name"),price:Number.parseFloat(t.getAttribute("data-os-product-price")),quantity:Number.parseInt(t.getAttribute("data-os-product-quantity")??"1",10)};r.id&&r.name&&r.price?n(this,os,zl).call(this,r):e(this,xt).error("Invalid product data for add to cart button")})}),e(this,ht).subscribe("cart",()=>n(this,ns,Rl).call(this)),n(this,ns,Rl).call(this)},ns=new WeakSet,Rl=function(){let t=e(this,ht).getState("cart");e(this,_t).cartCount.forEach(s=>{let a=t.items.reduce((l,d)=>l+(d.quantity||1),0);s.textContent=a.toString(),s.classList.toggle("hidden",a===0)});let i=s=>e(this,Bi).campaign?.formatPrice(s)??s.toFixed(2);e(this,_t).cartTotal.forEach(s=>s.textContent=i(t.totals.total));let r=(s,a,l=!1)=>{let d=document.querySelector(s);d&&(d.textContent=l?`${Math.round(a)}%`:i(a),l&&a===0?d.parentElement?.classList.add("hidden"):d.parentElement?.classList.remove("hidden"))};if(r("[data-os-cart-retail-subtotal]",t.totals.retail_subtotal),r("[data-os-cart-savings]",t.totals.savings,!0),r("[data-os-cart-savings-percentage]",t.totals.savings_percentage,!0),r("[data-os-cart-recurring-total]",t.totals.recurring_total,!0),r("[data-os-cart-subtotal]",t.totals.subtotal),r("[data-os-cart-shipping]",t.totals.shipping),e(this,_t).cartItems&&(e(this,_t).cartItems.innerHTML="",t.items.forEach(s=>e(this,_t).cartItems.appendChild(n(this,ba,wh).call(this,s)))),e(this,_t).cartEmpty&&e(this,_t).cartContainer){let s=t.items.length===0;e(this,_t).cartEmpty.classList.toggle("hidden",!s),e(this,_t).cartContainer.classList.toggle("hidden",s)}},ba=new WeakSet,wh=function(t){let i=f=>e(this,Bi).campaign?.formatPrice(f)??f.toFixed(2),r=document.createElement("div");r.className="os-cart-item",r.setAttribute("data-os-cart-item-id",t.id);let s=i(t.price),a=t.retail_price?i(t.retail_price):"",l=i(t.price*(t.quantity||1)),d=t.retail_price?(t.retail_price-t.price)*(t.quantity||1):0,h=d?`
      <div class="os-cart-item-savings">
        <span class="os-cart-item-savings-label">You save:</span>
        <span class="os-cart-item-savings-value">${i(d)} (${Math.round(d/(t.retail_price*(t.quantity||1))*100)}%)</span>
      </div>
    `:"",m=t.is_recurring&&t.price_recurring?`
      <div class="os-cart-item-recurring">
        <span class="os-cart-item-recurring-label">Recurring:</span>
        <span class="os-cart-item-recurring-value">${i(t.price_recurring)} ${t.interval_count>1?`every ${t.interval_count} ${t.interval}s`:`per ${t.interval}`}</span>
      </div>
    `:"",g=t.image?`
      <div class="os-cart-item-image">
        <img src="${t.image}" alt="${t.name}" />
      </div>
    `:"";return r.innerHTML=`
      ${g}
      <div class="os-cart-item-details">
        <div class="os-cart-item-name">${t.name}</div>
        <div class="os-cart-item-price-container">
          <div class="os-cart-item-price">${s}</div>
          ${a?`<div class="os-cart-item-retail-price">${a}</div>`:""}
        </div>
        ${h}
        ${m}
      </div>
      <div class="os-cart-item-quantity">
        <button class="os-cart-item-decrease" data-os-cart-decrease="${t.id}">-</button>
        <span class="os-cart-item-quantity-value">${t.quantity||1}</span>
        <button class="os-cart-item-increase" data-os-cart-increase="${t.id}">+</button>
      </div>
      <div class="os-cart-item-total">${l}</div>
      <button class="os-cart-item-remove" data-os-cart-remove="${t.id}">×</button>
    `,r.querySelector(`[data-os-cart-decrease="${t.id}"]`)?.addEventListener("click",()=>n(this,as,Ul).call(this,t.id,(t.quantity||1)-1)),r.querySelector(`[data-os-cart-increase="${t.id}"]`)?.addEventListener("click",()=>n(this,as,Ul).call(this,t.id,(t.quantity||1)+1)),r.querySelector(`[data-os-cart-remove="${t.id}"]`)?.addEventListener("click",()=>n(this,Wi,pa).call(this,t.id)),r},os=new WeakSet,zl=function(t){try{let i=e(this,ht).addToCart(t);return n(this,zt,ee).call(this,`${t.name} added to cart`),i}catch(i){throw e(this,xt).error("Error adding item to cart:",i),n(this,zt,ee).call(this,"Error adding item to cart","error"),i}},as=new WeakSet,Ul=function(t,i){try{return i<=0?n(this,Wi,pa).call(this,t):e(this,ht).updateCartItem(t,{quantity:i})}catch(r){throw e(this,xt).error("Error updating cart item quantity:",r),n(this,zt,ee).call(this,"Error updating cart","error"),r}},Wi=new WeakSet,pa=function(t){try{return e(this,ht).removeFromCart(t)}catch(i){throw e(this,xt).error("Error removing item from cart:",i),n(this,zt,ee).call(this,"Error removing item from cart","error"),i}},zt=new WeakSet,ee=function(t,i="success"){let r=document.createElement("div");r.className=`os-message os-message-${i}`,r.textContent=t,document.body.appendChild(r),setTimeout(()=>{r.classList.add("os-message-hide"),setTimeout(()=>document.body.removeChild(r),300)},3e3)};var Hi,me,jt,Vi,ct=class{static initDebugMode(){let t=new URLSearchParams(window.location.search);return u(this,me,t.get("debugger")==="true"),e(this,me)&&!e(this,Hi)&&(this.injectDebugStyles(),u(this,jt,localStorage.getItem("os_debug_xray_enabled")==="true")),e(this,me)}static isDebugMode(){return e(this,me)}static isXrayEnabled(){return e(this,jt)}static toggleXray(t=!e(this,jt)){return e(this,me)?(u(this,jt,t),localStorage.setItem("os_debug_xray_enabled",e(this,jt).toString()),e(this,Vi).forEach(i=>{i.style.display=e(this,jt)?"block":"none"}),e(this,jt)):!1}static injectDebugStyles(){if(e(this,Hi))return;let t=document.createElement("style");t.id="os-debug-styles",t.textContent=`
      /* Common debug styles */
      .os-debug-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9999;
        border: 2px dashed rgba(255, 0, 0, 0.7);
        box-sizing: border-box;
      }
      .os-debug-label {
        position: absolute;
        top: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        font-size: 12px;
        padding: 2px 6px;
        border-radius: 0 0 0 4px;
        font-family: monospace;
        z-index: 10000;
      }
      
      /* Selector-specific styles */
      .os-debug-card-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9998;
        border: 1px solid rgba(0, 255, 255, 0.7);
        box-sizing: border-box;
      }
      .os-debug-card-label {
        position: absolute;
        top: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        font-size: 10px;
        padding: 1px 4px;
        border-radius: 0 0 0 4px;
        font-family: monospace;
        z-index: 9999;
      }
      .os--selected .os-debug-card-overlay {
        border: 2px solid rgba(0, 255, 0, 0.9);
      }
      .os--active .os-debug-card-overlay {
        background-color: rgba(255, 255, 0, 0.2);
      }
      
      /* Toggle-specific styles */
      .os-debug-toggle-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9998;
        border: 1px solid rgba(255, 165, 0, 0.7);
        box-sizing: border-box;
      }
      .os-debug-toggle-label {
        position: absolute;
        top: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        font-size: 10px;
        padding: 1px 4px;
        border-radius: 0 0 0 4px;
        font-family: monospace;
        z-index: 9999;
      }
      [data-os-active="true"] .os-debug-toggle-overlay {
        background-color: rgba(255, 165, 0, 0.3);
        border: 2px solid rgba(255, 165, 0, 0.9);
      }
      
      /* Debug bar styles */
      .os-debug-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: rgba(33, 33, 33, 0.9);
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        font-size: 14px;
        z-index: 10001;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 16px;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
      }
      
      .os-debug-bar-title {
        font-weight: 600;
        margin-right: 20px;
      }
      
      .os-debug-bar-controls {
        display: flex;
        align-items: center;
      }
      
      .os-debug-bar-control {
        margin: 0 10px;
        display: flex;
        align-items: center;
      }
      
      .os-debug-bar-toggle {
        position: relative;
        display: inline-block;
        width: 40px;
        height: 20px;
        margin-left: 8px;
      }
      
      .os-debug-bar-toggle input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      
      .os-debug-bar-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 20px;
      }
      
      .os-debug-bar-slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
      }
      
      input:checked + .os-debug-bar-slider {
        background-color: #2196F3;
      }
      
      input:checked + .os-debug-bar-slider:before {
        transform: translateX(20px);
      }
      
      .os-debug-bar-button {
        background-color: #2196F3;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 4px 10px;
        font-size: 12px;
        cursor: pointer;
        margin-left: 10px;
      }
      
      .os-debug-bar-button:hover {
        background-color: #0b7dda;
      }
    `,document.head.appendChild(t),u(this,Hi,!0)}static addDebugOverlay(t,i,r,s={}){if(!e(this,me))return;window.getComputedStyle(t).position==="static"&&(t.style.position="relative");let l=document.createElement("div");l.className=`os-debug-${r}-overlay`;let d=document.createElement("div");d.className=`os-debug-${r}-label`;let h=`ID: ${i}`;Object.entries(s).forEach(([m,g])=>{h+=` | ${m}: ${g}`}),d.textContent=h,e(this,jt)||(l.style.display="none",d.style.display="none"),t.appendChild(l),t.appendChild(d),e(this,Vi).push(l),e(this,Vi).push(d)}};Hi=new WeakMap,me=new WeakMap,jt=new WeakMap,Vi=new WeakMap,o(ct,Hi,!1),o(ct,me,!1),o(ct,jt,!1),o(ct,Vi,[]);var Y,Q,Ne,ge,ii,Sa,Sh,xa,xh,_a,_h,Ca,Ch,ji,va,Ea,Eh,cs,Dl,ls,Bl,ds,Wl,wa=class{constructor(t){o(this,Sa);o(this,xa);o(this,_a);o(this,Ca);o(this,ji);o(this,Ea);o(this,cs);o(this,ls);o(this,ds);o(this,Y,void 0);o(this,Q,void 0);o(this,Ne,{});o(this,ge,{});o(this,ii,!1);u(this,Y,t),u(this,Q,t.logger.createModuleLogger("SELECTOR")),u(this,ii,ct.initDebugMode()),n(this,Sa,Sh).call(this),e(this,Q).info("SelectorManager initialized"),e(this,ii)&&e(this,Q).info("Debug mode enabled for selectors")}};Y=new WeakMap,Q=new WeakMap,Ne=new WeakMap,ge=new WeakMap,ii=new WeakMap,Sa=new WeakSet,Sh=function(){document.querySelectorAll('[data-os-component="selector"][data-os-selection-mode="swap"]').forEach(t=>n(this,xa,xh).call(this,t)),setTimeout(()=>n(this,ds,Wl).call(this),0),e(this,Y).state?.subscribe("cart",()=>n(this,ds,Wl).call(this))},xa=new WeakSet,xh=function(t){let i=t.getAttribute("data-os-id");if(!i){e(this,Q).warn("Selector missing data-os-id",t);return}let r=t.getAttribute("data-os-selection-mode")||"swap";e(this,Ne)[i]={element:t,items:[],mode:r},e(this,ge)[i]=null,t.querySelectorAll('[data-os-element="card"]').forEach(s=>n(this,_a,_h).call(this,i,s)),e(this,ii)&&ct.addDebugOverlay(t,i,"overlay",{Mode:r})},_a=new WeakSet,_h=function(t,i){let r=i.getAttribute("data-os-package");if(!r){e(this,Q).warn("Card missing data-os-package",i);return}let a=i.querySelector(".pb-quantity__price.pb--current")?.textContent.trim()??"$0.00 USD",l=Number.parseFloat(a.match(/\$(\d+\.\d+)/)?.[1]??"0"),h=i.querySelector(".card-title")?.textContent.trim()??`Package ${r}`,m=Number.parseInt(i.getAttribute("data-os-quantity")??"1",10),g=i.getAttribute("data-os-selected")==="true",f={element:i,packageId:r,quantity:m,price:l,name:h,isPreSelected:g};e(this,Ne)[t].items.push(f),i.addEventListener("click",()=>n(this,Ca,Ch).call(this,t,f)),e(this,ii)&&ct.addDebugOverlay(i,r,"card",{Price:`$${l}`,Qty:m,PreSel:g?"Yes":"No"})},Ca=new WeakSet,Ch=function(t,i){let r=e(this,ge)[t];n(this,ji,va).call(this,t,i),n(this,Ea,Eh).call(this,t,r)},ji=new WeakSet,va=function(t,i){e(this,ge)[t]!==i&&(e(this,Ne)[t].items.forEach(r=>{r.element.classList.remove("os--selected"),r.element.setAttribute("data-os-selected","false"),r.isSelected=!1}),i.element.classList.add("os--selected"),i.element.setAttribute("data-os-selected","true"),i.isSelected=!0,e(this,ge)[t]=i,e(this,Q).debug(`Selected item ${i.packageId} in selector ${t}`))},Ea=new WeakSet,Eh=function(t,i){if(!e(this,Y).cart){e(this,Q).error("Cart manager not available");return}let r=e(this,ge)[t];r&&(i&&i.packageId!==r.packageId&&n(this,ls,Bl).call(this,i),e(this,Y).cart.isItemInCart(r.packageId)||n(this,cs,Dl).call(this,r))},cs=new WeakSet,Dl=function(t){if(!e(this,Y).cart){e(this,Q).error("Cart manager not available in addItemToCart");return}if(typeof e(this,Y).cart.addToCart!="function"){e(this,Q).error("addToCart is not a function on this.#app.cart:",e(this,Y).cart);return}e(this,Q).info(`Adding item ${t.packageId} to cart`),e(this,Y).cart.addToCart({id:t.packageId,name:t.name,price:t.price,quantity:t.quantity,type:"package"}),t.element.classList.add("os--active"),t.element.setAttribute("data-os-active","true")},ls=new WeakSet,Bl=function(t){if(!e(this,Y).cart){e(this,Q).error("Cart manager not available in removeItemFromCart");return}if(typeof e(this,Y).cart.removeFromCart!="function"){e(this,Q).error("removeFromCart is not a function on this.#app.cart:",e(this,Y).cart);return}e(this,Q).info(`Removing item ${t.packageId} from cart`),e(this,Y).cart.removeFromCart(t.packageId),t.element.classList.remove("os--active"),t.element.setAttribute("data-os-active","false")},ds=new WeakSet,Wl=function(){if(!e(this,Y).cart){e(this,Q).debug("Cart manager not available for sync");return}if(!e(this,Y).state?.getState("cart")){e(this,Q).debug("Cart state not available");return}e(this,Q).debug("Syncing with cart, this.#app.cart:",e(this,Y).cart),Object.keys(e(this,Ne)).forEach(i=>{let r=e(this,Ne)[i].items,s=r.filter(a=>e(this,Y).cart.isItemInCart(a.packageId));if(s.length>0){let a=s[0];n(this,ji,va).call(this,i,a),s.forEach(l=>{l.packageId!==a.packageId&&n(this,ls,Bl).call(this,l)})}else if(!e(this,ge)[i]){let a=r.find(l=>l.isPreSelected);a&&(n(this,ji,va).call(this,i,a),n(this,cs,Dl).call(this,a))}r.forEach(a=>{let l=e(this,Y).cart.isItemInCart(a.packageId);a.element.classList.toggle("os--active",l),a.element.setAttribute("data-os-active",l.toString())})})};var Gi,It,lt,Ki,ka,Ah,$a,Th,La,kh,Pa,$h,us,Hl,Yi,Aa,Ia,Lh,hs,Vl,qa,Ph,Ma,Ih,Ta=class{constructor(t){o(this,ka);o(this,$a);o(this,La);o(this,Pa);o(this,us);o(this,Yi);o(this,Ia);o(this,hs);o(this,qa);o(this,Ma);o(this,Gi,{});o(this,It,void 0);o(this,lt,void 0);o(this,Ki,!1);u(this,It,t),u(this,lt,t.logger.createModuleLogger("TOGGLE")),u(this,Ki,ct.initDebugMode()),n(this,ka,Ah).call(this),e(this,It).state.subscribe("cart",()=>n(this,Ia,Lh).call(this)),e(this,lt).info("ToggleManager initialized"),e(this,Ki)&&e(this,lt).info("Debug mode enabled for toggle items")}};Gi=new WeakMap,It=new WeakMap,lt=new WeakMap,Ki=new WeakMap,ka=new WeakSet,Ah=function(){let t=document.querySelectorAll('[data-os-action="toggle-item"]');if(!t.length){e(this,lt).debug("No toggle item buttons found in the DOM");return}e(this,lt).info(`Found ${t.length} toggle item buttons`),t.forEach(i=>n(this,$a,Th).call(this,i))},$a=new WeakSet,Th=function(t){let i=t.getAttribute("data-os-package");if(!i){e(this,lt).warn("Toggle item missing data-os-package attribute",t);return}let r=Number.parseInt(t.getAttribute("data-os-quantity")??"1",10),s=t.getAttribute("data-os-id")??`toggle-${i}`;e(this,Gi)[s]={element:t,packageId:i,quantity:r},n(this,Yi,Aa).call(this,t,i),t.addEventListener("click",a=>{a.preventDefault(),n(this,Pa,$h).call(this,s)}),e(this,Ki)&&n(this,La,kh).call(this,t,s,i,r),e(this,lt).debug(`Initialized toggle item ${s} for package ${i}`)},La=new WeakSet,kh=function(t,i,r,s){let a=n(this,us,Hl).call(this,r),l=a?a.price:"N/A";ct.addDebugOverlay(t,i,"toggle",{Package:r,Qty:s,Price:l})},Pa=new WeakSet,$h=function(t){let i=e(this,Gi)[t];if(!i){e(this,lt).error(`Toggle item ${t} not found`);return}let{packageId:r,quantity:s,element:a}=i,l=n(this,hs,Vl).call(this,r);if(l)n(this,Ma,Ih).call(this,r),e(this,lt).info(`Toggled OFF item ${r}`);else{let d=n(this,us,Hl).call(this,r);if(!d){e(this,lt).error(`Package ${r} not found in campaign data`);return}n(this,qa,Ph).call(this,{id:r,name:d.name,price:Number.parseFloat(d.price),quantity:s,type:"package"}),e(this,lt).info(`Toggled ON item ${r}`)}n(this,Yi,Aa).call(this,a,r),e(this,It).triggerEvent("toggle.changed",{toggleId:t,packageId:r,isActive:!l})},us=new WeakSet,Hl=function(t){return e(this,It).campaignData?.packages?e(this,It).campaignData.packages.find(i=>i.ref_id.toString()===t.toString())??null:(e(this,lt).error("Campaign data not available"),null)},Yi=new WeakSet,Aa=function(t,i){let r=n(this,hs,Vl).call(this,i);t.classList.toggle("os--active",r),t.setAttribute("data-os-active",r.toString())},Ia=new WeakSet,Lh=function(){Object.values(e(this,Gi)).forEach(({element:t,packageId:i})=>n(this,Yi,Aa).call(this,t,i))},hs=new WeakSet,Vl=function(t){return e(this,It).state.getState("cart").items.some(i=>i.id===t)},qa=new WeakSet,Ph=function(t){if(!e(this,It).cart){e(this,lt).error("Cart manager not available");return}e(this,It).cart.addToCart(t)},Ma=new WeakSet,Ih=function(t){if(!e(this,It).cart){e(this,lt).error("Cart manager not available");return}e(this,It).cart.removeFromCart(t)};var ri,Ct,pe,fe,si,ms,za,qh,Ua,Mh,gs,jl,Ji,Fa,Xi,Na,ps,Gl,Da,Fh,Zi,Oa,Ra=class{constructor(t){o(this,za);o(this,Ua);o(this,gs);o(this,Ji);o(this,Xi);o(this,ps);o(this,Da);o(this,Zi);o(this,ri,void 0);o(this,Ct,void 0);o(this,pe,!1);o(this,fe,null);o(this,si,null);o(this,ms,!1);u(this,ri,t),u(this,Ct,t.logger.createModuleLogger("DEBUG")),u(this,ms,ct.initDebugMode()),n(this,za,qh).call(this),e(this,Ct).info("DebugManager initialized")}};ri=new WeakMap,Ct=new WeakMap,pe=new WeakMap,fe=new WeakMap,si=new WeakMap,ms=new WeakMap,za=new WeakSet,qh=function(){window.showMiniCart=()=>n(this,Ji,Fa).call(this),window.hideMiniCart=()=>n(this,Xi,Na).call(this),window.toggleMiniCart=()=>n(this,ps,Gl).call(this),window.toggleXray=t=>n(this,gs,jl).call(this,t),e(this,ms)&&(e(this,Ct).info("Debug mode activated via URL parameter"),n(this,Ua,Mh).call(this),localStorage.getItem("os_debug_mini_cart_visible")==="true"&&n(this,Ji,Fa).call(this)),e(this,ri).state?.subscribe("cart",()=>{e(this,pe)&&n(this,Zi,Oa).call(this)}),e(this,Ct).debug("Debug methods exposed to window object")},Ua=new WeakSet,Mh=function(){if(e(this,si))return;let t=document.createElement("div");t.className="os-debug-bar";let i=document.createElement("div");i.className="os-debug-bar-left";let r=document.createElement("span");r.className="os-debug-bar-title",r.textContent="29next Debug Tools",i.appendChild(r);let s=document.createElement("div");s.className="os-debug-bar-controls";let a=document.createElement("div");a.className="os-debug-bar-control";let l=document.createElement("span");l.textContent="X-ray View";let d=document.createElement("label");d.className="os-debug-bar-toggle";let h=document.createElement("input");h.type="checkbox",h.checked=ct.isXrayEnabled(),h.addEventListener("change",()=>n(this,gs,jl).call(this,h.checked));let m=document.createElement("span");m.className="os-debug-bar-slider",d.append(h,m),a.append(l,d);let g=document.createElement("div");g.className="os-debug-bar-control";let f=document.createElement("button");f.className="os-debug-bar-button",f.textContent="Toggle Mini-Cart",f.addEventListener("click",()=>n(this,ps,Gl).call(this)),g.appendChild(f),s.append(a,g),t.append(i,s),document.body.appendChild(t),u(this,si,t)},gs=new WeakSet,jl=function(t){let i=ct.toggleXray(t);if(e(this,si)){let r=e(this,si).querySelector('input[type="checkbox"]');r&&(r.checked=i)}return e(this,Ct).info(`X-ray view ${i?"enabled":"disabled"}`),i},Ji=new WeakSet,Fa=function(){if(e(this,pe)){e(this,Ct).debug("Mini-cart already visible");return}e(this,Ct).info("Showing mini-cart widget"),e(this,fe)??u(this,fe,n(this,Da,Fh).call(this)),e(this,fe).style.display="block",u(this,pe,!0),localStorage.setItem("os_debug_mini_cart_visible","true"),n(this,Zi,Oa).call(this)},Xi=new WeakSet,Na=function(){if(!e(this,pe)){e(this,Ct).debug("Mini-cart already hidden");return}e(this,Ct).info("Hiding mini-cart widget"),e(this,fe)&&(e(this,fe).style.display="none"),u(this,pe,!1),localStorage.setItem("os_debug_mini_cart_visible","false")},ps=new WeakSet,Gl=function(){e(this,pe)?n(this,Xi,Na).call(this):n(this,Ji,Fa).call(this)},Da=new WeakSet,Fh=function(){let t=document.createElement("div");t.className="os-debug-mini-cart",t.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      width: 300px;
      max-height: 400px;
      overflow-y: auto;
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      z-index: 9999;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      font-size: 14px;
      display: none;
    `;let i=document.createElement("div");i.className="os-debug-mini-cart-header",i.style.cssText=`
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      background-color: #f5f5f5;
      border-bottom: 1px solid #eee;
    `;let r=document.createElement("div");r.className="os-debug-mini-cart-title",r.textContent="Debug Mini-Cart",r.style.fontWeight="600";let s=document.createElement("div");s.style.display="flex",s.style.alignItems="center";let a=document.createElement("button");a.className="os-debug-mini-cart-refresh",a.textContent="↻",a.title="Refresh cart data",a.style.cssText=`
      background: none;
      border: none;
      font-size: 16px;
      cursor: pointer;
      padding: 0 8px;
      line-height: 1;
      color: #666;
    `,a.addEventListener("click",()=>{n(this,Zi,Oa).call(this),e(this,Ct).info("Mini-cart data refreshed manually")});let l=document.createElement("button");l.className="os-debug-mini-cart-close",l.textContent="×",l.style.cssText=`
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      padding: 0;
      line-height: 1;
    `,l.addEventListener("click",()=>n(this,Xi,Na).call(this)),s.append(a,l),i.append(r,s);let d=document.createElement("div");d.className="os-debug-mini-cart-content",d.style.padding="15px";let h=document.createElement("div");return h.className="os-debug-mini-cart-footer",h.style.cssText=`
      padding: 10px 15px;
      background-color: #f5f5f5;
      border-top: 1px solid #eee;
      font-size: 12px;
      color: #666;
      text-align: center;
    `,h.textContent="Use window.hideMiniCart() to hide this widget",t.append(i,d,h),document.body.appendChild(t),t},Zi=new WeakSet,Oa=function(){if(!e(this,fe))return;let t=e(this,fe).querySelector(".os-debug-mini-cart-content");if(!t)return;let i=e(this,ri).state?.getState("cart");if(!i){t.innerHTML='<div style="color: #999; text-align: center;">Cart data not available</div>';return}e(this,Ct).debug("Updating mini-cart with cart data:",i);let r=a=>e(this,ri).campaign?.formatPrice(a)??`$${a.toFixed(2)}`,s="";i.items?.length?(s+='<div style="margin-bottom: 15px;">',s+='<div style="font-weight: 600; margin-bottom: 10px;">Items:</div>',s+='<ul style="list-style: none; padding: 0; margin: 0;">',i.items.forEach(a=>{s+=`
          <li style="padding: 5px 0; border-bottom: 1px solid #eee;">
            <div style="display: flex; justify-content: space-between;">
              <div style="font-weight: 500;">${a.name}</div>
              <div>${a.quantity} × ${r(a.price)}</div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
              <div style="color: #666; font-size: 12px;">ID: ${a.id}</div>
              <div style="font-weight: 500;">${r(a.price*a.quantity)}</div>
            </div>
          </li>
        `}),s+="</ul></div>"):s+='<div style="color: #999; text-align: center; margin-bottom: 15px;">Cart is empty</div>',i.totals?(s+="<div>",s+='<div style="font-weight: 600; margin-bottom: 10px;">Totals:</div>',s+='<ul style="list-style: none; padding: 0; margin: 0;">',s+=`
        <li style="display: flex; justify-content: space-between; padding: 3px 0;">
          <div>Subtotal:</div>
          <div>${r(i.totals.subtotal)}</div>
        </li>
      `,i.totals.retail_subtotal>i.totals.subtotal&&(s+=`
          <li style="display: flex; justify-content: space-between; padding: 3px 0;">
            <div>Retail Subtotal:</div>
            <div>${r(i.totals.retail_subtotal)}</div>
          </li>
        `,i.totals.savings&&(s+=`
            <li style="display: flex; justify-content: space-between; padding: 3px 0; color: #e53935;">
              <div>Savings:</div>
              <div>${r(i.totals.savings)} (${Math.round(i.totals.savings_percentage)}%)</div>
            </li>
          `)),i.totals.shipping>0&&(s+=`
          <li style="display: flex; justify-content: space-between; padding: 3px 0;">
            <div>Shipping:</div>
            <div>${r(i.totals.shipping)}</div>
          </li>
        `),i.totals.recurring_total>0&&(s+=`
          <li style="display: flex; justify-content: space-between; padding: 3px 0; color: #2196f3;">
            <div>Recurring Total:</div>
            <div>${r(i.totals.recurring_total)}</div>
          </li>
        `),s+=`
        <li style="display: flex; justify-content: space-between; padding: 3px 0; font-weight: 600; margin-top: 5px; border-top: 1px solid #eee;">
          <div>Total:</div>
          <div>${r(i.totals.total)}</div>
        </li>
      `,s+="</ul></div>"):s+='<div style="color: #999; text-align: center; margin-bottom: 15px;">Cart totals not available</div>',t.innerHTML=s};var Wa,mt,Oe,Ha,fs,Kl,Va,Nh,ja,Oh,Ga,Rh,ys,Yl,Ba=class{constructor(t){o(this,fs);o(this,Va);o(this,ja);o(this,Ga);o(this,ys);o(this,Wa,void 0);o(this,mt,void 0);o(this,Oe,new Map);o(this,Ha,"os-timer-");u(this,Wa,t),u(this,mt,t.logger.createModuleLogger("TIMER")),n(this,fs,Kl).call(this),e(this,mt).infoWithTime("TimerManager initialized")}refreshTimers(){e(this,mt).infoWithTime("Refreshing timers"),e(this,Oe).forEach(t=>{t.intervalId&&(clearInterval(t.intervalId),t.intervalId=null)}),e(this,Oe).clear(),n(this,fs,Kl).call(this)}getTimers(){return e(this,Oe)}};Wa=new WeakMap,mt=new WeakMap,Oe=new WeakMap,Ha=new WeakMap,fs=new WeakSet,Kl=function(){e(this,mt).infoWithTime("Initializing timers");let t=document.querySelectorAll('[data-os-element="timer"]');if(t.length===0){e(this,mt).debugWithTime("No timer elements found on page");return}e(this,mt).debugWithTime(`Found ${t.length} timer elements`),t.forEach(i=>{n(this,Va,Nh).call(this,i)})},Va=new WeakSet,Nh=function(t){let i=t.closest('[data-os-element="timer-text"]');i||e(this,mt).warnWithTime('Timer element has no parent with data-os-element="timer-text", using default configuration');let r=n(this,ja,Oh).call(this,t,i);if(!r.duration){e(this,mt).warnWithTime(`Timer element is missing duration, skipping: ${t.outerHTML}`);return}let s=i?i.innerHTML:null,a=+new Date,l=r.persistenceId;if(l){let m=e(this,Ha)+l,g=parseInt(localStorage.getItem(m)||"");g>0?(a=g,e(this,mt).debugWithTime(`Loaded persisted timer start time for ${l}: ${new Date(a).toISOString()}`)):(localStorage.setItem(m,String(a)),e(this,mt).debugWithTime(`Saved new timer start time for ${l}: ${new Date(a).toISOString()}`))}else e(this,mt).debugWithTime(`Timer has no persistence ID, it will reset with every page load: ${t.outerHTML}`);let d={element:t,parentElement:i,config:r,startTime:a,intervalId:null,originalParentContent:s};e(this,Oe).set(t,d);let h=()=>{let g=(+new Date-a)/1e3,f=Math.round(r.duration-g);if(f<=0){f=0,r.expiryText?i&&r.replaceEntireContent?i.innerHTML=r.expiryText:t.innerText=r.expiryText:t.innerText="00:00",d.intervalId&&(clearInterval(d.intervalId),d.intervalId=null),e(this,Oe).delete(t),n(this,ys,Yl).call(this,"expired",t,{timerElement:t,parentElement:i,config:r});return}let _=Math.floor(f/3600);f-=_*3600;let b=Math.floor(f/60);f-=b*60;let v=n(this,Ga,Rh).call(this,_,b,f,r.format);t.innerText=v,n(this,ys,Yl).call(this,"updated",t,{timerElement:t,parentElement:i,config:r,remaining:{hours:_,minutes:b,seconds:f},formattedTime:v})};h(),d.intervalId=setInterval(h,1e3),e(this,mt).debugWithTime(`Timer initialized: ${r.duration} seconds, persistence ID: ${r.persistenceId||"none"}`)},ja=new WeakSet,Oh=function(t,i){let r={duration:0,persistenceId:null,expiryText:null,format:"auto",replaceEntireContent:!1};return t.dataset.osDuration?r.duration=parseInt(t.dataset.osDuration):i?.dataset.osTimerDuration&&(r.duration=parseInt(i.dataset.osTimerDuration)),t.dataset.osPersistenceId?r.persistenceId=t.dataset.osPersistenceId:i?.dataset.osTimerPersistenceId&&(r.persistenceId=i.dataset.osTimerPersistenceId),t.dataset.osExpiryText?r.expiryText=t.dataset.osExpiryText:i?.dataset.osTimerExpiryText&&(r.expiryText=i.dataset.osTimerExpiryText),t.dataset.osFormat?r.format=t.dataset.osFormat:i?.dataset.osTimerFormat&&(r.format=i.dataset.osTimerFormat),(t.dataset.osReplaceEntireContent==="true"||i?.dataset.osTimerReplaceEntireContent==="true")&&(r.replaceEntireContent=!0),r.expiryText&&(r.expiryText.includes("<")||r.expiryText.includes(">"))&&(r.replaceEntireContent=!0),r},Ga=new WeakSet,Rh=function(t,i,r,s){let a=l=>l.toString().padStart(2,"0");return s==="hh:mm:ss"||s==="auto"&&t>0?`${a(t)}:${a(i)}:${a(r)}`:s==="mm:ss"||s==="auto"&&i>0?`${a(i)}:${a(r)}`:s==="ss"?a(r):`${a(i)}:${a(r)}`},ys=new WeakSet,Yl=function(t,i,r={}){let s=new CustomEvent(`os:timer.${t}`,{bubbles:!0,cancelable:!0,detail:{...r,manager:this}});i.dispatchEvent(s),document.dispatchEvent(s),e(this,mt).debugWithTime(`Timer event triggered: ${t}`)};var Qi,Et,tr,bs,Jl,Ya,zh,Ja,Uh,Ka=class{constructor(t){o(this,bs);o(this,Ya);o(this,Ja);o(this,Qi,void 0);o(this,Et,void 0);o(this,tr,new Map);u(this,Qi,t),u(this,Et,t.logger.createModuleLogger("DISPLAY")),n(this,bs,Jl).call(this),e(this,Qi).state.subscribe("cart",()=>this.refreshDisplayElements()),e(this,Et).infoWithTime("DisplayManager initialized")}refreshDisplayElements(){e(this,Et).debugWithTime("Refreshing display elements");let i=e(this,Qi).state.getState("cart").items.map(r=>r.id.toString());e(this,tr).forEach((r,s)=>{n(this,Ya,zh).call(this,s,r,i)})}refresh(){e(this,Et).infoWithTime("Manually refreshing display elements"),e(this,tr).clear(),n(this,bs,Jl).call(this)}};Qi=new WeakMap,Et=new WeakMap,tr=new WeakMap,bs=new WeakSet,Jl=function(){e(this,Et).infoWithTime("Initializing display elements");let t=document.querySelectorAll('[data-os-cart="swap-display"]');if(t.length===0){e(this,Et).debugWithTime("No swap display containers found on page");return}e(this,Et).debugWithTime(`Found ${t.length} swap display containers`),t.forEach((i,r)=>{let s=i.dataset.osId||`auto-container-${r}`,a=i.querySelectorAll('[data-os-in-cart="display"]');if(a.length===0){e(this,Et).warnWithTime(`Container ${s} has no display elements`);return}e(this,tr).set(i,{id:s,elements:Array.from(a).map(l=>({element:l,packageId:l.dataset.osPackage}))}),e(this,Et).debugWithTime(`Initialized container ${s} with ${a.length} display elements`)}),this.refreshDisplayElements()},Ya=new WeakSet,zh=function(t,i,r){let{id:s,elements:a}=i,l=!1;for(let{element:d,packageId:h}of a)h&&r.includes(h)?(d.style.display="block",l=!0,e(this,Et).debugWithTime(`Showing element for package ${h} in container ${s}`)):d.style.display="none";!l&&a.length>0,n(this,Ja,Uh).call(this,"updated",t,{containerId:s,hasVisibleElement:l,visiblePackageIds:a.filter(({element:d})=>d.style.display==="block").map(({packageId:d})=>d)})},Ja=new WeakSet,Uh=function(t,i,r={}){let s=new CustomEvent(`os:display.${t}`,{bubbles:!0,cancelable:!0,detail:{...r,manager:this}});i.dispatchEvent(s),document.dispatchEvent(s),e(this,Et).debugWithTime(`Display event triggered: ${t}`)};var Re,x,C,ie,er,vs,Xl,Za,Dh,Qa,Bh,tc,Wh,ec,Hh,ic,Vh,rc,jh,sc,Gh,nc,Kh,At,Ut,oc,Yh,ac,Jh,Zl,fg,Xa=class{constructor(t){o(this,vs);o(this,Za);o(this,Qa);o(this,tc);o(this,ec);o(this,ic);o(this,rc);o(this,sc);o(this,nc);o(this,At);o(this,oc);o(this,ac);o(this,Zl);o(this,Re,void 0);o(this,x,void 0);o(this,C,{lineDisplays:[],summaryContainers:[],savingsBars:[],shippingBars:[],grandTotals:[],summaryBars:[],summaryPanels:[],summaryTexts:[],summaryIcons:[],compareTotalElements:[]});o(this,ie,{currencySymbol:"$",showComparePricing:!0,showProductImages:!0,showTaxPendingMessage:!0});o(this,er,null);u(this,Re,t),u(this,x,t.logger.createModuleLogger("CART_DISPLAY")),n(this,vs,Xl).call(this),e(this,Re).state.subscribe("cart",()=>this.updateCartDisplay()),e(this,x).infoWithTime("CartDisplayManager initialized")}updateCartDisplay(){e(this,x).debugWithTime("Updating cart display");let t=e(this,Re).state.getState("cart");if(!t){e(this,x).warnWithTime("Cart data not available");return}e(this,x).debugWithTime(`Cart data: ${JSON.stringify(t)}`),n(this,tc,Wh).call(this,t.items),n(this,ic,Vh).call(this,t.totals),n(this,rc,jh).call(this,t.totals.shipping,t.shippingMethod),n(this,sc,Gh).call(this,t.totals),n(this,nc,Kh).call(this,t.totals.total),n(this,ac,Jh).call(this,t.totals),e(this,x).debugWithTime("Cart display updated")}refresh(){e(this,x).infoWithTime("Manually refreshing cart display"),n(this,vs,Xl).call(this)}};Re=new WeakMap,x=new WeakMap,C=new WeakMap,ie=new WeakMap,er=new WeakMap,vs=new WeakSet,Xl=function(){if(e(this,x).infoWithTime("Initializing cart display"),e(this,C).lineDisplays=document.querySelectorAll('[data-os-cart-summary="line-display"]'),e(this,C).summaryContainers=document.querySelectorAll('[data-os-cart="summary"]'),e(this,C).savingsBars=document.querySelectorAll('[data-os-cart-summary="savings"]'),e(this,C).shippingBars=document.querySelectorAll('[data-os-cart-summary="shipping-bar"]'),e(this,C).grandTotals=document.querySelectorAll('[data-os-cart-summary="grand-total"]'),e(this,C).summaryBars=document.querySelectorAll('[os-checkout-element="summary-bar"]'),e(this,C).summaryPanels=document.querySelectorAll('[os-checkout-element="summary-mobile"]'),e(this,C).summaryTexts=document.querySelectorAll('[os-checkout-element="summary-text"]'),e(this,C).summaryIcons=document.querySelectorAll("[os-summary-icon]"),e(this,C).compareTotalElements=document.querySelectorAll('[data-os-cart-summary="compare-total"]'),e(this,x).debugWithTime(`Line displays found: ${e(this,C).lineDisplays.length}`),e(this,x).debugWithTime(`Summary containers found: ${e(this,C).summaryContainers.length}`),e(this,x).debugWithTime(`Savings bars found: ${e(this,C).savingsBars.length}`),e(this,x).debugWithTime(`Shipping bars found: ${e(this,C).shippingBars.length}`),e(this,x).debugWithTime(`Grand total elements found: ${e(this,C).grandTotals.length}`),e(this,x).debugWithTime(`Summary bars found: ${e(this,C).summaryBars.length}`),e(this,x).debugWithTime(`Summary panels found: ${e(this,C).summaryPanels.length}`),e(this,x).debugWithTime(`Summary texts found: ${e(this,C).summaryTexts.length}`),e(this,x).debugWithTime(`Summary icons found: ${e(this,C).summaryIcons.length}`),e(this,x).debugWithTime(`Compare total elements found: ${e(this,C).compareTotalElements.length}`),e(this,C).summaryContainers.length>0){let i=e(this,C).summaryContainers[0];e(this,ie).showComparePricing=i.dataset.showComparePricing!=="false",e(this,ie).showProductImages=i.dataset.showProductImages!=="false",e(this,ie).showTaxPendingMessage=i.dataset.showTaxPendingMessage!=="false",e(this,ie).currencySymbol=i.dataset.currencySymbol||"$"}let t=document.querySelector('[data-os-cart-summary="line-item"]');t&&u(this,er,t.cloneNode(!0)),n(this,Za,Dh).call(this),e(this,x).debugWithTime("Cart display elements initialized"),this.updateCartDisplay()},Za=new WeakSet,Dh=function(){let{summaryBars:t,summaryPanels:i,summaryTexts:r,summaryIcons:s}=e(this,C);if(!t.length||!i.length){e(this,x).debugWithTime("Summary toggle elements not found, skipping initialization");return}e(this,x).debugWithTime("Initializing summary toggle"),i.forEach((a,l)=>{if(a.classList.add("no-transition"),!a.classList.contains("cc-expanded")){a.style.height="0",a.style.opacity="0",a.style.overflow="hidden";let d=r[l];d&&(d.textContent="Show Order Summary")}requestAnimationFrame(()=>{a.classList.remove("no-transition"),a.style.transition="height 0.3s ease-out, opacity 0.25s ease-out"})}),t.forEach((a,l)=>{a.addEventListener("click",d=>{d.preventDefault(),n(this,Qa,Bh).call(this,l)})}),window.addEventListener("resize",n(this,oc,Yh).call(this,()=>{i.forEach(a=>{a.classList.contains("cc-expanded")&&(a.style.height="auto")})},250)),e(this,x).debugWithTime("Summary toggle initialized")},Qa=new WeakSet,Bh=function(t=0){let{summaryPanels:i,summaryTexts:r,summaryIcons:s}=e(this,C),a=i[t],l=r[t],d=s[t];if(!a)return;if(!a.classList.contains("cc-expanded"))a.classList.add("cc-expanded"),a.style.height=`${a.scrollHeight}px`,a.style.opacity="1",l&&(l.textContent="Hide Order Summary"),d&&(d.style.transform="rotate(180deg)"),a.addEventListener("transitionend",()=>{a.classList.contains("cc-expanded")&&(a.style.height="auto")},{once:!0}),e(this,x).debugWithTime("Summary panel expanded");else{let m=a.scrollHeight;a.style.height=`${m}px`,a.offsetHeight,a.style.height="0",a.style.opacity="0",l&&(l.textContent="Show Order Summary"),d&&(d.style.transform="rotate(0deg)"),a.addEventListener("transitionend",()=>{a.style.height==="0px"&&a.classList.remove("cc-expanded")},{once:!0}),e(this,x).debugWithTime("Summary panel collapsed")}},tc=new WeakSet,Wh=function(t){if(!e(this,C).lineDisplays.length||!e(this,er)){e(this,x).warnWithTime("Line displays or template not found");return}if(!t||t.length===0){e(this,x).debugWithTime("No items in cart");return}e(this,C).lineDisplays.forEach(r=>{r.innerHTML="",t.forEach(s=>{let a=n(this,ec,Hh).call(this,s);r.appendChild(a)})});let i=document.querySelectorAll('[data-os-cart-summary="summary-scroll"]');if(i.length){let r=t.length>2;i.forEach(s=>{s.classList.toggle("hide",!r)})}},ec=new WeakSet,Hh=function(t){let i=e(this,er).cloneNode(!0),r=i.querySelector('[data-os-cart-summary="line-title"]');if(r&&(r.textContent=t.name),e(this,ie).showProductImages){let h=i.querySelector('[data-os-cart-summary="line-image"]');h&&t.image&&(h.src=t.image,h.alt=t.name)}let s=i.querySelector('[os-cart="line_item-qty"]');s&&(s.textContent=t.quantity||1);let a=i.querySelector('[data-os-cart-summary="line-compare"]'),l=i.querySelector('[data-os-cart-summary="line-sale"]');a&&t.retail_price&&e(this,ie).showComparePricing?(a.textContent=n(this,At,Ut).call(this,t.retail_price*(t.quantity||1)),a.classList.remove("hide")):a&&a.classList.add("hide"),l&&(l.textContent=n(this,At,Ut).call(this,t.price*(t.quantity||1)));let d=i.querySelector('[data-os-cart-summary="line-saving-percent"]');if(d&&t.retail_price){let h=Math.round((1-t.price/t.retail_price)*100);if(h>0){let m=d.dataset.osFormat||"default",g=`${h}% OFF`;m==="parenthesis"&&(g=`(${h}% OFF)`),d.textContent=g,d.classList.remove("hide")}else d.classList.add("hide")}else d&&d.classList.add("hide");return i},ic=new WeakSet,Vh=function(t){},rc=new WeakSet,jh=function(t,i){if(!e(this,C).shippingBars.length){e(this,x).warnWithTime("Shipping bars not found");return}e(this,C).shippingBars.forEach(r=>{let s=r.querySelector('[data-os-cart-summary="shipping-compare"]'),a=r.querySelector('[data-os-cart-summary="shipping-current"]');s&&a&&(t===0&&i?.standard_cost>0?(s.textContent=n(this,At,Ut).call(this,i.standard_cost),a.textContent="FREE",s.classList.remove("hide")):t>0?(a.textContent=n(this,At,Ut).call(this,t),s.classList.add("hide")):(a.textContent="FREE",s.classList.add("hide")))})},sc=new WeakSet,Gh=function(t){if(!e(this,C).savingsBars.length){e(this,x).warnWithTime("Savings bars not found");return}e(this,C).savingsBars.forEach(s=>{let a=s.querySelector('[data-os-cart-summary="savings-amount"]'),l=s.querySelector('[data-os-cart-summary="savings-percentage"]');t.savings>0&&t.savings_percentage>0?(a&&(a.textContent=n(this,At,Ut).call(this,t.savings),e(this,x).debugWithTime(`Updated savings amount to: ${n(this,At,Ut).call(this,t.savings)}`)),l&&(l.textContent=`${Math.round(t.savings_percentage)}% OFF`,e(this,x).debugWithTime(`Updated savings percentage to: ${Math.round(t.savings_percentage)}% OFF`)),s.classList.remove("hide")):s.classList.add("hide")});let i=document.querySelectorAll('[data-os-cart-summary="savings-amount"]'),r=document.querySelectorAll('[data-os-cart-summary="savings-percentage"]');t.savings>0&&t.savings_percentage>0&&(i.forEach(s=>{s.textContent=n(this,At,Ut).call(this,t.savings)}),r.forEach(s=>{s.textContent=`${Math.round(t.savings_percentage)}% OFF`}))},nc=new WeakSet,Kh=function(t){if(!e(this,C).grandTotals.length){e(this,x).warnWithTime("Grand total elements not found");return}e(this,C).grandTotals.forEach(i=>{i.textContent=n(this,At,Ut).call(this,t)}),e(this,x).debugWithTime(`Updated grand total to: ${n(this,At,Ut).call(this,t)}`)},At=new WeakSet,Ut=function(t){return e(this,Re).campaign?.formatPrice?e(this,Re).campaign.formatPrice(t):`${e(this,ie).currencySymbol}${t.toFixed(2)} USD`},oc=new WeakSet,Yh=function(t,i){let r;return function(...a){let l=()=>{clearTimeout(r),t(...a)};clearTimeout(r),r=setTimeout(l,i)}},ac=new WeakSet,Jh=function(t){if(!e(this,C).compareTotalElements.length){e(this,x).debugWithTime("No compare-total elements found");return}e(this,x).debugWithTime("Updating compare-total elements"),e(this,x).debugWithTime(`Cart totals: ${JSON.stringify(t)}`),e(this,C).compareTotalElements.forEach(i=>{let r=i.dataset.totalType||"retail",s=null;switch(r){case"retail":s=t.retail_subtotal;break;case"recurring":s=t.recurring_total;break;case"subtotal_compare":case"original":case"msrp":s=t[r]||null;break;default:s=t.retail_subtotal}s&&s>t.total?(i.textContent=n(this,At,Ut).call(this,s),i.classList.remove("hide"),e(this,x).debugWithTime(`Updated compare-total (${r}) to: ${n(this,At,Ut).call(this,s)}`)):(i.classList.add("hide"),e(this,x).debugWithTime(`Hiding compare-total element (${r}): compareValue=${s}, total=${t.total}`))})},Zl=new WeakSet,fg=function(t){return document.querySelectorAll(`[${t}]`)};var N,$,T,dc,uc,Xh,hc,Zh,mc,Qh,ir,cc,gc,tm,ws,Ql,pc,em,fc,im,yc,rm,V,J,Ss,td,bc,sm,vc,nm,lc=class{constructor(t){o(this,uc);o(this,hc);o(this,mc);o(this,ir);o(this,gc);o(this,ws);o(this,pc);o(this,fc);o(this,yc);o(this,V);o(this,Ss);o(this,bc);o(this,vc);o(this,N,void 0);o(this,$,void 0);o(this,T,{});o(this,dc,!1);u(this,N,t),u(this,$,t.logger.createModuleLogger("ATTRIBUTION")),n(this,uc,Xh).call(this)}updateAttributionData(t){t.metadata&&e(this,T).metadata&&(t.metadata={...e(this,T).metadata,...t.metadata}),t.funnel&&e(this,$).debug(`Updating funnel value to: ${t.funnel}`),u(this,T,{...e(this,T),...t}),n(this,ir,cc).call(this),e(this,$).debug("Attribution data updated",t),e(this,N).events&&e(this,N).events.trigger("attribution.updated",{attribution:e(this,T)})}getAttributionData(){return{...e(this,T)}}getAttributionForApi(){return{affiliate:e(this,T).affiliate,funnel:e(this,T).funnel,gclid:e(this,T).gclid,metadata:e(this,T).metadata,utm_source:e(this,T).utm_source,utm_medium:e(this,T).utm_medium,utm_campaign:e(this,T).utm_campaign,utm_content:e(this,T).utm_content,utm_term:e(this,T).utm_term,subaffiliate1:e(this,T).subaffiliate1,subaffiliate2:e(this,T).subaffiliate2,subaffiliate3:e(this,T).subaffiliate3,subaffiliate4:e(this,T).subaffiliate4,subaffiliate5:e(this,T).subaffiliate5}}debug(){console.group("AttributionManager Debug Info");let t=document.querySelector('meta[name="os-tracking-tag"][data-tag-name="funnel_name"]'),i=t?t.getAttribute("data-tag-value"):"",r=e(this,N).campaign?.getCampaignName()||e(this,N).campaignData?.name||"";e(this,T).affiliate,e(this,T).funnel,console.group("API Formatted Attribution Data (What gets sent to API)");let s=this.getAttributionForApi();s.affiliate,s.funnel,s.gclid,s.utm_source,s.utm_medium,s.utm_campaign,s.utm_content,s.utm_term,s.subaffiliate1,s.subaffiliate2,s.subaffiliate3,s.subaffiliate4,s.subaffiliate5,console.group("Metadata Object:"),s.metadata.domain,s.metadata.device,s.metadata.device_type,s.metadata.fb_fbp,s.metadata.fb_fbc,s.metadata.fb_pixel_id,s.metadata,console.groupEnd(),console.groupEnd(),e(this,T),new URLSearchParams(window.location.search).toString(),console.group("Tracking Tags");let a=document.querySelectorAll('meta[name="os-tracking-tag"]');return a.length>0&&a.forEach(l=>{`${l.getAttribute("data-tag-name")}${l.getAttribute("data-tag-value")}`,l.getAttribute("data-persist")}),console.groupEnd(),t&&t.getAttribute("data-tag-value"),e(this,N).campaignData?.name,e(this,N).state&&e(this,N).state.getState("attribution"),console.groupEnd(),"Attribution debug info logged to console."}};N=new WeakMap,$=new WeakMap,T=new WeakMap,dc=new WeakMap,uc=new WeakSet,Xh=function(){e(this,$).info("Initializing AttributionManager"),n(this,hc,Zh).call(this),n(this,ir,cc).call(this),n(this,fc,im).call(this),u(this,dc,!0),e(this,$).info("AttributionManager initialized successfully")},hc=new WeakSet,Zh=function(){let t=document.querySelector('meta[name="os-tracking-tag"][data-tag-name="funnel_name"]'),i=t?t.getAttribute("data-tag-value"):"",r=e(this,N).campaign?.getCampaignName()||e(this,N).campaignData?.name||"",s=i||r;e(this,$).debug(`Using funnel value: ${s} (from ${i?"meta tag":"campaign name"})`);let a=n(this,V,J).call(this,"affid")||n(this,V,J).call(this,"aff")||"",l=n(this,Ss,td).call(this,"_fbc")||"",d=n(this,Ss,td).call(this,"_fbp")||"",h=n(this,vc,nm).call(this),m={landing_page:window.location.href||"",referrer:document.referrer||"",device:navigator.userAgent||"",device_type:n(this,bc,sm).call(this),timestamp:Date.now(),domain:window.location.hostname,fb_fbp:d,fb_fbc:l,fb_pixel_id:h},g=n(this,V,J).call(this,"fbclid")||"";g&&(m.fbclid=g),n(this,mc,Qh).call(this,m),u(this,T,{affiliate:a,funnel:s,gclid:n(this,V,J).call(this,"gclid")||"",metadata:m,utm_source:n(this,V,J).call(this,"utm_source")||"",utm_medium:n(this,V,J).call(this,"utm_medium")||"",utm_campaign:n(this,V,J).call(this,"utm_campaign")||"",utm_content:n(this,V,J).call(this,"utm_content")||"",utm_term:n(this,V,J).call(this,"utm_term")||"",fbclid:g,subaffiliate1:n(this,V,J).call(this,"subaffiliate1")||n(this,V,J).call(this,"sub1")||"",subaffiliate2:n(this,V,J).call(this,"subaffiliate2")||n(this,V,J).call(this,"sub2")||"",subaffiliate3:n(this,V,J).call(this,"subaffiliate3")||n(this,V,J).call(this,"sub3")||"",subaffiliate4:n(this,V,J).call(this,"subaffiliate4")||n(this,V,J).call(this,"sub4")||"",subaffiliate5:n(this,V,J).call(this,"subaffiliate5")||n(this,V,J).call(this,"sub5")||"",first_visit_timestamp:n(this,pc,em).call(this),current_visit_timestamp:Date.now()}),e(this,$).debug("Attribution data collected",e(this,T)),!r&&e(this,N).events&&e(this,$).debug("Campaign data not available yet, will update when loaded")},mc=new WeakSet,Qh=function(t){let i=document.querySelectorAll('meta[name="os-tracking-tag"]');e(this,$).debug(`Found ${i.length} tracking tags`),i.forEach(r=>{let s=r.getAttribute("data-tag-name"),a=r.getAttribute("data-tag-value"),l=r.getAttribute("data-persist")==="true";if(s&&a&&(t[s]=a,e(this,$).debug(`Added tracking tag: ${s} = ${a}`),l))try{sessionStorage.setItem(`os_tag_${s}`,a),e(this,$).debug(`Persisted tracking tag: ${s} = ${a}`)}catch(d){e(this,$).error(`Error persisting tracking tag ${s}:`,d)}})},ir=new WeakSet,cc=function(){if(!e(this,N).state){e(this,$).warn("State manager not available, attribution data will not be stored");return}e(this,N).state.setState("cart.attribution",e(this,T)),e(this,N).state.setState("attribution",this.getAttributionForApi()),e(this,$).info("Attribution data stored in state"),n(this,gc,tm).call(this)},gc=new WeakSet,tm=function(){try{localStorage.setItem("os_attribution",JSON.stringify(e(this,T))),e(this,$).debug("Attribution data persisted to localStorage")}catch(t){e(this,$).error("Error persisting attribution data to localStorage:",t)}},ws=new WeakSet,Ql=function(){try{let t=localStorage.getItem("os_attribution");if(t)return JSON.parse(t)}catch(t){e(this,$).error("Error loading attribution data from localStorage:",t)}return{}},pc=new WeakSet,em=function(){let t=n(this,ws,Ql).call(this);return t.first_visit_timestamp?t.first_visit_timestamp:Date.now()},fc=new WeakSet,im=function(){window.addEventListener("popstate",()=>{let t=e(this,T).metadata||{};t.landing_page=window.location.href,this.updateAttributionData({metadata:t})}),e(this,N).events&&(e(this,N).events.on("campaign.loaded",t=>{if(t&&t.campaign){let i=e(this,N).campaign?.getCampaignName()||t.campaign.name||"";if(!i){e(this,$).warn("Campaign loaded but name is not available");return}e(this,$).info(`Campaign loaded: ${i}`);let r=document.querySelector('meta[name="os-tracking-tag"][data-tag-name="funnel_name"]'),s=r?r.getAttribute("data-tag-value"):"",a=s||i;this.updateAttributionData({funnel:a}),n(this,yc,rm).call(this),e(this,$).debug(`Updated funnel to: ${a} (from ${s?"meta tag":"campaign name"})`)}}),e(this,N).events.on("prospect.cartCreated",()=>{let t=e(this,T).metadata||{};t.conversion_timestamp=Date.now(),this.updateAttributionData({metadata:t}),e(this,$).debug("Cart created, updated metadata with conversion timestamp")}))},yc=new WeakSet,rm=function(){e(this,$).info("Reinitializing attribution data with campaign information");let t=e(this,N).campaign?.getCampaignName()||e(this,N).campaignData?.name||"";if(!t){e(this,$).warn("Cannot reinitialize attribution data: Campaign name not available");return}let i=document.querySelector('meta[name="os-tracking-tag"][data-tag-name="funnel_name"]'),r=i?i.getAttribute("data-tag-value"):"",s=r||t;e(this,$).debug(`Using funnel value: ${s} (from ${r?"meta tag":"campaign name"})`),e(this,T).funnel=s,n(this,ir,cc).call(this),e(this,$).info(`Attribution data reinitialized with funnel: ${s}`),e(this,N).events&&e(this,N).events.trigger("attribution.updated",{attribution:e(this,T)})},V=new WeakSet,J=function(t){let i=new URLSearchParams(window.location.search);if(i.has(t)){let s=i.get(t);try{sessionStorage.setItem(t,s)}catch(a){e(this,$).error(`Error storing ${t} in sessionStorage:`,a)}return s}try{if(sessionStorage.getItem(t))return sessionStorage.getItem(t)}catch(s){e(this,$).error(`Error reading ${t} from sessionStorage:`,s)}try{if(localStorage.getItem(t))return localStorage.getItem(t)}catch(s){e(this,$).error(`Error reading ${t} from localStorage:`,s)}let r=n(this,ws,Ql).call(this);return r[t]?r[t]:""},Ss=new WeakSet,td=function(t){let r=`; ${document.cookie}`.split(`; ${t}=`);return r.length===2?r.pop().split(";").shift():""},bc=new WeakSet,sm=function(){let t=navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)?"mobile":"desktop"},vc=new WeakSet,nm=function(){let t=document.querySelector('meta[name="facebook-domain-verification"]');if(t){let r=t.getAttribute("content");if(r&&r.includes("=")){let s=r.split("=");if(s.length>1)return s[1]}}let i=document.querySelectorAll("script");for(let r of i){let s=r.textContent||"";if(s.includes("fbq(")&&s.includes("init")){let a=s.match(/fbq\s*\(\s*['"]init['"],\s*['"](\d+)['"]/);if(a&&a[1])return a[1]}}return""};var Gt,w,Sc,it,xc,ni,_c,om,Cc,am,Ec,cm,Ac,lm,Tc,dm,kc,um,ze,rr,wc=class{constructor(t){o(this,_c);o(this,Cc);o(this,Ec);o(this,Ac);o(this,Tc);o(this,kc);o(this,ze);o(this,Gt,void 0);o(this,w,void 0);o(this,Sc,!1);o(this,it,{gtm:{enabled:!1,initialized:!1},fbPixel:{enabled:!1,initialized:!1},ga4:{enabled:!1,initialized:!1}});o(this,xc,!1);o(this,ni,new Set);u(this,Gt,t),u(this,w,t.logger.createModuleLogger("EVENT")),u(this,xc,t.options?.debug||!1),this.init()}init(){e(this,w).info("Initializing EventManager"),n(this,Ec,cm).call(this),n(this,Ac,lm).call(this),n(this,_c,om).call(this),u(this,Sc,!0),e(this,w).info("EventManager initialized")}viewItemList(t){if(e(this,w).debug("viewItemList called with campaign data:",t?"present":"missing"),!t||!t.packages||t.packages.length===0){e(this,w).warn("Cannot fire view_item_list event: No packages found in campaign data");return}e(this,w).debug(`Found ${t.packages.length} packages in campaign data`);let i=t.packages.map(s=>({item_id:s.external_id||s.ref_id,item_name:s.name,price:parseFloat(s.price)||0,currency:t.currency||"USD",quantity:1})),r={event:"view_item_list",ecommerce:{currency:t.currency||"USD",items:i}};e(this,w).debug("Firing view_item_list event with data:",r),n(this,ze,rr).call(this,"view_item_list",r)}addToCart(t){let i=!t.items&&!t.totals,r=[],s="USD",a=0;if(i){if(e(this,w).debug("addToCart called with single package, converting to cart format"),!t){e(this,w).warn("Cannot fire add_to_cart event: No package data provided");return}let d=t,h={item_id:d.external_id||d.ref_id||d.id,item_name:d.name,price:parseFloat(d.price)||0,currency:d.currency||e(this,Gt).getCampaignData()?.currency||"USD",quantity:d.quantity||1};r=[h],s=h.currency,a=h.price*h.quantity}else{if(!t||!t.items||t.items.length===0){e(this,w).warn("Cannot fire add_to_cart event: No items in cart");return}r=t.items.map(d=>({item_id:d.external_id||d.id,item_name:d.name,price:parseFloat(d.price)||0,currency:t.totals?.currency||"USD",quantity:d.quantity||1})),s=t.totals?.currency||"USD",a=t.totals?.total||0}let l={event:"add_to_cart",ecommerce:{currency:s,value:a,items:r}};n(this,ze,rr).call(this,"add_to_cart",l)}purchase(t,i=!1){if(!t||!t.lines||t.lines.length===0){e(this,w).warn("Cannot fire purchase event: No items in order");return}let r=t.number||t.ref_id;if(!i&&r&&e(this,ni).has(r)){e(this,w).info(`Purchase event for order ${r} already fired, skipping`);return}let s=t.lines.map(d=>({item_id:d.product_id||d.id,item_name:d.product_title||d.name,price:parseFloat(d.price_incl_tax||d.price)||0,currency:t.currency||"USD",quantity:d.quantity||1})),a=n(this,Tc,dm).call(this,t),l={event:"purchase",ecommerce:{transaction_id:r,value:parseFloat(t.total_incl_tax||t.total)||0,tax:parseFloat(t.total_tax)||0,shipping:parseFloat(t.shipping_incl_tax||t.shipping)||0,currency:t.currency||"USD",coupon:t.vouchers?.length>0?t.vouchers[0].code:"",...a,items:s}};n(this,ze,rr).call(this,"purchase",l),r&&(e(this,ni).add(r),n(this,Cc,am).call(this),e(this,w).debug(`Marked order ${r} as processed`))}viewItem(t){if(!t){e(this,w).warn("Cannot fire view_item event: No package data provided");return}let i={item_id:t.ref_id||t.external_id||t.id,item_name:t.name,price:parseFloat(t.price)||0,currency:t.currency||e(this,Gt).getCampaignData()?.currency||"USD",quantity:1},r={event:"view_item",ecommerce:{currency:i.currency,value:i.price,items:[i]}};n(this,ze,rr).call(this,"view_item",r)}beginCheckout(){let t=e(this,Gt).state.getState("cart");if(!t||!t.items||t.items.length===0){e(this,w).warn("Cannot fire begin_checkout event: No items in cart");return}let i=t.items.map(s=>({item_id:s.external_id||s.id,item_name:s.name,price:parseFloat(s.price)||0,currency:t.totals?.currency||"USD",quantity:s.quantity||1})),r={event:"begin_checkout",ecommerce:{currency:t.totals?.currency||"USD",value:t.totals?.total||0,items:i}};n(this,ze,rr).call(this,"begin_checkout",r)}fireCustomEvent(t,i={}){if(!t){e(this,w).warn("Cannot fire custom event: No event name provided");return}let r={event:t,...i};e(this,w).debug(`Firing custom event: ${t}`,r),e(this,it).gtm.enabled&&(window.dataLayer=window.dataLayer||[],window.dataLayer.push(r),e(this,w).debug(`Custom event ${t} fired to Google Tag Manager`)),e(this,it).fbPixel.enabled&&typeof window.fbq=="function"&&(window.fbq("trackCustom",t,i),e(this,w).debug(`Custom event ${t} fired to Facebook Pixel`)),e(this,it).ga4.enabled&&typeof window.gtag=="function"&&(window.gtag("event",t,i),e(this,w).debug(`Custom event ${t} fired to Google Analytics 4`));let s=new CustomEvent(`os:${t}`,{bubbles:!0,detail:r});document.dispatchEvent(s)}setPlatformEnabled(t,i){e(this,it)[t]?(e(this,it)[t].enabled=i,e(this,w).info(`${t} ${i?"enabled":"disabled"}`)):e(this,w).warn(`Unknown platform: ${t}`)}getPlatformStatus(){return{...e(this,it)}}};Gt=new WeakMap,w=new WeakMap,Sc=new WeakMap,it=new WeakMap,xc=new WeakMap,ni=new WeakMap,_c=new WeakSet,om=function(){try{let t=sessionStorage.getItem("os_processed_order_ids");if(t){let i=JSON.parse(t);Array.isArray(i)&&(i.forEach(r=>e(this,ni).add(r)),e(this,w).debug(`Loaded ${i.length} processed order IDs from sessionStorage`))}}catch(t){e(this,w).error("Error loading processed order IDs from sessionStorage:",t)}},Cc=new WeakSet,am=function(){try{let t=Array.from(e(this,ni));sessionStorage.setItem("os_processed_order_ids",JSON.stringify(t)),e(this,w).debug(`Saved ${t.length} processed order IDs to sessionStorage`)}catch(t){e(this,w).error("Error saving processed order IDs to sessionStorage:",t)}},Ec=new WeakSet,cm=function(){typeof window.dataLayer<"u"?(e(this,it).gtm.enabled=!0,e(this,it).gtm.initialized=!0,e(this,w).info("Google Tag Manager detected")):e(this,w).info("Google Tag Manager not detected"),typeof window.fbq<"u"?(e(this,it).fbPixel.enabled=!0,e(this,it).fbPixel.initialized=!0,e(this,w).info("Facebook Pixel detected")):e(this,w).info("Facebook Pixel not detected"),typeof window.gtag<"u"?(e(this,it).ga4.enabled=!0,e(this,it).ga4.initialized=!0,e(this,w).info("Google Analytics 4 detected")):e(this,w).info("Google Analytics 4 not detected")},Ac=new WeakSet,lm=function(){e(this,Gt).on("campaign.loaded",t=>{e(this,w).debug("Campaign loaded event received, firing view_item_list"),t&&t.campaign?this.viewItemList(t.campaign):e(this,w).warn("Campaign loaded event received but no campaign data found")}),e(this,Gt).on("cart.updated",t=>{t.cart&&t.cart.items&&t.cart.items.length>0&&this.addToCart(t.cart)}),e(this,Gt).on("order.created",t=>{this.purchase(t)}),e(this,Gt).on("order.loaded",t=>{t.order&&(e(this,w).info("Order loaded on receipt page, checking if purchase event needed"),this.purchase(t.order))})},Tc=new WeakSet,dm=function(t){let i={};return t.user&&(t.user.first_name&&(i.firstname=t.user.first_name),t.user.last_name&&(i.lastname=t.user.last_name),t.user.email&&(i.email_hash=n(this,kc,um).call(this,t.user.email))),t.shipping_address&&(i.city=t.shipping_address.line4||"",i.state=t.shipping_address.state||"",i.zipcode=t.shipping_address.postcode||"",i.country=t.shipping_address.country||""),i},kc=new WeakSet,um=function(t){let i=0;if(t.length===0)return i.toString();for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);i=(i<<5)-i+s,i=i&i}return i.toString()},ze=new WeakSet,rr=function(t,i){if(e(this,w).debug(`Firing ${t} event`,i),e(this,it).gtm.enabled?(window.dataLayer=window.dataLayer||[],e(this,w).debug("Clearing previous ecommerce data in dataLayer"),window.dataLayer.push({ecommerce:null}),`${t}`,window.dataLayer.push(i),e(this,w).debug(`${t} event fired to Google Tag Manager`)):(e(this,w).warn(`Cannot fire ${t} event to GTM: GTM not enabled`),window.dataLayer=window.dataLayer||[],window.dataLayer.push({ecommerce:null}),window.dataLayer.push(i)),e(this,it).fbPixel.enabled){switch(t){case"view_item_list":window.fbq("track","ViewContent",{content_type:"product_group",content_ids:i.ecommerce.items.map(s=>s.item_id),currency:i.ecommerce.currency});break;case"add_to_cart":window.fbq("track","AddToCart",{content_type:"product_group",content_ids:i.ecommerce.items.map(s=>s.item_id),currency:i.ecommerce.currency,value:i.ecommerce.value});break;case"purchase":window.fbq("track","Purchase",{content_type:"product_group",content_ids:i.ecommerce.items.map(s=>s.item_id),currency:i.ecommerce.currency,value:i.ecommerce.value});break}e(this,w).debug(`${t} event fired to Facebook Pixel`)}e(this,it).ga4.enabled&&(window.gtag("event",t,{currency:i.ecommerce.currency,value:i.ecommerce.value,items:i.ecommerce.items}),e(this,w).debug(`${t} event fired to Google Analytics 4`));let r=new CustomEvent(`os:${t}`,{bubbles:!0,detail:i});document.dispatchEvent(r)};var oi=Math.min,Ue=Math.max,_s=Math.round;var Kt=c=>({x:c,y:c}),yg={left:"right",right:"left",bottom:"top",top:"bottom"},bg={start:"end",end:"start"};function Lc(c,t,i){return Ue(c,oi(t,i))}function sr(c,t){return typeof c=="function"?c(t):c}function De(c){return c.split("-")[0]}function nr(c){return c.split("-")[1]}function ed(c){return c==="x"?"y":"x"}function Pc(c){return c==="y"?"height":"width"}function ai(c){return["top","bottom"].includes(De(c))?"y":"x"}function Ic(c){return ed(ai(c))}function hm(c,t,i){i===void 0&&(i=!1);let r=nr(c),s=Ic(c),a=Pc(s),l=s==="x"?r===(i?"end":"start")?"right":"left":r==="start"?"bottom":"top";return t.reference[a]>t.floating[a]&&(l=xs(l)),[l,xs(l)]}function mm(c){let t=xs(c);return[$c(c),t,$c(t)]}function $c(c){return c.replace(/start|end/g,t=>bg[t])}function vg(c,t,i){let r=["left","right"],s=["right","left"],a=["top","bottom"],l=["bottom","top"];switch(c){case"top":case"bottom":return i?t?s:r:t?r:s;case"left":case"right":return t?a:l;default:return[]}}function gm(c,t,i,r){let s=nr(c),a=vg(De(c),i==="start",r);return s&&(a=a.map(l=>l+"-"+s),t&&(a=a.concat(a.map($c)))),a}function xs(c){return c.replace(/left|right|bottom|top/g,t=>yg[t])}function wg(c){return{top:0,right:0,bottom:0,left:0,...c}}function id(c){return typeof c!="number"?wg(c):{top:c,right:c,bottom:c,left:c}}function ci(c){let{x:t,y:i,width:r,height:s}=c;return{width:r,height:s,top:i,left:t,right:t+r,bottom:i+s,x:t,y:i}}function pm(c,t,i){let{reference:r,floating:s}=c,a=ai(t),l=Ic(t),d=Pc(l),h=De(t),m=a==="y",g=r.x+r.width/2-s.width/2,f=r.y+r.height/2-s.height/2,_=r[d]/2-s[d]/2,b;switch(h){case"top":b={x:g,y:r.y-s.height};break;case"bottom":b={x:g,y:r.y+r.height};break;case"right":b={x:r.x+r.width,y:f};break;case"left":b={x:r.x-s.width,y:f};break;default:b={x:r.x,y:r.y}}switch(nr(t)){case"start":b[l]-=_*(i&&m?-1:1);break;case"end":b[l]+=_*(i&&m?-1:1);break}return b}var fm=async(c,t,i)=>{let{placement:r="bottom",strategy:s="absolute",middleware:a=[],platform:l}=i,d=a.filter(Boolean),h=await(l.isRTL==null?void 0:l.isRTL(t)),m=await l.getElementRects({reference:c,floating:t,strategy:s}),{x:g,y:f}=pm(m,r,h),_=r,b={},v=0;for(let P=0;P<d.length;P++){let{name:q,fn:X}=d[P],{x:tt,y:st,data:$t,reset:nt}=await X({x:g,y:f,initialPlacement:r,placement:_,strategy:s,middlewareData:b,rects:m,platform:l,elements:{reference:c,floating:t}});g=tt??g,f=st??f,b={...b,[q]:{...b[q],...$t}},nt&&v<=50&&(v++,typeof nt=="object"&&(nt.placement&&(_=nt.placement),nt.rects&&(m=nt.rects===!0?await l.getElementRects({reference:c,floating:t,strategy:s}):nt.rects),{x:g,y:f}=pm(m,_,h)),P=-1)}return{x:g,y:f,placement:_,strategy:s,middlewareData:b}};async function rd(c,t){var i;t===void 0&&(t={});let{x:r,y:s,platform:a,rects:l,elements:d,strategy:h}=c,{boundary:m="clippingAncestors",rootBoundary:g="viewport",elementContext:f="floating",altBoundary:_=!1,padding:b=0}=sr(t,c),v=id(b),q=d[_?f==="floating"?"reference":"floating":f],X=ci(await a.getClippingRect({element:(i=await(a.isElement==null?void 0:a.isElement(q)))==null||i?q:q.contextElement||await(a.getDocumentElement==null?void 0:a.getDocumentElement(d.floating)),boundary:m,rootBoundary:g,strategy:h})),tt=f==="floating"?{x:r,y:s,width:l.floating.width,height:l.floating.height}:l.reference,st=await(a.getOffsetParent==null?void 0:a.getOffsetParent(d.floating)),$t=await(a.isElement==null?void 0:a.isElement(st))?await(a.getScale==null?void 0:a.getScale(st))||{x:1,y:1}:{x:1,y:1},nt=ci(a.convertOffsetParentRelativeRectToViewportRelativeRect?await a.convertOffsetParentRelativeRectToViewportRelativeRect({elements:d,rect:tt,offsetParent:st,strategy:h}):tt);return{top:(X.top-nt.top+v.top)/$t.y,bottom:(nt.bottom-X.bottom+v.bottom)/$t.y,left:(X.left-nt.left+v.left)/$t.x,right:(nt.right-X.right+v.right)/$t.x}}var ym=c=>({name:"arrow",options:c,async fn(t){let{x:i,y:r,placement:s,rects:a,platform:l,elements:d,middlewareData:h}=t,{element:m,padding:g=0}=sr(c,t)||{};if(m==null)return{};let f=id(g),_={x:i,y:r},b=Ic(s),v=Pc(b),P=await l.getDimensions(m),q=b==="y",X=q?"top":"left",tt=q?"bottom":"right",st=q?"clientHeight":"clientWidth",$t=a.reference[v]+a.reference[b]-_[b]-a.floating[v],nt=_[b]-a.reference[b],pi=await(l.getOffsetParent==null?void 0:l.getOffsetParent(m)),Be=pi?pi[st]:0;(!Be||!await(l.isElement==null?void 0:l.isElement(pi)))&&(Be=d.floating[st]||a.floating[v]);let fr=$t/2-nt/2,We=Be/2-P[v]/2-1,be=oi(f[X],We),yr=oi(f[tt],We),He=be,br=Be-P[v]-yr,pt=Be/2-P[v]/2+fr,fi=Lc(He,pt,br),se=!h.arrow&&nr(s)!=null&&pt!==fi&&a.reference[v]/2-(pt<He?be:yr)-P[v]/2<0,Jt=se?pt<He?pt-He:pt-br:0;return{[b]:_[b]+Jt,data:{[b]:fi,centerOffset:pt-fi-Jt,...se&&{alignmentOffset:Jt}},reset:se}}});var bm=function(c){return c===void 0&&(c={}),{name:"flip",options:c,async fn(t){var i,r;let{placement:s,middlewareData:a,rects:l,initialPlacement:d,platform:h,elements:m}=t,{mainAxis:g=!0,crossAxis:f=!0,fallbackPlacements:_,fallbackStrategy:b="bestFit",fallbackAxisSideDirection:v="none",flipAlignment:P=!0,...q}=sr(c,t);if((i=a.arrow)!=null&&i.alignmentOffset)return{};let X=De(s),tt=ai(d),st=De(d)===d,$t=await(h.isRTL==null?void 0:h.isRTL(m.floating)),nt=_||(st||!P?[xs(d)]:mm(d)),pi=v!=="none";!_&&pi&&nt.push(...gm(d,P,v,$t));let Be=[d,...nt],fr=await rd(t,q),We=[],be=((r=a.flip)==null?void 0:r.overflows)||[];if(g&&We.push(fr[X]),f){let pt=hm(s,l,$t);We.push(fr[pt[0]],fr[pt[1]])}if(be=[...be,{placement:s,overflows:We}],!We.every(pt=>pt<=0)){var yr,He;let pt=(((yr=a.flip)==null?void 0:yr.index)||0)+1,fi=Be[pt];if(fi)return{data:{index:pt,overflows:be},reset:{placement:fi}};let se=(He=be.filter(Jt=>Jt.overflows[0]<=0).sort((Jt,ve)=>Jt.overflows[1]-ve.overflows[1])[0])==null?void 0:He.placement;if(!se)switch(b){case"bestFit":{var br;let Jt=(br=be.filter(ve=>{if(pi){let we=ai(ve.placement);return we===tt||we==="y"}return!0}).map(ve=>[ve.placement,ve.overflows.filter(we=>we>0).reduce((we,ag)=>we+ag,0)]).sort((ve,we)=>ve[1]-we[1])[0])==null?void 0:br[0];Jt&&(se=Jt);break}case"initialPlacement":se=d;break}if(s!==se)return{reset:{placement:se}}}return{}}}};async function Sg(c,t){let{placement:i,platform:r,elements:s}=c,a=await(r.isRTL==null?void 0:r.isRTL(s.floating)),l=De(i),d=nr(i),h=ai(i)==="y",m=["left","top"].includes(l)?-1:1,g=a&&h?-1:1,f=sr(t,c),{mainAxis:_,crossAxis:b,alignmentAxis:v}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:f.mainAxis||0,crossAxis:f.crossAxis||0,alignmentAxis:f.alignmentAxis};return d&&typeof v=="number"&&(b=d==="end"?v*-1:v),h?{x:b*g,y:_*m}:{x:_*m,y:b*g}}var vm=function(c){return c===void 0&&(c=0),{name:"offset",options:c,async fn(t){var i,r;let{x:s,y:a,placement:l,middlewareData:d}=t,h=await Sg(t,c);return l===((i=d.offset)==null?void 0:i.placement)&&(r=d.arrow)!=null&&r.alignmentOffset?{}:{x:s+h.x,y:a+h.y,data:{...h,placement:l}}}}},wm=function(c){return c===void 0&&(c={}),{name:"shift",options:c,async fn(t){let{x:i,y:r,placement:s}=t,{mainAxis:a=!0,crossAxis:l=!1,limiter:d={fn:q=>{let{x:X,y:tt}=q;return{x:X,y:tt}}},...h}=sr(c,t),m={x:i,y:r},g=await rd(t,h),f=ai(De(s)),_=ed(f),b=m[_],v=m[f];if(a){let q=_==="y"?"top":"left",X=_==="y"?"bottom":"right",tt=b+g[q],st=b-g[X];b=Lc(tt,b,st)}if(l){let q=f==="y"?"top":"left",X=f==="y"?"bottom":"right",tt=v+g[q],st=v-g[X];v=Lc(tt,v,st)}let P=d.fn({...t,[_]:b,[f]:v});return{...P,data:{x:P.x-i,y:P.y-r,enabled:{[_]:a,[f]:l}}}}}};function Mc(){return typeof window<"u"}function li(c){return xm(c)?(c.nodeName||"").toLowerCase():"#document"}function Tt(c){var t;return(c==null||(t=c.ownerDocument)==null?void 0:t.defaultView)||window}function re(c){var t;return(t=(xm(c)?c.ownerDocument:c.document)||window.document)==null?void 0:t.documentElement}function xm(c){return Mc()?c instanceof Node||c instanceof Tt(c).Node:!1}function Dt(c){return Mc()?c instanceof Element||c instanceof Tt(c).Element:!1}function Yt(c){return Mc()?c instanceof HTMLElement||c instanceof Tt(c).HTMLElement:!1}function Sm(c){return!Mc()||typeof ShadowRoot>"u"?!1:c instanceof ShadowRoot||c instanceof Tt(c).ShadowRoot}function or(c){let{overflow:t,overflowX:i,overflowY:r,display:s}=Bt(c);return/auto|scroll|overlay|hidden|clip/.test(t+r+i)&&!["inline","contents"].includes(s)}function _m(c){return["table","td","th"].includes(li(c))}function Cs(c){return[":popover-open",":modal"].some(t=>{try{return c.matches(t)}catch{return!1}})}function Fc(c){let t=Nc(),i=Dt(c)?Bt(c):c;return["transform","translate","scale","rotate","perspective"].some(r=>i[r]?i[r]!=="none":!1)||(i.containerType?i.containerType!=="normal":!1)||!t&&(i.backdropFilter?i.backdropFilter!=="none":!1)||!t&&(i.filter?i.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(i.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(i.contain||"").includes(r))}function Cm(c){let t=ye(c);for(;Yt(t)&&!di(t);){if(Fc(t))return t;if(Cs(t))return null;t=ye(t)}return null}function Nc(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function di(c){return["html","body","#document"].includes(li(c))}function Bt(c){return Tt(c).getComputedStyle(c)}function Es(c){return Dt(c)?{scrollLeft:c.scrollLeft,scrollTop:c.scrollTop}:{scrollLeft:c.scrollX,scrollTop:c.scrollY}}function ye(c){if(li(c)==="html")return c;let t=c.assignedSlot||c.parentNode||Sm(c)&&c.host||re(c);return Sm(t)?t.host:t}function Em(c){let t=ye(c);return di(t)?c.ownerDocument?c.ownerDocument.body:c.body:Yt(t)&&or(t)?t:Em(t)}function qc(c,t,i){var r;t===void 0&&(t=[]),i===void 0&&(i=!0);let s=Em(c),a=s===((r=c.ownerDocument)==null?void 0:r.body),l=Tt(s);if(a){let d=Oc(l);return t.concat(l,l.visualViewport||[],or(s)?s:[],d&&i?qc(d):[])}return t.concat(s,qc(s,[],i))}function Oc(c){return c.parent&&Object.getPrototypeOf(c.parent)?c.frameElement:null}function km(c){let t=Bt(c),i=parseFloat(t.width)||0,r=parseFloat(t.height)||0,s=Yt(c),a=s?c.offsetWidth:i,l=s?c.offsetHeight:r,d=_s(i)!==a||_s(r)!==l;return d&&(i=a,r=l),{width:i,height:r,$:d}}function $m(c){return Dt(c)?c:c.contextElement}function ar(c){let t=$m(c);if(!Yt(t))return Kt(1);let i=t.getBoundingClientRect(),{width:r,height:s,$:a}=km(t),l=(a?_s(i.width):i.width)/r,d=(a?_s(i.height):i.height)/s;return(!l||!Number.isFinite(l))&&(l=1),(!d||!Number.isFinite(d))&&(d=1),{x:l,y:d}}var xg=Kt(0);function Lm(c){let t=Tt(c);return!Nc()||!t.visualViewport?xg:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function _g(c,t,i){return t===void 0&&(t=!1),!i||t&&i!==Tt(c)?!1:t}function As(c,t,i,r){t===void 0&&(t=!1),i===void 0&&(i=!1);let s=c.getBoundingClientRect(),a=$m(c),l=Kt(1);t&&(r?Dt(r)&&(l=ar(r)):l=ar(c));let d=_g(a,i,r)?Lm(a):Kt(0),h=(s.left+d.x)/l.x,m=(s.top+d.y)/l.y,g=s.width/l.x,f=s.height/l.y;if(a){let _=Tt(a),b=r&&Dt(r)?Tt(r):r,v=_,P=Oc(v);for(;P&&r&&b!==v;){let q=ar(P),X=P.getBoundingClientRect(),tt=Bt(P),st=X.left+(P.clientLeft+parseFloat(tt.paddingLeft))*q.x,$t=X.top+(P.clientTop+parseFloat(tt.paddingTop))*q.y;h*=q.x,m*=q.y,g*=q.x,f*=q.y,h+=st,m+=$t,v=Tt(P),P=Oc(v)}}return ci({width:g,height:f,x:h,y:m})}function nd(c,t){let i=Es(c).scrollLeft;return t?t.left+i:As(re(c)).left+i}function Pm(c,t,i){i===void 0&&(i=!1);let r=c.getBoundingClientRect(),s=r.left+t.scrollLeft-(i?0:nd(c,r)),a=r.top+t.scrollTop;return{x:s,y:a}}function Cg(c){let{elements:t,rect:i,offsetParent:r,strategy:s}=c,a=s==="fixed",l=re(r),d=t?Cs(t.floating):!1;if(r===l||d&&a)return i;let h={scrollLeft:0,scrollTop:0},m=Kt(1),g=Kt(0),f=Yt(r);if((f||!f&&!a)&&((li(r)!=="body"||or(l))&&(h=Es(r)),Yt(r))){let b=As(r);m=ar(r),g.x=b.x+r.clientLeft,g.y=b.y+r.clientTop}let _=l&&!f&&!a?Pm(l,h,!0):Kt(0);return{width:i.width*m.x,height:i.height*m.y,x:i.x*m.x-h.scrollLeft*m.x+g.x+_.x,y:i.y*m.y-h.scrollTop*m.y+g.y+_.y}}function Eg(c){return Array.from(c.getClientRects())}function Ag(c){let t=re(c),i=Es(c),r=c.ownerDocument.body,s=Ue(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),a=Ue(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight),l=-i.scrollLeft+nd(c),d=-i.scrollTop;return Bt(r).direction==="rtl"&&(l+=Ue(t.clientWidth,r.clientWidth)-s),{width:s,height:a,x:l,y:d}}function Tg(c,t){let i=Tt(c),r=re(c),s=i.visualViewport,a=r.clientWidth,l=r.clientHeight,d=0,h=0;if(s){a=s.width,l=s.height;let m=Nc();(!m||m&&t==="fixed")&&(d=s.offsetLeft,h=s.offsetTop)}return{width:a,height:l,x:d,y:h}}function kg(c,t){let i=As(c,!0,t==="fixed"),r=i.top+c.clientTop,s=i.left+c.clientLeft,a=Yt(c)?ar(c):Kt(1),l=c.clientWidth*a.x,d=c.clientHeight*a.y,h=s*a.x,m=r*a.y;return{width:l,height:d,x:h,y:m}}function Am(c,t,i){let r;if(t==="viewport")r=Tg(c,i);else if(t==="document")r=Ag(re(c));else if(Dt(t))r=kg(t,i);else{let s=Lm(c);r={x:t.x-s.x,y:t.y-s.y,width:t.width,height:t.height}}return ci(r)}function Im(c,t){let i=ye(c);return i===t||!Dt(i)||di(i)?!1:Bt(i).position==="fixed"||Im(i,t)}function $g(c,t){let i=t.get(c);if(i)return i;let r=qc(c,[],!1).filter(d=>Dt(d)&&li(d)!=="body"),s=null,a=Bt(c).position==="fixed",l=a?ye(c):c;for(;Dt(l)&&!di(l);){let d=Bt(l),h=Fc(l);!h&&d.position==="fixed"&&(s=null),(a?!h&&!s:!h&&d.position==="static"&&!!s&&["absolute","fixed"].includes(s.position)||or(l)&&!h&&Im(c,l))?r=r.filter(g=>g!==l):s=d,l=ye(l)}return t.set(c,r),r}function Lg(c){let{element:t,boundary:i,rootBoundary:r,strategy:s}=c,l=[...i==="clippingAncestors"?Cs(t)?[]:$g(t,this._c):[].concat(i),r],d=l[0],h=l.reduce((m,g)=>{let f=Am(t,g,s);return m.top=Ue(f.top,m.top),m.right=oi(f.right,m.right),m.bottom=oi(f.bottom,m.bottom),m.left=Ue(f.left,m.left),m},Am(t,d,s));return{width:h.right-h.left,height:h.bottom-h.top,x:h.left,y:h.top}}function Pg(c){let{width:t,height:i}=km(c);return{width:t,height:i}}function Ig(c,t,i){let r=Yt(t),s=re(t),a=i==="fixed",l=As(c,!0,a,t),d={scrollLeft:0,scrollTop:0},h=Kt(0);if(r||!r&&!a)if((li(t)!=="body"||or(s))&&(d=Es(t)),r){let _=As(t,!0,a,t);h.x=_.x+t.clientLeft,h.y=_.y+t.clientTop}else s&&(h.x=nd(s));let m=s&&!r&&!a?Pm(s,d):Kt(0),g=l.left+d.scrollLeft-h.x-m.x,f=l.top+d.scrollTop-h.y-m.y;return{x:g,y:f,width:l.width,height:l.height}}function sd(c){return Bt(c).position==="static"}function Tm(c,t){if(!Yt(c)||Bt(c).position==="fixed")return null;if(t)return t(c);let i=c.offsetParent;return re(c)===i&&(i=i.ownerDocument.body),i}function qm(c,t){let i=Tt(c);if(Cs(c))return i;if(!Yt(c)){let s=ye(c);for(;s&&!di(s);){if(Dt(s)&&!sd(s))return s;s=ye(s)}return i}let r=Tm(c,t);for(;r&&_m(r)&&sd(r);)r=Tm(r,t);return r&&di(r)&&sd(r)&&!Fc(r)?i:r||Cm(c)||i}var qg=async function(c){let t=this.getOffsetParent||qm,i=this.getDimensions,r=await i(c.floating);return{reference:Ig(c.reference,await t(c.floating),c.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function Mg(c){return Bt(c).direction==="rtl"}var Fg={convertOffsetParentRelativeRectToViewportRelativeRect:Cg,getDocumentElement:re,getClippingRect:Lg,getOffsetParent:qm,getElementRects:qg,getClientRects:Eg,getDimensions:Pg,getScale:ar,isElement:Dt,isRTL:Mg};var Mm=vm;var Fm=wm,Nm=bm;var Om=ym;var Rm=(c,t,i)=>{let r=new Map,s={platform:Fg,...i},a={...s.platform,_c:r};return fm(c,t,{...s,platform:a})};var Uc,ui,kt,cr,Ts,lr,dr,ks,ur,Dc,zm,Bc,Um,Wc,Dm,$s,od,hr,Rc,zc=class{constructor(t){o(this,Dc);o(this,Bc);o(this,Wc);o(this,$s);o(this,hr);o(this,Uc,void 0);o(this,ui,void 0);o(this,kt,void 0);o(this,cr,void 0);o(this,Ts,void 0);o(this,lr,null);o(this,dr,null);o(this,ks,null);o(this,ur,!1);u(this,Uc,t),u(this,ui,t.logger.createModuleLogger("TOOLTIP")),n(this,Dc,zm).call(this),e(this,ui).info("TooltipManager initialized")}};Uc=new WeakMap,ui=new WeakMap,kt=new WeakMap,cr=new WeakMap,Ts=new WeakMap,lr=new WeakMap,dr=new WeakMap,ks=new WeakMap,ur=new WeakMap,Dc=new WeakSet,zm=function(){e(this,ur)||(u(this,kt,n(this,Bc,Um).call(this)),u(this,cr,e(this,kt).querySelector("#checkout-tooltip-arrow")),u(this,Ts,e(this,kt).querySelector("#checkout-tooltip-text")),n(this,Wc,Dm).call(this),u(this,ur,!0),e(this,ui).info("Tooltip system initialized with floating-ui"))},Bc=new WeakSet,Um=function(){let t=document.getElementById("checkout-tooltip");if(t)return t;let i=document.createElement("div");i.setAttribute("role","tooltip"),i.id="checkout-tooltip",i.style.display="none";let r=document.createElement("div");r.id="checkout-tooltip-text",i.appendChild(r);let s=document.createElement("div");return s.id="checkout-tooltip-arrow",i.appendChild(s),document.body.appendChild(i),i},Wc=new WeakSet,Dm=function(){document.addEventListener("mouseover",t=>{let i=t.target.closest("[data-os-tooltip]");i&&(clearTimeout(e(this,dr)),u(this,dr,setTimeout(()=>{n(this,$s,od).call(this,i)},200)))}),document.addEventListener("mouseout",t=>{t.target.closest("[data-os-tooltip]")&&(clearTimeout(e(this,dr)),n(this,hr,Rc).call(this))}),document.addEventListener("focus",t=>{let i=t.target.closest("[data-os-tooltip]");i&&n(this,$s,od).call(this,i)},!0),document.addEventListener("blur",t=>{t.target.closest("[data-os-tooltip]")&&n(this,hr,Rc).call(this)},!0),document.addEventListener("keydown",t=>{t.key==="Escape"&&e(this,lr)&&n(this,hr,Rc).call(this)})},$s=new WeakSet,od=function(t){if(!e(this,ur)){e(this,ui).warn("Cannot show tooltip: system not initialized");return}clearTimeout(e(this,ks)),u(this,lr,t);let i=t.getAttribute("data-os-tooltip"),r=t.getAttribute("data-os-tooltip-position")||"top";e(this,Ts).textContent=i,e(this,kt).style.display="block",Rm(t,e(this,kt),{placement:r,middleware:[Mm(8),Nm({fallbackPlacements:["top","right","bottom","left"]}),Fm({padding:5}),Om({element:e(this,cr)})]}).then(({x:s,y:a,placement:l,middlewareData:d})=>{Object.assign(e(this,kt).style,{left:`${s}px`,top:`${a}px`});let{x:h,y:m}=d.arrow,g={top:"bottom",right:"left",bottom:"top",left:"right"}[l.split("-")[0]];Object.assign(e(this,cr).style,{left:h!=null?`${h}px`:"",top:m!=null?`${m}px`:"",right:"",bottom:"",[g]:"-4px"}),requestAnimationFrame(()=>{e(this,kt).classList.add("checkout-tooltip-visible")})})},hr=new WeakSet,Rc=function(){e(this,kt)&&(e(this,kt).classList.remove("checkout-tooltip-visible"),u(this,ks,setTimeout(()=>{e(this,kt).classList.contains("checkout-tooltip-visible")||(e(this,kt).style.display="none"),u(this,lr,null)},200)))};var ad=class{constructor(){this.cleanupInitialState(),this.init()}cleanupInitialState(){document.querySelectorAll('[pb-component="accordion"]').forEach(t=>{let i=t.querySelector('[pb-accordion-element="group"]');if(!i)return;let r=i.querySelectorAll('[pb-accordion-element="accordion"]');r.forEach(a=>{let l=a.querySelector('[pb-accordion-element="content"]'),d=a.querySelector('[pb-accordion-element="trigger"]'),h=a.querySelector('[pb-accordion-element="arrow"]'),m=a.querySelector('[pb-accordion-element="plus"]');l&&(l.style.maxHeight="0",l.style.opacity="0",l.style.visibility="hidden",l.style.display="none"),d&&d.setAttribute("aria-expanded","false"),a.classList.remove("is-active-accordion"),l?.classList.remove("is-active-accordion"),h&&h.classList.remove("is-active-accordion"),m&&m.classList.remove("is-active-accordion")});let s=i.getAttribute("pb-accordion-initial");if(s&&s!=="none"){let a=r[parseInt(s)-1];a&&this.openAccordion(a)}})}init(){document.querySelectorAll('[pb-component="accordion"]').forEach(t=>{let i=t.querySelector('[pb-accordion-element="group"]');i&&i.addEventListener("click",r=>this.handleClick(r,i))})}handleClick(t,i){let r=t.target.closest('[pb-accordion-element="accordion"]');if(!r)return;let s=r.classList.contains("is-active-accordion");i.getAttribute("pb-accordion-single")==="true"&&i.querySelectorAll('[pb-accordion-element="accordion"]').forEach(l=>{l!==r&&l.classList.contains("is-active-accordion")&&this.closeAccordion(l)}),s?this.closeAccordion(r):this.openAccordion(r)}openAccordion(t){let i=t.querySelector('[pb-accordion-element="trigger"]'),r=t.querySelector('[pb-accordion-element="content"]'),s=t.querySelector('[pb-accordion-element="arrow"]'),a=t.querySelector('[pb-accordion-element="plus"]');r.style.visibility="visible",r.style.display="block",r.offsetHeight;let l=r.scrollHeight;requestAnimationFrame(()=>{r.style.maxHeight=`${l}px`,r.style.opacity="1",i.setAttribute("aria-expanded","true"),t.classList.add("is-active-accordion"),r.classList.add("is-active-accordion"),s&&s.classList.add("is-active-accordion"),a&&a.classList.add("is-active-accordion")}),r.addEventListener("transitionend",()=>{t.classList.contains("is-active-accordion")&&(r.style.maxHeight="none")},{once:!0})}closeAccordion(t){let i=t.querySelector('[pb-accordion-element="trigger"]'),r=t.querySelector('[pb-accordion-element="content"]'),s=t.querySelector('[pb-accordion-element="arrow"]'),a=t.querySelector('[pb-accordion-element="plus"]');r.style.maxHeight=`${r.scrollHeight}px`,r.style.display="block",r.offsetHeight,requestAnimationFrame(()=>{r.style.maxHeight="0",r.style.opacity="0",i.setAttribute("aria-expanded","false"),t.classList.remove("is-active-accordion"),r.classList.remove("is-active-accordion"),s&&s.classList.remove("is-active-accordion"),a&&a.classList.remove("is-active-accordion")}),r.addEventListener("transitionend",()=>{t.classList.contains("is-active-accordion")||(r.style.visibility="hidden",r.style.display="none")},{once:!0})}},Bm=()=>document.querySelector('[pb-component="accordion"]')?new ad:null;var cd=class{constructor(){this.config={enabled:!0,applyToExternalLinks:!1,excludedDomains:[],paramsToCopy:[]},this.loadConfig()}loadConfig(){window.osConfig&&window.osConfig.utmTransfer&&(this.config={...this.config,...window.osConfig.utmTransfer}),(this.config.paramsToCopy===null||this.config.paramsToCopy===void 0)&&(this.config.paramsToCopy=[]),JSON.stringify(this.config)}init(){if(!this.config.enabled)return;let t=new URLSearchParams(window.location.search);if(t.toString()==="")return;let i=[];t.forEach((a,l)=>{i.push(`${l}=${a}`)}),`${i.join(", ")}`;let r=t;if(Array.isArray(this.config.paramsToCopy)&&this.config.paramsToCopy.length>0&&(`${this.config.paramsToCopy.join(", ")}`,r=new URLSearchParams,this.config.paramsToCopy.forEach(a=>{t.has(a)&&(r.append(a,t.get(a)),`${a}${t.get(a)}`)}),r.toString()===""))return;let s=document.querySelectorAll("a");`${s.length}`,s.forEach(a=>{a.addEventListener("click",l=>{this.applyParamsToLink(a,r)})})}applyParamsToLink(t,i=null){if(!t||!t.getAttribute){console.error("UTM Transfer: Invalid link element provided");return}let r=t.getAttribute("href");if(!r||r.startsWith("#")||r.startsWith("javascript:")||r.startsWith("mailto:")||r.startsWith("tel:"))return;if(r.includes("://")&&!r.includes(window.location.hostname)){if(!this.config.applyToExternalLinks)return;if(this.config.excludedDomains&&this.config.excludedDomains.length>0){for(let h of this.config.excludedDomains)if(r.includes(h))return}}let a=i||new URLSearchParams(window.location.search);if(a.toString()==="")return;let l;try{l=new URL(r,window.location.origin)}catch{console.error("UTM Transfer: Invalid URL:",r);return}let d=new URLSearchParams(l.search);a.forEach((h,m)=>{d.has(m)||d.append(m,h)}),l.search=d.toString(),t.setAttribute("href",l.toString()),this.config.debug&&`${r}${l.toString()}`}},Wm=()=>{let c=new cd;return c.init(),c};var pr,gi,G,Xc,Jm,Zc,Xm,Qc,Zm,tl,Qm,el,tg,il,eg,rl,ig,sl,rg,nl,sg,ol,ng,Rs=class{constructor(t={}){o(this,Xc);o(this,Zc);o(this,Qc);o(this,tl);o(this,el);o(this,il);o(this,rl);o(this,sl);o(this,nl);o(this,ol);o(this,pr,!1);o(this,gi,!1);o(this,G,null);this.options={debug:!1,autoInit:!0,googleMapsApiKey:"YOUR_API_KEY_HERE",...t},this.logger=new Ds(this.options.debug),this.coreLogger=this.logger.createModuleLogger("CORE"),this.api=new zs(this),this.config=n(this,Xc,Jm).call(this),this.state=new ua(this),this.attribution=new lc(this),this.cart=new fa(this),this.campaign=new da(this),this.events={on:(i,r)=>this.on(i,r),once:(i,r)=>this.once(i,r),off:(i,r)=>this.off(i,r),trigger:(i,r)=>this.triggerEvent(i,r)},this.options.autoInit&&this.init()}on(t,i){let r=s=>{try{i(s.detail)}catch(a){this.coreLogger.error(`Error in event callback for "${t}":`,a)}};return document.addEventListener(`os:${t}`,r),this.coreLogger.debug(`Event listener registered for "${t}"`),this}once(t,i){let r=s=>{try{i(s.detail)}catch(a){this.coreLogger.error(`Error in one-time event callback for "${t}":`,a)}document.removeEventListener(`os:${t}`,r)};return document.addEventListener(`os:${t}`,r),this.coreLogger.debug(`One-time event listener registered for "${t}"`),this}off(t,i){return document.removeEventListener(`os:${t}`,i),this}async init(){this.coreLogger.info("Initializing 29next client"),this.api.init(),typeof window.on29NextReady<"u"&&!Array.isArray(window.on29NextReady)&&(this.coreLogger.warn("window.on29NextReady is not an array, resetting it"),window.on29NextReady=[]),await n(this,Qc,Zm).call(this),await n(this,Zc,Xm).call(this),u(this,gi,n(this,rl,ig).call(this)),e(this,gi)&&n(this,sl,rg).call(this),n(this,tl,Qm).call(this),n(this,ol,ng).call(this),u(this,pr,!0),this.triggerEvent("initialized",{client:this}),await n(this,el,tg).call(this)}triggerEvent(t,i={}){this.coreLogger.debug(`Triggering event: ${t}`);let r={...i,timestamp:Date.now(),client:this},s=new CustomEvent(`os:${t}`,{bubbles:!0,cancelable:!0,detail:r});return document.dispatchEvent(s),s}getCampaignData(){return e(this,G)}get isInitialized(){return e(this,pr)}get isCheckoutPage(){return e(this,gi)}debugTriggerViewItemList(){return e(this,G)?this.events.viewItemList?(window.dataLayer=window.dataLayer||[],window.dataLayer.push({ecommerce:null}),this.events.viewItemList(e(this,G)),{success:!0,message:"view_item_list event triggered",campaignData:e(this,G)}):(console.error("❌ events.viewItemList not available"),{success:!1,message:"Event manager not initialized"}):(console.error("❌ No campaign data available"),{success:!1,message:"No campaign data"})}isReady(){return e(this,pr)&&e(this,G)!==null&&Array.isArray(e(this,G).packages)}onReady(t){if(!t||typeof t!="function")return this;if(this.isReady())try{t(this)}catch(i){this.coreLogger.error("Error in onReady callback:",i)}else this.once("initialized",()=>{this.isReady()&&t(this)});return this}};pr=new WeakMap,gi=new WeakMap,G=new WeakMap,Xc=new WeakSet,Jm=function(){let t={apiKey:null,campaignId:null,debug:this.options.debug},i=document.querySelector('meta[name="os-api-key"]');t.apiKey=i?.getAttribute("content")??null,this.coreLogger.info(`API key: ${t.apiKey?"✓ Set":"✗ Not set"}`);let r=document.querySelector('meta[name="os-campaign-id"]');return t.campaignId=r?.getAttribute("content")??null,this.coreLogger.info(`Campaign ID: ${t.campaignId?"✓ Set":"✗ Not set"}`),document.querySelector('meta[name="os-debug"]')?.getAttribute("content")==="true"&&(t.debug=!0,this.logger.setDebug(!0),this.coreLogger.info("Debug mode: ✓ Enabled")),t},Zc=new WeakSet,Xm=async function(){if(typeof google<"u"&&typeof google.maps<"u"){this.coreLogger.debug("Google Maps API already loaded");return}return this.coreLogger.debug("Loading Google Maps API..."),new Promise(t=>{let i=document.createElement("script");i.src=`https://maps.googleapis.com/maps/api/js?key=${this.options.googleMapsApiKey}&libraries=places`,i.async=!0,i.defer=!0,i.onload=()=>{this.coreLogger.debug("Google Maps API loaded successfully"),t()},i.onerror=()=>{this.coreLogger.error("Failed to load Google Maps API"),t()},document.head.appendChild(i)})},Qc=new WeakSet,Zm=async function(){try{this.coreLogger.info("Fetching campaign data..."),u(this,G,await this.api.getCampaign()),u(this,G,e(this,G)||{packages:[]}),e(this,G).packages=e(this,G).packages||[],this.campaignData=e(this,G),this.coreLogger.info("Campaign data retrieved successfully"),window.osConfig=window.osConfig||{},window.osConfig.campaign=e(this,G),window.dataLayer=window.dataLayer||[],this.triggerEvent("campaign.loaded",{campaign:e(this,G)})}catch(t){this.coreLogger.error("Failed to retrieve campaign data:",t),u(this,G,{name:"Default Campaign",packages:[],currency:"USD",locale:"en-US"}),this.campaignData=e(this,G)}},tl=new WeakSet,Qm=function(){this.selector=new wa(this),this.toggle=new Ta(this),this.timer=new Ba(this),this.display=new Ka(this),this.eventManager=new wc(this),this.tooltip=new zc(this),(e(this,gi)||document.querySelector('[data-os-cart="line-display"]')||document.querySelector('[os-cart="checkout-summary"]')||document.querySelector('[data-os-cart-summary="grand-total"]'))&&(this.coreLogger.info("Cart display elements detected, initializing CartDisplayManager"),this.cartDisplay=new Xa(this)),this.debug=new Ra(this),Object.assign(this.events,{emit:(t,i)=>this.triggerEvent(t,i),viewItemList:t=>this.eventManager.viewItemList(t||e(this,G)),viewItem:t=>this.eventManager.viewItem(t),addToCart:t=>this.eventManager.addToCart(t),beginCheckout:()=>this.eventManager.beginCheckout(),purchase:(t,i)=>this.eventManager.purchase(t,i),fireCustomEvent:(t,i)=>this.eventManager.fireCustomEvent(t,i)})},el=new WeakSet,tg=async function(){this.events.viewItemList(e(this,G)),await new Promise(t=>setTimeout(t,800)),n(this,il,eg).call(this)},il=new WeakSet,eg=function(){let t=document.querySelector('div[os-element="preloader"]');t&&(this.coreLogger.info("Hiding preloader element"),t.style.transition="opacity 0.5s ease",t.style.opacity="0",t.style.pointerEvents="none",this.coreLogger.debug("Preloader hidden"))},rl=new WeakSet,ig=function(){let i=document.querySelector('meta[name="os-page-type"]')?.getAttribute("content");return i==="checkout"||!i&&document.querySelector('form[os-checkout="form"]')?(this.coreLogger.info("Checkout page detected"),!0):(i==="receipt"&&(this.coreLogger.info("Receipt page detected"),n(this,nl,sg).call(this)),!1)},sl=new WeakSet,rg=function(){this.checkout=new Go(this.api,this.coreLogger,this)},nl=new WeakSet,sg=function(){Promise.resolve().then(()=>(Ym(),Km)).then(t=>{let i=t.ReceiptPage;this.receipt=new i(this.api,this.coreLogger,this),this.coreLogger.info("Receipt page initialized");let r=new URLSearchParams(window.location.search).get("ref_id");r&&this.api.getOrder(r).then(s=>{s&&this.triggerEvent("order.loaded",{order:s})}).catch(s=>this.coreLogger.error("Failed to load order data:",s))}).catch(t=>this.coreLogger.error("Failed to load ReceiptPage module:",t))},ol=new WeakSet,ng=function(){this.coreLogger.info("Initializing UI utilities");try{let t=Bm();t&&(this.pbAccordion=t,this.coreLogger.info("PBAccordion initialized"))}catch(t){this.coreLogger.error("Failed to initialize PBAccordion:",t)}try{let t=Wm();t&&(this.utmTransfer=t,this.coreLogger.info("UTM parameter transfer initialized"))}catch(t){this.coreLogger.error("Failed to initialize UTM transfer:",t)}};var og=()=>{try{if(document.querySelector('meta[name="os-disable-auto-init"]'))return;let c={apiKey:document.querySelector('meta[name="os-api-key"]')?.getAttribute("content")??null,campaignId:document.querySelector('meta[name="os-campaign-id"]')?.getAttribute("content")??null,debug:document.querySelector('meta[name="os-debug"]')?.getAttribute("content")==="true",paypalClientId:document.querySelector('meta[name="os-paypal-client-id"]')?.getAttribute("content")??null};JSON.stringify({apiKey:c.apiKey?"✓ Set":"✗ Not set",campaignId:c.campaignId?"✓ Set":"✗ Not set",debug:c.debug}),window.on29NextReady=Array.isArray(window.on29NextReady)?window.on29NextReady:[];let t=[...window.on29NextReady];window.twentyNineNext=new Rs(c),t.forEach(i=>{window.twentyNineNext.onReady(i)}),window.on29NextReady={push:i=>window.twentyNineNext.onReady(i)}}catch(c){console.error("29next Client: Error during initialization",c)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",og):og();return mg(Ng);})();
