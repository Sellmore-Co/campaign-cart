!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).NextCommerce={})}(this,function(t){"use strict";var e,i=Object.defineProperty,n=Object.defineProperties,r=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,a=Object.getPrototypeOf,o=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,l=Reflect.get,d=(t,e,n)=>e in t?i(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,u=(t,e)=>{for(var i in e||(e={}))o.call(e,i)&&d(t,i,e[i]);if(s)for(var i of s(e))c.call(e,i)&&d(t,i,e[i]);return t},h=(t,e)=>n(t,r(e)),p=(t,e)=>{var i={};for(var n in t)o.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&s)for(var n of s(t))e.indexOf(n)<0&&c.call(t,n)&&(i[n]=t[n]);return i},f=(t,e,i)=>d(t,"symbol"!=typeof e?e+"":e,i),m=(t,e,i)=>l(a(t),i,e),g=(t,e,i)=>new Promise((n,r)=>{var s=t=>{try{o(i.next(t))}catch(ko){r(ko)}},a=t=>{try{o(i.throw(t))}catch(ko){r(ko)}},o=t=>t.done?n(t.value):Promise.resolve(t.value).then(s,a);o((i=i.apply(t,e)).next())});const v=t=>{let e;const i=new Set,n=(t,n)=>{const r="function"==typeof t?t(e):t;if(!Object.is(r,e)){const t=e;e=(null!=n?n:"object"!=typeof r||null===r)?r:Object.assign({},e,r),i.forEach(i=>i(e,t))}},r=()=>e,s={setState:n,getState:r,getInitialState:()=>a,subscribe:t=>(i.add(t),()=>i.delete(t)),destroy:()=>{i.clear()}},a=e=t(n,r,s);return s};function y(t){return t&&t._&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var b,x,w={exports:{}},_={};function k(){if(b)return _;b=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),u=Symbol.iterator,h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,f={};function m(t,e,i){this.props=t,this.context=e,this.refs=f,this.updater=i||h}function g(){}function v(t,e,i){this.props=t,this.context=e,this.refs=f,this.updater=i||h}m.prototype.isReactComponent={},m.prototype.setState=function(t,e){if("object"!=typeof t&&"function"!=typeof t&&null!=t)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},m.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},g.prototype=m.prototype;var y=v.prototype=new g;y.constructor=v,p(y,m.prototype),y.isPureReactComponent=!0;var x=Array.isArray,w={H:null,A:null,T:null,S:null,V:null},k=Object.prototype.hasOwnProperty;function S(e,i,n,r,s,a){return n=a.ref,{$$typeof:t,type:e,key:i,ref:void 0!==n?n:null,props:a}}function P(e){return"object"==typeof e&&null!==e&&e.$$typeof===t}var C=/\/+/g;function E(t,e){return"object"==typeof t&&null!==t&&null!=t.key?(i=""+t.key,n={"=":"=0",":":"=2"},"$"+i.replace(/[=:]/g,function(t){return n[t]})):e.toString(36);var i,n}function $(){}function T(i,n,r,s,a){var o=typeof i;"undefined"!==o&&"boolean"!==o||(i=null);var c,l,h=!1;if(null===i)h=!0;else switch(o){case"bigint":case"string":case"number":h=!0;break;case"object":switch(i.$$typeof){case t:case e:h=!0;break;case d:return T((h=i.k)(i.C),n,r,s,a)}}if(h)return a=a(i),h=""===s?"."+E(i,0):s,x(a)?(r="",null!=h&&(r=h.replace(C,"$&/")+"/"),T(a,n,r,"",function(t){return t})):null!=a&&(P(a)&&(c=a,l=r+(null==a.key||i&&i.key===a.key?"":(""+a.key).replace(C,"$&/")+"/")+h,a=S(c.type,l,void 0,0,0,c.props)),n.push(a)),1;h=0;var p,f=""===s?".":s+":";if(x(i))for(var m=0;m<i.length;m++)h+=T(s=i[m],n,r,o=f+E(s,m),a);else if("function"==typeof(m=null===(p=i)||"object"!=typeof p?null:"function"==typeof(p=u&&p[u]||p["@@iterator"])?p:null))for(i=m.call(i),m=0;!(s=i.next()).done;)h+=T(s=s.value,n,r,o=f+E(s,m++),a);else if("object"===o){if("function"==typeof i.then)return T(function(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch("string"==typeof t.status?t.then($,$):(t.status="pending",t.then(function(e){"pending"===t.status&&(t.status="fulfilled",t.value=e)},function(e){"pending"===t.status&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}(i),n,r,s,a);throw n=String(i),Error("Objects are not valid as a React child (found: "+("[object Object]"===n?"object with keys {"+Object.keys(i).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.")}return h}function I(t,e,i){if(null==t)return t;var n=[],r=0;return T(t,n,"","",function(t){return e.call(i,t,r++)}),n}function A(t){if(-1===t.I){var e=t.M;(e=e()).then(function(e){0!==t.I&&-1!==t.I||(t.I=1,t.M=e)},function(e){0!==t.I&&-1!==t.I||(t.I=2,t.M=e)}),-1===t.I&&(t.I=0,t.M=e)}if(1===t.I)return t.M.default;throw t.M}var M="function"==typeof reportError?reportError:function(t){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof t&&null!==t&&"string"==typeof t.message?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",t)};function L(){}return _.Children={map:I,forEach:function(t,e,i){I(t,function(){e.apply(this,arguments)},i)},count:function(t){var e=0;return I(t,function(){e++}),e},toArray:function(t){return I(t,function(t){return t})||[]},only:function(t){if(!P(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},_.Component=m,_.Fragment=i,_.Profiler=r,_.PureComponent=v,_.StrictMode=n,_.Suspense=c,_.D=w,_.F={__proto__:null,c:function(t){return w.H.useMemoCache(t)}},_.cache=function(t){return function(){return t.apply(null,arguments)}},_.cloneElement=function(t,e,i){if(null==t)throw Error("The argument must be a React element, but you passed "+t+".");var n=p({},t.props),r=t.key;if(null!=e)for(s in e.ref,void 0!==e.key&&(r=""+e.key),e)!k.call(e,s)||"key"===s||"__self"===s||"__source"===s||"ref"===s&&void 0===e.ref||(n[s]=e[s]);var s=arguments.length-2;if(1===s)n.children=i;else if(1<s){for(var a=Array(s),o=0;o<s;o++)a[o]=arguments[o+2];n.children=a}return S(t.type,r,void 0,0,0,n)},_.createContext=function(t){return(t={$$typeof:a,O:t,U:t,N:0,Provider:null,Consumer:null}).Provider=t,t.Consumer={$$typeof:s,j:t},t},_.createElement=function(t,e,i){var n,r={},s=null;if(null!=e)for(n in void 0!==e.key&&(s=""+e.key),e)k.call(e,n)&&"key"!==n&&"__self"!==n&&"__source"!==n&&(r[n]=e[n]);var a=arguments.length-2;if(1===a)r.children=i;else if(1<a){for(var o=Array(a),c=0;c<a;c++)o[c]=arguments[c+2];r.children=o}if(t&&t.defaultProps)for(n in a=t.defaultProps)void 0===r[n]&&(r[n]=a[n]);return S(t,s,void 0,0,0,r)},_.createRef=function(){return{current:null}},_.forwardRef=function(t){return{$$typeof:o,render:t}},_.isValidElement=P,_.lazy=function(t){return{$$typeof:d,C:{I:-1,M:t},k:A}},_.memo=function(t,e){return{$$typeof:l,type:t,compare:void 0===e?null:e}},_.startTransition=function(t){var e=w.T,i={};w.T=i;try{var n=t(),r=w.S;null!==r&&r(i,n),"object"==typeof n&&null!==n&&"function"==typeof n.then&&n.then(L,M)}catch(s){M(s)}finally{w.T=e}},_.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},_.use=function(t){return w.H.use(t)},_.useActionState=function(t,e,i){return w.H.useActionState(t,e,i)},_.useCallback=function(t,e){return w.H.useCallback(t,e)},_.useContext=function(t){return w.H.useContext(t)},_.useDebugValue=function(){},_.useDeferredValue=function(t,e){return w.H.useDeferredValue(t,e)},_.useEffect=function(t,e,i){var n=w.H;if("function"==typeof i)throw Error("useEffect CRUD overload is not enabled in this build of React.");return n.useEffect(t,e)},_.useId=function(){return w.H.useId()},_.useImperativeHandle=function(t,e,i){return w.H.useImperativeHandle(t,e,i)},_.useInsertionEffect=function(t,e){return w.H.useInsertionEffect(t,e)},_.useLayoutEffect=function(t,e){return w.H.useLayoutEffect(t,e)},_.useMemo=function(t,e){return w.H.useMemo(t,e)},_.useOptimistic=function(t,e){return w.H.useOptimistic(t,e)},_.useReducer=function(t,e,i){return w.H.useReducer(t,e,i)},_.useRef=function(t){return w.H.useRef(t)},_.useState=function(t){return w.H.useState(t)},_.useSyncExternalStore=function(t,e,i){return w.H.useSyncExternalStore(t,e,i)},_.useTransition=function(){return w.H.useTransition()},_.version="19.1.1",_}function S(){return x||(x=1,w.exports=k()),w.exports}const P=y(S());var C,E,$,T,I={exports:{}},A={},M={exports:{}},L={};const D=y((T||(T=1,I.exports=function(){if($)return A;$=1;var t=S(),e=(E||(E=1,M.exports=function(){if(C)return L;C=1;var t=S(),e="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},i=t.useState,n=t.useEffect,r=t.useLayoutEffect,s=t.useDebugValue;function a(t){var i=t.getSnapshot;t=t.value;try{var n=i();return!e(t,n)}catch(r){return!0}}var o="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(t,e){return e()}:function(t,e){var o=e(),c=i({inst:{value:o,getSnapshot:e}}),l=c[0].inst,d=c[1];return r(function(){l.value=o,l.getSnapshot=e,a(l)&&d({inst:l})},[t,o,e]),n(function(){return a(l)&&d({inst:l}),t(function(){a(l)&&d({inst:l})})},[t]),s(o),o};return L.useSyncExternalStore=void 0!==t.useSyncExternalStore?t.useSyncExternalStore:o,L}()),M.exports),i="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},n=e.useSyncExternalStore,r=t.useRef,s=t.useEffect,a=t.useMemo,o=t.useDebugValue;return A.useSyncExternalStoreWithSelector=function(t,e,c,l,d){var u=r(null);if(null===u.current){var h={hasValue:!1,value:null};u.current=h}else h=u.current;u=a(function(){function t(t){if(!s){if(s=!0,n=t,t=l(t),void 0!==d&&h.hasValue){var e=h.value;if(d(e,t))return r=e}return r=t}if(e=r,i(n,t))return e;var a=l(t);return void 0!==d&&d(e,a)?(n=t,e):(n=t,r=a)}var n,r,s=!1,a=void 0===c?null:c;return[function(){return t(e())},null===a?void 0:function(){return t(a())}]},[e,c,l,d]);var p=n(t,u[0],u[1]);return s(function(){h.hasValue=!0,h.value=p},[p]),o(p),p},A}()),I.exports)),F={},{useDebugValue:O}=P,{useSyncExternalStoreWithSelector:U}=D;let N=!1;const z=t=>t,q=t=>{const e="function"==typeof t?(t=>t?v(t):v)(t):t,i=(t,i)=>function(t,e=z,i){"production"!==(F?"production":void 0)&&i&&!N&&(N=!0);const n=U(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,i);return O(n),n}(e,t,i);return Object.assign(i,e),i},j=t=>t?q(t):q,R={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},H=new Map,V=t=>{const e=H.get(t);return e?Object.fromEntries(Object.entries(e.stores).map(([t,e])=>[t,e.getState()])):{}},B=(t,e)=>{let i;try{i=JSON.parse(t)}catch(n){}void 0!==i&&e(i)},J=t=>(e,i,n)=>{const r=n.subscribe;return n.subscribe=(t,e,i)=>{let s=t;if(e){const r=(null==i?void 0:i.equalityFn)||Object.is;let a=t(n.getState());s=i=>{const n=t(i);if(!r(a,n)){const t=a;e(a=n,t)}},(null==i?void 0:i.fireImmediately)&&e(a,a)}return r(s)},t(e,i,n)};function G(t,e){let i;try{i=t()}catch(n){return}return{getItem:t=>{var e;const n=t=>null===t?null:JSON.parse(t,void 0),r=null!=(e=i.getItem(t))?e:null;return r instanceof Promise?r.then(n):n(r)},setItem:(t,e)=>i.setItem(t,JSON.stringify(e,void 0)),removeItem:t=>i.removeItem(t)}}const K=t=>e=>{try{const i=t(e);return i instanceof Promise?i:{then:t=>K(t)(i),catch(t){return this}}}catch(i){return{then(t){return this},catch:t=>K(t)(i)}}},Q=(t,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((t,e)=>(i,n,r)=>{let s=u({getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:t=>t,version:0,merge:(t,e)=>u(u({},e),t)},e),a=!1;const o=new Set,c=new Set;let l;try{l=s.getStorage()}catch(v){}if(!l)return t((...t)=>{i(...t)},n,r);const d=K(s.serialize),h=()=>{const t=s.partialize(u({},n()));let e;const i=d({state:t,version:s.version}).then(t=>l.setItem(s.name,t)).catch(t=>{e=t});if(e)throw e;return i},p=r.setState;r.setState=(t,e)=>{p(t,e),h()};const f=t((...t)=>{i(...t),h()},n,r);let m;const g=()=>{var t;if(!l)return;a=!1,o.forEach(t=>t(n()));const e=(null==(t=s.onRehydrateStorage)?void 0:t.call(s,n()))||void 0;return K(l.getItem.bind(l))(s.name).then(t=>{if(t)return s.deserialize(t)}).then(t=>{if(t){if("number"!=typeof t.version||t.version===s.version)return t.state;if(s.migrate)return s.migrate(t.state,t.version)}}).then(t=>{var e;return m=s.merge(t,null!=(e=n())?e:f),i(m,!0),h()}).then(()=>{null==e||e(m,void 0),a=!0,c.forEach(t=>t(m))}).catch(t=>{null==e||e(void 0,t)})};return r.persist={setOptions:t=>{s=u(u({},s),t),t.getStorage&&(l=t.getStorage())},clearStorage:()=>{null==l||l.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>g(),hasHydrated:()=>a,onHydrate:t=>(o.add(t),()=>{o.delete(t)}),onFinishHydration:t=>(c.add(t),()=>{c.delete(t)})},g(),m||f})(t,e):((t,e)=>(i,n,r)=>{let s=u({storage:G(()=>localStorage),partialize:t=>t,version:0,merge:(t,e)=>u(u({},e),t)},e),a=!1;const o=new Set,c=new Set;let l=s.storage;if(!l)return t((...t)=>{i(...t)},n,r);const d=()=>{const t=s.partialize(u({},n()));return l.setItem(s.name,{state:t,version:s.version})},h=r.setState;r.setState=(t,e)=>{h(t,e),d()};const p=t((...t)=>{i(...t),d()},n,r);let f;r.getInitialState=()=>p;const m=()=>{var t,e;if(!l)return;a=!1,o.forEach(t=>{var e;return t(null!=(e=n())?e:p)});const r=(null==(e=s.onRehydrateStorage)?void 0:e.call(s,null!=(t=n())?t:p))||void 0;return K(l.getItem.bind(l))(s.name).then(t=>{if(t){if("number"!=typeof t.version||t.version===s.version)return[!1,t.state];if(s.migrate)return[!0,s.migrate(t.state,t.version)]}return[!1,void 0]}).then(t=>{var e;const[r,a]=t;if(f=s.merge(a,null!=(e=n())?e:p),i(f,!0),r)return d()}).then(()=>{null==r||r(f,void 0),f=n(),a=!0,c.forEach(t=>t(f))}).catch(t=>{null==r||r(void 0,t)})};return r.persist={setOptions:t=>{s=u(u({},s),t),t.storage&&(l=t.storage)},clearStorage:()=>{null==l||l.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>m(),hasHydrated:()=>a,onHydrate:t=>(o.add(t),()=>{o.delete(t)}),onFinishHydration:t=>(c.add(t),()=>{c.delete(t)})},s.skipHydration||m(),f||p})(t,e);var Z=(t=>(t[t.ERROR=0]="ERROR",t[t.WARN=1]="WARN",t[t.INFO=2]="INFO",t[t.DEBUG=3]="DEBUG",t))(Z||{});const W=()=>{if("undefined"==typeof window)return!1;const t=new URLSearchParams(window.location.search);return"true"===t.get("debug")||"true"===t.get("debugger")};let Y=((e=class{constructor(t){this.context=t}static setLogLevel(t){e.globalLevel=t}static getLogLevel(){return e.globalLevel}error(t,...i){e.globalLevel}warn(t,...i){W()&&e.globalLevel}info(t,...i){W()&&e.globalLevel}debug(t,...i){W()&&e.globalLevel}}).globalLevel=2,e);class X extends Y{constructor(t){super(t)}warn(t,...e){W()&&super.warn(t,...e)}info(t,...e){W()&&super.info(t,...e)}debug(t,...e){W()&&super.debug(t,...e)}}function tt(t){return new X(t)}tt("SDK");class et{constructor(t={}){var e,i,n;this.logger=tt("StorageManager"),this.storage=null!=(e=t.storage)?e:sessionStorage,this.serialize=null!=(i=t.serialize)?i:JSON.stringify,this.deserialize=null!=(n=t.deserialize)?n:JSON.parse}set(t,e){try{const i=this.serialize(e);return this.storage.setItem(t,i),this.logger.debug(`Stored value for key: ${t}`),!0}catch(i){return this.logger.error(`Failed to store value for key ${t}:`,i),!1}}get(t,e){try{const i=this.storage.getItem(t);if(null===i)return this.logger.debug(`No value found for key: ${t}`),e;const n=this.deserialize(i);return this.logger.debug(`Retrieved value for key: ${t}`),n}catch(i){return this.logger.error(`Failed to retrieve value for key ${t}:`,i),e}}remove(t){try{return this.storage.removeItem(t),this.logger.debug(`Removed value for key: ${t}`),!0}catch(e){return this.logger.error(`Failed to remove value for key ${t}:`,e),!1}}clear(){try{return this.storage.clear(),this.logger.debug("Cleared all storage"),!0}catch(t){return this.logger.error("Failed to clear storage:",t),!1}}has(t){return null!==this.storage.getItem(t)}keys(){const t=[];for(let e=0;e<this.storage.length;e++){const i=this.storage.key(e);null!==i&&t.push(i)}return t}size(){let t=0;for(let e=0;e<this.storage.length;e++){const i=this.storage.key(e);if(null!==i){const e=this.storage.getItem(i);null!==e&&(t+=i.length+e.length)}}return t}}const it=new et({storage:sessionStorage});new et({storage:localStorage});const nt="next-cart-state",rt="next-campaign-cache";class st{constructor(){this.listeners=new Map}static getInstance(){return st.instance||(st.instance=new st),st.instance}on(t,e){this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(e)}emit(t,e){const i=this.listeners.get(t);i&&i.forEach(t=>{try{t(e)}catch(i){}})}off(t,e){const i=this.listeners.get(t);i&&i.delete(e)}removeAllListeners(t){t?this.listeners.delete(t):this.listeners.clear()}}const at=Object.freeze(Object.defineProperty({__proto__:null,EventBus:st},Symbol.toStringTag,{value:"Module"})),ot=6e5,ct=tt("CampaignStore"),lt={data:null,packages:[],isLoading:!1,error:null},dt=j((t,e)=>h(u({},lt),{processPackagesWithVariants:t=>t.map(t=>{if(t.product_id&&t.product_variant_id){const e={id:t.product_id,name:t.product_name||"",variant:{id:t.product_variant_id,name:t.product_variant_name||"",attributes:t.product_variant_attribute_values||[],sku:t.product_sku},purchase_availability:t.product_purchase_availability||"available",inventory_availability:t.product_inventory_availability||"untracked"};return h(u({},t),{product:e})}return t}),loadCampaign:i=>g(null,null,function*(){t({isLoading:!0,error:null});try{const{useConfigStore:n}=yield Promise.resolve().then(()=>bt),r=n.getState(),s=r.selectedCurrency||r.detectedCurrency||"USD",a=Date.now(),o=`${rt}_${s}`,c=`${rt}_USD`,l=new URLSearchParams(window.location.search).get("currency"),d=l&&l===s;let p=it.get(o);if(p||"USD"===s||d||(p=it.get(c),p&&ct.info(`No cache for ${s}, checking USD cache as potential fallback`)),p&&p.apiKey===i&&a-p.timestamp<ot&&(!d||p.campaign.currency===s)){const i=p.campaign.currency;if(ct.info(`ðŸŽ¯ Using cached campaign data for ${i} (expires in `+Math.round((ot-(a-p.timestamp))/1e3)+" seconds)"),i!==s){ct.warn(`âš ï¸ Requested ${s} but using cached ${i} (fallback)`),r.updateConfig({selectedCurrency:i,currencyFallbackOccurred:!0}),sessionStorage.setItem("next_selected_currency",i);const{EventBus:t}=yield Promise.resolve().then(()=>at);t.getInstance().emit("currency:fallback",{requested:s,actual:i,reason:"cached"})}p.campaign.payment_env_key&&r.setSpreedlyEnvironmentKey(p.campaign.payment_env_key);const n=e().processPackagesWithVariants(p.campaign.packages);return void t({data:h(u({},p.campaign),{packages:n}),packages:n,isLoading:!1,error:null,isFromCache:!0,cacheAge:a-p.timestamp})}d&&(null==p?void 0:p.campaign.currency)!==s&&ct.info(`ðŸ”„ URL parameter forcing fresh fetch for currency: ${s} (cache had ${(null==p?void 0:p.campaign.currency)||"none"})`),ct.info(`ðŸŒ Fetching campaign data from API with currency: ${s}...`);const{ApiClient:f}=yield Promise.resolve().then(()=>se),m=new f(i),g=yield m.getCampaigns(s);if(!g)throw new Error("Campaign data not found");const v=g.currency||s;if(v!==s){ct.warn(`âš ï¸ API Fallback: Requested ${s}, received ${v}`),r.updateConfig({selectedCurrency:v,currencyFallbackOccurred:!0}),sessionStorage.setItem("next_selected_currency",v);const{EventBus:t}=yield Promise.resolve().then(()=>at);t.getInstance().emit("currency:fallback",{requested:s,actual:v,reason:"api"})}else r.updateConfig({currencyFallbackOccurred:!1});g.payment_env_key&&(r.setSpreedlyEnvironmentKey(g.payment_env_key),ct.info("ðŸ’³ Spreedly environment key updated from campaign API: "+g.payment_env_key));const y=e().processPackagesWithVariants(g.packages),b=`${rt}_${v}`,x={campaign:h(u({},g),{packages:y}),timestamp:a,apiKey:i};it.set(b,x),ct.info(`ðŸ’¾ Campaign data cached for ${v} (10 minutes)`),v!==s&&(sessionStorage.removeItem(o),ct.debug(`Cleared invalid cache for ${s}`)),t({data:h(u({},g),{packages:y}),packages:y,isLoading:!1,error:null,isFromCache:!1,cacheAge:0});const{useCartStore:w}=yield Promise.resolve().then(()=>It),_=w.getState();!_.isEmpty&&_.lastCurrency&&_.lastCurrency!==v?(ct.info("Currency changed, refreshing cart prices..."),yield _.refreshItemPrices(),_.setLastCurrency(v)):_.lastCurrency||_.setLastCurrency(v)}catch(n){const e=n instanceof Error?n.message:"Failed to load campaign";throw t({data:null,packages:[],isLoading:!1,error:e}),ct.error("Campaign load failed:",n),n}}),getPackage:t=>{var i;const{packages:n}=e();return null!=(i=n.find(e=>e.ref_id===t))?i:null},getProduct:t=>e().getPackage(t),setError:e=>{t({error:e})},reset:()=>{t(lt)},clearCache:()=>{try{const t=window.sessionStorage,e=[];for(let i=0;i<t.length;i++){const n=t.key(i);n&&(n.startsWith(rt)||n===rt)&&e.push(n)}e.forEach(t=>{it.remove(t),ct.debug(`Removed cache: ${t}`)}),ct.info(`ðŸ—‘ï¸ Campaign cache cleared (${e.length} entries removed)`)}catch(t){ct.error("Failed to clear campaign cache:",t),["USD","EUR","GBP","CAD","AUD","JPY","BRL","MXN","INR"].forEach(t=>{it.remove(`${rt}_${t}`)}),it.remove(rt)}},getCacheInfo:()=>{const{useConfigStore:t}=require("./configStore"),e=t.getState(),i=e.selectedCurrency||e.detectedCurrency||"USD",n=`${rt}_${i}`,r=it.get(n);if(!r)return{cached:!1};const s=Date.now(),a=ot-(s-r.timestamp);return{cached:!0,expiresIn:Math.max(0,Math.round(a/1e3)),apiKey:r.apiKey,currency:i}},getVariantsByProductId:t=>{const{packages:i}=e(),n=i.filter(e=>e.product_id===t);if(0===n.length)return null;const r=new Set;n.forEach(t=>{var e;null==(e=t.product_variant_attribute_values)||e.forEach(t=>{r.add(t.code)})});const s=n[0];return{productId:t,productName:s.product_name||"",attributeTypes:Array.from(r),variants:n.map(t=>({variantId:t.product_variant_id||0,variantName:t.product_variant_name||"",packageRefId:t.ref_id,attributes:t.product_variant_attribute_values||[],sku:t.product_sku,price:t.price,availability:{purchase:t.product_purchase_availability||"available",inventory:t.product_inventory_availability||"untracked"}}))}},getAvailableVariantAttributes:(t,i)=>{const n=e().getVariantsByProductId(t);if(!n)return[];const r=new Set;return n.variants.forEach(t=>{const e=t.attributes.find(t=>t.code===i);e&&r.add(e.value)}),Array.from(r).sort()},getPackageByVariantSelection:(t,i)=>{var n;const{packages:r}=e();return null!=(n=r.find(e=>{var n;if(e.product_id!==t)return!1;for(const[t,r]of Object.entries(i))if(!(null==(n=e.product_variant_attribute_values)?void 0:n.some(e=>e.code===t&&e.value===r)))return!1;return!0}))?n:null},getProductVariantsWithPricing:t=>{const{packages:i}=e(),n=i.filter(e=>e.product_id===t);if(0===n.length)return null;const r=new Map,s=new Set;n.forEach(t=>{var e,i;const n=(null==(e=t.product_variant_attribute_values)?void 0:e.map(t=>`${t.code}:${t.value}`).sort().join("|"))||"";null==(i=t.product_variant_attribute_values)||i.forEach(t=>{s.add(t.code)}),r.has(n)||r.set(n,{variantId:t.product_variant_id||0,variantName:t.product_variant_name||"",attributes:t.product_variant_attribute_values||[],sku:t.product_sku,availability:{purchase:t.product_purchase_availability||"available",inventory:t.product_inventory_availability||"untracked"},pricingTiers:[]});const a=t.name.match(/^(Buy \d+|Subscribe)/i),o=a?a[1]:"Standard";r.get(n).pricingTiers.push({packageRefId:t.ref_id,name:t.name,price:t.price,retailPrice:t.price_retail,quantity:t.qty,tierType:o})}),r.forEach(t=>{t.pricingTiers.sort((t,e)=>parseFloat(t.price)-parseFloat(e.price))});const a=n[0];return{productId:t,productName:a.product_name||"",attributeTypes:Array.from(s),variants:r}},getVariantPricingTiers:(t,i)=>{const n=e().getProductVariantsWithPricing(t);if(!n)return[];const r=n.variants.get(i);return r?r.pricingTiers:[]},getLowestPriceForVariant:(t,i)=>{const n=e().getVariantPricingTiers(t,i);return 0===n.length?null:n.reduce((t,e)=>parseFloat(e.price)<parseFloat(t.price)?e:t)}})),ut=Object.freeze(Object.defineProperty({__proto__:null,useCampaignStore:dt},Symbol.toStringTag,{value:"Module"})),ht=new et({storage:localStorage}),pt=tt("ProfileStore"),ft={profiles:new Map,activeProfileId:null,previousProfileId:null,mappingHistory:[],originalCartSnapshot:void 0},mt=j()(Q(J((t,e)=>h(u({},ft),{registerProfile:e=>{t(t=>{const i=new Map(t.profiles),n={};return Object.entries(e.packageMappings).forEach(([t,e])=>{n[e]=parseInt(t,10)}),i.set(e.id,h(u({},e),{reverseMapping:n})),pt.info(`Profile "${e.id}" registered with ${Object.keys(e.packageMappings).length} mappings`),{profiles:i}})},activateProfile:i=>{const n=e();n.profiles.has(i)?(t({previousProfileId:n.activeProfileId,activeProfileId:i}),pt.info(`Profile "${i}" activated`)):pt.error(`Cannot activate profile "${i}" - not found`)},deactivateProfile:()=>{const i=e();t({previousProfileId:i.activeProfileId,activeProfileId:null}),pt.info("Profile deactivated")},getMappedPackageId:t=>{const i=e();if(!i.activeProfileId)return t;const n=i.profiles.get(i.activeProfileId);if(!n)return t;const r=n.packageMappings[t];return void 0!==r?(pt.debug(`Mapped package ${t} -> ${r} (profile: ${i.activeProfileId})`),r):t},getOriginalPackageId:t=>{const i=e();if(!i.activeProfileId)return null;const n=i.profiles.get(i.activeProfileId);if(!n)return null;if(n.reverseMapping&&void 0!==n.reverseMapping[t])return n.reverseMapping[t];for(const[e,r]of Object.entries(n.packageMappings))if(r===t)return parseInt(e,10);return null},mapPackageIds:t=>{const i=e().getMappedPackageId;return t.map(t=>i(t))},getActiveProfile:()=>{const t=e();return t.activeProfileId&&t.profiles.get(t.activeProfileId)||null},hasProfile:t=>e().profiles.has(t),getProfileById:t=>e().profiles.get(t)||null,getAllProfiles:()=>Array.from(e().profiles.values()),setOriginalCartSnapshot:e=>{t({originalCartSnapshot:[...e]}),pt.debug(`Cart snapshot saved with ${e.length} items`)},clearOriginalCartSnapshot:()=>{t({originalCartSnapshot:void 0}),pt.debug("Cart snapshot cleared")},addMappingEvent:e=>{t(t=>({mappingHistory:[...t.mappingHistory,h(u({},e),{timestamp:Date.now()})].slice(-50)}))},clearHistory:()=>{t({mappingHistory:[]})},reset:()=>{t(ft),pt.info("ProfileStore reset to initial state")}})),{name:"next-profile-store",storage:{getItem:t=>{var e;const i=ht.get(t);if(!i)return null;const n=JSON.parse(i);return(null==(e=n.state)?void 0:e.profiles)&&(n.state.profiles=new Map(n.state.profiles)),n},setItem:(t,e)=>{var i;const n=u({},e);(null==(i=n.state)?void 0:i.profiles)instanceof Map&&(n.state.profiles=Array.from(n.state.profiles.entries())),ht.set(t,JSON.stringify(n))},removeItem:t=>{ht.remove(t)}}})),gt=Object.freeze(Object.defineProperty({__proto__:null,useProfileStore:mt},Symbol.toStringTag,{value:"Module"})),vt={apiKey:"",campaignId:"",debug:!1,pageType:"product",paymentConfig:{},googleMapsConfig:{},addressConfig:{},autoInit:!0,rateLimit:4,cacheTtl:300,retryAttempts:3,timeout:1e4,testMode:!1,maxRetries:3,requestTimeout:3e4,enableAnalytics:!0,enableDebugMode:!1,environment:"production",discounts:{},tracking:"auto",detectedCountry:"",detectedCurrency:"",selectedCurrency:"",locationData:null,currencyBehavior:"auto",currencyFallbackOccurred:!1,profiles:{},defaultProfile:void 0,activeProfile:void 0},yt=j((t,e)=>h(u({},vt),{loadFromMeta:()=>{var e,i;if("undefined"==typeof document)return;const n={},r=document.querySelector('meta[name="next-api-key"]');r&&(n.apiKey=null!=(e=r.getAttribute("content"))?e:"");const s=document.querySelector('meta[name="next-campaign-id"]');s&&(n.campaignId=null!=(i=s.getAttribute("content"))?i:"");const a=document.querySelector('meta[name="next-debug"]');a&&(n.debug="true"===a.getAttribute("content"));const o=document.querySelector('meta[name="next-page-type"]');o&&(n.pageType=o.getAttribute("content"));const c=document.querySelector('meta[name="next-spreedly-key"]')||document.querySelector('meta[name="next-payment-env-key"]');if(c){const t=c.getAttribute("content");t&&(n.spreedlyEnvironmentKey=t)}Object.keys(n).length>0&&t(n)},loadFromWindow:()=>{if("undefined"==typeof window)return;const e=window.nextConfig;if(!e||"object"!=typeof e)return;const i={};if("string"==typeof e.apiKey&&(i.apiKey=e.apiKey),"string"==typeof e.campaignId&&(i.campaignId=e.campaignId),"boolean"==typeof e.debug&&(i.debug=e.debug),"string"==typeof e.storeName&&(i.storeName=e.storeName),"string"==typeof e.pageType&&(i.pageType=e.pageType),"string"==typeof e.spreedlyEnvironmentKey&&(i.spreedlyEnvironmentKey=e.spreedlyEnvironmentKey),e.payment&&"object"==typeof e.payment&&(i.paymentConfig=e.payment),e.paymentConfig&&"object"==typeof e.paymentConfig&&(i.paymentConfig=e.paymentConfig),e.googleMaps&&"object"==typeof e.googleMaps&&(i.googleMapsConfig=e.googleMaps),e.addressConfig&&"object"==typeof e.addressConfig&&(i.addressConfig=e.addressConfig),!e.currencyBehavior||"auto"!==e.currencyBehavior&&"manual"!==e.currencyBehavior||(i.currencyBehavior=e.currencyBehavior),e.discounts&&"object"==typeof e.discounts&&(i.discounts=e.discounts),"string"==typeof e.tracking&&(i.tracking=e.tracking),e.analytics&&"object"==typeof e.analytics&&(i.analytics=e.analytics),e.utmTransfer&&"object"==typeof e.utmTransfer&&(i.utmTransfer=e.utmTransfer),e.profiles&&"object"==typeof e.profiles&&(i.profiles=e.profiles),"string"==typeof e.defaultProfile&&(i.defaultProfile=e.defaultProfile),"string"==typeof e.activeProfile&&(i.activeProfile=e.activeProfile),Object.keys(i).length>0&&(t(i),i.profiles)){const t=mt.getState();Object.entries(i.profiles).forEach(([e,i])=>{t.registerProfile({id:e,name:i.name,description:i.description||"",packageMappings:i.packageMappings})})}},loadProfiles:()=>{const t=e();if(!t.profiles||0===Object.keys(t.profiles).length)return;const i=mt.getState();Object.entries(t.profiles).forEach(([t,e])=>{i.registerProfile({id:t,name:e.name,description:e.description||"",packageMappings:e.packageMappings})})},updateConfig:e=>{t(t=>u(u({},t),e))},setSpreedlyEnvironmentKey:e=>{t({spreedlyEnvironmentKey:e})},reset:()=>{t(vt)}})),bt=Object.freeze(Object.defineProperty({__proto__:null,configStore:yt,useConfigStore:yt},Symbol.toStringTag,{value:"Module"})),xt=class{static getCurrentCurrency(){var t;const e=dt.getState();if(null==(t=null==e?void 0:e.data)?void 0:t.currency)return e.data.currency;const i=yt.getState();return(null==i?void 0:i.selectedCurrency)||(null==i?void 0:i.detectedCurrency)||"USD"}static getUserLocale(){return sessionStorage.getItem("next_selected_locale")||navigator.language||"en-US"}static clearCache(){this.formatters.clear(),this.formattersNoZeroCents.clear(),this.numberFormatter=null}static getCurrencyFormatter(t,e=!1){const i=this.getUserLocale(),n=`${i}-${t}-${e}`,r=e?this.formattersNoZeroCents:this.formatters;if(!r.has(n)){const s={style:"currency",currency:t,currencyDisplay:"narrowSymbol"};e&&(s.minimumFractionDigits=0,s.maximumFractionDigits=2),r.set(n,new Intl.NumberFormat(i,s))}return r.get(n)}static getNumberFormatter(){const t=this.getUserLocale();return this.numberFormatter||(this.numberFormatter=new Intl.NumberFormat(t,{minimumFractionDigits:0,maximumFractionDigits:2})),this.numberFormatter}static formatCurrency(t,e,i){const n="string"==typeof t?parseFloat(t):t;if(isNaN(n))return"";const r=e||this.getCurrentCurrency();return this.getCurrencyFormatter(r,null==i?void 0:i.hideZeroCents).format(n)}static formatNumber(t){const e="string"==typeof t?parseFloat(t):t;return isNaN(e)?"":this.getNumberFormatter().format(e)}static formatPercentage(t,e=0){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)+"%"}static getCurrencySymbol(t){const e=t||this.getCurrentCurrency();return this.getCurrencyFormatter(e).format(0).replace(/[0-9.,\s]/g,"").trim()}static isAlreadyFormatted(t,e){if("string"!=typeof t)return!1;const i=this.getCurrencySymbol(e);return t.includes(i)}};xt.formatters=new Map,xt.formattersNoZeroCents=new Map,xt.numberFormatter=null;let wt=xt;const _t=wt.formatCurrency.bind(wt),kt=wt.formatNumber.bind(wt),St=wt.formatPercentage.bind(wt),Pt=wt.getCurrencySymbol.bind(wt),Ct=Object.freeze(Object.defineProperty({__proto__:null,CurrencyFormatter:wt,formatCurrency:_t,formatNumber:kt,formatPercentage:St,getCurrencySymbol:Pt},Symbol.toStringTag,{value:"Module"})),Et=tt("CartStore"),$t={items:[],subtotal:0,shipping:0,tax:0,total:0,totalQuantity:0,isEmpty:!0,appliedCoupons:[],enrichedItems:[],totals:{subtotal:{value:0,formatted:"$0.00"},shipping:{value:0,formatted:"FREE"},tax:{value:0,formatted:"$0.00"},discounts:{value:0,formatted:"$0.00"},total:{value:0,formatted:"$0.00"},totalExclShipping:{value:0,formatted:"$0.00"},count:0,isEmpty:!0,savings:{value:0,formatted:"$0.00"},savingsPercentage:{value:0,formatted:"0%"},compareTotal:{value:0,formatted:"$0.00"},hasSavings:!1,totalSavings:{value:0,formatted:"$0.00"},totalSavingsPercentage:{value:0,formatted:"0%"},hasTotalSavings:!1}},Tt=j()(Q(J((t,e)=>h(u({},$t),{addItem:i=>g(null,null,function*(){var n,r,s;const{useCampaignStore:a}=yield Promise.resolve().then(()=>ut),{useProfileStore:o}=yield Promise.resolve().then(()=>gt),c=a.getState(),l=o.getState();let d=null!=(n=i.packageId)?n:0;if(!i.originalPackageId&&l.activeProfileId){const t=l.getMappedPackageId(d);t!==d&&(Et.debug(`Applying profile mapping: ${d} -> ${t}`),d=t)}const p=c.getPackage(d);if(!p)throw new Error(`Package ${d} not found in campaign data`);t(t=>{var e,n,r,s,a,o,c,l;const f={id:Date.now(),packageId:d,originalPackageId:i.originalPackageId||(d!==(null!=(e=i.packageId)?e:0)?i.packageId:void 0),quantity:null!=(n=i.quantity)?n:1,price:parseFloat(p.price_total),title:null!=(r=i.title)?r:p.name,is_upsell:null!=(s=i.isUpsell)&&s,image:null!=(o=null!=(a=i.image)?a:p.image)?o:void 0,sku:null!=(l=null!=(c=i.sku)?c:p.product_sku)?l:void 0,price_per_unit:p.price,qty:p.qty,price_total:p.price_total,price_retail:p.price_retail,price_retail_total:p.price_retail_total,price_recurring:p.price_recurring,is_recurring:p.is_recurring,interval:p.interval,interval_count:p.interval_count,productId:p.product_id,productName:p.product_name,variantId:p.product_variant_id,variantName:p.product_variant_name,variantAttributes:p.product_variant_attribute_values,variantSku:p.product_sku||void 0};i.isUpsell&&Et.debug("Adding upsell item:",{packageId:f.packageId,isUpsell:i.isUpsell,finalItemIsUpsell:f.is_upsell,itemData:f});const m=t.items.findIndex(t=>t.packageId===f.packageId);let g;return m>=0?(g=[...t.items],g[m].quantity+=f.quantity):g=[...t.items,f],h(u({},t),{items:g})}),e().calculateTotals();const f=st.getInstance();f.emit("cart:item-added",{packageId:null!=(r=i.packageId)?r:0,quantity:null!=(s=i.quantity)?s:1}),f.emit("cart:updated",e())}),removeItem:i=>g(null,null,function*(){const n=e().items.find(t=>t.packageId===i);if(t(t=>{const e=t.items.filter(t=>t.packageId!==i);return h(u({},t),{items:e})}),e().calculateTotals(),n){const t=st.getInstance();t.emit("cart:item-removed",{packageId:i}),t.emit("cart:updated",e())}}),updateQuantity:(i,n)=>g(null,null,function*(){var r;if(n<=0)return e().removeItem(i);const s=e().items.find(t=>t.packageId===i),a=null!=(r=null==s?void 0:s.quantity)?r:0;if(t(t=>{const e=t.items.map(t=>t.packageId===i?h(u({},t),{quantity:n}):t);return h(u({},t),{items:e})}),e().calculateTotals(),s){const t=st.getInstance();t.emit("cart:quantity-changed",{packageId:i,quantity:n,oldQuantity:a}),t.emit("cart:updated",e())}}),swapPackage:(i,n)=>g(null,null,function*(){var r,s,a,o,c,l,d,p,f,m,g;const{useCampaignStore:v}=yield Promise.resolve().then(()=>ut),{useProfileStore:y}=yield Promise.resolve().then(()=>gt),b=v.getState(),x=y.getState();let w=i;if(x.activeProfileId){const t=x.getMappedPackageId(i);t!==i&&(Et.debug(`Applying profile mapping to remove package: ${i} -> ${t}`),w=t)}let _=null!=(r=n.packageId)?r:0;if(x.activeProfileId){const t=x.getMappedPackageId(_);t!==_&&(Et.debug(`Applying profile mapping in swapPackage: ${_} -> ${t}`),_=t)}const k=b.getPackage(_);if(!k)throw new Error(`Package ${_} not found in campaign data`);const S=e().items.find(t=>t.packageId===w),P={id:Date.now(),packageId:_,originalPackageId:_!==(null!=(s=n.packageId)?s:0)?null!=(a=n.packageId)?a:0:void 0,quantity:null!=(o=n.quantity)?o:1,price:parseFloat(k.price_total),title:null!=(c=n.title)?c:k.name,is_upsell:null!=(l=n.isUpsell)&&l,image:null!=(p=null!=(d=n.image)?d:k.image)?p:void 0,sku:null!=(m=null!=(f=n.sku)?f:k.product_sku)?m:void 0,price_per_unit:k.price,qty:k.qty,price_total:k.price_total,price_retail:k.price_retail,price_retail_total:k.price_retail_total,price_recurring:k.price_recurring,is_recurring:k.is_recurring,interval:k.interval,interval_count:k.interval_count,productId:k.product_id,productName:k.product_name,variantId:k.product_variant_id,variantName:k.product_variant_name,variantAttributes:k.product_variant_attribute_values,variantSku:k.product_sku||void 0},C=P.price-(null!=(g=null==S?void 0:S.price)?g:0);t(t=>{const e=t.items.filter(t=>t.packageId!==w),i=e.findIndex(t=>t.packageId===P.packageId);return i>=0?e[i].quantity+=P.quantity:e.push(P),h(u({},t),{items:e,swapInProgress:!1})}),e().calculateTotals();const E=st.getInstance(),$={previousPackageId:w,newPackageId:_,newItem:P,priceDifference:C,source:"package-selector"};S&&($.previousItem=S),E.emit("cart:package-swapped",$),E.emit("cart:updated",e())}),clear:()=>g(null,null,function*(){t(t=>h(u({},t),{items:[]})),e().calculateTotals()}),swapCart:i=>g(null,null,function*(){var n,r;const{useCampaignStore:s}=yield Promise.resolve().then(()=>ut),{useProfileStore:a}=yield Promise.resolve().then(()=>gt),o=s.getState(),c=a.getState(),l=st.getInstance();Et.debug("Swapping cart with new items:",i),t(t=>h(u({},t),{swapInProgress:!0}));const d=[];for(const t of i){let e=t.packageId,i=t.originalPackageId;if(!i&&c.activeProfileId){const t=c.getMappedPackageId(e);t!==e&&(Et.debug(`Applying profile mapping: ${e} -> ${t}`),i=e,e=t)}const s=o.getPackage(e);if(!s){Et.warn(`Package ${e} not found in campaign data, skipping`),Et.debug("Available packages:",null==(r=null==(n=o.data)?void 0:n.packages)?void 0:r.map(t=>t.ref_id));continue}Et.debug(`Package ${e} found:`,s);const a={id:Date.now()+Math.random(),packageId:e,originalPackageId:i,title:s.name||`Package ${e}`,price:parseFloat(s.price_total),price_retail:s.price_retail,quantity:t.quantity,is_upsell:t.isUpsell||!1,image:s.image,sku:s.product_sku||void 0,qty:s.qty,price_total:s.price_total,price_retail_total:s.price_retail_total,price_per_unit:s.price,price_recurring:s.price_recurring,is_recurring:s.is_recurring,interval:s.interval,interval_count:s.interval_count,productId:s.product_id,productName:s.product_name,variantId:s.product_variant_id,variantName:s.product_variant_name,variantAttributes:s.product_variant_attribute_values,variantSku:s.product_sku||void 0};d.push(a)}t(t=>h(u({},t),{items:d,swapInProgress:!1})),e().calculateTotals(),l.emit("cart:updated",e()),Et.info(`Cart swapped successfully with ${d.length} items`)}),syncWithAPI:()=>g(null,null,function*(){Et.debug("syncWithAPI not yet implemented")}),calculateTotals:()=>g(null,null,function*(){try{const{useCampaignStore:i}=yield Promise.resolve().then(()=>ut),n=i.getState(),r=e(),s=r.items.reduce((t,e)=>t+e.price*e.quantity,0),a=r.items.reduce((t,e)=>t+e.quantity,0),o=0===r.items.length,c=r.items.reduce((t,e)=>{const i=n.getPackage(e.packageId);let r=0;return(null==i?void 0:i.price_retail_total)?r=parseFloat(i.price_retail_total):(null==i?void 0:i.price_total)&&(r=parseFloat(i.price_total)),t+r*e.quantity},0),l=Math.max(0,c-s),d=c>0?l/c*100:0,p=l>0,f=e().calculateShipping(),m=e().calculateTax();let g=0;const v=(r.appliedCoupons||[]).map(t=>{const i=e().calculateDiscountAmount(t.definition);return g+=i,h(u({},t),{discount:i})});v.length>0&&t(t=>h(u({},t),{appliedCoupons:v}));const y=s+f+m-g,b=s+m-g,x=l+g,w=c>0?x/c*100:0,_=x>0,k={subtotal:{value:s,formatted:_t(s)},shipping:{value:f,formatted:0===f?"FREE":_t(f)},tax:{value:m,formatted:_t(m)},discounts:{value:g,formatted:_t(g)},total:{value:y,formatted:_t(y)},totalExclShipping:{value:b,formatted:_t(b)},count:a,isEmpty:o,savings:{value:l,formatted:_t(l)},savingsPercentage:{value:d,formatted:St(d)},compareTotal:{value:c,formatted:_t(c)},hasSavings:p,totalSavings:{value:x,formatted:_t(x)},totalSavingsPercentage:{value:w,formatted:St(w)},hasTotalSavings:_};t({subtotal:s,shipping:f,tax:m,total:y,totalQuantity:a,isEmpty:o,totals:k}),yield e().calculateEnrichedItems()}catch(i){t({subtotal:0,shipping:0,tax:0,total:0,totalQuantity:0,isEmpty:!0,totals:{subtotal:{value:0,formatted:"$0.00"},shipping:{value:0,formatted:"FREE"},tax:{value:0,formatted:"$0.00"},discounts:{value:0,formatted:"$0.00"},total:{value:0,formatted:"$0.00"},totalExclShipping:{value:0,formatted:"$0.00"},count:0,isEmpty:!0,savings:{value:0,formatted:"$0.00"},savingsPercentage:{value:0,formatted:"0%"},compareTotal:{value:0,formatted:"$0.00"},hasSavings:!1,totalSavings:{value:0,formatted:"$0.00"},totalSavingsPercentage:{value:0,formatted:"0%"},hasTotalSavings:!1}})}}),hasItem:t=>e().items.some(e=>e.packageId===t),getItem:t=>e().items.find(e=>e.packageId===t),getItemQuantity:t=>{var i;const n=e().items.find(e=>e.packageId===t);return null!=(i=null==n?void 0:n.quantity)?i:0},calculateShipping:()=>{const t=e();return t.isEmpty||0===t.items.length?0:t.shippingMethod?t.shippingMethod.price:0},calculateTax:()=>0,setShippingMethod:i=>g(null,null,function*(){try{const{useCampaignStore:n}=yield Promise.resolve().then(()=>ut),{useCheckoutStore:r}=yield Promise.resolve().then(()=>Lt),s=n.getState(),a=r.getState(),o=s.data;if(!(null==o?void 0:o.shipping_methods))throw new Error("No shipping methods available");const c=o.shipping_methods.find(t=>t.ref_id===i);if(!c)throw new Error(`Shipping method ${i} not found`);const l=parseFloat(c.price||"0");t(t=>h(u({},t),{shippingMethod:{id:c.ref_id,name:c.code,price:l,code:c.code}})),a.setShippingMethod({id:c.ref_id,name:c.code,price:l,code:c.code}),e().calculateTotals(),st.getInstance().emit("shipping:method-changed",{methodId:i,method:c})}catch(n){throw n}}),getTotalWeight:()=>e().items.reduce((t,e)=>t+e.quantity,0),getTotalItemCount:()=>e().items.reduce((t,e)=>t+e.quantity,0),calculateEnrichedItems:()=>g(null,null,function*(){try{const{useCampaignStore:i}=yield Promise.resolve().then(()=>ut),n=i.getState(),r=e().items.map(t=>{var e,i;const r=n.getPackage(t.packageId),s=parseFloat((null==r?void 0:r.price)||"0"),a=parseFloat((null==r?void 0:r.price_retail)||(null==r?void 0:r.price)||"0"),o=t.price*t.quantity;let c=0;(null==r?void 0:r.price_retail_total)?c=parseFloat(r.price_retail_total):(null==r?void 0:r.price_total)&&(c=parseFloat(r.price_total));const l=c*t.quantity,d=Math.max(0,a-s),u=Math.max(0,l-o),h=a>s?Math.round(d/a*100):0,p=!0===(null==r?void 0:r.is_recurring),f=p?parseFloat((null==r?void 0:r.price_recurring)||"0"):0,m=p?(null==r?void 0:r.interval_count)&&r.interval_count>1?`Every ${r.interval_count} ${r.interval}s`:`Per ${r.interval}`:"One time";return{id:t.id,packageId:t.packageId,quantity:t.quantity,price:{excl_tax:{value:s,formatted:_t(s)},incl_tax:{value:s,formatted:_t(s)},original:{value:a,formatted:_t(a)},savings:{value:d,formatted:_t(d)},recurring:{value:f,formatted:_t(f)},lineTotal:{value:o,formatted:_t(o)},lineCompare:{value:l,formatted:_t(l)},lineSavings:{value:u,formatted:_t(u)},savingsPct:{value:h,formatted:St(h)}},product:{title:t.title||(null==r?void 0:r.name)||"",sku:(null==(e=null==r?void 0:r.external_id)?void 0:e.toString())||"",image:t.image||(null==r?void 0:r.image)||""},is_upsell:null!=(i=t.is_upsell)&&i,is_recurring:p,interval:(null==r?void 0:r.interval)||void 0,interval_count:null==r?void 0:r.interval_count,frequency:m,is_bundle:!1,bundleComponents:void 0,hasSavings:u>0,hasComparePrice:a>s,showCompare:a>s?"show":"hide",showSavings:u>0?"show":"hide",showRecurring:p?"show":"hide"}});t({enrichedItems:r})}catch(i){}}),applyCoupon:i=>g(null,null,function*(){const{useConfigStore:n}=yield Promise.resolve().then(()=>bt),r=n.getState(),s=e(),a=i.toUpperCase().trim();if((s.appliedCoupons||[]).some(t=>t.code===a))return{success:!1,message:"Coupon already applied"};const o=r.discounts[a];if(!o)return{success:!1,message:"Invalid coupon code"};const c=e().validateCoupon(a);return c.valid?(t(t=>h(u({},t),{appliedCoupons:[...t.appliedCoupons,{code:a,discount:0,definition:o}]})),e().calculateTotals(),{success:!0,message:`Coupon ${a} applied successfully`}):{success:!1,message:c.message||"Coupon cannot be applied"}}),removeCoupon:i=>{t(t=>h(u({},t),{appliedCoupons:(t.appliedCoupons||[]).filter(t=>t.code!==i)})),e().calculateTotals()},getCoupons:()=>e().appliedCoupons||[],validateCoupon:t=>{const i=e(),n=window.nextConfig;if(!(null==n?void 0:n.discounts))return{valid:!1,message:"No discounts configured"};const r=n.discounts[t];return r?r.minOrderValue&&i.subtotal<r.minOrderValue?{valid:!1,message:`Minimum order value of $${r.minOrderValue} required`}:!r.combinable&&(i.appliedCoupons||[]).length>0?{valid:!1,message:"Cannot combine with other coupons"}:{valid:!0}:{valid:!1,message:"Invalid coupon code"}},calculateDiscountAmount:t=>{const i=e();let n=0;if("order"===t.scope)"percentage"===t.type?(n=i.subtotal*(t.value/100),t.maxDiscount&&(n=Math.min(n,t.maxDiscount))):n=t.value;else if("package"===t.scope&&t.packageIds){const e=i.items.filter(e=>{var i;return null==(i=t.packageIds)?void 0:i.includes(e.packageId)}).reduce((t,e)=>t+e.price*e.quantity,0);"percentage"===t.type?(n=e*(t.value/100),t.maxDiscount&&(n=Math.min(n,t.maxDiscount))):n=Math.min(t.value,e)}return Math.min(n,i.subtotal)},refreshItemPrices:()=>g(null,null,function*(){try{Et.info("Refreshing cart item prices with new currency data...");const{useCampaignStore:i}=yield Promise.resolve().then(()=>ut),n=i.getState();if(!n.data)return void Et.warn("No campaign data available to refresh prices");const r=e(),s=r.items.map(t=>{var e,i,r,s,a,o;const c=n.getPackage(t.packageId);return c?h(u({},t),{price:parseFloat(c.price_total),price_per_unit:c.price,price_total:c.price_total,price_retail:c.price_retail,price_retail_total:c.price_retail_total,price_recurring:c.price_recurring,productId:null!=(e=t.productId)?e:c.product_id,productName:null!=(i=t.productName)?i:c.product_name,variantId:null!=(r=t.variantId)?r:c.product_variant_id,variantName:null!=(s=t.variantName)?s:c.product_variant_name,variantAttributes:null!=(a=t.variantAttributes)?a:c.product_variant_attribute_values,variantSku:null!=(o=t.variantSku)?o:c.product_sku}):(Et.warn(`Package ${t.packageId} not found in campaign data`),t)});let a=r.shippingMethod;if(a&&n.data.shipping_methods){const t=n.data.shipping_methods.find(t=>t.ref_id===a.id);if(t){const e=parseFloat(t.price||"0");a=h(u({},a),{price:e}),Et.info(`Updated shipping method price: ${a.code} = ${e} ${n.data.currency}`)}}t(t=>{const e=h(u({},t),{items:s});return void 0!==a&&(e.shippingMethod=a),e}),Et.info("Cart item prices and shipping refreshed with new currency"),setTimeout(()=>{e().calculateTotals()},0)}catch(i){Et.error("Failed to refresh item prices:",i)}}),reset:()=>{t($t)},setLastCurrency:e=>{t({lastCurrency:e})}})),{name:nt,storage:{getItem:t=>it.get(t),setItem:(t,e)=>{it.set(t,e)},removeItem:t=>{it.remove(t)}},onRehydrateStorage:()=>t=>{t&&(Et.debug("Cart store rehydrated, recalculating totals..."),t.calculateTotals())},partialize:t=>({items:t.items,appliedCoupons:t.appliedCoupons,subtotal:t.subtotal,shipping:t.shipping,shippingMethod:t.shippingMethod,tax:t.tax,total:t.total,totalQuantity:t.totalQuantity,isEmpty:t.isEmpty,totals:t.totals,enrichedItems:[]})})),It=Object.freeze(Object.defineProperty({__proto__:null,useCartStore:Tt},Symbol.toStringTag,{value:"Module"})),At={step:1,isProcessing:!1,errors:{},formData:{},paymentMethod:"credit-card",sameAsShipping:!0,testMode:!1,vouchers:[]},Mt=j(t=>h(u({},At),{setStep:e=>{t({step:e})},setProcessing:e=>{t({isProcessing:e})},setError:(e,i)=>{t(t=>({errors:h(u({},t.errors),{[e]:i})}))},clearError:e=>{t(t=>{const i=t.errors,{[e]:n}=i;var r;return{errors:p(i,[(r=e,"symbol"==typeof r?r:r+"")])}})},clearAllErrors:()=>{t({errors:{}})},updateFormData:e=>{t(t=>({formData:u(u({},t.formData),e)}))},setPaymentToken:e=>{t({paymentToken:e})},setPaymentMethod:e=>{t({paymentMethod:e})},setShippingMethod:e=>{t({shippingMethod:e})},setBillingAddress:e=>{t({billingAddress:e})},setSameAsShipping:e=>{t({sameAsShipping:e})},setTestMode:e=>{t({testMode:e})},addVoucher:e=>{t(t=>({vouchers:[...t.vouchers,e]}))},removeVoucher:e=>{t(t=>({vouchers:t.vouchers.filter(t=>t!==e)}))},reset:()=>{t(At)}})),Lt=Object.freeze(Object.defineProperty({__proto__:null,useCheckoutStore:Mt},Symbol.toStringTag,{value:"Module"})),Dt=tt("OrderStore"),Ft={order:null,refId:null,orderLoadedAt:null,isLoading:!1,isProcessingUpsell:!1,error:null,upsellError:null,pendingUpsells:[],completedUpsells:[],completedUpsellPages:[],viewedUpsells:[],viewedUpsellPages:[],upsellJourney:[]},Ot=j()(((t,e={})=>(i,n,r)=>{const s=e,{enabled:a,anonymousActionType:o,store:c}=s,l=p(s,["enabled","anonymousActionType","store"]);let d;try{d=(null!=a?a:"production"!==(R?"production":void 0))&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(x){}if(!d)return t(i,n,r);const f=((t,e,i)=>{if(void 0===t)return{type:"untracked",connection:e.connect(i)};const n=H.get(i.name);if(n)return u({type:"tracked",store:t},n);const r={connection:e.connect(i),stores:{}};return H.set(i.name,r),u({type:"tracked",store:t},r)})(c,d,l),{connection:m}=f,g=p(f,["connection"]);let v=!0;r.setState=(t,e,s)=>{const a=i(t,e);if(!v)return a;const d=void 0===s?{type:o||"anonymous"}:"string"==typeof s?{type:s}:s;return void 0===c?(null==m||m.send(d,n()),a):(null==m||m.send(h(u({},d),{type:`${c}/${d.type}`}),h(u({},V(l.name)),{[c]:r.getState()})),a)};const y=(...t)=>{const e=v;v=!1,i(...t),v=e},b=t(r.setState,n,r);if("untracked"===g.type?null==m||m.init(b):(g.stores[g.store]=r,null==m||m.init(Object.fromEntries(Object.entries(g.stores).map(([t,e])=>[t,t===g.store?b:e.getState()])))),r.dispatchFromDevtools&&"function"==typeof r.dispatch){let t=!1;const e=r.dispatch;r.dispatch=(...i)=>{"production"===(R?"production":void 0)||"__setState"!==i[0].type||t||(t=!0),e(...i)}}return m.subscribe(t=>{var e;switch(t.type){case"ACTION":if("string"!=typeof t.payload)return;return B(t.payload,t=>{if("__setState"===t.type){if(void 0===c)return void y(t.state);Object.keys(t.state).length;const e=t.state[c];if(null==e)return;return void(JSON.stringify(r.getState())!==JSON.stringify(e)&&y(e))}r.dispatchFromDevtools&&"function"==typeof r.dispatch&&r.dispatch(t)});case"DISPATCH":switch(t.payload.type){case"RESET":return y(b),void 0===c?null==m?void 0:m.init(r.getState()):null==m?void 0:m.init(V(l.name));case"COMMIT":return void 0===c?void(null==m||m.init(r.getState())):null==m?void 0:m.init(V(l.name));case"ROLLBACK":return B(t.state,t=>{if(void 0===c)return y(t),void(null==m||m.init(r.getState()));y(t[c]),null==m||m.init(V(l.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return B(t.state,t=>{void 0!==c?JSON.stringify(r.getState())!==JSON.stringify(t[c])&&y(t[c]):y(t)});case"IMPORT_STATE":{const{nextLiftedState:i}=t.payload,n=null==(e=i.computedStates.slice(-1)[0])?void 0:e.state;if(!n)return;return y(void 0===c?n:n[c]),void(null==m||m.send(null,i))}case"PAUSE_RECORDING":return v=!v}return}}),b})(Q((t,e)=>h(u({},Ft),{setOrder:e=>{Dt.debug("Setting order data:",e),t({order:e,error:null,orderLoadedAt:Date.now()})},setRefId:e=>{Dt.debug("Setting ref ID:",e),t({refId:e})},loadOrder:(i,n)=>g(null,null,function*(){const r=e();if(!r.order||r.refId!==i||e().isOrderExpired())if(r.isLoading)Dt.warn("Order loading already in progress");else{Dt.info("Loading order:",i),t({isLoading:!0,error:null,refId:i});try{const e=yield n.getOrder(i);Dt.info("Order loaded successfully:",e);const r=[];e.lines&&Array.isArray(e.lines)&&e.lines.forEach(t=>{if(t.is_upsell&&t.product_sku){const e=t.product_sku.match(/(\d+)/);e?r.push(e[1]):r.push(t.product_sku),Dt.debug("Detected upsell line:",{sku:t.product_sku,title:t.product_title,extractedId:e?e[1]:t.product_sku})}}),t({order:e,isLoading:!1,isProcessingUpsell:!1,error:null,orderLoadedAt:Date.now(),completedUpsells:r,upsellJourney:[],viewedUpsells:[],viewedUpsellPages:[]}),Dt.debug("Populated completed upsells from order:",r)}catch(s){const e=s instanceof Error?s.message:"Failed to load order";Dt.error("Failed to load order:",s),t({isLoading:!1,error:e,order:null})}}else Dt.info("Using cached order data:",i)}),clearOrder:()=>{Dt.debug("Clearing order data"),t({order:null,refId:null,error:null,orderLoadedAt:null})},isOrderExpired:()=>{const t=e();if(!t.orderLoadedAt)return!0;const i=Date.now()-t.orderLoadedAt>9e5;return i&&Dt.info("Order data has expired (>15 minutes old)"),i},addUpsell:(i,n)=>g(null,null,function*(){const r=e();if(!r.refId){const e="No order reference ID available";return Dt.error(e),t({upsellError:e}),null}if(r.isProcessingUpsell)return Dt.warn("Upsell processing already in progress"),null;Dt.info("Adding upsell to order:",r.refId,i),t({isProcessingUpsell:!0,upsellError:null});try{const e=yield n.addUpsell(r.refId,i);Dt.info("Upsell added successfully:",e);const s=window.location.pathname,a=i.lines.map(t=>t.package_id.toString()),o=a.map(t=>({packageId:t,pagePath:s,action:"accepted",timestamp:Date.now()}));return t({order:e,isProcessingUpsell:!1,upsellError:null,orderLoadedAt:Date.now(),completedUpsells:[...r.completedUpsells,...a],completedUpsellPages:r.completedUpsellPages.includes(s)?r.completedUpsellPages:[...r.completedUpsellPages,s],upsellJourney:[...r.upsellJourney,...o]}),e}catch(s){const e=s instanceof Error?s.message:"Failed to add upsell";return Dt.error("Failed to add upsell:",s),t({isProcessingUpsell:!1,upsellError:e}),null}}),addPendingUpsell:i=>{const n=e();Dt.debug("Adding pending upsell:",i),t({pendingUpsells:[...n.pendingUpsells,i]})},removePendingUpsell:i=>{const n=[...e().pendingUpsells];n.splice(i,1),Dt.debug("Removing pending upsell at index:",i),t({pendingUpsells:n})},clearPendingUpsells:()=>{Dt.debug("Clearing pending upsells"),t({pendingUpsells:[]})},markUpsellCompleted:i=>{const n=e();n.completedUpsells.includes(i)||(Dt.debug("Marking upsell as completed:",i),t({completedUpsells:[...n.completedUpsells,i]}))},markUpsellViewed:i=>{const n=e();if(!n.viewedUpsells.includes(i)){Dt.debug("Marking upsell as viewed:",i);const e={packageId:i,action:"viewed",timestamp:Date.now()};t({viewedUpsells:[...n.viewedUpsells,i],upsellJourney:[...n.upsellJourney,e]})}},markUpsellPageViewed:i=>{const n=e();if(!n.viewedUpsellPages.includes(i)){Dt.debug("Marking upsell page as viewed:",i);const e={pagePath:i,action:"viewed",timestamp:Date.now()};t({viewedUpsellPages:[...n.viewedUpsellPages,i],upsellJourney:[...n.upsellJourney,e],isProcessingUpsell:!1,upsellError:null})}},markUpsellSkipped:(i,n)=>{const r=e();Dt.debug("Marking upsell as skipped:",{packageId:i,pagePath:n});const s={action:"skipped",timestamp:Date.now()};void 0!==i&&(s.packageId=i),void 0!==n&&(s.pagePath=n),t({upsellJourney:[...r.upsellJourney,s],isProcessingUpsell:!1,upsellError:null})},setError:e=>t({error:e}),setUpsellError:e=>t({upsellError:e}),clearErrors:()=>t({error:null,upsellError:null}),setLoading:e=>t({isLoading:e}),setProcessingUpsell:e=>t({isProcessingUpsell:e}),hasUpsellPageBeenCompleted:t=>e().completedUpsellPages.includes(t),hasUpsellBeenViewed:t=>e().viewedUpsells.includes(t),hasUpsellPageBeenViewed:t=>e().viewedUpsellPages.includes(t),getUpsellJourney:()=>e().upsellJourney,getOrderTotal:()=>{const t=e();return t.order?parseFloat(t.order.total_incl_tax||"0"):0},canAddUpsells:()=>{const t=e();return!(!t.order||!t.order.supports_post_purchase_upsells||t.isProcessingUpsell)},reset:()=>{Dt.debug("Resetting order store"),t(Ft)}}),{name:"next-order",storage:{getItem:t=>{const e=sessionStorage.getItem(t);return e?JSON.parse(e):null},setItem:(t,e)=>{sessionStorage.setItem(t,JSON.stringify(e))},removeItem:t=>{sessionStorage.removeItem(t)}}}),{name:"order-store"})),Ut={affiliate:"",funnel:"",gclid:"",utm_source:"",utm_medium:"",utm_campaign:"",utm_content:"",utm_term:"",subaffiliate1:"",subaffiliate2:"",subaffiliate3:"",subaffiliate4:"",subaffiliate5:"",metadata:{landing_page:"",referrer:"",device:"",device_type:"desktop",domain:"",timestamp:Date.now()},first_visit_timestamp:Date.now(),current_visit_timestamp:Date.now()},Nt=j()(Q((t,e)=>h(u({},Ut),{initialize:()=>g(null,null,function*(){try{const{AttributionCollector:e}=yield Promise.resolve().then(()=>Pe),i=new e,n=yield i.collect();t(t=>h(u(u({},t),n),{metadata:u(u({},t.metadata),n.metadata),first_visit_timestamp:t.first_visit_timestamp||n.first_visit_timestamp}))}catch(e){}}),updateAttribution:e=>{t(t=>h(u(u({},t),e),{metadata:e.metadata?u(u({},t.metadata),e.metadata):t.metadata,current_visit_timestamp:Date.now()}))},setFunnelName:i=>{if(!i)return;if(e().funnel)return;const n=localStorage.getItem("next_funnel_name")||sessionStorage.getItem("next_funnel_name");if(n)t({funnel:n});else{t({funnel:i});try{sessionStorage.setItem("next_funnel_name",i),localStorage.setItem("next_funnel_name",i)}catch(r){}}},setEverflowClickId:e=>{e&&(localStorage.setItem("evclid",e),sessionStorage.setItem("evclid",e),t(t=>h(u({},t),{metadata:h(u({},t.metadata),{everflow_transaction_id:e})})))},getAttributionForApi:()=>{const t=e(),i={};return t.affiliate&&""!==t.affiliate&&(i.affiliate=t.affiliate),t.funnel&&""!==t.funnel&&(i.funnel=t.funnel),t.gclid&&""!==t.gclid&&(i.gclid=t.gclid),void 0!==t.metadata&&(i.metadata=t.metadata),t.utm_source&&""!==t.utm_source&&(i.utm_source=t.utm_source),t.utm_medium&&""!==t.utm_medium&&(i.utm_medium=t.utm_medium),t.utm_campaign&&""!==t.utm_campaign&&(i.utm_campaign=t.utm_campaign),t.utm_content&&""!==t.utm_content&&(i.utm_content=t.utm_content),t.utm_term&&""!==t.utm_term&&(i.utm_term=t.utm_term),t.subaffiliate1&&""!==t.subaffiliate1&&(i.subaffiliate1=t.subaffiliate1),t.subaffiliate2&&""!==t.subaffiliate2&&(i.subaffiliate2=t.subaffiliate2),t.subaffiliate3&&""!==t.subaffiliate3&&(i.subaffiliate3=t.subaffiliate3),t.subaffiliate4&&""!==t.subaffiliate4&&(i.subaffiliate4=t.subaffiliate4),t.subaffiliate5&&""!==t.subaffiliate5&&(i.subaffiliate5=t.subaffiliate5),t.metadata.everflow_transaction_id&&(i.everflow_transaction_id=t.metadata.everflow_transaction_id),i},debug:()=>{const t=e();for(let e=1;e<=5;e++);return t.metadata.conversion_timestamp,"Attribution debug info logged to console."},reset:()=>{t(Ut)},clearPersistedFunnel:()=>{try{localStorage.removeItem("next_funnel_name"),sessionStorage.removeItem("next_funnel_name"),t({funnel:""})}catch(e){}}}),{name:"next-attribution",storage:{getItem:t=>{const e=sessionStorage.getItem(t);return e?JSON.parse(e):null},setItem:(t,e)=>{sessionStorage.setItem(t,JSON.stringify(e))},removeItem:t=>{sessionStorage.removeItem(t)}}})),zt=tt("ParameterStore"),qt=j()(Q((t,e)=>({params:{},updateParam:(e,i)=>{t(t=>({params:h(u({},t.params),{[e]:i})})),zt.debug(`Parameter updated: ${e} = ${i}`)},updateParams:e=>{t({params:e}),zt.debug("Parameters replaced:",e)},mergeParams:e=>{t(t=>({params:u(u({},t.params),e)})),zt.debug("Parameters merged:",e)},getParam:t=>e().params[t],hasParam:t=>t in e().params,clearParams:()=>{t({params:{}}),zt.info("All parameters cleared")},removeParam:e=>{t(t=>{const i=u({},t.params);return delete i[e],{params:i}}),zt.debug(`Parameter removed: ${e}`)},debug:()=>{const t=e();if(Object.keys(t.params).length>0){const e={};Object.entries(t.params).forEach(([t,i])=>{const n=t.includes("_")?t.split("_")[0]:"other";e[n]||(e[n]=[]),e[n].push(`${t}=${i}`)}),Object.entries(e).forEach(([t,e])=>{})}const i=new URLSearchParams(window.location.search),n={};if(i.forEach((t,e)=>{n[e]=t}),Object.keys(n).length>0){const e=new Set(Object.keys(t.params)),i=new Set(Object.keys(n)),r=Array.from(e).filter(t=>!i.has(t)),s=Array.from(i).filter(t=>!e.has(t)),a=Array.from(e).filter(e=>i.has(e)&&t.params[e]!==n[e]);(r.length>0||s.length>0||a.length>0)&&(r.length,s.length,a.length)}return"Parameter debug info logged to console."}}),{name:"next-url-params",storage:{getItem:t=>{try{const e=sessionStorage.getItem(t);return e?JSON.parse(e):null}catch(e){return zt.error("Error reading from sessionStorage:",e),null}},setItem:(t,e)=>{try{sessionStorage.setItem(t,JSON.stringify(e))}catch(i){zt.error("Error writing to sessionStorage:",i)}},removeItem:t=>{try{sessionStorage.removeItem(t)}catch(e){zt.error("Error removing from sessionStorage:",e)}}}})),jt=Object.freeze(Object.defineProperty({__proto__:null,useParameterStore:qt},Symbol.toStringTag,{value:"Module"}));let Rt=null,Ht=null,Vt=[];const Bt=tt("AmplitudeAnalytics"),Jt={autocapture:{attribution:!0,fileDownloads:!1,formInteractions:!1,pageViews:!1,sessions:!0,elementInteractions:!1,networkTracking:!1,webVitals:!0,frustrationInteractions:!1},defaultTracking:{sessions:!0,pageViews:!1,formInteractions:!1,fileDownloads:!1},minIdLength:5,trackingOptions:{ipAddress:!1,carrier:!1}};function Gt(t){if(!t)return"unknown";try{let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e&=e;return Math.abs(e).toString(16).substring(0,16)}catch(e){return"hash_error"}}function Kt(){const t=window.innerWidth;return t<768?"mobile":t<1024?"tablet":"desktop"}function Qt(){const t=navigator.userAgent.toLowerCase();return t.includes("chrome")?"chrome":t.includes("firefox")?"firefox":t.includes("safari")?"safari":t.includes("edge")?"edge":"unknown"}function Zt(){const t=navigator.platform.toLowerCase();return t.includes("win")?"windows":t.includes("mac")?"macos":t.includes("linux")?"linux":/android|webos|iphone|ipad|ipod/i.test(navigator.userAgent)?/android/i.test(navigator.userAgent)?"android":"ios":"unknown"}function Wt(){const t=window.location.pathname.toLowerCase();return new URLSearchParams(window.location.search).has("ref_id")?"upsell":t.includes("checkout")?"checkout":t.includes("cart")?"cart":t.includes("product")?"product":t.includes("thank")||t.includes("confirm")?"thankyou":"/"===t||t.includes("home")?"landing":"unknown"}function Yt(){var t,e,i,n,r;const s=yt.getState(),a=dt.getState(),o=Nt.getState(),c=new URLSearchParams(window.location.search);window.__amplitude_session_id||(window.__amplitude_session_id=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`);const l=function(){const t={};return document.querySelectorAll('meta[name^="next-"]').forEach(e=>{const i=e.getAttribute("name"),n=e.getAttribute("content");if(i&&n){const e=i.replace("next-","").replace(/-/g,"_");t[e]=n}}),t}();return h(u({domain:window.location.hostname,page_url:window.location.href,page_path:window.location.pathname,sdk_version:window.__NEXT_SDK_VERSION__||"unknown",api_key:s.apiKey||"unknown",api_key_hash:Gt(s.apiKey),session_id:window.__amplitude_session_id,timestamp:Date.now(),debug_mode:s.debug,currency_behavior:s.currencyBehavior||"auto",analytics_enabled:(null==(t=s.analytics)?void 0:t.enabled)||!1,tracking_mode:s.tracking||"auto",default_country:(null==(e=s.addressConfig)?void 0:e.defaultCountry)||"US",campaign_id:(null==(i=a.data)?void 0:i.id)||null,campaign_name:(null==(n=a.data)?void 0:n.name)||null,campaign_currency:(null==(r=a.data)?void 0:r.currency)||null,from_cache:a.isFromCache||!1},Object.keys(l).reduce((t,e)=>(t[`meta_${e}`]=l[e],t),{})),{page_type_detected:Wt(),funnel_attribution:o.funnel||null,ref_id:c.get("ref_id")||null,has_utm:!!(o.utm_source||o.utm_medium||o.utm_campaign),utm_source:o.utm_source||null,utm_medium:o.utm_medium||null,utm_campaign:o.utm_campaign||null,user_agent:navigator.userAgent,screen_width:window.screen.width,screen_height:window.screen.height})}function Xt(){return g(this,null,function*(){if(!Rt)return Ht||(Ht=g(null,null,function*(){try{Bt.debug("Initializing Amplitude analytics..."),yield new Promise(t=>setTimeout(t,100));const i=yield Promise.resolve().then(()=>Oc);try{i.init("4686fc7f03573edc48645829fe0f99fd",void 0,Jt),Rt=i}catch(t){return void Bt.warn("Amplitude init failed, continuing without analytics:",t)}const n=yt.getState();if(n.apiKey){const t=new i.Identify;t.set("api_key_hash",Gt(n.apiKey)),t.set("domain",window.location.hostname),t.set("sdk_version",window.__NEXT_SDK_VERSION__||"unknown"),i.identify(t)}if(Vt.length>0){Bt.debug(`Flushing ${Vt.length} queued events`);for(const t of Vt)try{i.track(t.name,u(u({},Yt()),t.properties))}catch(e){Bt.debug("Failed to track queued event:",e)}Vt=[]}Bt.debug("Amplitude initialized successfully")}catch(i){Bt.warn("Failed to initialize Amplitude:",i),Ht=null}}),Ht)})}function te(t){return g(this,arguments,function*(t,e={}){try{Bt.debug(`Track event: ${t}`,e);const n=Date.now()-(window.__sdk_page_load_time||Date.now());if(n<2e3)return Vt.push({name:t,properties:e}),void setTimeout(()=>Xt(),2e3-n);if(!Rt&&!Ht)return Vt.push({name:t,properties:e}),void(yield Xt());if(Ht&&!Rt)return void Vt.push({name:t,properties:e});if(Rt)try{Rt.track(t,u(u({},Yt()),e))}catch(i){Bt.debug("Amplitude track failed:",i)}}catch(n){Bt.debug("Failed to track event:",n)}})}function ee(t){return g(this,null,function*(){yield te("api_call",{endpoint:t.endpoint,method:t.method,status_code:t.statusCode,response_time_ms:t.responseTime,request_type:t.requestType,success:t.success,error_message:t.errorMessage||null,error_type:t.errorType||null,retry_after:t.retryAfter||null})})}function ie(t){return g(this,null,function*(){yield te("checkout_started",{cart_value:t.cartValue,items_count:t.itemsCount,detected_country:t.detectedCountry,payment_method:t.paymentMethod,products:t.cartItems||[]})})}function ne(t){return g(this,null,function*(){yield te("checkout_failed",{error_message:t.errorMessage,error_type:t.errorType,payment_response_code:t.paymentResponseCode||null,cart_value:t.cartValue,items_count:t.itemsCount,country:t.country,payment_method:t.paymentMethod,time_on_page_ms:t.timeOnPage})})}"undefined"!=typeof window&&(window.__sdk_page_load_time=Date.now());class re{constructor(t){this.baseURL="https://campaigns.apps.29next.com",this.apiKey=t,this.logger=tt("ApiClient")}getCampaigns(t){return g(this,null,function*(){const e=t?`?currency=${t}`:"";return this.request(`/api/v1/campaigns/${e}`)})}createCart(t){return g(this,null,function*(){return this.request("/api/v1/carts/",{method:"POST",body:JSON.stringify(t)})})}createOrder(t){return g(this,null,function*(){return this.request("/api/v1/orders/",{method:"POST",body:JSON.stringify(t)})})}getOrder(t){return g(this,null,function*(){return this.request(`/api/v1/orders/${t}/`)})}addUpsell(t,e){return g(this,null,function*(){return this.request(`/api/v1/orders/${t}/upsells/`,{method:"POST",body:JSON.stringify(e)})})}createProspectCart(t){return g(this,null,function*(){return this.request("/api/v1/prospect-carts/",{method:"POST",body:JSON.stringify(t)})})}updateProspectCart(t,e){return g(this,null,function*(){return this.request(`/api/v1/prospect-carts/${t}/`,{method:"PATCH",body:JSON.stringify(e)})})}getProspectCart(t){return g(this,null,function*(){return this.request(`/api/v1/prospect-carts/${t}/`)})}abandonProspectCart(t){return g(this,null,function*(){return this.request(`/api/v1/prospect-carts/${t}/abandon/`,{method:"POST"})})}convertProspectCart(t){return g(this,null,function*(){return this.request(`/api/v1/prospect-carts/${t}/convert/`,{method:"POST"})})}getRequestType(t){return t.includes("/campaigns")?"campaign":t.includes("/upsells")?"upsell":t.includes("/orders")?"order":t.includes("/prospect-carts")?"prospect_cart":t.includes("/carts")?"cart":"campaign"}getErrorType(t){return 0===t?"network":429===t?"rate_limit":401===t||403===t?"auth":t>=500?"server_error":t>=400?"client_error":"network"}request(t,e){return g(this,null,function*(){const i=(null==e?void 0:e.method)||"GET",n=`${this.baseURL}${t}`,r=u({Authorization:this.apiKey,"Content-Type":"application/json"},null==e?void 0:e.headers);this.logger.debug(`API Request: ${i} ${n}`);const s=performance.now();let a,o,c,l=0;try{const p=yield fetch(n,h(u({},e),{headers:r})),f=performance.now()-s;if(l=p.status,429===p.status)throw c=parseInt(p.headers.get("Retry-After")||"60"),a=`Rate limited. Retry after ${c} seconds`,o="rate_limit",this.logger.warn(a),queueMicrotask(()=>{const e={endpoint:t,method:i,statusCode:l,responseTime:f,requestType:this.getRequestType(t),success:!1};a&&(e.errorMessage=a),o&&(e.errorType=o),c&&(e.retryAfter=c),ee(e)}),new Error(a);if(!p.ok){a=`API Error: ${p.status} ${p.statusText}`,o=this.getErrorType(p.status);let e={};try{const t=yield p.text();t&&(e=JSON.parse(t))}catch(d){this.logger.warn("Failed to parse error response body")}this.logger.error(a,e),queueMicrotask(()=>{const e={endpoint:t,method:i,statusCode:l,responseTime:f,requestType:this.getRequestType(t),success:!1};a&&(e.errorMessage=a),o&&(e.errorType=o),ee(e)});const n=new Error(a);throw n.status=p.status,n.statusText=p.statusText,n.responseData=e,n}const m=yield p.json();return this.logger.debug(`API Response: ${p.status}`,m),queueMicrotask(()=>{ee({endpoint:t,method:i,statusCode:l,responseTime:f,requestType:this.getRequestType(t),success:!0})}),m}catch(p){if(0===l){const e=performance.now()-s;queueMicrotask(()=>{ee({endpoint:t,method:i,statusCode:0,responseTime:e,requestType:this.getRequestType(t),success:!1,errorMessage:p instanceof Error?p.message:String(p),errorType:"network"})})}throw p instanceof Error?this.logger.error("API request failed:",p.message):this.logger.error("API request failed:",String(p)),p}})}setApiKey(t){this.apiKey=t}getApiKey(){return this.apiKey}}const se=Object.freeze(Object.defineProperty({__proto__:null,ApiClient:re},Symbol.toStringTag,{value:"Module"}));class ae{constructor(){this.callbacks=new Map,this.exitIntentEnhancer=null,this.fomoEnhancer=null,this.logger=new Y("NextCommerce"),this.eventBus=st.getInstance()}static getInstance(){return ae.instance||(ae.instance=new ae),ae.instance}hasItemInCart(t){const e=Tt.getState();return!!t.packageId&&e.items.some(e=>e.packageId===t.packageId)}addItem(t){return g(this,null,function*(){var e;const i=Tt.getState(),n=null!=(e=t.quantity)?e:1;t.packageId&&(yield i.addItem({packageId:t.packageId,quantity:n,isUpsell:!1}))})}removeItem(t){return g(this,null,function*(){const e=Tt.getState();t.packageId&&(yield e.removeItem(t.packageId))})}updateQuantity(t){return g(this,null,function*(){const e=Tt.getState();t.packageId&&(yield e.updateQuantity(t.packageId,t.quantity))})}clearCart(){return g(this,null,function*(){const t=Tt.getState();yield t.clear()})}swapCart(t){return g(this,null,function*(){const e=Tt.getState();if("function"==typeof e.swapCart)yield e.swapCart(t);else{yield e.clear();for(const i of t)yield e.addItem({packageId:i.packageId,quantity:i.quantity,isUpsell:!1})}this.logger.debug(`Cart swapped with ${t.length} items`)})}getCartData(){const t=Tt.getState(),e=dt.getState();return{cartLines:t.enrichedItems,cartTotals:t.totals,campaignData:e.data,appliedCoupons:t.getCoupons()}}getCartTotals(){return Tt.getState().totals}getCartCount(){return Tt.getState().totalQuantity}getCampaignData(){return dt.getState().data}getPackage(t){return dt.getState().getPackage(t)}getVariantsByProductId(t){return dt.getState().getVariantsByProductId(t)}getAvailableVariantAttributes(t,e){return dt.getState().getAvailableVariantAttributes(t,e)}getPackageByVariantSelection(t,e){return dt.getState().getPackageByVariantSelection(t,e)}getProductVariantsWithPricing(t){return dt.getState().getProductVariantsWithPricing(t)}getVariantPricingTiers(t,e){return dt.getState().getVariantPricingTiers(t,e)}getLowestPriceForVariant(t,e){return dt.getState().getLowestPriceForVariant(t,e)}createVariantKey(t){return Object.entries(t).map(([t,e])=>`${t}:${e}`).sort().join("|")}on(t,e){this.eventBus.on(t,e)}off(t,e){this.eventBus.off(t,e)}registerCallback(t,e){this.callbacks.has(t)||this.callbacks.set(t,new Set),this.callbacks.get(t).add(e)}unregisterCallback(t,e){var i;null==(i=this.callbacks.get(t))||i.delete(e)}triggerCallback(t,e){var i;null==(i=this.callbacks.get(t))||i.forEach(i=>{try{i(e)}catch(n){this.logger.error(`Callback error for ${t}:`,n)}})}trackViewItemList(t,e,i){return g(this,null,function*(){queueMicrotask(()=>g(this,null,function*(){try{const{nextAnalytics:e}=yield Promise.resolve().then(()=>Tl);e.trackViewItemList(t,i)}catch(e){this.logger.debug("Analytics tracking failed (non-critical):",e)}}))})}trackViewItem(t){return g(this,null,function*(){queueMicrotask(()=>g(this,null,function*(){try{const{nextAnalytics:e}=yield Promise.resolve().then(()=>Tl);e.trackViewItem(t)}catch(e){this.logger.debug("Analytics tracking failed (non-critical):",e)}}))})}trackAddToCart(t,e){return g(this,null,function*(){queueMicrotask(()=>g(this,null,function*(){try{const{nextAnalytics:i}=yield Promise.resolve().then(()=>Tl),n={id:String(t),packageId:t,quantity:e||1};i.trackAddToCart(n)}catch(i){this.logger.debug("Analytics tracking failed (non-critical):",i)}}))})}trackRemoveFromCart(t,e){return g(this,null,function*(){queueMicrotask(()=>g(this,null,function*(){try{const{nextAnalytics:i,EcommerceEvents:n}=yield Promise.resolve().then(()=>Tl);i.track(n.createRemoveFromCartEvent({packageId:t,quantity:e||1}))}catch(i){this.logger.debug("Analytics tracking failed (non-critical):",i)}}))})}trackBeginCheckout(){return g(this,null,function*(){queueMicrotask(()=>g(this,null,function*(){try{const{nextAnalytics:t}=yield Promise.resolve().then(()=>Tl);t.trackBeginCheckout()}catch(t){this.logger.debug("Analytics tracking failed (non-critical):",t)}}))})}trackPurchase(t){return g(this,null,function*(){queueMicrotask(()=>g(this,null,function*(){try{const{nextAnalytics:e}=yield Promise.resolve().then(()=>Tl);e.trackPurchase(t)}catch(e){this.logger.debug("Analytics tracking failed (non-critical):",e)}}))})}trackCustomEvent(t,e){return g(this,null,function*(){queueMicrotask(()=>g(this,null,function*(){try{const{nextAnalytics:i}=yield Promise.resolve().then(()=>Tl);i.track(u({event:t},e))}catch(i){this.logger.debug("Analytics tracking failed (non-critical):",i)}}))})}trackSignUp(t){return g(this,null,function*(){queueMicrotask(()=>g(this,null,function*(){try{const{nextAnalytics:e}=yield Promise.resolve().then(()=>Tl);e.trackSignUp(t)}catch(e){this.logger.debug("Analytics tracking failed (non-critical):",e)}}))})}trackLogin(t){return g(this,null,function*(){queueMicrotask(()=>g(this,null,function*(){try{const{nextAnalytics:e}=yield Promise.resolve().then(()=>Tl);e.trackLogin(t)}catch(e){this.logger.debug("Analytics tracking failed (non-critical):",e)}}))})}setDebugMode(t){return g(this,null,function*(){queueMicrotask(()=>g(this,null,function*(){try{const{nextAnalytics:e}=yield Promise.resolve().then(()=>Tl);e.setDebugMode(t)}catch(e){this.logger.debug("Analytics debug mode failed (non-critical):",e)}}))})}invalidateAnalyticsContext(){return g(this,null,function*(){queueMicrotask(()=>g(this,null,function*(){try{const{nextAnalytics:t}=yield Promise.resolve().then(()=>Tl);t.invalidateContext()}catch(t){this.logger.debug("Analytics context invalidation failed (non-critical):",t)}}))})}addMetadata(t,e){try{const i=Nt.getState(),n=i.metadata||{};i.updateAttribution({metadata:h(u({},n),{[t]:e})}),this.logger.debug(`Attribution metadata added: ${t}`,e)}catch(i){this.logger.error("Failed to add attribution metadata:",i)}}setMetadata(t){try{const e=Nt.getState(),i=e.metadata||{};e.updateAttribution({metadata:u(u({},i),t)}),this.logger.debug("Attribution metadata set:",t)}catch(e){this.logger.error("Failed to set attribution metadata:",e)}}clearMetadata(){var t,e,i,n,r,s;try{const a=Nt.getState();a.updateAttribution({metadata:{landing_page:(null==(t=a.metadata)?void 0:t.landing_page)||"",referrer:(null==(e=a.metadata)?void 0:e.referrer)||"",device:(null==(i=a.metadata)?void 0:i.device)||"",device_type:(null==(n=a.metadata)?void 0:n.device_type)||"desktop",domain:(null==(r=a.metadata)?void 0:r.domain)||"",timestamp:(null==(s=a.metadata)?void 0:s.timestamp)||Date.now()}}),this.logger.debug("Attribution metadata cleared")}catch(a){this.logger.error("Failed to clear attribution metadata:",a)}}getMetadata(){try{return Nt.getState().metadata}catch(t){return void this.logger.error("Failed to get attribution metadata:",t)}}setAttribution(t){try{Nt.getState().updateAttribution(t),this.logger.debug("Attribution set:",t)}catch(e){this.logger.error("Failed to set attribution:",e)}}getAttribution(){try{return Nt.getState().getAttributionForApi()}catch(t){return void this.logger.error("Failed to get attribution:",t)}}debugAttribution(){try{Nt.getState().debug()}catch(t){this.logger.error("Failed to debug attribution:",t)}}getShippingMethods(){var t;return(null==(t=dt.getState().data)?void 0:t.shipping_methods)||[]}getSelectedShippingMethod(){return Mt.getState().shippingMethod||null}setShippingMethod(t){return g(this,null,function*(){const e=Tt.getState();yield e.setShippingMethod(t)})}getVersion(){return"undefined"!=typeof window&&window.__NEXT_SDK_VERSION__?window.__NEXT_SDK_VERSION__:"__VERSION__"}formatPrice(t,e){var i,n;const{formatCurrency:r}=require("@/utils/currencyFormatter"),s=dt.getState();return r(t,null!=(n=null!=e?e:null==(i=s.data)?void 0:i.currency)?n:"USD")}validateCheckout(){const t=[];return 0===Tt.getState().items.length&&t.push("Cart is empty"),{valid:0===t.length,errors:t}}applyCoupon(t){return g(this,null,function*(){const e=Tt.getState();return yield e.applyCoupon(t)})}removeCoupon(t){Tt.getState().removeCoupon(t)}getCoupons(){return Tt.getState().getCoupons()}validateCoupon(t){return Tt.getState().validateCoupon(t)}calculateDiscountAmount(t){return Tt.getState().calculateDiscountAmount(t)}exitIntent(t){return g(this,null,function*(){try{if(!this.exitIntentEnhancer){const{ExitIntentEnhancer:t}=yield Promise.resolve().then(()=>Il);this.exitIntentEnhancer=new t,yield this.exitIntentEnhancer.initialize()}this.exitIntentEnhancer.setup(t),this.logger.debug("Exit intent configured with image:",t.image)}catch(e){throw this.logger.error("Failed to setup exit intent:",e),e}})}disableExitIntent(){this.exitIntentEnhancer&&this.exitIntentEnhancer.disable()}fomo(t){return g(this,null,function*(){try{if(!this.fomoEnhancer){const{FomoPopupEnhancer:t}=yield Promise.resolve().then(()=>Al);this.fomoEnhancer=new t,yield this.fomoEnhancer.initialize()}this.fomoEnhancer.setup(t),this.fomoEnhancer.start(),this.logger.debug("FOMO popup started")}catch(e){throw this.logger.error("Failed to start FOMO popup:",e),e}})}stopFomo(){this.fomoEnhancer&&this.fomoEnhancer.stop()}addUpsell(t){return g(this,null,function*(){var e,i,n;const r=Ot.getState(),s=yt.getState();if(!r.order)throw new Error("No order found. Upsells can only be added after order completion.");if(!r.canAddUpsells())throw new Error("Order does not support post-purchase upsells or is currently processing.");const a=new re(s.apiKey);let o=[];if(t.items&&t.items.length>0)o=t.items.map(t=>({package_id:t.packageId,quantity:t.quantity||1}));else{if(!t.packageId)throw new Error("Either packageId or items array must be provided");o=[{package_id:t.packageId,quantity:t.quantity||1}]}const c={lines:o};this.logger.info("Adding upsell(s) via SDK:",c);try{const t=(null==(i=null==(e=r.order)?void 0:e.lines)?void 0:i.map(t=>t.id))||[],s=yield r.addUpsell(c,a);if(!s)throw new Error("Failed to add upsell - no updated order returned");const l=(null==(n=s.lines)?void 0:n.filter(e=>e.is_upsell&&!t.includes(e.id)))||[],d=l.reduce((t,e)=>t+(e.price_incl_tax?parseFloat(e.price_incl_tax):0),0);return o.forEach((t,e)=>{const i=l[e],n=(null==i?void 0:i.price_incl_tax)?parseFloat(i.price_incl_tax):0;this.eventBus.emit("upsell:added",{packageId:t.package_id,quantity:t.quantity,order:s,value:n})}),{order:s,addedLines:l,totalValue:d}}catch(l){throw this.logger.error("Failed to add upsell(s) via SDK:",l),l}})}canAddUpsells(){return Ot.getState().canAddUpsells()}getCompletedUpsells(){return Ot.getState().completedUpsells}isUpsellAlreadyAdded(t){const e=Ot.getState();return!!e.completedUpsells.includes(t.toString())||e.upsellJourney.some(e=>e.packageId===t.toString()&&"accepted"===e.action)}setProfile(t,e){return g(this,null,function*(){try{const{ProfileManager:i}=yield Promise.resolve().then(()=>ve),n=i.getInstance();yield n.applyProfile(t,e),this.logger.info(`Profile "${t}" applied via API`)}catch(i){throw this.logger.error(`Failed to set profile "${t}":`,i),i}})}revertProfile(){return g(this,null,function*(){try{const{ProfileManager:t}=yield Promise.resolve().then(()=>ve),e=t.getInstance();yield e.revertProfile(),this.logger.info("Profile reverted via API")}catch(t){throw this.logger.error("Failed to revert profile:",t),t}})}getActiveProfile(){return mt.getState().activeProfileId}getProfileInfo(t){const e=mt.getState();return t?e.getProfileById(t):e.getActiveProfile()}getMappedPackageId(t){return mt.getState().getMappedPackageId(t)}getOriginalPackageId(t){return mt.getState().getOriginalPackageId(t)}listProfiles(){const t=mt.getState();return Array.from(t.profiles.keys())}hasProfile(t){return mt.getState().hasProfile(t)}registerProfile(t){mt.getState().registerProfile(t),this.logger.info(`Profile "${t.id}" registered via API`)}setParam(t,e){qt.getState().updateParam(t,e),this.logger.debug(`URL parameter set: ${t}=${e}`)}setParams(t){qt.getState().updateParams(t),this.logger.debug("URL parameters set:",t)}getParam(t){const e=qt.getState().getParam(t);return void 0!==e?e:null}getAllParams(){return qt.getState().params}hasParam(t){return qt.getState().hasParam(t)}clearParam(t){const e=qt.getState(),i=u({},e.params);delete i[t],e.updateParams(i),this.logger.debug(`URL parameter cleared: ${t}`)}clearAllParams(){qt.getState().updateParams({}),this.logger.debug("All URL parameters cleared")}mergeParams(t){qt.getState().mergeParams(t),this.logger.debug("URL parameters merged:",t)}}const oe=class{static parseDataAttribute(t,e){const i=t.getAttribute(e);return{raw:i,parsed:this.parseValue(i),type:this.inferType(i)}}static parseValue(t){if(null===t||""===t)return null;if(t.startsWith("{")||t.startsWith("["))try{return JSON.parse(t)}catch(e){}if("true"===t)return!0;if("false"===t)return!1;if(/^-?\d+(\.\d+)?$/.test(t)){const e=parseFloat(t);return Number.isNaN(e)?t:e}return t}static inferType(t){return null===t||""===t?"string":"true"===t||"false"===t?"boolean":/^-?\d+(\.\d+)?$/.test(t)?"number":t.startsWith("{")&&t.endsWith("}")?"object":t.startsWith("[")&&t.endsWith("]")?"array":"string"}static getEnhancerTypes(t){const e=[];if(t.hasAttribute("data-next-display")&&e.push("display"),t.hasAttribute("data-next-toggle")&&e.push("toggle"),t.hasAttribute("data-next-action")&&e.push("action"),t.hasAttribute("data-next-timer")&&e.push("timer"),(t.hasAttribute("data-next-show")||t.hasAttribute("data-next-hide")||t.hasAttribute("data-next-show-if-profile")||t.hasAttribute("data-next-hide-if-profile"))&&e.push("conditional"),t instanceof HTMLFormElement&&t.hasAttribute("data-next-checkout")&&e.push("checkout"),t.hasAttribute("data-next-express-checkout")){const i=t.getAttribute("data-next-express-checkout");"container"===i?e.push("express-checkout-container"):"paypal"!==i&&"apple_pay"!==i&&"google_pay"!==i||e.push("express-checkout")}if(t.hasAttribute("data-next-cart-items")&&e.push("cart-items"),t.hasAttribute("data-next-profile")&&e.push("profile-switcher"),t.hasAttribute("data-next-profile-selector")&&e.push("profile-selector"),t.hasAttribute("data-next-order-items")&&e.push("order-items"),t.hasAttribute("data-next-quantity")){const i=t.getAttribute("data-next-quantity");i&&["increase","decrease","set"].includes(i)&&e.push("quantity")}if(t.hasAttribute("data-next-remove-item")&&e.push("remove-item"),(t.hasAttribute("data-next-selector")||t.hasAttribute("data-next-cart-selector")||t.hasAttribute("data-next-selector-id")&&!t.hasAttribute("data-next-action")&&!t.hasAttribute("data-next-upsell")&&!t.hasAttribute("data-next-upsell-selector"))&&e.push("selector"),t.hasAttribute("data-next-upsell")&&e.push("upsell"),t.hasAttribute("data-next-coupon")){const i=t.getAttribute("data-next-coupon");"input"!==i&&""!==i||e.push("coupon")}return t.hasAttribute("data-next-accordion")&&e.push("accordion"),t.hasAttribute("data-next-tooltip")&&e.push("tooltip"),t.hasAttribute("data-next-component")&&"scroll-hint"===t.getAttribute("data-next-component")&&e.push("scroll-hint"),t.hasAttribute("data-next-quantity-text")&&e.push("quantity-text"),[...new Set(e)]}static parseDisplayPath(t){var e,i;const n=t.split(".");return 1===n.length?{object:"cart",property:null!=(e=n[0])?e:""}:{object:null!=(i=n[0])?i:"cart",property:n.slice(1).join(".")}}static parseCondition(t){var e,i;try{if(this.logger.debug("Parsing condition:",t),t.includes("(")&&t.includes(")")){const n=t.match(/^(\w+)\.(\w+)\(([^)]*)\)$/);if(n)return{type:"function",object:null!=(e=n[1])?e:"",method:null!=(i=n[2])?i:"",args:n[3]?n[3].split(",").map(t=>this.parseValue(t.trim())):[]}}if(t.includes(" ")||t.includes("==")||t.includes("!=")){const e=[">=","<=",">","<","===","==","!==","!="];for(const i of e)if(t.includes(i)){const e=t.split(i);if(2===e.length){const n=e[0].trim(),r=e[1].trim(),s=this.parseDisplayPath(null!=n?n:"");let a;const o=r.trim(),c=o.startsWith('"')&&o.endsWith('"')||o.startsWith("'")&&o.endsWith("'");c?a=o.slice(1,-1):(a=this.parseValue(null!=r?r:""),"param"!==s.object&&"params"!==s.object||"string"!=typeof a||"true"===r||"false"===r||/^-?\d+(\.\d+)?$/.test(r)||(a=r));const l={type:"comparison",left:s,operator:i,right:a};return this.logger.debug("Parsed comparison:",{original:t,leftPart:n,rightPart:r,hasQuotes:c,result:l,leftObject:s.object,rightValue:a,rightType:typeof a}),l}}}return u({type:"property"},this.parseDisplayPath(t))}catch(n){return this.logger.error("Failed to parse condition:",t,n),{type:"property",object:"cart",property:"isEmpty"}}}};oe.logger=tt("AttributeParser");let ce=oe;class le{constructor(t={}){this.handlers=new Set,this.isObserving=!1,this.pendingChanges=new Set,this.logger=tt("DOMObserver"),this.config=u({childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-next-display","data-next-toggle","data-next-timer","data-next-show","data-next-hide","data-next-checkout","data-next-validate","data-next-express-checkout"]},t),this.observer=new MutationObserver(this.handleMutations.bind(this))}addHandler(t){this.handlers.add(t),this.logger.debug(`Added handler, total: ${this.handlers.size}`)}removeHandler(t){this.handlers.delete(t),this.logger.debug(`Removed handler, total: ${this.handlers.size}`)}start(t=document.body){if(this.isObserving)this.logger.warn("Already observing, ignoring start request");else try{this.observer.observe(t,this.config),this.isObserving=!0,this.logger.debug("Started observing DOM changes",{target:t.tagName})}catch(e){this.logger.error("Failed to start DOM observation:",e)}}stop(){this.isObserving&&(this.observer.disconnect(),this.isObserving=!1,this.clearThrottle(),this.pendingChanges.clear(),this.logger.debug("Stopped observing DOM changes"))}pause(){this.isObserving&&(this.observer.disconnect(),this.isObserving=!1,this.logger.debug("Paused DOM observation"))}resume(t=document.body){this.isObserving||(this.start(t),this.logger.debug("Resumed DOM observation"))}isActive(){return this.isObserving}handleMutations(t){const e=t.filter(t=>this.isRelevantMutation(t));if(0!==e.length){this.logger.debug(`Processing ${e.length} relevant mutations`);for(const t of e)this.processMutation(t);this.throttleNotifications()}}isRelevantMutation(t){var e;switch(t.type){case"childList":return this.hasRelevantNodes(t.addedNodes)||this.hasRelevantNodes(t.removedNodes);case"attributes":const i=t.attributeName;return null!==i&&!0===(null==(e=this.config.attributeFilter)?void 0:e.includes(i));default:return!1}}hasRelevantNodes(t){for(const e of t)if(e instanceof HTMLElement&&(this.hasRelevantAttributes(e)||this.hasRelevantDescendants(e)))return!0;return!1}hasRelevantAttributes(t){var e;return!0===(null==(e=this.config.attributeFilter)?void 0:e.some(e=>t.hasAttribute(e)))}hasRelevantDescendants(t){if(!this.config.attributeFilter)return!1;const e=this.config.attributeFilter.map(t=>`[${t}]`).join(",");return null!==t.querySelector(e)}processMutation(t){switch(t.type){case"childList":this.processChildListMutation(t);break;case"attributes":this.processAttributeMutation(t)}}processChildListMutation(t){for(const e of t.addedNodes)if(e instanceof HTMLElement&&(this.addElementForProcessing(e,"added"),this.config.attributeFilter)){const t=this.config.attributeFilter.map(t=>`[${t}]`).join(",");e.querySelectorAll(t).forEach(t=>{t instanceof HTMLElement&&this.addElementForProcessing(t,"added")})}for(const e of t.removedNodes)e instanceof HTMLElement&&this.addElementForProcessing(e,"removed")}processAttributeMutation(t){if(t.target instanceof HTMLElement&&t.attributeName){const e=t.target,i=t.attributeName,n=t.oldValue,r=e.getAttribute(i);this.notifyHandlers({type:"attributeChanged",element:e,attributeName:i,oldValue:n||void 0,newValue:r||void 0})}}addElementForProcessing(t,e){this.hasRelevantAttributes(t)&&(this.pendingChanges.add(t),"removed"===e&&this.notifyHandlers({type:"removed",element:t,attributeName:void 0,oldValue:void 0,newValue:void 0}))}throttleNotifications(){this.throttleTimeout||(this.throttleTimeout=window.setTimeout(()=>{this.processePendingChanges(),this.throttleTimeout=void 0},16))}processePendingChanges(){if(0!==this.pendingChanges.size){this.logger.debug(`Processing ${this.pendingChanges.size} pending changes`);for(const t of this.pendingChanges)this.notifyHandlers({type:"added",element:t,attributeName:void 0,oldValue:void 0,newValue:void 0});this.pendingChanges.clear()}}notifyHandlers(t){for(const i of this.handlers)try{i(t)}catch(e){this.logger.error("Handler error:",e)}}clearThrottle(){this.throttleTimeout&&(clearTimeout(this.throttleTimeout),this.throttleTimeout=void 0)}destroy(){this.stop(),this.handlers.clear(),this.logger.debug("DOM observer destroyed")}getConfig(){return u({},this.config)}updateConfig(t){const e=this.isObserving;let i;e&&(i=document.body,this.stop()),this.config=u(u({},this.config),t),e&&i&&this.start(i),this.logger.debug("Updated configuration",this.config)}}class de{constructor(){this.enhancers=new WeakMap,this.enhancerCount=0,this.isScanning=!1,this.scanQueue=new Set,this.enhancerStats=new Map,this.isDebugMode=!1,this.processQueueDebounced=this.debounce(()=>{this.processQueue()},50),this.logger=tt("AttributeScanner"),this.domObserver=new le,this.domObserver.addHandler(this.handleDOMChange.bind(this)),this.isDebugMode="true"===new URLSearchParams(location.search).get("debug"),this.isDebugMode}scanAndEnhance(t){return g(this,null,function*(){if(this.isScanning)this.logger.warn("Already scanning, queuing request");else{this.isScanning=!0,this.logger.info("ðŸ” Starting DOM scan for data attributes...",{root:t.tagName});try{const e=["[data-next-display]","[data-next-toggle]","[data-next-action]","[data-next-timer]","[data-next-show]","[data-next-hide]","[data-next-show-if-profile]","[data-next-hide-if-profile]","form[data-next-checkout]","[data-next-express-checkout]","[data-next-timer-display]","[data-next-timer-expired]","[data-next-cart-items]","[data-next-order-items]",'[data-next-quantity="increase"]','[data-next-quantity="decrease"]','[data-next-quantity="set"]',"[data-next-remove-item]","[data-next-selector]","[data-next-selector-id]","[data-next-cart-selector]","[data-next-upsell]","[data-next-upsell-selector]","[data-next-upsell-select]",'[data-next-coupon="input"]','[data-next-coupon=""]',"[data-next-accordion]","[data-next-tooltip]",'[data-next-express-checkout="container"]','[data-next-component="scroll-hint"]',"[data-next-quantity-text]","[data-next-profile]","select[data-next-profile-selector]"].join(", "),i=t.querySelectorAll(e);this.logger.debug(`Found ${i.length} elements with data attributes`);const n=t.querySelectorAll("[data-next-show], [data-next-hide]");n.length>0&&this.logger.info(`Found ${n.length} conditional display elements:`,Array.from(n).map(t=>({tag:t.tagName,class:t.className,show:t.getAttribute("data-next-show"),hide:t.getAttribute("data-next-hide")})));let r=0;const s=[],a=10;for(let t=0;t<i.length;t+=a){const e=Array.from(i).slice(t,t+a);for(const t of e)t instanceof HTMLElement&&s.push(this.enhanceElement(t).then(()=>{r++}));yield Promise.all(s.splice(0,a)),t+a<i.length&&(yield new Promise(t=>setTimeout(t,0)))}yield Promise.all(s),this.logger.debug(`Enhanced ${r} elements successfully`),this.isDebugMode&&this.enhancerStats.size>0&&this.showPerformanceReport(),document.documentElement.classList.add("next-display-ready"),this.logger.debug("Added next-display-ready class to HTML element"),window.dispatchEvent(new CustomEvent("next:display-ready",{detail:{enhancedCount:r,root:t.tagName}})),this.startObserving(t)}catch(e){this.logger.error("Error during scan and enhance:",e)}finally{this.isScanning=!1}}})}enhanceElement(t){return g(this,null,function*(){if(this.enhancers.has(t))return void this.logger.debug("Element already enhanced, skipping",t);const e=t.closest("[data-next-cart-items]");if(e&&e!==t)return void this.logger.debug("Skipping element inside cart items template",t);const i=t.getAttribute("data-package-id");if(i&&i.includes("{")&&i.includes("}"))this.logger.debug("Skipping element with template variable",t,i);else try{const e=ce.getEnhancerTypes(t);if(0===e.length)return void this.logger.debug("No enhancer types found for element",t);const i=[];for(const r of e){const e=yield this.createEnhancer(r,t);if(e){i.push(e);try{if(this.isDebugMode){const i=performance.now();yield e.initialize();const n=performance.now()-i;this.updateEnhancerStats(r,n),this.logger.debug(`Initialized ${r} enhancer for element`,t)}else yield e.initialize(),this.logger.debug(`Initialized ${r} enhancer for element`,t)}catch(n){this.logger.error(`Failed to initialize ${r} enhancer:`,n,t),e.destroy()}}}i.length>0&&(this.enhancers.set(t,i),this.enhancerCount+=i.length,this.logger.debug(`Enhanced element with ${i.length} enhancer(s)`,{element:t.tagName,types:e,attributes:Array.from(t.attributes).map(t=>t.name)}))}catch(r){this.logger.error("Failed to enhance element:",r,t)}})}createEnhancer(t,e){return g(this,null,function*(){try{switch(t){case"display":const i=e.getAttribute("data-next-display")||"",n=ce.parseDisplayPath(i);if(this.logger.debug(`Creating display enhancer for path: "${i}"`,{parsed:n,element:e.tagName,elementHtml:e.outerHTML.substring(0,200)+"..."}),"cart"===n.object){this.logger.debug("Using CartDisplayEnhancer");const{CartDisplayEnhancer:t}=yield Promise.resolve().then(()=>Bl);return new t(e)}if("selection"===n.object){this.logger.debug("Using SelectionDisplayEnhancer");const{SelectionDisplayEnhancer:t}=yield Promise.resolve().then(()=>Kl);return new t(e)}if("package"===n.object||"campaign"===n.object){this.logger.debug("Using ProductDisplayEnhancer");const{ProductDisplayEnhancer:t}=yield Promise.resolve().then(()=>Wl);return new t(e)}if("order"===n.object){this.logger.debug("Using OrderDisplayEnhancer");const{OrderDisplayEnhancer:t}=yield Promise.resolve().then(()=>Xl);return new t(e)}if("shipping"===n.object){this.logger.debug("Using ShippingDisplayEnhancer");const{ShippingDisplayEnhancer:t}=yield Promise.resolve().then(()=>td);return new t(e)}{let t=e.parentElement,i=!1;for(;t&&!i;)(t.hasAttribute("data-next-package-id")||t.hasAttribute("data-next-package")||t.hasAttribute("data-package-id"))&&(i=!0),t=t.parentElement;if(i){this.logger.debug("Using ProductDisplayEnhancer (fallback with package context)");const{ProductDisplayEnhancer:t}=yield Promise.resolve().then(()=>Wl);return new t(e)}{this.logger.debug("Using CartDisplayEnhancer (fallback without package context)");const{CartDisplayEnhancer:t}=yield Promise.resolve().then(()=>Bl);return new t(e)}}case"toggle":const{CartToggleEnhancer:r}=yield Promise.resolve().then(()=>id);return new r(e);case"action":const s=e.getAttribute("data-next-action");switch(s){case"add-to-cart":const{AddToCartEnhancer:t}=yield Promise.resolve().then(()=>sd);return new t(e);case"accept-upsell":const{AcceptUpsellEnhancer:i}=yield Promise.resolve().then(()=>cd);return new i(e);default:return this.logger.warn(`Unknown action type: ${s}`),null}case"selector":const{PackageSelectorEnhancer:a}=yield Promise.resolve().then(()=>hd);return new a(e);case"timer":const{TimerEnhancer:o}=yield Promise.resolve().then(()=>pd);return new o(e);case"conditional":this.logger.info("Creating ConditionalDisplayEnhancer for element:",{element:e.tagName,class:e.className,showAttr:e.getAttribute("data-next-show"),hideAttr:e.getAttribute("data-next-hide")});const{ConditionalDisplayEnhancer:c}=yield Promise.resolve().then(()=>fd);return new c(e);case"checkout":const{CheckoutFormEnhancer:l}=yield Promise.resolve().then(()=>Od);return new l(e);case"express-checkout":return this.logger.debug("Skipping individual express checkout button - managed by container"),null;case"express-checkout-container":const{ExpressCheckoutContainerEnhancer:d}=yield Promise.resolve().then(()=>zd);return new d(e);case"cart-items":const{CartItemListEnhancer:u}=yield Promise.resolve().then(()=>jd);return new u(e);case"order-items":const{OrderItemListEnhancer:h}=yield Promise.resolve().then(()=>Rd);return new h(e);case"quantity":const{QuantityControlEnhancer:p}=yield Promise.resolve().then(()=>Vd);return new p(e);case"remove-item":const{RemoveItemEnhancer:f}=yield Promise.resolve().then(()=>Bd);return new f(e);case"upsell":const{UpsellEnhancer:m}=yield Promise.resolve().then(()=>Kd);return new m(e);case"coupon":const{CouponEnhancer:g}=yield Promise.resolve().then(()=>Qd);return new g(e);case"accordion":const{AccordionEnhancer:v}=yield Promise.resolve().then(()=>Xd);return new v(e);case"tooltip":const{TooltipEnhancer:y}=yield Promise.resolve().then(()=>xh);return new y(e);case"scroll-hint":const{ScrollHintEnhancer:b}=yield Promise.resolve().then(()=>wh);return new b(e);case"quantity-text":const{QuantityTextEnhancer:x}=yield Promise.resolve().then(()=>_h);return new x(e);case"profile-switcher":const{ProfileSwitcherEnhancer:w}=yield Promise.resolve().then(()=>_e);return new w(e);case"profile-selector":const{ProfileSelectorEnhancer:_}=yield Promise.resolve().then(()=>_e);return new _(e);default:return this.logger.warn(`Unknown enhancer type: ${t}`),null}}catch(i){return this.logger.error(`Failed to create enhancer of type ${t}:`,i),null}})}startObserving(t){this.domObserver.isActive()||(this.domObserver.start(t),this.logger.debug("Started DOM observation"))}handleDOMChange(t){var e;switch(t.type){case"added":this.queueElementForEnhancement(t.element);break;case"removed":this.cleanupElement(t.element);break;case"attributeChanged":(null==(e=t.attributeName)?void 0:e.startsWith("data-next-"))&&(this.logger.debug("Data attribute changed, re-enhancing element",{element:t.element.tagName,attribute:t.attributeName,oldValue:t.oldValue,newValue:t.newValue}),this.cleanupElement(t.element),this.queueElementForEnhancement(t.element))}}queueElementForEnhancement(t){this.scanQueue.add(t),this.processQueueDebounced()}processQueue(){return g(this,null,function*(){if(0===this.scanQueue.size)return;const t=Array.from(this.scanQueue);this.scanQueue.clear(),this.logger.debug(`Processing ${t.length} queued elements`);for(const i of t)try{yield this.enhanceElement(i)}catch(e){this.logger.error("Failed to enhance queued element:",e,i)}})}debounce(t,e){let i;return function(...n){clearTimeout(i),i=window.setTimeout(()=>t.apply(this,n),e)}}cleanupElement(t){const e=this.enhancers.get(t);e&&(e.forEach(t=>t.destroy()),this.enhancerCount-=e.length,this.enhancers.delete(t))}destroy(){this.domObserver.destroy(),this.scanQueue.clear(),this.enhancerCount=0,this.logger.debug("AttributeScanner destroyed")}pause(){this.domObserver.pause(),this.logger.debug("AttributeScanner paused")}resume(t=document.body){this.domObserver.resume(t),this.logger.debug("AttributeScanner resumed")}updateEnhancerStats(t,e){const i=this.enhancerStats.get(t)||{totalTime:0,count:0};i.totalTime+=e,i.count+=1,this.enhancerStats.set(t,i)}showPerformanceReport(){const t=Array.from(this.enhancerStats.entries()).map(([t,e])=>({Enhancer:t,"Total Time (ms)":e.totalTime.toFixed(2),"Average Time (ms)":(e.totalTime/e.count).toFixed(2),Count:e.count,Impact:e.totalTime>50?"ðŸ”´ High":e.totalTime>20?"ðŸŸ¡ Medium":"ðŸŸ¢ Low"})).sort((t,e)=>parseFloat(e["Total Time (ms)"])-parseFloat(t["Total Time (ms)"])).slice(0,3);t.length>0&&t.forEach((t,e)=>{}),Array.from(this.enhancerStats.values()).reduce((t,e)=>t+e.totalTime,0),Array.from(this.enhancerStats.values()).reduce((t,e)=>t+e.count,0)}getStats(){const t={enhancedElements:this.enhancerCount,queuedElements:this.scanQueue.size,isObserving:this.domObserver.isActive(),isScanning:this.isScanning};if(this.isDebugMode&&this.enhancerStats.size>0){t.performanceStats={};for(const[e,i]of this.enhancerStats.entries())t.performanceStats[e]={totalTime:i.totalTime,averageTime:i.totalTime/i.count,count:i.count}}return t}}class ue{constructor(){this.isTestMode=!1,this.konamiSequence=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","KeyB","KeyA"],this.keySequence=[],this.testCards=[{number:"4111111111111111",name:"Visa Test Card",cvv:"123",expiry:"12/25",type:"visa"},{number:"5555555555554444",name:"Mastercard Test Card",cvv:"123",expiry:"12/25",type:"mastercard"},{number:"378282246310005",name:"American Express Test Card",cvv:"1234",expiry:"12/25",type:"amex"},{number:"6011111111111117",name:"Discover Test Card",cvv:"123",expiry:"12/25",type:"discover"}],this.initializeKonamiCode(),this.checkUrlTestMode()}static getInstance(){return ue.instance||(ue.instance=new ue),ue.instance}initializeKonamiCode(){document.addEventListener("keydown",this.handleKeyDown.bind(this))}handleKeyDown(t){this.keySequence.push(t.code),this.keySequence.length>this.konamiSequence.length&&this.keySequence.shift(),this.keySequence.length===this.konamiSequence.length&&this.keySequence.every((t,e)=>t===this.konamiSequence[e])&&(this.activateKonamiCode(),this.keySequence=[])}checkUrlTestMode(){const t=new URLSearchParams(window.location.search),e="true"===t.get("debugger"),i="true"===t.get("test");(e||i)&&(this.isTestMode=!0)}activateKonamiCode(){this.isTestMode=!0,this.showKonamiMessage();const t=new URL(window.location.href);t.searchParams.set("test","true"),window.history.replaceState({},"",t.toString()),this.konamiCallback&&setTimeout(()=>{var t;null==(t=this.konamiCallback)||t.call(this)},2e3),document.dispatchEvent(new CustomEvent("next:test-mode-activated",{detail:{method:"konami"}}))}showKonamiMessage(){const t=document.createElement("div");t.className="konami-activation-message",t.innerHTML='\n      <div class="konami-content">\n        <h3>ðŸŽ® Konami Code Activated!</h3>\n        <p>Test mode enabled. You can now use test payment methods.</p>\n        <div class="konami-progress">\n          <div class="konami-progress-bar"></div>\n        </div>\n      </div>\n    ',t.style.cssText="\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 2rem;\n      border-radius: 12px;\n      box-shadow: 0 20px 40px rgba(0,0,0,0.3);\n      z-index: 10000;\n      font-family: Arial, sans-serif;\n      text-align: center;\n      min-width: 300px;\n    ";const e=t.querySelector(".konami-progress-bar");e&&(e.style.cssText="\n        width: 100%;\n        height: 4px;\n        background: rgba(255,255,255,0.3);\n        border-radius: 2px;\n        overflow: hidden;\n        margin-top: 1rem;\n      ",e.innerHTML='<div style="width: 0; height: 100%; background: white; transition: width 2s ease-in-out;"></div>'),document.body.appendChild(t),setTimeout(()=>{const t=null==e?void 0:e.querySelector("div");t&&(t.style.width="100%")},100),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},2500)}setTestMode(t){if(this.isTestMode=t,t){const t=new URL(window.location.href);t.searchParams.set("test","true"),window.history.replaceState({},"",t.toString())}}isActive(){return this.isTestMode}onKonamiCode(t){this.konamiCallback=t}getTestCards(){return[...this.testCards]}getTestCard(t){if(t){const e=this.testCards.find(e=>e.type===t);if(e)return e}const e=this.testCards[0];if(!e)throw new Error("No test cards available");return e}fillTestCardData(t="visa"){if(!this.isTestMode)return;const e=this.getTestCard(t),i=document.querySelector('input[data-spreedly="number"], input[name*="card_number"], input[name*="cardNumber"]');i&&(i.value=e.number,i.dispatchEvent(new Event("input",{bubbles:!0})));const n=document.querySelector('input[data-spreedly="cvv"], input[name*="cvv"], input[name*="security"]');n&&(n.value=e.cvv,n.dispatchEvent(new Event("input",{bubbles:!0})));const r=document.querySelector('input[name*="expiry"], input[name*="exp"]');if(r)r.value=e.expiry,r.dispatchEvent(new Event("input",{bubbles:!0}));else{const t=document.querySelector('select[name*="month"], input[name*="month"]'),i=document.querySelector('select[name*="year"], input[name*="year"]');if(t&&i){const[n,r]=e.expiry.split("/");n&&r&&(t.value=n,i.value=`20${r}`,t.dispatchEvent(new Event("change",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0})))}}const s=document.querySelector('input[name*="cardholder"], input[name*="card_name"]');s&&(s.value="Test Cardholder",s.dispatchEvent(new Event("input",{bubbles:!0})))}showTestCardMenu(){if(!this.isTestMode)return;const t=document.createElement("div");t.className="test-card-menu",t.innerHTML=`\n      <div class="test-card-content">\n        <h4>Test Card Numbers</h4>\n        <div class="test-card-options">\n          ${this.testCards.map(t=>`\n            <button class="test-card-option" data-card-type="${t.type}">\n              <div class="card-name">${t.name}</div>\n              <div class="card-number">${t.number}</div>\n            </button>\n          `).join("")}\n        </div>\n        <button class="test-card-close">Close</button>\n      </div>\n    `,t.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: white;\n      border: 1px solid #ddd;\n      border-radius: 8px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n      z-index: 10000;\n      font-family: Arial, sans-serif;\n      min-width: 250px;\n    ",t.addEventListener("click",e=>{const i=e.target;if(i.classList.contains("test-card-option")||i.closest(".test-card-option")){const e=i.closest(".test-card-option").getAttribute("data-card-type");e&&(this.fillTestCardData(e),t.remove())}else i.classList.contains("test-card-close")&&t.remove()}),document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.remove()},3e4)}}const he=ue.getInstance();class pe{constructor(){this.cachePrefix="next_country_",this.cacheExpiry=36e5,this.baseUrl="https://cdn-countries.muddy-wind-c7ca.workers.dev",this.config={},this.logger=new Y("CountryService")}static getInstance(){return pe.instance||(pe.instance=new pe),pe.instance}setConfig(t){this.config=u({},t),this.logger.debug("Address configuration updated:",this.config)}getConfig(){return u({},this.config)}getLocationData(){return g(this,null,function*(){var t;const e=this.getFromCache("location_data",!0);if(e)return yield this.applyCountryFiltering(e);try{const e=yield fetch(`${this.baseUrl}/location`);if(!e.ok)throw new Error(`Failed to fetch location data: ${e.statusText}`);const i=yield e.json();return this.setCache("location_data",i,!0),this.logger.debug("Location data fetched",{detectedCountry:i.detectedCountryCode,countriesCount:null==(t=i.countries)?void 0:t.length}),yield this.applyCountryFiltering(i)}catch(i){return this.logger.error("Failed to fetch location data:",i),yield this.applyCountryFiltering(this.getFallbackLocationData())}})}getCountryStates(t){return g(this,null,function*(){var e,i;const n=`states_${t}`,r=this.getFromCache(n,!0);if(r)return h(u({},r),{states:this.applyStateFiltering(r.states||[])});try{const r=yield fetch(`${this.baseUrl}/countries/${t}/states`);if(!r.ok)throw new Error(`Failed to fetch states for ${t}: ${r.statusText}`);const s=yield r.json();return this.setCache(n,s,!0),this.logger.debug(`States data fetched for ${t}`,{statesCount:null==(e=s.states)?void 0:e.length,stateLabel:null==(i=s.countryConfig)?void 0:i.stateLabel}),h(u({},s),{states:this.applyStateFiltering(s.states||[])})}catch(s){return this.logger.error(`Failed to fetch states for ${t}:`,s),{countryConfig:this.getDefaultCountryConfig(t),states:[]}}})}getCountryConfig(t){return g(this,null,function*(){const e=yield this.getLocationData();return e.detectedCountryCode===t?e.detectedCountryConfig:(yield this.getCountryStates(t)).countryConfig})}validatePostalCode(t,e,i){if(!t)return!1;if(t.length<i.postcodeMinLength||t.length>i.postcodeMaxLength)return!1;if(i.postcodeRegex)try{return new RegExp(i.postcodeRegex).test(t)}catch(n){return this.logger.error("Invalid postal code regex:",n),!0}return!0}clearCache(){try{const t=[];for(let i=0;i<sessionStorage.length;i++){const e=sessionStorage.key(i);e&&e.startsWith(this.cachePrefix)&&t.push(e)}t.forEach(t=>sessionStorage.removeItem(t));const e=[];for(let i=0;i<localStorage.length;i++){const t=localStorage.key(i);t&&t.startsWith(this.cachePrefix)&&e.push(t)}e.forEach(t=>localStorage.removeItem(t)),this.logger.debug(`Country service cache cleared (${t.length} session + ${e.length} local entries)`)}catch(t){this.logger.warn("Failed to clear cache:",t)}}clearCountryCache(t){try{const e=this.cachePrefix+`states_${t}`;localStorage.removeItem(e),sessionStorage.removeItem(e),this.logger.debug(`Cache cleared for country: ${t}`)}catch(e){this.logger.warn(`Failed to clear cache for country ${t}:`,e)}}getFromCache(t,e=!1){try{const i=this.cachePrefix+t,n=e?localStorage:sessionStorage,r=n.getItem(i);if(!r)return null;const{data:s,timestamp:a}=JSON.parse(r);return Date.now()-a>this.cacheExpiry?(n.removeItem(i),null):s}catch(i){return this.logger.warn("Failed to read from cache:",i),null}}setCache(t,e,i=!1){try{const n=this.cachePrefix+t,r={data:e,timestamp:Date.now()};(i?localStorage:sessionStorage).setItem(n,JSON.stringify(r))}catch(n){this.logger.warn("Failed to write to cache:",n)}}getDefaultCountryConfig(t){return{US:{stateLabel:"State",stateRequired:!0,postcodeLabel:"ZIP Code",postcodeRegex:"^\\d{5}(-\\d{4})?$",postcodeMinLength:5,postcodeMaxLength:10,postcodeExample:"12345 or 12345-6789",currencyCode:"USD",currencySymbol:"$"},CA:{stateLabel:"Province",stateRequired:!0,postcodeLabel:"Postal Code",postcodeRegex:"^[A-Z]\\d[A-Z] ?\\d[A-Z]\\d$",postcodeMinLength:6,postcodeMaxLength:7,postcodeExample:"K1A 0B1",currencyCode:"CAD",currencySymbol:"$"},GB:{stateLabel:"County",stateRequired:!1,postcodeLabel:"Postcode",postcodeRegex:"^[A-Z]{1,2}\\d{1,2}[A-Z]?\\s?\\d[A-Z]{2}$",postcodeMinLength:5,postcodeMaxLength:8,postcodeExample:"SW1A 1AA",currencyCode:"GBP",currencySymbol:"Â£"}}[t]||{stateLabel:"State/Province",stateRequired:!1,postcodeLabel:"Postal Code",postcodeRegex:null,postcodeMinLength:2,postcodeMaxLength:20,postcodeExample:null,currencyCode:"USD",currencySymbol:"$"}}getFallbackLocationData(){return{detectedCountryCode:"US",detectedCountryConfig:this.getDefaultCountryConfig("US"),detectedStates:[],countries:[{code:"US",name:"United States",phonecode:"+1",currencyCode:"USD",currencySymbol:"$"},{code:"CA",name:"Canada",phonecode:"+1",currencyCode:"CAD",currencySymbol:"$"},{code:"GB",name:"United Kingdom",phonecode:"+44",currencyCode:"GBP",currencySymbol:"Â£"},{code:"AU",name:"Australia",phonecode:"+61",currencyCode:"AUD",currencySymbol:"$"},{code:"DE",name:"Germany",phonecode:"+49",currencyCode:"EUR",currencySymbol:"â‚¬"}]}}applyCountryFiltering(t){return g(this,null,function*(){let e=[...t.countries];this.config.countries&&this.config.countries.length>0?e=this.config.countries.map(t=>({code:t.code,name:t.name,phonecode:"",currencyCode:"USD",currencySymbol:"$"})):this.config.showCountries&&this.config.showCountries.length>0&&(e=e.filter(t=>this.config.showCountries.includes(t.code)));const i=t.detectedCountryConfig;let n=t.detectedCountryCode,r=t.detectedCountryConfig;const s=e.some(t=>t.code===n);return n&&s||!this.config.defaultCountry?n&&s&&this.logger.info(`Using detected country: ${n}`):e.some(t=>t.code===this.config.defaultCountry)&&(this.logger.info(`Using default country ${this.config.defaultCountry} for shipping (detected: ${n}, allowed: ${s})`),this.logger.info(`Preserving detected currency: ${i.currencyCode} from detected location: ${t.detectedCountryCode}`),n=this.config.defaultCountry,r=i),h(u({},t),{countries:e,detectedCountryCode:n,detectedCountryConfig:r})})}applyStateFiltering(t){const e=["AS","UM-81","GU","UM-84","UM-86","UM-67","UM-89","UM-71","UM-76","MP","UM-95","PR","UM","VI","UM-79"];let i=t.filter(t=>!e.includes(t.code));return this.config.dontShowStates&&this.config.dontShowStates.length>0&&(i=i.filter(t=>!this.config.dontShowStates.includes(t.code))),i}}const fe=class{static initialize(){return g(this,null,function*(){var t;if(this.initialized)this.logger.warn("SDK already initialized");else try{this.logger.info("Initializing 29Next Campaign Cart SDK v2..."),this.initStartTime=Date.now(),queueMicrotask(()=>function(){return g(this,null,function*(){const t=new URLSearchParams(window.location.search),e=Nt.getState();yield te("page_view",{page_type:Wt(),has_ref_id:t.has("ref_id"),utm_source:e.utm_source||null,utm_medium:e.utm_medium||null,utm_campaign:e.utm_campaign||null,referrer:document.referrer||null,device_type:Kt(),browser:Qt(),os:Zt()})})}()),yield this.waitForDOM(),yield this.loadConfiguration(),yield this.initializeLocationAndCurrency(),yield this.initializeAttribution(),yield this.loadCampaignData(),yield this.initializeAnalytics(),yield this.waitForStoreRehydration(),this.initializeErrorHandler(),yield this.checkAndLoadOrder(),yield this.scanAndEnhanceDOM(),this.setupReadyCallbacks(),yield this.initializeDebugMode(),this.initialized=!0;const e=Date.now()-this.initStartTime;this.logger.info("SDK initialization complete âœ…");const i=yt.getState(),n=null==(t=this.attributeScanner)?void 0:t.getStats();queueMicrotask(()=>{!function(t){g(this,null,function*(){yield te("sdk_initialized",{initialization_time_ms:t.initializationTime,campaign_load_time_ms:t.campaignLoadTime,from_cache:t.fromCache,retry_attempts:t.retryAttempts,elements_enhanced:t.elementsEnhanced,debug_mode:t.debugMode,force_package_id:t.forcePackageId||null,force_shipping_id:t.forceShippingId||null})})}({initializationTime:e,campaignLoadTime:this.campaignLoadTime,fromCache:this.campaignFromCache,retryAttempts:this.retryAttempts,elementsEnhanced:(null==n?void 0:n.enhancedElements)||0,debugMode:i.debug||!1,forcePackageId:window._nextForcePackageId||null,forceShippingId:window._nextForceShippingId||null})}),this.retryAttempts=0,this.emitInitializedEvent()}catch(e){this.logger.error("SDK initialization failed:",e);let t="config_load";if(this.campaignLoadStartTime>0&&(t="campaign_load"),this.attributeScanner&&(t="dom_scan"),queueMicrotask(()=>{!function(t){g(this,null,function*(){yield te("sdk_initialization_failed",{error_message:t.errorMessage,error_stage:t.errorStage,retry_attempt:t.retryAttempt})})}({errorMessage:e instanceof Error?e.message:String(e),errorStage:t,retryAttempt:this.retryAttempts})}),this.retryAttempts<this.maxRetries)return this.retryAttempts++,this.logger.warn(`Retrying initialization (attempt ${this.retryAttempts}/${this.maxRetries})...`),yield new Promise(t=>setTimeout(t,1e3*this.retryAttempts)),this.initialize();throw e}})}static captureUrlParameters(t){return g(this,null,function*(){try{const{useParameterStore:e}=yield Promise.resolve().then(()=>jt),i=e.getState(),n=u({},i.params),r={};t.forEach((t,e)=>{r[e]=t});const s=u(u({},n),r);if(Object.keys(s).length>0){i.updateParams(s),this.logger.debug(`Captured ${Object.keys(r).length} URL parameters, total stored: ${Object.keys(s).length}`);const t=["seen","timer","reviews","loading","banner","exit"],e=Object.keys(s).filter(e=>t.includes(e));e.length>0&&this.logger.info("Visibility control parameters detected:",e.map(t=>`${t}=${s[t]}`).join(", "))}}catch(e){this.logger.warn("Failed to capture URL parameters:",e)}})}static initializeLocationAndCurrency(){return g(this,null,function*(){var t;try{this.logger.info("Initializing location and currency detection...");const i=pe.getInstance(),n=yt.getState(),r=new URLSearchParams(window.location.search).get("country"),s=sessionStorage.getItem("next_selected_country"),a=r||s;let o=null;if(a){this.logger.info(`Using forced country: ${a} (source: ${r?"URL":"session"})`);try{const t=yield fetch(`https://cdn-countries.muddy-wind-c7ca.workers.dev/countries/${a.toUpperCase()}/states`);if(t.ok){const e=yield t.json();o={detectedCountryCode:a.toUpperCase(),detectedCountryConfig:e.countryConfig||{currencyCode:"USD",currencySymbol:"$",stateLabel:"State / Province",stateRequired:!0,postcodeLabel:"Postcode / ZIP",postcodeMinLength:2,postcodeMaxLength:20},detectedStates:e.states||[],countries:[]},r&&sessionStorage.setItem("next_selected_country",r.toUpperCase()),this.logger.info("Country config loaded:",{country:null==o?void 0:o.detectedCountryCode,currency:null==o?void 0:o.detectedCountryConfig.currencyCode})}else this.logger.warn(`Failed to fetch country config for ${a}, falling back to detection`)}catch(e){this.logger.error("Error fetching country config:",e)}}if(o){if(o&&!(null==(t=o.countries)?void 0:t.length))try{const t=yield i.getLocationData();o.countries=t.countries||[]}catch(e){this.logger.warn("Failed to fetch countries list:",e)}}else{n.addressConfig&&i.setConfig(n.addressConfig);const t=i.getLocationData(),r=new Promise((t,e)=>setTimeout(()=>e(new Error("Location detection timeout")),3e3));try{o=yield Promise.race([t,r])}catch(e){this.logger.warn("Location detection failed or timed out, using defaults:",e),o={detectedCountryCode:"US",detectedCountryConfig:{stateLabel:"State",stateRequired:!0,postcodeLabel:"ZIP Code",postcodeRegex:"^\\d{5}(-\\d{4})?$",postcodeMinLength:5,postcodeMaxLength:10,postcodeExample:"12345",currencyCode:"USD",currencySymbol:"$"},detectedStates:[],countries:[]}}}if(o){this.logger.info("User location detected:",{country:o.detectedCountryCode,currency:o.detectedCountryConfig.currencyCode,currencySymbol:o.detectedCountryConfig.currencySymbol}),n.updateConfig({detectedCountry:o.detectedCountryCode,detectedCurrency:o.detectedCountryConfig.currencyCode,locationData:o});const t=new URLSearchParams(window.location.search).get("currency"),e=sessionStorage.getItem("next_selected_currency"),i=o.detectedCountryConfig.currencyCode;let r;t?(r=t.toUpperCase(),this.logger.info("Currency override from URL:",r),sessionStorage.setItem("next_selected_currency",r)):e?(r=e,this.logger.info("Using saved currency preference:",r)):(r=i,this.logger.info("Using detected currency:",r)),n.updateConfig({selectedCurrency:r}),this.logger.debug("Location and currency initialized:",{detectedCountry:n.detectedCountry,detectedCurrency:n.detectedCurrency,selectedCurrency:n.selectedCurrency})}}catch(e){this.logger.warn("Failed to initialize location/currency, using defaults:",e);const t=sessionStorage.getItem("next_selected_currency"),i=new URLSearchParams(window.location.search).get("currency");let n="USD";i?(n=i.toUpperCase(),sessionStorage.setItem("next_selected_currency",n)):t&&(n=t),yt.getState().updateConfig({detectedCountry:"US",detectedCurrency:"USD",selectedCurrency:n})}})}static loadConfiguration(){return g(this,null,function*(){const t=yt.getState(),e=new URLSearchParams(window.location.search);if("true"===e.get("reset")){yield this.clearAllStorage(),e.delete("reset");const t=window.location.pathname+(e.toString()?"?"+e.toString():"");window.history.replaceState({},"",t)}yield this.captureUrlParameters(e);const i="true"===e.get("debugger"),n=e.get("forcePackageId"),r=e.get("forceShippingId");t.loadFromWindow(),t.loadFromMeta(),i&&t.updateConfig({debug:!0}),n&&(this.logger.info("forcePackageId parameter detected:",n),window._nextForcePackageId=n),r&&(this.logger.info("forceShippingId parameter detected:",r),window._nextForceShippingId=r),this.logger.debug("Configuration loaded (metatags have priority):",t)})}static loadCampaignData(){return g(this,null,function*(){const t=yt.getState(),e=dt.getState();if(!t.apiKey)throw new Error("API key not found. Please set next-api-key meta tag or window.nextConfig.apiKey");this.campaignLoadStartTime=Date.now(),yield e.loadCampaign(t.apiKey),this.campaignLoadTime=Date.now()-this.campaignLoadStartTime,this.campaignFromCache=e.isFromCache||!1,e.data&&queueMicrotask(()=>{var t,i,n,r,s;const a={loadTime:this.campaignLoadTime,fromCache:this.campaignFromCache,packageCount:(null==(i=null==(t=e.data)?void 0:t.packages)?void 0:i.length)||0,shippingMethodsCount:(null==(r=null==(n=e.data)?void 0:n.shipping_methods)?void 0:r.length)||0,currency:(null==(s=e.data)?void 0:s.currency)||"USD"};void 0!==e.cacheAge&&(a.cacheAge=e.cacheAge),function(t){g(this,null,function*(){yield te("campaign_loaded",{load_time_ms:t.loadTime,from_cache:t.fromCache,cache_age_ms:t.cacheAge||null,package_count:t.packageCount,shipping_methods_count:t.shippingMethodsCount,currency:t.currency})})}(a)}),this.logger.debug("Campaign data loaded"),yield this.processForcePackageId(),yield this.processForceShippingId(),yield this.processProfileParameter(),st.getInstance().emit("sdk:url-parameters-processed",{}),this.logger.debug("Emitted sdk:url-parameters-processed event")})}static processForcePackageId(){return g(this,null,function*(){const t=window._nextForcePackageId;if(t)try{this.logger.info("Processing forcePackageId parameter:",t);const e=Tt.getState(),i=dt.getState();yield e.clear(),this.logger.debug("Cart cleared for forcePackageId");const n=t.split(",").map(t=>{const[e,i]=t.trim().split(":"),n=parseInt(e||"",10),r=i?parseInt(i,10):1;if(isNaN(n)||n<=0)throw new Error(`Invalid package ID: ${e}`);if(isNaN(r)||r<=0)throw new Error(`Invalid quantity: ${i}`);return{packageId:n,quantity:r}});this.logger.debug("Parsed package specifications:",n);for(const t of n)i.getPackage(t.packageId)?(yield e.addItem({packageId:t.packageId,quantity:t.quantity,isUpsell:!1}),this.logger.debug(`Added package ${t.packageId} with quantity ${t.quantity} to cart`)):this.logger.warn(`Package ${t.packageId} not found in campaign data, skipping`);this.logger.info(`Successfully processed forcePackageId: added ${n.length} package(s) to cart`),delete window._nextForcePackageId}catch(e){this.logger.error("Error processing forcePackageId parameter:",e)}})}static processProfileParameter(){return g(this,null,function*(){const t=new URLSearchParams(window.location.search),e=t.get("profile")||t.get("forceProfile")||t.get("packageProfile"),i=yt.getState();if(i.profiles&&Object.keys(i.profiles).length>0){const{useProfileStore:t}=yield Promise.resolve().then(()=>gt),e=t.getState();Object.entries(i.profiles).forEach(([t,i])=>{e.registerProfile({id:t,name:i.name,description:i.description||"",packageMappings:i.packageMappings})}),this.logger.debug(`Registered ${Object.keys(i.profiles).length} profiles from config`)}if(e){this.logger.info("Profile parameter detected:",e);try{const{ProfileManager:i}=yield Promise.resolve().then(()=>ve),n=i.getInstance(),r=null!==t.get("forceProfile");yield n.applyProfile(e,{clearCart:r}),this.logger.info(`Profile "${e}" applied successfully from URL`)}catch(s){this.logger.error("Failed to apply profile from URL:",s)}return}const{useProfileStore:n}=yield Promise.resolve().then(()=>gt),r=n.getState();if(r.activeProfileId&&"default"!==r.activeProfileId&&"regular"!==r.activeProfileId)try{this.logger.info("Restoring persisted profile:",r.activeProfileId);const{ProfileManager:t}=yield Promise.resolve().then(()=>ve),e=t.getInstance();return yield e.applyProfile(r.activeProfileId,{clearCart:!1,preserveQuantities:!0}),void this.logger.info(`Restored profile "${r.activeProfileId}" from previous session`)}catch(s){this.logger.error("Failed to restore persisted profile:",s)}if(i.defaultProfile&&!r.activeProfileId)try{this.logger.info("Applying default profile:",i.defaultProfile);const{ProfileManager:t}=yield Promise.resolve().then(()=>ve),e=t.getInstance();yield e.applyProfile(i.defaultProfile)}catch(s){this.logger.error("Failed to apply default profile:",s)}})}static processForceShippingId(){return g(this,null,function*(){const t=window._nextForceShippingId;if(t)try{this.logger.info("Processing forceShippingId parameter:",t);const e=Tt.getState(),i=dt.getState(),n=parseInt(t,10);if(isNaN(n)||n<=0)throw new Error(`Invalid shipping ID: ${t}`);const r=i.data;if(!(null==r?void 0:r.shipping_methods))return void this.logger.warn("No shipping methods available in campaign data");const s=r.shipping_methods.find(t=>t.ref_id===n);if(!s)return this.logger.warn(`Shipping method ${n} not found in campaign data`),void this.logger.debug("Available shipping methods:",r.shipping_methods.map(t=>({id:t.ref_id,code:t.code,price:t.price})));yield e.setShippingMethod(n),this.logger.info(`Successfully set shipping method: ${s.code} (ID: ${n}, Price: $${s.price})`),delete window._nextForceShippingId}catch(e){this.logger.error("Error processing forceShippingId parameter:",e)}})}static initializeAttribution(){return g(this,null,function*(){var t;try{this.logger.info("Initializing attribution...");const e=Nt.getState(),i=yt.getState();yield e.initialize();const n="undefined"!=typeof window&&window.__NEXT_SDK_VERSION__?window.__NEXT_SDK_VERSION__:"unknown";if(e.updateAttribution({metadata:h(u({},e.metadata),{sdk_version:n})}),this.logger.debug(`Added SDK version to attribution metadata: ${n}`),this.setupAttributionListeners(),null==(t=i.utmTransfer)?void 0:t.enabled){const{UtmTransfer:t}=yield Promise.resolve().then(()=>Sh);new t(i.utmTransfer).init(),this.logger.debug("UTM transfer initialized")}this.logger.debug("Attribution initialized")}catch(e){this.logger.error("Attribution initialization failed:",e)}})}static setupAttributionListeners(){const t=st.getInstance(),e=Nt.getState();t.on("campaign:loaded",t=>{(null==t?void 0:t.name)&&!e.funnel&&(e.setFunnelName(t.name),this.logger.debug("Set funnel name from campaign:",t.name))}),t.on("cart:updated",()=>{e.updateAttribution({metadata:h(u({},e.metadata),{conversion_timestamp:Date.now()})}),this.logger.debug("Updated attribution with conversion timestamp")}),window.addEventListener("popstate",()=>{e.updateAttribution({metadata:h(u({},e.metadata),{landing_page:window.location.href})})})}static initializeAnalytics(){return g(this,null,function*(){setTimeout(()=>g(this,null,function*(){try{this.logger.info("Initializing analytics v2 (lazy)...");const{nextAnalytics:t}=yield Promise.resolve().then(()=>Tl);yield t.initialize(),this.logger.debug("Analytics v2 initialized successfully (lazy)")}catch(t){this.logger.warn("Analytics v2 initialization failed (non-critical):",t)}}),0)})}static initializeErrorHandler(){try{Promise.resolve().then(()=>Ch).then(({errorHandler:t})=>{t.initialize(),this.logger.debug("Error handler initialized")})}catch(t){this.logger.warn("Error handler initialization failed:",t)}}static checkAndLoadOrder(){return g(this,null,function*(){const t=new URLSearchParams(window.location.search),e=t.get("ref_id")||t.get("order_ref_id");if(e){const n=t.get("ref_id")?"ref_id":"order_ref_id";this.logger.info(`Page loaded with ${n} parameter, auto-loading order:`,e);try{const t=yt.getState(),i=Ot.getState(),n=new re(t.apiKey);yield i.loadOrder(e,n),this.logger.info("Order loaded successfully:",i.order),i.order&&this.logger.info("Order supports upsells:",i.order.supports_post_purchase_upsells)}catch(i){this.logger.error("Failed to auto-load order:",i)}}})}static scanAndEnhanceDOM(){return g(this,null,function*(){this.attributeScanner&&this.attributeScanner.destroy(),this.attributeScanner=new de,yield this.attributeScanner.scanAndEnhance(document.body);const t=this.attributeScanner.getStats();this.logger.info("DOM scanning and enhancement complete",t)})}static setupReadyCallbacks(){const t=ae.getInstance();"undefined"!=typeof window&&(Array.isArray(window.nextReady)&&window.nextReady.forEach(e=>{try{e(t)}catch(i){this.logger.error("Ready callback error:",i)}}),window.next=t,window.nextReady={push:e=>{try{e(t)}catch(i){this.logger.error("Ready callback error:",i)}}},this.logger.debug("nextReady callback system and window.next API initialized"))}static initializeDebugMode(){return g(this,null,function*(){if(yt.getState().debug){this.logger.info("Debug mode enabled - initializing debug utilities"),Y.setLogLevel(Z.DEBUG),this.logger.info("Logger level set to DEBUG");const{debugOverlay:t}=yield Promise.resolve().then(()=>Xh);t.initialize(),this.setupGlobalDebugUtils(),this.logger.info("Debug utilities initialized âœ…")}})}static setupGlobalDebugUtils(){"undefined"!=typeof window&&(window.nextDebug={overlay:()=>Promise.resolve().then(()=>Xh).then(t=>t.debugOverlay),testMode:he,stores:{cart:Tt,campaign:dt,config:yt,checkout:Mt,order:Ot,attribution:Nt},sdk:ae.getInstance(),reinitialize:()=>this.reinitialize(),getStats:()=>this.getInitializationStats(),addToCart:(t,e=1)=>{const i=Tt.getState(),n=dt.getState().getPackage(t);n&&i.addItem({packageId:t,quantity:e,price:parseFloat(n.price),title:n.name,isUpsell:!1})},removeFromCart:t=>{Tt.getState().removeItem(t)},updateQuantity:(t,e)=>{Tt.getState().updateQuantity(t,e)},loadCampaign:()=>{const t=yt.getState();return dt.getState().loadCampaign(t.apiKey)},clearCampaignCache:()=>{dt.getState().clearCache()},getCacheInfo:()=>dt.getState().getCacheInfo(),inspectPackage:t=>{dt.getState().getPackage(t)},testShippingMethod:t=>g(this,null,function*(){try{const e=Tt.getState();yield e.setShippingMethod(t),e.shippingMethod,document.dispatchEvent(new CustomEvent("debug:update-content"))}catch(e){}}),sortPackages:t=>{document.dispatchEvent(new CustomEvent("debug:update-content"))},analytics:{getStatus:()=>g(this,null,function*(){const{nextAnalytics:t}=yield Promise.resolve().then(()=>Tl);return t.getStatus()}),getProviders:()=>g(this,null,function*(){const{nextAnalytics:t}=yield Promise.resolve().then(()=>Tl);return t.getStatus().providers}),track:(t,e)=>g(this,null,function*(){const{nextAnalytics:i}=yield Promise.resolve().then(()=>Tl);return i.track(u({event:t},e))}),setDebugMode:t=>g(this,null,function*(){const{nextAnalytics:e}=yield Promise.resolve().then(()=>Tl);return e.setDebugMode(t)}),invalidateContext:()=>g(this,null,function*(){const{nextAnalytics:t}=yield Promise.resolve().then(()=>Tl);return t.invalidateContext()})},attribution:{debug:()=>Nt.getState().debug(),get:()=>Nt.getState().getAttributionForApi(),setFunnel:t=>Nt.getState().setFunnelName(t),setEvclid:t=>Nt.getState().setEverflowClickId(t),clearFunnel:()=>Nt.getState().clearPersistedFunnel(),getFunnel:()=>{const t=Nt.getState(),e=localStorage.getItem("next_funnel_name")||sessionStorage.getItem("next_funnel_name");return t.funnel||e||"(not set)"}},highlightElement:t=>{this.logger.debug(`ðŸŽ¯ Highlighting element: ${t}`)},addTestItems:()=>{const t=Tt.getState();[2,7,9].forEach(e=>{t.addItem({packageId:e,quantity:1,price:19.99,title:`Test Package ${e}`,isUpsell:!1})})},accordion:{open:t=>{document.dispatchEvent(new CustomEvent("next:accordion-open",{detail:{id:t}}))},close:t=>{document.dispatchEvent(new CustomEvent("next:accordion-close",{detail:{id:t}}))},toggle:t=>{document.dispatchEvent(new CustomEvent("next:accordion-toggle",{detail:{id:t}}))}},order:{getJourney:()=>Ot.getState().getUpsellJourney(),isExpired:()=>Ot.getState().isOrderExpired(),clearCache:()=>{Ot.getState().clearOrder()},getStats:()=>{const t=Ot.getState();return{hasOrder:!!t.order,refId:t.refId,orderAge:t.orderLoadedAt?`${Math.floor((Date.now()-t.orderLoadedAt)/1e3/60)} minutes`:"N/A",viewedUpsells:t.viewedUpsells,viewedUpsellPages:t.viewedUpsellPages,completedUpsells:t.completedUpsells,journeyLength:t.upsellJourney.length}}}})}static isInitialized(){return this.initialized}static reinitialize(){return g(this,null,function*(){this.logger.info("Reinitializing SDK..."),this.attributeScanner&&(this.attributeScanner.destroy(),this.attributeScanner=null),this.initialized=!1,this.retryAttempts=0,yield this.initialize()})}static waitForDOM(){return g(this,null,function*(){if("loading"===document.readyState)return new Promise(t=>{const e=()=>{document.removeEventListener("DOMContentLoaded",e),document.removeEventListener("readystatechange",e),t()};document.addEventListener("DOMContentLoaded",e),document.addEventListener("readystatechange",e)})})}static waitForStoreRehydration(){return g(this,null,function*(){const t=Tt.getState();if(sessionStorage.getItem(nt)){this.logger.debug("Waiting for cart store rehydration...");const e=Date.now();yield new Promise(t=>{setTimeout(t,50)}),yield t.calculateTotals();const i=Date.now()-e;this.logger.debug("Cart store rehydration complete",{itemCount:t.items.length,total:t.total,isEmpty:t.isEmpty}),queueMicrotask(()=>{!function(t){g(this,null,function*(){yield te("cart_loaded",{items_count:t.itemsCount,cart_value:t.cartValue,load_time_ms:t.loadTime,from_storage:t.fromStorage})})}({itemsCount:t.items.length,cartValue:t.total,loadTime:i,fromStorage:!0})})}else this.logger.debug("No cart data to rehydrate")})}static emitInitializedEvent(){var t;if("undefined"!=typeof window){const e=new CustomEvent("next:initialized",{detail:{version:"0.2.0",timestamp:Date.now(),stats:null==(t=this.attributeScanner)?void 0:t.getStats()}});window.dispatchEvent(e)}}static getAttributeScanner(){return this.attributeScanner}static getInitializationStats(){return u({initialized:this.initialized,retryAttempts:this.retryAttempts},this.attributeScanner&&{scannerStats:this.attributeScanner.getStats()})}static clearAllStorage(){return g(this,null,function*(){this.logger.info("Clearing all Next Campaign Cart storage...");const t=[];for(let i=0;i<sessionStorage.length;i++){const e=sessionStorage.key(i);e&&(e.startsWith("next-")||e.startsWith("_next"))&&t.push(e)}t.forEach(t=>sessionStorage.removeItem(t));const e=[];for(let i=0;i<localStorage.length;i++){const t=localStorage.key(i);t&&(t.startsWith("next-")||t.startsWith("_next"))&&e.push(t)}e.forEach(t=>localStorage.removeItem(t)),document.cookie.split(";").forEach(t=>{const e=t.indexOf("="),i=e>-1?t.substr(0,e).trim():t.trim();(i.startsWith("next_")||i.startsWith("_next"))&&(document.cookie=`${i}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`,document.cookie=`${i}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=${window.location.hostname};`,document.cookie=`${i}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.${window.location.hostname};`)}),this.logger.info(`Cleared ${t.length} sessionStorage items, ${e.length} localStorage items`)})}};fe.logger=tt("SDKInitializer"),fe.initialized=!1,fe.attributeScanner=null,fe.retryAttempts=0,fe.maxRetries=3,fe.initStartTime=0,fe.campaignLoadStartTime=0,fe.campaignLoadTime=0,fe.campaignFromCache=!1;let me=fe;class ge{constructor(){this.logger=tt("ProfileManager"),this.eventBus=st.getInstance(),this.profileOperationInProgress=!1,this.initialCartState=null,this.captureInitialState()}static getInstance(){return ge.instance||(ge.instance=new ge),ge.instance}captureInitialState(){const t=Tt.getState(),e=mt.getState();e.activeProfileId&&"default"!==e.activeProfileId&&"regular"!==e.activeProfileId||(this.initialCartState=[...t.items],this.logger.debug("Captured initial cart state with items:",this.initialCartState.map(t=>t.packageId)))}applyProfile(t){return g(this,arguments,function*(t,e={}){if(this.profileOperationInProgress)this.logger.warn("Profile operation already in progress, skipping");else{this.profileOperationInProgress=!0;try{const{clearCart:i=!1,preserveQuantities:n=!0,skipValidation:r=!1}=e;this.logger.info(`Applying profile: ${t}`,e);const s=mt.getState(),a=Tt.getState();if("default"===t||"regular"===t||!t)return s.activeProfileId&&"default"!==s.activeProfileId&&"regular"!==s.activeProfileId?(yield this.revertProfile(),void(this.profileOperationInProgress=!1)):(this.logger.info("Already on default/regular profile, no action needed"),void(this.profileOperationInProgress=!1));const o=s.getProfileById(t);if(!o){const e=`Profile "${t}" not found`;throw this.logger.error(e),new Error(e)}if(s.activeProfileId===t)return void this.logger.info(`Profile "${t}" is already active`);const c=[...a.items];if(i)return yield a.clear(),s.activateProfile(t),s.clearOriginalCartSnapshot(),this.eventBus.emit("profile:applied",{profileId:t,previousProfileId:s.previousProfileId,cleared:!0,itemsSwapped:0,profile:o}),void this.logger.info(`Profile "${t}" applied with cart cleared`);c.length>0&&!s.originalCartSnapshot?(s.setOriginalCartSnapshot(c),this.logger.debug("Saved original cart snapshot before profile application")):s.originalCartSnapshot&&this.logger.debug("Keeping existing cart snapshot, not overwriting");const l=yield this.mapCartItems(c,o,n,r);0===l.length&&c.length>0&&this.logger.warn("No items could be mapped to the new profile"),yield this.applyMappedItems(l,c),s.activateProfile(t);const d={profileId:t,action:"applied",itemsAffected:l.length};s.previousProfileId&&(d.previousProfileId=s.previousProfileId),s.addMappingEvent(d),this.eventBus.emit("profile:applied",{profileId:t,previousProfileId:s.previousProfileId,itemsSwapped:l.length,originalItems:c.length,profile:o}),this.logger.info(`Profile "${t}" applied successfully, swapped ${l.length} items`)}finally{this.profileOperationInProgress=!1}}})}mapCartItems(t,e,i,n){return g(this,null,function*(){const r=dt.getState(),s=[];for(const a of t){const t=e.packageMappings[a.packageId];if(void 0!==t)if(n)s.push({originalItem:a,mappedPackageId:t,quantity:i?a.quantity:1});else{const e=r.getPackage(t);if(!e){this.logger.warn(`Mapped package ${t} not found in campaign data, skipping`);continue}s.push({originalItem:a,mappedPackageId:t,quantity:i?a.quantity:1,mappedPackage:e})}else this.logger.debug(`No mapping found for package ${a.packageId} in profile ${e.id}, preserving as-is`),s.push({originalItem:a,mappedPackageId:a.packageId,quantity:i?a.quantity:1,preserveUnmapped:!0})}return s})}applyMappedItems(t,e){return g(this,null,function*(){const e=Tt.getState(),i=[];for(const n of t){const t=!0===n.preserveUnmapped;i.push({packageId:n.mappedPackageId,quantity:n.quantity,isUpsell:n.originalItem.is_upsell||!1,originalPackageId:t?void 0:n.originalItem.packageId}),t?this.logger.debug(`Will preserve unmapped package ${n.mappedPackageId}`):this.logger.debug(`Will add mapped package ${n.mappedPackageId} (was ${n.originalItem.packageId})`)}yield e.swapCart(i),this.logger.info(`Applied ${t.length} items to cart (including preserved items)`)})}revertProfile(){return g(this,null,function*(){const t=mt.getState(),e=Tt.getState(),i=t.activeProfileId;let n=this.initialCartState;if(n&&0!==n.length||(n=t.originalCartSnapshot||null),!n||0===n.length){if(this.logger.warn("No cart state to revert to, attempting to reverse profile mappings"),i&&"default"!==i&&"regular"!==i){const n=e.items;if(n.length>0){const r=n.map(t=>({packageId:t.originalPackageId||t.packageId,quantity:t.quantity,isUpsell:t.is_upsell||!1}));this.logger.info("Attempting to reverse profile mappings for cart items");try{return yield e.swapCart(r),t.deactivateProfile(),this.eventBus.emit("profile:reverted",{previousProfileId:i,itemsRestored:r.length}),void this.logger.info(`Reversed profile mappings for ${r.length} items`)}catch(a){this.logger.error("Failed to reverse profile mappings:",a)}}}return t.deactivateProfile(),void this.eventBus.emit("profile:reverted",{previousProfileId:i,itemsRestored:0})}this.logger.info("Reverting to original cart state"),t.deactivateProfile(),t.clearOriginalCartSnapshot();const r=n.map(t=>({packageId:t.originalPackageId||t.packageId,quantity:t.quantity,isUpsell:t.is_upsell||!1}));let s=0;try{yield e.swapCart(r),s=r.length}catch(a){this.logger.error("Failed to restore cart items:",a),yield e.clear();for(const t of n)try{yield e.addItem({packageId:t.packageId,quantity:t.quantity,isUpsell:t.is_upsell||!1}),s++}catch(o){this.logger.error(`Failed to restore item ${t.packageId}:`,o)}}t.addMappingEvent({profileId:i||"unknown",action:"reverted",itemsAffected:s}),this.eventBus.emit("profile:reverted",{previousProfileId:i,itemsRestored:s}),this.logger.info(`Reverted profile, restored ${s} items`)})}switchProfile(t,e){return g(this,arguments,function*(t,e,i={}){if(t){const e=mt.getState();e.activeProfileId!==t&&this.logger.warn(`Expected active profile "${t}" but found "${e.activeProfileId}"`)}yield this.applyProfile(e,i);const n=mt.getState(),r={profileId:e,action:"switched",itemsAffected:Tt.getState().items.length};t&&(r.previousProfileId=t),n.addMappingEvent(r)})}canApplyProfile(t){return!!mt.getState().getProfileById(t)}getProfileStats(){const t=mt.getState();return{activeProfile:t.activeProfileId,previousProfile:t.previousProfileId,totalProfiles:t.profiles.size,historyLength:t.mappingHistory.length,hasOriginalSnapshot:!!t.originalCartSnapshot}}clearAllProfiles(){return g(this,null,function*(){yield this.revertProfile(),mt.getState().reset(),this.logger.info("All profile data cleared")})}}const ve=Object.freeze(Object.defineProperty({__proto__:null,ProfileManager:ge},Symbol.toStringTag,{value:"Module"}));class ye{constructor(){this.logger=tt("ProfileMapper")}static getInstance(){return ye.instance||(ye.instance=new ye),ye.instance}mapPackageId(t,e){if(!t||t<=0)return t;const i=mt.getState(),n=e?i.getProfileById(e):i.getActiveProfile();if(!n||!n.packageMappings)return t;const r=n.packageMappings[t];return void 0!==r&&r>0?(this.logger.debug(`Mapped package ${t} -> ${r} (profile: ${n.id})`),r):t}mapPackageIds(t,e){return t&&0!==t.length?t.map(t=>this.mapPackageId(t,e)):[]}getOriginalPackageId(t,e){if(!t||t<=0)return null;const i=mt.getState(),n=e?i.getProfileById(e):i.getActiveProfile();if(!n)return null;if(n.reverseMapping&&void 0!==n.reverseMapping[t]){const e=n.reverseMapping[t];return this.logger.debug(`Reverse mapped ${t} -> ${e} (profile: ${n.id})`),e}for(const[r,s]of Object.entries(n.packageMappings))if(s===t){const e=parseInt(r,10);return this.logger.debug(`Reverse mapped ${t} -> ${e} (profile: ${n.id}, linear search)`),e}return null}canMapPackage(t,e){if(!t||t<=0)return!1;const i=mt.getState(),n=e?i.getProfileById(e):i.getActiveProfile();return!(!n||!n.packageMappings)&&t in n.packageMappings}getProfileMappings(t){const e=mt.getState(),i=t?e.getProfileById(t):e.getActiveProfile();return(null==i?void 0:i.packageMappings)||null}hasActiveProfile(){return null!==mt.getState().activeProfileId}getActiveProfileId(){return mt.getState().activeProfileId}mapCartItem(t,e){const i=this.mapPackageId(t.packageId,e);return i!==t.packageId?h(u({},t),{packageId:i,originalPackageId:t.packageId}):t}mapCartItems(t,e){return t.map(t=>this.mapCartItem(t,e))}getMappingStats(t){const e=mt.getState(),i=t?e.getProfileById(t):e.getActiveProfile();return i?{profileId:i.id,totalMappings:Object.keys(i.packageMappings).length,activeMappings:Object.keys(i.packageMappings).filter(t=>void 0!==i.packageMappings[parseInt(t,10)]).length,hasReverseMapping:!!i.reverseMapping}:null}}class be{constructor(t){this.subscriptions=[],this.element=t,this.logger=tt(this.constructor.name),this.eventBus=st.getInstance()}destroy(){this.subscriptions.forEach(t=>t()),this.subscriptions=[],this.cleanupEventListeners()}emit(t,e){this.eventBus.emit(t,e)}on(t,e){this.eventBus.on(t,e)}subscribe(t,e){const i=t.subscribe(e);this.subscriptions.push(i)}getAttribute(t){return this.element.getAttribute(t)}getRequiredAttribute(t){const e=this.getAttribute(t);if(!e)throw new Error(`Required attribute ${t} not found on element`);return e}hasAttribute(t){return this.element.hasAttribute(t)}setAttribute(t,e){this.element.setAttribute(t,e)}removeAttribute(t){this.element.removeAttribute(t)}addClass(t){this.element.classList.add(t)}removeClass(t){this.element.classList.remove(t)}hasClass(t){return this.element.classList.contains(t)}toggleClass(t,e){this.element.classList.toggle(t,e)}updateTextContent(t){this.element.textContent=t}updateInnerHTML(t){this.element.innerHTML=t}cleanupEventListeners(){}validateElement(){if(!this.element)throw new Error("Element is required")}handleError(t,e){const i=t instanceof Error?t.message:String(t);this.logger.error(`Error in ${e}:`,i),this.emit("error:occurred",{message:i,code:"ENHANCER_ERROR",details:{enhancer:this.constructor.name,context:e,element:this.element}})}}class xe extends be{constructor(){super(...arguments),this.clearCart=!1,this.preserveQuantities=!0,this.profileManager=ge.getInstance()}initialize(){return g(this,null,function*(){this.validateElement(),this.profileId=this.getAttribute("data-next-profile")||void 0,this.profileId?(this.clearCart="true"===this.getAttribute("data-next-clear-cart"),this.preserveQuantities="false"!==this.getAttribute("data-next-preserve-quantities"),this.clickHandler=this.handleClick.bind(this),this.element.addEventListener("click",this.clickHandler),this.updateActiveState(),this.eventBus.on("profile:applied",this.updateActiveState.bind(this)),this.eventBus.on("profile:reverted",this.updateActiveState.bind(this)),this.element.classList.add("next-profile-switcher"),this.logger.debug("ProfileSwitcherEnhancer initialized",{profileId:this.profileId,clearCart:this.clearCart,preserveQuantities:this.preserveQuantities})):this.logger.error("Profile ID is required for profile switcher",this.element)})}handleClick(t){return g(this,null,function*(){if(t.preventDefault(),this.profileId)try{if(this.element.classList.add("next-loading"),this.element.setAttribute("aria-busy","true"),mt.getState().activeProfileId===this.profileId)return void this.logger.info(`Profile "${this.profileId}" is already active`);yield this.profileManager.applyProfile(this.profileId,{clearCart:this.clearCart,preserveQuantities:this.preserveQuantities}),this.logger.info(`Profile "${this.profileId}" applied via switcher`),this.eventBus.emit("action:success",{action:"profile-switch",data:{profileId:this.profileId}})}catch(e){this.logger.error(`Failed to apply profile "${this.profileId}":`,e),this.eventBus.emit("action:failed",{action:"profile-switch",error:e})}finally{this.element.classList.remove("next-loading"),this.element.setAttribute("aria-busy","false")}})}updateActiveState(){const t=mt.getState().activeProfileId===this.profileId;this.element.classList.toggle("next-profile-active",t),this.element.setAttribute("aria-pressed",String(t));const e=this.element.getAttribute("data-next-active-text"),i=this.element.getAttribute("data-next-inactive-text");if(e&&i){const n=this.element.querySelector(".next-profile-text")||this.element;n.textContent&&(n.textContent=t?e:i)}}update(t){this.updateActiveState()}destroy(){this.clickHandler&&this.element.removeEventListener("click",this.clickHandler),this.element.classList.remove("next-profile-switcher","next-profile-active","next-loading"),this.element.removeAttribute("aria-pressed"),this.element.removeAttribute("aria-busy"),super.destroy()}}class we extends be{constructor(){super(...arguments),this.profileManager=ge.getInstance(),this.clearCart=!1,this.preserveQuantities=!0}initialize(){return g(this,null,function*(){this.validateElement(),this.element instanceof HTMLSelectElement?(this.selectElement=this.element,this.clearCart="true"===this.getAttribute("data-next-clear-cart"),this.preserveQuantities="false"!==this.getAttribute("data-next-preserve-quantities"),this.changeHandler=this.handleChange.bind(this),this.selectElement.addEventListener("change",this.changeHandler),"true"===this.getAttribute("data-next-auto-populate")&&this.populateOptions(),this.updateSelectedValue(),this.eventBus.on("profile:applied",this.updateSelectedValue.bind(this)),this.eventBus.on("profile:reverted",this.updateSelectedValue.bind(this)),this.element.classList.add("next-profile-selector"),this.logger.debug("ProfileSelectorEnhancer initialized")):this.logger.error("ProfileSelectorEnhancer requires a <select> element",this.element)})}populateOptions(){if(!this.selectElement)return;const t=mt.getState().getAllProfiles();this.selectElement.innerHTML="";const e=document.createElement("option");e.value="",e.textContent="Regular Pricing",this.selectElement.appendChild(e),t.forEach(t=>{const e=document.createElement("option");e.value=t.id,e.textContent=t.name,this.selectElement&&this.selectElement.appendChild(e)})}handleChange(t){return g(this,null,function*(){if(!this.selectElement)return;const t=this.selectElement.value;try{t?(yield this.profileManager.applyProfile(t,{clearCart:this.clearCart,preserveQuantities:this.preserveQuantities}),this.logger.info(`Profile "${t}" applied via selector`)):(yield this.profileManager.revertProfile(),this.logger.info("Profile reverted via selector")),this.eventBus.emit("action:success",{action:"profile-select",data:{profileId:t||"none"}})}catch(e){this.logger.error(`Failed to apply profile "${t}":`,e),this.updateSelectedValue(),this.eventBus.emit("action:failed",{action:"profile-select",error:e})}})}updateSelectedValue(){if(!this.selectElement)return;const t=mt.getState();this.selectElement.value=t.activeProfileId||""}update(t){this.updateSelectedValue()}destroy(){this.changeHandler&&this.selectElement&&this.selectElement.removeEventListener("change",this.changeHandler),this.element.classList.remove("next-profile-selector"),super.destroy()}}const _e=Object.freeze(Object.defineProperty({__proto__:null,ProfileSelectorEnhancer:we,ProfileSwitcherEnhancer:xe},Symbol.toStringTag,{value:"Module"})),ke="undefined"!=typeof window&&window.__NEXT_SDK_VERSION__?window.__NEXT_SDK_VERSION__:"__VERSION__";"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{me.initialize()}):me.initialize(),window.addEventListener("next:ready",()=>{"requestIdleCallback"in window?(requestIdleCallback(()=>{Promise.resolve().then(()=>Bl),Promise.resolve().then(()=>id),Promise.resolve().then(()=>hd),Promise.resolve().then(()=>Wl),Promise.resolve().then(()=>Kl),Promise.resolve().then(()=>pd)},{timeout:5e3}),requestIdleCallback(()=>{Promise.resolve().then(()=>Od),Promise.resolve().then(()=>zd),Promise.resolve().then(()=>Xl),Promise.resolve().then(()=>Kd),Promise.resolve().then(()=>Pe),Promise.resolve().then(()=>jd),Promise.resolve().then(()=>Vd)},{timeout:5e3}),requestIdleCallback(()=>{Promise.resolve().then(()=>Xd),Promise.resolve().then(()=>Qd),Promise.resolve().then(()=>Il),Promise.resolve().then(()=>ve),Promise.resolve().then(()=>_e)},{timeout:5e3})):setTimeout(()=>{Promise.resolve().then(()=>Bl),Promise.resolve().then(()=>Wl),Promise.resolve().then(()=>tp)},1e3)}));const Se=tt("AttributionCollector"),Pe=Object.freeze(Object.defineProperty({__proto__:null,AttributionCollector:class{collect(){return g(this,null,function*(){const t=this.collectMetadata();return{affiliate:this.getStoredValue("affid")||this.getStoredValue("aff")||"",funnel:this.getFunnelName(),gclid:this.getStoredValue("gclid")||"",utm_source:this.getStoredValue("utm_source")||"",utm_medium:this.getStoredValue("utm_medium")||"",utm_campaign:this.getStoredValue("utm_campaign")||"",utm_content:this.getStoredValue("utm_content")||"",utm_term:this.getStoredValue("utm_term")||"",subaffiliate1:this.limitSubaffiliateLength(this.getStoredValue("subaffiliate1")||this.getStoredValue("sub1")),subaffiliate2:this.limitSubaffiliateLength(this.getStoredValue("subaffiliate2")||this.getStoredValue("sub2")),subaffiliate3:this.limitSubaffiliateLength(this.getStoredValue("subaffiliate3")||this.getStoredValue("sub3")),subaffiliate4:this.limitSubaffiliateLength(this.getStoredValue("subaffiliate4")||this.getStoredValue("sub4")),subaffiliate5:this.limitSubaffiliateLength(this.getStoredValue("subaffiliate5")||this.getStoredValue("sub5")),metadata:t,first_visit_timestamp:this.getFirstVisitTimestamp(),current_visit_timestamp:Date.now()}})}collectMetadata(){const t={landing_page:window.location.href,referrer:document.referrer||"",device:navigator.userAgent||"",device_type:this.getDeviceType(),domain:window.location.hostname,timestamp:Date.now(),fb_fbp:this.getCookie("_fbp")||"",fb_fbc:this.getCookie("_fbc")||"",fb_pixel_id:this.getFacebookPixelId()},e=this.getStoredValue("fbclid");e&&(t.fbclid=e);const i=this.getStoredValue("clickid");return i&&(t.clickid=i),this.handleEverflowClickId(t),this.collectTrackingTags(t),t}limitSubaffiliateLength(t){return t?t.length>225?(Se.warn(`Subaffiliate value truncated from ${t.length} to 225 characters`),t.substring(0,225)):t:""}getStoredValue(t){const e=new URLSearchParams(window.location.search);if(e.has(t)){const n=e.get(t)||"";try{sessionStorage.setItem(t,n)}catch(i){}return n}try{const e=sessionStorage.getItem(t);if(e)return e}catch(i){}try{const e=localStorage.getItem(t);if(e)return e}catch(i){}try{const e=localStorage.getItem("next-attribution");if(e){const i=JSON.parse(e);if(i.state&&i.state[t])return i.state[t]}}catch(i){}return""}getCookie(t){var e;const i=`; ${document.cookie}`.split(`; ${t}=`);return 2===i.length&&(null==(e=i.pop())?void 0:e.split(";").shift())||""}getDeviceType(){const t=navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)?"mobile":"desktop"}getFunnelName(){try{const t=sessionStorage.getItem("next_funnel_name");if(t)return Se.debug(`Using persisted funnel from session: ${t}`),t;const e=localStorage.getItem("next_funnel_name");if(e)return Se.debug(`Using persisted funnel from localStorage: ${e}`),sessionStorage.setItem("next_funnel_name",e),e;const i=localStorage.getItem("next-attribution");if(i){const t=JSON.parse(i);if(t.state&&t.state.funnel)return Se.debug(`Using persisted funnel from attribution: ${t.state.funnel}`),sessionStorage.setItem("next_funnel_name",t.state.funnel),localStorage.setItem("next_funnel_name",t.state.funnel),t.state.funnel}}catch(e){}const t=document.querySelector('meta[name="os-tracking-tag"][data-tag-name="funnel_name"], meta[name="data-next-tracking-tag"][data-tag-name="funnel_name"], meta[name="next-funnel"]');if(t){const i=t.getAttribute("data-tag-value")||t.getAttribute("content");if(i){Se.debug(`New funnel found from meta tag: ${i}`);try{sessionStorage.setItem("next_funnel_name",i),localStorage.setItem("next_funnel_name",i),Se.info(`Persisted funnel name: ${i}`)}catch(e){}return i}}return""}handleEverflowClickId(t){const e=new URLSearchParams(window.location.search);let i=localStorage.getItem("evclid");if(e.has("evclid")?(i=e.get("evclid")||"",localStorage.setItem("evclid",i),sessionStorage.setItem("evclid",i),Se.debug(`Everflow click ID found in URL: ${i}`)):!i&&sessionStorage.getItem("evclid")&&(i=sessionStorage.getItem("evclid"),i&&(localStorage.setItem("evclid",i),Se.debug(`Everflow click ID found in sessionStorage: ${i}`))),e.has("sg_evclid")){const i=e.get("sg_evclid")||"";sessionStorage.setItem("sg_evclid",i),localStorage.setItem("sg_evclid",i),t.sg_evclid=i,Se.debug(`SG Everflow click ID found: ${i}`)}else{const e=localStorage.getItem("sg_evclid");e&&(t.sg_evclid=e)}i&&(t.everflow_transaction_id=i,Se.debug(`Added Everflow transaction ID to metadata: ${i}`))}collectTrackingTags(t){const e=document.querySelectorAll('meta[name="os-tracking-tag"], meta[name="data-next-tracking-tag"]');Se.debug(`Found ${e.length} tracking tags`),e.forEach(e=>{const i=e.getAttribute("data-tag-name"),n=e.getAttribute("data-tag-value"),r="true"===e.getAttribute("data-persist");if(i&&n&&(t[i]=n,Se.debug(`Added tracking tag: ${i} = ${n}`),r))try{sessionStorage.setItem(`tn_tag_${i}`,n),Se.debug(`Persisted tracking tag: ${i}`)}catch(s){}})}getFacebookPixelId(){const t=document.querySelector('meta[name="os-facebook-pixel"], meta[name="facebook-pixel-id"]');if(t){const e=t.getAttribute("content");if(e)return Se.debug(`Facebook Pixel ID found from meta tag: ${e}`),e}const e=document.querySelectorAll("script");for(const i of e){const t=i.textContent||"";if(t.includes("fbq(")&&t.includes("init")){const e=t.match(/fbq\s*\(\s*['"]init['"],\s*['"](\d+)['"]/);if(e&&e[1])return Se.debug(`Facebook Pixel ID found from script: ${e[1]}`),e[1]}}return""}getFirstVisitTimestamp(){try{const t=localStorage.getItem("next-attribution");if(t){const e=JSON.parse(t);if(e.state&&e.state.first_visit_timestamp)return e.state.first_visit_timestamp}}catch(t){}return Date.now()}}},Symbol.toStringTag,{value:"Module"}));var Ce=function(t,e){return(Ce=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)};function Ee(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}Ce(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var $e,Te,Ie,Ae,Me=function(){return Me=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Me.apply(this,arguments)};function Le(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(i[n[r]]=t[n[r]])}return i}function De(t,e,i,n){return new(i||(i=Promise))(function(r,s){function a(t){try{c(n.next(t))}catch(e){s(e)}}function o(t){try{c(n.throw(t))}catch(e){s(e)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(a,o)}c((n=n.apply(t,e||[])).next())})}function Fe(t,e){var i,n,r,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(c){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(s=0)),s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(c){o=[6,c],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}function Oe(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ue(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,s=i.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)a.push(n.value)}catch(o){r={error:o}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return a}function Ne(t,e,i){if(i||2===arguments.length)for(var n,r=0,s=e.length;r<s;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))}function ze(t){return this instanceof ze?(this.v=t,this):new ze(t)}"function"==typeof SuppressedError&&SuppressedError,(Te=$e||($e={})).SET="$set",Te.SET_ONCE="$setOnce",Te.ADD="$add",Te.APPEND="$append",Te.PREPEND="$prepend",Te.REMOVE="$remove",Te.PREINSERT="$preInsert",Te.POSTINSERT="$postInsert",Te.UNSET="$unset",Te.CLEAR_ALL="$clearAll",(Ae=Ie||(Ie={})).IDENTIFY="$identify",Ae.GROUP_IDENTIFY="$groupidentify",Ae.REVENUE="revenue_amount";var qe,je="AMP",Re="".concat(je,"_unsent"),He="$default_instance",Ve="https://api2.amplitude.com/2/httpapi",Be="dclid",Je="fbclid",Ge="gbraid",Ke="gclid",Qe="ko_click_id",Ze="li_fat_id",We="msclkid",Ye="rdt_cid",Xe="ttclid",ti="twclid",ei="wbraid",ii={utm_campaign:void 0,utm_content:void 0,utm_id:void 0,utm_medium:void 0,utm_source:void 0,utm_term:void 0,referrer:void 0,referring_domain:void 0,dclid:void 0,gbraid:void 0,gclid:void 0,fbclid:void 0,ko_click_id:void 0,li_fat_id:void 0,msclkid:void 0,rdt_cid:void 0,ttclid:void 0,twclid:void 0,wbraid:void 0},ni=["access-control-allow-origin","access-control-allow-credentials","access-control-expose-headers","access-control-max-age","access-control-allow-methods","access-control-allow-headers","accept-patch","accept-ranges","age","allow","alt-svc","cache-control","connection","content-disposition","content-encoding","content-language","content-length","content-location","content-md5","content-range","content-type","date","delta-base","etag","expires","im","last-modified","link","location","permanent","p3p","pragma","proxy-authenticate","public-key-pins","retry-after","server","status","strict-transport-security","trailer","transfer-encoding","tk","upgrade","vary","via","warning","www-authenticate","x-b3-traceid","x-frame-options"],ri=["authorization","cookie","set-cookie"],si=function(t){if(Object.keys(t).length>1e3)return!1;for(var e in t){var i=t[e];if(!ai(e,i))return!1}return!0},ai=function(t,e){var i,n;if("string"!=typeof t)return!1;if(Array.isArray(e)){var r=!0;try{for(var s=Oe(e),a=s.next();!a.done;a=s.next()){var o=a.value;if(Array.isArray(o))return!1;if("object"==typeof o)r=r&&si(o);else if(!["number","string"].includes(typeof o))return!1;if(!r)return!1}}catch(c){i={error:c}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}}else{if(null==e)return!1;if("object"==typeof e)return si(e);if(!["number","string","boolean"].includes(typeof e))return!1}return!0},oi=function(){function t(){this.R=new Set,this.B={}}return t.prototype.getUserProperties=function(){return Me({},this.B)},t.prototype.set=function(t,e){return this.J(qe.SET,t,e),this},t.prototype.setOnce=function(t,e){return this.J(qe.SET_ONCE,t,e),this},t.prototype.append=function(t,e){return this.J(qe.APPEND,t,e),this},t.prototype.prepend=function(t,e){return this.J(qe.PREPEND,t,e),this},t.prototype.postInsert=function(t,e){return this.J(qe.POSTINSERT,t,e),this},t.prototype.preInsert=function(t,e){return this.J(qe.PREINSERT,t,e),this},t.prototype.remove=function(t,e){return this.J(qe.REMOVE,t,e),this},t.prototype.add=function(t,e){return this.J(qe.ADD,t,e),this},t.prototype.unset=function(t){return this.J(qe.UNSET,t,"-"),this},t.prototype.clearAll=function(){return this.B={},this.B[qe.CLEAR_ALL]="-",this},t.prototype.J=function(t,e,i){if(this.G(t,e,i)){var n=this.B[t];return void 0===n&&(n={},this.B[t]=n),n[e]=i,this.R.add(e),!0}return!1},t.prototype.G=function(t,e,i){return void 0===this.B[qe.CLEAR_ALL]&&!this.R.has(e)&&(t===qe.ADD?"number"==typeof i:t===qe.UNSET||t===qe.REMOVE||ai(e,i))},t}();!function(t){t.SET="$set",t.SET_ONCE="$setOnce",t.ADD="$add",t.APPEND="$append",t.PREPEND="$prepend",t.REMOVE="$remove",t.PREINSERT="$preInsert",t.POSTINSERT="$postInsert",t.UNSET="$unset",t.CLEAR_ALL="$clearAll"}(qe||(qe={}));var ci,li,di=[qe.CLEAR_ALL,qe.UNSET,qe.SET,qe.SET_ONCE,qe.ADD,qe.APPEND,qe.PREPEND,qe.PREINSERT,qe.POSTINSERT,qe.REMOVE];(li=ci||(ci={})).Unknown="unknown",li.Skipped="skipped",li.Success="success",li.RateLimit="rate_limit",li.PayloadTooLarge="payload_too_large",li.Invalid="invalid",li.Failed="failed",li.Timeout="Timeout",li.SystemError="SystemError";var ui,hi,pi=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=ci.Unknown),{event:t,code:e,message:i}},fi=function(){var t="ampIntegrationContext";return"undefined"!=typeof globalThis&&void 0!==globalThis[t]?globalThis[t]:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof globalThis?globalThis:void 0},mi=Ne([],Ue(Array(256).keys()),!1).map(function(t){return t.toString(16).padStart(2,"0")}),gi=function(t){var e,i=fi();if(!(null===(e=null==i?void 0:i.crypto)||void 0===e?void 0:e.getRandomValues))return function(t){return t?(t^16*Math.random()>>t/4).toString(16):(String(1e7)+String(-1e3)+String(-4e3)+String(-8e3)+String(-1e11)).replace(/[018]/g,gi)}(t);var n=i.crypto.getRandomValues(new Uint8Array(16));return n[6]=15&n[6]|64,n[8]=63&n[8]|128,Ne([],Ue(n.entries()),!1).map(function(t){var e=Ue(t,2),i=e[0],n=e[1];return[4,6,8,10].includes(i)?"-".concat(mi[n]):mi[n]}).join("")},vi=function(){function t(t){this.client=t,this.queue=[],this.applying=!1,this.plugins=[]}return t.prototype.register=function(t,e){var i,n;return De(this,void 0,void 0,function(){return Fe(this,function(r){switch(r.label){case 0:return this.plugins.some(function(e){return e.name===t.name})?(this.loggerProvider.warn("Plugin with name ".concat(t.name," already exists, skipping registration")),[2]):(void 0===t.name&&(t.name=gi(),this.loggerProvider.warn("Plugin name is undefined. \n      Generating a random UUID for plugin name: ".concat(t.name,". \n      Set a name for the plugin to prevent it from being added multiple times."))),t.type=null!==(i=t.type)&&void 0!==i?i:"enrichment",[4,null===(n=t.setup)||void 0===n?void 0:n.call(t,e,this.client)]);case 1:return r.sent(),this.plugins.push(t),[2]}})})},t.prototype.deregister=function(t,e){var i;return De(this,void 0,void 0,function(){var n,r;return Fe(this,function(s){switch(s.label){case 0:return-1===(n=this.plugins.findIndex(function(e){return e.name===t}))?(e.loggerProvider.warn("Plugin with name ".concat(t," does not exist, skipping deregistration")),[2]):(r=this.plugins[n],this.plugins.splice(n,1),[4,null===(i=r.teardown)||void 0===i?void 0:i.call(r)]);case 1:return s.sent(),[2]}})})},t.prototype.reset=function(t){this.applying=!1,this.plugins.map(function(t){var e;return null===(e=t.teardown)||void 0===e?void 0:e.call(t)}),this.plugins=[],this.client=t},t.prototype.push=function(t){var e=this;return new Promise(function(i){e.queue.push([t,i]),e.scheduleApply(0)})},t.prototype.scheduleApply=function(t){var e=this;this.applying||(this.applying=!0,setTimeout(function(){e.apply(e.queue.shift()).then(function(){e.applying=!1,e.queue.length>0&&e.scheduleApply(0)})},t))},t.prototype.apply=function(t){return De(this,void 0,void 0,function(){var e,i,n,r,s,a,o,c,l,d,u,h,p,f,m,g,v,y,b,x;return Fe(this,function(w){switch(w.label){case 0:if(!t)return[2];e=Ue(t,1),i=e[0],n=Ue(t,2),r=n[1],this.loggerProvider.log("Timeline.apply: Initial event",i),s=this.plugins.filter(function(t){return"before"===t.type}),w.label=1;case 1:w.trys.push([1,6,7,8]),a=Oe(s),o=a.next(),w.label=2;case 2:return o.done?[3,5]:(h=o.value).execute?[4,h.execute(Me({},i))]:[3,4];case 3:if(null===(p=w.sent()))return this.loggerProvider.log("Timeline.apply: Event filtered out by before plugin '".concat(String(h.name),"', event: ").concat(JSON.stringify(i))),r({event:i,code:0,message:""}),[2];i=p,this.loggerProvider.log("Timeline.apply: Event after before plugin '".concat(String(h.name),"', event: ").concat(JSON.stringify(i))),w.label=4;case 4:return o=a.next(),[3,2];case 5:return[3,8];case 6:return c=w.sent(),v={error:c},[3,8];case 7:try{o&&!o.done&&(y=a.return)&&y.call(a)}finally{if(v)throw v.error}return[7];case 8:l=this.plugins.filter(function(t){return"enrichment"===t.type||void 0===t.type}),w.label=9;case 9:w.trys.push([9,14,15,16]),d=Oe(l),u=d.next(),w.label=10;case 10:return u.done?[3,13]:(h=u.value).execute?[4,h.execute(Me({},i))]:[3,12];case 11:if(null===(p=w.sent()))return this.loggerProvider.log("Timeline.apply: Event filtered out by enrichment plugin '".concat(String(h.name),"', event: ").concat(JSON.stringify(i))),r({event:i,code:0,message:""}),[2];i=p,this.loggerProvider.log("Timeline.apply: Event after enrichment plugin '".concat(String(h.name),"', event: ").concat(JSON.stringify(i))),w.label=12;case 12:return u=d.next(),[3,10];case 13:return[3,16];case 14:return f=w.sent(),b={error:f},[3,16];case 15:try{u&&!u.done&&(x=d.return)&&x.call(d)}finally{if(b)throw b.error}return[7];case 16:return m=this.plugins.filter(function(t){return"destination"===t.type}),this.loggerProvider.log("Timeline.apply: Final event before destinations, event: ".concat(JSON.stringify(i))),g=m.map(function(t){var e=Me({},i);return t.execute(e).catch(function(t){return pi(e,0,String(t))})}),Promise.all(g).then(function(t){var e=Ue(t,1)[0]||pi(i,100,"Event not tracked, no destination plugins on the instance");r(e)}),[2]}})})},t.prototype.flush=function(){return De(this,void 0,void 0,function(){var t,e,i,n=this;return Fe(this,function(r){switch(r.label){case 0:return t=this.queue,this.queue=[],[4,Promise.all(t.map(function(t){return n.apply(t)}))];case 1:return r.sent(),e=this.plugins.filter(function(t){return"destination"===t.type}),i=e.map(function(t){return t.flush&&t.flush()}),[4,Promise.all(i)];case 2:return r.sent(),[2]}})})},t.prototype.onIdentityChanged=function(t){this.plugins.forEach(function(e){var i;null===(i=e.onIdentityChanged)||void 0===i||i.call(e,t)})},t.prototype.onSessionIdChanged=function(t){this.plugins.forEach(function(e){var i;null===(i=e.onSessionIdChanged)||void 0===i||i.call(e,t)})},t.prototype.onOptOutChanged=function(t){this.plugins.forEach(function(e){var i;null===(i=e.onOptOutChanged)||void 0===i||i.call(e,t)})},t}(),yi=function(t,e){return Me(Me({},e),{event_type:Ie.IDENTIFY,user_properties:t.getUserProperties()})},bi=function(t){return{promise:t||Promise.resolve()}},xi=function(){function t(t){void 0===t&&(t="$default"),this.initializing=!1,this.isReady=!1,this.q=[],this.dispatchQ=[],this.logEvent=this.track.bind(this),this.timeline=new vi(this),this.name=t}return t.prototype.k=function(t){return De(this,void 0,void 0,function(){return Fe(this,function(e){switch(e.label){case 0:return this.config=t,this.timeline.reset(this),this.timeline.loggerProvider=this.config.loggerProvider,[4,this.runQueuedFunctions("q")];case 1:return e.sent(),this.isReady=!0,[2]}})})},t.prototype.runQueuedFunctions=function(t){return De(this,void 0,void 0,function(){var e,i,n,r,s,a,o,c;return Fe(this,function(l){switch(l.label){case 0:e=this[t],this[t]=[],l.label=1;case 1:l.trys.push([1,8,9,10]),i=Oe(e),n=i.next(),l.label=2;case 2:return n.done?[3,7]:(r=n.value,(s=r())&&"promise"in s?[4,s.promise]:[3,4]);case 3:return l.sent(),[3,6];case 4:return[4,s];case 5:l.sent(),l.label=6;case 6:return n=i.next(),[3,2];case 7:return[3,10];case 8:return a=l.sent(),o={error:a},[3,10];case 9:try{n&&!n.done&&(c=i.return)&&c.call(i)}finally{if(o)throw o.error}return[7];case 10:return this[t].length?[4,this.runQueuedFunctions(t)]:[3,12];case 11:l.sent(),l.label=12;case 12:return[2]}})})},t.prototype.track=function(t,e,i){var n=function(t,e,i){return Me(Me(Me({},"string"==typeof t?{event_type:t}:t),i),e&&{event_properties:e})}(t,e,i);return bi(this.dispatch(n))},t.prototype.identify=function(t,e){var i=yi(t,e);return bi(this.dispatch(i))},t.prototype.groupIdentify=function(t,e,i,n){var r=function(t,e,i,n){var r;return Me(Me({},n),{event_type:Ie.GROUP_IDENTIFY,group_properties:i.getUserProperties(),groups:(r={},r[t]=e,r)})}(t,e,i,n);return bi(this.dispatch(r))},t.prototype.setGroup=function(t,e,i){var n=function(t,e,i){var n,r=new oi;return r.set(t,e),Me(Me({},i),{event_type:Ie.IDENTIFY,user_properties:r.getUserProperties(),groups:(n={},n[t]=e,n)})}(t,e,i);return bi(this.dispatch(n))},t.prototype.revenue=function(t,e){var i=function(t,e){return Me(Me({},e),{event_type:Ie.REVENUE,event_properties:t.getEventProperties()})}(t,e);return bi(this.dispatch(i))},t.prototype.add=function(t){return this.isReady?this.K(t):(this.q.push(this.K.bind(this,t)),bi())},t.prototype.K=function(t){return bi(this.timeline.register(t,this.config))},t.prototype.remove=function(t){return this.isReady?this.Z(t):(this.q.push(this.Z.bind(this,t)),bi())},t.prototype.Z=function(t){return bi(this.timeline.deregister(t,this.config))},t.prototype.dispatchWithCallback=function(t,e){if(!this.isReady)return e(pi(t,0,"Client not initialized"));this.process(t).then(e)},t.prototype.dispatch=function(t){return De(this,void 0,void 0,function(){var e=this;return Fe(this,function(i){return this.isReady?[2,this.process(t)]:[2,new Promise(function(i){e.dispatchQ.push(e.dispatchWithCallback.bind(e,t,i))})]})})},t.prototype.getOperationAppliedUserProperties=function(t){var e={};if(void 0===t)return e;var i={};return Object.keys(t).forEach(function(e){Object.values($e).includes(e)||(i[e]=t[e])}),di.forEach(function(i){if(Object.keys(t).includes(i)){var n=t[i];switch(i){case $e.CLEAR_ALL:Object.keys(e).forEach(function(t){delete e[t]});break;case $e.UNSET:Object.keys(n).forEach(function(t){delete e[t]});break;case $e.SET:Object.assign(e,n)}}}),Object.assign(e,i),e},t.prototype.process=function(t){return De(this,void 0,void 0,function(){var e,i,n,r;return Fe(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),this.config.optOut?[2,pi(t,0,"Event skipped due to optOut config")]:(t.event_type===Ie.IDENTIFY&&(e=this.getOperationAppliedUserProperties(t.user_properties),this.timeline.onIdentityChanged({userProperties:e})),[4,this.timeline.push(t)]);case 1:return 200===(r=s.sent()).code?this.config.loggerProvider.log(r.message):100===r.code?this.config.loggerProvider.warn(r.message):this.config.loggerProvider.error(r.message),[2,r];case 2:return i=s.sent(),n=String(i),this.config.loggerProvider.error(n),[2,r=pi(t,0,n)];case 3:return[2]}})})},t.prototype.setOptOut=function(t){this.isReady?this.W(t):this.q.push(this.W.bind(this,Boolean(t)))},t.prototype.W=function(t){this.config.optOut!==t&&(this.timeline.onOptOutChanged(t),this.config.optOut=Boolean(t))},t.prototype.flush=function(){return bi(this.timeline.flush())},t.prototype.plugin=function(t){var e=this.timeline.plugins.find(function(e){return e.name===t});if(void 0!==e)return e;this.config.loggerProvider.debug("Cannot find plugin with name ".concat(t))},t.prototype.plugins=function(t){return this.timeline.plugins.filter(function(e){return e instanceof t})},t}(),wi=function(){function t(t,e){this.key="AMP_remote_config_".concat(t.substring(0,10)),this.logger=e}return t.prototype.fetchConfig=function(){var t=null,e={remoteConfig:null,lastFetch:new Date};try{t=localStorage.getItem(this.key)}catch(n){return this.logger.debug("Remote config localstorage failed to access: ",n),Promise.resolve(e)}if(null===t)return this.logger.debug("Remote config localstorage gets null because the key does not exist"),Promise.resolve(e);try{var i=JSON.parse(t);return this.logger.debug("Remote config localstorage parsed successfully: ".concat(JSON.stringify(i))),Promise.resolve({remoteConfig:i.remoteConfig,lastFetch:new Date(i.lastFetch)})}catch(n){return this.logger.debug("Remote config localstorage failed to parse: ",n),localStorage.removeItem(this.key),Promise.resolve(e)}},t.prototype.setConfig=function(t){try{return localStorage.setItem(this.key,JSON.stringify(t)),this.logger.debug("Remote config localstorage set successfully."),Promise.resolve(!0)}catch(e){this.logger.debug("Remote config localstorage failed to set: ",e)}return Promise.resolve(!1)},t}(),_i=function(){function t(t,e,i){void 0===i&&(i="US"),this.callbackInfos=[],this.apiKey=t,this.serverUrl="US"===i?"https://sr-client-cfg.amplitude.com/config":"https://sr-client-cfg.eu.amplitude.com/config",this.logger=e,this.storage=new wi(t,e)}return t.prototype.subscribe=function(t,e,i){var n=gi(),r={id:n,key:t,deliveryMode:e,callback:i};return this.callbackInfos.push(r),"all"===e?this.subscribeAll(r):this.subscribeWaitForRemote(r,e.timeout),n},t.prototype.unsubscribe=function(t){var e=this.callbackInfos.findIndex(function(e){return e.id===t});return-1===e?(this.logger.debug("Remote config client unsubscribe failed because callback with id ".concat(t," doesn't exist.")),!1):(this.callbackInfos.splice(e,1),this.logger.debug("Remote config client unsubscribe succeeded removing callback with id ".concat(t,".")),!0)},t.prototype.updateConfigs=function(){return De(this,void 0,void 0,function(){var t,e=this;return Fe(this,function(i){switch(i.label){case 0:return[4,this.fetch()];case 1:return t=i.sent(),this.storage.setConfig(t),this.callbackInfos.forEach(function(i){e.sendCallback(i,t,"remote")}),[2]}})})},t.prototype.subscribeAll=function(t){return De(this,void 0,void 0,function(){var e,i,n,r=this;return Fe(this,function(s){switch(s.label){case 0:return e=this.fetch().then(function(e){r.logger.debug("Remote config client subscription all mode fetched from remote: ".concat(JSON.stringify(e))),r.sendCallback(t,e,"remote"),r.storage.setConfig(e)}),i=this.storage.fetchConfig().then(function(t){return t}),[4,Promise.race([e,i])];case 1:return void 0!==(n=s.sent())&&(this.logger.debug("Remote config client subscription all mode fetched from cache: ".concat(JSON.stringify(n))),this.sendCallback(t,n,"cache")),[4,e];case 2:return s.sent(),[2]}})})},t.prototype.subscribeWaitForRemote=function(t,e){return De(this,void 0,void 0,function(){var i,n;return Fe(this,function(r){switch(r.label){case 0:i=new Promise(function(t,i){setTimeout(function(){i("Timeout exceeded")},e)}),r.label=1;case 1:return r.trys.push([1,3,,5]),[4,Promise.race([this.fetch(),i])];case 2:return n=r.sent(),this.logger.debug("Remote config client subscription wait for remote mode returns from remote."),this.sendCallback(t,n,"remote"),this.storage.setConfig(n),[3,5];case 3:return r.sent(),this.logger.debug("Remote config client subscription wait for remote mode exceeded timeout. Try to fetch from cache."),[4,this.storage.fetchConfig()];case 4:return null!==(n=r.sent()).remoteConfig?(this.logger.debug("Remote config client subscription wait for remote mode returns a cached copy."),this.sendCallback(t,n,"cache")):(this.logger.debug("Remote config client subscription wait for remote mode failed to fetch cache."),this.sendCallback(t,n,"remote")),[3,5];case 5:return[2]}})})},t.prototype.sendCallback=function(t,e,i){var n;t.lastCallback=new Date,n=t.key?t.key.split(".").reduce(function(t,e){return null===t?t:e in t?t[e]:null},e.remoteConfig):e.remoteConfig,t.callback(n,i,e.lastFetch)},t.prototype.fetch=function(t,e){return void 0===t&&(t=3),void 0===e&&(e=1e3),De(this,void 0,void 0,function(){var i,n,r,s,a,o,c=this;return Fe(this,function(l){switch(l.label){case 0:i=e/t,n={remoteConfig:null,lastFetch:new Date},r=function(n){var r,a,o,l,d;return Fe(this,function(u){switch(u.label){case 0:r=new AbortController,a=setTimeout(function(){return r.abort()},e),u.label=1;case 1:return u.trys.push([1,7,8,9]),[4,fetch(s.getUrlParams(),{method:"GET",headers:{Accept:"*/*"},signal:r.signal})];case 2:return(o=u.sent()).ok?[3,4]:[4,o.text()];case 3:return l=u.sent(),s.logger.debug("Remote config client fetch with retry time ".concat(t," failed with ").concat(o.status,": ").concat(l)),[3,6];case 4:return[4,o.json()];case 5:return[2,{value:{remoteConfig:u.sent(),lastFetch:new Date}}];case 6:return[3,9];case 7:return(d=u.sent())instanceof Error&&"AbortError"===d.name?s.logger.debug("Remote config client fetch with retry time ".concat(t," timed out after ").concat(e,"ms")):s.logger.debug("Remote config client fetch with retry time ".concat(t," is rejected because: "),d),[3,9];case 8:return clearTimeout(a),[7];case 9:return n<t-1?[4,new Promise(function(t){return setTimeout(t,c.getJitterDelay(i))})]:[3,11];case 10:u.sent(),u.label=11;case 11:return[2]}})},s=this,a=0,l.label=1;case 1:return a<t?[5,r(a)]:[3,4];case 2:if("object"==typeof(o=l.sent()))return[2,o.value];l.label=3;case 3:return a++,[3,1];case 4:return[2,n]}})})},t.prototype.getJitterDelay=function(t){return Math.floor(Math.random()*t)},t.prototype.getUrlParams=function(){var e=encodeURIComponent(this.apiKey),i=new URLSearchParams;return i.append("config_group",t.CONFIG_GROUP),"".concat(this.serverUrl,"/").concat(e,"?").concat(i.toString())},t.CONFIG_GROUP="browser",t}();(hi=ui||(ui={}))[hi.None=0]="None",hi[hi.Error=1]="Error",hi[hi.Warn=2]="Warn",hi[hi.Verbose=3]="Verbose",hi[hi.Debug=4]="Debug";var ki,Si,Pi=function(){function t(){this.logLevel=ui.None}return t.prototype.disable=function(){this.logLevel=ui.None},t.prototype.enable=function(t){void 0===t&&(t=ui.Warn),this.logLevel=t},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.logLevel,ui.Verbose},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.logLevel,ui.Warn},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.logLevel,ui.Error},t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.logLevel,ui.Debug},t}(),Ci=function(){function t(){this.productId="",this.quantity=1,this.price=0}return t.prototype.setProductId=function(t){return this.productId=t,this},t.prototype.setQuantity=function(t){return t>0&&(this.quantity=t),this},t.prototype.setPrice=function(t){return this.price=t,this},t.prototype.setRevenueType=function(t){return this.revenueType=t,this},t.prototype.setCurrency=function(t){return this.currency=t,this},t.prototype.setRevenue=function(t){return this.revenue=t,this},t.prototype.setReceipt=function(t){return this.receipt=t,this},t.prototype.setReceiptSig=function(t){return this.receiptSig=t,this},t.prototype.setEventProperties=function(t){return si(t)&&(this.properties=t),this},t.prototype.getEventProperties=function(){var t=this.properties?Me({},this.properties):{};return t[ki.REVENUE_PRODUCT_ID]=this.productId,t[ki.REVENUE_QUANTITY]=this.quantity,t[ki.REVENUE_PRICE]=this.price,t[ki.REVENUE_TYPE]=this.revenueType,t[ki.REVENUE_CURRENCY]=this.currency,t[ki.REVENUE]=this.revenue,t[ki.RECEIPT]=this.receipt,t[ki.RECEIPT_SIG]=this.receiptSig,t},t}();(Si=ki||(ki={})).REVENUE_PRODUCT_ID="$productId",Si.REVENUE_QUANTITY="$quantity",Si.REVENUE_PRICE="$price",Si.REVENUE_TYPE="$revenueType",Si.REVENUE_CURRENCY="$currency",Si.REVENUE="$revenue",Si.RECEIPT="$receipt",Si.RECEIPT_SIG="$receiptSig";var Ei=function(){return{flushMaxRetries:12,flushQueueSize:200,flushIntervalMillis:1e4,instanceName:He,logLevel:ui.Warn,loggerProvider:new Pi,offline:!1,optOut:!1,serverUrl:Ve,serverZone:"US",useBatch:!1}},$i=function(){function t(t){var e,i,n,r;this.tt=!1;var s=Ei();this.apiKey=t.apiKey,this.flushIntervalMillis=null!==(e=t.flushIntervalMillis)&&void 0!==e?e:s.flushIntervalMillis,this.flushMaxRetries=t.flushMaxRetries||s.flushMaxRetries,this.flushQueueSize=t.flushQueueSize||s.flushQueueSize,this.instanceName=t.instanceName||s.instanceName,this.loggerProvider=t.loggerProvider||s.loggerProvider,this.logLevel=null!==(i=t.logLevel)&&void 0!==i?i:s.logLevel,this.minIdLength=t.minIdLength,this.plan=t.plan,this.ingestionMetadata=t.ingestionMetadata,this.offline=void 0!==t.offline?t.offline:s.offline,this.optOut=null!==(n=t.optOut)&&void 0!==n?n:s.optOut,this.serverUrl=t.serverUrl,this.serverZone=t.serverZone||s.serverZone,this.storageProvider=t.storageProvider,this.transportProvider=t.transportProvider,this.useBatch=null!==(r=t.useBatch)&&void 0!==r?r:s.useBatch,this.loggerProvider.enable(this.logLevel);var a=Ii(t.serverUrl,t.serverZone,t.useBatch);this.serverZone=a.serverZone,this.serverUrl=a.serverUrl}return Object.defineProperty(t.prototype,"optOut",{get:function(){return this.tt},set:function(t){this.tt=t},enumerable:!1,configurable:!0}),t}(),Ti=function(t,e){return"EU"===t?e?"https://api.eu.amplitude.com/batch":"https://api.eu.amplitude.com/2/httpapi":e?"https://api2.amplitude.com/batch":Ve},Ii=function(t,e,i){if(void 0===t&&(t=""),void 0===e&&(e=Ei().serverZone),void 0===i&&(i=Ei().useBatch),t)return{serverUrl:t,serverZone:void 0};var n=["US","EU"].includes(e)?e:Ei().serverZone;return{serverZone:n,serverUrl:Ti(n,i)}},Ai=function(){function t(){this.sdk={metrics:{histogram:{}}}}return t.prototype.recordHistogram=function(t,e){this.sdk.metrics.histogram[t]=e},t}();function Mi(t){var e="";try{"body"in t&&(e=JSON.stringify(t.body,null,2))}catch(i){}return e}var Li=function(){function t(){this.name="amplitude",this.type="destination",this.retryTimeout=1e3,this.throttleTimeout=3e4,this.storageKey="",this.scheduleId=null,this.scheduledTimeout=0,this.flushId=null,this.queue=[]}return t.prototype.setup=function(t){var e;return De(this,void 0,void 0,function(){var i,n=this;return Fe(this,function(r){switch(r.label){case 0:return this.config=t,this.storageKey="".concat(Re,"_").concat(this.config.apiKey.substring(0,10)),[4,null===(e=this.config.storageProvider)||void 0===e?void 0:e.get(this.storageKey)];case 1:return(i=r.sent())&&i.length>0&&Promise.all(i.map(function(t){return n.execute(t)})).catch(),[2,Promise.resolve(void 0)]}})})},t.prototype.execute=function(t){var e=this;return t.insert_id||(t.insert_id=gi()),new Promise(function(i){var n={event:t,attempts:0,callback:function(t){return i(t)},timeout:0};e.queue.push(n),e.schedule(e.config.flushIntervalMillis),e.saveEvents()})},t.prototype.removeEventsExceedFlushMaxRetries=function(t){var e=this;return t.filter(function(t){return t.attempts+=1,t.attempts<e.config.flushMaxRetries||(e.fulfillRequest([t],500,"Event rejected due to exceeded retry count"),!1)})},t.prototype.scheduleEvents=function(t){var e=this;t.forEach(function(t){e.schedule(0===t.timeout?e.config.flushIntervalMillis:t.timeout)})},t.prototype.schedule=function(t){var e=this;if(!this.config.offline)return null===this.scheduleId||this.scheduleId&&t>this.scheduledTimeout?(this.scheduleId&&clearTimeout(this.scheduleId),this.scheduledTimeout=t,void(this.scheduleId=setTimeout(function(){e.queue=e.queue.map(function(t){return t.timeout=0,t}),e.flush(!0)},t))):void 0},t.prototype.resetSchedule=function(){this.scheduleId=null,this.scheduledTimeout=0},t.prototype.flush=function(t){return void 0===t&&(t=!1),De(this,void 0,void 0,function(){var e,i,n=this;return Fe(this,function(r){switch(r.label){case 0:return this.config.offline?(this.resetSchedule(),this.config.loggerProvider.debug("Skipping flush while offline."),[2]):this.flushId?(this.resetSchedule(),this.config.loggerProvider.debug("Skipping flush because previous flush has not resolved."),[2]):(this.flushId=this.scheduleId,this.resetSchedule(),e=[],i=[],this.queue.forEach(function(t){return 0===t.timeout?e.push(t):i.push(t)}),s=e,a=this.config.flushQueueSize,o=Math.max(a,1),[4,s.reduce(function(t,e,i){var n=Math.floor(i/o);return t[n]||(t[n]=[]),t[n].push(e),t},[]).reduce(function(e,i){return De(n,void 0,void 0,function(){return Fe(this,function(n){switch(n.label){case 0:return[4,e];case 1:return n.sent(),[4,this.send(i,t)];case 2:return[2,n.sent()]}})})},Promise.resolve())]);case 1:return r.sent(),this.flushId=null,this.scheduleEvents(this.queue),[2]}var s,a,o})})},t.prototype.send=function(t,e){return void 0===e&&(e=!0),De(this,void 0,void 0,function(){var i,n,r,s,a;return Fe(this,function(o){switch(o.label){case 0:if(!this.config.apiKey)return[2,this.fulfillRequest(t,400,"Event rejected due to missing API key")];i={api_key:this.config.apiKey,events:t.map(function(t){var e=t.event;return e.extra,Le(e,["extra"])}),options:{min_id_length:this.config.minIdLength},client_upload_time:(new Date).toISOString(),request_metadata:this.config.requestMetadata},this.config.requestMetadata=new Ai,o.label=1;case 1:return o.trys.push([1,3,,4]),n=Ii(this.config.serverUrl,this.config.serverZone,this.config.useBatch).serverUrl,[4,this.config.transportProvider.send(n,i)];case 2:return null===(r=o.sent())?(this.fulfillRequest(t,0,"Unexpected error occurred"),[2]):e?(this.handleResponse(r,t),[3,4]):("body"in r?this.fulfillRequest(t,r.statusCode,"".concat(r.status,": ").concat(Mi(r))):this.fulfillRequest(t,r.statusCode,r.status),[2]);case 3:return s=o.sent(),a=(c=s)instanceof Error?c.message:String(c),this.config.loggerProvider.error(a),this.handleResponse({status:ci.Failed,statusCode:0},t),[3,4];case 4:return[2]}var c})})},t.prototype.handleResponse=function(t,e){var i=t.status;switch(i){case ci.Success:this.handleSuccessResponse(t,e);break;case ci.Invalid:this.handleInvalidResponse(t,e);break;case ci.PayloadTooLarge:this.handlePayloadTooLargeResponse(t,e);break;case ci.RateLimit:this.handleRateLimitResponse(t,e);break;default:this.config.loggerProvider.warn("{code: 0, error: \"Status '".concat(i,"' provided for ").concat(e.length,' events"}')),this.handleOtherResponse(e)}},t.prototype.handleSuccessResponse=function(t,e){this.fulfillRequest(e,t.statusCode,"Event tracked successfully")},t.prototype.handleInvalidResponse=function(t,e){var i=this;if(t.body.missingField||t.body.error.startsWith("Invalid API key"))this.fulfillRequest(e,t.statusCode,t.body.error);else{var n=Ne(Ne(Ne(Ne([],Ue(Object.values(t.body.eventsWithInvalidFields)),!1),Ue(Object.values(t.body.eventsWithMissingFields)),!1),Ue(Object.values(t.body.eventsWithInvalidIdLengths)),!1),Ue(t.body.silencedEvents),!1).flat(),r=new Set(n),s=e.filter(function(e,n){if(!r.has(n))return!0;i.fulfillRequest([e],t.statusCode,t.body.error)});s.length>0&&this.config.loggerProvider.warn(Mi(t));var a=this.removeEventsExceedFlushMaxRetries(s);this.scheduleEvents(a)}},t.prototype.handlePayloadTooLargeResponse=function(t,e){if(1!==e.length){this.config.loggerProvider.warn(Mi(t)),this.config.flushQueueSize/=2;var i=this.removeEventsExceedFlushMaxRetries(e);this.scheduleEvents(i)}else this.fulfillRequest(e,t.statusCode,t.body.error)},t.prototype.handleRateLimitResponse=function(t,e){var i=this,n=Object.keys(t.body.exceededDailyQuotaUsers),r=Object.keys(t.body.exceededDailyQuotaDevices),s=t.body.throttledEvents,a=new Set(n),o=new Set(r),c=new Set(s),l=e.filter(function(e,n){if(!(e.event.user_id&&a.has(e.event.user_id)||e.event.device_id&&o.has(e.event.device_id)))return c.has(n)&&(e.timeout=i.throttleTimeout),!0;i.fulfillRequest([e],t.statusCode,t.body.error)});l.length>0&&this.config.loggerProvider.warn(Mi(t));var d=this.removeEventsExceedFlushMaxRetries(l);this.scheduleEvents(d)},t.prototype.handleOtherResponse=function(t){var e=this,i=t.map(function(t){return t.timeout=t.attempts*e.retryTimeout,t}),n=this.removeEventsExceedFlushMaxRetries(i);this.scheduleEvents(n)},t.prototype.fulfillRequest=function(t,e,i){this.removeEvents(t),t.forEach(function(t){return t.callback(pi(t.event,e,i))})},t.prototype.saveEvents=function(){if(this.config.storageProvider){var t=this.queue.map(function(t){return t.event});this.config.storageProvider.set(this.storageKey,t)}},t.prototype.removeEvents=function(t){this.queue=this.queue.filter(function(e){return!t.some(function(t){return t.event.insert_id===e.event.insert_id})}),this.saveEvents()},t}(),Di=function(){function t(){}return t.prototype.getApplicationContext=function(){return{versionName:this.versionName,language:Fi(),platform:"Web",os:void 0,deviceModel:void 0}},t}(),Fi=function(){return"undefined"!=typeof navigator&&(navigator.languages&&navigator.languages[0]||navigator.language)||""},Oi=function(){function t(){this.queue=[]}return t.prototype.logEvent=function(t){this.receiver?this.receiver(t):this.queue.length<512&&this.queue.push(t)},t.prototype.setEventReceiver=function(t){this.receiver=t,this.queue.length>0&&(this.queue.forEach(function(e){t(e)}),this.queue=[])},t}(),Ui=function(){return Ui=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Ui.apply(this,arguments)};function Ni(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function zi(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,s=i.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)a.push(n.value)}catch(o){r={error:o}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return a}"function"==typeof SuppressedError&&SuppressedError;var qi=function(t,e){var i,n,r=typeof t;if(r!==typeof e)return!1;try{for(var s=Ni(["string","number","boolean","undefined"]),a=s.next();!a.done;a=s.next())if(a.value===r)return t===e}catch(p){i={error:p}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}if(null==t&&null==e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;var o=Array.isArray(t),c=Array.isArray(e);if(o!==c)return!1;if(!o||!c){var l=Object.keys(t).sort(),d=Object.keys(e).sort();if(!qi(l,d))return!1;var u=!0;return Object.keys(t).forEach(function(i){qi(t[i],e[i])||(u=!1)}),u}for(var h=0;h<t.length;h++)if(!qi(t[h],e[h]))return!1;return!0};Object.entries||(Object.entries=function(t){for(var e=Object.keys(t),i=e.length,n=new Array(i);i--;)n[i]=[e[i],t[e[i]]];return n});var ji,Ri,Hi=function(){function t(){this.identity={userProperties:{}},this.listeners=new Set}return t.prototype.editIdentity=function(){var t=this,e=Ui({},this.identity.userProperties),i=Ui(Ui({},this.identity),{userProperties:e});return{setUserId:function(t){return i.userId=t,this},setDeviceId:function(t){return i.deviceId=t,this},setUserProperties:function(t){return i.userProperties=t,this},setOptOut:function(t){return i.optOut=t,this},updateUserProperties:function(t){var e,n,r,s,a,o,c=i.userProperties||{};try{for(var l=Ni(Object.entries(t)),d=l.next();!d.done;d=l.next()){var u=zi(d.value,2),h=u[0],p=u[1];switch(h){case"$set":try{for(var f=(r=void 0,Ni(Object.entries(p))),m=f.next();!m.done;m=f.next()){var g=zi(m.value,2),v=g[0],y=g[1];c[v]=y}}catch(w){r={error:w}}finally{try{m&&!m.done&&(s=f.return)&&s.call(f)}finally{if(r)throw r.error}}break;case"$unset":try{for(var b=(a=void 0,Ni(Object.keys(p))),x=b.next();!x.done;x=b.next())delete c[v=x.value]}catch(_){a={error:_}}finally{try{x&&!x.done&&(o=b.return)&&o.call(b)}finally{if(a)throw a.error}}break;case"$clearAll":c={}}}}catch(k){e={error:k}}finally{try{d&&!d.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}return i.userProperties=c,this},commit:function(){return t.setIdentity(i),this}}},t.prototype.getIdentity=function(){return Ui({},this.identity)},t.prototype.setIdentity=function(t){var e=Ui({},this.identity);this.identity=Ui({},t),qi(e,this.identity)||this.listeners.forEach(function(e){e(t)})},t.prototype.addIdentityListener=function(t){this.listeners.add(t)},t.prototype.removeIdentityListener=function(t){this.listeners.delete(t)},t}(),Vi="undefined"!=typeof globalThis||"undefined"!=typeof globalThis?globalThis:self,Bi=function(){function t(){this.identityStore=new Hi,this.eventBridge=new Oi,this.applicationContextProvider=new Di}return t.getInstance=function(e){return Vi.analyticsConnectorInstances||(Vi.analyticsConnectorInstances={}),Vi.analyticsConnectorInstances[e]||(Vi.analyticsConnectorInstances[e]=new t),Vi.analyticsConnectorInstances[e]},t}(),Ji=function(t){return void 0===t&&(t=He),Bi.getInstance(t)},Gi=function(){function t(){this.name="identity",this.type="before",this.identityStore=Ji().identityStore}return t.prototype.execute=function(t){return De(this,void 0,void 0,function(){var e;return Fe(this,function(i){return(e=t.user_properties)&&this.identityStore.editIdentity().updateUserProperties(e).commit(),[2,t]})})},t.prototype.setup=function(t){return De(this,void 0,void 0,function(){return Fe(this,function(e){return t.instanceName&&(this.identityStore=Ji(t.instanceName).identityStore),[2]})})},t}(),Ki=function(t,e){return void 0===e&&(e=Date.now()),Date.now()-e>t},Qi=function(t,e,i){return void 0===e&&(e=""),void 0===i&&(i=10),[je,e,t.substring(0,i)].filter(Boolean).join("_")},Zi=function(){var t,e,i,n;if("undefined"==typeof navigator)return"";var r=navigator.userLanguage;return null!==(n=null!==(i=null!==(e=null===(t=navigator.languages)||void 0===t?void 0:t[0])&&void 0!==e?e:navigator.language)&&void 0!==i?i:r)&&void 0!==n?n:""},Wi=function(){var t,e=fi();return(null===(t=null==e?void 0:e.location)||void 0===t?void 0:t.search)?e.location.search.substring(1).split("&").filter(Boolean).reduce(function(t,e){var i=e.split("=",2),n=Yi(i[0]),r=Yi(i[1]);return r?(t[n]=r,t):t},{}):{}},Yi=function(t){void 0===t&&(t="");try{return decodeURIComponent(t)}catch(e){return""}},Xi=function(t){return function(){var e=Me({},t.config);return{logger:e.loggerProvider,logLevel:e.logLevel}}},tn=function(t,e){var i,n;e=(e=e.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"");try{for(var r=Oe(e.split(".")),s=r.next();!s.done;s=r.next()){var a=s.value;if(!(a in t))return;t=t[a]}}catch(o){i={error:o}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return t},en=function(t,e){return function(){var i,n,r={};try{for(var s=Oe(e),a=s.next();!a.done;a=s.next()){var o=a.value;r[o]=tn(t,o)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return r}},nn=function(t,e,i,n,r){return void 0===r&&(r=null),function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];var o=i(),c=o.logger,l=o.logLevel;if(l&&l<ui.Debug||!l||!c)return t.apply(r,s);var d={type:"invoke public method",name:e,args:s,stacktrace:((new Error).stack||"").split("\n").slice(3).map(function(t){return t.trim()}),time:{start:(new Date).toISOString()},states:{}};n&&d.states&&(d.states.before=n());var u=t.apply(r,s);return u&&u.promise?u.promise.then(function(){n&&d.states&&(d.states.after=n()),d.time&&(d.time.end=(new Date).toISOString()),c.debug(JSON.stringify(d,null,2))}):(n&&d.states&&(d.states.after=n()),d.time&&(d.time.end=(new Date).toISOString()),c.debug(JSON.stringify(d,null,2))),u}},rn=function(t,e){return!e||!e.length||e.some(function(e){return"string"==typeof e?t===e:t.match(e)})},sn=function(){function t(){this.memoryStorage=new Map}return t.prototype.isEnabled=function(){return De(this,void 0,void 0,function(){return Fe(this,function(t){return[2,!0]})})},t.prototype.get=function(t){return De(this,void 0,void 0,function(){return Fe(this,function(e){return[2,this.memoryStorage.get(t)]})})},t.prototype.getRaw=function(t){return De(this,void 0,void 0,function(){var e;return Fe(this,function(i){switch(i.label){case 0:return[4,this.get(t)];case 1:return[2,(e=i.sent())?JSON.stringify(e):void 0]}})})},t.prototype.set=function(t,e){return De(this,void 0,void 0,function(){return Fe(this,function(i){return this.memoryStorage.set(t,e),[2]})})},t.prototype.remove=function(t){return De(this,void 0,void 0,function(){return Fe(this,function(e){return this.memoryStorage.delete(t),[2]})})},t.prototype.reset=function(){return De(this,void 0,void 0,function(){return Fe(this,function(t){return this.memoryStorage.clear(),[2]})})},t}(),an=function(){function t(t){this.options=Me({},t)}return t.prototype.isEnabled=function(){return De(this,void 0,void 0,function(){var e,i;return Fe(this,function(n){switch(n.label){case 0:if(!fi())return[2,!1];t.testValue=String(Date.now()),e=new t(this.options),i="AMP_TEST",n.label=1;case 1:return n.trys.push([1,4,5,7]),[4,e.set(i,t.testValue)];case 2:return n.sent(),[4,e.get(i)];case 3:return[2,n.sent()===t.testValue];case 4:return n.sent(),[2,!1];case 5:return[4,e.remove(i)];case 6:return n.sent(),[7];case 7:return[2]}})})},t.prototype.get=function(t){var e;return De(this,void 0,void 0,function(){var i,n;return Fe(this,function(r){switch(r.label){case 0:return[4,this.getRaw(t)];case 1:if(!(i=r.sent()))return[2,void 0];try{return void 0===(n=null!==(e=on(i))&&void 0!==e?e:cn(i))?[2,void 0]:[2,JSON.parse(n)]}catch(s){return[2,void 0]}return[2]}})})},t.prototype.getRaw=function(t){var e,i;return De(this,void 0,void 0,function(){var n,r,s;return Fe(this,function(a){return n=fi(),r=null!==(i=null===(e=null==n?void 0:n.document)||void 0===e?void 0:e.cookie.split("; "))&&void 0!==i?i:[],(s=r.find(function(e){return 0===e.indexOf(t+"=")}))?[2,s.substring(t.length+1)]:[2,void 0]})})},t.prototype.set=function(t,e){var i;return De(this,void 0,void 0,function(){var n,r,s,a,o,c;return Fe(this,function(l){try{n=null!==(i=this.options.expirationDays)&&void 0!==i?i:0,s=void 0,(r=null!==e?n:-1)&&((a=new Date).setTime(a.getTime()+24*r*60*60*1e3),s=a),o="".concat(t,"=").concat(btoa(encodeURIComponent(JSON.stringify(e)))),s&&(o+="; expires=".concat(s.toUTCString())),o+="; path=/",this.options.domain&&(o+="; domain=".concat(this.options.domain)),this.options.secure&&(o+="; Secure"),this.options.sameSite&&(o+="; SameSite=".concat(this.options.sameSite)),(c=fi())&&(c.document.cookie=o)}catch(d){d instanceof Error?d.message:String(d)}return[2]})})},t.prototype.remove=function(t){return De(this,void 0,void 0,function(){return Fe(this,function(e){switch(e.label){case 0:return[4,this.set(t,null)];case 1:return e.sent(),[2]}})})},t.prototype.reset=function(){return De(this,void 0,void 0,function(){return Fe(this,function(t){return[2]})})},t}(),on=function(t){try{return decodeURIComponent(atob(t))}catch(e){return}},cn=function(t){try{return decodeURIComponent(atob(decodeURIComponent(t)))}catch(e){return}},ln=function(t,e,i){return void 0===e&&(e=""),void 0===i&&(i=10),[je,e,t.substring(0,i)].filter(Boolean).join("_")},dn=function(){function t(t){this.storage=t}return t.prototype.isEnabled=function(){return De(this,void 0,void 0,function(){var e,i,n;return Fe(this,function(r){switch(r.label){case 0:if(!this.storage)return[2,!1];e=String(Date.now()),i=new t(this.storage),n="AMP_TEST",r.label=1;case 1:return r.trys.push([1,4,5,7]),[4,i.set(n,e)];case 2:return r.sent(),[4,i.get(n)];case 3:return[2,r.sent()===e];case 4:return r.sent(),[2,!1];case 5:return[4,i.remove(n)];case 6:return r.sent(),[7];case 7:return[2]}})})},t.prototype.get=function(t){return De(this,void 0,void 0,function(){var e;return Fe(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.getRaw(t)];case 1:return(e=i.sent())?[2,JSON.parse(e)]:[2,void 0];case 2:return i.sent(),[2,void 0];case 3:return[2]}})})},t.prototype.getRaw=function(t){var e;return De(this,void 0,void 0,function(){return Fe(this,function(i){return[2,(null===(e=this.storage)||void 0===e?void 0:e.getItem(t))||void 0]})})},t.prototype.set=function(t,e){var i;return De(this,void 0,void 0,function(){return Fe(this,function(n){try{null===(i=this.storage)||void 0===i||i.setItem(t,JSON.stringify(e))}catch(r){}return[2]})})},t.prototype.remove=function(t){var e;return De(this,void 0,void 0,function(){return Fe(this,function(i){try{null===(e=this.storage)||void 0===e||e.removeItem(t)}catch(n){}return[2]})})},t.prototype.reset=function(){var t;return De(this,void 0,void 0,function(){return Fe(this,function(e){try{null===(t=this.storage)||void 0===t||t.clear()}catch(i){}return[2]})})},t}(),un=function(){function t(){}return t.prototype.send=function(t,e){return Promise.resolve(null)},t.prototype.buildResponse=function(t){var e,i,n,r,s,a,o,c,l,d,u,h,p,f,m,g,v,y,b,x,w,_;if("object"!=typeof t)return null;var k=t.code||0,S=this.buildStatus(k);switch(S){case ci.Success:return{status:S,statusCode:k,body:{eventsIngested:null!==(e=t.events_ingested)&&void 0!==e?e:0,payloadSizeBytes:null!==(i=t.payload_size_bytes)&&void 0!==i?i:0,serverUploadTime:null!==(n=t.server_upload_time)&&void 0!==n?n:0}};case ci.Invalid:return{status:S,statusCode:k,body:{error:null!==(r=t.error)&&void 0!==r?r:"",missingField:null!==(s=t.missing_field)&&void 0!==s?s:"",eventsWithInvalidFields:null!==(a=t.events_with_invalid_fields)&&void 0!==a?a:{},eventsWithMissingFields:null!==(o=t.events_with_missing_fields)&&void 0!==o?o:{},eventsWithInvalidIdLengths:null!==(c=t.events_with_invalid_id_lengths)&&void 0!==c?c:{},epsThreshold:null!==(l=t.eps_threshold)&&void 0!==l?l:0,exceededDailyQuotaDevices:null!==(d=t.exceeded_daily_quota_devices)&&void 0!==d?d:{},silencedDevices:null!==(u=t.silenced_devices)&&void 0!==u?u:[],silencedEvents:null!==(h=t.silenced_events)&&void 0!==h?h:[],throttledDevices:null!==(p=t.throttled_devices)&&void 0!==p?p:{},throttledEvents:null!==(f=t.throttled_events)&&void 0!==f?f:[]}};case ci.PayloadTooLarge:return{status:S,statusCode:k,body:{error:null!==(m=t.error)&&void 0!==m?m:""}};case ci.RateLimit:return{status:S,statusCode:k,body:{error:null!==(g=t.error)&&void 0!==g?g:"",epsThreshold:null!==(v=t.eps_threshold)&&void 0!==v?v:0,throttledDevices:null!==(y=t.throttled_devices)&&void 0!==y?y:{},throttledUsers:null!==(b=t.throttled_users)&&void 0!==b?b:{},exceededDailyQuotaDevices:null!==(x=t.exceeded_daily_quota_devices)&&void 0!==x?x:{},exceededDailyQuotaUsers:null!==(w=t.exceeded_daily_quota_users)&&void 0!==w?w:{},throttledEvents:null!==(_=t.throttled_events)&&void 0!==_?_:[]}};case ci.Timeout:default:return{status:S,statusCode:k}}},t.prototype.buildStatus=function(t){return t>=200&&t<300?ci.Success:429===t?ci.RateLimit:413===t?ci.PayloadTooLarge:408===t?ci.Timeout:t>=400&&t<500?ci.Invalid:t>=500?ci.Failed:ci.Unknown},t}(),hn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ee(e,t),e.prototype.send=function(t,e){return De(this,void 0,void 0,function(){var i,n,r;return Fe(this,function(s){switch(s.label){case 0:if("undefined"==typeof fetch)throw new Error("FetchTransport is not supported");return i={headers:{"Content-Type":"application/json",Accept:"*/*"},body:JSON.stringify(e),method:"POST"},[4,fetch(t,i)];case 1:return[4,(n=s.sent()).text()];case 2:r=s.sent();try{return[2,this.buildResponse(JSON.parse(r))]}catch(a){return[2,this.buildResponse({code:n.status})]}return[2]}})})},e}(un);(Ri=ji||(ji={})).US="US",Ri.EU="EU",Ri.STAGING="STAGING";var pn=["a","button","input","select","textarea","label","video","audio",'[contenteditable="true" i]',"[data-amp-default-track]",".amp-default-track"],fn="data-amp-track-",mn=["div","span","h1","h2","h3","h4","h5","h6"],gn=Ne(['input[type="button"]','input[type="submit"]','input[type="reset"]','input[type="image"]','input[type="file"]'],Ue(["a","button",'[role="button"]','[role="link"]','[role="menuitem"]','[role="menuitemcheckbox"]','[role="menuitemradio"]','[role="option"]','[role="tab"]','[role="treeitem"]','[contenteditable="true" i]']),!1),vn=["*"];function yn(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||null==t}function bn(t,e,i){t&&xn({json:t,allowlist:e.map(wn),excludelist:i.map(wn),ancestors:[]})}function xn(t){var e,i,n=t.json,r=t.targetObject,s=t.allowlist,a=t.excludelist,o=t.ancestors,c=t.parentObject,l=t.targetKey;r||(r=n);var d=Object.keys(r);try{for(var u=Oe(d),h=u.next();!h.done;h=u.next()){var p=h.value,f=Ne(Ne([],Ue(o),!1),[p],!1);yn(r[p])?kn(f,s)&&!kn(f,a)||delete r[p]:xn({json:n,targetObject:r[p],allowlist:s,excludelist:a,ancestors:f,parentObject:r,targetKey:p})}}catch(m){e={error:m}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(e)throw e.error}}0===Object.keys(r).length&&c&&l&&delete c[l]}function wn(t){return t.startsWith("/")&&(t=t.slice(1)),t.split("/").map(function(t){return t.replace(/~0/g,"~").replace(/~1/g,"/")})}function _n(t,e,i,n){if(void 0===i&&(i=0),void 0===n&&(n=0),n===e.length)return i===t.length;if(i===t.length){for(;n<e.length&&"**"===e[n];)n++;return n===e.length}var r=e[n];if("**"===r){if(n+1===e.length)return!0;for(var s=i;s<=t.length;s++)if(_n(t,e,s,n+1))return!0;return!1}return("*"===r||r===t[i])&&_n(t,e,i+1,n+1)}function kn(t,e){return e.some(function(e){return _n(t,e)})}var Sn=function(){function t(t){this.request=t}return t.prototype.headers=function(t){var e,i;void 0===t&&(t=[]);var n=this.request.headers,r={};if(Array.isArray(n))n.forEach(function(t){var e=Ue(t,2),i=e[0],n=e[1];r[i]=n});else if(n instanceof Headers)n.forEach(function(t,e){r[e]=t});else if("object"==typeof n&&null!==n)try{for(var s=Oe(Object.entries(n)),a=s.next();!a.done;a=s.next()){var o=Ue(a.value,2),c=o[0],l=o[1];r[c]=l}}catch(d){e={error:d}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}return On(r,{allow:t})},Object.defineProperty(t.prototype,"bodySize",{get:function(){if("number"==typeof this.et)return this.et;var t=fi();if(null==t?void 0:t.TextEncoder){var e=this.request.body;return this.et=Cn(e,100),this.et}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"method",{get:function(){return this.request.method},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"body",{get:function(){return"string"==typeof this.request.body?this.request.body:null},enumerable:!1,configurable:!0}),t.prototype.json=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=[]),De(this,void 0,void 0,function(){return Fe(this,function(i){return 0===t.length?[2,null]:[2,An(this.body,t,e)]})})},t}(),Pn=function(){function t(t,e){this.bodyRaw=t,this.requestHeaders=e}return t.prototype.headers=function(t){return void 0===t&&(t=[]),On(this.requestHeaders,{allow:t})},Object.defineProperty(t.prototype,"bodySize",{get:function(){return Cn(this.bodyRaw,100)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"body",{get:function(){return"string"==typeof this.bodyRaw?this.bodyRaw:null},enumerable:!1,configurable:!0}),t.prototype.json=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=[]),De(this,void 0,void 0,function(){return Fe(this,function(i){return 0===t.length?[2,null]:[2,An(this.body,t,e)]})})},t}();function Cn(t,e){var i,n,r,s=fi(),a=null==s?void 0:s.TextEncoder;if(a){var o;if("string"==typeof t)o=t,r=(new a).encode(o).length;else if(t instanceof Blob)r=(o=t).size;else if(t instanceof URLSearchParams)o=t,r=(new a).encode(o.toString()).length;else if(ArrayBuffer.isView(t))r=(o=t).byteLength;else if(t instanceof ArrayBuffer)r=(o=t).byteLength;else if(t instanceof FormData){var c=t,l=0,d=0;try{for(var u=Oe(c.entries()),h=u.next();!h.done;h=u.next()){var p=Ue(h.value,2),f=p[0],m=p[1];if(l+=f.length,"string"==typeof m)l+=(new a).encode(m).length;else{if(!(m instanceof Blob))return;l+=m.size}if(++d>=e)return}}catch(g){i={error:g}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}r=l}else if(t instanceof ReadableStream)return void(o=t);return r}}var En,$n,Tn=function(){function t(t){this.response=t}return t.prototype.headers=function(t){var e;if(void 0===t&&(t=[]),this.response.headers instanceof Headers){var i=this.response.headers,n={};return null===(e=null==i?void 0:i.forEach)||void 0===e||e.call(i,function(t,e){n[e]=t}),On(n,{allow:t})}},Object.defineProperty(t.prototype,"bodySize",{get:function(){var t,e;if(void 0!==this.et)return this.et;var i=null===(e=null===(t=this.response.headers)||void 0===t?void 0:t.get)||void 0===e?void 0:e.call(t,"content-length"),n=i?parseInt(i,10):void 0;return this.et=n,n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this.response.status},enumerable:!1,configurable:!0}),t.prototype.text=function(){return De(this,void 0,void 0,function(){var t,e;return Fe(this,function(i){switch(i.label){case 0:this.clonedResponse||(this.clonedResponse=this.response.clone()),i.label=1;case 1:return i.trys.push([1,3,,4]),t=this.clonedResponse.text(),e=new Promise(function(t){return setTimeout(function(){return t(null)},500)}),[4,Promise.race([t,e])];case 2:return[2,i.sent()];case 3:return i.sent(),[2,null];case 4:return[2]}})})},t.prototype.json=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=[]),De(this,void 0,void 0,function(){return Fe(this,function(i){switch(i.label){case 0:return 0===t.length?[2,null]:[4,this.text()];case 1:return[2,An(i.sent(),t,e)]}})})},t}(),In=function(){function t(t,e,i,n){this.statusCode=t,this.headersString=e,this.size=i,this.getJson=n}return Object.defineProperty(t.prototype,"bodySize",{get:function(){return this.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this.statusCode},enumerable:!1,configurable:!0}),t.prototype.headers=function(t){var e,i;if(void 0===t&&(t=[]),!this.headersString)return{};var n={},r=this.headersString.split("\r\n");try{for(var s=Oe(r),a=s.next();!a.done;a=s.next()){var o=Ue(a.value.split(": "),2),c=o[0],l=o[1];c&&l&&(n[c]=l)}}catch(d){e={error:d}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}return On(n,{allow:t})},t.prototype.json=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=[]),De(this,void 0,void 0,function(){var i;return Fe(this,function(n){return 0===t.length?[2,null]:(i=this.getJson())?(bn(i,t,e),[2,i]):[2,null]})})},t}();function An(t,e,i){if(!t)return null;try{var n=JSON.parse(t);return bn(n,e,i),n}catch(r){return null}}($n=En||(En={})).REDACT="redact",$n.REMOVE="remove";var Mn,Ln,Dn,Fn="[REDACTED]",On=function(t,e){var i,n,r=e.allow,s=void 0===r?[]:r,a=e.strategy,o=void 0===a?En.REMOVE:a,c=Ne([],Ue(ri),!1),l={},d=function(e){var i=e.toLowerCase();c.find(function(t){return t.toLowerCase()===i})?o===En.REDACT&&(l[e]=Fn):s.find(function(t){return t.toLowerCase()===i})?l[e]=t[e]:o===En.REDACT&&(l[e]=Fn)};try{for(var u=Oe(Object.keys(t)),h=u.next();!h.done;h=u.next())d(h.value)}catch(p){i={error:p}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}return l},Un=function(){function t(t,e,i,n,r,s,a,o,c,l,d){void 0===a&&(a=0),this.type=t,this.method=e,this.timestamp=i,this.startTime=n,this.url=r,this.requestWrapper=s,this.status=a,this.duration=o,this.responseWrapper=c,this.error=l,this.endTime=d}return t.prototype.toSerializable=function(){var t,e,i,n,r={type:this.type,method:this.method,url:this.url,timestamp:this.timestamp,status:this.status,duration:this.duration,error:this.error,startTime:this.startTime,endTime:this.endTime,requestHeaders:null===(t=this.requestWrapper)||void 0===t?void 0:t.headers(Ne([],Ue(ni),!1)),requestBodySize:null===(e=this.requestWrapper)||void 0===e?void 0:e.bodySize,responseHeaders:null===(i=this.responseWrapper)||void 0===i?void 0:i.headers(Ne([],Ue(ni),!1)),responseBodySize:null===(n=this.responseWrapper)||void 0===n?void 0:n.bodySize};return Object.fromEntries(Object.entries(r).filter(function(t){var e=Ue(t,2);return e[0],void 0!==e[1]}))},t}(),Nn=function(){return function(t,e){void 0===e&&(e=gi()),this.callback=t,this.id=e}}(),zn=function(){function t(e){this.eventCallbacks=new Map,this.isObserving=!1,this.logger=e;var i=fi();t.isSupported()&&(this.globalScope=i)}return t.isSupported=function(){var t=fi();return!!t&&!!t.fetch},t.prototype.subscribe=function(t,e){var i,n,r,s,a,o,c,l,d,u;if(this.logger||(this.logger=e),this.eventCallbacks.set(t.id,t),!this.isObserving){var h=null===(r=null===(n=null===(i=this.globalScope)||void 0===i?void 0:i.XMLHttpRequest)||void 0===n?void 0:n.prototype)||void 0===r?void 0:r.open,p=null===(o=null===(a=null===(s=this.globalScope)||void 0===s?void 0:s.XMLHttpRequest)||void 0===a?void 0:a.prototype)||void 0===o?void 0:o.send,f=null===(d=null===(l=null===(c=this.globalScope)||void 0===c?void 0:c.XMLHttpRequest)||void 0===l?void 0:l.prototype)||void 0===d?void 0:d.setRequestHeader;h&&p&&f&&this.observeXhr(h,p,f);var m=null===(u=this.globalScope)||void 0===u?void 0:u.fetch;m&&this.observeFetch(m),this.isObserving=!0}},t.prototype.unsubscribe=function(t){this.eventCallbacks.delete(t.id)},t.prototype.triggerEventCallbacks=function(t){var e=this;this.eventCallbacks.forEach(function(i){var n;try{i.callback(t)}catch(r){null===(n=e.logger)||void 0===n||n.debug("an unexpected error occurred while triggering event callbacks",r)}})},t.prototype.handleNetworkRequestEvent=function(t,e,i,n,r,s,a){var o,c;if(void 0!==s&&void 0!==a){var l,d,u,h="GET";if(function(t){return"object"==typeof t&&null!==t&&"url"in t&&"method"in t}(e)?(l=e.url,h=e.method):l=null===(o=null==e?void 0:e.toString)||void 0===o?void 0:o.call(e),l)try{var p=new URL(l);l="".concat(p.protocol,"//").concat(p.host).concat(p.pathname).concat(p.search).concat(p.hash)}catch(v){null===(c=this.logger)||void 0===c||c.error("an unexpected error occurred while parsing the URL",v)}h=(null==i?void 0:i.method)||h,n&&(d=n.status),r&&(u={name:r.name||"UnknownError",message:r.message||"An unknown error occurred"},d=0);var f=Math.floor(performance.now()-a),m=Math.floor(s+f),g=new Un(t,h,s,s,l,i,d,f,n,u,m);this.triggerEventCallbacks(g)}},t.prototype.getTimestamps=function(){var t,e;return{startTime:null===(t=Date.now)||void 0===t?void 0:t.call(Date),durationStart:null===(e=null===performance||void 0===performance?void 0:performance.now)||void 0===e?void 0:e.call(performance)}},t.prototype.observeFetch=function(t){var e=this;this.globalScope&&t&&(this.globalScope.fetch=function(i,n){return De(e,void 0,void 0,function(){var e,r,s,a,o,c;return Fe(this,function(l){switch(l.label){case 0:try{e=this.getTimestamps()}catch(d){null===(o=this.logger)||void 0===o||o.debug("an unexpected error occurred while retrieving timestamps",d)}l.label=1;case 1:return l.trys.push([1,3,,4]),[4,t(i,n)];case 2:return r=l.sent(),[3,4];case 3:return a=l.sent(),s=a,[3,4];case 4:try{this.handleNetworkRequestEvent("fetch",i,n?new Sn(n):void 0,r?new Tn(r):void 0,s,null==e?void 0:e.startTime,null==e?void 0:e.durationStart)}catch(u){null===(c=this.logger)||void 0===c||c.debug("an unexpected error occurred while handling fetch",u)}if(r)return[2,r];throw s}})})})},t.createXhrJsonParser=function(t,e){return function(){var i,n;try{if("json"===t.responseType){if(null===(i=e.globalScope)||void 0===i?void 0:i.structuredClone)return e.globalScope.structuredClone(t.response)}else if(["text",""].includes(t.responseType))return JSON.parse(t.responseText)}catch(r){return r instanceof Error&&"InvalidStateError"===r.name&&(null===(n=e.logger)||void 0===n||n.error("unexpected error when retrieving responseText. responseType='".concat(t.responseType,"'"))),null}return null}},t.prototype.observeXhr=function(e,i,n){if(this.globalScope&&e&&i){var r=this.globalScope.XMLHttpRequest.prototype,s=this;r.open=function(){for(var t,i,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var a=Ue(n,2),o=a[0],c=a[1];try{this.$$AmplitudeAnalyticsEvent=Me({method:o,url:null===(t=null==c?void 0:c.toString)||void 0===t?void 0:t.call(c),headers:{}},s.getTimestamps())}catch(l){null===(i=s.logger)||void 0===i||i.error("an unexpected error occurred while calling xhr open",l)}return e.apply(this,n)},r.send=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=this,a=t.createXhrJsonParser(this,s),o=e[0],c=r.$$AmplitudeAnalyticsEvent;return r.addEventListener("loadend",function(){var t;try{var e=r.getAllResponseHeaders(),i=r.getResponseHeader("content-length"),n=new In(r.status,e,i?parseInt(i,10):void 0,a),l=r.$$AmplitudeAnalyticsEvent.headers,d=new Pn(o,l);c.status=r.status,s.handleNetworkRequestEvent("xhr",{url:c.url,method:c.method},d,n,void 0,c.startTime,c.durationStart)}catch(u){null===(t=s.logger)||void 0===t||t.error("an unexpected error occurred while handling xhr send",u)}}),i.apply(r,e)},r.setRequestHeader=function(t,e){var i;try{this.$$AmplitudeAnalyticsEvent.headers[t]=e}catch(r){null===(i=s.logger)||void 0===i||i.error("an unexpected error occurred while calling xhr setRequestHeader",r)}n.apply(this,[t,e])}}},t}(),qn=new zn,jn=function(){function t(){}return t.prototype.parse=function(){return De(this,void 0,void 0,function(){return Fe(this,function(t){return[2,Me(Me(Me(Me({},ii),this.getUtmParam()),this.getReferrer()),this.getClickIds())]})})},t.prototype.getUtmParam=function(){var t=Wi();return{utm_campaign:t.utm_campaign,utm_content:t.utm_content,utm_id:t.utm_id,utm_medium:t.utm_medium,utm_source:t.utm_source,utm_term:t.utm_term}},t.prototype.getReferrer=function(){var t,e,i={referrer:void 0,referring_domain:void 0};try{i.referrer=document.referrer||void 0,i.referring_domain=null!==(e=null===(t=i.referrer)||void 0===t?void 0:t.split("/")[2])&&void 0!==e?e:void 0}catch(n){}return i},t.prototype.getClickIds=function(){var t,e=Wi();return(t={})[Be]=e[Be],t[Je]=e[Je],t[Ge]=e[Ge],t[Ke]=e[Ke],t[Qe]=e[Qe],t[Ze]=e[Ze],t[We]=e[We],t[Ye]=e[Ye],t[Xe]=e[Xe],t[ti]=e[ti],t[ei]=e[ei],t},t}(),Rn=function(t,e){return"boolean"==typeof t?t:!1!==(null==t?void 0:t[e])},Hn=function(t){return Rn(t,"attribution")},Vn=function(t){return Rn(t,"pageViews")},Bn=function(t){return Rn(t,"sessions")},Jn=function(t){return"object"==typeof t&&(!0===t.networkTracking||"object"==typeof t.networkTracking)},Gn=function(t){return"boolean"==typeof t?t:"object"==typeof t&&(!0===t.elementInteractions||"object"==typeof t.elementInteractions)},Kn=function(t){return"object"==typeof t&&(!0===t.frustrationInteractions||"object"==typeof t.frustrationInteractions)},Qn=function(t){if(Gn(t.autocapture)&&"object"==typeof t.autocapture&&"object"==typeof t.autocapture.elementInteractions)return t.autocapture.elementInteractions},Zn=function(t){if(Kn(t.autocapture)&&"object"==typeof t.autocapture&&"object"==typeof t.autocapture.frustrationInteractions)return t.autocapture.frustrationInteractions},Wn=function(t){var e;if(Jn(t.autocapture)){var i=void 0;return"object"==typeof t.autocapture&&"object"==typeof t.autocapture.networkTracking?i=t.autocapture.networkTracking:t.networkTrackingOptions&&(i=t.networkTrackingOptions),Me(Me({},i),{captureRules:null===(e=null==i?void 0:i.captureRules)||void 0===e?void 0:e.map(function(e){var i;if(e.urls&&e.hosts){var n=JSON.stringify(e.hosts),r=JSON.stringify(e.urls);return null===(i=t.loggerProvider)||void 0===i||i.warn("Found network capture rule with both urls='".concat(r,"' and hosts='").concat(n,"' set. ")+"Definition of urls takes precedence over hosts, so ignoring hosts."),Me(Me({},e),{hosts:void 0})}return e})})}},Yn=function(t){var e,i=function(){return!1},n=void 0,r=t.pageCounter;return Vn(t.defaultTracking)&&(i=void 0,e=void 0,t.defaultTracking&&"object"==typeof t.defaultTracking&&t.defaultTracking.pageViews&&"object"==typeof t.defaultTracking.pageViews&&("trackOn"in t.defaultTracking.pageViews&&(i=t.defaultTracking.pageViews.trackOn),"trackHistoryChanges"in t.defaultTracking.pageViews&&(n=t.defaultTracking.pageViews.trackHistoryChanges),"eventType"in t.defaultTracking.pageViews&&t.defaultTracking.pageViews.eventType&&(e=t.defaultTracking.pageViews.eventType))),{trackOn:i,trackHistoryChanges:n,eventType:e,pageCounter:r}},Xn=function(t,e){for(var i=0;i<e.length;i++){var n=e[i],r=n.name,s=n.args,a=n.resolve,o=t&&t[r];if("function"==typeof o){var c=o.apply(t,s);"function"==typeof a&&a(null==c?void 0:c.promise)}}return t},tr=function(t){return t&&void 0!==t.it},er="2.23.7",ir=function(){function t(){this.name="@amplitude/plugin-context-browser",this.type="before",this.library="".concat("amplitude-ts","/").concat(er),"undefined"!=typeof navigator&&(this.userAgent=navigator.userAgent)}return t.prototype.setup=function(t){return this.config=t,Promise.resolve(void 0)},t.prototype.execute=function(t){var e,i;return De(this,void 0,void 0,function(){var n,r,s;return Fe(this,function(a){return n=(new Date).getTime(),r=null!==(e=this.config.lastEventId)&&void 0!==e?e:-1,s=null!==(i=t.event_id)&&void 0!==i?i:r+1,this.config.lastEventId=s,t.time||(this.config.lastEventTime=n),[2,Me(Me(Me(Me(Me(Me(Me(Me({user_id:this.config.userId,device_id:this.config.deviceId,session_id:this.config.sessionId,time:n},this.config.appVersion&&{app_version:this.config.appVersion}),this.config.trackingOptions.platform&&{platform:"Web"}),this.config.trackingOptions.language&&{language:Zi()}),this.config.trackingOptions.ipAddress&&{ip:"$remote"}),{insert_id:gi(),partner_id:this.config.partnerId,plan:this.config.plan}),this.config.ingestionMetadata&&{ingestion_metadata:{source_name:this.config.ingestionMetadata.sourceName,source_version:this.config.ingestionMetadata.sourceVersion}}),t),{event_id:s,library:this.library,user_agent:this.userAgent})]})})},t}(),nr=1e3,rr=function(t){function e(e){var i,n,r,s=this;try{r=null===(i=fi())||void 0===i?void 0:i.localStorage}catch(a){null===(n=null==e?void 0:e.loggerProvider)||void 0===n||n.debug("Failed to access localStorage. error=".concat(JSON.stringify(a))),r=void 0}return(s=t.call(this,r)||this).loggerProvider=null==e?void 0:e.loggerProvider,s}return Ee(e,t),e.prototype.set=function(e,i){var n;return De(this,void 0,void 0,function(){var r;return Fe(this,function(s){switch(s.label){case 0:return Array.isArray(i)&&i.length>nr?(r=i.length-nr,[4,t.prototype.set.call(this,e,i.slice(0,nr))]):[3,2];case 1:return s.sent(),null===(n=this.loggerProvider)||void 0===n||n.error("Failed to save ".concat(r," events because the queue length exceeded ").concat(nr,".")),[3,4];case 2:return[4,t.prototype.set.call(this,e,i)];case 3:s.sent(),s.label=4;case 4:return[2]}})})},e}(dn),sr=function(t){function e(){var e;return t.call(this,null===(e=fi())||void 0===e?void 0:e.sessionStorage)||this}return Ee(e,t),e}(dn),ar=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={done:4},e}return Ee(e,t),e.prototype.send=function(t,e){return De(this,void 0,void 0,function(){var i=this;return Fe(this,function(n){return[2,new Promise(function(n,r){"undefined"==typeof XMLHttpRequest&&r(new Error("XHRTransport is not supported."));var s=new XMLHttpRequest;s.open("POST",t,!0),s.onreadystatechange=function(){if(s.readyState===i.state.done){var t=s.responseText;try{n(i.buildResponse(JSON.parse(t)))}catch(e){n(i.buildResponse({code:s.status}))}}},s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Accept","*/*"),s.send(JSON.stringify(e))})]})})},e}(un),or=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ee(e,t),e.prototype.send=function(t,e){return De(this,void 0,void 0,function(){var i=this;return Fe(this,function(n){return[2,new Promise(function(n,r){var s=fi();if(!(null==s?void 0:s.navigator.sendBeacon))throw new Error("SendBeaconTransport is not supported");try{var a=JSON.stringify(e);return n(s.navigator.sendBeacon(t,JSON.stringify(e))?i.buildResponse({code:200,events_ingested:e.events.length,payload_size_bytes:a.length,server_upload_time:Date.now()}):i.buildResponse({code:500}))}catch(o){r(o)}})]})})},e}(un),cr=function(t,e,i){return void 0===i&&(i=!0),De(void 0,void 0,void 0,function(){var n,r,s,a,o,c,l,d,u;return Fe(this,function(h){switch(h.label){case 0:return n=function(t){return"".concat(je.toLowerCase(),"_").concat(t.substring(0,6))}(t),[4,e.getRaw(n)];case 1:return(r=h.sent())?i?[4,e.remove(n)]:[3,3]:[2,{optOut:!1}];case 2:h.sent(),h.label=3;case 3:return s=Ue(r.split("."),6),a=s[0],o=s[1],c=s[2],l=s[3],d=s[4],u=s[5],[2,{deviceId:a,userId:dr(o),sessionId:lr(l),lastEventId:lr(u),lastEventTime:lr(d),optOut:Boolean(c)}]}})})},lr=function(t){var e=parseInt(t,32);if(!isNaN(e))return e},dr=function(t){if(atob&&escape&&t)try{return decodeURIComponent(escape(atob(t)))}catch(e){return}},ur="[Amplitude]",hr="".concat(ur," Form Started"),pr="".concat(ur," Form Submitted"),fr="".concat(ur," File Downloaded"),mr="session_start",gr="session_end",vr="".concat(ur," File Extension"),yr="".concat(ur," File Name"),br="".concat(ur," Link ID"),xr="".concat(ur," Link Text"),wr="".concat(ur," Link URL"),_r="".concat(ur," Form ID"),kr="".concat(ur," Form Name"),Sr="".concat(ur," Form Destination"),Pr="cookie",Cr=function(t){function e(e,i,n,r,s,a,o,c,l,d,u,h,p,f,m,g,v,y,b,x,w,_,k,S,P,C,E,$,T,I,A,M,L,D,F){void 0===n&&(n=new sn),void 0===r&&(r={domain:"",expiration:365,sameSite:"Lax",secure:!1,upgrade:!0}),void 0===c&&(c=1e3),void 0===l&&(l=5),void 0===d&&(d=30),void 0===u&&(u=Pr),void 0===g&&(g=new Pi),void 0===v&&(v=ui.Warn),void 0===b&&(b=!1),void 0===x&&(x=!1),void 0===k&&(k=""),void 0===S&&(S="US"),void 0===C&&(C=18e5),void 0===E&&(E=new rr({loggerProvider:g})),void 0===$&&($={ipAddress:!0,language:!0,platform:!0}),void 0===T&&(T="fetch"),void 0===I&&(I=!1),void 0===A&&(A=!0);var O=t.call(this,{apiKey:e,storageProvider:E,transportProvider:Tr(T)})||this;return O.apiKey=e,O.appVersion=i,O.cookieOptions=r,O.defaultTracking=s,O.autocapture=a,O.flushIntervalMillis=c,O.flushMaxRetries=l,O.flushQueueSize=d,O.identityStorage=u,O.ingestionMetadata=h,O.instanceName=p,O.loggerProvider=g,O.logLevel=v,O.minIdLength=y,O.offline=b,O.partnerId=w,O.plan=_,O.serverUrl=k,O.serverZone=S,O.sessionTimeout=C,O.storageProvider=E,O.trackingOptions=$,O.transport=T,O.useBatch=I,O.fetchRemoteConfig=A,O.networkTrackingOptions=F,O.version=er,O.tt=!1,O.nt=n,O.deviceId=o,O.lastEventId=f,O.lastEventTime=m,O.optOut=x,O.sessionId=P,O.pageCounter=L,O.userId=M,O.debugLogsEnabled=D,O.loggerProvider.enable(D?ui.Debug:O.logLevel),O.networkTrackingOptions=F,O}return Ee(e,t),Object.defineProperty(e.prototype,"cookieStorage",{get:function(){return this.nt},set:function(t){this.nt!==t&&(this.nt=t,this.updateStorage())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deviceId",{get:function(){return this.rt},set:function(t){this.rt!==t&&(this.rt=t,this.updateStorage())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userId",{get:function(){return this.st},set:function(t){this.st!==t&&(this.st=t,this.updateStorage())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:function(){return this.ot},set:function(t){this.ot!==t&&(this.ot=t,this.updateStorage())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"optOut",{get:function(){return this.tt},set:function(t){this.tt!==t&&(this.tt=t,this.updateStorage())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastEventTime",{get:function(){return this.ct},set:function(t){this.ct!==t&&(this.ct=t,this.updateStorage())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastEventId",{get:function(){return this.lt},set:function(t){this.lt!==t&&(this.lt=t,this.updateStorage())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pageCounter",{get:function(){return this.dt},set:function(t){this.dt!==t&&(this.dt=t,this.updateStorage())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debugLogsEnabled",{set:function(t){this.ut!==t&&(this.ut=t,this.updateStorage())},enumerable:!1,configurable:!0}),e.prototype.updateStorage=function(){var t={deviceId:this.rt,userId:this.st,sessionId:this.ot,optOut:this.tt,lastEventTime:this.ct,lastEventId:this.lt,pageCounter:this.dt,debugLogsEnabled:this.ut};this.cookieStorage.set(Qi(this.apiKey),t)},e}($i),Er=function(t,e,i){return void 0===e&&(e={}),De(void 0,void 0,void 0,function(){var n,r,s,a,o,c,l,d,u,h,p,f,m,g,v,y,b,x,w,_,k,S,P,C,E,$,T,I,A,M,L,D,F,O,U,N,z,q,j,R,H,V,B,J,G;return Fe(this,function(K){switch(K.label){case 0:return n=e.identityStorage||Pr,k={},n===Pr?[3,1]:(s="",[3,5]);case 1:return null===(P=null===(S=e.cookieOptions)||void 0===S?void 0:S.domain)||void 0===P?[3,2]:(a=P,[3,4]);case 2:return[4,Ir()];case 3:a=K.sent(),K.label=4;case 4:s=a,K.label=5;case 5:return r=Me.apply(void 0,[(k.domain=s,k.expiration=365,k.sameSite="Lax",k.secure=!1,k.upgrade=!0,k),e.cookieOptions]),o=$r(e.identityStorage,r),[4,cr(t,o,null===(E=null===(C=e.cookieOptions)||void 0===C?void 0:C.upgrade)||void 0===E||E)];case 6:return c=K.sent(),[4,o.get(Qi(t))];case 7:return l=K.sent(),d=Wi(),u=d.ampTimestamp?Number(d.ampTimestamp):void 0,h=!u||Date.now()<u,p=null!==(M=null!==(A=null!==(I=null!==($=e.deviceId)&&void 0!==$?$:h?null!==(T=d.ampDeviceId)&&void 0!==T?T:d.deviceId:void 0)&&void 0!==I?I:null==l?void 0:l.deviceId)&&void 0!==A?A:c.deviceId)&&void 0!==M?M:gi(),f=null!==(L=null==l?void 0:l.lastEventId)&&void 0!==L?L:c.lastEventId,m=null!==(D=null==l?void 0:l.lastEventTime)&&void 0!==D?D:c.lastEventTime,g=null!==(O=null!==(F=e.optOut)&&void 0!==F?F:null==l?void 0:l.optOut)&&void 0!==O?O:c.optOut,v=null!==(U=null==l?void 0:l.sessionId)&&void 0!==U?U:c.sessionId,y=null!==(z=null!==(N=e.userId)&&void 0!==N?N:null==l?void 0:l.userId)&&void 0!==z?z:c.userId,i.previousSessionDeviceId=null!==(q=null==l?void 0:l.deviceId)&&void 0!==q?q:c.deviceId,i.previousSessionUserId=null!==(j=null==l?void 0:l.userId)&&void 0!==j?j:c.userId,b={ipAddress:null===(H=null===(R=e.trackingOptions)||void 0===R?void 0:R.ipAddress)||void 0===H||H,language:null===(B=null===(V=e.trackingOptions)||void 0===V?void 0:V.language)||void 0===B||B,platform:null===(G=null===(J=e.trackingOptions)||void 0===J?void 0:J.platform)||void 0===G||G},x=null==l?void 0:l.pageCounter,w=null==l?void 0:l.debugLogsEnabled,void 0!==e.autocapture&&(e.defaultTracking=e.autocapture),[4,(_=new Cr(t,e.appVersion,o,r,e.defaultTracking,e.autocapture,p,e.flushIntervalMillis,e.flushMaxRetries,e.flushQueueSize,n,e.ingestionMetadata,e.instanceName,f,m,e.loggerProvider,e.logLevel,e.minIdLength,e.offline,g,e.partnerId,e.plan,e.serverUrl,e.serverZone,v,e.sessionTimeout,e.storageProvider,b,e.transport,e.useBatch,e.fetchRemoteConfig,y,x,w,e.networkTrackingOptions)).storageProvider.isEnabled()];case 8:return K.sent()||(_.loggerProvider.warn("Storage provider ".concat(_.storageProvider.constructor.name," is not enabled. Falling back to MemoryStorage.")),_.storageProvider=new sn),[2,_]}})})},$r=function(t,e){switch(void 0===t&&(t=Pr),void 0===e&&(e={}),t){case"localStorage":return new rr;case"sessionStorage":return new sr;case"none":return new sn;default:return new an(Me(Me({},e),{expirationDays:e.expiration}))}},Tr=function(t){return"xhr"===t?new ar:"beacon"===t?new or:new hn},Ir=function(t){return De(void 0,void 0,void 0,function(){var t,e,i,n,r,s,a;return Fe(this,function(o){switch(o.label){case 0:return[4,(new an).isEnabled()];case 1:if(!o.sent()||"undefined"==typeof location||!location.hostname)return[2,""];for(t=location.hostname,e=t.split("."),i=[],n="AMP_TLDTEST",r=e.length-2;r>=0;--r)i.push(e.slice(r).join("."));r=0,o.label=2;case 2:return r<i.length?(s=i[r],[4,(a=new an({domain:"."+s})).set(n,1)]):[3,7];case 3:return o.sent(),[4,a.get(n)];case 4:return o.sent()?[4,a.remove(n)]:[3,6];case 5:return o.sent(),[2,"."+s];case 6:return r++,[3,2];case 7:return[2,""]}})})},Ar=function(){var t="ampIntegrationContext";return"undefined"!=typeof globalThis&&void 0!==globalThis[t]?globalThis[t]:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof globalThis?globalThis:void 0},Mr=function(){var t,e=Ar();return(null===(t=null==e?void 0:e.location)||void 0===t?void 0:t.search)?e.location.search.substring(1).split("&").filter(Boolean).reduce(function(t,e){var i=e.split("=",2),n=Lr(i[0]),r=Lr(i[1]);return r?(t[n]=r,t):t},{}):{}},Lr=function(t){void 0===t&&(t="");try{return decodeURIComponent(t)}catch(e){return""}},Dr="dclid",Fr="fbclid",Or="gbraid",Ur="gclid",Nr="ko_click_id",zr="li_fat_id",qr="msclkid",jr="rdt_cid",Rr="ttclid",Hr="twclid",Vr="wbraid",Br={utm_campaign:void 0,utm_content:void 0,utm_id:void 0,utm_medium:void 0,utm_source:void 0,utm_term:void 0,referrer:void 0,referring_domain:void 0,dclid:void 0,gbraid:void 0,gclid:void 0,fbclid:void 0,ko_click_id:void 0,li_fat_id:void 0,msclkid:void 0,rdt_cid:void 0,ttclid:void 0,twclid:void 0,wbraid:void 0},Jr=function(){function t(){}return t.prototype.parse=function(){return De(this,void 0,void 0,function(){return Fe(this,function(t){return[2,Me(Me(Me(Me({},Br),this.getUtmParam()),this.getReferrer()),this.getClickIds())]})})},t.prototype.getUtmParam=function(){var t=Mr();return{utm_campaign:t.utm_campaign,utm_content:t.utm_content,utm_id:t.utm_id,utm_medium:t.utm_medium,utm_source:t.utm_source,utm_term:t.utm_term}},t.prototype.getReferrer=function(){var t,e,i={referrer:void 0,referring_domain:void 0};try{i.referrer=document.referrer||void 0,i.referring_domain=null!==(e=null===(t=i.referrer)||void 0===t?void 0:t.split("/")[2])&&void 0!==e?e:void 0}catch(n){}return i},t.prototype.getClickIds=function(){var t,e=Mr();return(t={})[Dr]=e[Dr],t[Fr]=e[Fr],t[Or]=e[Or],t[Ur]=e[Ur],t[Nr]=e[Nr],t[zr]=e[zr],t[qr]=e[qr],t[jr]=e[jr],t[Rr]=e[Rr],t[Hr]=e[Hr],t[Vr]=e[Vr],t},t}();!function(t){t.SET="$set",t.SET_ONCE="$setOnce",t.ADD="$add",t.APPEND="$append",t.PREPEND="$prepend",t.REMOVE="$remove",t.PREINSERT="$preInsert",t.POSTINSERT="$postInsert",t.UNSET="$unset",t.CLEAR_ALL="$clearAll"}(Mn||(Mn={})),function(t){t.REVENUE_PRODUCT_ID="$productId",t.REVENUE_QUANTITY="$quantity",t.REVENUE_PRICE="$price",t.REVENUE_TYPE="$revenueType",t.REVENUE_CURRENCY="$currency",t.REVENUE="$revenue"}(Ln||(Ln={})),function(t){t.IDENTIFY="$identify",t.GROUP_IDENTIFY="$groupidentify",t.REVENUE="revenue_amount"}(Dn||(Dn={}));var Gr,Kr,Qr=function(t){var e={};for(var i in t){var n=t[i];n&&(e[i]=n)}return e},Zr=function(t){var e;void 0===t&&(t={});var i,n=Ar(),r=void 0,s=!1,a=t.trackOn,o=t.trackHistoryChanges,c=t.eventType,l=void 0===c?"[Amplitude] Page Viewed":c,d=function(t){var e=t;try{e=decodeURI(t)}catch(i){null==r||r.error("Malformed URI sequence: ",i)}return e},u=function(){return De(void 0,void 0,void 0,function(){var t,e,i;return Fe(this,function(n){switch(n.label){case 0:return t=d("undefined"!=typeof location&&location.href||""),i={event_type:l},e=[{}],[4,Wr()];case 1:return[2,(i.event_properties=Me.apply(void 0,[Me.apply(void 0,e.concat([n.sent()])),{"[Amplitude] Page Domain":"undefined"!=typeof location&&location.hostname||"","[Amplitude] Page Location":t,"[Amplitude] Page Path":"undefined"!=typeof location&&d(location.pathname)||"","[Amplitude] Page Title":"undefined"!=typeof document&&document.title||"","[Amplitude] Page URL":t.split("?")[0]}]),i)]}})})},h=function(){return void 0===a||"function"==typeof a&&a()},p="undefined"!=typeof location?location.href:null,f=function(){return De(void 0,void 0,void 0,function(){var t,i,n,s;return Fe(this,function(a){switch(a.label){case 0:return t=location.href,i=Xr(o,t,p||"")&&h(),p=t,i?(null==r||r.log("Tracking page view event"),null!=e?[3,1]:[3,3]):[3,4];case 1:return s=(n=e).track,[4,u()];case 2:s.apply(n,[a.sent()]),a.label=3;case 3:a.label=4;case 4:return[2]}})})},m=function(){f()};return{name:"@amplitude/plugin-page-view-tracking-browser",type:"enrichment",setup:function(t,a){return De(void 0,void 0,void 0,function(){var o,c;return Fe(this,function(l){switch(l.label){case 0:return e=a,i=t,(r=t.loggerProvider).log("Installing @amplitude/plugin-page-view-tracking-browser"),s=!0,n&&(n.addEventListener("popstate",m),n.history.pushState=new Proxy(n.history.pushState,{apply:function(t,e,i){var n=Ue(i,3),r=n[0],a=n[1],o=n[2];t.apply(e,[r,a,o]),s&&f()}})),h()?(r.log("Tracking page view event"),c=(o=e).track,[4,u()]):[3,2];case 1:c.apply(o,[l.sent()]),l.label=2;case 2:return[2]}})})},execute:function(t){return De(void 0,void 0,void 0,function(){var e;return Fe(this,function(n){switch(n.label){case 0:return"attribution"===a&&Yr(t)?(null==r||r.log("Enriching campaign event to page view event with campaign parameters"),[4,u()]):[3,2];case 1:e=n.sent(),t.event_type=e.event_type,t.event_properties=Me(Me({},t.event_properties),e.event_properties),n.label=2;case 2:return i&&t.event_type===l&&(i.pageCounter=i.pageCounter?i.pageCounter+1:1,t.event_properties=Me(Me({},t.event_properties),{"[Amplitude] Page Counter":i.pageCounter})),[2,t]}})})},teardown:function(){return De(void 0,void 0,void 0,function(){return Fe(this,function(t){return n&&(n.removeEventListener("popstate",m),s=!1),[2]})})}}},Wr=function(){return De(void 0,void 0,void 0,function(){var t;return Fe(this,function(e){switch(e.label){case 0:return t=Qr,[4,(new Jr).parse()];case 1:return[2,t.apply(void 0,[e.sent()])]}})})},Yr=function(t){if("$identify"===t.event_type&&t.user_properties){var e=t.user_properties,i=e[Mn.SET]||{},n=e[Mn.UNSET]||{},r=Ne(Ne([],Ue(Object.keys(i)),!1),Ue(Object.keys(n)),!1);return Object.keys(Br).every(function(t){return r.includes(t)})}return!1},Xr=function(t,e,i){if("pathOnly"===t){if(""==i)return!0;var n=new URL(e),r=new URL(i);return n.origin+n.pathname!==r.origin+r.pathname}return e!==i},ts=function(){var t,e=[],i=function(t,i,n){t.addEventListener(i,n),e.push({element:t,type:i,handler:n})};return{name:"@amplitude/plugin-form-interaction-tracking-browser",type:"enrichment",setup:function(e,n){return De(void 0,void 0,void 0,function(){var r,s;return Fe(this,function(a){return r=function(){if(n){if("undefined"!=typeof document){var r=function(t){var e=!1;i(t,"change",function(){var i,r=is(t);e||n.track(hr,((i={})[_r]=es(t.id),i[kr]=es(t.name),i[Sr]=r,i)),e=!0}),i(t,"submit",function(){var i,r,s=is(t);e||n.track(hr,((i={})[_r]=es(t.id),i[kr]=es(t.name),i[Sr]=s,i)),n.track(pr,((r={})[_r]=es(t.id),r[kr]=es(t.name),r[Sr]=s,r)),e=!1})};Array.from(document.getElementsByTagName("form")).forEach(r),"undefined"!=typeof MutationObserver&&(t=new MutationObserver(function(t){t.forEach(function(t){t.addedNodes.forEach(function(t){"FORM"===t.nodeName&&r(t),"querySelectorAll"in t&&"function"==typeof t.querySelectorAll&&Array.from(t.querySelectorAll("form")).map(r)})})})).observe(document.body,{subtree:!0,childList:!0})}}else e.loggerProvider.warn("Form interaction tracking requires a later version of @amplitude/analytics-browser. Form interaction events are not tracked.")},"complete"===document.readyState?r():(s=fi())?s.addEventListener("load",r):e.loggerProvider.debug("Form interaction tracking is not installed because global is undefined."),[2]})})},execute:function(t){return De(void 0,void 0,void 0,function(){return Fe(this,function(e){return[2,t]})})},teardown:function(){return De(void 0,void 0,void 0,function(){return Fe(this,function(i){return null==t||t.disconnect(),e.forEach(function(t){var e=t.element,i=t.type,n=t.handler;null==e||e.removeEventListener(i,n)}),e=[],[2]})})}}},es=function(t){if("string"==typeof t)return t},is=function(t){var e=t.getAttribute("action");try{e=new URL(encodeURI(null!=e?e:""),window.location.href).href}catch(i){}return e},ns=function(){var t,e=[];return{name:"@amplitude/plugin-file-download-tracking-browser",type:"enrichment",setup:function(i,n){return De(void 0,void 0,void 0,function(){var r,s;return Fe(this,function(a){return r=function(){if(n){if("undefined"!=typeof document){var r=function(t){var i;try{i=new URL(t.href,window.location.href)}catch(d){return}var r,a,o,c=s.exec(i.href),l=null==c?void 0:c[1];l&&(a="click",o=function(){var e;l&&n.track(fr,((e={})[vr]=l,e[yr]=i.pathname,e[br]=t.id,e[xr]=t.text,e[wr]=t.href,e))},(r=t).addEventListener(a,o),e.push({element:r,type:a,handler:o}))},s=/\.(pdf|xlsx?|docx?|txt|rtf|csv|exe|key|pp(s|t|tx)|7z|pkg|rar|gz|zip|avi|mov|mp4|mpe?g|wmv|midi?|mp3|wav|wma)(\?.+)?$/;Array.from(document.getElementsByTagName("a")).forEach(r),"undefined"!=typeof MutationObserver&&(t=new MutationObserver(function(t){t.forEach(function(t){t.addedNodes.forEach(function(t){"A"===t.nodeName&&r(t),"querySelectorAll"in t&&"function"==typeof t.querySelectorAll&&Array.from(t.querySelectorAll("a")).map(r)})})})).observe(document.body,{subtree:!0,childList:!0})}}else i.loggerProvider.warn("File download tracking requires a later version of @amplitude/analytics-browser. File download events are not tracked.")},"complete"===document.readyState?r():(s=fi())?s.addEventListener("load",r):i.loggerProvider.debug("File download tracking is not installed because global is undefined."),[2]})})},execute:function(t){return De(void 0,void 0,void 0,function(){return Fe(this,function(e){return[2,t]})})},teardown:function(){return De(void 0,void 0,void 0,function(){return Fe(this,function(i){return null==t||t.disconnect(),e.forEach(function(t){var e=t.element,i=t.type,n=t.handler;null==e||e.removeEventListener(i,n)}),e=[],[2]})})}}},rs=!1;function ss(t){var e,i;if("object"==typeof t&&null!==t&&!Array.isArray(t)){var n=Object.keys(t);try{for(var r=Oe(n),s=r.next();!s.done;s=r.next()){var a=s.value;try{var o=t[a];"boolean"==typeof(null==o?void 0:o.enabled)&&(o.enabled?(delete o.enabled,0===Object.keys(o).length&&(t[a]=!0)):t[a]=!1),ss(o)}catch(c){}}}catch(l){e={error:l}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}}}function as(t,e){var i,n,r,s;if(t){ss(t);try{e.loggerProvider.debug("Update browser config with remote configuration:",JSON.stringify(t));var a=t;if(a&&"autocapture"in a){if("boolean"==typeof a.autocapture&&(e.autocapture=a.autocapture),"object"==typeof a.autocapture&&null!==a.autocapture){var o=Me({},a.autocapture);if(void 0===e.autocapture&&(e.autocapture=a.autocapture),"object"==typeof a.autocapture.elementInteractions&&null!==a.autocapture.elementInteractions&&(null===(r=a.autocapture.elementInteractions.pageUrlAllowlistRegex)||void 0===r?void 0:r.length)){o.elementInteractions=Me({},a.autocapture.elementInteractions);var c=o.elementInteractions,l=null!==(s=c.pageUrlAllowlist)&&void 0!==s?s:[],d=[];try{for(var u=Oe(a.autocapture.elementInteractions.pageUrlAllowlistRegex),h=u.next();!h.done;h=u.next()){var p=h.value;try{d.push(new RegExp(p))}catch(m){e.loggerProvider.warn("Invalid regex pattern: ".concat(p),m)}}}catch(g){i={error:g}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}var f=l.concat(d);c.pageUrlAllowlist=f,delete c.pageUrlAllowlistRegex}"boolean"==typeof e.autocapture&&(e.autocapture=Me({attribution:e.autocapture,fileDownloads:e.autocapture,formInteractions:e.autocapture,pageViews:e.autocapture,sessions:e.autocapture,elementInteractions:e.autocapture,webVitals:e.autocapture,frustrationInteractions:e.autocapture},o)),"object"==typeof e.autocapture&&(e.autocapture=Me(Me({},e.autocapture),o))}e.defaultTracking=e.autocapture}e.loggerProvider.debug("Browser config after remote config update:",JSON.stringify(e))}catch(v){e.loggerProvider.error("Failed to apply remote configuration because of error: ",v)}}}!function(t){t.US="US",t.EU="EU",t.STAGING="STAGING"}(Gr||(Gr={})),function(t){t.Unknown="unknown",t.Skipped="skipped",t.Success="success",t.RateLimit="rate_limit",t.PayloadTooLarge="payload_too_large",t.Invalid="invalid",t.Failed="failed",t.Timeout="Timeout",t.SystemError="SystemError"}(Kr||(Kr={}));var os=function(){function t(){}return t.prototype.send=function(t,e){return Promise.resolve(null)},t.prototype.buildResponse=function(t){var e,i,n,r,s,a,o,c,l,d,u,h,p,f,m,g,v,y,b,x,w,_;if("object"!=typeof t)return null;var k=t.code||0,S=this.buildStatus(k);switch(S){case Kr.Success:return{status:S,statusCode:k,body:{eventsIngested:null!==(e=t.events_ingested)&&void 0!==e?e:0,payloadSizeBytes:null!==(i=t.payload_size_bytes)&&void 0!==i?i:0,serverUploadTime:null!==(n=t.server_upload_time)&&void 0!==n?n:0}};case Kr.Invalid:return{status:S,statusCode:k,body:{error:null!==(r=t.error)&&void 0!==r?r:"",missingField:null!==(s=t.missing_field)&&void 0!==s?s:"",eventsWithInvalidFields:null!==(a=t.events_with_invalid_fields)&&void 0!==a?a:{},eventsWithMissingFields:null!==(o=t.events_with_missing_fields)&&void 0!==o?o:{},eventsWithInvalidIdLengths:null!==(c=t.events_with_invalid_id_lengths)&&void 0!==c?c:{},epsThreshold:null!==(l=t.eps_threshold)&&void 0!==l?l:0,exceededDailyQuotaDevices:null!==(d=t.exceeded_daily_quota_devices)&&void 0!==d?d:{},silencedDevices:null!==(u=t.silenced_devices)&&void 0!==u?u:[],silencedEvents:null!==(h=t.silenced_events)&&void 0!==h?h:[],throttledDevices:null!==(p=t.throttled_devices)&&void 0!==p?p:{},throttledEvents:null!==(f=t.throttled_events)&&void 0!==f?f:[]}};case Kr.PayloadTooLarge:return{status:S,statusCode:k,body:{error:null!==(m=t.error)&&void 0!==m?m:""}};case Kr.RateLimit:return{status:S,statusCode:k,body:{error:null!==(g=t.error)&&void 0!==g?g:"",epsThreshold:null!==(v=t.eps_threshold)&&void 0!==v?v:0,throttledDevices:null!==(y=t.throttled_devices)&&void 0!==y?y:{},throttledUsers:null!==(b=t.throttled_users)&&void 0!==b?b:{},exceededDailyQuotaDevices:null!==(x=t.exceeded_daily_quota_devices)&&void 0!==x?x:{},exceededDailyQuotaUsers:null!==(w=t.exceeded_daily_quota_users)&&void 0!==w?w:{},throttledEvents:null!==(_=t.throttled_events)&&void 0!==_?_:[]}};case Kr.Timeout:default:return{status:S,statusCode:k}}},t.prototype.buildStatus=function(t){return t>=200&&t<300?Kr.Success:429===t?Kr.RateLimit:413===t?Kr.PayloadTooLarge:408===t?Kr.Timeout:t>=400&&t<500?Kr.Invalid:t>=500?Kr.Failed:Kr.Unknown},t}(),cs="Remote config fetch rejected due to timeout after 5 seconds",ls="Unexpected error occurred",ds=function(){function t(t){var e=t.localConfig,i=t.configKeys,n=this;this.retryTimeout=1e3,this.attempts=0,this.sessionTargetingMatch=!1,this.metrics={},this.getRemoteNamespaceConfig=function(t,e){return De(n,void 0,void 0,function(){var i,n,r;return Fe(this,function(s){switch(s.label){case 0:return i=Date.now(),[4,this.fetchWithTimeout(e)];case 1:return(n=s.sent())&&(r=n.configs&&n.configs[t])?(this.metrics.fetchTimeAPISuccess=Date.now()-i,[2,r]):(this.metrics.fetchTimeAPIFail=Date.now()-i,[2,void 0])}})})},this.getRemoteConfig=function(t,e,i){return De(n,void 0,void 0,function(){var n;return Fe(this,function(r){switch(r.label){case 0:return[4,this.getRemoteNamespaceConfig(t,i)];case 1:return[2,null==(n=r.sent())?void 0:n[e]]}})})},this.fetchWithTimeout=function(t){return De(n,void 0,void 0,function(){var e,i,n;return Fe(this,function(r){switch(r.label){case 0:return e=new AbortController,i=setTimeout(function(){return e.abort()},5e3),[4,this.fetchRemoteConfig(e.signal,t)];case 1:return n=r.sent(),clearTimeout(i),[2,n]}})})},this.fetchRemoteConfig=function(t,e){return De(n,void 0,void 0,function(){var i,n,r,s,a,o,c,l,d,u,h,p;return Fe(this,function(f){switch(f.label){case 0:if(e===this.lastFetchedSessionId&&this.attempts>=this.localConfig.flushMaxRetries)return[2,this.completeRequest({err:"Remote config fetch rejected due to exceeded retry count"})];if(t.aborted)return[2,this.completeRequest({err:cs})];e!==this.lastFetchedSessionId&&(this.lastFetchedSessionId=e,this.attempts=0),f.label=1;case 1:f.trys.push([1,3,,4]),i=new URLSearchParams({api_key:this.localConfig.apiKey});try{for(n=Oe(this.configKeys),r=n.next();!r.done;r=n.next())s=r.value,i.append("config_keys",s)}catch(m){u={error:m}}finally{try{r&&!r.done&&(h=n.return)&&h.call(n)}finally{if(u)throw u.error}}return e&&i.set("session_id",String(e)),a={headers:{Accept:"*/*"},method:"GET"},o="".concat(this.getServerUrl(),"?").concat(i.toString()),this.attempts+=1,[4,fetch(o,Me(Me({},a),{signal:t}))];case 2:if(null===(c=f.sent()))return[2,this.completeRequest({err:ls})];switch((new os).buildStatus(c.status)){case Kr.Success:return this.attempts=0,[2,this.parseAndStoreConfig(c)];case Kr.Failed:return[2,this.retryFetch(t,e)];default:return[2,this.completeRequest({err:"Network error occurred, remote config fetch failed"})]}case 3:return l=f.sent(),d=l,t.aborted?[2,this.completeRequest({err:cs})]:[2,this.completeRequest({err:null!==(p=d.message)&&void 0!==p?p:ls})];case 4:return[2]}})})},this.retryFetch=function(t,e){return De(n,void 0,void 0,function(){var i=this;return Fe(this,function(n){switch(n.label){case 0:return[4,new Promise(function(t){return setTimeout(t,i.attempts*i.retryTimeout)})];case 1:return n.sent(),[2,this.fetchRemoteConfig(t,e)]}})})},this.parseAndStoreConfig=function(t){return De(n,void 0,void 0,function(){var e;return Fe(this,function(i){switch(i.label){case 0:return[4,t.json()];case 1:return e=i.sent(),this.completeRequest({success:"Remote config successfully fetched"}),[2,e]}})})},this.localConfig=e,this.configKeys=i}return t.prototype.getServerUrl=function(){return this.localConfig.configServerUrl?this.localConfig.configServerUrl:this.localConfig.serverZone===Gr.STAGING?"https://sr-client-cfg.stag2.amplitude.com/config":this.localConfig.serverZone===Gr.EU?"https://sr-client-cfg.eu.amplitude.com/config":"https://sr-client-cfg.amplitude.com/config"},t.prototype.completeRequest=function(t){var e=t.err,i=t.success;if(e)throw new Error(e);i&&this.localConfig.loggerProvider.log(i)},t}(),us="[Amplitude] Element Clicked",hs="[Amplitude] Rage Click",ps="[Amplitude] Element Tag",fs="[Amplitude] Element Text",ms="[Amplitude] Page URL",gs="https://app.amplitude.com",vs={US:gs,EU:"https://app.eu.amplitude.com",STAGING:"https://apps.stag2.amplitude.com"},ys="data-amp-mask-attributes",bs="data-amp-mask",xs="*****";function ws(t){return"function"==typeof t}function _s(t){var e=t(function(t){Error.call(t),t.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var ks=_s(function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}});function Ss(t,e){if(t){var i=t.indexOf(e);0<=i&&t.splice(i,1)}}var Ps=function(){function t(t){this.initialTeardown=t,this.closed=!1,this.ht=null,this.ft=null}var e;return t.prototype.unsubscribe=function(){var t,e,i,n,r;if(!this.closed){this.closed=!0;var s=this.ht;if(s)if(this.ht=null,Array.isArray(s))try{for(var a=Oe(s),o=a.next();!o.done;o=a.next())o.value.remove(this)}catch(p){t={error:p}}finally{try{o&&!o.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}else s.remove(this);var c=this.initialTeardown;if(ws(c))try{c()}catch(f){r=f instanceof ks?f.errors:[f]}var l=this.ft;if(l){this.ft=null;try{for(var d=Oe(l),u=d.next();!u.done;u=d.next()){var h=u.value;try{$s(h)}catch(m){r=null!=r?r:[],m instanceof ks?r=Ne(Ne([],Ue(r)),Ue(m.errors)):r.push(m)}}}catch(g){i={error:g}}finally{try{u&&!u.done&&(n=d.return)&&n.call(d)}finally{if(i)throw i.error}}}if(r)throw new ks(r)}},t.prototype.add=function(e){var i;if(e&&e!==this)if(this.closed)$s(e);else{if(e instanceof t){if(e.closed||e.gt(this))return;e.vt(this)}(this.ft=null!==(i=this.ft)&&void 0!==i?i:[]).push(e)}},t.prototype.gt=function(t){var e=this.ht;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype.vt=function(t){var e=this.ht;this.ht=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype.yt=function(t){var e=this.ht;e===t?this.ht=null:Array.isArray(e)&&Ss(e,t)},t.prototype.remove=function(e){var i=this.ft;i&&Ss(i,e),e instanceof t&&e.yt(this)},t.EMPTY=((e=new t).closed=!0,e),t}(),Cs=Ps.EMPTY;function Es(t){return t instanceof Ps||t&&"closed"in t&&ws(t.remove)&&ws(t.add)&&ws(t.unsubscribe)}function $s(t){ws(t)?t():t.unsubscribe()}function Ts(t){!function(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];setTimeout.apply(void 0,Ne([t,e],Ue(i)))}(function(){throw t})}function Is(){}function As(t){t()}var Ms=function(t){function e(e){var i=t.call(this)||this;return i.isStopped=!1,e?(i.destination=e,Es(e)&&e.add(i)):i.destination=Os,i}return Ee(e,t),e.create=function(t,e,i){return new Ds(t,e,i)},e.prototype.next=function(t){this.isStopped||this.bt(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this.xt(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this.wt())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype.bt=function(t){this.destination.next(t)},e.prototype.xt=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype.wt=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Ps),Ls=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(i){Fs(i)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(i){Fs(i)}else Fs(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){Fs(e)}},t}(),Ds=function(t){function e(e,i,n){var r,s=t.call(this)||this;return r=ws(e)||!e?{next:null!=e?e:void 0,error:null!=i?i:void 0,complete:null!=n?n:void 0}:e,s.destination=new Ls(r),s}return Ee(e,t),e}(Ms);function Fs(t){Ts(t)}var Os={closed:!0,next:Is,error:function(t){throw t},complete:Is},Us="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ns(t){return t}var zs=function(){function t(t){t&&(this._t=t)}return t.prototype.lift=function(e){var i=new t;return i.source=this,i.operator=e,i},t.prototype.subscribe=function(t,e,i){var n,r=this,s=(n=t)&&n instanceof Ms||function(t){return t&&ws(t.next)&&ws(t.error)&&ws(t.complete)}(n)&&Es(n)?t:new Ds(t,e,i);return As(function(){var t=r,e=t.operator,i=t.source;s.add(e?e.call(s,i):i?r._t(s):r.kt(s))}),s},t.prototype.kt=function(t){try{return this._t(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var i=this;return new(e=qs(e))(function(e,n){var r=new Ds({next:function(e){try{t(e)}catch(i){n(i),r.unsubscribe()}},error:n,complete:e});i.subscribe(r)})},t.prototype._t=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[Us]=function(){return this},t.prototype.pipe=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return(0===(t=e).length?Ns:1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)})(this)},t.prototype.toPromise=function(t){var e=this;return new(t=qs(t))(function(t,i){var n;e.subscribe(function(t){return n=t},function(t){return i(t)},function(){return t(n)})})},t.create=function(e){return new t(e)},t}();function qs(t){var e;return null!==(e=null!=t?t:undefined)&&void 0!==e?e:Promise}function js(t){return function(e){if(function(t){return ws(null==t?void 0:t.lift)}(e))return e.lift(function(e){try{return t(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Rs(t,e,i,n,r){return new Hs(t,e,i,n,r)}var Hs=function(t){function e(e,i,n,r,s,a){var o=t.call(this,e)||this;return o.onFinalize=s,o.shouldUnsubscribe=a,o.bt=i?function(t){try{i(t)}catch(n){e.error(n)}}:t.prototype.bt,o.xt=r?function(t){try{r(t)}catch(i){e.error(i)}finally{this.unsubscribe()}}:t.prototype.xt,o.wt=n?function(){try{n()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype.wt,o}return Ee(e,t),e.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;t.prototype.unsubscribe.call(this),!i&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},e}(Ms),Vs=_s(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Bs=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return Ee(e,t),e.prototype.lift=function(t){var e=new Js(this,this);return e.operator=t,e},e.prototype.St=function(){if(this.closed)throw new Vs},e.prototype.next=function(t){var e=this;As(function(){var i,n;if(e.St(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var r=Oe(e.currentObservers),s=r.next();!s.done;s=r.next())s.value.next(t)}catch(a){i={error:a}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var e=this;As(function(){if(e.St(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var i=e.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;As(function(){if(t.St(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype.kt=function(e){return this.St(),t.prototype.kt.call(this,e)},e.prototype._t=function(t){return this.St(),this.Pt(t),this.Ct(t)},e.prototype.Ct=function(t){var e=this,i=this,n=i.hasError,r=i.isStopped,s=i.observers;return n||r?Cs:(this.currentObservers=null,s.push(t),new Ps(function(){e.currentObservers=null,Ss(s,t)}))},e.prototype.Pt=function(t){var e=this,i=e.hasError,n=e.thrownError,r=e.isStopped;i?t.error(n):r&&t.complete()},e.prototype.asObservable=function(){var t=new zs;return t.source=this,t},e.create=function(t,e){return new Js(t,e)},e}(zs),Js=function(t){function e(e,i){var n=t.call(this)||this;return n.destination=e,n.source=i,n}return Ee(e,t),e.prototype.next=function(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)},e.prototype.error=function(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._t=function(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:Cs},e}(Bs),Gs=function(){return Date.now()},Ks=function(t){function e(e,i){return t.call(this)||this}return Ee(e,t),e.prototype.schedule=function(t,e){return this},e}(Ps),Qs=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.scheduler=e,n.work=i,n.pending=!1,n}return Ee(e,t),e.prototype.schedule=function(t,e){var i;if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(r,this.id,e),this},e.prototype.requestAsyncId=function(t,e,i){return void 0===i&&(i=0),function(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];return setInterval.apply(void 0,Ne([t,e],Ue(i)))}(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,e,i){if(void 0===i&&(i=0),null!=i&&this.delay===i&&!1===this.pending)return e;null!=e&&clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this.Et(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype.Et=function(t,e){var i,n=!1;try{this.work(t)}catch(r){n=!0,i=r||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),i},e.prototype.unsubscribe=function(){if(!this.closed){var e=this.id,i=this.scheduler,n=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Ss(n,this),null!=e&&(this.id=this.recycleAsyncId(i,e,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(Ks),Zs=function(){function t(e,i){void 0===i&&(i=t.now),this.schedulerActionCtor=e,this.now=i}return t.prototype.schedule=function(t,e,i){return void 0===e&&(e=0),new this.schedulerActionCtor(this,t).schedule(i,e)},t.now=Gs,t}(),Ws=new(function(t){function e(e,i){void 0===i&&(i=Zs.now);var n=t.call(this,e,i)||this;return n.actions=[],n.$t=!1,n}return Ee(e,t),e.prototype.flush=function(t){var e=this.actions;if(this.$t)e.push(t);else{var i;this.$t=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.$t=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}},e}(Zs))(Qs),Ys=Ws,Xs=new zs(function(t){return t.complete()});function ta(t){return t&&ws(t.schedule)}function ea(t){return t[t.length-1]}var ia=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function na(t){return ws(null==t?void 0:t.then)}function ra(t){return ws(t[Us])}function sa(t){return Symbol.asyncIterator&&ws(null==t?void 0:t[Symbol.asyncIterator])}function aa(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var oa="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function ca(t){return ws(null==t?void 0:t[oa])}function la(t){return function(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,r=i.apply(t,e||[]),s=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(t){return function(e){return Promise.resolve(e).then(t,l)}}),n[Symbol.asyncIterator]=function(){return this},n;function a(t,e){r[t]&&(n[t]=function(e){return new Promise(function(i,n){s.push([t,e,i,n])>1||o(t,e)})},e&&(n[t]=e(n[t])))}function o(t,e){try{(i=r[t](e)).value instanceof ze?Promise.resolve(i.value.v).then(c,l):d(s[0][2],i)}catch(n){d(s[0][3],n)}var i}function c(t){o("next",t)}function l(t){o("throw",t)}function d(t,e){t(e),s.shift(),s.length&&o(s[0][0],s[0][1])}}(this,arguments,function(){var e,i,n;return Fe(this,function(r){switch(r.label){case 0:e=t.getReader(),r.label=1;case 1:r.trys.push([1,,9,10]),r.label=2;case 2:return[4,ze(e.read())];case 3:return i=r.sent(),n=i.value,i.done?[4,ze(void 0)]:[3,5];case 4:return[2,r.sent()];case 5:return[4,ze(n)];case 6:return[4,r.sent()];case 7:return r.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function da(t){return ws(null==t?void 0:t.getReader)}function ua(t){if(t instanceof zs)return t;if(null!=t){if(ra(t))return r=t,new zs(function(t){var e=r[Us]();if(ws(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")});if(ia(t))return n=t,new zs(function(t){for(var e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()});if(na(t))return i=t,new zs(function(t){i.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,Ts)});if(sa(t))return ha(t);if(ca(t))return e=t,new zs(function(t){var i,n;try{for(var r=Oe(e),s=r.next();!s.done;s=r.next()){var a=s.value;if(t.next(a),t.closed)return}}catch(o){i={error:o}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}t.complete()});if(da(t))return ha(la(t))}var e,i,n,r;throw aa(t)}function ha(t){return new zs(function(e){(function(t,e){var i,n,r,s;return De(this,void 0,void 0,function(){var a,o;return Fe(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),i=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,i=t[Symbol.asyncIterator];return i?i.call(t):(t=Oe(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(i){e[i]=t[i]&&function(e){return new Promise(function(n,r){!function(t,e,i,n){Promise.resolve(n).then(function(e){t({value:e,done:i})},e)}(n,r,(e=t[i](e)).done,e.value)})}}}(t),c.label=1;case 1:return[4,i.next()];case 2:if((n=c.sent()).done)return[3,4];if(a=n.value,e.next(a),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=c.sent(),r={error:o},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(s=i.return)?[4,s.call(i)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})})(t,e).catch(function(t){return e.error(t)})})}function pa(t,e,i,n,r){void 0===n&&(n=0),void 0===r&&(r=!1);var s=e.schedule(function(){i(),r?t.add(this.schedule(null,n)):this.unsubscribe()},n);if(t.add(s),!r)return s}function fa(t,e){return void 0===e&&(e=0),js(function(i,n){i.subscribe(Rs(n,function(i){return pa(n,t,function(){return n.next(i)},e)},function(){return pa(n,t,function(){return n.complete()},e)},function(i){return pa(n,t,function(){return n.error(i)},e)}))})}function ma(t,e){return void 0===e&&(e=0),js(function(i,n){n.add(t.schedule(function(){return i.subscribe(n)},e))})}function ga(t,e){if(!t)throw new Error("Iterable cannot be null");return new zs(function(i){pa(i,e,function(){var n=t[Symbol.asyncIterator]();pa(i,e,function(){n.next().then(function(t){t.done?i.complete():i.next(t.value)})},0,!0)})})}function va(t){return t instanceof Date&&!isNaN(t)}var ya=_s(function(t){return function(e){void 0===e&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function ba(t){throw new ya(t)}function xa(t,e){return js(function(i,n){var r=0;i.subscribe(Rs(n,function(i){n.next(t.call(e,i,r++))}))})}var wa=Array.isArray;function _a(t,e,i){return void 0===i&&(i=1/0),ws(e)?_a(function(i,n){return xa(function(t,r){return e(i,t,n,r)})(ua(t(i,n)))},i):("number"==typeof e&&(i=e),js(function(e,n){return function(t,e,i,n){var r=[],s=0,a=0,o=!1,c=function(){!o||r.length||s||e.complete()},l=function(t){s++;var o=!1;ua(i(t,a++)).subscribe(Rs(e,function(t){e.next(t)},function(){o=!0},void 0,function(){if(o)try{s--;for(var t=function(){var t=r.shift();l(t)};r.length&&s<n;)t();c()}catch(i){e.error(i)}}))};return t.subscribe(Rs(e,function(t){return s<n?l(t):r.push(t)},function(){o=!0,c()})),function(){}}(e,n,t,i)}))}var ka=["addListener","removeListener"],Sa=["addEventListener","removeEventListener"],Pa=["on","off"];function Ca(t,e,i,n){if(ws(i)&&(n=i,i=void 0),n)return Ca(t,e,i).pipe((r=n,xa(function(t){return function(t,e){return wa(e)?t.apply(void 0,Ne([],Ue(e))):t(e)}(r,t)})));var r,s=Ue(function(t){return ws(t.addEventListener)&&ws(t.removeEventListener)}(t)?Sa.map(function(n){return function(r){return t[n](e,r,i)}}):function(t){return ws(t.addListener)&&ws(t.removeListener)}(t)?ka.map(Ea(t,e)):function(t){return ws(t.on)&&ws(t.off)}(t)?Pa.map(Ea(t,e)):[],2),a=s[0],o=s[1];if(!a&&ia(t))return _a(function(t){return Ca(t,e,i)})(ua(t));if(!a)throw new TypeError("Invalid event target");return new zs(function(t){var e=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.next(1<e.length?e:e[0])};return a(e),function(){return o(e)}})}function Ea(t,e){return function(i){return function(n){return t[i](e,n)}}}function $a(t,e,i){void 0===t&&(t=0),void 0===i&&(i=Ys);var n=-1;return null!=e&&(ta(e)?i=e:n=e),new zs(function(e){var r=va(t)?+t-i.now():t;r<0&&(r=0);var s=0;return i.schedule(function(){e.closed||(e.next(s++),0<=n?this.schedule(void 0,n):e.complete())},r)})}function Ta(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=function(t){return ta(ea(t))?t.pop():void 0}(t),n=function(t){return"number"==typeof ea(t)?t.pop():1/0}(t),r=t;return r.length?1===r.length?ua(r[0]):function(t){return void 0===t&&(t=1/0),_a(Ns,t)}(n)(function(t,e){return e?function(t,e){if(null!=t){if(ra(t))return function(t,e){return ua(t).pipe(ma(e),fa(e))}(t,e);if(ia(t))return function(t,e){return new zs(function(i){var n=0;return e.schedule(function(){n===t.length?i.complete():(i.next(t[n++]),i.closed||this.schedule())})})}(t,e);if(na(t))return function(t,e){return ua(t).pipe(ma(e),fa(e))}(t,e);if(sa(t))return ga(t,e);if(ca(t))return function(t,e){return new zs(function(i){var n;return pa(i,e,function(){n=t[oa](),pa(i,e,function(){var t,e,r;try{e=(t=n.next()).value,r=t.done}catch(s){return void i.error(s)}r?i.complete():i.next(e)},0,!0)}),function(){return ws(null==n?void 0:n.return)&&n.return()}})}(t,e);if(da(t))return function(t,e){return ga(la(t),e)}(t,e)}throw aa(t)}(t,e):ua(t)}(r,i)):Xs}var Ia=Array.isArray;function Aa(t,e){return js(function(i,n){var r=0;i.subscribe(Rs(n,function(i){return t.call(e,i,r++)&&n.next(i)}))})}function Ma(t){return t<=0?function(){return Xs}:js(function(e,i){var n=0;e.subscribe(Rs(i,function(e){++n<=t&&(i.next(e),t<=n&&i.complete())}))})}function La(t){void 0===t&&(t={});var e=t.connector,i=void 0===e?function(){return new Bs}:e,n=t.resetOnError,r=void 0===n||n,s=t.resetOnComplete,a=void 0===s||s,o=t.resetOnRefCountZero,c=void 0===o||o;return function(t){var e,n,s,o=0,l=!1,d=!1,u=function(){null==n||n.unsubscribe(),n=void 0},h=function(){u(),e=s=void 0,l=d=!1},p=function(){var t=e;h(),null==t||t.unsubscribe()};return js(function(t,f){o++,d||l||u();var m=s=null!=s?s:i();f.add(function(){0!==--o||d||l||(n=Da(p,c))}),m.subscribe(f),!e&&o>0&&(e=new Ds({next:function(t){return m.next(t)},error:function(t){d=!0,u(),n=Da(h,r,t),m.error(t)},complete:function(){l=!0,u(),n=Da(h,a),m.complete()}}),ua(t).subscribe(e))})(t)}}function Da(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];if(!0!==e){if(!1!==e){var r=new Ds({next:function(){r.unsubscribe(),t()}});return ua(e.apply(void 0,Ne([],Ue(i)))).subscribe(r)}}else t()}function Fa(t,e,i){void 0===e&&(e=Ws);var n=$a(t,e);return function(t,e){return js(function(t,i){var r=null!=e?e:{},s=r.leading,a=void 0===s||s,o=r.trailing,c=void 0!==o&&o,l=!1,d=null,u=null,h=!1,p=function(){null==u||u.unsubscribe(),u=null,c&&(g(),h&&i.complete())},f=function(){u=null,h&&i.complete()},m=function(t){return u=ua(n).subscribe(Rs(i,p,f))},g=function(){if(l){l=!1;var t=d;d=null,i.next(t),!h&&m()}};t.subscribe(Rs(i,function(t){l=!0,d=t,(!u||u.closed)&&(a?g():m())},function(){h=!0,(!(c&&l&&u)||u.closed)&&i.complete()}))})}(0,i)}var Oa=["input","select","textarea"],Ua=function(t,e){var i,n=null===(i=null===window||void 0===window?void 0:window.getComputedStyle)||void 0===i?void 0:i.call(window,t);return"pointer"===(null==n?void 0:n.getPropertyValue("cursor"))&&"click"===e},Na=function(t,e,i){return void 0===i&&(i=!1),function(n,r){var s,a,o=t.pageUrlAllowlist,c=t.pageUrlExcludelist,l=t.shouldTrackEventResolver,d=null===(a=null===(s=null==r?void 0:r.tagName)||void 0===s?void 0:s.toLowerCase)||void 0===a?void 0:a.call(s);if(!d)return!1;if(l)return l(n,r);if(!rn(window.location.href,o))return!1;if(c&&c.length>0&&rn(window.location.href,c))return!1;var u=String(null==r?void 0:r.getAttribute("type"))||"";if("string"==typeof u)switch(u.toLowerCase()){case"hidden":case"password":return!1}var h=Ua(r,n);if(i&&h)return!0;if(e&&!e.some(function(t){var e;return!!(null===(e=null==r?void 0:r.matches)||void 0===e?void 0:e.call(r,t))}))return!1;switch(d){case"input":case"select":case"textarea":return"change"===n||"click"===n;default:return!!h||"click"===n}}},za=function(t){return t?t.split(",").map(function(t){return t.trim()}).filter(function(t){return t.length>0&&"id"!==t&&"class"!==t}):[]},qa=function(t){return Object.keys(t).reduce(function(e,i){var n=t[i];return function(t){return null==t||"object"==typeof t&&0===Object.keys(t).length||"string"==typeof t&&0===t.trim().length}(n)||(e[i]=n),e},{})},ja=function(t,e){return t?e.some(function(e){var i;return null===(i=null==t?void 0:t.matches)||void 0===i?void 0:i.call(t,e)})?t:ja(null==t?void 0:t.parentElement,e):null},Ra=function(t){return!(null===t.event.target||!t.closestTrackedAncestor)},Ha=new Set(["id","class","style","value","onclick","onchange","oninput","onblur","onsubmit","onfocus","onkeydown","onkeyup","onkeypress","data-reactid","data-react-checksum","data-reactroot",ys,bs]),Va=["type"],Ba=["svg","path","g"],Ja=["password","hidden"];var Ga=function(t,e,i){t.forEach(function(t){if("string"!=typeof t&&"ATTACH_EVENT_PROPERTY"===t.actionType){var n=i.extractDataFromDataSource(t.dataSource,e.closestTrackedAncestor);e.targetElementProperties[t.destinationKey]=n}})},Ka=/\b(?:\d[ -]*?){13,16}\b/,Qa=/(\d{3}-?\d{2}-?\d{4})/g,Za=/[^\s@]+@[^\s@.]+\.[^\s@]+/g,Wa=function(){return function(t){var e,i,n,r=this;this.replaceSensitiveString=function(t){var e,i;if("string"!=typeof t)return"";var n=t;n=(n=(n=n.replace(Ka,xs)).replace(Qa,xs)).replace(Za,xs);try{for(var s=Oe(r.additionalMaskTextPatterns),a=s.next();!a.done;a=s.next()){var o=a.value;try{n=n.replace(o,xs)}catch(c){}}}catch(l){e={error:l}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}return n},this.getHierarchy=function(t){var e,i,n,s;if(!t)return[];for(var a=function(t){var e=[];if(!t)return e;e.push(t);for(var i=t.parentElement;i&&"HTML"!==i.tagName;)e.push(i),i=i.parentElement;return e}(t),o=new Map,c=a.length-1;c>=0;c--){var l=a[c];if(l){var d=za(l.getAttribute(ys)),u=c===a.length-1?[]:null!==(n=o.get(a[c+1]))&&void 0!==n?n:new Set,h=new Set(Ne(Ne([],Ue(u),!1),Ue(d),!1));o.set(l,h)}}s=a.map(function(t){var e;return function(t,e){var i,n,r,s,a,o;if(null===t)return null;var c=String(t.tagName).toLowerCase(),l={tag:c},d=Array.from(null!==(s=null===(r=t.parentElement)||void 0===r?void 0:r.children)&&void 0!==s?s:[]);d.length&&(l.index=d.indexOf(t),l.indexOfType=d.filter(function(e){return e.tagName===t.tagName}).indexOf(t));var u=null===(o=null===(a=t.previousElementSibling)||void 0===a?void 0:a.tagName)||void 0===o?void 0:o.toLowerCase();u&&(l.prevSib=String(u));var h=t.getAttribute("id");h&&(l.id=String(h));var p=Array.from(t.classList);p.length&&(l.classes=p);var f={},m=Array.from(t.attributes).filter(function(t){return!Ha.has(t.name)}),g=!function(t){var e,i,n,r=null===(i=null===(e=null==t?void 0:t.tagName)||void 0===e?void 0:e.toLowerCase)||void 0===i?void 0:i.call(e),s=t instanceof HTMLElement&&"true"===(null===(n=t.getAttribute("contenteditable"))||void 0===n?void 0:n.toLowerCase());return!Oa.includes(r)&&!s}(t);if(!Ja.includes(String(t.getAttribute("type")))&&!Ba.includes(c))try{for(var v=Oe(m),y=v.next();!y.done;y=v.next()){var b=y.value;g&&!Va.includes(b.name)||(e.has(b.name)?f[b.name]=xs:f[b.name]=String(b.value).substring(0,128))}}catch(x){i={error:x}}finally{try{y&&!y.done&&(n=v.return)&&n.call(v)}finally{if(i)throw i.error}}return Object.keys(f).length&&(l.attrs=f),l}(t,null!==(e=o.get(t))&&void 0!==e?e:new Set)});var p=function(t){(null==t?void 0:t.attrs)&&Object.entries(t.attrs).forEach(function(e){var i=Ue(e,2),n=i[0],s=i[1];t.attrs&&(t.attrs[n]=r.replaceSensitiveString(s))})};try{for(var f=Oe(s),m=f.next();!m.done;m=f.next())p(m.value)}catch(g){e={error:g}}finally{try{m&&!m.done&&(i=f.return)&&i.call(f)}finally{if(e)throw e.error}}return s},this.getNearestLabel=function(t){var e,i=t.parentElement;if(!i)return"";try{e=i.querySelector(":scope>span,h1,h2,h3,h4,h5,h6")}catch(n){e=null}return e?r.getText(e):r.getNearestLabel(i)},this.getEventProperties=function(t,e,i){var n,s,a,o,c,l,d=null===(a=null===(s=null==e?void 0:e.tagName)||void 0===s?void 0:s.toLowerCase)||void 0===a?void 0:a.call(s),u="function"==typeof e.getBoundingClientRect?e.getBoundingClientRect():{left:null,top:null},h=r.getHierarchy(e),p=null===(o=h[0])||void 0===o?void 0:o.attrs,f=r.getNearestLabel(e),m=(c=null!=p?p:{},l=i,Object.entries(c).reduce(function(t,e){var i=Ue(e,2),n=i[0],r=i[1];if(n.startsWith(l)){var s=n.replace(l,"");s&&(t[s]=r||"")}return t},{})),g=((n={})["[Amplitude] Element Hierarchy"]=h,n[ps]=d,n[fs]=r.getText(e),n["[Amplitude] Element Position Left"]=null==u.left?null:Math.round(u.left),n["[Amplitude] Element Position Top"]=null==u.top?null:Math.round(u.top),n["[Amplitude] Element Attributes"]=m,n["[Amplitude] Element Parent Label"]=f,n[ms]=window.location.href.split("?")[0],n["[Amplitude] Page Title"]="undefined"!=typeof document&&r.replaceSensitiveString(document.title)||"",n["[Amplitude] Viewport Height"]=window.innerHeight,n["[Amplitude] Viewport Width"]=window.innerWidth,n);return g["[Amplitude] Element ID"]=e.getAttribute("id")||"",g["[Amplitude] Element Class"]=e.getAttribute("class"),g["[Amplitude] Element Aria Label"]=null==p?void 0:p["aria-label"],"a"===d&&"click"===t&&e instanceof HTMLAnchorElement&&(g["[Amplitude] Element Href"]=r.replaceSensitiveString(e.href)),qa(g)},this.addAdditionalEventProperties=function(t,e,i,n,s){void 0===s&&(s=!1);var a={event:t,timestamp:Date.now(),type:e};if(function(t){return"click"===t.type||"change"===t.type}(a)&&null!==a.event.target){if(s&&Ua(a.event.target,a.type))return a.closestTrackedAncestor=a.event.target,a.targetElementProperties=r.getEventProperties(a.type,a.closestTrackedAncestor,n),a;var o=ja(a.event.target,i);return o&&(a.closestTrackedAncestor=o,a.targetElementProperties=r.getEventProperties(a.type,o,n)),a}return a},this.extractDataFromDataSource=function(t,e){if("DOM_ELEMENT"===t.sourceType){var i=function(t,e){try{if("DOM_ELEMENT"===t.sourceType){var i=document.documentElement;return t.scope&&e&&(i=e.closest(t.scope)),i&&t.selector?i.querySelector(t.selector):i}}catch(n){return}}(t,e);if(!i)return;return"TEXT"===t.elementExtractType?r.getText(i):"ATTRIBUTE"===t.elementExtractType&&t.attribute?i.getAttribute(t.attribute):void 0}},this.getText=function(t){if(null!==t.closest("[".concat(bs,"]")))return xs;var e="";if(t.querySelector("[".concat(bs,"], [contenteditable]"))){var i=t.cloneNode(!0);i.querySelectorAll("[".concat(bs,"], [contenteditable]")).forEach(function(t){t.innerText=xs}),e=i.innerText||""}else e=t.innerText||"";return r.replaceSensitiveString(e.substring(0,255)).replace(/\s+/g," ").trim()},this.getEventTagProps=function(t){var e,i,n;if(!t)return{};var s=null===(n=null===(i=null==t?void 0:t.tagName)||void 0===i?void 0:i.toLowerCase)||void 0===n?void 0:n.call(i),a=((e={})[ps]=s,e[fs]=r.getText(t),e[ms]=window.location.href.split("?")[0],e);return qa(a)};var s=null!==(n=t.maskTextRegex)&&void 0!==n?n:[],a=[];try{for(var o=Oe(s),c=o.next();!c.done;c=o.next()){var l=c.value;if(a.length>=25)break;if(l instanceof RegExp)a.push(l);else if("pattern"in l&&"string"==typeof l.pattern)try{a.push(new RegExp(l.pattern,"i"))}catch(d){}}}catch(u){e={error:u}}finally{try{c&&!c.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}this.additionalMaskTextPatterns=a}}(),Ya=function(){function t(t){var e=(void 0===t?{}:t).origin,i=void 0===e?gs:e,n=this;this.endpoint=gs,this.requestCallbacks={},this.onSelect=function(t){n.notify({action:"element-selected",data:t})},this.onTrack=function(t,e){"selector-mode-changed"===t?n.notify({action:"track-selector-mode-changed",data:e}):"selector-moved"===t&&n.notify({action:"track-selector-moved",data:e})},this.endpoint=i}return t.prototype.notify=function(t){var e,i,n,r;null===(i=null===(e=this.logger)||void 0===e?void 0:e.debug)||void 0===i||i.call(e,"Message sent: ",JSON.stringify(t)),null===(r=null===(n=window.opener)||void 0===n?void 0:n.postMessage)||void 0===r||r.call(n,t,this.endpoint)},t.prototype.sendRequest=function(t,e,i){var n=this;void 0===i&&(i={timeout:15e3});var r="".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),s={id:r,action:t,args:e};return new Promise(function(e,a){n.requestCallbacks[r]={resolve:e,reject:a},n.notify(s),(null==i?void 0:i.timeout)>0&&setTimeout(function(){a(new Error("".concat(t," timed out (id: ").concat(r,")"))),delete n.requestCallbacks[r]},i.timeout)})},t.prototype.handleResponse=function(t){var e;this.requestCallbacks[t.id]?(this.requestCallbacks[t.id].resolve(t.responseData),delete this.requestCallbacks[t.id]):null===(e=this.logger)||void 0===e||e.warn("No callback found for request id: ".concat(t.id))},t.prototype.setup=function(t){var e=this,i=void 0===t?{dataExtractor:new Wa({})}:t,n=i.logger,r=i.endpoint,s=i.isElementSelectable,a=i.cssSelectorAllowlist,o=i.actionClickAllowlist,c=i.dataExtractor;this.logger=n,r&&this.endpoint===gs&&(this.endpoint=r);var l=null;window.addEventListener("message",function(t){var i,n,r,d,u;if(null===(n=null===(i=e.logger)||void 0===i?void 0:i.debug)||void 0===n||n.call(i,"Message received: ",JSON.stringify(t)),e.endpoint===t.origin){var h,p=null==t?void 0:t.data,f=null==p?void 0:p.action;if(f)if("id"in p)null===(d=null===(r=e.logger)||void 0===r?void 0:r.debug)||void 0===d||d.call(r,"Received Response to previous request: ",JSON.stringify(t)),e.handleResponse(p);else if("ping"===f)e.notify({action:"pong"});else if("initialize-visual-tagging-selector"===f){var m=null==p?void 0:p.data;(h="https://cdn.amplitude.com/libs/visual-tagging-selector-1.0.0-alpha.js.gz",new Promise(function(t,e){var i;try{var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=h,n.addEventListener("load",function(){t({status:!0})},{once:!0}),n.addEventListener("error",function(){e({status:!1,message:"Failed to load the script ".concat(h)})}),null===(i=document.head)||void 0===i||i.appendChild(n)}catch(r){e(r)}})).then(function(){var t;l=null===(t=null===window||void 0===window?void 0:window.amplitudeVisualTaggingSelector)||void 0===t?void 0:t.call(window,{getEventTagProps:c.getEventTagProps,isElementSelectable:function(t){return!s||s((null==m?void 0:m.actionType)||"click",t)},onTrack:e.onTrack,onSelect:e.onSelect,visualHighlightClass:"amp-visual-tagging-selector-highlight",messenger:e,cssSelectorAllowlist:a,actionClickAllowlist:o,extractDataFromDataSource:c.extractDataFromDataSource,dataExtractor:c,diagnostics:{autocapture:{version:"1.12.1"}}}),e.notify({action:"selector-loaded"})}).catch(function(){var t;null===(t=e.logger)||void 0===t||t.warn("Failed to initialize visual tagging selector")})}else"close-visual-tagging-selector"===f&&(null===(u=null==l?void 0:l.close)||void 0===u||u.call(l))}}),this.notify({action:"page-loaded"})},t}();function Xa(t){var e,i,n,r=t.amplitude,s=t.allObservables,a=t.options,o=t.shouldTrackEvent,c=t.evaluateTriggers,l=s.clickObservable,d=Ta(l.pipe(js(function(t,e){var i,n=!1;t.subscribe(Rs(e,function(t){var r=i;i=t,n&&e.next([r,t]),n=!0}))}),Aa(function(t){var e=Ue(t,2),i=e[0],n=e[1],r=i.event.target!==n.event.target,s=Math.abs(n.event.screenX-i.event.screenX)<=20&&Math.abs(n.event.screenY-i.event.screenY)<=20;return r&&!s})),l.pipe((e=a.debounceTime,void 0===i&&(i=Ws),js(function(t,n){var r=null,s=null,a=null,o=function(){if(r){r.unsubscribe(),r=null;var t=s;s=null,n.next(t)}};function c(){var t=a+e,s=i.now();if(s<t)return r=this.schedule(void 0,t-s),void n.add(r);o()}t.subscribe(Rs(n,function(t){s=t,a=i.now(),r||(r=i.schedule(c,e),n.add(r))},function(){o(),n.complete()},void 0,function(){s=r=null}))})),xa(function(){return"timeout"}))),u=l.pipe(function(t,e){void 0===e&&(e=Ws);var i,n=$a(0,e);return i=function(){return n},_a(function(t,e){return ua(i(t,e)).pipe(Ma(1),function(t){return xa(function(){return t})}(t))})}(),Aa(Ra),Aa(function(t){return o("click",t.closestTrackedAncestor)}),xa(function(t){return c(t)}),(n=d,js(function(t,e){var i=[];return t.subscribe(Rs(e,function(t){return i.push(t)},function(){e.next(i),e.complete()})),ua(n).subscribe(Rs(e,function(){var t=i;i=[],e.next(t)},Is)),function(){i=null}})));return u.subscribe(function(t){var e,i,n=(t.length,us);try{for(var s=Oe(t),a=s.next();!a.done;a=s.next()){var o=a.value;null==r||r.track(n,o.targetElementProperties)}}catch(c){e={error:c}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}})}var to,eo,io=function(){return new zs(function(t){var e=new MutationObserver(function(e){t.next(e)});return e.observe(document.body,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),function(){return e.disconnect()}})},no=function(t){return void 0===t&&(t="click"),Ca(document,t,{capture:!0})},ro={"[Amplitude] Element Clicked":"click","[Amplitude] Element Changed":"change"},so=function(t){var e,i,n,r,s=Object.values(ro).reduce(function(t,e){return t[e]=new Set,t},{});if(!t)return s;try{for(var a=Oe(t),o=a.next();!o.done;o=a.next()){var c=o.value;try{try{for(var l=(n=void 0,Oe(c.definition)),d=l.next();!d.done;d=l.next()){var u=d.value,h=ro[u.event_type];h&&s[h].add(c.id)}}catch(p){n={error:p}}finally{try{d&&!d.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}catch(f){}}}catch(m){e={error:m}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}return s},ao=function(t){var e,i,n,r,s=new Map;try{for(var a=Oe(t),o=a.next();!o.done;o=a.next()){var c=o.value;try{for(var l=(n=void 0,Oe(c.conditions)),d=l.next();!d.done;d=l.next()){var u=d.value;if("LABELED_EVENT"===u.type){var h=u.match.eventId,p=s.get(h);p||(p=[],s.set(h,p)),p.push(c)}}}catch(f){n={error:f}}finally{try{d&&!d.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}}catch(m){e={error:m}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}return s},oo=function(){function t(t,e,i,n){this.groupedLabeledEvents=t,this.labeledEventToTriggerMap=e,this.dataExtractor=i,this.options=n}return t.prototype.evaluate=function(t){var e,i,n=this.options.pageActions;if(!n)return t;var r=function(t,e){return e.filter(function(e){return e.definition.some(function(e){return ro[e.event_type]===t.type&&e.filters.every(function(e){return function(t,e){try{if("[Amplitude] Element Text"===e.subprop_key)return"is"===e.subprop_op&&e.subprop_value.includes(t.targetElementProperties["[Amplitude] Element Text"]);if("[Amplitude] Element Hierarchy"===e.subprop_key)return"autotrack css match"===e.subprop_op&&!!t.closestTrackedAncestor.closest(e.subprop_value.toString())}catch(i){return!1}return!1}(t,e)})})})}(t,Array.from(this.groupedLabeledEvents[t.type]).map(function(t){return n.labeledEvents[t]})),s=function(t,e){var i,n,r,s,a=new Set;try{for(var o=Oe(t),c=o.next();!c.done;c=o.next()){var l=c.value,d=e.get(l.id);if(d)try{for(var u=(r=void 0,Oe(d)),h=u.next();!h.done;h=u.next()){var p=h.value;a.add(p)}}catch(f){r={error:f}}finally{try{h&&!h.done&&(s=u.return)&&s.call(u)}finally{if(r)throw r.error}}}}catch(m){i={error:m}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return Array.from(a)}(r,this.labeledEventToTriggerMap);try{for(var a=Oe(s),o=a.next();!o.done;o=a.next()){var c=o.value;Ga(c.actions,t,this.dataExtractor)}}catch(l){e={error:l}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}return t},t.prototype.update=function(t,e,i){this.groupedLabeledEvents=t,this.labeledEventToTriggerMap=e,this.options=i},t}();(eo=to||(to={})).ClickObservable="clickObservable",eo.ChangeObservable="changeObservable",eo.NavigateObservable="navigateObservable",eo.MutationObservable="mutationObservable";var co=function(t){var e,i,n,r,s,a,o,c;void 0===t&&(t={});var l=t.dataAttributePrefix,d=void 0===l?fn:l,u=t.visualTaggingOptions,h=void 0===u?{enabled:!0,messenger:new Ya}:u;t.cssSelectorAllowlist=null!==(e=t.cssSelectorAllowlist)&&void 0!==e?e:pn,t.actionClickAllowlist=null!==(i=t.actionClickAllowlist)&&void 0!==i?i:mn,t.debounceTime=null!==(n=t.debounceTime)&&void 0!==n?n:0,t.pageUrlExcludelist=null===(r=t.pageUrlExcludelist)||void 0===r?void 0:r.reduce(function(t,e){if("string"==typeof e&&t.push(e),e instanceof RegExp&&t.push(e),"object"==typeof e&&null!==e&&"pattern"in e)try{t.push(new RegExp(e.pattern))}catch(i){return t}return t},[]);var p="@amplitude/plugin-autocapture-browser",f=[],m=new Wa(t),g=so(Object.values(null!==(a=null===(s=t.pageActions)||void 0===s?void 0:s.labeledEvents)&&void 0!==a?a:{})),v=ao(null!==(c=null===(o=t.pageActions)||void 0===o?void 0:o.triggers)&&void 0!==c?c:[]),y=function(t,e,i,n){return new oo(t,e,i,n)}(g,v,m,t);return{name:p,type:"enrichment",setup:function(e,i){return De(void 0,void 0,void 0,function(){var n,r,s,a,o,c,l,u,b,x;return Fe(this,function(w){return"undefined"==typeof document||(e.fetchRemoteConfig&&function(t){var e=t.localConfig,i=t.configKeys;return De(void 0,void 0,void 0,function(){return Fe(this,function(t){return[2,new ds({localConfig:e,configKeys:i})]})})}({localConfig:e,configKeys:["analyticsSDK.pageActions"]}).then(function(i){return De(void 0,void 0,void 0,function(){var n,r;return Fe(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,i.getRemoteConfig("analyticsSDK","pageActions")];case 1:return function(e){var i,n;e&&(t.pageActions=Me(Me({},t.pageActions),e),g=so(Object.values(null!==(i=t.pageActions.labeledEvents)&&void 0!==i?i:{})),v=ao(null!==(n=t.pageActions.triggers)&&void 0!==n?n:[]),y.update(g,v,t))}(s.sent()),[3,3];case 2:return n=s.sent(),null===(r=null==e?void 0:e.loggerProvider)||void 0===r||r.error("Failed to fetch remote config: ".concat(String(n))),[3,3];case 3:return[2]}})})}).catch(function(t){var i;null===(i=null==e?void 0:e.loggerProvider)||void 0===i||i.error("Failed to create remote config fetch: ".concat(String(t)))}),n=Na(t,t.cssSelectorAllowlist),r=Na(t,t.actionClickAllowlist),s=function(){var e,i,n=no().pipe(xa(function(e){return m.addAdditionalEventProperties(e,"click",t.cssSelectorAllowlist,d)}),La()),r=Ca(document,"change",{capture:!0}).pipe(xa(function(e){return m.addAdditionalEventProperties(e,"change",t.cssSelectorAllowlist,d)}),La());window.navigation&&(i=Ca(window.navigation,"navigate").pipe(xa(function(e){return m.addAdditionalEventProperties(e,"navigate",t.cssSelectorAllowlist,d)}),La()));var s=io().pipe(xa(function(e){return m.addAdditionalEventProperties(e,"mutation",t.cssSelectorAllowlist,d)}),La());return(e={})[to.ClickObservable]=n,e[to.ChangeObservable]=r,e[to.NavigateObservable]=i,e[to.MutationObservable]=s,e}(),a=Xa({allObservables:s,options:t,amplitude:i,shouldTrackEvent:n,evaluateTriggers:y.evaluate.bind(y)}),f.push(a),o=function(t){var e=t.amplitude,i=t.getEventProperties,n=t.shouldTrackEvent,r=t.evaluateTriggers;return t.allObservables.changeObservable.pipe(Aa(Ra),Aa(function(t){return n("change",t.closestTrackedAncestor)}),xa(function(t){return r(t)})).subscribe(function(t){null==e||e.track("[Amplitude] Element Changed",i("change",t.closestTrackedAncestor))})}({allObservables:s,getEventProperties:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return m.getEventProperties.apply(m,Ne(Ne([],Ue(t),!1),[d],!1))},amplitude:i,shouldTrackEvent:n,evaluateTriggers:y.evaluate.bind(y)}),f.push(o),c=function(t){var e=t.amplitude,i=t.allObservables,n=t.options,r=t.getEventProperties,s=t.shouldTrackEvent,a=t.shouldTrackActionClick,o=i.clickObservable,c=i.mutationObservable,l=i.navigateObservable,d=o.pipe(Aa(function(t){return!s("click",t.closestTrackedAncestor)}),xa(function(t){var e=ja(t.event.target,n.actionClickAllowlist);return t.closestTrackedAncestor=e,null!==t.closestTrackedAncestor&&(t.targetElementProperties=r(t.type,t.closestTrackedAncestor)),t}),Aa(Ra),Aa(function(t){return a("click",t.closestTrackedAncestor)})),u=[c];l&&u.push(l);var h,p=Ta.apply(void 0,Ne([],Ue(u),!1)),f=d.pipe((h=function(t){return p.pipe(Ma(1),function(t){var e=va(t)?{first:t}:t,i=e.first,n=e.each,r=e.with,s=void 0===r?ba:r,a=e.scheduler,o=void 0===a?Ws:a,c=e.meta,l=void 0===c?null:c;if(null==i&&null==n)throw new TypeError("No timeout provided.");return js(function(t,e){var r,a,c=null,d=0,u=function(t){a=pa(e,o,function(){try{r.unsubscribe(),ua(s({meta:l,lastValue:c,seen:d})).subscribe(e)}catch(t){e.error(t)}},t)};r=t.subscribe(Rs(e,function(t){null==a||a.unsubscribe(),d++,e.next(c=t),n>0&&u(n)},void 0,void 0,function(){(null==a?void 0:a.closed)||null==a||a.unsubscribe(),c=null})),!d&&u(null!=i?"number"==typeof i?i:+i-o.now():n)})}({first:500,with:function(){return Xs}}),xa(function(){return t}))},js(function(t,e){var i=null,n=!1,r=function(){return n&&!i&&e.complete()};t.subscribe(Rs(e,function(t){null==i||i.unsubscribe(),ua(h(t)).subscribe(i=Rs(e,function(t){return e.next(t)},function(){i=null,r()}))},function(){n=!0,r()}))})));return f.subscribe(function(t){null==e||e.track(us,r("click",t.closestTrackedAncestor))})}({allObservables:s,options:t,getEventProperties:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return m.getEventProperties.apply(m,Ne(Ne([],Ue(t),!1),[d],!1))},amplitude:i,shouldTrackEvent:n,shouldTrackActionClick:r}),f.push(c),null===(b=null==e?void 0:e.loggerProvider)||void 0===b||b.log("".concat(p," has been successfully added.")),window.opener&&h.enabled&&(l=t.cssSelectorAllowlist,u=t.actionClickAllowlist,null===(x=h.messenger)||void 0===x||x.setup(Me(Me({dataExtractor:m,logger:null==e?void 0:e.loggerProvider},(null==e?void 0:e.serverZone)&&{endpoint:vs[e.serverZone]}),{isElementSelectable:Na(t,Ne(Ne([],Ue(l),!1),Ue(u),!1)),cssSelectorAllowlist:l,actionClickAllowlist:u})))),[2]})})},execute:function(t){return De(void 0,void 0,void 0,function(){return Fe(this,function(e){return[2,t]})})},teardown:function(){return De(void 0,void 0,void 0,function(){var t,e,i,n;return Fe(this,function(r){try{for(t=Oe(f),e=t.next();!e.done;e=t.next())e.value.unsubscribe()}catch(s){i={error:s}}finally{try{e&&!e.done&&(n=t.return)&&n.call(t)}finally{if(i)throw i.error}}return[2]})})}}};function lo(t,e){var i,n,r,s,a=e.event,o=a.clientX,c=a.clientY;t.yMin=Math.min(null!==(i=t.yMin)&&void 0!==i?i:c,c),t.yMax=Math.max(null!==(n=t.yMax)&&void 0!==n?n:c,c),t.xMin=Math.min(null!==(r=t.xMin)&&void 0!==r?r:o,o),t.xMax=Math.max(null!==(s=t.xMax)&&void 0!==s?s:o,o),t.isOutOfBounds=t.yMax-t.yMin>50||t.xMax-t.xMin>50}function uo(t){var e=t[0],i=t[t.length-1];return{rageClickEvent:Me({"[Amplitude] Begin Time":new Date(e.timestamp).toISOString(),"[Amplitude] End Time":new Date(i.timestamp).toISOString(),"[Amplitude] Duration":i.timestamp-e.timestamp,"[Amplitude] Clicks":t.map(function(t){return{X:t.event.clientX,Y:t.event.clientY,Time:t.timestamp}}),"[Amplitude] Click Count":t.length},e.targetElementProperties),time:e.timestamp}}var ho,po=function(t){var e,i,n,r,s;void 0===t&&(t={});var a="@amplitude/plugin-frustration-browser",o=[],c=null!==(i=null===(e=t.rageClicks)||void 0===e?void 0:e.cssSelectorAllowlist)&&void 0!==i?i:vn,l=null!==(r=null===(n=t.deadClicks)||void 0===n?void 0:n.cssSelectorAllowlist)&&void 0!==r?r:gn,d=null!==(s=t.dataAttributePrefix)&&void 0!==s?s:fn,u=new Wa(t),h=Ne([],Ue(new Set(Ne(Ne([],Ue(c),!1),Ue(l),!1))),!1);return{name:a,type:"enrichment",setup:function(e,i){return De(void 0,void 0,void 0,function(){var n,r,s,p,f,m;return Fe(this,function(g){return"undefined"==typeof document||(n=Na(t,c),r=Na(t,l),s=function(){var t,e,i=no("pointerdown").pipe(xa(function(t){return u.addAdditionalEventProperties(t,"click",h,d,!0)}),La());window.navigation&&(e=Ca(window.navigation,"navigate").pipe(xa(function(t){return u.addAdditionalEventProperties(t,"navigate",h,d)}),La()));var n=io().pipe(xa(function(t){return u.addAdditionalEventProperties(t,"mutation",h,d)}),La());return(t={})[to.ClickObservable]=i,t[to.ChangeObservable]=new zs,t[to.NavigateObservable]=e,t[to.MutationObservable]=n,t}(),p=function(t){var e,i=t.amplitude,n=t.allObservables,r=t.shouldTrackRageClick,s=n.clickObservable,a=[],o={};function c(t){a=[],o={},t&&(lo(o,t),a.push(t))}return s.pipe(Aa(Ra),Aa(function(t){return r("click",t.closestTrackedAncestor)}),xa(function(t){if(e&&clearTimeout(e),lo(o,t),0===a.length)return a.push(t),null;if(function(t,e){return t.length>0&&t[t.length-1].closestTrackedAncestor!==e.closestTrackedAncestor}(a,t)||function(t,e){var i=t[Math.max(0,t.length-4+1)];return e.timestamp-i.timestamp>=1e3}(a,t)||o.isOutOfBounds){var n=a.length>=4?uo(a):null;return c(t),n}return a.push(t),a.length>=4&&(e=setTimeout(function(){var t=uo(a),e=t.rageClickEvent,n=t.time;i.track(hs,e,{time:n}),c()},1e3)),null}),Aa(function(t){return null!==t})).subscribe(function(t){null!==t&&i.track(hs,t.rageClickEvent,{time:t.time})})}({allObservables:s,amplitude:i,shouldTrackRageClick:n}),o.push(p),f=function(t){var e=t.amplitude,i=t.allObservables,n=t.getEventProperties,r=t.shouldTrackDeadClick,s=i.clickObservable,a=i.mutationObservable,o=i.navigateObservable,c=s.pipe(Aa(Ra),Aa(function(t){return r("click",t.closestTrackedAncestor)})),l=[a];o&&l.push(o);var d=Ta.apply(void 0,Ne([],Ue(l),!1));return c.pipe(_a(function(t){var e;return function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return 1===(e=1===(t=e).length&&Ia(t[0])?t[0]:t).length?ua(e[0]):new zs(function(t){return function(e){for(var i=[],n=function(n){i.push(ua(t[n]).subscribe(Rs(e,function(t){if(i){for(var r=0;r<i.length;r++)r!==n&&i[r].unsubscribe();i=null}e.next(t)})))},r=0;i&&!e.closed&&r<t.length;r++)n(r)}}(e))}(new zs(function(i){return e=setTimeout(function(){return i.next(t)},3e3),function(){clearTimeout(e)}}),d.pipe(Ma(1),xa(function(){return null}))).pipe(Aa(function(t){return null!==t}))}),Fa(3e3)).subscribe(function(t){var i={"[Amplitude] X":t.event.clientX,"[Amplitude] Y":t.event.clientY};e.track("[Amplitude] Dead Click",Me(Me({},n("click",t.closestTrackedAncestor)),i),{time:t.timestamp})})}({amplitude:i,allObservables:s,getEventProperties:function(t,e){return u.getEventProperties(t,e,d)},shouldTrackDeadClick:r}),o.push(f),null===(m=null==e?void 0:e.loggerProvider)||void 0===m||m.log("".concat(a," has been successfully added."))),[2]})})},execute:function(t){return De(void 0,void 0,void 0,function(){return Fe(this,function(e){return[2,t]})})},teardown:function(){return De(void 0,void 0,void 0,function(){var t,e,i,n;return Fe(this,function(r){try{for(t=Oe(o),e=t.next();!e.done;e=t.next())e.value.unsubscribe()}catch(s){i={error:s}}finally{try{e&&!e.done&&(n=t.return)&&n.call(t)}finally{if(i)throw i.error}}return[2]})})}}},fo="[Amplitude] Network Request",mo="500-599";function go(t,e){var i="^"+e.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".*")+"$";return new RegExp(i).test(t)}function vo(t,e){var i,n,r=e.split(",");try{for(var s=Oe(r),a=s.next();!a.done;a=s.next()){var o=Ue(a.value.split("-").map(Number),2),c=o[0],l=o[1];if(t===c&&void 0===l)return!0;if(t>=c&&t<=l)return!0}}catch(d){i={error:d}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return!1}function yo(t){var e;if(t)try{var i=null===(e=fi())||void 0===e?void 0:e.location.href,n=new URL(t,i),r=n.searchParams.toString(),s=n.hash.replace("#",""),a=n.href,o=n.host;return n.hash="",n.search="",{query:r,fragment:s,href:a,hrefWithoutQueryOrHash:n.href,host:o}}catch(c){return}}function bo(t){if("object"==typeof t&&null!==t){if(0!==t.length)return t}else{if(t)return Ne([],Ue(ni),!1);if(void 0===t)return}}function xo(t){var e,i;return!(null===(e=null==t?void 0:t.allowlist)||void 0===e?void 0:e.length)&&!(null===(i=null==t?void 0:t.blocklist)||void 0===i?void 0:i.length)}function wo(t){var e=t.allObservables,i=t.networkTrackingOptions,n=t.amplitude;return e.networkObservable.pipe(Aa(function(t){return function(t,e){var i;void 0===e&&(e={});var n=yo(t.url);if(!n)return!1;var r,s=n.host;return!(!1!==e.ignoreAmplitudeRequests&&(go(s,"*.amplitude.com")||go(s,"amplitude.com"))||(null===(i=e.ignoreHosts)||void 0===i?void 0:i.find(function(t){return go(s,t)}))||!e.captureRules&&void 0!==t.status&&!vo(t.status,mo)||e.captureRules&&(Ne([],Ue(e.captureRules),!1).reverse().find(function(e){if(r=function(t,e,i,n,r){if((!t.hosts||t.hosts.find(function(t){return go(e,t)}))&&(!n||!t.urls||rn(n,t.urls))&&(!r||!t.methods||t.methods.find(function(t){return r.toLowerCase()===t.toLowerCase()||"*"===t})))return!((i||0===i)&&!vo(i,t.statusCodeRange||mo))}(e,s,t.status,t.url,t.method),r){var i=bo(e.responseHeaders);if(t.responseWrapper&&i){var n=t.responseWrapper.headers(i);n&&(t.responseHeaders=n)}var a=bo(e.requestHeaders);if(t.requestWrapper&&a){var o=t.requestWrapper.headers(a);o&&(t.requestHeaders=o)}t.responseWrapper&&e.responseBody&&!xo(e.responseBody)&&(t.responseBodyJson=t.responseWrapper.json(e.responseBody.allowlist,e.responseBody.blocklist)),t.requestWrapper&&e.requestBody&&!xo(e.requestBody)&&(t.requestBodyJson=t.requestWrapper.json(e.requestBody.allowlist,e.requestBody.blocklist))}return void 0!==r}),!r)||t.requestWrapper&&function(t,e){if(t.includes("amplitude.com"))try{var i=e.body;if("string"!=typeof i)return!1;if(JSON.parse(i).events.find(function(t){return t.event_type===fo}))return!0}catch(n){}return!1}(s,t.requestWrapper))}(t.event,i)})).subscribe(function(t){var e,i,r,s=t.event,a=yo(s.url);if(a){var o=null===(i=s.responseWrapper)||void 0===i?void 0:i.bodySize,c=null===(r=s.requestWrapper)||void 0===r?void 0:r.bodySize;!function(t,e,i){De(this,void 0,void 0,function(){var n,r,s;return Fe(this,function(a){switch(a.label){case 0:return e.requestBodyJson||e.responseBodyJson?[4,Promise.all([e.requestBodyJson,e.responseBodyJson])]:[3,2];case 1:n=Ue.apply(void 0,[a.sent(),2]),r=n[0],s=n[1],r&&(t["[Amplitude] Request Body"]=r),s&&(t["[Amplitude] Response Body"]=s),a.label=2;case 2:return null==i||i.track(fo,t),[2]}})})}(((e={})["[Amplitude] URL"]=a.hrefWithoutQueryOrHash,e["[Amplitude] URL Query"]=a.query,e["[Amplitude] URL Fragment"]=a.fragment,e["[Amplitude] Request Method"]=s.method,e["[Amplitude] Status Code"]=s.status,e["[Amplitude] Start Time"]=s.startTime,e["[Amplitude] Completion Time"]=s.endTime,e["[Amplitude] Duration"]=s.duration,e["[Amplitude] Request Body Size"]=c,e["[Amplitude] Response Body Size"]=o,e["[Amplitude] Request Type"]=s.type,e["[Amplitude] Request Headers"]=s.requestHeaders,e["[Amplitude] Response Headers"]=s.responseHeaders,e),s,n)}})}!function(t){t.NetworkObservable="networkObservable"}(ho||(ho={}));var _o=function(t){void 0===t&&(t={});var e,i="@amplitude/plugin-network-capture-browser",n=[];return{name:i,type:"enrichment",setup:function(r,s){return De(void 0,void 0,void 0,function(){var a,o;return Fe(this,function(c){return"undefined"==typeof document||(a=function(){var t,i=new zs(function(t){var i=new Nn(function(e){var i=function(t){return{event:t,timestamp:Date.now(),type:"network"}}(e);t.next(i)});return qn.subscribe(i,e),function(){qn.unsubscribe(i)}});return(t={})[ho.NetworkObservable]=i,t}(),o=wo({allObservables:a,networkTrackingOptions:t,amplitude:s}),n.push(o),null==(e=null==r?void 0:r.loggerProvider)||e.log("".concat(i," has been successfully added."))),[2]})})},execute:function(t){return De(void 0,void 0,void 0,function(){return Fe(this,function(e){return[2,t]})})},teardown:function(){return De(void 0,void 0,void 0,function(){var t,e,i,r;return Fe(this,function(s){try{for(t=Oe(n),e=t.next();!e.done;e=t.next())e.value.unsubscribe()}catch(a){i={error:a}}finally{try{e&&!e.done&&(r=t.return)&&r.call(t)}finally{if(i)throw i.error}}return[2]})})}}};let ko=-1;const So=t=>{addEventListener("pageshow",e=>{e.persisted&&(ko=e.timeStamp,t(e))},!0)},Po=(t,e,i,n)=>{let r,s;return a=>{var o,c;e.value>=0&&(a||n)&&(s=e.value-(null!=r?r:0),(s||void 0===r)&&(r=e.value,e.delta=s,e.rating=(o=e.value)>(c=i)[1]?"poor":o>c[0]?"needs-improvement":"good",t(e)))}},Co=t=>{requestAnimationFrame(()=>requestAnimationFrame(()=>t()))},Eo=()=>{const t=performance.getEntriesByType("navigation")[0];if(t&&t.responseStart>0&&t.responseStart<performance.now())return t},$o=()=>{var t;const e=Eo();return null!=(t=null==e?void 0:e.activationStart)?t:0},To=(t,e=-1)=>{const i=Eo();let n="navigate";return ko>=0?n="back-forward-cache":i&&(document.prerendering||$o()>0?n="prerender":document.wasDiscarded?n="restore":i.type&&(n=i.type.replace(/_/g,"-"))),{name:t,value:e,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:n}},Io=new WeakMap;function Ao(t,e){return Io.get(t)||Io.set(t,new e),Io.get(t)}class Mo{constructor(){f(this,"t"),f(this,"i",0),f(this,"o",[])}h(t){var e;if(t.hadRecentInput)return;const i=this.o[0],n=this.o.at(-1);this.i&&i&&n&&t.startTime-n.startTime<1e3&&t.startTime-i.startTime<5e3?(this.i+=t.value,this.o.push(t)):(this.i=t.value,this.o=[t]),null==(e=this.t)||e.call(this,t)}}const Lo=(t,e,i={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const n=new PerformanceObserver(t=>{Promise.resolve().then(()=>{e(t.getEntries())})});return n.observe(u({type:t,buffered:!0},i)),n}}catch(n){}},Do=t=>{let e=!1;return()=>{e||(t(),e=!0)}};let Fo=-1;const Oo=new Set,Uo=()=>"hidden"!==document.visibilityState||document.prerendering?1/0:0,No=t=>{if("hidden"===document.visibilityState){if("visibilitychange"===t.type)for(const t of Oo)t();isFinite(Fo)||(Fo="visibilitychange"===t.type?t.timeStamp:0,removeEventListener("prerenderingchange",No,!0))}},zo=()=>{var t;if(Fo<0){const e=$o(),i=document.prerendering||null==(t=globalThis.performance.getEntriesByType("visibility-state").filter(t=>"hidden"===t.name&&t.startTime>e)[0])?void 0:t.startTime;Fo=null!=i?i:Uo(),addEventListener("visibilitychange",No,!0),addEventListener("prerenderingchange",No,!0),So(()=>{setTimeout(()=>{Fo=Uo()})})}return{get firstHiddenTime(){return Fo},onHidden(t){Oo.add(t)}}},qo=t=>{document.prerendering?addEventListener("prerenderingchange",()=>t(),!0):t()},jo=[1800,3e3],Ro=(t,e={})=>{qo(()=>{const i=zo();let n,r=To("FCP");const s=Lo("paint",t=>{for(const e of t)"first-contentful-paint"===e.name&&(s.disconnect(),e.startTime<i.firstHiddenTime&&(r.value=Math.max(e.startTime-$o(),0),r.entries.push(e),n(!0)))});s&&(n=Po(t,r,jo,e.reportAllChanges),So(i=>{r=To("FCP"),n=Po(t,r,jo,e.reportAllChanges),Co(()=>{r.value=performance.now()-i.timeStamp,n(!0)})}))})},Ho=[.1,.25];let Vo=0,Bo=1/0,Jo=0;const Go=t=>{for(const e of t)e.interactionId&&(Bo=Math.min(Bo,e.interactionId),Jo=Math.max(Jo,e.interactionId),Vo=Jo?(Jo-Bo)/7+1:0)};let Ko;const Qo=()=>{var t;return Ko?Vo:null!=(t=performance.interactionCount)?t:0};let Zo=0;class Wo{constructor(){f(this,"u",[]),f(this,"l",new Map),f(this,"m"),f(this,"p")}v(){Zo=Qo(),this.u.length=0,this.l.clear()}L(){const t=Math.min(this.u.length-1,Math.floor((Qo()-Zo)/50));return this.u[t]}h(t){var e,i;if(null==(e=this.m)||e.call(this,t),!t.interactionId&&"first-input"!==t.entryType)return;const n=this.u.at(-1);let r=this.l.get(t.interactionId);if(r||this.u.length<10||t.duration>n.P){if(r?t.duration>r.P?(r.entries=[t],r.P=t.duration):t.duration===r.P&&t.startTime===r.entries[0].startTime&&r.entries.push(t):(r={id:t.interactionId,entries:[t],P:t.duration},this.l.set(r.id,r),this.u.push(r)),this.u.sort((t,e)=>e.P-t.P),this.u.length>10){const t=this.u.splice(10);for(const e of t)this.l.delete(e.id)}null==(i=this.p)||i.call(this,r)}}}const Yo=t=>{const e=globalThis.requestIdleCallback||setTimeout;"hidden"===document.visibilityState?t():(t=Do(t),addEventListener("visibilitychange",t,{once:!0,capture:!0}),e(()=>{t(),removeEventListener("visibilitychange",t,{capture:!0})}))},Xo=[200,500];class tc{constructor(){f(this,"m")}h(t){var e;null==(e=this.m)||e.call(this,t)}}const ec=[2500,4e3],ic=[800,1800],nc=t=>{document.prerendering?qo(()=>nc(t)):"complete"!==document.readyState?addEventListener("load",()=>nc(t),!0):setTimeout(t)};function rc(t){var e,i=(null===(e=t.entries[0])||void 0===e?void 0:e.startTime)||0;return performance.timeOrigin+i}function sc(t){return{value:t.value,rating:t.rating,delta:t.delta,navigationType:t.navigationType,id:t.id,timestamp:Math.floor(rc(t)),navigationStart:Math.floor(performance.timeOrigin)}}var ac=function(){var t=null,e=fi(),i=null==e?void 0:e.document,n=null==e?void 0:e.location;return{name:"web-vitals-browser",type:"enrichment",setup:function(e,r){return De(void 0,void 0,void 0,function(){var s,a,o;return Fe(this,function(c){return s=function(t){var i;if(!t)return"";var n=t;try{n=decodeURI(t)}catch(r){null===(i=e.loggerProvider)||void 0===i||i.error("Malformed URI sequence: ",r)}return n},void 0===i||(a=s(null==n?void 0:n.href),o={"[Amplitude] Page Domain":(null==n?void 0:n.hostname)||"","[Amplitude] Page Location":a,"[Amplitude] Page Path":s(null==n?void 0:n.pathname),"[Amplitude] Page Title":"undefined"!=typeof document&&document.title||"","[Amplitude] Page URL":a.split("?")[0]},((t,e={})=>{qo(()=>{const i=zo();let n,r=To("LCP");const s=Ao(e,tc),a=t=>{e.reportAllChanges||(t=t.slice(-1));for(const e of t)s.h(e),e.startTime<i.firstHiddenTime&&(r.value=Math.max(e.startTime-$o(),0),r.entries=[e],n())},o=Lo("largest-contentful-paint",a);if(o){n=Po(t,r,ec,e.reportAllChanges);const i=Do(()=>{a(o.takeRecords()),o.disconnect(),n(!0)}),s=t=>{t.isTrusted&&(Yo(i),removeEventListener(t.type,s,{capture:!0}))};for(const t of["keydown","click","visibilitychange"])addEventListener(t,s,{capture:!0});So(i=>{r=To("LCP"),n=Po(t,r,ec,e.reportAllChanges),Co(()=>{r.value=performance.now()-i.timeStamp,n(!0)})})}})})(function(t){o["[Amplitude] LCP"]=sc(t)}),Ro(function(t){o["[Amplitude] FCP"]=sc(t)}),((t,e={})=>{if(!globalThis.PerformanceEventTiming||!("interactionId"in PerformanceEventTiming.prototype))return;const i=zo();qo(()=>{var n;"interactionCount"in performance||Ko||(Ko=Lo("event",Go,{type:"event",buffered:!0,durationThreshold:0}));let r,s=To("INP");const a=Ao(e,Wo),o=t=>{Yo(()=>{for(const i of t)a.h(i);const e=a.L();e&&e.P!==s.value&&(s.value=e.P,s.entries=e.entries,r())})},c=Lo("event",o,{durationThreshold:null!=(n=e.durationThreshold)?n:40});r=Po(t,s,Xo,e.reportAllChanges),c&&(c.observe({type:"first-input",buffered:!0}),i.onHidden(()=>{o(c.takeRecords()),r(!0)}),So(()=>{a.v(),s=To("INP"),r=Po(t,s,Xo,e.reportAllChanges)}))})})(function(t){o["[Amplitude] INP"]=sc(t)}),((t,e={})=>{const i=zo();Ro(Do(()=>{let n,r=To("CLS",0);const s=Ao(e,Mo),a=t=>{for(const e of t)s.h(e);s.i>r.value&&(r.value=s.i,r.entries=s.o,n())},o=Lo("layout-shift",a);o&&(n=Po(t,r,Ho,e.reportAllChanges),i.onHidden(()=>{a(o.takeRecords()),n(!0)}),So(()=>{s.i=0,r=To("CLS",0),n=Po(t,r,Ho,e.reportAllChanges),Co(()=>n())}),setTimeout(n))}))})(function(t){o["[Amplitude] CLS"]=sc(t)}),((t,e={})=>{let i=To("TTFB"),n=Po(t,i,ic,e.reportAllChanges);nc(()=>{const r=Eo();r&&(i.value=Math.max(r.responseStart-$o(),0),i.entries=[r],n(!0),So(()=>{i=To("TTFB",0),n=Po(t,i,ic,e.reportAllChanges),n(!0)}))})})(function(t){o["[Amplitude] TTFB"]=sc(t)}),t=function(){"hidden"===i.visibilityState&&t&&(r.track("[Amplitude] Web Vitals",o),i.removeEventListener("visibilitychange",t),t=null)},i.addEventListener("visibilitychange",t)),[2]})})},execute:function(t){return De(void 0,void 0,void 0,function(){return Fe(this,function(e){return[2,t]})})},teardown:function(){return De(void 0,void 0,void 0,function(){return Fe(this,function(e){return t&&(null==i||i.removeEventListener("visibilitychange",t)),[2]})})}}},oc=function(t){var e=t.split(".");return e.length<=2?t:e.slice(e.length-2,e.length).join(".")},cc=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=""),t.some(function(t){return t instanceof RegExp?t.test(e):t===e})},lc=function(){function t(t,e){var i,n,r;this.shouldTrackNewCampaign=!1,this.options=Me({initialEmptyValue:"EMPTY",resetSessionOnNewCampaign:!1,excludeReferrers:(n=null===(i=e.cookieOptions)||void 0===i?void 0:i.domain,r=n,r?(r.startsWith(".")&&(r=r.substring(1)),[new RegExp("".concat(r.replace(".","\\."),"$"))]):[])},t),this.storage=e.cookieStorage,this.storageKey=ln(e.apiKey,"MKTG"),this.webExpStorageKey=ln(e.apiKey,"MKTG_ORIGINAL"),this.currentCampaign=ii,this.sessionTimeout=e.sessionTimeout,this.lastEventTime=e.lastEventTime,this.logger=e.loggerProvider,e.loggerProvider.log("Installing web attribution tracking.")}return t.prototype.init=function(){return De(this,void 0,void 0,function(){var t,e;return Fe(this,function(i){switch(i.label){case 0:return[4,this.fetchCampaign()];case 1:return e=Ue.apply(void 0,[i.sent(),2]),this.currentCampaign=e[0],this.previousCampaign=e[1],t=!this.lastEventTime||Ki(this.sessionTimeout,this.lastEventTime),function(t,e,i,n,r){void 0===r&&(r=!0),t.referrer;var s=t.referring_domain,a=Le(t,["referrer","referring_domain"]),o=e||{};o.referrer;var c=o.referring_domain,l=Le(o,["referrer","referring_domain"]);if(cc(i.excludeReferrers,t.referring_domain))return n.debug("This is not a new campaign because ".concat(t.referring_domain," is in the exclude referrer list.")),!1;if(!r&&function(t){return Object.values(t).every(function(t){return!t})}(t)&&e)return n.debug("This is not a new campaign because this is a direct traffic in the same session."),!1;var d=JSON.stringify(a)!==JSON.stringify(l),u=oc(s||"")!==oc(c||""),h=!e||d||u;return h?n.debug("This is a new campaign. An $identify event will be sent."):n.debug("This is not a new campaign because it's the same as the previous one."),h}(this.currentCampaign,this.previousCampaign,this.options,this.logger,t)?(this.shouldTrackNewCampaign=!0,[4,this.storage.set(this.storageKey,this.currentCampaign)]):[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}})})},t.prototype.fetchCampaign=function(){return De(this,void 0,void 0,function(){var t;return Fe(this,function(e){switch(e.label){case 0:return[4,this.storage.get(this.webExpStorageKey)];case 1:return(t=e.sent())?[4,this.storage.remove(this.webExpStorageKey)]:[3,3];case 2:e.sent(),e.label=3;case 3:return[4,Promise.all([t||(new jn).parse(),this.storage.get(this.storageKey)])];case 4:return[2,e.sent()]}})})},t.prototype.generateCampaignEvent=function(t){this.shouldTrackNewCampaign=!1;var e,i,n,r,s=(e=this.currentCampaign,i=this.options,n=Me(Me({},ii),e),r=Object.entries(n).reduce(function(t,e){var n,r=Ue(e,2),s=r[0],a=r[1];return t.setOnce("initial_".concat(s),null!==(n=null!=a?a:i.initialEmptyValue)&&void 0!==n?n:"EMPTY"),a?t.set(s,a):t.unset(s)},new oi),yi(r));return t&&(s.event_id=t),s},t.prototype.shouldSetSessionIdOnNewCampaign=function(){return this.shouldTrackNewCampaign&&!!this.options.resetSessionOnNewCampaign},t}(),dc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ee(e,t),e.prototype.init=function(t,e,i){var n,r;return void 0===t&&(t=""),arguments.length>2?(n=e,r=i):"string"==typeof e?(n=e,r=void 0):(n=null==e?void 0:e.userId,r=e),bi(this.k(Me(Me({},r),{userId:n,apiKey:t})))},e.prototype.k=function(e){var i,n,r;return De(this,void 0,void 0,function(){var s,a,o,c,l,d,u,h=this;return Fe(this,function(p){switch(p.label){case 0:return this.initializing?[2]:(this.initializing=!0,[4,Er(e.apiKey,e,this)]);case 1:return(s=p.sent()).fetchRemoteConfig?(this.remoteConfigClient=new _i(s.apiKey,s.loggerProvider,s.serverZone),[4,new Promise(function(t){var e;null===(e=h.remoteConfigClient)||void 0===e||e.subscribe("configs.analyticsSDK.browserSDK","all",function(e,i,n){s.loggerProvider.debug("Remote configuration received:",JSON.stringify({remoteConfig:e,source:i,lastFetch:n},null,2)),e&&as(e,s),t()})})]):[3,3];case 2:p.sent(),p.label=3;case 3:return[4,t.prototype.k.call(this,s)];case 4:return p.sent(),this.logBrowserOptions(s),Hn(this.config.defaultTracking)?(y=this.config,a=Hn(y.defaultTracking)&&y.defaultTracking&&"object"==typeof y.defaultTracking&&y.defaultTracking.attribution&&"object"==typeof y.defaultTracking.attribution?Me({},y.defaultTracking.attribution):{},this.webAttribution=new lc(a,this.config),[4,this.webAttribution.init()]):[3,6];case 5:p.sent(),p.label=6;case 6:return o=Wi(),c=o.ampTimestamp?Number(o.ampTimestamp):void 0,l=!c||Date.now()<c,d=l&&!Number.isNaN(Number(o.ampSessionId))?Number(o.ampSessionId):void 0,this.setSessionId(null!==(r=null!==(n=null!==(i=e.sessionId)&&void 0!==i?i:d)&&void 0!==n?n:this.config.sessionId)&&void 0!==r?r:Date.now()),(u=Ji(e.instanceName)).identityStore.setIdentity({userId:this.config.userId,deviceId:this.config.deviceId}),null===this.config.offline?[3,8]:[4,this.add((f=fi(),m=[],g=function(t,e){(null==f?void 0:f.addEventListener)&&(null==f||f.addEventListener(t,e),m.push({type:t,handler:e}))},{name:"@amplitude/plugin-network-checker-browser",type:"before",setup:function(t,e){return De(void 0,void 0,void 0,function(){return Fe(this,function(i){return"undefined"==typeof navigator?(t.loggerProvider.debug("Network connectivity checker plugin is disabled because navigator is not available."),t.offline=!1,[2]):(t.offline=!navigator.onLine,g("online",function(){t.loggerProvider.debug("Network connectivity changed to online."),t.offline=!1,setTimeout(function(){e.flush()},t.flushIntervalMillis)}),g("offline",function(){t.loggerProvider.debug("Network connectivity changed to offline."),t.offline=!0}),[2])})})},teardown:function(){return De(void 0,void 0,void 0,function(){return Fe(this,function(t){return m.forEach(function(t){var e=t.type,i=t.handler;null==f||f.removeEventListener(e,i)}),m=[],[2]})})}})).promise];case 7:p.sent(),p.label=8;case 8:return[4,this.add(new Li).promise];case 9:return p.sent(),[4,this.add(new ir).promise];case 10:return p.sent(),[4,this.add(new Gi).promise];case 11:return p.sent(),function(t){rs||void 0!==t.defaultTracking||(t.loggerProvider.warn("`options.defaultTracking` is set to undefined. This implicitly configures your Amplitude instance to track Page Views, Sessions, File Downloads, and Form Interactions. You can suppress this warning by explicitly setting a value to `options.defaultTracking`. The value must either be a boolean, to enable and disable all default events, or an object, for advanced configuration. For example:\n\namplitude.init(<YOUR_API_KEY>, {\n  defaultTracking: true,\n});\n\nVisit https://www.docs.developers.amplitude.com/data/sdks/browser-2/#tracking-default-events for more details."),rs=!0)}(this.config),v=this.config.defaultTracking,Rn(v,"fileDownloads")?(this.config.loggerProvider.debug("Adding file download tracking plugin"),[4,this.add(ns()).promise]):[3,13];case 12:p.sent(),p.label=13;case 13:return function(t){return Rn(t,"formInteractions")}(this.config.defaultTracking)?(this.config.loggerProvider.debug("Adding form interaction plugin"),[4,this.add(ts()).promise]):[3,15];case 14:p.sent(),p.label=15;case 15:return Vn(this.config.defaultTracking)?(this.config.loggerProvider.debug("Adding page view tracking plugin"),[4,this.add(Zr(Yn(this.config))).promise]):[3,17];case 16:p.sent(),p.label=17;case 17:return Gn(this.config.autocapture)?(this.config.loggerProvider.debug("Adding user interactions plugin (autocapture plugin)"),[4,this.add(co(Qn(this.config))).promise]):[3,19];case 18:p.sent(),p.label=19;case 19:return Kn(this.config.autocapture)?(this.config.loggerProvider.debug("Adding frustration interactions plugin"),[4,this.add(po(Zn(this.config))).promise]):[3,21];case 20:p.sent(),p.label=21;case 21:return Jn(this.config.autocapture)?(this.config.loggerProvider.debug("Adding network tracking plugin"),[4,this.add(_o(Wn(this.config))).promise]):[3,23];case 22:p.sent(),p.label=23;case 23:return function(t){return"object"==typeof t&&!0===t.webVitals}(this.config.autocapture)?(this.config.loggerProvider.debug("Adding web vitals plugin"),[4,this.add(ac()).promise]):[3,25];case 24:p.sent(),p.label=25;case 25:return this.initializing=!1,[4,this.runQueuedFunctions("dispatchQ")];case 26:return p.sent(),u.eventBridge.setEventReceiver(function(t){h.track(t.eventType,t.eventProperties)}),[2]}var f,m,g,v,y})})},e.prototype.getUserId=function(){var t;return null===(t=this.config)||void 0===t?void 0:t.userId},e.prototype.setUserId=function(t){this.config?(this.config.loggerProvider.debug("function setUserId: ",t),t===this.config.userId&&void 0!==t||(this.config.userId=t,this.timeline.onIdentityChanged({userId:t}),function(t,e){Ji(e).identityStore.editIdentity().setUserId(t).commit()}(t,this.config.instanceName))):this.q.push(this.setUserId.bind(this,t))},e.prototype.getDeviceId=function(){var t;return null===(t=this.config)||void 0===t?void 0:t.deviceId},e.prototype.setDeviceId=function(t){this.config?(this.config.loggerProvider.debug("function setDeviceId: ",t),t!==this.config.deviceId&&(this.config.deviceId=t,this.timeline.onIdentityChanged({deviceId:t}),function(t,e){Ji(e).identityStore.editIdentity().setDeviceId(t).commit()}(t,this.config.instanceName))):this.q.push(this.setDeviceId.bind(this,t))},e.prototype.reset=function(){this.setDeviceId(gi()),this.setUserId(void 0)},e.prototype.getIdentity=function(){var t,e;return{deviceId:null===(t=this.config)||void 0===t?void 0:t.deviceId,userId:null===(e=this.config)||void 0===e?void 0:e.userId,userProperties:this.userProperties}},e.prototype.getOptOut=function(){var t;return null===(t=this.config)||void 0===t?void 0:t.optOut},e.prototype.getSessionId=function(){var t;return null===(t=this.config)||void 0===t?void 0:t.sessionId},e.prototype.setSessionId=function(t){var e,i=[];if(!this.config)return this.q.push(this.setSessionId.bind(this,t)),bi(Promise.resolve());if(t===this.config.sessionId)return bi(Promise.resolve());this.config.loggerProvider.debug("function setSessionId: ",t);var n=this.getSessionId();n!==t&&this.timeline.onSessionIdChanged(t);var r=this.config.lastEventTime,s=null!==(e=this.config.lastEventId)&&void 0!==e?e:-1;this.config.sessionId=t,this.config.lastEventTime=void 0,this.config.pageCounter=0,Bn(this.config.defaultTracking)&&(n&&r&&i.push(this.track(gr,void 0,{device_id:this.previousSessionDeviceId,event_id:++s,session_id:n,time:r+1,user_id:this.previousSessionUserId}).promise),this.config.lastEventTime=this.config.sessionId);var a=this.trackCampaignEventIfNeeded(++s,i);return Bn(this.config.defaultTracking)&&i.push(this.track(mr,void 0,{event_id:a?++s:s,session_id:this.config.sessionId,time:this.config.lastEventTime}).promise),this.previousSessionDeviceId=this.config.deviceId,this.previousSessionUserId=this.config.userId,bi(Promise.all(i))},e.prototype.extendSession=function(){this.config?this.config.lastEventTime=Date.now():this.q.push(this.extendSession.bind(this))},e.prototype.setTransport=function(t){this.config?this.config.transportProvider=Tr(t):this.q.push(this.setTransport.bind(this,t))},e.prototype.identify=function(e,i){if(tr(e)){var n=e.it;e.it=[],e=Xn(new oi,n)}return(null==i?void 0:i.user_id)&&this.setUserId(i.user_id),(null==i?void 0:i.device_id)&&this.setDeviceId(i.device_id),t.prototype.identify.call(this,e,i)},e.prototype.groupIdentify=function(e,i,n,r){if(tr(n)){var s=n.it;n.it=[],n=Xn(new oi,s)}return t.prototype.groupIdentify.call(this,e,i,n,r)},e.prototype.revenue=function(e,i){if(tr(e)){var n=e.it;e.it=[],e=Xn(new Ci,n)}return t.prototype.revenue.call(this,e,i)},e.prototype.trackCampaignEventIfNeeded=function(t,e){if(!this.webAttribution||!this.webAttribution.shouldTrackNewCampaign)return!1;var i=this.webAttribution.generateCampaignEvent(t);return e?e.push(this.track(i).promise):this.track(i),this.config.loggerProvider.log("Tracking attribution."),!0},e.prototype.process=function(e){return De(this,void 0,void 0,function(){var i,n,r;return Fe(this,function(s){return i=Date.now(),n=Ki(this.config.sessionTimeout,this.config.lastEventTime),r=this.webAttribution&&this.webAttribution.shouldSetSessionIdOnNewCampaign(),e.event_type===mr||e.event_type===gr||e.session_id&&e.session_id!==this.getSessionId()||(n||r?(this.setSessionId(i),r&&this.config.loggerProvider.log("Created a new session for new campaign.")):n||this.trackCampaignEventIfNeeded()),e.event_type===Ie.IDENTIFY&&e.user_properties&&(this.userProperties=this.getOperationAppliedUserProperties(e.user_properties)),[2,t.prototype.process.call(this,e)]})})},e.prototype.logBrowserOptions=function(t){try{var e=Me(Me({},t),{apiKey:t.apiKey.substring(0,10)+"********"});this.config.loggerProvider.debug("Initialized Amplitude with BrowserConfig:",JSON.stringify(e))}catch(i){this.config.loggerProvider.error("Error logging browser config",i)}},e}(xi),uc=function(){var t=new dc;return{init:nn(t.init.bind(t),"init",Xi(t),en(t,["config"])),add:nn(t.add.bind(t),"add",Xi(t),en(t,["config.apiKey","timeline.plugins"])),remove:nn(t.remove.bind(t),"remove",Xi(t),en(t,["config.apiKey","timeline.plugins"])),track:nn(t.track.bind(t),"track",Xi(t),en(t,["config.apiKey","timeline.queue.length"])),logEvent:nn(t.logEvent.bind(t),"logEvent",Xi(t),en(t,["config.apiKey","timeline.queue.length"])),identify:nn(t.identify.bind(t),"identify",Xi(t),en(t,["config.apiKey","timeline.queue.length"])),groupIdentify:nn(t.groupIdentify.bind(t),"groupIdentify",Xi(t),en(t,["config.apiKey","timeline.queue.length"])),setGroup:nn(t.setGroup.bind(t),"setGroup",Xi(t),en(t,["config.apiKey","timeline.queue.length"])),revenue:nn(t.revenue.bind(t),"revenue",Xi(t),en(t,["config.apiKey","timeline.queue.length"])),flush:nn(t.flush.bind(t),"flush",Xi(t),en(t,["config.apiKey","timeline.queue.length"])),getUserId:nn(t.getUserId.bind(t),"getUserId",Xi(t),en(t,["config","config.userId"])),setUserId:nn(t.setUserId.bind(t),"setUserId",Xi(t),en(t,["config","config.userId"])),getDeviceId:nn(t.getDeviceId.bind(t),"getDeviceId",Xi(t),en(t,["config","config.deviceId"])),setDeviceId:nn(t.setDeviceId.bind(t),"setDeviceId",Xi(t),en(t,["config","config.deviceId"])),reset:nn(t.reset.bind(t),"reset",Xi(t),en(t,["config","config.userId","config.deviceId"])),getSessionId:nn(t.getSessionId.bind(t),"getSessionId",Xi(t),en(t,["config"])),setSessionId:nn(t.setSessionId.bind(t),"setSessionId",Xi(t),en(t,["config"])),extendSession:nn(t.extendSession.bind(t),"extendSession",Xi(t),en(t,["config"])),setOptOut:nn(t.setOptOut.bind(t),"setOptOut",Xi(t),en(t,["config"])),setTransport:nn(t.setTransport.bind(t),"setTransport",Xi(t),en(t,["config"])),getIdentity:nn(t.getIdentity.bind(t),"getIdentity",Xi(t),en(t,["config"])),getOptOut:nn(t.getOptOut.bind(t),"getOptOut",Xi(t),en(t,["config"]))}};const hc=uc(),pc=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_ACTION_CLICK_ALLOWLIST:mn,DEFAULT_CSS_SELECTOR_ALLOWLIST:pn,DEFAULT_DATA_ATTRIBUTE_PREFIX:fn,get IdentifyOperation(){return $e},get LogLevel(){return ui},OfflineDisabled:null,get RevenueProperty(){return ki},get ServerZone(){return ji},get SpecialEventType(){return Ie}},Symbol.toStringTag,{value:"Module"}));var fc=hc.add,mc=hc.extendSession,gc=hc.flush,vc=hc.getDeviceId,yc=hc.getIdentity,bc=hc.getOptOut,xc=hc.getSessionId,wc=hc.getUserId,_c=hc.groupIdentify,kc=hc.identify,Sc=hc.init,Pc=hc.logEvent,Cc=hc.remove,Ec=hc.reset,$c=hc.revenue,Tc=hc.setDeviceId,Ic=hc.setGroup,Ac=hc.setOptOut,Mc=hc.setSessionId,Lc=hc.setTransport,Dc=hc.setUserId,Fc=hc.track;const Oc=Object.freeze(Object.defineProperty({__proto__:null,AmplitudeBrowser:dc,Identify:oi,Revenue:Ci,Types:pc,add:fc,createInstance:uc,extendSession:mc,flush:gc,getDeviceId:vc,getIdentity:yc,getOptOut:bc,getSessionId:xc,getUserId:wc,groupIdentify:_c,identify:kc,init:Sc,logEvent:Pc,remove:Cc,reset:Ec,revenue:$c,runQueuedFunctions:function(t,e){Xn(t,e)},setDeviceId:Tc,setGroup:Ic,setOptOut:Ac,setSessionId:Mc,setTransport:Lc,setUserId:Dc,track:Fc},Symbol.toStringTag,{value:"Module"})),Uc={debug:{enabled:!1,verbose:!1,logEvents:!0,logErrors:!0,persistInLocalStorage:!0},providers:[],enrichContext:!0,sessionTimeout:18e5,eventValidation:!0},Nc={required:["event"],eventSpecific:{purchase:["ecommerce.transaction_id","ecommerce.value","ecommerce.items"],add_to_cart:["ecommerce.items"],remove_from_cart:["ecommerce.items"],view_item:["ecommerce.items"],view_item_list:["ecommerce.items"],begin_checkout:["ecommerce.value"],add_payment_info:["ecommerce.value"],add_shipping_info:["ecommerce.value"],dl_purchase:["ecommerce.transaction_id","ecommerce.value","ecommerce.items"],dl_add_to_cart:["ecommerce.items"],dl_remove_from_cart:["ecommerce.items"],dl_view_item:["ecommerce.items"],dl_view_item_list:["ecommerce.items"],dl_begin_checkout:["ecommerce.value"],dl_add_payment_info:["ecommerce.value"],dl_add_shipping_info:["ecommerce.value"]},fieldTypes:{event:"string",event_id:"string",event_category:"string",event_label:"string",event_value:"number","ecommerce.value":"number","ecommerce.tax":"number","ecommerce.shipping":"number","ecommerce.discount":"number"}},zc="nextDataLayer_debugMode",qc="nextDataLayer_sessionId",jc="nextDataLayer_sessionStart",Rc="nextDataLayer_userProperties",Hc=tt("PendingEventsHandler"),Vc="next_v2_pending_events";class Bc{constructor(){}static getInstance(){return Bc.instance||(Bc.instance=new Bc),Bc.instance}queueEvent(t){try{const e=this.getPendingEvents(),i={event:t,timestamp:Date.now(),id:`${t.event}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`};e.push(i),sessionStorage.setItem(Vc,JSON.stringify(e)),Hc.info(`Event queued for after redirect: ${t.event} (${e.length} total queued)`)}catch(e){Hc.error("Failed to queue event:",e)}}getPendingEvents(){try{const t=sessionStorage.getItem(Vc);if(!t)return[];const e=JSON.parse(t);return Array.isArray(e)?e:[]}catch(t){return Hc.error("Failed to get pending events:",t),[]}}processPendingEvents(){const t=this.getPendingEvents();if(0===t.length)return void Hc.debug("No pending analytics events to process");Hc.info(`Processing ${t.length} pending analytics events`);const e=[];for(const n of t)try{if(Date.now()-n.timestamp>3e5){Hc.warn("Skipping stale event:",n.event.event),e.push(n.id);continue}Kc.push(n.event),e.push(n.id),Hc.debug("Processed pending event:",n.event.event)}catch(i){Hc.error("Failed to process pending event:",n.event.event,i)}if(e.length>0){const i=t.filter(t=>!e.includes(t.id));0===i.length?sessionStorage.removeItem(Vc):sessionStorage.setItem(Vc,JSON.stringify(i)),Hc.debug("Removed processed events:",e.length)}}clearPendingEvents(){try{sessionStorage.removeItem(Vc),Hc.debug("Cleared all pending events")}catch(t){Hc.error("Failed to clear pending events:",t)}}reset(){this.clearPendingEvents(),Hc.debug("PendingEventsHandler reset")}initialize(){Hc.debug("PendingEventsHandler initialized")}}const Jc=Bc.getInstance();class Gc{constructor(t){this.sequenceNumber=0,this.debugMode=!1,this.context={},this.config=u(u({},Uc),t),this.initializeDataLayer(),this.sessionId=this.getOrCreateSessionId(),this.loadDebugMode(),this.enrichContext()}getContext(){return this.context}static getInstance(t){return Gc.instance||(Gc.instance=new Gc(t)),Gc.instance}initializeDataLayer(){"undefined"!=typeof window&&(window.NextDataLayer||(window.NextDataLayer=[]),this.config.transformFn&&(window.NextDataLayerTransformFn=this.config.transformFn))}push(t){try{if(this.config.eventValidation&&!this.validateEvent(t))return;const e=this.enrichEvent(t);let i=e;if(window.NextDataLayerTransformFn){const n=window.NextDataLayerTransformFn(e);if(!n)return void this.debug("Event filtered out by transform function",t);i=n}const n=i.Tt;if(this.debug(`Event ${i.event} has _willRedirect flag:`,n),delete i.Tt,n)return Jc.queueEvent(i),void this.debug(`Event queued for after redirect: ${i.event}`,i);window.NextDataLayer.push(i),this.debug("Event pushed to data layer",i),this.notifyProviders(i)}catch(e){this.error("Error pushing event to data layer",e,t)}}setDebugMode(t,e){var i;if(this.debugMode=t,this.config.debug&&(this.config.debug=u(h(u({},this.config.debug),{enabled:t}),e)),null==(i=this.config.debug)?void 0:i.persistInLocalStorage)try{localStorage.setItem(zc,JSON.stringify({enabled:t,options:e}))}catch(n){}this.debug("Debug mode "+(t?"enabled":"disabled"))}isDebugMode(){return this.debugMode}invalidateContext(){this.context={},this.enrichContext(),this.debug("Context invalidated and re-enriched")}setUserProperties(t){try{localStorage.setItem(Rc,JSON.stringify(t)),this.debug("User properties updated",t)}catch(e){this.error("Failed to save user properties",e)}}getUserProperties(){try{const t=localStorage.getItem(Rc);return t?JSON.parse(t):null}catch(t){return this.error("Failed to load user properties",t),null}}clear(){window.NextDataLayer=[],this.sequenceNumber=0,this.context={},this.enrichContext(),this.debug("Data layer cleared")}validateEvent(t){for(const i of Nc.required)if(!this.getNestedValue(t,i))return this.error(`Missing required field: ${i}`,null,t),!1;const e=Nc.eventSpecific[t.event];if(e)for(const i of e)if(!this.getNestedValue(t,i))return this.error(`Missing required field for ${t.event}: ${i}`,null,t),!1;for(const[i,n]of Object.entries(Nc.fieldTypes)){const e=this.getNestedValue(t,i);if(void 0!==e&&typeof e!==n)return this.error(`Invalid type for field ${i}: expected ${n}, got ${typeof e}`,null,t),!1}return!0}enrichEvent(t){const e={pushed_at:Date.now(),session_id:this.sessionId,sequence_number:++this.sequenceNumber,debug_mode:this.debugMode,source:"NextDataLayer",version:"0.2.0"};let i={};try{const t=Nt.getState().getAttributionForApi();t&&Object.keys(t).length>0?(i=t,this.debug("Attribution data added to event:",i)):this.debug("Attribution store exists but has no data yet")}catch(r){this.debug("Could not get attribution data:",r)}const n=h(u({},t),{It:e});if(i&&Object.keys(i).length>0&&(n.attribution=i),this.config.enrichContext){n.event_time=n.event_time||(new Date).toISOString(),n.event_id=n.event_id||this.generateEventId();const t=this.getUserProperties();t&&(n.user_properties=u(u({},t),n.user_properties))}return n}enrichContext(){"undefined"!=typeof window&&(this.context={page_location:window.location.href,page_title:document.title,page_referrer:document.referrer,user_agent:navigator.userAgent,screen_resolution:`${screen.width}x${screen.height}`,viewport_size:`${window.innerWidth}x${window.innerHeight}`,session_id:this.sessionId,timestamp:Date.now()})}getOrCreateSessionId(){try{const t=localStorage.getItem(qc),e=localStorage.getItem(jc),i=Date.now(),n=this.config.sessionTimeout||18e5;if(t&&e&&i-parseInt(e)<n)return localStorage.setItem(jc,i.toString()),t;const r=this.generateSessionId();return localStorage.setItem(qc,r),localStorage.setItem(jc,i.toString()),r}catch(t){return this.generateSessionId()}}loadDebugMode(){var t;if(null==(t=this.config.debug)?void 0:t.persistInLocalStorage)try{const t=localStorage.getItem(zc);if(t){const{enabled:e,options:i}=JSON.parse(t);this.debugMode=e,i&&this.config.debug&&(this.config.debug=u(u({},this.config.debug),i))}}catch(e){}}notifyProviders(t){if(this.config.providers)for(const i of this.config.providers)try{"function"==typeof i.isEnabled?i.isEnabled()&&i.trackEvent&&i.trackEvent(t):!1!==i.enabled&&i.trackEvent&&i.trackEvent(t)}catch(e){this.error(`Error in provider ${i.name||"unknown"}`,e,t)}}generateEventId(){return`${this.sessionId}_${this.sequenceNumber}_${Date.now()}`}generateSessionId(){return`${Date.now()}_${Math.random().toString(36).substring(2,11)}`}getNestedValue(t,e){return e.split(".").reduce((t,e)=>null==t?void 0:t[e],t)}debug(t,e){var i,n;this.debugMode&&(null==(i=this.config.debug)?void 0:i.logEvents)&&(null==(n=this.config.debug)||n.verbose)}error(t,e,i){var n;null==(n=this.config.debug)||n.logErrors}initialize(){this.initializeDataLayer(),this.debug("Data layer initialized")}addProvider(t){this.config.providers||(this.config.providers=[]),this.config.providers.push(t),this.debug(`Provider ${t.name||"unknown"} added`)}setTransformFunction(t){window.NextDataLayerTransformFn=t,this.debug("Transform function set")}getEventCount(){var t;return(null==(t=window.NextDataLayer)?void 0:t.length)||0}formatEcommerceEvent(t,e){return{event:t,event_time:(new Date).toISOString(),data:e.data||e,ecommerce:e.ecommerce||e}}formatUserDataEvent(t){return{event:"dl_user_data",event_time:(new Date).toISOString(),user_properties:t.user_properties||t,cart_total:t.cart_total,ecommerce:t.ecommerce}}}const Kc=Gc.getInstance();class Qc{constructor(t){this.enabled=!0,this.name=t}setEnabled(t){this.enabled=t}isEnabled(){return this.enabled}trackEvent(t){this.sendEvent(t)}transformEvent(t){return u({event:t.event},t.data)}debug(t,e){var i;"undefined"!=typeof window&&(null==(i=window.localStorage)||i.getItem("analytics_debug"))}isBrowser(){return"undefined"!=typeof window}getNestedProperty(t,e){return e.split(".").reduce((t,e)=>null==t?void 0:t[e],t)}formatCurrency(t){return t.toFixed(2)}extractEcommerceData(t){const e=t.ecommerce||t.data||{};return{currency:e.currency||"USD",value:e.value||e.total||0,items:e.items||e.products||[],transaction_id:e.transaction_id||e.order_id,coupon:e.coupon||e.discount_code,shipping:e.shipping||0,tax:e.tax||0}}}class Zc extends Qc{constructor(){super("GTM")}trackEvent(t){this.sendEvent(t)}sendEvent(t){if(!this.enabled||!this.isBrowser())return;window.dataLayer=window.dataLayer||[];const e=this.transformToGTMFormat(t);this.isEcommerceEvent(t.event)&&window.dataLayer.push({ecommerce:null}),window.dataLayer.push(e),this.debug("Event sent to GTM",e)}transformToGTMFormat(t){const e={event:t.event,event_timestamp:t.timestamp,event_id:t.id},i=t.attribution;if(this.isEcommerceEvent(t.event)){const n=h(u({},e),{ecommerce:this.buildEcommerceObject(t)});return i&&Object.keys(i).length>0&&(n.attribution=i,i.utm_source&&(n.utm_source=i.utm_source),i.utm_medium&&(n.utm_medium=i.utm_medium),i.utm_campaign&&(n.utm_campaign=i.utm_campaign),i.funnel&&(n.funnel=i.funnel),i.affiliate&&(n.affiliate=i.affiliate),i.gclid&&(n.gclid=i.gclid)),n}const n=u(u({},e),t.data);return i&&Object.keys(i).length>0&&(n.attribution=i,i.utm_source&&(n.utm_source=i.utm_source),i.utm_medium&&(n.utm_medium=i.utm_medium),i.utm_campaign&&(n.utm_campaign=i.utm_campaign),i.funnel&&(n.funnel=i.funnel),i.affiliate&&(n.affiliate=i.affiliate),i.gclid&&(n.gclid=i.gclid)),n}buildEcommerceObject(t){var e,i,n,r,s,a,o;const c=this.extractEcommerceData(t),l=this.getEcommerceEventType(t.event),d={currency:c.currency,value:parseFloat(this.formatCurrency(c.value))};return c.items.length>0&&(d.items=this.formatItems(c.items)),"purchase"===l&&(d.transaction_id=c.transaction_id,d.affiliation=(null==(e=t.data)?void 0:e.affiliation)||"Online Store",d.tax=c.tax,d.shipping=c.shipping,c.coupon&&(d.coupon=c.coupon)),"add_to_cart"===l&&(null==(i=t.data)?void 0:i.cart_id)&&(d.cart_id=t.data.cart_id),"view_item_list"===l&&(null==(n=t.data)?void 0:n.item_list_name)&&(d.item_list_name=t.data.item_list_name,d.item_list_id=t.data.item_list_id),"add_shipping_info"===l&&((null==(r=t.data)?void 0:r.shipping_tier)||c.shipping_tier)&&(d.shipping_tier=(null==(s=t.data)?void 0:s.shipping_tier)||c.shipping_tier),"add_payment_info"===l&&((null==(a=t.data)?void 0:a.payment_type)||c.payment_type)&&(d.payment_type=(null==(o=t.data)?void 0:o.payment_type)||c.payment_type),d}formatItems(t){return t.map((t,e)=>({item_id:t.item_id||t.id||t.product_id||t.sku,item_name:t.item_name||t.name||t.title,affiliation:t.affiliation||"Online Store",coupon:t.coupon||void 0,discount:t.discount||0,index:t.index||e,item_brand:t.item_brand||t.brand,item_category:t.item_category||t.category,item_category2:t.item_category2||t.category2,item_category3:t.item_category3||t.category3,item_category4:t.item_category4||t.category4,item_category5:t.item_category5||t.category5,item_list_id:t.item_list_id||t.list_id,item_list_name:t.item_list_name||t.list_name,item_variant:t.item_variant||t.variant,item_image:t.item_image||t.image||t.image_url||t.imageUrl,item_sku:t.item_sku||t.sku,location_id:t.location_id,price:parseFloat(this.formatCurrency(t.price||0)),quantity:t.quantity||1}))}isEcommerceEvent(t){return["dl_add_to_cart","dl_remove_from_cart","dl_view_cart","dl_begin_checkout","dl_add_payment_info","dl_add_shipping_info","dl_purchase","dl_view_item","dl_view_item_list","dl_select_item","dl_select_promotion","dl_view_promotion","add_to_cart","remove_from_cart","view_cart","begin_checkout","add_payment_info","add_shipping_info","purchase","view_item","view_item_list","select_item","select_promotion","view_promotion"].includes(t)}getEcommerceEventType(t){return t.replace(/^dl_/,"")}}class Wc extends Qc{constructor(t){super("Facebook"),this.blockedEvents=[],this.eventMapping={dl_page_view:"PageView",dl_view_item:"ViewContent",dl_add_to_cart:"AddToCart",dl_remove_from_cart:"RemoveFromCart",dl_begin_checkout:"InitiateCheckout",dl_add_shipping_info:"AddShippingInfo",dl_add_payment_info:"AddPaymentInfo",dl_purchase:"Purchase",dl_search:"Search",dl_add_to_wishlist:"AddToWishlist",dl_sign_up:"CompleteRegistration",dl_login:"Login",dl_subscribe:"Subscribe",dl_start_trial:"StartTrial",dl_view_cart:"ViewCart",dl_viewed_upsell:"ViewedUpsell",dl_accepted_upsell:"AcceptedUpsell",dl_skipped_upsell:"SkippedUpsell",page_view:"PageView",view_item:"ViewContent",add_to_cart:"AddToCart",remove_from_cart:"RemoveFromCart",begin_checkout:"InitiateCheckout",add_shipping_info:"AddShippingInfo",add_payment_info:"AddPaymentInfo",purchase:"Purchase",search:"Search",add_to_wishlist:"AddToWishlist",sign_up:"CompleteRegistration",login:"Login",subscribe:"Subscribe",start_trial:"StartTrial",view_cart:"ViewCart"},(null==t?void 0:t.blockedEvents)&&(this.blockedEvents=t.blockedEvents),(null==t?void 0:t.storeName)&&(this.storeName=t.storeName)}trackEvent(t){this.sendEvent(t)}isFbqLoaded(){return this.isBrowser()&&"function"==typeof window.fbq}sendEvent(t){this.enabled?this.blockedEvents.includes(t.event)?this.debug(`Event ${t.event} is blocked for Facebook`):this.isFbqLoaded()?this.sendEventInternal(t):this.waitForFbq().then(()=>{this.sendEventInternal(t)}).catch(()=>{this.debug("Facebook Pixel failed to load, skipping event:",t.event)}):this.debug("Facebook adapter disabled")}waitForFbq(t=5e3){return g(this,null,function*(){const e=Date.now();return new Promise((i,n)=>{const r=setInterval(()=>{this.isFbqLoaded()?(clearInterval(r),i()):Date.now()-e>t&&(clearInterval(r),n(new Error("Facebook Pixel load timeout")))},100)})})}sendEventInternal(t){const e=this.mapEventName(t.event);if(!e)return void this.debug(`No Facebook mapping for event: ${t.event}`);const i=this.transformParameters(t,e);try{if(window.fbq)if("AddShippingInfo"===e)window.fbq("trackCustom",e,i),this.debug(`Custom event sent to Facebook: ${e}`,i);else if("Purchase"===e&&this.storeName){const t=i.order_number||i.order_id;if(t){const n=`${this.storeName}-${t}`;window.fbq("track",e,i,{eventID:n}),this.debug(`Event sent to Facebook: ${e} with eventID: ${n}`,i)}else window.fbq("track",e,i),this.debug(`Event sent to Facebook: ${e} (no order identifier for eventID)`,i)}else window.fbq("track",e,i),this.debug(`Event sent to Facebook: ${e}`,i)}catch(n){}}mapEventName(t){return this.eventMapping[t]||null}transformParameters(t,e){var i,n;switch((null==(i=t.data)?void 0:i.value)&&parseFloat(this.formatCurrency(t.data.value)),(null==(n=t.data)?void 0:n.currency)&&t.data.currency,e){case"ViewContent":return this.buildViewContentParams(t);case"AddToCart":case"RemoveFromCart":return this.buildAddToCartParams(t);case"InitiateCheckout":return this.buildCheckoutParams(t);case"AddShippingInfo":return this.buildShippingInfoParams(t);case"AddPaymentInfo":return this.buildPaymentInfoParams(t);case"Purchase":return this.buildPurchaseParams(t);case"Search":return this.buildSearchParams(t);case"CompleteRegistration":return this.buildRegistrationParams(t);case"ViewedUpsell":case"AcceptedUpsell":case"SkippedUpsell":return this.buildUpsellParams(t,e);default:return this.buildGenericParams(t)}}buildViewContentParams(t){const e=this.extractEcommerceData(t),i=e.items||[],n={content_type:"product",currency:e.currency||"USD",value:e.value||0};return i.length>0&&(n.content_ids=i.map(t=>t.item_id||t.id||t.product_id||t.sku||t.external_id),n.contents=i.map(t=>({id:t.item_id||t.id||t.product_id||t.sku||t.external_id,quantity:t.quantity||1,item_price:t.price||t.item_price||0})),n.content_name=i[0].item_name||i[0].name||i[0].title,n.content_category=i[0].item_category||i[0].category||"uncategorized"),n}buildAddToCartParams(t){const e=this.extractEcommerceData(t),i=e.items||[],n={content_type:"product",currency:e.currency||"USD",value:e.value||0};if(i.length>0){n.content_ids=i.map(t=>t.item_id||t.id||t.product_id||t.sku||t.external_id);const t=i.map(t=>t.item_name||t.name||t.title).filter(Boolean);t.length>0&&(n.content_name=t.join(", "));const e=i[0].item_category||i[0].category;e&&(n.content_category=e);const r=i.reduce((t,e)=>t+(e.quantity||1),0);n.num_items=r,n.contents=i.map(t=>({id:t.item_id||t.id||t.product_id||t.sku||t.external_id,quantity:t.quantity||1,item_price:t.price||t.item_price||0,name:t.item_name||t.name,category:t.item_category||t.category||"uncategorized"}))}return n}buildShippingInfoParams(t){var e,i;const n=this.extractEcommerceData(t),r=n.items||[],s={content_type:"product",currency:n.currency||"USD",value:n.value||0,num_items:r.length};return r.length>0&&(s.content_ids=r.map(t=>t.item_id||t.id||t.product_id||t.sku||t.external_id),s.contents=r.map(t=>({id:t.item_id||t.id||t.product_id||t.sku||t.external_id,quantity:t.quantity||1,item_price:t.price||t.item_price||0}))),(n.shipping_tier||(null==(e=t.data)?void 0:e.shipping_tier))&&(s.shipping_tier=n.shipping_tier||(null==(i=t.data)?void 0:i.shipping_tier)),s}buildPaymentInfoParams(t){var e,i;const n=this.extractEcommerceData(t),r=n.items||[],s={content_type:"product",currency:n.currency||"USD",value:n.value||0,num_items:r.length};return r.length>0&&(s.content_ids=r.map(t=>t.item_id||t.id||t.product_id||t.sku||t.external_id),s.contents=r.map(t=>({id:t.item_id||t.id||t.product_id||t.sku||t.external_id,quantity:t.quantity||1,item_price:t.price||t.item_price||0}))),(n.payment_type||(null==(e=t.data)?void 0:e.payment_type))&&(s.payment_type=n.payment_type||(null==(i=t.data)?void 0:i.payment_type)),s}buildCheckoutParams(t){var e,i;const n=t.ecommerce||t.data||{},r=n.items||n.products||[],s={content_type:"product",currency:n.currency||"USD",value:n.value||n.total||0,num_items:r.length};return r.length>0&&(s.content_ids=r.map(t=>t.item_id||t.id||t.product_id||t.sku||t.external_id),s.contents=r.map(t=>({id:t.item_id||t.id||t.product_id||t.sku||t.external_id,quantity:t.quantity||1,item_price:t.price||t.item_price||0}))),(n.coupon||n.discount_code||(null==(e=t.data)?void 0:e.coupon))&&(s.coupon=n.coupon||n.discount_code||(null==(i=t.data)?void 0:i.coupon)),s}buildPurchaseParams(t){var e,i;const n=this.extractEcommerceData(t),r=n.items||[],s={content_type:"product",currency:n.currency||"USD",value:n.value||0,num_items:r.length,order_id:n.transaction_id||(null==(e=t.data)?void 0:e.order_id),order_number:null==(i=t.data)?void 0:i.order_number};return r.length>0&&(s.content_ids=r.map(t=>t.item_id||t.id||t.product_id||t.sku||t.external_id),s.contents=r.map(t=>({id:t.item_id||t.id||t.product_id||t.sku||t.external_id,quantity:t.quantity||1,item_price:t.price||t.item_price||0}))),s}buildSearchParams(t){const e=t.data||{};return{search_string:e.search_term||e.query||"",content_category:e.category,content_ids:e.product_ids||[]}}buildRegistrationParams(t){const e=t.data||{};return{content_name:e.registration_method||"email",status:e.status||"completed",value:e.value||0,currency:e.currency||"USD"}}buildUpsellParams(t,e){var i;const n={content_type:"product",order_id:t.order_id||(null==(i=t.data)?void 0:i.order_id),event_name:e};return t.upsell&&(n.content_ids=[t.upsell.package_id],n.content_name=t.upsell.package_name||`Package ${t.upsell.package_id}`,void 0!==t.upsell.value&&(n.value=parseFloat(this.formatCurrency(t.upsell.value))),void 0!==t.upsell.price&&(n.value=parseFloat(this.formatCurrency(t.upsell.price))),t.upsell.currency&&(n.currency=t.upsell.currency),void 0!==t.upsell.quantity&&(n.num_items=t.upsell.quantity)),n}buildGenericParams(t){const e=t.data||{},i={};return void 0!==e.value&&(i.value=e.value),e.currency&&(i.currency=e.currency),e.content_name&&(i.content_name=e.content_name),e.content_type&&(i.content_type=e.content_type),e.content_category&&(i.content_category=e.content_category),i}}const Yc=tt("RudderStack");class Xc extends Qc{constructor(){super("RudderStack"),this.pageViewSent=!1}trackEvent(t){this.sendEvent(t)}isRudderStackLoaded(){return this.isBrowser()&&"object"==typeof window.rudderanalytics&&"function"==typeof window.rudderanalytics.track}sendEvent(t){this.enabled?(Yc.info(`Processing event "${t.event}"`,{eventName:t.event,eventData:t}),this.isRudderStackLoaded()?this.sendEventInternal(t):this.waitForRudderStack().then(()=>{this.sendEventInternal(t)}).catch(()=>{this.debug("RudderStack failed to load, skipping event:",t.event)})):this.debug("RudderStack adapter disabled")}waitForRudderStack(t=5e3){return g(this,null,function*(){const e=Date.now();return new Promise((i,n)=>{var r;if(null==(r=window.rudderanalytics)?void 0:r.ready)window.rudderanalytics.ready(()=>i()),setTimeout(()=>{this.isRudderStackLoaded()?i():n(new Error("RudderStack ready timeout"))},t);else{const r=setInterval(()=>{this.isRudderStackLoaded()?(clearInterval(r),i()):Date.now()-e>t&&(clearInterval(r),n(new Error("RudderStack load timeout")))},100)}})})}sendEventInternal(t){try{switch(t.event){case"dl_page_view":case"page_view":this.handlePageView(t);break;case"dl_user_data":case"user_data":this.handleUserData(t);break;default:const e=this.mapEventName(t.event);if(e){const i=this.buildEventProperties(t,e);window.rudderanalytics.track(e,i),this.debug(`Event sent to RudderStack: ${e}`,i)}}}catch(e){}}handlePageView(t){if(this.pageViewSent)return void this.debug("Page view already sent, skipping duplicate");const e=t.data||{},i=e.page_type||"unknown",n=e.page_name||"unknown",r=this.getCampaignData(e),s={path:e.page_location||window.location.pathname,url:e.page_location||window.location.href,title:e.page_title||document.title,referrer:e.page_referrer||document.referrer,campaignName:r.campaignName,campaignApiKey:r.campaignApiKey,campaignCurrency:r.campaignCurrency,campaignLanguage:r.campaignLanguage};window.rudderanalytics.page(i,n,s);const a=`${i.charAt(0).toUpperCase()+i.slice(1)} Page View`;window.rudderanalytics.track(a,u({pageName:n},s)),this.pageViewSent=!0,this.debug("Page View tracked",{pageType:i,pageName:n,eventName:a})}handleUserData(t){const e=t.user_properties||t.data||{};if(e.customer_email||e.email||e.user_id){const t=e.user_id||e.customer_email||e.email,i={email:e.customer_email||e.email,firstName:e.customer_first_name||e.firstName||e.first_name,lastName:e.customer_last_name||e.lastName||e.last_name,phone:e.customer_phone||e.phone,city:e.customer_city||e.city,state:e.customer_state||e.state,country:e.customer_country||e.country,postalCode:e.customer_zip||e.postalCode||e.postal_code,acceptsMarketing:e.customer_accepts_marketing||e.acceptsMarketing||e.accepts_marketing};Object.keys(i).forEach(t=>void 0===i[t]&&delete i[t]),window.rudderanalytics.identify(t,i),this.debug("User Identified",{userId:t,traits:i})}}mapEventName(t){return{dl_view_item:"Product Viewed",dl_view_item_list:"Product List Viewed",dl_add_to_cart:"Product Added",dl_remove_from_cart:"Product Removed",dl_view_cart:"Cart Viewed",dl_cart_updated:"Cart Viewed",dl_begin_checkout:"Checkout Started",dl_add_shipping_info:"Shipping Info Added",dl_add_payment_info:"Payment Info Added",dl_purchase:"Order Completed",view_item:"Product Viewed",view_item_list:"Product List Viewed",add_to_cart:"Product Added",remove_from_cart:"Product Removed",view_cart:"Cart Viewed",begin_checkout:"Checkout Started",add_shipping_info:"Shipping Info Added",add_payment_info:"Payment Info Added",purchase:"Order Completed",dl_viewed_upsell:"Upsell Viewed",dl_accepted_upsell:"Upsell Accepted",dl_skipped_upsell:"Upsell Skipped",dl_sign_up:"Signed Up",dl_login:"Logged In",sign_up:"Signed Up",login:"Logged In"}[t]||null}buildEventProperties(t,e){const i=t.data||t.ecommerce||{},n=this.getPageMetadata(),r=this.getCampaignData(i),s={pageType:n.pageType,pageName:n.pageName,campaignName:r.campaignName,campaignApiKey:r.campaignApiKey};switch(e){case"Product Viewed":return this.buildProductViewedProps(i,s);case"Product List Viewed":return this.buildProductListViewedProps(i,s);case"Product Added":case"Product Removed":return this.buildProductAddedRemovedProps(i,s);case"Cart Viewed":return this.buildCartViewedProps(i,s);case"Checkout Started":return this.buildCheckoutStartedProps(i,s);case"Shipping Info Added":return this.buildShippingInfoProps(i,s);case"Payment Info Added":return this.buildPaymentInfoProps(i,s);case"Order Completed":return this.buildOrderCompletedProps(i,s);case"Upsell Viewed":case"Upsell Accepted":case"Upsell Skipped":return this.buildUpsellProps(t,e,s);default:return u(u({},i),s)}}buildProductViewedProps(t,e){const i=(t.items||[])[0]||{};return u({product_id:i.item_id||"",sku:i.item_id||"",name:i.item_name||"",price:parseFloat(i.price)||0,currency:t.currency||"USD",quantity:parseInt(i.quantity)||1,position:i.position||0,url:window.location.href},e)}buildProductListViewedProps(t,e){const i=this.formatProducts(t.items||[]);return u({list_id:t.list_id||"main-product-list",category:e.pageType,products:i,currency:t.currency||"USD"},e)}buildProductAddedRemovedProps(t,e){const i=(t.items||[])[0]||{},n=this.getCampaignData(t);return u({cart_id:`cart-${Date.now()}`,product_id:i.item_id||"",sku:i.item_id||"",name:i.item_name||"",price:parseFloat(i.price)||0,currency:t.currency||n.campaignCurrency||"USD",quantity:parseInt(i.quantity)||1,category:i.item_category||"",position:i.position||0,url:window.location.href},e)}buildCartViewedProps(t,e){const i=this.formatProducts(t.items||[]),n=this.getCampaignData(t);return u({cart_id:`cart-${Date.now()}`,products:i,currency:t.currency||n.campaignCurrency||"USD",value:parseFloat(t.value)||0},e)}buildShippingInfoProps(t,e){const i=this.formatProducts(t.items||[]),n=this.getCampaignData(t);return u({checkout_id:`checkout-${Date.now()}`,value:parseFloat(t.value)||0,currency:t.currency||n.campaignCurrency||"USD",shipping_tier:t.shipping_tier||"standard",products:i},e)}buildPaymentInfoProps(t,e){const i=this.formatProducts(t.items||[]),n=this.getCampaignData(t);return u({checkout_id:`checkout-${Date.now()}`,value:parseFloat(t.value)||0,currency:t.currency||n.campaignCurrency||"USD",payment_type:t.payment_type||"credit_card",products:i},e)}buildCheckoutStartedProps(t,e){const i=this.formatProducts(t.items||[]),n=this.getCampaignData(t);return u({order_id:`pending-${Date.now()}`,value:parseFloat(t.value)||0,revenue:parseFloat(t.value)||0,currency:t.currency||n.campaignCurrency||"USD",products:i},e)}buildOrderCompletedProps(t,e){const i=this.formatProducts(t.items||[]),n=this.getCampaignData(t),r=u({checkout_id:`checkout-${Date.now()}`,order_id:t.transaction_id||"",affiliation:t.affiliation||n.campaignName||"Funnels",total:parseFloat(t.value)||0,revenue:parseFloat(t.value)||0,shipping:parseFloat(t.shipping)||0,tax:parseFloat(t.tax)||0,discount:parseFloat(t.discount)||0,coupon:t.coupon||"",currency:t.currency||n.campaignCurrency||"USD",products:i},e);if(t.email_hash||t.firstname){const e=t.email_hash||`user-${t.transaction_id}`,i={firstName:t.firstname||"",lastName:t.lastname||"",city:t.city||"",state:t.state||"",postalCode:t.zipcode||"",country:t.country||""};Object.keys(i).forEach(t=>""===i[t]&&delete i[t]),Object.keys(i).length>0&&(window.rudderanalytics.identify(e,i),this.debug("User Identified on Purchase",{userId:e}))}return r}buildUpsellProps(t,e,i){const n=t.data||t,r=this.getCampaignData(n);if("Upsell Accepted"===e){const t=u({cart_id:`cart-upsell-${Date.now()}`,product_id:n.upsell_id||"",sku:n.upsell_id||"",name:n.upsell_name||"",price:parseFloat(n.upsell_price)||0,currency:n.currency||r.campaignCurrency||"USD",quantity:1,url:window.location.href,isUpsell:!0,upsellRef:n.upsell_id||"",originalOrderId:n.order_id||n.transaction_id||""},i);window.rudderanalytics.track("Product Added",t)}return u({order_id:n.order_id||n.transaction_id||"",product_id:n.upsell_id||"",product_name:n.upsell_name||"",price:parseFloat(n.upsell_price)||0,quantity:1,total:parseFloat(n.value||n.upsell_price)||0,currency:n.currency||r.campaignCurrency||"USD",ref_id:n.upsell_id||""},i)}formatProducts(t){return t&&Array.isArray(t)?t.map(t=>({product_id:t.item_id||t.id||"",sku:t.item_id||t.id||"",name:t.item_name||t.name||"",price:parseFloat(t.price)||0,quantity:parseInt(t.quantity)||1,category:t.item_category||t.category||"",brand:t.item_brand||t.brand||"",variant:t.item_variant||"",position:t.position||0,url:window.location.href,image_url:t.image_url||""})):[]}getPageMetadata(){var t,e;return{pageType:(null==(t=document.querySelector('meta[name="next-page-type"]'))?void 0:t.getAttribute("content"))||"unknown",pageName:(null==(e=document.querySelector('meta[name="next-page-name"]'))?void 0:e.getAttribute("content"))||"unknown"}}getCampaignData(t){var e,i,n,r,s;if(t.campaignName)return{campaignName:t.campaignName,campaignApiKey:t.campaignApiKey||"",campaignCurrency:t.campaignCurrency||"USD",campaignLanguage:t.campaignLanguage||""};if(this.isBrowser()&&window.next){const t=window.next,a=null==(e=t.getCampaignData)?void 0:e.call(t);if(a)return{campaignName:a.name||"",campaignApiKey:(null==(s=null==(r=null==(n=null==(i=window.nextDebug)?void 0:i.stores)?void 0:n.config)?void 0:r.getState())?void 0:s.apiKey)||"",campaignCurrency:a.currency||"USD",campaignLanguage:a.language||""}}return{campaignName:"",campaignApiKey:"",campaignCurrency:"USD",campaignLanguage:""}}}class tl extends Qc{constructor(){super("NextCampaign"),this.logger=tt("NextCampaignAdapter"),this.scriptLoaded=!1,this.scriptLoading=!1,this.loadPromise=null,this.apiKey=""}initialize(t){return g(this,null,function*(){if(this.logger.info("NextCampaign adapter initializing..."),null==t?void 0:t.apiKey)this.apiKey=t.apiKey,this.logger.info("API key provided via config parameter");else{const t=yt.getState();this.apiKey=t.apiKey||"",this.logger.info("API key from config store: "+(this.apiKey?"found":"not found"))}this.apiKey?(this.logger.info(`NextCampaign API key found: ${this.apiKey.substring(0,8)}...${this.apiKey.substring(this.apiKey.length-4)}`),yield this.loadScript()):this.logger.warn("No API key available for NextCampaign initialization")})}trackEvent(t){this.sendEvent(t)}sendEvent(t){return g(this,null,function*(){if(!this.enabled)return void this.debug("NextCampaign adapter disabled");this.scriptLoaded||(yield this.loadScript());const e=this.mapEvent(t);if(e)try{window.nextCampaign&&(window.nextCampaign.event(e.name,e.data),this.debug(`Event sent to NextCampaign: ${e.name}`,e.data))}catch(i){this.logger.error("Error sending event to NextCampaign:",i)}})}loadScript(){return g(this,null,function*(){if(!this.scriptLoaded){if(this.scriptLoading)return this.loadPromise;this.scriptLoading=!0,this.loadPromise=this.performLoad();try{yield this.loadPromise,this.scriptLoaded=!0,this.logger.info("NextCampaign SDK loaded and initialized successfully âœ…")}catch(t){throw this.logger.error("Failed to load NextCampaign SDK:",t),t}finally{this.scriptLoading=!1}}})}performLoad(){return g(this,null,function*(){const t="https://campaigns.apps.29next.com/js/v1/campaign/";document.querySelector(`script[src="${t}"]`)?yield this.waitForNextCampaign():(yield new Promise((e,i)=>{const n=document.createElement("script");n.async=!0,n.src=t,n.onload=()=>{this.logger.debug("NextCampaign script loaded"),e()},n.onerror=()=>{i(new Error(`Failed to load NextCampaign script: ${t}`))},document.head.appendChild(n)}),yield this.waitForNextCampaign(),window.nextCampaign&&this.apiKey&&(window.nextCampaign.config({apiKey:this.apiKey}),this.logger.debug("NextCampaign configured with API key"),this.fireInitialPageView()))})}fireInitialPageView(){"complete"===document.readyState?this.sendPageView():window.addEventListener("load",()=>{this.sendPageView()})}sendPageView(){try{window.nextCampaign&&(window.nextCampaign.event("page_view",{title:document.title,url:window.location.href}),this.logger.info("Initial page_view event sent to NextCampaign"))}catch(t){this.logger.error("Error sending initial page view to NextCampaign:",t)}}waitForNextCampaign(t=5e3){return g(this,null,function*(){const e=Date.now();return new Promise((i,n)=>{const r=setInterval(()=>{window.nextCampaign?(clearInterval(r),i()):Date.now()-e>t&&(clearInterval(r),n(new Error("NextCampaign load timeout")))},100)})})}mapEvent(t){switch(t.event){case"dl_page_view":case"page_view":return{name:"page_view",data:{title:document.title,url:window.location.href}};default:return null}}}class el extends Qc{constructor(t={}){super("Custom"),this.eventQueue=[],this.batchTimer=null,this.retryQueue=new Map,this.config={endpoint:t.endpoint||"",headers:u({"Content-Type":"application/json"},t.headers),batchSize:t.batchSize||10,batchIntervalMs:t.batchIntervalMs||5e3,maxRetries:t.maxRetries||3,retryDelayMs:t.retryDelayMs||1e3,transformFunction:t.transformFunction||(t=>t)}}updateConfig(t){this.config=u(u({},this.config),t),t.headers&&(this.config.headers=u(u({},this.config.headers),t.headers))}sendEvent(t){this.enabled&&this.config.endpoint?(this.eventQueue.push(t),this.debug(`Event queued. Queue size: ${this.eventQueue.length}`),this.eventQueue.length>=this.config.batchSize?this.sendBatch():this.scheduleBatch()):this.debug("Custom adapter disabled or no endpoint configured")}scheduleBatch(){this.batchTimer||(this.batchTimer=setTimeout(()=>{this.sendBatch()},this.config.batchIntervalMs))}sendBatch(){return g(this,null,function*(){this.batchTimer&&(clearTimeout(this.batchTimer),this.batchTimer=null);const t=this.eventQueue.splice(0,this.config.batchSize);if(0!==t.length){this.debug(`Sending batch of ${t.length} events`);try{const e=t.map(t=>this.config.transformFunction(t)),i={events:e,batch_info:{size:e.length,timestamp:(new Date).toISOString(),source:"next-campaign-cart"}},n=yield this.sendRequest(i);if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);this.debug("Batch sent successfully")}catch(e){t.forEach(t=>{this.addToRetryQueue(t)})}this.eventQueue.length>0&&this.scheduleBatch()}})}sendRequest(t,e=1){return g(this,null,function*(){try{return yield fetch(this.config.endpoint,{method:"POST",headers:this.config.headers,body:JSON.stringify(t)})}catch(i){if(e<this.config.maxRetries)return yield this.delay(this.config.retryDelayMs*e),this.sendRequest(t,e+1);throw i}})}addToRetryQueue(t){const e=t.id?this.retryQueue.get(t.id):void 0;e?e.attempts<this.config.maxRetries?(e.attempts++,t.id&&this.scheduleRetry(t.id)):t.id&&this.retryQueue.delete(t.id):t.id&&(this.retryQueue.set(t.id,{event:t,attempts:1}),this.scheduleRetry(t.id))}scheduleRetry(t){const e=this.retryQueue.get(t);if(!e)return;const i=this.config.retryDelayMs*e.attempts;setTimeout(()=>{const e=this.retryQueue.get(t);e&&(this.retryQueue.delete(t),this.sendEvent(e.event))},i)}delay(t){return new Promise(e=>setTimeout(e,t))}flush(){return g(this,null,function*(){for(this.debug("Flushing all queued events"),this.batchTimer&&(clearTimeout(this.batchTimer),this.batchTimer=null);this.eventQueue.length>0;)yield this.sendBatch()})}getQueueSize(){return this.eventQueue.length}getRetryQueueSize(){return this.retryQueue.size}clearQueue(){this.eventQueue=[],this.retryQueue.clear(),this.batchTimer&&(clearTimeout(this.batchTimer),this.batchTimer=null)}}const il=tt("ListAttributionTracker"),nl="analytics_current_list",rl=18e5;class sl{constructor(){this.currentList=null,this.loadFromStorage(),this.setupUrlTracking()}static getInstance(){return sl.instance||(sl.instance=new sl),sl.instance}initialize(){il.debug("ListAttributionTracker initialized")}setCurrentList(t,e){const i=h(u(u({},void 0!==t&&{listId:t}),void 0!==e&&{listName:e}),{timestamp:Date.now(),url:window.location.href});this.currentList=i,this.saveToStorage(),il.debug("Set current list:",{listId:t,listName:e})}getCurrentList(){return this.currentList?Date.now()-this.currentList.timestamp>rl?(il.debug("List context expired"),this.clearCurrentList(),null):u(u({},void 0!==this.currentList.listId&&{listId:this.currentList.listId}),void 0!==this.currentList.listName&&{listName:this.currentList.listName}):null}clearCurrentList(){this.currentList=null,this.removeFromStorage(),il.debug("Cleared current list")}reset(){this.clearCurrentList(),il.debug("ListAttributionTracker reset")}detectListFromUrl(t){const e=t||window.location.href,i=new URL(e,window.location.origin),n=i.pathname.toLowerCase(),r=[{regex:/\/collections?\/([^\/]+)/,type:"collection"},{regex:/\/category\/([^\/]+)/,type:"category"},{regex:/\/categories\/([^\/]+)/,type:"category"},{regex:/\/products\/?$/,type:"all_products"},{regex:/\/shop\/?$/,type:"shop"},{regex:/\/store\/?$/,type:"store"},{regex:/\/search/,type:"search"},{regex:/\/tag\/([^\/]+)/,type:"tag"},{regex:/\/tags\/([^\/]+)/,type:"tag"},{regex:/\/brand\/([^\/]+)/,type:"brand"},{regex:/\/brands\/([^\/]+)/,type:"brand"}];for(const a of r){const t=n.match(a.regex);if(t){const e=t[1]||a.type,i=this.formatListName(e,a.type);return il.debug("Detected list from URL:",{listId:e,listName:i,type:a.type}),{listId:e,listName:i}}}const s=i.searchParams;if(s.has("category")){const t=s.get("category");return{listId:t,listName:this.formatListName(t,"category")}}if(s.has("collection")){const t=s.get("collection");return{listId:t,listName:this.formatListName(t,"collection")}}return s.has("q")||s.has("query")||s.has("search")?{listId:"search_results",listName:`Search Results: ${s.get("q")||s.get("query")||s.get("search")||""}`}:null}setupUrlTracking(){if("undefined"==typeof window)return;this.trackCurrentUrl(),window.addEventListener("popstate",()=>{this.trackCurrentUrl()});const t=history.pushState,e=history.replaceState;history.pushState=function(...e){t.apply(history,e),setTimeout(()=>sl.getInstance().trackCurrentUrl(),0)},history.replaceState=function(...t){e.apply(history,t),setTimeout(()=>sl.getInstance().trackCurrentUrl(),0)}}trackCurrentUrl(){const t=this.detectListFromUrl();if(t)this.setCurrentList(t.listId,t.listName);else{const t=window.location.pathname.toLowerCase();this.isProductPage(t)||this.clearCurrentList()}}isProductPage(t){return[/\/product\/[^\/]+/,/\/products\/[^\/]+/,/\/item\/[^\/]+/,/\/p\/[^\/]+/].some(e=>e.test(t))}formatListName(t,e){const i=t.replace(/[-_]/g," ").replace(/\b\w/g,t=>t.toUpperCase());switch(e){case"collection":return`${i} Collection`;case"category":return`${i} Category`;case"all_products":return"All Products";case"shop":return"Shop";case"store":return"Store";case"search":return"Search Results";case"tag":return`Tag: ${i}`;case"brand":return`${i} Brand`;default:return i}}loadFromStorage(){if("undefined"!=typeof window&&window.sessionStorage)try{const t=sessionStorage.getItem(nl);if(t){const e=JSON.parse(t);Date.now()-e.timestamp<rl?(this.currentList=e,il.debug("Loaded list context from storage:",e)):this.removeFromStorage()}}catch(t){il.error("Error loading list context from storage:",t)}}saveToStorage(){if("undefined"!=typeof window&&window.sessionStorage&&this.currentList)try{sessionStorage.setItem(nl,JSON.stringify(this.currentList))}catch(t){il.error("Error saving list context to storage:",t)}}removeFromStorage(){if("undefined"!=typeof window&&window.sessionStorage)try{sessionStorage.removeItem(nl)}catch(t){il.error("Error removing list context from storage:",t)}}}const al=sl.getInstance(),ol=tt("ViewItemListTracker");class cl{constructor(){this.observer=null,this.trackedProducts=new Set,this.lastScanTime=0,this.scanDebounceMs=500,this.isInitialized=!1}static getInstance(){return cl.instance||(cl.instance=new cl),cl.instance}initialize(){this.isInitialized||"undefined"==typeof window||(this.isInitialized=!0,Kc.initialize(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.scan()):setTimeout(()=>this.scan(),100),this.setupObserver(),ol.info("ViewItemListTracker initialized"))}scan(){const t=Date.now();if(t-this.lastScanTime<this.scanDebounceMs)return void ol.debug("Scan debounced (too soon after last scan)");this.lastScanTime=t;const e=this.findProductElements();if(0!==e.length)if(ol.debug(`Found ${e.length} products on page`),1===e.length){const t=e[0];t&&this.trackViewItem(t)}else this.trackViewItemList(e);else ol.debug("No products found on page")}rescan(){ol.debug("Manual rescan triggered"),this.trackedProducts.clear(),this.scan()}findProductElements(){const t=document.querySelectorAll("[data-next-package-id]"),e=[],i=new Set;return t.forEach((t,n)=>{const r=t.getAttribute("data-next-package-id");r&&!i.has(r)&&(i.add(r),e.push({packageId:r,element:t,index:n}))}),e}trackViewItem(t){var e,i,n,r,s,a,o;if(this.trackedProducts.has(t.packageId))return void ol.debug("Product already tracked:",t.packageId);const c=dt.getState();if(!c.data||!c.packages||0===c.packages.length)return ol.debug("Campaign data not yet loaded, deferring tracking"),void setTimeout(()=>this.scan(),1e3);const l=parseInt(t.packageId,10),d=isNaN(l)?null:c.getPackage(l);if(!d)return void ol.warn("Package not found in store:",t.packageId);const h=al.getCurrentList(),p=u(u({item_id:d.external_id.toString(),item_name:d.name||`Package ${t.packageId}`,currency:(null==(e=c.data)?void 0:e.currency)||"USD",price:parseFloat(d.price_total||"0"),quantity:1,item_category:(null==(i=c.data)?void 0:i.name)||"Campaign",item_variant:d.product_variant_name||(null==(r=null==(n=d.product)?void 0:n.variant)?void 0:r.name),item_brand:d.product_name||(null==(s=d.product)?void 0:s.name),item_sku:d.product_sku||(null==(o=null==(a=d.product)?void 0:a.variant)?void 0:o.sku)},d.image&&{item_image:d.image}),h&&{item_list_id:h.listId,item_list_name:h.listName}),f=Kc.formatEcommerceEvent("dl_view_item",{currency:p.currency,value:p.price,items:[p]});Kc.push(f),this.trackedProducts.add(t.packageId),ol.debug("Tracked view_item:",t.packageId)}trackViewItemList(t){var e;const i=dt.getState(),n=[];let r=0;if(!i.data||!i.packages||0===i.packages.length)return ol.debug("Campaign data not yet loaded, deferring tracking"),void setTimeout(()=>this.scan(),1e3);const s=al.getCurrentList()||al.detectListFromUrl()||{listId:"product_list",listName:"Product List"};if(t.forEach((t,e)=>{var a,o,c,l,d,p,f;if(this.trackedProducts.has(t.packageId))return;const m=parseInt(t.packageId,10),g=isNaN(m)?null:i.getPackage(m);if(!g)return void ol.warn("Package not found in store:",t.packageId);const v=parseFloat(g.price_total||"0");r+=v,n.push(h(u({item_id:g.external_id.toString(),item_name:g.name||`Package ${t.packageId}`,currency:(null==(a=i.data)?void 0:a.currency)||"USD",price:v,quantity:1,item_category:(null==(o=i.data)?void 0:o.name)||"Campaign",item_variant:g.product_variant_name||(null==(l=null==(c=g.product)?void 0:c.variant)?void 0:l.name),item_brand:g.product_name||(null==(d=g.product)?void 0:d.name),item_sku:g.product_sku||(null==(f=null==(p=g.product)?void 0:p.variant)?void 0:f.sku)},g.image&&{item_image:g.image}),{item_list_id:s.listId,item_list_name:s.listName,index:e})),this.trackedProducts.add(t.packageId)}),0===n.length)return void ol.debug("No new products to track");const a=Kc.formatEcommerceEvent("dl_view_item_list",{currency:(null==(e=i.data)?void 0:e.currency)||"USD",value:r,items:n,item_list_id:s.listId,item_list_name:s.listName});Kc.push(a),ol.debug(`Tracked view_item_list with ${n.length} items`)}setupObserver(){"undefined"!=typeof window&&window.MutationObserver&&(this.observer=new MutationObserver(t=>{let e=!1;for(const i of t){if("childList"===i.type)for(let t=0;t<i.addedNodes.length;t++){const n=i.addedNodes[t];if(n&&n.nodeType===Node.ELEMENT_NODE){const t=n;if(t.hasAttribute("data-next-package-id")||t.querySelector("[data-next-package-id]")){e=!0;break}}}else"attributes"===i.type&&"data-next-package-id"===i.attributeName&&(e=!0);if(e)break}e&&(ol.debug("Detected DOM changes with products"),this.scan())}),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-next-package-id"]}),ol.debug("Mutation observer set up"))}reset(){this.trackedProducts.clear(),ol.debug("ViewItemListTracker reset"),this.isInitialized&&this.scan()}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null),this.trackedProducts.clear(),this.isInitialized=!1,ol.debug("ViewItemListTracker destroyed")}getStatus(){return{initialized:this.isInitialized,trackedCount:this.trackedProducts.size,observing:null!==this.observer}}}cl.getInstance();const ll=tt("UserDataStorage");class dl{constructor(){this.userData={},this.cookieExpiryDays=365,this.loadUserData()}static getInstance(){return dl.instance||(dl.instance=new dl),dl.instance}setCookie(t,e,i){if("undefined"==typeof document)return;const n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);const r=`expires=${n.toUTCString()}`;document.cookie=`${t}=${encodeURIComponent(e)};${r};path=/;SameSite=Lax`}getCookie(t){if("undefined"==typeof document)return null;const e=`${t}=`,i=document.cookie.split(";");for(let n of i)if(n=n.trim(),0===n.indexOf(e))return decodeURIComponent(n.substring(e.length));return null}deleteCookie(t){"undefined"!=typeof document&&(document.cookie=`${t}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;`)}loadUserData(){if("undefined"!=typeof window)try{const e=this.getCookie("next_user_data");if(e)try{this.userData=JSON.parse(e),ll.debug("Loaded user data from cookie:",{hasEmail:!!this.userData.email,hasUserId:!!this.userData.userId})}catch(t){ll.warn("Failed to parse user data cookie:",t)}const i=sessionStorage.getItem("user_data");if(i)try{const t=JSON.parse(i);this.userData=u(u({},this.userData),t),ll.debug("Merged user data from sessionStorage")}catch(t){ll.warn("Failed to parse sessionStorage user data:",t)}if(!this.userData.visitorId){let t=localStorage.getItem("visitor_id");t||(t=this.generateId("visitor"),localStorage.setItem("visitor_id",t)),this.userData.visitorId=t}if(!this.userData.sessionId){let t=sessionStorage.getItem("session_id");t||(t=this.generateId("session"),sessionStorage.setItem("session_id",t)),this.userData.sessionId=t}}catch(t){ll.error("Failed to load user data:",t)}}saveUserData(){if("undefined"!=typeof window)try{const t=JSON.stringify(this.userData);this.setCookie("next_user_data",t,this.cookieExpiryDays),sessionStorage.setItem("user_data",t),ll.debug("Saved user data to storage:",{hasEmail:!!this.userData.email,hasUserId:!!this.userData.userId})}catch(t){ll.error("Failed to save user data:",t)}}generateId(t){return`${t}_${Date.now().toString(36)}_${Math.random().toString(36).substr(2,9)}`}updateUserData(t){const e=this.userData.email;this.userData=u(u({},this.userData),t),Object.keys(this.userData).forEach(t=>{void 0!==this.userData[t]&&null!==this.userData[t]&&""!==this.userData[t]||delete this.userData[t]}),this.saveUserData(),t.email&&t.email!==e&&ll.info("User email updated:",t.email)}getUserData(){return u({},this.userData)}getUserField(t){return this.userData[t]}clearUserData(){const{visitorId:t,sessionId:e}=this.userData;this.userData={},void 0!==t&&(this.userData.visitorId=t),void 0!==e&&(this.userData.sessionId=e),this.deleteCookie("next_user_data"),sessionStorage.removeItem("user_data"),ll.info("User data cleared")}isIdentified(){return!(!this.userData.email&&!this.userData.userId)}updateFromFormFields(){if("undefined"==typeof document)return;const t={};let e=!1;[{selector:'[name="email"], [data-next-checkout-field="email"], #email, [type="email"]',key:"email"},{selector:'[name="phone"], [data-next-checkout-field="phone"], #phone, [type="tel"]',key:"phone"},{selector:'[name="first_name"], [data-next-checkout-field="fname"], [name="firstName"], #first-name',key:"firstName"},{selector:'[name="last_name"], [data-next-checkout-field="lname"], [name="lastName"], #last-name',key:"lastName"}].forEach(({selector:i,key:n})=>{const r=document.querySelector(i);r&&r.value&&r.value!==this.userData[n]&&(t[n]=r.value,e=!0)}),e&&(this.updateUserData(t),ll.debug("Updated user data from form fields:",t))}}const ul=dl.getInstance(),hl=tt("UserDataTracker");class pl{constructor(){this.eventBus=st.getInstance(),this.lastTrackTime=0,this.trackDebounceMs=1e3,this.isInitialized=!1,this.unsubscribers=[]}static getInstance(){return pl.instance||(pl.instance=new pl),pl.instance}initialize(){this.isInitialized||"undefined"==typeof window||(this.isInitialized=!0,Kc.initialize(),this.trackUserData(),this.setupListeners(),hl.info("UserDataTracker initialized"))}trackUserData(){const t=Date.now();if(t-this.lastTrackTime<this.trackDebounceMs)return void hl.debug("User data tracking debounced");this.lastTrackTime=t;const e=this.collectUserData();if(!e||0===Object.keys(e).length)return void hl.debug("No user data to track");const i=Kc.formatUserDataEvent(e);Kc.push(i),hl.debug("Tracked user data:",{hasUserId:!!e.userId,hasEmail:!!e.email,cartValue:e.cartValue,cartItems:e.cartItems})}collectUserData(){const t=ul.getUserData();ul.updateFromFormFields();try{const e=Tt.getState();e.items&&e.items.length>0?(t.cartValue=e.total||e.subtotal||0,t.cartItems=e.totalQuantity||0,t.cartProducts=e.items.map(t=>{var e;return(null==(e=t.packageId)?void 0:e.toString())||"unknown"})):(t.cartValue=0,t.cartItems=0,t.cartProducts=[])}catch(e){hl.debug("Cart store not available or error accessing:",e)}try{const e=this.getCheckoutData();e&&Object.assign(t,e)}catch(e){hl.debug("Error getting checkout data:",e)}return t}getCheckoutData(){if("undefined"==typeof document)return null;const t={};return[{selector:'[name="email"], #email, [type="email"]',key:"email"},{selector:'[name="phone"], #phone, [type="tel"]',key:"phone"},{selector:'[name="first_name"], [name="firstName"], #first-name',key:"firstName"},{selector:'[name="last_name"], [name="lastName"], #last-name',key:"lastName"},{selector:'[name="address"], [name="address1"], #address',key:"address"},{selector:'[name="city"], #city',key:"city"},{selector:'[name="state"], [name="province"], #state',key:"state"},{selector:'[name="zip"], [name="postal_code"], #zip',key:"postalCode"},{selector:'[name="country"], #country',key:"country"}].forEach(({selector:e,key:i})=>{const n=document.querySelector(e);n&&n.value&&(t[i]=n.value)}),Object.keys(t).length>0?t:null}setupListeners(){this.eventBus.on("route:changed",()=>{hl.debug("Route changed, tracking user data"),this.trackUserData()}),this.eventBus.on("sdk:route-invalidated",()=>{hl.debug("SDK route invalidated, tracking user data"),this.trackUserData()}),this.eventBus.on("user:logged-in",()=>{hl.debug("User logged in, tracking user data"),setTimeout(()=>this.trackUserData(),100)}),this.eventBus.on("user:logged-out",()=>{hl.debug("User logged out, tracking user data"),setTimeout(()=>this.trackUserData(),100)}),this.eventBus.on("cart:updated",()=>{hl.debug("Cart updated, tracking user data"),this.trackUserData()});const t=Tt.subscribe(()=>{hl.debug("Cart store changed, tracking user data"),this.trackUserData()});if(this.unsubscribers.push(t),"undefined"!=typeof window){window.addEventListener("popstate",()=>{hl.debug("Browser navigation, tracking user data"),this.trackUserData()});const t=history.pushState,e=history.replaceState;history.pushState=function(...e){t.apply(history,e),setTimeout(()=>pl.getInstance().trackUserData(),0)},history.replaceState=function(...t){e.apply(history,t),setTimeout(()=>pl.getInstance().trackUserData(),0)}}hl.debug("User data tracking listeners set up")}forceTrack(){this.lastTrackTime=0,this.trackUserData()}reset(){this.lastTrackTime=0,this.trackUserData(),hl.debug("UserDataTracker reset")}destroy(){this.unsubscribers.forEach(t=>t()),this.unsubscribers=[],this.eventBus.removeAllListeners("route:changed"),this.eventBus.removeAllListeners("sdk:route-invalidated"),this.eventBus.removeAllListeners("user:logged-in"),this.eventBus.removeAllListeners("user:logged-out"),this.eventBus.removeAllListeners("cart:updated"),this.isInitialized=!1,hl.debug("UserDataTracker destroyed")}getStatus(){return{initialized:this.isInitialized,lastTrackTime:this.lastTrackTime,listenersCount:this.unsubscribers.length}}}pl.getInstance();const fl=tt("AutoEventListener");class ml{constructor(){this.eventBus=st.getInstance(),this.isInitialized=!1,this.eventHandlers=new Map,this.lastEventTimes=new Map,this.debounceConfig={"cart:item-added":1e3,"cart:item-removed":500,"cart:quantity-changed":500,"cart:updated":1e3,"cart:package-swapped":100}}static getInstance(){return ml.instance||(ml.instance=new ml),ml.instance}initialize(){this.isInitialized||(this.isInitialized=!0,Kc.initialize(),this.setupCartEventListeners(),this.setupUpsellEventListeners(),this.setupCheckoutEventListeners(),this.setupPageEventListeners(),fl.info("AutoEventListener initialized"))}shouldProcessEvent(t){const e=Date.now();return e-(this.lastEventTimes.get(t)||0)<(this.debounceConfig[t]||0)?(fl.debug(`Event ${t} debounced`),!1):(this.lastEventTimes.set(t,e),!0)}setupCartEventListeners(){const t=t=>g(this,null,function*(){var e,i,n,r,s,a,o;if(!this.shouldProcessEvent("cart:item-added"))return;const c=t.packageId,l=t.quantity||1,d=dt.getState(),h=d.getPackage(c);if(!h)return void fl.warn("Package not found for add to cart:",c);const p=al.getCurrentList(),f=u(u({item_id:h.external_id.toString(),item_name:h.name||`Package ${c}`,currency:(null==(e=d.data)?void 0:e.currency)||"USD",price:parseFloat(h.price_total||"0"),quantity:1,item_category:(null==(i=d.data)?void 0:i.name)||"Campaign",item_variant:h.product_variant_name||(null==(r=null==(n=h.product)?void 0:n.variant)?void 0:r.name),item_brand:h.product_name||(null==(s=h.product)?void 0:s.name),item_sku:h.product_sku||(null==(o=null==(a=h.product)?void 0:a.variant)?void 0:o.sku)},h.image&&{item_image:h.image}),p&&{item_list_id:p.listId,item_list_name:p.listName}),m=Kc.formatEcommerceEvent("dl_add_to_cart",{currency:f.currency,value:f.price*l,items:[f]});t.willRedirect&&(m.Tt=!0),Kc.push(m),fl.debug("Tracked add to cart:",c)});this.eventBus.on("cart:item-added",t),this.eventHandlers.set("cart:item-added",t);const e=t=>g(this,null,function*(){var e,i,n,r,s,a,o;if(!this.shouldProcessEvent("cart:item-removed"))return;const c=t.packageId,l=t.quantity||1,d=dt.getState(),h=d.getPackage(c);if(!h)return void fl.warn("Package not found for remove from cart:",c);const p=u({item_id:h.external_id.toString(),item_name:h.name||`Package ${c}`,currency:(null==(e=d.data)?void 0:e.currency)||"USD",price:parseFloat(h.price_total||"0"),quantity:1,item_category:(null==(i=d.data)?void 0:i.name)||"Campaign",item_variant:h.product_variant_name||(null==(r=null==(n=h.product)?void 0:n.variant)?void 0:r.name),item_brand:h.product_name||(null==(s=h.product)?void 0:s.name),item_sku:h.product_sku||(null==(o=null==(a=h.product)?void 0:a.variant)?void 0:o.sku)},h.image&&{item_image:h.image}),f=Kc.formatEcommerceEvent("dl_remove_from_cart",{currency:p.currency,value:p.price*l,items:[p]});Kc.push(f),fl.debug("Tracked remove from cart:",c)});this.eventBus.on("cart:item-removed",e),this.eventHandlers.set("cart:item-removed",e);const i=t=>g(this,null,function*(){var e,i,n,r,s,a,o,c,l,d,h,p,f,m,g;const{previousPackageId:v,newPackageId:y,priceDifference:b}=t,x=dt.getState(),w=x.getPackage(v),_=x.getPackage(y);if(!w||!_)return void fl.warn("Package data not found for swap:",{previousPackageId:v,newPackageId:y});const k=u({item_id:w.external_id.toString(),item_name:w.name||`Package ${v}`,currency:(null==(e=x.data)?void 0:e.currency)||"USD",price:parseFloat(w.price_total||"0"),quantity:1,item_category:(null==(i=x.data)?void 0:i.name)||"Campaign",item_variant:w.product_variant_name||(null==(r=null==(n=w.product)?void 0:n.variant)?void 0:r.name),item_brand:w.product_name||(null==(s=w.product)?void 0:s.name),item_sku:w.product_sku||(null==(o=null==(a=w.product)?void 0:a.variant)?void 0:o.sku)||void 0},w.image&&{item_image:w.image}),S=u({item_id:_.external_id.toString(),item_name:_.name||`Package ${y}`,currency:(null==(c=x.data)?void 0:c.currency)||"USD",price:parseFloat(_.price_total||"0"),quantity:1,item_category:(null==(l=x.data)?void 0:l.name)||"Campaign",item_variant:_.product_variant_name||(null==(h=null==(d=_.product)?void 0:d.variant)?void 0:h.name),item_brand:_.product_name||(null==(p=_.product)?void 0:p.name),item_sku:_.product_sku||(null==(m=null==(f=_.product)?void 0:f.variant)?void 0:m.sku)||void 0},_.image&&{item_image:_.image}),P={event:"dl_package_swapped",event_category:"ecommerce",event_action:"swap",event_label:`${k.item_name} â†’ ${S.item_name}`,ecommerce:{currency:(null==(g=x.data)?void 0:g.currency)||"USD",value_change:b,items_removed:[k],items_added:[S]},swap_details:{previous_package_id:v,new_package_id:y,price_difference:b}};Kc.push(P),fl.debug("Tracked package swap:",{previousPackageId:v,newPackageId:y,priceDifference:b})});this.eventBus.on("cart:package-swapped",i),this.eventHandlers.set("cart:package-swapped",i);const n=()=>g(this,null,function*(){this.shouldProcessEvent("cart:updated")&&Kc.push({event:"dl_cart_updated",cart:this.getCartData()})});this.eventBus.on("cart:updated",n),this.eventHandlers.set("cart:updated",n)}setupUpsellEventListeners(){const t=t=>g(null,null,function*(){var e,i;const n=t.orderId,r=t.pagePath;if(!t.packageId)return Kc.push({event:"dl_viewed_upsell",order_id:n,page_path:r,upsell:{package_id:"page_view",package_name:"Upsell Page View",currency:(null==(e=dt.getState().data)?void 0:e.currency)||"USD"}}),void fl.info("Tracked upsell page view:",r);const s=t.packageId,a=dt.getState(),o=a.getPackage(s);o?(Kc.push({event:"dl_viewed_upsell",order_id:n,upsell:{package_id:s.toString(),package_name:o.name||`Package ${s}`,price:parseFloat(o.price||"0"),currency:(null==(i=a.data)?void 0:i.currency)||"USD"}}),fl.info("Tracked upsell view:",s)):fl.warn("Package not found for upsell view:",s)});this.eventBus.on("upsell:viewed",t),this.eventHandlers.set("upsell:viewed",t);const e=t=>g(this,null,function*(){var e;const i=t.packageId,n=t.quantity||1,r=t.orderId||(null==(e=t.order)?void 0:e.ref_id);let s=t.value;if(void 0===s){const t=dt.getState().getPackage(i);(null==t?void 0:t.price)&&(s=parseFloat(t.price)*n)}const a={event:"dl_accepted_upsell",order_id:r,upsell:{package_id:i.toString(),package_name:t.packageName||`Package ${i}`,quantity:n,value:s||0,currency:t.currency||"USD"}};fl.debug("Upsell accepted event data:",{willRedirect:t.willRedirect,data:t}),t.willRedirect&&(a.Tt=!0,fl.debug("Marked upsell event for queueing due to redirect")),Kc.push(a),fl.info("Tracked upsell accepted:",i)});this.eventBus.on("upsell:accepted",e),this.eventBus.on("upsell:added",e),this.eventHandlers.set("upsell:accepted",e),this.eventHandlers.set("upsell:added",e);const i=t=>g(this,null,function*(){var e;Kc.push({event:"dl_skipped_upsell",order_id:t.orderId,upsell:{package_id:(null==(e=t.packageId)?void 0:e.toString())||"unknown",package_name:t.packageName||"Unknown Package"}}),fl.info("Tracked upsell skipped:",t.packageId)});this.eventBus.on("upsell:skipped",i),this.eventHandlers.set("upsell:skipped",i)}setupCheckoutEventListeners(){const t=t=>g(null,null,function*(){var e;const i=Tt.getState(),n=dt.getState(),r=i.items.map((t,e)=>{var i,r,s,a,o,c,l,d;const p=n.getPackage(t.packageId);return h(u({item_id:(null==(i=null==p?void 0:p.external_id)?void 0:i.toString())||t.packageId.toString(),item_name:(null==p?void 0:p.name)||`Package ${t.packageId}`,currency:(null==(r=n.data)?void 0:r.currency)||"USD",price:parseFloat((null==p?void 0:p.price_total)||"0"),quantity:t.quantity,item_category:(null==(s=n.data)?void 0:s.name)||"uncategorized",item_variant:(null==p?void 0:p.product_variant_name)||(null==(o=null==(a=null==p?void 0:p.product)?void 0:a.variant)?void 0:o.name),item_brand:(null==p?void 0:p.product_name)||(null==(c=null==p?void 0:p.product)?void 0:c.name),item_sku:(null==p?void 0:p.product_sku)||(null==(d=null==(l=null==p?void 0:p.product)?void 0:l.variant)?void 0:d.sku)},(null==p?void 0:p.image)&&{item_image:p.image}),{index:e})}),s=Kc.formatEcommerceEvent("dl_begin_checkout",{currency:(null==(e=n.data)?void 0:e.currency)||"USD",value:i.total||i.subtotal||0,items:r,coupon:t.coupon});Kc.push(s),fl.info("Tracked checkout started")});this.eventBus.on("checkout:started",t),this.eventHandlers.set("checkout:started",t);const e=t=>g(this,null,function*(){var e,i,n;const r=Tt.getState(),s=dt.getState(),a=r.items.map((t,e)=>{var i,n,r;const a=s.getPackage(t.packageId);return h(u({item_id:(null==(i=null==a?void 0:a.external_id)?void 0:i.toString())||t.packageId.toString(),item_name:(null==a?void 0:a.name)||`Package ${t.packageId}`,currency:(null==(n=s.data)?void 0:n.currency)||"USD",price:parseFloat((null==a?void 0:a.price_total)||"0"),quantity:t.quantity,item_category:(null==(r=s.data)?void 0:r.name)||"uncategorized"},(null==a?void 0:a.image)&&{item_image:a.image}),{item_variant:void 0,index:e})}),o=Kc.formatEcommerceEvent("dl_begin_checkout",{currency:(null==(e=s.data)?void 0:e.currency)||"USD",value:r.total||r.subtotal||0,items:a,coupon:null==(n=null==(i=r.appliedCoupons)?void 0:i[0])?void 0:n.code,payment_type:t.method||"express"});Kc.push(o),fl.info("Tracked express checkout started",{method:t.method})});this.eventBus.on("express-checkout:started",e),this.eventHandlers.set("express-checkout:started",e);const i=t=>g(this,null,function*(){var e,i;const n=t.ref_id||t.number||t.order_id||t.transaction_id,r=parseFloat(t.total_incl_tax||t.total||"0");let s=[];if(t.lines&&Array.isArray(t.lines)){const e=dt.getState();s=t.lines.map((i,n)=>{var r,s,a;return{item_id:i.product_sku||(null==(r=i.id)?void 0:r.toString())||`line_${n}`,item_name:i.product_title||i.product_description||`Item ${i.id}`,currency:t.currency||"USD",price:parseFloat(i.price_incl_tax||i.price||"0"),quantity:parseInt((null==(s=i.quantity)?void 0:s.toString())||"1"),item_category:(null==(a=e.data)?void 0:a.name)||"uncategorized",item_variant:i.variant_title,discount:parseFloat(i.price_incl_tax_excl_discounts||"0")-parseFloat(i.price_incl_tax||"0"),index:n}})}else{const t=Tt.getState(),e=dt.getState();s=t.items.map((t,i)=>{var n,r,s;const a=e.getPackage(t.packageId);return h(u({item_id:(null==(n=null==a?void 0:a.external_id)?void 0:n.toString())||t.packageId.toString(),item_name:(null==a?void 0:a.name)||`Package ${t.packageId}`,currency:(null==(r=e.data)?void 0:r.currency)||"USD",price:parseFloat((null==a?void 0:a.price_total)||"0"),quantity:t.quantity,item_category:(null==(s=e.data)?void 0:s.name)||"uncategorized"},(null==a?void 0:a.image)&&{item_image:a.image}),{index:i})})}const a={transaction_id:n,order_number:t.number,currency:t.currency||"USD",value:r||0,items:s,coupon:(null==(i=null==(e=t.discounts)?void 0:e[0])?void 0:i.code)||t.coupon_code||t.coupon,shipping:parseFloat(t.shipping_incl_tax||t.shipping||"0"),tax:parseFloat(t.total_tax||t.tax||"0")},o=Kc.formatEcommerceEvent("dl_purchase",a);o.Tt=!0,fl.debug("Marked purchase event for queueing with _willRedirect = true"),Kc.push(o),fl.info("Tracked purchase:",n)});this.eventBus.on("order:completed",i),this.eventHandlers.set("order:completed",i)}setupPageEventListeners(){const t=t=>g(null,null,function*(){Kc.push({event:"dl_page_view",page:{title:t.title||document.title,url:t.url||window.location.href,path:t.path||window.location.pathname,referrer:document.referrer}})});this.eventBus.on("page:viewed",t),this.eventHandlers.set("page:viewed",t);const e=t=>g(this,null,function*(){Kc.push({event:"dl_route_changed",route:{from:t.from,to:t.to,path:t.path||window.location.pathname}})});this.eventBus.on("route:changed",e),this.eventHandlers.set("route:changed",e)}getCartData(){var t;try{const e=Tt.getState(),i=dt.getState();return{total_value:e.total||e.subtotal||0,total_items:e.totalQuantity||0,currency:(null==(t=i.data)?void 0:t.currency)||"USD",items:e.items.map(t=>{var e;return{package_id:t.packageId,quantity:t.quantity,price:(null==(e=i.getPackage(t.packageId))?void 0:e.price)||0}})}}catch(e){return fl.error("Error getting cart data:",e),null}}reset(){this.lastEventTimes.clear(),fl.debug("AutoEventListener reset")}destroy(){this.eventHandlers.forEach((t,e)=>{this.eventBus.off(e,t)}),this.eventHandlers.clear(),this.lastEventTimes.clear(),this.isInitialized=!1,fl.debug("AutoEventListener destroyed")}getStatus(){return{initialized:this.isInitialized,listenersCount:this.eventHandlers.size,debounceConfig:u({},this.debounceConfig)}}setDebounceConfig(t){Object.assign(this.debounceConfig,t),fl.debug("Updated debounce config:",this.debounceConfig)}}ml.getInstance();const gl={visitor_type:{type:"string"},customer_id:{type:"string"},customer_email:{type:"string"},customer_phone:{type:"string"},customer_first_name:{type:"string"},customer_last_name:{type:"string"},customer_address_city:{type:"string"},customer_address_province:{type:"string"},customer_address_province_code:{type:"string"},customer_address_country:{type:"string"},customer_address_country_code:{type:"string"},customer_address_zip:{type:"string"},customer_order_count:{type:"number"},customer_total_spent:{type:"number"},customer_tags:{type:"string"}},vl={item_id:{type:"string",required:!0},item_name:{type:"string",required:!0},affiliation:{type:"string"},coupon:{type:"string"},currency:{type:"string"},discount:{type:"number"},index:{type:"number"},item_brand:{type:"string"},item_category:{type:"string"},item_category2:{type:"string"},item_category3:{type:"string"},item_category4:{type:"string"},item_category5:{type:"string"},item_list_id:{type:"string"},item_list_name:{type:"string"},item_variant:{type:"string"},item_image:{type:"string"},location_id:{type:"string"},price:{type:"number"},quantity:{type:"number"}},yl={currency:{type:"string"},value:{type:"number"},coupon:{type:"string"},items:{type:"array",items:{type:"object",properties:vl}}},bl={currency:{type:"string"},value:{type:"number"},impressions:{type:"array",items:{type:"object",properties:vl}}},xl={dl_user_data:{name:"dl_user_data",fields:{event:{type:"string",required:!0},user_properties:{type:"object",required:!0,properties:gl}}},dl_sign_up:{name:"dl_sign_up",fields:{event:{type:"string",required:!0},user_properties:{type:"object",properties:gl},method:{type:"string"}}},dl_login:{name:"dl_login",fields:{event:{type:"string",required:!0},user_properties:{type:"object",properties:gl},method:{type:"string"}}},dl_view_item_list:{name:"dl_view_item_list",fields:{event:{type:"string",required:!0},ecommerce:{type:"object",required:!0,properties:h(u({},bl),{item_list_id:{type:"string"},item_list_name:{type:"string"}})},user_properties:{type:"object",properties:gl}}},dl_view_search_results:{name:"dl_view_search_results",fields:{event:{type:"string",required:!0},search_term:{type:"string",required:!0},ecommerce:{type:"object",properties:bl},user_properties:{type:"object",properties:gl}}},dl_select_item:{name:"dl_select_item",fields:{event:{type:"string",required:!0},ecommerce:{type:"object",required:!0,properties:h(u({},yl),{item_list_id:{type:"string"},item_list_name:{type:"string"}})},user_properties:{type:"object",properties:gl}}},dl_view_item:{name:"dl_view_item",fields:{event:{type:"string",required:!0},ecommerce:{type:"object",required:!0,properties:yl},user_properties:{type:"object",properties:gl}}},dl_add_to_cart:{name:"dl_add_to_cart",fields:{event:{type:"string",required:!0},ecommerce:{type:"object",required:!0,properties:yl},user_properties:{type:"object",properties:gl}}},dl_remove_from_cart:{name:"dl_remove_from_cart",fields:{event:{type:"string",required:!0},ecommerce:{type:"object",required:!0,properties:yl},user_properties:{type:"object",properties:gl}}},dl_view_cart:{name:"dl_view_cart",fields:{event:{type:"string",required:!0},ecommerce:{type:"object",required:!0,properties:yl},user_properties:{type:"object",properties:gl}}},dl_begin_checkout:{name:"dl_begin_checkout",fields:{event:{type:"string",required:!0},ecommerce:{type:"object",required:!0,properties:h(u({},yl),{checkout_id:{type:"string"},checkout_step:{type:"number"}})},user_properties:{type:"object",properties:gl}}},dl_add_shipping_info:{name:"dl_add_shipping_info",fields:{event:{type:"string",required:!0},ecommerce:{type:"object",required:!0,properties:h(u({},yl),{shipping_tier:{type:"string"}})},shipping_tier:{type:"string"},user_properties:{type:"object",properties:gl}}},dl_add_payment_info:{name:"dl_add_payment_info",fields:{event:{type:"string",required:!0},ecommerce:{type:"object",required:!0,properties:h(u({},yl),{payment_type:{type:"string"}})},payment_type:{type:"string"},user_properties:{type:"object",properties:gl}}},dl_purchase:{name:"dl_purchase",fields:{event:{type:"string",required:!0},ecommerce:{type:"object",required:!0,properties:h(u({},yl),{transaction_id:{type:"string",required:!0},affiliation:{type:"string"},tax:{type:"number"},shipping:{type:"number"},discount:{type:"number"}})},user_properties:{type:"object",properties:gl}}},dl_subscribe:{name:"dl_subscribe",fields:{event:{type:"string",required:!0},ecommerce:{type:"object",properties:h(u({},yl),{subscription_id:{type:"string"},subscription_status:{type:"string"}})},user_properties:{type:"object",properties:gl}}},dl_viewed_upsell:{name:"dl_viewed_upsell",fields:{event:{type:"string",required:!0},order_id:{type:"string",required:!0},upsell:{type:"object",required:!0,properties:{package_id:{type:"string",required:!0},package_name:{type:"string",required:!0},price:{type:"number"},currency:{type:"string"}}}}},dl_accepted_upsell:{name:"dl_accepted_upsell",fields:{event:{type:"string",required:!0},order_id:{type:"string",required:!0},upsell:{type:"object",required:!0,properties:{package_id:{type:"string",required:!0},package_name:{type:"string"},quantity:{type:"number"},value:{type:"number",required:!0},currency:{type:"string"}}}}},dl_skipped_upsell:{name:"dl_skipped_upsell",fields:{event:{type:"string",required:!0},order_id:{type:"string",required:!0},upsell:{type:"object",required:!0,properties:{package_id:{type:"string"},package_name:{type:"string"}}}}}};function wl(t){return xl[t]}class _l{constructor(t=!1){this.debug=t}validateEvent(t){const e={valid:!0,errors:[],warnings:[]};if(!t||"object"!=typeof t)return e.valid=!1,e.errors.push("Event data must be an object"),e;if(!t.event)return e.valid=!1,e.errors.push('Event must have an "event" field'),e;const i=wl(t.event);if(!i)return e.warnings.push(`No schema defined for event: ${t.event}`),e;const n=function(t,e){const i=[];function n(t,e,r){if(e.required&&null==t)return void i.push(`Missing required field: ${r}`);if(null==t)return;const s=Array.isArray(t)?"array":typeof t;if(s===e.type){if(e.enum&&!e.enum.includes(t)&&i.push(`Invalid value for ${r}: must be one of ${e.enum.join(", ")}`),"object"===e.type&&e.properties)for(const[i,s]of Object.entries(e.properties))n(t[i],s,`${r}.${i}`);"array"===e.type&&e.items&&t.forEach((t,i)=>{n(t,e.items,`${r}[${i}]`)})}else i.push(`Invalid type for ${r}: expected ${e.type}, got ${s}`)}for(const[r,s]of Object.entries(e.fields))n(t[r],s,r);return{valid:0===i.length,errors:i}}(t,i);return e.valid=n.valid,e.errors.push(...n.errors),this.performAdditionalValidation(t,e),this.debug&&e.valid,e}performAdditionalValidation(t,e){var i;switch(t.ecommerce&&(t.ecommerce.currency&&!this.isValidCurrency(t.ecommerce.currency)&&e.warnings.push(`Invalid currency format: ${t.ecommerce.currency}`),void 0!==t.ecommerce.value&&t.ecommerce.value<0&&e.warnings.push("Ecommerce value should not be negative"),t.ecommerce.items&&Array.isArray(t.ecommerce.items)&&t.ecommerce.items.forEach((t,i)=>{this.validateProduct(t,`ecommerce.items[${i}]`,e)}),t.ecommerce.impressions&&Array.isArray(t.ecommerce.impressions)&&t.ecommerce.impressions.forEach((t,i)=>{this.validateProduct(t,`ecommerce.impressions[${i}]`,e)})),t.user_properties&&this.validateUserProperties(t.user_properties,e),t.event){case"dl_purchase":(null==(i=t.ecommerce)?void 0:i.transaction_id)||(e.errors.push("dl_purchase event must have ecommerce.transaction_id"),e.valid=!1);break;case"dl_view_search_results":t.search_term||(e.errors.push("dl_view_search_results event must have search_term"),e.valid=!1);break;case"dl_viewed_upsell":case"dl_accepted_upsell":case"dl_skipped_upsell":this.validateUpsellEvent(t,e)}}validateProduct(t,e,i){if(!t||"object"!=typeof t)return i.errors.push(`${e} must be an object`),void(i.valid=!1);t.item_id||(i.errors.push(`${e}.item_id is required`),i.valid=!1),t.item_name||(i.errors.push(`${e}.item_name is required`),i.valid=!1);const n=["price","quantity","discount","index"];for(const r of n)void 0!==t[r]&&("number"!=typeof t[r]?(i.errors.push(`${e}.${r} must be a number`),i.valid=!1):"discount"!==r&&t[r]<0&&i.warnings.push(`${e}.${r} should not be negative`));void 0===t.quantity||Number.isInteger(t.quantity)||i.warnings.push(`${e}.quantity should be an integer`)}validateUserProperties(t,e){if("object"!=typeof t)return e.errors.push("user_properties must be an object"),void(e.valid=!1);t.customer_email&&!this.isValidEmail(t.customer_email)&&e.warnings.push("customer_email is not a valid email address"),void 0!==t.customer_order_count&&("number"==typeof t.customer_order_count&&Number.isInteger(t.customer_order_count)||e.warnings.push("customer_order_count should be an integer")),void 0!==t.customer_total_spent&&"number"!=typeof t.customer_total_spent&&e.warnings.push("customer_total_spent should be a number"),t.customer_address_country_code&&2!==t.customer_address_country_code.length&&e.warnings.push("customer_address_country_code should be a 2-letter ISO code"),t.customer_address_province_code&&t.customer_address_province_code.length>3&&e.warnings.push("customer_address_province_code seems too long")}isValidCurrency(t){return/^[A-Z]{3}$/.test(t)}isValidEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}validateUpsellEvent(t,e){if(t.order_id||(e.errors.push(`${t.event} must have order_id`),e.valid=!1),!t.upsell||"object"!=typeof t.upsell)return e.errors.push(`${t.event} must have upsell object`),void(e.valid=!1);t.upsell.package_id||(e.errors.push(`${t.event}.upsell.package_id is required`),e.valid=!1),"dl_accepted_upsell"===t.event&&void 0===t.upsell.value&&(e.errors.push("dl_accepted_upsell.upsell.value is required"),e.valid=!1),void 0!==t.upsell.price&&"number"!=typeof t.upsell.price&&(e.errors.push(`${t.event}.upsell.price must be a number`),e.valid=!1),void 0!==t.upsell.quantity&&"number"!=typeof t.upsell.quantity&&(e.errors.push(`${t.event}.upsell.quantity must be a number`),e.valid=!1),void 0!==t.upsell.value&&"number"!=typeof t.upsell.value&&(e.errors.push(`${t.event}.upsell.value must be a number`),e.valid=!1)}getAvailableSchemas(){return Object.keys(xl)}getSchemaDetails(t){return wl(t)}generateSampleEvent(t){const e=wl(t);if(!e)return null;const i={event:t,event_id:"sample_"+Date.now(),timestamp:Date.now()};return this.generateSampleFromSchema(e.fields,i),i}generateSampleFromSchema(t,e){for(const[i,n]of Object.entries(t))if("event"!==i&&(n.required||Math.random()>.5))switch(n.type){case"string":e[i]=n.enum?n.enum[0]:`sample_${i}`;break;case"number":e[i]=i.includes("price")||i.includes("value")?99.99:1;break;case"boolean":e[i]=!0;break;case"object":e[i]={},n.properties&&this.generateSampleFromSchema(n.properties,e[i]);break;case"array":if(e[i]=[],n.items&&"object"===n.items.type&&n.items.properties){const t={};this.generateSampleFromSchema(n.items.properties,t),e[i].push(t)}}}}class kl{static createEvent(t,e={}){return h(u(u({event:t,event_id:this.generateEventId(),event_time:(new Date).toISOString(),user_properties:this.getUserProperties()},this.getEventContext()),e),{It:this.getEventMetadata()})}static generateEventId(){return`${Date.now()}_${Math.random().toString(36).substring(2,9)}`}static getUserProperties(){var t,e;const i={visitor_type:"guest"};try{if("undefined"!=typeof window){const n=window.checkoutStore;if(n){const r=n.getState();if(r.billingAddress){const t=r.billingAddress;i.customer_first_name=t.first_name,i.customer_last_name=t.last_name,i.customer_address_city=t.city,i.customer_address_province=t.province,i.customer_address_province_code=t.province,i.customer_address_zip=t.postal,i.customer_address_country=t.country,i.customer_phone=t.phone}(null==(t=r.formData)?void 0:t.email)&&(i.customer_email=r.formData.email),(null==(e=r.formData)?void 0:e.customerId)&&(i.customer_id=String(r.formData.customerId),i.visitor_type="customer")}}}catch(n){}return i}static getEventContext(){const t={};return"undefined"!=typeof window&&(t.page_location=window.location.href,t.page_title=document.title,t.page_referrer=document.referrer,t.user_agent=navigator.userAgent,t.screen_resolution=`${window.screen.width}x${window.screen.height}`,t.viewport_size=`${window.innerWidth}x${window.innerHeight}`,t.session_id=this.getSessionId(),t.timestamp=Date.now()),t}static getEventMetadata(){return{pushed_at:Date.now(),debug_mode:!1,session_id:this.getSessionId(),sequence_number:this.getNextSequenceNumber(),source:"next-campaign-cart",version:"0.2.0"}}static getSessionId(){if("undefined"!=typeof window){let t=sessionStorage.getItem("analytics_session_id");return t||(t=`session_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,sessionStorage.setItem("analytics_session_id",t)),t}return`session_${Date.now()}`}static getNextSequenceNumber(){if("undefined"!=typeof window){const t=parseInt(sessionStorage.getItem("analytics_sequence")||"0",10)+1;return sessionStorage.setItem("analytics_sequence",String(t)),t}return 0}static getCurrency(){try{if("undefined"!=typeof window){const t=window.campaignStore;if(t){const e=t.getState().data;return(null==e?void 0:e.currency)||"USD"}}}catch(t){}return"USD"}static formatEcommerceItem(t,e,i){var n,r,s,a,o,c,l;const d=this.getCurrency();let u,h="Campaign";try{if("undefined"!=typeof window){const e=window.campaignStore;if(e){const i=e.getState().data;h=(null==i?void 0:i.name)||"Campaign";const n=t.packageId||t.package_id||t.id;if(n&&(null==i?void 0:i.packages)){const t=i.packages.find(t=>t.ref_id===n||t.external_id===n);(null==t?void 0:t.image)&&(u=t.image)}}}}catch(w){}const p=String(t.packageId||t.package_id||t.id),f=(null==(n=t.product)?void 0:n.title)||t.title||t.product_title||t.name||`Package ${p}`;u||(u=t.image||(null==(r=t.product)?void 0:r.image)||t.imageUrl||t.image_url);let m=0;t.price_incl_tax?m="string"==typeof t.price_incl_tax?parseFloat(t.price_incl_tax):t.price_incl_tax:t.price&&(m="object"==typeof t.price&&"incl_tax"in t.price?t.price.incl_tax.value:"string"==typeof t.price?parseFloat(t.price):t.price);const g=t.quantity||1,v={item_id:p,item_name:f,item_category:h,price:"string"==typeof m?parseFloat(m):m,quantity:g,currency:d},y=t.product_variant_name||(null==(a=null==(s=t.product)?void 0:s.variant)?void 0:a.name)||t.package_profile||t.variant;void 0!==y&&(v.item_variant=y);const b=t.product_name||(null==(o=t.product)?void 0:o.name);b&&(v.item_brand=b);const x=t.product_sku||(null==(l=null==(c=t.product)?void 0:c.variant)?void 0:l.sku)||t.sku;return x&&(v.item_sku=x),void 0!==e&&(v.index=e),(null==i?void 0:i.id)&&(v.item_list_id=i.id),(null==i?void 0:i.name)&&(v.item_list_name=i.name),u&&(v.item_image=u),v}static getListAttribution(){if("undefined"!=typeof window){const t=sessionStorage.getItem("analytics_list_id"),e=sessionStorage.getItem("analytics_list_name");if(t||e){const i={};return t&&(i.id=t),e&&(i.name=e),i}}}static setListAttribution(t,e){"undefined"!=typeof window&&(t&&sessionStorage.setItem("analytics_list_id",t),e&&sessionStorage.setItem("analytics_list_name",e))}static clearListAttribution(){"undefined"!=typeof window&&(sessionStorage.removeItem("analytics_list_id"),sessionStorage.removeItem("analytics_list_name"))}}class Sl{static createViewItemListEvent(t,e,i){const n=kl.getCurrency(),r=t.map((t,n)=>kl.formatEcommerceItem(t,n,void 0!==e||void 0!==i?u(u({},void 0!==e&&{id:e}),void 0!==i&&{name:i}):void 0)),s=r.reduce((t,e)=>t+(e.price||0)*(e.quantity||1),0);kl.setListAttribution(e,i);const a={currency:n,value:s,items:r};return kl.createEvent("dl_view_item_list",{ecommerce:a,event_category:"ecommerce",event_label:i||"Product List"})}static createViewItemEvent(t){const e=kl.getCurrency(),i=kl.formatEcommerceItem(t),n={currency:e,value:(i.price||0)*(i.quantity||1),items:[i]};return kl.createEvent("dl_view_item",{ecommerce:n,event_category:"ecommerce",event_label:i.item_name})}static createAddToCartEvent(t,e,i){const n=kl.getCurrency(),r=e||i?u(u({},void 0!==e&&{id:e}),void 0!==i&&{name:i}):kl.getListAttribution(),s=kl.formatEcommerceItem(t,void 0,r),a={currency:n,value:(s.price||0)*(s.quantity||1),items:[s]};return kl.createEvent("dl_add_to_cart",{ecommerce:a,event_category:"ecommerce",event_label:s.item_name,list:(null==r?void 0:r.id)||(null==r?void 0:r.name)?r:void 0})}static createRemoveFromCartEvent(t){const e=kl.getCurrency(),i=kl.formatEcommerceItem(t),n={currency:e,value:(i.price||0)*(i.quantity||1),items:[i]};return kl.createEvent("dl_remove_from_cart",{ecommerce:n,event_category:"ecommerce",event_label:i.item_name})}static createPackageSwappedEvent(t,e,i){const n=kl.getCurrency(),r=kl.formatEcommerceItem(t),s=kl.formatEcommerceItem(e),a={currency:n,value_change:i,items_removed:[r],items_added:[s]};return kl.createEvent("dl_package_swapped",{ecommerce:a,event_category:"ecommerce",event_action:"swap",event_label:`${r.item_name} â†’ ${s.item_name}`,swap_details:{previous_package_id:t.packageId,new_package_id:e.packageId,price_difference:i}})}static createSelectItemEvent(t,e,i){const n=kl.getCurrency(),r=e||i?u(u({},void 0!==e&&{id:e}),void 0!==i&&{name:i}):kl.getListAttribution(),s=kl.formatEcommerceItem(t,void 0,r),a={currency:n,value:(s.price||0)*(s.quantity||1),items:[s]};return kl.createEvent("dl_select_item",{ecommerce:a,event_category:"ecommerce",event_label:s.item_name,list:(null==r?void 0:r.id)||(null==r?void 0:r.name)?r:void 0})}static createBeginCheckoutEvent(){var t,e;const i=Tt.getState(),n=kl.getCurrency(),r=i.enrichedItems.map((t,e)=>kl.formatEcommerceItem(t,e)),s={currency:n,value:i.totals.total.value,items:r};return(null==(e=null==(t=i.appliedCoupons)?void 0:t[0])?void 0:e.code)&&(s.coupon=i.appliedCoupons[0].code),kl.createEvent("dl_begin_checkout",{ecommerce:s,event_category:"ecommerce",event_value:i.totals.total.value})}static createPurchaseEvent(t){var e,i,n,r;const s=Tt.getState(),a=kl.getCurrency(),o=t.order||t,c=o.ref_id||o.number||t.orderId||t.transactionId||`order_${Date.now()}`,l=parseFloat(o.total_incl_tax||o.total||t.total||s.totals.total.value||0),d=parseFloat(o.total_tax||t.tax||s.totals.tax.value||0),u=parseFloat(o.shipping_incl_tax||t.shipping||s.totals.shipping.value||0);let h=[];o.lines&&o.lines.length>0?h=o.lines.map((t,e)=>({item_id:String(t.package||t.product_id||t.id),item_name:t.product_title||t.name||"Unknown Product",item_category:t.campaign_name||"Campaign",item_variant:t.package_profile||t.variant,price:parseFloat(t.price_incl_tax||t.price||0),quantity:t.quantity||1,currency:o.currency||a,index:e})):(t.items||s.enrichedItems.length>0)&&(h=(t.items||s.enrichedItems).map((t,e)=>kl.formatEcommerceItem(t,e)));const p={transaction_id:c,currency:o.currency||a,value:l,items:h,tax:d,shipping:u},f=(null==(i=null==(e=o.vouchers)?void 0:e[0])?void 0:i.code)||t.coupon||(null==(r=null==(n=s.appliedCoupons)?void 0:n[0])?void 0:r.code);return f&&(p.coupon=f),kl.clearListAttribution(),kl.createEvent("dl_purchase",{ecommerce:p,event_category:"ecommerce",event_value:l})}static createViewCartEvent(){var t,e;const i=Tt.getState(),n=kl.getCurrency(),r=i.enrichedItems.map((t,e)=>kl.formatEcommerceItem(t,e,{id:"cart",name:"Shopping Cart"})),s={currency:n,value:i.totals.total.value,items:r};return(null==(e=null==(t=i.appliedCoupons)?void 0:t[0])?void 0:e.code)&&(s.coupon=i.appliedCoupons[0].code),kl.createEvent("dl_view_cart",{ecommerce:s,event_category:"ecommerce",event_value:i.totals.total.value})}static createAddShippingInfoEvent(t){var e,i;const n=Tt.getState(),r=kl.getCurrency(),s=n.enrichedItems.map((t,e)=>kl.formatEcommerceItem(t,e)),a=u({currency:r,value:n.totals.total.value,items:s},t&&{shipping_tier:t});return(null==(i=null==(e=n.appliedCoupons)?void 0:e[0])?void 0:i.code)&&(a.coupon=n.appliedCoupons[0].code),kl.createEvent("dl_add_shipping_info",{ecommerce:a,event_category:"ecommerce",event_value:n.totals.total.value,shipping_tier:t})}static createAddPaymentInfoEvent(t){var e,i;const n=Tt.getState(),r=kl.getCurrency(),s=n.enrichedItems.map((t,e)=>kl.formatEcommerceItem(t,e)),a=u({currency:r,value:n.totals.total.value,items:s},t&&{payment_type:t});return(null==(i=null==(e=n.appliedCoupons)?void 0:e[0])?void 0:i.code)&&(a.coupon=n.appliedCoupons[0].code),kl.createEvent("dl_add_payment_info",{ecommerce:a,event_category:"ecommerce",event_value:n.totals.total.value,payment_type:t})}}class Pl{static createUserDataEvent(t,e,i){const n=u(u({},kl.getUserProperties()),e);return kl.createEvent(t,u({user_properties:n,event_category:"user"},i))}static createSignUpEvent(t="email",e){return this.createUserDataEvent("sign_up",e,{event_label:t,custom_properties:{method:t,timestamp:(new Date).toISOString()}})}static createLoginEvent(t="email",e){const i=h(u({},e),{visitor_type:(null==e?void 0:e.customer_id)?"returning_customer":"guest"});return this.createUserDataEvent("login",i,{event_label:t,custom_properties:{method:t,timestamp:(new Date).toISOString()}})}static createSubscribeEvent(t="email",e,i){return this.createUserDataEvent("subscribe",i,{event_label:t,custom_properties:{channel:t,subscription_details:e,timestamp:(new Date).toISOString()}})}static createProfileUpdateEvent(t,e){return this.createUserDataEvent("profile_update",e,{event_label:`Updated: ${t.join(", ")}`,custom_properties:{updated_fields:t,timestamp:(new Date).toISOString()}})}static createEmailVerificationEvent(t,e){return this.createUserDataEvent("email_verification",e,{event_label:t,custom_properties:{verification_status:t,timestamp:(new Date).toISOString()}})}static createAccountDeletionEvent(t,e){return this.createUserDataEvent("account_deletion",e,{event_label:t||"user_initiated",custom_properties:{deletion_reason:t,timestamp:(new Date).toISOString()}})}static createPasswordResetEvent(t,e){return this.createUserDataEvent("password_reset",e,{event_label:t,custom_properties:{reset_step:t,timestamp:(new Date).toISOString()}})}static createConsentEvent(t,e,i){return this.createUserDataEvent("user_consent",i,{event_label:`${t}_${e?"granted":"denied"}`,custom_properties:{consent_type:t,consent_granted:e,timestamp:(new Date).toISOString()}})}}const Cl=tt("NextAnalytics");class El{constructor(){this.initialized=!1,this.providers=new Map,this.validator=new _l,this.listTracker=sl.getInstance(),this.viewTracker=cl.getInstance(),this.userTracker=pl.getInstance(),this.autoListener=ml.getInstance(),"undefined"!=typeof window&&(window.NextDataLayerTransformFn=null,this.checkAndSetIgnoreFlag())}static getInstance(){return El.instance||(El.instance=new El),El.instance}checkAndSetIgnoreFlag(){if("undefined"!=typeof window)try{"true"===new URLSearchParams(window.location.search).get("ignore")&&(sessionStorage.setItem("analytics_ignore","true"),Cl.info("Analytics ignore flag set from URL parameter"))}catch(t){Cl.error("Error checking ignore parameter:",t)}}shouldIgnoreAnalytics(){if("undefined"==typeof window)return!1;try{if("true"===sessionStorage.getItem("analytics_ignore"))return!0;return"true"===new URLSearchParams(window.location.search).get("ignore")}catch(t){return Cl.error("Error checking ignore status:",t),!1}}initialize(){return g(this,null,function*(){var t;if(this.initialized)Cl.debug("Analytics already initialized");else if(this.shouldIgnoreAnalytics())Cl.info("Analytics ignored due to ignore parameter");else try{const e=yt.getState();if(!(null==(t=e.analytics)?void 0:t.enabled))return void Cl.info("Analytics disabled in configuration");Kc.initialize(),e.analytics.debug&&Kc.setDebugMode(!0),yield this.initializeProviders(e.analytics,e.storeName),Bc.getInstance().processPendingEvents(),"auto"===e.analytics.mode&&this.initializeAutoTracking(),this.initialized=!0,Cl.info("NextAnalytics initialized successfully",{providers:Array.from(this.providers.keys()),mode:e.analytics.mode})}catch(e){throw Cl.error("Failed to initialize analytics:",e),e}})}initializeProviders(t,e){return g(this,null,function*(){var i,n,r,s,a,o,c,l,d,p,f,m;if(null==(n=null==(i=t.providers)?void 0:i.nextCampaign)?void 0:n.enabled){const t=new tl;yield t.initialize(),this.providers.set("nextCampaign",t),Kc.addProvider(t),Cl.info("NextCampaign adapter initialized")}if(null==(s=null==(r=t.providers)?void 0:r.gtm)?void 0:s.enabled){const t=new Zc;this.providers.set("gtm",t),Kc.addProvider(t),Cl.info("GTM adapter initialized")}if((null==(o=null==(a=t.providers)?void 0:a.facebook)?void 0:o.enabled)&&(null==(c=t.providers.facebook.settings)?void 0:c.pixelId)){const i=h(u({},t.providers.facebook),{storeName:e}),n=new Wc(i);this.providers.set("facebook",n),Kc.addProvider(n),Cl.info("Facebook Pixel adapter initialized",{blockedEvents:t.providers.facebook.blockedEvents||[],storeName:e})}if(null==(d=null==(l=t.providers)?void 0:l.rudderstack)?void 0:d.enabled){const t=new Xc;this.providers.set("rudderstack",t),Kc.addProvider(t),Cl.info("RudderStack adapter initialized")}if((null==(f=null==(p=t.providers)?void 0:p.custom)?void 0:f.enabled)&&(null==(m=t.providers.custom.settings)?void 0:m.endpoint)){const e=new el(t.providers.custom.settings);this.providers.set("custom",e),Kc.addProvider(e),Cl.info("Custom adapter initialized")}})}initializeAutoTracking(){this.listTracker.initialize(),this.viewTracker.initialize(),this.userTracker.initialize(),this.autoListener.initialize(),Cl.info("Auto-tracking initialized")}track(t){if(this.shouldIgnoreAnalytics())Cl.debug("Event tracking skipped due to ignore flag:",t.event);else{if(this.initialized||Cl.warn("Analytics not initialized, queuing event:",t.event),Kc.isDebugMode()){const e=this.validator.validateEvent(t);e.valid||(Cl.error("Event validation failed:",e.errors),e.warnings.length>0&&Cl.warn("Event validation warnings:",e.warnings))}Kc.push(t)}}setDebugMode(t){Kc.setDebugMode(t),Cl.info("Debug mode "+(t?"enabled":"disabled"))}setTransformFunction(t){Kc.setTransformFunction(t)}invalidateContext(){Kc.invalidateContext(),this.viewTracker.reset(),this.track(Pl.createUserDataEvent("dl_user_data"))}getStatus(){return{initialized:this.initialized,debugMode:Kc.isDebugMode(),providers:Array.from(this.providers.keys()),eventsTracked:Kc.getEventCount(),ignored:this.shouldIgnoreAnalytics()}}clearIgnoreFlag(){if("undefined"!=typeof window)try{sessionStorage.removeItem("analytics_ignore"),Cl.info("Analytics ignore flag cleared")}catch(t){Cl.error("Error clearing ignore flag:",t)}}trackViewItemList(t,e,i){this.track(Sl.createViewItemListEvent(t,e,i))}trackViewItem(t){this.track(Sl.createViewItemEvent(t))}trackAddToCart(t,e,i){this.track(Sl.createAddToCartEvent(t,e,i))}trackBeginCheckout(){this.track(Sl.createBeginCheckoutEvent())}trackPurchase(t){this.track(Sl.createPurchaseEvent(t))}trackSignUp(t){const e=t?{customer_email:t}:void 0;this.track(Pl.createSignUpEvent("email",e))}trackLogin(t){const e=t?{customer_email:t}:void 0;this.track(Pl.createLoginEvent("email",e))}}const $l=El.getInstance();"undefined"!=typeof window&&(window.NextAnalytics=$l,window.NextDataLayerManager=Kc,window.NextInvalidateContext=()=>{$l.invalidateContext()},window.NextAnalyticsClearIgnore=()=>{$l.clearIgnoreFlag()});const Tl=Object.freeze(Object.defineProperty({__proto__:null,EcommerceEvents:Sl,EventValidator:_l,NextAnalytics:El,UserEvents:Pl,dataLayer:Kc,nextAnalytics:$l},Symbol.toStringTag,{value:"Module"})),Il=Object.freeze(Object.defineProperty({__proto__:null,ExitIntentEnhancer:class extends be{constructor(){super(document.body),this.isEnabled=!1,this.triggerCount=0,this.lastTriggerTime=0,this.maxTriggers=1,this.cooldownPeriod=3e4,this.imageUrl="",this.templateName="",this.templateElement=null,this.action=null,this.popupElement=null,this.overlayElement=null,this.mouseLeaveHandler=null,this.scrollHandler=null,this.disableOnMobile=!0,this.mobileScrollTrigger=!1,this.sessionStorageKey="exit-intent-dismissed",this.useSessionStorage=!0,this.overlayClosable=!0,this.showCloseButton=!1,this.imageClickable=!0,this.actionButtonText=""}initialize(){return g(this,null,function*(){if("loading"===document.readyState&&(yield new Promise(t=>{document.addEventListener("DOMContentLoaded",()=>t())})),this.useSessionStorage&&"undefined"!=typeof window&&window.sessionStorage)try{const t=sessionStorage.getItem(this.sessionStorageKey);if(t){const e=JSON.parse(t);this.triggerCount=e.triggerCount||0,this.lastTriggerTime=e.lastTriggerTime||0}}catch(t){this.logger.debug("Failed to load session storage data:",t)}})}update(t){return g(this,null,function*(){t&&"object"==typeof t&&t.image&&this.setup(t)})}setup(t){t.image||t.template?(this.imageUrl=t.image||"",this.templateName=t.template||"",this.action=t.action||null,this.disableOnMobile=void 0===t.disableOnMobile||t.disableOnMobile,this.mobileScrollTrigger=t.mobileScrollTrigger||!1,this.maxTriggers=void 0!==t.maxTriggers?t.maxTriggers:1,this.useSessionStorage=void 0===t.useSessionStorage||t.useSessionStorage,this.overlayClosable=void 0===t.overlayClosable||t.overlayClosable,this.showCloseButton=t.showCloseButton||!1,this.imageClickable=void 0===t.imageClickable||t.imageClickable,this.actionButtonText=t.actionButtonText||"",t.sessionStorageKey&&(this.sessionStorageKey=t.sessionStorageKey),!this.templateName||(this.templateElement=document.querySelector(`template[data-template="${this.templateName}"]`),this.templateElement)?this.disableOnMobile&&this.isMobileDevice()?this.logger.debug("Exit intent disabled on mobile device"):(this.isEnabled=!0,this.setupEventListeners(),this.logger.debug("Simple exit intent setup complete")):this.logger.error(`Exit intent template not found: <template data-template="${this.templateName}">`)):this.logger.error("Exit intent requires either an image URL or a template name")}disable(){this.isEnabled=!1,this.cleanupEventListeners(),this.hidePopup()}reset(){if(this.triggerCount=0,this.lastTriggerTime=0,this.useSessionStorage&&"undefined"!=typeof window&&window.sessionStorage)try{sessionStorage.removeItem(this.sessionStorageKey)}catch(t){this.logger.debug("Failed to clear session storage:",t)}}setupEventListeners(){this.isMobileDevice()||(this.mouseLeaveHandler=t=>{this.shouldTrigger()&&t.clientY<=10&&this.triggerExitIntent()},document.addEventListener("mouseleave",this.mouseLeaveHandler)),this.isMobileDevice()&&this.mobileScrollTrigger&&(this.scrollHandler=()=>{this.shouldTrigger()&&window.scrollY/(document.body.scrollHeight-window.innerHeight)*100>=50&&this.triggerExitIntent()},window.addEventListener("scroll",this.scrollHandler,{passive:!0}))}isMobileDevice(){const t="ontouchstart"in window||navigator.maxTouchPoints>0,e=window.innerWidth<768,i=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return t&&(e||i)}shouldTrigger(){return!(!this.isEnabled||this.popupElement||this.triggerCount>=this.maxTriggers||Date.now()-this.lastTriggerTime<this.cooldownPeriod||this.disableOnMobile&&this.isMobileDevice())}triggerExitIntent(){this.triggerCount++,this.lastTriggerTime=Date.now(),this.saveToSessionStorage(),this.showPopup()}saveToSessionStorage(){if(this.useSessionStorage&&"undefined"!=typeof window&&window.sessionStorage)try{const t={triggerCount:this.triggerCount,lastTriggerTime:this.lastTriggerTime,timestamp:Date.now()};sessionStorage.setItem(this.sessionStorageKey,JSON.stringify(t))}catch(t){this.logger.debug("Failed to save to session storage:",t)}}showPopup(){this.templateElement?this.createTemplatePopup():this.createImagePopup(),this.emit("exit-intent:shown",{imageUrl:this.imageUrl,template:this.templateName})}createTemplatePopup(){if(this.overlayElement=document.createElement("div"),this.overlayElement.className="exit-intent-overlay",this.overlayElement.setAttribute("data-exit-intent","overlay"),this.overlayElement.style.cssText=`\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background-color: rgba(0, 0, 0, 0.7);\n      z-index: 999999;\n      cursor: ${this.overlayClosable?"pointer":"default"};\n    `,this.popupElement=document.createElement("div"),this.popupElement.className="exit-intent-popup exit-intent-template-popup",this.popupElement.setAttribute("data-exit-intent","popup"),this.popupElement.style.cssText="\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      z-index: 1000000;\n      max-width: 90vw;\n      max-height: 90vh;\n      overflow: auto;\n    ",this.templateElement){const t=this.templateElement.content.cloneNode(!0);this.popupElement.appendChild(t),this.processTemplateActions(this.popupElement)}if(this.showCloseButton){const t=document.createElement("button");t.className="exit-intent-close",t.setAttribute("data-exit-intent","close"),t.innerHTML="&times;",t.style.cssText="\n        position: absolute;\n        top: 10px;\n        right: 10px;\n        background: transparent;\n        border: none;\n        font-size: 30px;\n        cursor: pointer;\n        z-index: 1000001;\n        color: #666;\n        padding: 0;\n        width: 30px;\n        height: 30px;\n        line-height: 1;\n      ",t.addEventListener("click",t=>{t.stopPropagation(),this.hidePopup(),this.emit("exit-intent:closed",{imageUrl:this.imageUrl,template:this.templateName})}),this.popupElement.appendChild(t)}this.overlayClosable&&this.overlayElement.addEventListener("click",()=>{this.hidePopup(),this.emit("exit-intent:dismissed",{imageUrl:this.imageUrl,template:this.templateName}),this.saveToSessionStorage()}),this.popupElement.addEventListener("click",t=>{t.stopPropagation()});const t=e=>{"Escape"===e.key&&(this.hidePopup(),this.emit("exit-intent:dismissed",{imageUrl:this.imageUrl,template:this.templateName}),this.saveToSessionStorage(),document.removeEventListener("keydown",t))};document.addEventListener("keydown",t),document.body.appendChild(this.overlayElement),document.body.appendChild(this.popupElement),requestAnimationFrame(()=>{this.overlayElement&&(this.overlayElement.style.opacity="1"),this.popupElement&&(this.popupElement.style.opacity="0",this.popupElement.style.transform="translate(-50%, -50%) scale(0.8)",this.popupElement.style.transition="all 0.3s ease",requestAnimationFrame(()=>{this.popupElement&&(this.popupElement.style.opacity="1",this.popupElement.style.transform="translate(-50%, -50%) scale(1)")}))})}processTemplateActions(t){t.querySelectorAll("[data-exit-intent-action]").forEach(t=>{switch(t.getAttribute("data-exit-intent-action")){case"close":t.addEventListener("click",()=>{this.hidePopup(),this.emit("exit-intent:action",{action:"close"})});break;case"apply-coupon":const e=t.getAttribute("data-coupon-code");e&&t.addEventListener("click",()=>g(this,null,function*(){this.emit("exit-intent:action",{action:"apply-coupon",couponCode:e});const{useCartStore:t}=yield Promise.resolve().then(()=>It),i=t.getState();yield i.applyCoupon(e),this.hidePopup()}));break;case"custom":t.addEventListener("click",()=>g(this,null,function*(){this.action&&(yield this.action()),this.emit("exit-intent:action",{action:"custom"}),this.hidePopup()}))}})}createImagePopup(){this.overlayElement=document.createElement("div"),this.overlayElement.className="exit-intent-overlay",this.overlayElement.setAttribute("data-exit-intent","overlay"),this.overlayElement.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background-color: rgba(0, 0, 0, 0.7);\n      z-index: 999999;\n      cursor: pointer;\n    ",this.popupElement=document.createElement("div"),this.popupElement.className="exit-intent-popup",this.popupElement.setAttribute("data-exit-intent","popup"),this.popupElement.style.cssText=`\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      z-index: 1000000;\n      cursor: ${this.imageClickable&&!this.actionButtonText?"pointer":"default"};\n      max-width: 90vw;\n      max-height: ${this.actionButtonText?"60vh":"50vh"};\n    `;const t=document.createElement("img");if(t.className="exit-intent-image",t.setAttribute("data-exit-intent","image"),t.src=this.imageUrl,t.style.cssText="\n      max-width: 100%;\n      max-height: 50vh;\n      width: auto;\n      height: auto;\n      object-fit: contain;\n      border-radius: 8px;\n      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);\n    ",t.onerror=()=>{this.logger.error("Failed to load exit intent image:",this.imageUrl),this.hidePopup()},this.popupElement.appendChild(t),this.actionButtonText){const t=document.createElement("div");t.style.cssText="\n        text-align: center;\n        margin-top: 20px;\n      ";const e=document.createElement("button");e.className="exit-intent-action-button",e.setAttribute("data-exit-intent","action"),e.textContent=this.actionButtonText,e.style.cssText="\n        background-color: #4CAF50;\n        color: white;\n        border: none;\n        padding: 12px 30px;\n        font-size: 16px;\n        border-radius: 5px;\n        cursor: pointer;\n        font-weight: bold;\n      ",e.addEventListener("click",t=>g(this,null,function*(){if(t.stopPropagation(),this.emit("exit-intent:clicked",{imageUrl:this.imageUrl}),this.action)try{yield this.action()}catch(e){this.logger.error("Exit intent action failed:",e)}this.saveToSessionStorage(),this.hidePopup()})),t.appendChild(e),this.popupElement.appendChild(t)}if(this.showCloseButton){const t=document.createElement("button");t.className="exit-intent-close",t.setAttribute("data-exit-intent","close"),t.innerHTML="&times;",t.style.cssText="\n        position: absolute;\n        top: 10px;\n        right: 10px;\n        background: transparent;\n        border: none;\n        font-size: 30px;\n        cursor: pointer;\n        z-index: 1000001;\n        color: #fff;\n        text-shadow: 0 0 3px rgba(0,0,0,0.5);\n        padding: 0;\n        width: 30px;\n        height: 30px;\n        line-height: 1;\n      ",t.addEventListener("click",t=>{t.stopPropagation(),this.hidePopup(),this.emit("exit-intent:closed",{imageUrl:this.imageUrl})}),this.popupElement.appendChild(t)}this.overlayElement.addEventListener("click",()=>{this.hidePopup(),this.emit("exit-intent:dismissed",{imageUrl:this.imageUrl}),this.saveToSessionStorage()}),this.imageClickable&&!this.actionButtonText?this.popupElement.addEventListener("click",t=>g(this,null,function*(){if(t.stopPropagation(),this.emit("exit-intent:clicked",{imageUrl:this.imageUrl}),this.action)try{yield this.action()}catch(e){this.logger.error("Exit intent action failed:",e)}this.saveToSessionStorage(),this.hidePopup()})):this.popupElement.addEventListener("click",t=>{t.stopPropagation()});const e=t=>{"Escape"===t.key&&(this.hidePopup(),this.emit("exit-intent:dismissed",{imageUrl:this.imageUrl}),this.saveToSessionStorage(),document.removeEventListener("keydown",e))};document.addEventListener("keydown",e),document.body.appendChild(this.overlayElement),document.body.appendChild(this.popupElement),requestAnimationFrame(()=>{this.overlayElement&&(this.overlayElement.style.opacity="1"),this.popupElement&&(this.popupElement.style.opacity="0",this.popupElement.style.transform="translate(-50%, -50%) scale(0.8)",this.popupElement.style.transition="all 0.3s ease",requestAnimationFrame(()=>{this.popupElement&&(this.popupElement.style.opacity="1",this.popupElement.style.transform="translate(-50%, -50%) scale(1)")}))})}hidePopup(){this.popupElement&&(this.popupElement.style.transition="all 0.2s ease",this.popupElement.style.opacity="0",this.popupElement.style.transform="translate(-50%, -50%) scale(0.8)",setTimeout(()=>{this.popupElement&&(this.popupElement.remove(),this.popupElement=null)},200)),this.overlayElement&&(this.overlayElement.style.transition="opacity 0.2s ease",this.overlayElement.style.opacity="0",setTimeout(()=>{this.overlayElement&&(this.overlayElement.remove(),this.overlayElement=null)},200))}cleanupEventListeners(){this.mouseLeaveHandler&&(document.removeEventListener("mouseleave",this.mouseLeaveHandler),this.mouseLeaveHandler=null),this.scrollHandler&&(window.removeEventListener("scroll",this.scrollHandler),this.scrollHandler=null),this.hidePopup()}destroy(){this.cleanupEventListeners(),super.destroy()}}},Symbol.toStringTag,{value:"Module"})),Al=Object.freeze(Object.defineProperty({__proto__:null,FomoPopupEnhancer:class extends be{constructor(){super(document.body),this.isActive=!1,this.showCount=0,this.popupElement=null,this.timeoutIds=[],this.defaultItems=[],this.defaultCustomers={AU:["Jessica from Sydney","Emma from Melbourne","Olivia from Brisbane","Sophia from Perth"],GB:["Jane from London","Olivia from Manchester","Amelia from Birmingham","Isabella from Leeds"],CA:["Lily from Toronto","Emma from Vancouver","Ava from Montreal","Sophia from Calgary"],US:["Grace from New York","Hailey from Sacramento","Phoebe from Las Vegas","Jenny from Scottsdale"]},this.loadItemsFromCampaign(),this.config={items:this.defaultItems,customers:this.defaultCustomers,maxMobileShows:2,displayDuration:5e3,delayBetween:12e3,initialDelay:0,country:"US"}}update(t){return g(this,null,function*(){t&&this.setup(t)})}loadItemsFromCampaign(){var t;const e=dt.getState();(null==(t=e.data)?void 0:t.packages)&&(this.defaultItems=e.data.packages.slice(0,5).map(t=>({text:t.name,image:t.image||""})).filter(t=>t.image)),0===this.defaultItems.length&&(this.defaultItems=[{text:"Popular Package",image:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23ddd'/%3E%3Ctext x='50' y='50' text-anchor='middle' dy='.3em' fill='%23999'%3EProduct%3C/text%3E%3C/svg%3E"}])}initialize(){return g(this,null,function*(){"loading"===document.readyState&&(yield new Promise(t=>{document.addEventListener("DOMContentLoaded",()=>t())})),this.injectStyles()})}setup(t={}){t.items||this.loadItemsFromCampaign(),this.config=h(u(u({},this.config),t),{items:t.items||this.defaultItems,customers:void 0!==t.customers?t.customers:this.config.customers}),t.country||(this.config.country=this.detectCountry()),this.logger.debug("FOMO popup configured:",this.config)}start(){if(this.isActive)return;this.isActive=!0,this.createPopupElement();const t=window.setTimeout(()=>{this.showNextPopup()},this.config.initialDelay||0);this.timeoutIds.push(t)}stop(){this.isActive=!1,this.timeoutIds.forEach(t=>clearTimeout(t)),this.timeoutIds=[],this.hidePopup(),this.showCount=0}showNextPopup(){if(!this.isActive)return;if(window.innerWidth<=768&&this.showCount>=(this.config.maxMobileShows||2))return void this.stop();const t=this.getRandomItem(),e=this.getRandomCustomer();this.updatePopupContent(t,e),this.showPopup();const i=window.setTimeout(()=>{this.hidePopup();const t=window.setTimeout(()=>{this.showNextPopup()},this.config.delayBetween||12e3);this.timeoutIds.push(t)},this.config.displayDuration||5e3);this.timeoutIds.push(i),this.showCount++}getRandomItem(){const t=this.config.items||[];return 0===t.length?{text:"Popular Package",image:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23ddd'/%3E%3Ctext x='50' y='50' text-anchor='middle' dy='.3em' fill='%23999'%3EProduct%3C/text%3E%3C/svg%3E"}:t[Math.floor(Math.random()*t.length)]}getRandomCustomer(){var t,e;const i=this.config.country||"US",n=(null==(t=this.config.customers)?void 0:t[i])||(null==(e=this.config.customers)?void 0:e.US)||[];return n[Math.floor(Math.random()*n.length)]||"Someone"}detectCountry(){const t=Intl.DateTimeFormat().resolvedOptions().timeZone;return t.includes("Australia")?"AU":t.includes("London")||t.includes("Dublin")?"GB":t.includes("Toronto")||t.includes("Vancouver")?"CA":"US"}createPopupElement(){this.popupElement||(this.popupElement=document.createElement("div"),this.popupElement.className="next-fomo-wrapper",this.popupElement.innerHTML='\n      <div class="next-fomo-inner">\n        <div class="next-fomo-item">\n          <div class="next-fomo-thumb">\n            <img class="next-fomo-image" alt="Product">\n          </div>\n          <div class="next-fomo-desc">\n            <p>\n              <span class="next-fomo-customer"></span><br>\n              Just purchased:<br>\n              <span class="next-fomo-product"></span><br>\n              <span class="next-fomo-time">JUST NOW</span>\n            </p>\n          </div>\n        </div>\n      </div>\n    ',document.body.appendChild(this.popupElement))}updatePopupContent(t,e){if(!this.popupElement)return;const i=this.popupElement.querySelector(".next-fomo-image"),n=this.popupElement.querySelector(".next-fomo-customer"),r=this.popupElement.querySelector(".next-fomo-product");i&&(i.src=t.image),n&&(n.textContent=e),r&&(r.textContent=t.text),this.emit("fomo:shown",{customer:e,product:t.text,image:t.image})}showPopup(){this.popupElement&&(this.popupElement.style.display="none",this.popupElement.offsetHeight,this.popupElement.style.display="",requestAnimationFrame(()=>{this.popupElement&&this.popupElement.classList.add("next-fomo-show")}))}hidePopup(){this.popupElement&&this.popupElement.classList.remove("next-fomo-show")}injectStyles(){if(document.getElementById("next-fomo-styles"))return;const t=document.createElement("style");t.id="next-fomo-styles",t.textContent="\n      .next-fomo-wrapper {\n        position: fixed;\n        bottom: 20px;\n        left: 20px;\n        width: 320px;\n        background: white;\n        border-radius: 10px;\n        box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n        transform: translateY(120%);\n        transition: transform 0.8s ease;\n        z-index: 999998;\n      }\n      \n      .next-fomo-wrapper.next-fomo-show {\n        transform: translateY(0);\n      }\n      \n      @media (max-width: 768px) {\n        .next-fomo-wrapper {\n          width: calc(100% - 40px);\n          max-width: 320px;\n        }\n      }\n      \n      .next-fomo-item {\n        display: flex;\n        padding: 15px;\n        align-items: center;\n      }\n      \n      .next-fomo-thumb {\n        flex-shrink: 0;\n        margin-right: 15px;\n      }\n      \n      .next-fomo-thumb img {\n        width: 60px;\n        height: 60px;\n        object-fit: cover;\n        border-radius: 8px;\n      }\n      \n      .next-fomo-desc {\n        flex: 1;\n      }\n      \n      .next-fomo-desc p {\n        margin: 0;\n        font-size: 13px;\n        line-height: 1.4;\n        color: #333;\n      }\n      \n      .next-fomo-customer {\n        font-weight: 600;\n        color: #000;\n      }\n      \n      .next-fomo-product {\n        font-weight: 600;\n        color: #000;\n      }\n      \n      .next-fomo-time {\n        font-size: 11px;\n        color: #999;\n        text-transform: uppercase;\n      }\n    ",document.head.appendChild(t)}cleanupEventListeners(){this.stop(),this.popupElement&&(this.popupElement.remove(),this.popupElement=null)}destroy(){this.cleanupEventListeners(),super.destroy()}}},Symbol.toStringTag,{value:"Module"})),Ml={cart:{isEmpty:"isEmpty",hasItems:"!isEmpty",hasSavings:"totals.hasSavings",hasTotalSavings:"totals.hasTotalSavings",quantity:"totalQuantity",itemCount:"items.length",count:"totals.count",subtotal:{path:"totals.subtotal.formatted",preformatted:!0},total:{path:"totals.total.formatted",preformatted:!0},totalExclShipping:{path:"totals.totalExclShipping.formatted",preformatted:!0},shipping:{path:"totals.shipping.formatted",preformatted:!0},tax:{path:"totals.tax.formatted",preformatted:!0},discounts:{path:"totals.discounts.formatted",preformatted:!0},savingsAmount:{path:"totals.savings.formatted",preformatted:!0,fallback:"$0.00"},savingsPercentage:{path:"totals.savingsPercentage.formatted",preformatted:!0,fallback:"0%"},compareTotal:{path:"totals.compareTotal.formatted",preformatted:!0},totalSavingsAmount:{path:"totals.totalSavings.formatted",preformatted:!0,fallback:"$0.00"},totalSavingsPercentage:{path:"totals.totalSavingsPercentage.formatted",preformatted:!0,fallback:"0%"},"subtotal.raw":{path:"totals.subtotal.value",format:"currency"},"total.raw":{path:"totals.total.value",format:"currency"},"totalExclShipping.raw":{path:"totals.totalExclShipping.value",format:"currency"},"shipping.raw":{path:"totals.shipping.value",format:"currency"},"tax.raw":{path:"totals.tax.value",format:"currency"},"discounts.raw":{path:"totals.discounts.value",format:"currency"},"savingsAmount.raw":{path:"totals.savings.value",format:"currency"},"savingsPercentage.raw":{path:"totals.savingsPercentage.value",format:"percentage"},"compareTotal.raw":{path:"totals.compareTotal.value",format:"currency"},"totalSavingsAmount.raw":{path:"totals.totalSavings.value",format:"currency"},"totalSavingsPercentage.raw":{path:"totals.totalSavingsPercentage.value",format:"percentage"},hasCoupons:{path:"appliedCoupons.length",format:"boolean",validator:t=>t>0},hasCoupon:{path:"appliedCoupons.length",format:"boolean",validator:t=>t>0},couponCount:{path:"appliedCoupons.length",format:"number"},"coupons[0].code":{path:"appliedCoupons.0.code",format:"text"},"coupons[0].discount":{path:"appliedCoupons.0.discount",format:"currency"},"coupons[1].code":{path:"appliedCoupons.1.code",format:"text"},"coupons[1].discount":{path:"appliedCoupons.1.discount",format:"currency"},discountCode:{path:"appliedCoupons.0.code",format:"text",fallback:""},discountCodes:{path:"appliedCoupons",format:"text",validator:t=>Array.isArray(t)&&0!==t.length?t.map(t=>t.code).join(", "):""}},package:{ref_id:{path:"ref_id",format:"number"},external_id:"external_id",qty:{path:"qty",format:"number"},price:{path:"price",format:"currency"},price_total:{path:"price_total",format:"currency"},price_retail:{path:"price_retail",format:"currency"},price_retail_total:{path:"price_retail_total",format:"currency"},price_recurring:{path:"price_recurring",format:"currency"},is_recurring:"is_recurring",interval:"interval",interval_count:{path:"interval_count",format:"number"},unitPrice:{path:"_calculated.unitPrice",format:"currency"},unitRetailPrice:{path:"_calculated.unitRetailPrice",format:"currency"},packageTotal:{path:"price_total",format:"currency"},comparePrice:{path:"price_retail_total",format:"currency"},compareTotal:{path:"price_retail_total",format:"currency"},savingsAmount:{path:"_calculated.savingsAmount",format:"currency",validator:t=>Math.max(0,Number(t)||0),fallback:0,debugInfo:!0},savingsPercentage:{path:"_calculated.savingsPercentage",format:"percentage",validator:t=>Math.min(100,Math.max(0,Number(t)||0)),fallback:0},unitSavings:{path:"_calculated.unitSavings",format:"currency"},unitSavingsPercentage:{path:"_calculated.unitSavingsPercentage",format:"percentage"},hasSavings:"_calculated.hasSavings",isRecurring:"is_recurring",isBundle:"_calculated.isBundle",unitsInPackage:{path:"qty",format:"number"},discountedPrice:{path:"_calculated.discountedPrice",format:"currency"},discountedPriceTotal:{path:"_calculated.discountedPriceTotal",format:"currency"},discountAmount:{path:"_calculated.discountAmount",format:"currency"},hasDiscount:"_calculated.hasDiscount",finalPrice:{path:"_calculated.finalPrice",format:"currency"},finalPriceTotal:{path:"_calculated.finalPriceTotal",format:"currency"},totalSavingsAmount:{path:"_calculated.totalSavingsAmount",format:"currency"},totalSavingsPercentage:{path:"_calculated.totalSavingsPercentage",format:"percentage"},totalSavingsWithDiscounts:{path:"_calculated.totalSavingsWithDiscounts",format:"currency"},totalSavingsPercentageWithDiscounts:{path:"_calculated.totalSavingsPercentageWithDiscounts",format:"percentage"},hasTotalSavings:"_calculated.hasTotalSavings"},selection:{hasSelection:{path:"hasSelection",format:"boolean"},packageId:{path:"packageId",format:"number"},quantity:{path:"quantity",format:"number"},name:"name",price:{path:"price",format:"currency"},total:{path:"total",format:"currency"},compareTotal:{path:"compareTotal",format:"currency"},unitPrice:{path:"unitPrice",format:"currency"},savingsAmount:{path:"savingsAmount",format:"currency"},savingsPercentage:{path:"savingsPercentage",format:"percentage"},hasSavings:{path:"hasSavings",format:"boolean"},isBundle:{path:"isBundle",format:"boolean"},totalUnits:{path:"totalUnits",format:"number"},monthlyPrice:{path:"monthlyPrice",format:"currency"},yearlyPrice:{path:"yearlyPrice",format:"currency"},pricePerDay:{path:"pricePerDay",format:"currency"},savingsPerUnit:{path:"savingsPerUnit",format:"currency"},discountAmount:{path:"discountAmount",format:"currency"},price_total:{path:"total",format:"currency"},price_retail_total:{path:"compareTotal",format:"currency"},savings:{path:"savingsAmount",format:"currency"},pricePerUnit:{path:"unitPrice",format:"currency"},totalQuantity:{path:"totalUnits",format:"number"},isMultiPack:{path:"isBundle",format:"boolean"},isSingleUnit:{path:"isSingleUnit",format:"boolean"},At:!0},shipping:{isFree:"_calculated.isFree",cost:"_calculated.cost",price:"_calculated.price",name:"_calculated.name",code:"_calculated.code",method:"_calculated.method",id:"_calculated.id",refId:"_calculated.refId"},order:{isLoading:"isLoading",hasError:"error",errorMessage:"error",id:"order.id",number:"order.number",ref_id:"order.ref_id",created_at:{path:"created_at",format:"date"},total_incl_tax:{path:"total_incl_tax",format:"currency"},order_status_url:"order_status_url",is_test:"is_test",supports_upsells:"supports_upsells",payment_method:{path:"payment_method",format:"text"},shipping_method:{path:"shipping_method",format:"text"},refId:"order.ref_id",createdAt:{path:"order.created_at",format:"date"},total:{path:"order.total_incl_tax",format:"currency",fallback:0},statusUrl:"order.order_status_url",isTest:"order.is_test",supportsUpsells:"order.supports_post_purchase_upsells",paymentMethod:{path:"order.payment_method",format:"text",fallback:"Credit Card"},shippingMethod:{path:"order.shipping_method",format:"text"},status:{path:"order.status",fallback:"Completed"},currency:"order.currency",testBadge:{path:"order.is_test",format:"text"},subtotal:{path:"_calculated.subtotal",format:"currency"},subtotalExclShipping:{path:"_calculated.subtotalExclShipping",format:"currency"},total_excl_tax:{path:"order.total_excl_tax",format:"currency"},tax:{path:"order.total_tax",format:"currency"},shipping:{path:"order.shipping_incl_tax",format:"currency"},shippingExclTax:{path:"order.shipping_excl_tax",format:"currency"},shippingTax:{path:"order.shipping_tax",format:"currency"},discounts:{path:"order.total_discounts",format:"currency"},savings:{path:"_calculated.savings",format:"currency"},savingsAmount:{path:"_calculated.savingsAmount",format:"currency"},savingsPercentage:{path:"_calculated.savingsPercentage",format:"percentage"},hasSavings:"_calculated.hasSavings","customer.name":"customer.name","customer.firstName":"customer.firstName","customer.lastName":"customer.lastName","customer.email":"customer.email","customer.phone":"customer.phone","shippingAddress.full":{path:"shippingAddress.full",format:"text"},"shippingAddress.line1":{path:"shippingAddress.line1",format:"text"},"shippingAddress.line2":{path:"shippingAddress.line2",format:"text"},"shippingAddress.city":{path:"shippingAddress.city",format:"text"},"shippingAddress.state":{path:"shippingAddress.state",format:"text"},"shippingAddress.country":{path:"shippingAddress.country",format:"text"},"shippingAddress.zip":{path:"shippingAddress.zip",format:"text"},"shippingAddress.postcode":{path:"shippingAddress.postcode",format:"text"},"billingAddress.full":{path:"billingAddress.full",format:"text"},"billingAddress.line1":{path:"billingAddress.line1",format:"text"},"billingAddress.line2":{path:"billingAddress.line2",format:"text"},"billingAddress.city":{path:"billingAddress.city",format:"text"},"billingAddress.state":{path:"billingAddress.state",format:"text"},"billingAddress.country":{path:"billingAddress.country",format:"text"},"billingAddress.zip":{path:"billingAddress.zip",format:"text"},"billingAddress.postcode":{path:"billingAddress.postcode",format:"text"},hasItems:"_calculated.hasItems",isEmpty:"_calculated.isEmpty",hasShipping:"_calculated.hasShipping",hasTax:"_calculated.hasTax",hasDiscounts:"_calculated.hasDiscounts",hasUpsells:"_calculated.hasUpsells","lines.count":"_calculated.lines.count","lines.totalQuantity":"_calculated.lines.totalQuantity","lines.upsellCount":"_calculated.lines.upsellCount","lines.mainProduct":"_calculated.lines.mainProduct","lines.mainProductSku":"_calculated.lines.mainProductSku","total.formatted":"_formatted.total","createdAt.formatted":"_formatted.createdAt"}};function Ll(t,e){const i=Ml[t];if(!i)return null;const n=i[e];return n&&"boolean"!=typeof n?"string"==typeof n?{path:n}:n:null}function Dl(t,e){const i=Ll(t,e);return null==i?void 0:i.path}class Fl{static validatePercentage(t){const e=Number(t);return isNaN(e)?0:e>1&&e<=100?e:e>=0&&e<=1?100*e:e>100?100:Math.max(0,e)}static validateCurrency(t){if("string"==typeof t){const e=t.replace(/[$,]/g,"").trim(),i=Number(e);if(!isNaN(i))return Math.round(100*i)/100}const e=Number(t);return isNaN(e)?0:Math.round(100*e)/100}static validateNumber(t){const e=Number(t);return isNaN(e)?0:e}static validateBoolean(t){if("boolean"==typeof t)return t;if("string"==typeof t){const e=t.toLowerCase();return"true"===e||"1"===e||"yes"===e}return!!t}static validateDate(t){if(!t)return null;try{const e=new Date(t);return isNaN(e.getTime())?null:e}catch(e){return null}}static validateString(t){return null==t?"":String(t)}}const Ol=class{static wrap(t,e,i){try{return t()}catch(n){return this.handleError(n,i||{operation:"unknown"}),e}}static wrapAsync(t,e,i){return g(this,null,function*(){try{return yield t()}catch(n){return this.handleError(n,i||{operation:"unknown"}),e}})}static tryStrategies(t,e,i){for(let r=0;r<t.length;r++)try{const e=t[r];if(e)return e()}catch(n){r===t.length-1&&this.handleError(n,h(u({},i),{operation:(null==i?void 0:i.operation)||"tryStrategies",strategy:r}))}return e}static addErrorHandler(t){this.errorHandlers.push(t)}static removeErrorHandler(t){const e=this.errorHandlers.indexOf(t);e>-1&&this.errorHandlers.splice(e,1)}static handleError(t,e){const i=`${e.operation}:${t.message}`,n=Date.now(),r=this.errorCache.get(i);if(r)if(n-r.lastError.getTime()<this.ERROR_WINDOW_MS){if(r.count++,r.count>this.ERROR_THRESHOLD)return}else r.count=1,r.lastError=new Date(n);else this.errorCache.set(i,{count:1,lastError:new Date(n)});this.logger.error(`[Display Error] ${e.operation}:`,{error:t.message,stack:t.stack,context:e}),this.errorHandlers.forEach(i=>{try{i(t,e)}catch(n){this.logger.error("Error in error handler:",n)}})}static clearErrorCache(){this.errorCache.clear()}static getErrorStats(){return new Map(this.errorCache)}};Ol.logger=new Y("DisplayErrorBoundary"),Ol.errorHandlers=[],Ol.errorCache=new Map,Ol.ERROR_THRESHOLD=5,Ol.ERROR_WINDOW_MS=6e4;let Ul=Ol;const Nl=class{static formatValue(t,e="auto",i){return Ul.wrap(()=>{if(null==t)return"";switch(e){case"currency":return this.formatCurrency(t,null==i?void 0:i.hideZeroCents);case"number":return this.formatNumber(t);case"boolean":return this.formatBoolean(t);case"date":return this.formatDate(t);case"percentage":return this.formatPercentage(t);case"text":return String(t);default:return this.formatAuto(t,i)}},"",{operation:"formatValue",value:String(t),format:String(e)})}static formatCurrency(t,e){const i=Fl.validateCurrency(t);return _t(i,void 0,void 0!==e?{hideZeroCents:e}:{})}static formatNumber(t){const e=Fl.validateNumber(t);return kt(e)}static formatBoolean(t){if("boolean"==typeof t)return t?"Yes":"No";if("string"==typeof t){const e=t.toLowerCase();if("true"===e||"1"===e||"yes"===e)return"Yes";if("false"===e||"0"===e||"no"===e)return"No"}return t?"Yes":"No"}static formatDate(t){if(!t)return"";try{const e=new Date(t);return isNaN(e.getTime())?String(t):this.dateFormatter.format(e)}catch(e){return String(t)}}static formatPercentage(t){const e=Fl.validatePercentage(t);return`${Math.round(e)}%`}static formatAuto(t,e){var i,n;if("boolean"==typeof t)return this.formatBoolean(t);if("number"==typeof t){if(Number.isInteger(t)&&t>=0&&t<=10)return t.toString();const n=t.toString();return n.includes(".")&&2===(null==(i=n.split(".")[1])?void 0:i.length)?this.formatCurrency(t,null==e?void 0:e.hideZeroCents):(Number.isInteger(t),this.formatNumber(t))}if("string"==typeof t){const i=new Date(t);if(!isNaN(i.getTime())&&t.match(/\d{4}-\d{2}-\d{2}/))return this.formatDate(t);const r=Number(t);if(!isNaN(r)&&t.includes(".")){const t=r.toString();return t.includes(".")&&2===(null==(n=t.split(".")[1])?void 0:n.length)?this.formatCurrency(r,null==e?void 0:e.hideZeroCents):this.formatNumber(r)}}return String(t)}};Nl.dateFormatter=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});let zl=Nl;class ql{static getNestedProperty(t,e){if(!t||!e)return;const i=e.split(".");let n=t;for(const r of i){if(null==n)return;if(r.includes("[")&&r.includes("]")){const[t,e]=r.split("["),i=parseInt((null==e?void 0:e.replace("]",""))||"");if(!t||isNaN(i))return;if(n=n[t],!(Array.isArray(n)&&i>=0&&i<n.length))return;n=n[i]}else n=n[r]}return n}static hasProperty(t,e){return void 0!==this.getNestedProperty(t,e)}static getPropertyWithFallbacks(t,e){for(const i of e){const e=this.getNestedProperty(t,i);if(void 0!==e)return e}}}class jl extends be{constructor(){super(...arguments),this.formatType="auto",this.hideIfZero=!1,this.hideIfFalse=!1,this.hideZeroCents=!1,this.debugMode=!1}initialize(){return g(this,null,function*(){this.validateElement(),this.parseDisplayAttributes(),this.setupStoreSubscriptions(),this.setupCurrencyChangeListener(),yield this.performInitialUpdate(),this.logger.debug(`${this.constructor.name} initialized with path: ${this.displayPath}`)})}setupCurrencyChangeListener(){document.addEventListener("next:currency-changed",()=>{this.logger.debug(`Currency changed, updating display for ${this.displayPath}`),wt.clearCache(),this.lastValue=void 0,this.updateDisplay()})}parseDisplayAttributes(){const t=this.getAttribute("data-next-display");if(!t)throw new Error(`${this.constructor.name}: data-next-display attribute is required`);this.displayPath=t;const e=ce.parseDisplayPath(this.displayPath);this.property=e.property;const i=this.getAttribute("data-next-format")||this.getAttribute("data-format"),n=this.getDefaultFormatType(this.property||"");this.formatType=i||n,this.hideIfZero="true"===this.getAttribute("data-hide-if-zero"),this.hideIfFalse="true"===this.getAttribute("data-hide-if-false"),this.hideZeroCents="true"===this.getAttribute("data-hide-zero-cents");const r=this.getAttribute("data-divide-by");r&&(this.divideBy=parseFloat(r));const s=this.getAttribute("data-multiply-by");s&&(this.multiplyBy=parseFloat(s))}getDefaultFormatType(t){if(this.displayPath){const t=this.displayPath.split(".");if(t.length>=2){const[e,...i]=t;let n=i.join(".");"selection"===e&&i.length>=2&&(n=i.slice(1).join("."));const r=Ll(e,n);if(null==r?void 0:r.format)return r.format}}const e=t.toLowerCase();return e.endsWith(".raw")?"auto":e.includes("percentage")||e.includes("percent")||e.endsWith("pct")||e.endsWith("rate")?"percentage":["price","cost","amount","total","subtotal","retail","compare","savings","shipping","tax","discount","fee","charge","payment","balance","credit","debit","refund","revenue","msrp","value"].some(t=>e.includes(t))?"currency":e.startsWith("is")||e.startsWith("has")||e.startsWith("can")||e.startsWith("should")||e.startsWith("enabled")||e.startsWith("disabled")||e.includes("visible")||e.includes("active")?"boolean":e.includes("date")||e.includes("time")||e.endsWith("at")||e.endsWith("on")?"date":e.includes("quantity")||e.includes("count")||e.includes("qty")||e.includes("units")||e.includes("items")?"number":"auto"}getPropertyValueWithValidation(){return Ul.wrap(()=>{const t=this.getPropertyValue();if(this.displayPath){const i=ce.parseDisplayPath(this.displayPath),n=Ll(i.object,this.property||i.property);if(n){let i=t;if(n.validator&&null!=i)try{i=n.validator(i)}catch(e){this.logger.warn(`Validator failed for ${this.displayPath}:`,e),i=n.fallback}return null==i&&void 0!==n.fallback&&(i=n.fallback),i}}return t},void 0,{operation:"getPropertyValueWithValidation",property:this.property||"unknown",path:this.displayPath||"unknown"})}performInitialUpdate(){return g(this,null,function*(){yield this.updateDisplay()})}updateDisplay(){return g(this,null,function*(){if("none"!==this.element.style.display&&!this.element.classList.contains("next-hidden"))try{let t,e,i=this.getPropertyValueWithValidation();if(i&&"object"==typeof i&&"Mt"in i){const t=i.value||"";return this.updateElementContent(t),this.showElement(),void(this.debugMode&&this.element.setAttribute("data-format-debug",JSON.stringify({path:this.displayPath,property:this.property,format:"preformatted",rawValue:i,formattedValue:t})))}if(i&&"object"==typeof i&&"value"in i&&"format"in i){const n=i;t=n.value,e=n.format,n.metadata}else t=i;if("number"==typeof t||"string"==typeof t&&!isNaN(Number(t))){const e=Number(t);this.divideBy&&(t=e/this.divideBy),this.multiplyBy&&(t=e*this.multiplyBy)}if(t===this.lastValue)return;if(this.lastValue=t,this.shouldHideElement(t))return void this.hideElement();let n=e||this.formatType;!e&&this.property&&this.property.toLowerCase().includes("percentage")&&"auto"===this.formatType&&(n="percentage");const r=zl.formatValue(t,n,{hideZeroCents:this.hideZeroCents});this.debugMode&&this.element.setAttribute("data-format-debug",JSON.stringify({path:this.displayPath,property:this.property,format:n,rawValue:i,formattedValue:r})),this.updateElementContent(r),this.showElement()}catch(t){this.handleError(t,"updateDisplay"),this.updateElementContent("N/A")}})}shouldHideElement(t){return!(!this.hideIfZero||0!==t&&"0"!==t&&0!==t)||!(!this.hideIfFalse||t)}updateElementContent(t){this.element instanceof HTMLInputElement||this.element instanceof HTMLTextAreaElement?this.element.value=t:this.element.textContent=t}hideElement(){this.element.style.display="none",this.addClass("display-hidden"),this.removeClass("display-visible")}showElement(){this.element.style.display="",this.addClass("display-visible"),this.removeClass("display-hidden")}update(){this.updateDisplay()}}const Rl=class{static findPackageId(t){let e=t.parentElement;for(;e;){for(const t of this.PACKAGE_ID_ATTRS){const i=e.getAttribute(t);if(i){const t=parseInt(i,10);if(!isNaN(t))return this.logger.debug(`Found context package ID: ${t} from element:`,e),t}}e=e.parentElement}this.logger.debug("No context package ID found in parent elements")}static getPackageId(t){for(const e of this.PACKAGE_ID_ATTRS){const i=t.getAttribute(e);if(i){const e=parseInt(i,10);if(!isNaN(e))return this.logger.debug(`Found direct package ID: ${e} from element:`,t),e}}return this.findPackageId(t)}};Rl.logger=tt("PackageContextResolver"),Rl.PACKAGE_ID_ATTRS=["data-next-package-id","data-next-package","data-package-id"];let Hl=Rl;class Vl extends jl{constructor(){super(...arguments),this.includeDiscounts=!1}initialize(){return g(this,null,function*(){this.includeDiscounts=this.element.hasAttribute("data-include-discounts"),yield m(Vl.prototype,this,"initialize").call(this)})}setupStoreSubscriptions(){this.subscribe(Tt,this.handleCartUpdate.bind(this)),this.cartState=Tt.getState(),this.cartState.items.length>0&&this.cartState.totals.isEmpty&&(this.logger.debug("Cart has items but totals are empty, triggering recalculation"),Tt.getState().calculateTotals())}handleCartUpdate(t){var e,i,n,r;const s=this.cartState;this.cartState=t,!("total"===this.property||"itemCount"===this.property)||(null==s?void 0:s.total)===t.total&&(null==(e=null==s?void 0:s.items)?void 0:e.length)===(null==(i=t.items)?void 0:i.length)||this.logger.debug("Cart updated",{isEmpty:t.isEmpty,itemCount:t.items.length,total:t.total,totalsFormatted:null==(r=null==(n=t.totals)?void 0:n.total)?void 0:r.formatted}),this.toggleClass("next-cart-empty",t.isEmpty),this.toggleClass("next-cart-has-items",!t.isEmpty),this.updateDisplay()}getPropertyValue(){var t,e,i,n,r,s,a,o,c,l,d,u,h,p,f;if(!this.cartState||!this.property)return void this.logger.debug("Missing cartState or property",{hasCartState:!!this.cartState,property:this.property});if("currency"===this.property||"currencyCode"===this.property){const e=dt.getState();if(null==(t=null==e?void 0:e.data)?void 0:t.currency)return e.data.currency;{const t=yt.getState();return(null==t?void 0:t.selectedCurrency)||(null==t?void 0:t.detectedCurrency)||"USD"}}if("currencySymbol"===this.property){const t=yt.getState();if(null==(i=null==(e=null==t?void 0:t.locationData)?void 0:e.detectedCountryConfig)?void 0:i.currencySymbol)return t.locationData.detectedCountryConfig.currencySymbol;let r="USD";const s=dt.getState();return r=(null==(n=null==s?void 0:s.data)?void 0:n.currency)?s.data.currency:(null==t?void 0:t.selectedCurrency)||(null==t?void 0:t.detectedCurrency)||"USD",Pt(r)||r}if(this.includeDiscounts&&"subtotal"===this.property){this.logger.debug("Handling subtotal with discounts",{subtotal:null==(r=this.cartState.totals)?void 0:r.subtotal,discounts:null==(s=this.cartState.totals)?void 0:s.discounts});const t=((null==(o=null==(a=this.cartState.totals)?void 0:a.subtotal)?void 0:o.value)||0)-((null==(l=null==(c=this.cartState.totals)?void 0:c.discounts)?void 0:l.value)||0);let e="USD";const i=dt.getState();if(null==(d=null==i?void 0:i.data)?void 0:d.currency)e=i.data.currency;else{const t=yt.getState();e=(null==t?void 0:t.selectedCurrency)||(null==t?void 0:t.detectedCurrency)||"USD"}const n=_t(t,e);return this.logger.debug("Returning discounted subtotal",{discountedSubtotal:t,formatted:n,currency:e}),{Mt:!0,value:n}}if(this.includeDiscounts&&"subtotal.raw"===this.property)return((null==(h=null==(u=this.cartState.totals)?void 0:u.subtotal)?void 0:h.value)||0)-((null==(f=null==(p=this.cartState.totals)?void 0:p.discounts)?void 0:f.value)||0);const m=Ll("cart",this.property);if(m){const{path:t,preformatted:e}=m;if(t.startsWith("!")){const e=t.substring(1);return!ql.getNestedProperty(this.cartState,e)}const i=ql.getNestedProperty(this.cartState,t);return e?{Mt:!0,value:i}:i}return ql.getNestedProperty(this.cartState,this.property)}performInitialUpdate(){return g(this,null,function*(){this.displayPath&&"package"===ce.parseDisplayPath(this.displayPath).object&&this.logger.warn(`CartDisplayEnhancer is handling package property "${this.displayPath}" - this may be incorrect!`,{element:this.element.outerHTML.substring(0,200)+"...",hasPackageContext:void 0!==Hl.findPackageId(this.element)}),yield m(Vl.prototype,this,"performInitialUpdate").call(this)})}getCartProperty(t,e){const i=this.cartState,n=this.property;this.cartState=t,this.property=e;const r=this.getPropertyValue();return void 0!==i&&(this.cartState=i),void 0!==n&&(this.property=n),r}refreshDisplay(){this.updateDisplay()}}const Bl=Object.freeze(Object.defineProperty({__proto__:null,CartDisplayEnhancer:Vl},Symbol.toStringTag,{value:"Module"}));class Jl{static calculateSavings(t,e){return Math.max(0,t-e)}static calculateSavingsPercentage(t,e){const i=this.calculateSavings(t,e);if(t<=0||i<=0)return 0;const n=i/t*100;return Math.round(n)}static calculateUnitPrice(t,e){return e>0?t/e:0}static calculateLineTotal(t,e){return t*e}static calculatePackageMetrics(t){const e=t.priceTotal||t.price*t.quantity,i=t.retailPriceTotal||t.retailPrice*t.quantity,n=this.calculateUnitPrice(e,t.quantity),r=this.calculateUnitPrice(i,t.quantity);return{totalPrice:e,totalRetailPrice:i,totalSavings:this.calculateSavings(i,e),totalSavingsPercentage:this.calculateSavingsPercentage(i,e),unitPrice:n,unitRetailPrice:r,unitSavings:this.calculateSavings(r,n),unitSavingsPercentage:this.calculateSavingsPercentage(r,n),hasSavings:i>e}}}class Gl extends jl{constructor(){super(...arguments),this.selectedItem=null,this.selectionChangeHandler=null}initialize(){return g(this,null,function*(){this.validateElement(),this.parseDisplayAttributes(),this.findAssociatedSelector(),this.setupStoreSubscriptions(),this.selectedItem&&this.loadPackageData(),yield this.performInitialUpdate(),this.logger.debug("SelectionDisplayEnhancer initialized:",{displayPath:this.displayPath,selectorId:this.selectorId})})}parseDisplayAttributes(){super.parseDisplayAttributes();const t=this.displayPath.split(".");if(t.length>=3&&"selection"===t[0]){const e=t[1];e&&(this.selectorId=e),this.property=t.slice(2).join("."),this.logger.debug("Extracted selector ID from display path:",{displayPath:this.displayPath,selectorId:this.selectorId,property:this.property})}else{const t=this.getAttribute("data-next-selector-id")||this.getAttribute("data-selector-id")||this.findSelectorIdFromContext();t&&(this.selectorId=t)}this.selectorId||this.logger.warn("No selector ID found for SelectionDisplayEnhancer")}findSelectorIdFromContext(){var t,e,i;let n=this.element.parentElement;for(;n;){const r=null!=(t=n.getAttribute("data-next-selector-id"))?t:void 0;if(r)return r;if(n.hasAttribute("data-next-cart-selector"))return null!=(i=null!=(e=n.getAttribute("data-next-selector-id"))?e:n.getAttribute("data-next-id"))?i:void 0;n=n.parentElement}}findAssociatedSelector(){if(!this.selectorId)return;const t=document.querySelector(`[data-next-selector-id="${this.selectorId}"]`);if(t){const e=t.Lt;if("function"==typeof e)this.selectedItem=e(),this.logger.debug("Got initial selected item from selector:",this.selectedItem);else{const e=t.querySelector('[data-next-selected="true"]');if(e){const t=parseInt(e.getAttribute("data-next-package-id")||"0",10),i=parseInt(e.getAttribute("data-next-quantity")||"1",10);t>0&&(this.selectedItem={packageId:t,quantity:i,element:e,name:void 0,price:void 0,shippingId:e.getAttribute("data-next-shipping-id")||void 0,isPreSelected:!0},this.logger.debug("Found selected item from DOM:",this.selectedItem))}}}else this.logger.debug(`Selector element not found for ID: ${this.selectorId}`)}setupStoreSubscriptions(){this.subscribe(dt,this.handleCampaignUpdate.bind(this)),this.campaignState=dt.getState(),this.needsCartData()&&(this.subscribe(Tt,this.handleCartUpdate.bind(this)),this.cartState=Tt.getState()),this.selectionChangeHandler=this.handleSelectionChange.bind(this),this.eventBus.on("selector:selection-changed",this.selectionChangeHandler),this.eventBus.on("selector:item-selected",this.selectionChangeHandler)}needsCartData(){return!!this.property&&["discountedPrice","finalPrice","discountAmount","appliedDiscountAmount","hasDiscount","appliedDiscounts","discountPercentage"].includes(this.property)}handleCampaignUpdate(t){this.campaignState=t,this.loadPackageData(),this.updateDisplay()}handleCartUpdate(t){this.cartState=t,this.updateDisplay()}handleSelectionChange(t){if(t.selectorId===this.selectorId){if(this.logger.debug("Selection changed:",t),t.item)this.selectedItem=t.item;else if(t.packageId){const t=document.querySelector(`[data-next-selector-id="${this.selectorId}"]`);if(t){const e=t.Lt;"function"==typeof e&&(this.selectedItem=e())}}this.loadPackageData(),this.updateDisplay()}}loadPackageData(){var t;this.selectedItem&&this.campaignState&&(this.packageData=null==(t=this.campaignState.packages)?void 0:t.find(t=>t.ref_id===this.selectedItem.packageId),this.packageData||this.logger.warn(`Package ${this.selectedItem.packageId} not found in campaign data`))}getPropertyValue(){var t;if(this.selectedItem&&this.property)switch(this.property){case"hasSelection":return null!==this.selectedItem;case"packageId":return this.selectedItem.packageId;case"quantity":return this.selectedItem.quantity;case"name":return(null==(t=this.packageData)?void 0:t.name)||this.selectedItem.name||"";case"price":return this.getSelectionPrice();case"total":case"price_total":return this.getSelectionTotal();case"compareTotal":case"price_retail_total":return this.getSelectionCompareTotal();case"savings":case"savingsAmount":return this.getSelectionSavingsAmount();case"savingsPercentage":return this.getSelectionSavingsPercentageFormatted();case"hasSavings":return this.getSelectionHasSavings();case"unitPrice":case"pricePerUnit":return this.getSelectionUnitPrice();case"totalUnits":case"totalQuantity":return this.getSelectionTotalUnits();case"discountAmount":return this.getSelectionDiscountAmount();case"discountedPrice":case"finalPrice":return this.calculateSelectionDiscountedPrice();case"appliedDiscountAmount":return this.calculateSelectionDiscountAmount();case"hasDiscount":return this.getSelectionHasDiscount();case"discountPercentage":return this.getSelectionDiscountPercentage();case"appliedDiscounts":return this.getSelectionAppliedDiscounts();case"isMultiPack":case"isBundle":return this.getSelectionIsBundle();case"isSingleUnit":return!this.getSelectionIsBundle();default:const e=this.parseCalculatedField(this.property);return void 0!==e?e:this.packageData?ql.getNestedProperty(this.packageData,this.property):void 0}}getSelectionPrice(){return this.selectedItem?this.packageData?parseFloat(this.packageData.price||"0"):this.selectedItem.price||0:0}getSelectionTotal(){return this.selectedItem?this.packageData?parseFloat(this.packageData.price_total||"0")||parseFloat(this.packageData.price||"0")*this.selectedItem.quantity:(this.selectedItem.price||0)*this.selectedItem.quantity:0}getSelectionCompareTotal(){if(!this.selectedItem||!this.packageData)return 0;const t=parseFloat(this.packageData.price_retail_total||"0");if(t>0)return t;const e=parseFloat(this.packageData.price_retail||"0");return e>0?e*this.selectedItem.quantity:this.getSelectionTotal()}getSelectionMetrics(){const t=this.getSelectionTotal(),e=this.getSelectionCompareTotal();return{total:t,compareTotal:e,savings:Jl.calculateSavings(e,t),savingsPercentage:Jl.calculateSavingsPercentage(e,t)}}getSelectionSavingsAmount(){return this.getSelectionMetrics().savings}getSelectionSavingsPercentageFormatted(){return this.getSelectionMetrics().savingsPercentage}getSelectionHasSavings(){return this.getSelectionMetrics().savings>0}getSelectionUnitPrice(){const t=this.getSelectionTotal(),e=this.getSelectionTotalUnits();return e>0?t/e:0}getSelectionTotalUnits(){var t;return this.selectedItem?(null==(t=this.packageData)?void 0:t.qty)||1:0}getSelectionDiscountAmount(){return this.getSelectionSavingsAmount()}getSelectionIsBundle(){return this.getSelectionTotalUnits()>1}calculateSelectionDiscountAmount(){var t,e;if(!this.selectedItem||!this.packageData||!(null==(e=null==(t=this.cartState)?void 0:t.appliedCoupons)?void 0:e.length))return 0;let i=0;const n=this.getSelectionPrice(),r=this.selectedItem.quantity;for(const s of this.cartState.appliedCoupons)if(s.definition.packageIds&&s.definition.packageIds.includes(this.selectedItem.packageId))"percentage"===s.definition.type?i+=n*r*s.definition.value/100:"fixed"===s.definition.type&&(i+=s.definition.value*r);else if(!s.definition.packageIds||0===s.definition.packageIds.length)if("percentage"===s.definition.type)i+=n*r*s.definition.value/100;else if("fixed"===s.definition.type){const t=n*r,e=this.cartState.totals.subtotal.value;if(e>0){const n=t/e;i+=s.definition.value*n}}return i}calculateSelectionDiscountedPrice(){var t;const e=this.getSelectionPrice(),i=this.calculateSelectionDiscountAmount(),n=(null==(t=this.selectedItem)?void 0:t.quantity)||1,r=n>0?i/n:0;return Math.max(0,e-r)}getSelectionHasDiscount(){return this.calculateSelectionDiscountAmount()>0}getSelectionDiscountPercentage(){const t=this.getSelectionTotal(),e=this.calculateSelectionDiscountAmount();return t<=0?0:e/t*100}getSelectionAppliedDiscounts(){var t,e;if(!this.selectedItem||!this.packageData||!(null==(e=null==(t=this.cartState)?void 0:t.appliedCoupons)?void 0:e.length))return[];const i=[];for(const n of this.cartState.appliedCoupons){let t=0;if(n.definition.packageIds&&n.definition.packageIds.includes(this.selectedItem.packageId))"percentage"===n.definition.type?t=this.getSelectionTotal()*n.definition.value/100:"fixed"===n.definition.type&&(t=n.definition.value*this.selectedItem.quantity);else if(!n.definition.packageIds||0===n.definition.packageIds.length)if("percentage"===n.definition.type)t=this.getSelectionTotal()*n.definition.value/100;else if("fixed"===n.definition.type){const e=this.getSelectionTotal(),i=this.cartState.totals.subtotal.value;if(i>0){const r=e/i;t=n.definition.value*r}}t>0&&i.push({code:n.code,amount:t})}return i}parseCalculatedField(t){var e,i;if(!this.selectedItem||!t)return;const n=["+","-","*","/"];for(const r of n)if(t.includes(r)){const n=t.split(r);if(2===n.length){const t=(null==(e=n[0])?void 0:e.trim())||"",s=parseFloat((null==(i=n[1])?void 0:i.trim())||"0");let a=0;switch(t){case"total":case"price_total":a=this.getSelectionTotal();break;case"price":a=this.getSelectionPrice();break;case"savings":case"savingsAmount":a=this.getSelectionSavingsAmount();break;case"compareTotal":a=this.getSelectionCompareTotal();break;default:const e=this.property;this.property=t;const i=this.getPropertyValue();this.property=e,a="number"==typeof i?i:0}if(!isNaN(s))switch(r){case"+":return a+s;case"-":return a-s;case"*":return a*s;case"/":return 0!==s?a/s:0}}}}performInitialUpdate(){return g(this,null,function*(){!this.selectedItem&&this.selectorId&&(yield new Promise(t=>setTimeout(t,50)),this.findAssociatedSelector(),this.selectedItem&&this.loadPackageData()),yield this.updateDisplay()})}updateDisplay(){return g(this,null,function*(){null!==this.selectedItem||"hasSelection"===this.property?yield m(Gl.prototype,this,"updateDisplay").call(this):this.hideElement()})}destroy(){this.selectionChangeHandler&&(this.eventBus.off("selector:selection-changed",this.selectionChangeHandler),this.eventBus.off("selector:item-selected",this.selectionChangeHandler)),super.destroy()}}const Kl=Object.freeze(Object.defineProperty({__proto__:null,SelectionDisplayEnhancer:Gl},Symbol.toStringTag,{value:"Module"})),Ql=class{static provide(t,e){this.contexts.set(t,e),this.contextElements.add(t)}static resolve(t){let e=t;for(;e;){if(this.contexts.has(e))return this.contexts.get(e);const t=e.getAttribute("data-next-package-id"),i=e.getAttribute("data-next-cart-item-id"),n=e.getAttribute("data-next-shipping-id"),r=e.getAttribute("data-next-selector-id");if(t||i||n||r){const s={};return t&&(s.packageId=parseInt(t,10)),i&&(s.cartItemId=i),n&&(s.shippingMethodId=n),r&&(s.selectionId=r),this.provide(e,s),s}e=e.parentElement}return null}static merge(t,e){return t?e?u(u({},t),e):t:e}static clear(t){this.contexts.delete(t),this.contextElements.delete(t)}static clearAll(){this.contextElements.forEach(t=>{}),this.contexts=new WeakMap,this.contextElements.clear()}static getContextElements(){return Array.from(this.contextElements)}static validate(t,e){return e.every(e=>void 0!==t[e])}};Ql.contexts=new WeakMap,Ql.contextElements=new Set;let Zl=Ql;const Wl=Object.freeze(Object.defineProperty({__proto__:null,ProductDisplayEnhancer:class extends jl{constructor(){super(...arguments),this.multiplyByQuantity=!1,this.currentQuantity=1}initialize(){return g(this,null,function*(){this.validateElement(),this.parseDisplayAttributes(),this.multiplyByQuantity=this.element.hasAttribute("data-next-multiply-quantity"),this.quantitySelectorId=this.getAttribute("data-next-quantity-selector-id")||"",this.detectPackageContext(),this.setupStoreSubscriptions(),this.setupQuantityListeners(),this.setupCurrencyChangeListener(),this.setupProfileEventListeners(),yield this.performInitialUpdate(),this.logger.debug(`ProductDisplayEnhancer initialized with package ${this.packageId}, path: ${this.displayPath}, format: ${this.formatType}, multiplyByQuantity: ${this.multiplyByQuantity}`)})}setupStoreSubscriptions(){var t;this.subscribe(dt,this.handleCampaignUpdate.bind(this)),this.subscribe(Tt,this.handleCartUpdate.bind(this)),this.subscribe(mt,t=>{this.logger.debug(`Profile store changed, active profile: ${t.activeProfileId}`),this.handleProfileUpdate()}),this.campaignState=dt.getState(),!this.campaignState.packages&&(null==(t=this.campaignState.data)?void 0:t.packages)&&(this.campaignState.packages=this.campaignState.data.packages),this.loadPackageData()}handleCampaignUpdate(t){var e;this.campaignState=t,!this.campaignState.packages&&(null==(e=t.data)?void 0:e.packages)&&(this.campaignState.packages=t.data.packages),this.loadPackageData(),this.updateDisplay()}handleCartUpdate(){this.updateDisplay()}setupCurrencyChangeListener(){super.setupCurrencyChangeListener(),document.addEventListener("next:currency-changed",()=>g(this,null,function*(){this.logger.debug("Currency changed, reloading package data"),this.campaignState=dt.getState(),this.loadPackageData(),yield this.updateDisplay()}))}handleProfileUpdate(){this.logger.debug(`Profile update detected for package ${this.packageId}`),this.loadPackageData(),this.updateDisplay(),this.logger.debug(`Display updated after profile change for package ${this.packageId}`)}setupProfileEventListeners(){this.eventBus.on("profile:applied",t=>{this.logger.debug(`Profile applied event received: ${t.profileId} for package ${this.packageId}`),this.handleProfileUpdate()}),this.eventBus.on("profile:reverted",t=>{this.logger.debug(`Profile reverted event received for package ${this.packageId}`),this.handleProfileUpdate()})}setupQuantityListeners(){if(this.multiplyByQuantity)if(this.eventBus.on("upsell:quantity-changed",t=>{if(this.quantitySelectorId&&t.selectorId===this.quantitySelectorId)this.currentQuantity=t.quantity,this.updateDisplay();else if(this.quantitySelectorId||t.selectorId){if(!this.quantitySelectorId){const e=this.element.closest("[data-next-selector-id]");e?e.getAttribute("data-next-selector-id")===t.selectorId&&(this.currentQuantity=t.quantity,this.updateDisplay()):t.packageId===this.packageId&&(this.currentQuantity=t.quantity,this.updateDisplay())}}else t.packageId===this.packageId&&(this.currentQuantity=t.quantity,this.updateDisplay())}),this.quantitySelectorId){const t=document.querySelector(`[data-next-upsell-quantity="display"][data-next-quantity-selector-id="${this.quantitySelectorId}"]`);if(t&&t.textContent){const e=parseInt(t.textContent,10);isNaN(e)||(this.currentQuantity=e)}}else{const t=this.element.closest('[data-next-upsell="offer"]');if(t){const e=t.querySelector('[data-next-upsell-quantity="display"]');if(e&&e.textContent){const t=parseInt(e.textContent,10);isNaN(t)||(this.currentQuantity=t)}}}}detectPackageContext(){const t=Zl.resolve(this.element);(null==t?void 0:t.packageId)?this.contextPackageId=t.packageId:this.contextPackageId=Hl.findPackageId(this.element);const e=ce.parseDisplayPath(this.displayPath);if("package"===e.object&&e.property.includes(".")){const t=e.property.split(".");t[0]&&!isNaN(Number(t[0]))&&(this.packageId=Number(t[0]),this.property=t.slice(1).join("."))}else this.contextPackageId&&(this.packageId=this.contextPackageId);this.packageId||this.logger.warn("No package context found - package ID required")}loadPackageData(){var t,e,i,n,r;if(!this.packageId||!this.campaignState)return;const s=(null==(t=this.campaignState.data)?void 0:t.packages)||this.campaignState.packages;this.originalPackageData=null==s?void 0:s.find(t=>t.ref_id===this.packageId);const a=mt.getState().getMappedPackageId(this.packageId),o=a!==this.packageId?a:this.packageId;if(a!==this.packageId&&this.logger.debug(`Profile mapping applied: ${this.packageId} -> ${a}`),this.packageData=null==s?void 0:s.find(t=>t.ref_id===o),!this.packageData&&a!==this.packageId){const t=dt.getState();(null==(e=t.data)?void 0:e.packages)&&(this.packageData=t.data.packages.find(t=>t.ref_id===o),this.packageData&&this.logger.debug(`Found package ${o} in full campaign data`))}if(this.packageData)a!==this.packageId?this.logger.debug(`Package prices - Original #${this.packageId}: retail=${null==(i=this.originalPackageData)?void 0:i.price_retail}, sale=${null==(n=this.originalPackageData)?void 0:n.price} | Mapped #${o}: retail=${this.packageData.price_retail}, sale=${this.packageData.price}`):this.logger.debug(`Package ${this.packageId} loaded with price: ${this.packageData.price} ${(null==(r=this.campaignState.data)?void 0:r.currency)||""}`);else{this.logger.warn(`Package ${o} not found in campaign data (original: ${this.packageId})`);const t=null==s?void 0:s.map(t=>t.ref_id).join(", ");this.logger.debug(`Available package IDs in campaign state: ${t}`),this.packageData=this.originalPackageData,this.originalPackageData&&this.logger.warn(`Falling back to original package ${this.packageId}`)}}getPropertyValue(){var t;if(!this.packageData||!this.property)return;if(null==(t=this.displayPath)?void 0:t.startsWith("campaign."))return this.getCampaignProperty(this.campaignState,this.property);const e=this.getCalculatedProperty(this.property);if(void 0!==e)return this.multiplyByQuantity&&"number"==typeof e?e*this.currentQuantity:e;const i=this.getPackageValue(this.packageData,this.property);if(this.multiplyByQuantity&&this.isPriceProperty(this.property)){const t=this.parseNumericValue(i);if(null!==t)return t*this.currentQuantity}return i}isPriceProperty(t){return["price","price_total","price_retail","price_retail_total","discountedPrice","discountedPriceTotal","finalPrice","finalPriceTotal","savingsAmount","discountAmount"].includes(t)}parseNumericValue(t){if("number"==typeof t)return t;if("string"==typeof t){const e=t.replace(/[^0-9.-]/g,""),i=parseFloat(e);return isNaN(i)?null:i}return null}updateElementContent(t){this.element instanceof HTMLInputElement||this.element instanceof HTMLTextAreaElement?this.element.value=t:this.element instanceof HTMLImageElement?(this.element.src=t,this.element.alt="Product image"):this.element.textContent=t}hideElement(){this.element.style.display="none",this.addClass("display-hidden"),this.removeClass("display-visible");const t=this.element.closest('[data-container="true"]');t&&(t.style.display="none")}showElement(){this.element.style.display="",this.addClass("display-visible"),this.removeClass("display-hidden");const t=this.element.closest('[data-container="true"]');t&&(t.style.display="")}update(t){t?this.handleCampaignUpdate(t):this.updateDisplay()}getCalculatedProperty(t){if(!this.packageData)return;const e={price:parseFloat(this.packageData.price||"0"),retailPrice:parseFloat(this.packageData.price_retail||"0"),quantity:this.packageData.qty||1,priceTotal:parseFloat(this.packageData.price_total||"0"),retailPriceTotal:parseFloat(this.packageData.price_retail_total||"0")},i=Jl.calculatePackageMetrics(e),n=Dl("package",t);if(n&&n.startsWith("_calculated."))switch(n.replace("_calculated.","")){case"savingsAmount":return i.totalSavings;case"savingsPercentage":return i.totalSavingsPercentage;case"hasSavings":return i.hasSavings;case"isBundle":return(this.packageData.qty||1)>1;case"discountedPrice":return this.calculateDiscountedPrice();case"discountedPriceTotal":return this.calculateDiscountedPriceTotal();case"discountAmount":return this.calculatePackageDiscountAmount();case"hasDiscount":return this.calculatePackageDiscountAmount()>0;case"finalPrice":return this.calculateFinalPrice();case"finalPriceTotal":return this.calculateFinalPriceTotal();case"totalSavingsAmount":case"totalSavingsWithDiscounts":return this.calculateTotalSavingsAmount();case"totalSavingsPercentage":case"totalSavingsPercentageWithDiscounts":return this.calculateTotalSavingsPercentage();case"hasTotalSavings":return this.calculateHasTotalSavings()}switch(t){case"savingsAmount":case"savingsAmount.raw":return i.totalSavings;case"savingsPercentage":if(this.originalPackageData&&this.packageData&&this.originalPackageData.ref_id!==this.packageData.ref_id){const t=this.calculateProfileAwareSavingsPercentage();return this.logger.debug(`Profile-aware savings percentage: ${t}% (was ${i.totalSavingsPercentage}%)`),t}return this.logger.debug(`Standard savings percentage: ${i.totalSavingsPercentage}%`),i.totalSavingsPercentage;case"unitPrice":return zl.formatCurrency(i.unitPrice);case"unitRetailPrice":return zl.formatCurrency(i.unitRetailPrice);case"unitSavings":return zl.formatCurrency(i.unitSavings);case"unitSavingsPercentage":return this.logger.warn("[PERCENTAGE DEBUG] ProductDisplayEnhancer returning unitSavingsPercentage:",{unitSavingsPercentage:i.unitSavingsPercentage,unitSavingsPercentageType:typeof i.unitSavingsPercentage}),i.unitSavingsPercentage;case"hasSavings":return i.hasSavings;case"hasRetailPrice":return i.unitRetailPrice>0&&i.unitRetailPrice!==i.unitPrice;case"isBundle":return(this.packageData.qty||1)>1;case"isRecurring":return!0===this.packageData.is_recurring;case"savingsPercentage.raw":return i.totalSavingsPercentage;case"unitPrice.raw":return i.unitPrice;case"unitRetailPrice.raw":return i.unitRetailPrice;case"discountedPrice":return this.calculateDiscountedPrice();case"discountedPriceTotal":return this.calculateDiscountedPriceTotal();case"discountAmount":return this.calculatePackageDiscountAmount();case"hasDiscount":return this.calculatePackageDiscountAmount()>0;case"finalPrice":return this.calculateFinalPrice();case"finalPriceTotal":return this.calculateFinalPriceTotal();case"totalSavingsAmount":case"totalSavingsWithDiscounts":return this.calculateTotalSavingsAmount();case"totalSavingsPercentage":case"totalSavingsPercentageWithDiscounts":return this.calculateTotalSavingsPercentage();case"hasTotalSavings":return this.calculateHasTotalSavings();case"totalSavingsAmount.raw":case"totalSavingsWithDiscounts.raw":return this.calculateTotalSavingsAmountRaw();case"totalSavingsPercentage.raw":case"totalSavingsPercentageWithDiscounts.raw":return this.calculateTotalSavingsPercentageRaw();default:return}}calculatePackageDiscountAmount(){if(!this.packageData)return 0;const t=Tt.getState(),e=t.appliedCoupons||[];let i=0;for(const n of e){const e=n.definition;if("package"===e.scope&&e.packageIds){if(!e.packageIds.includes(this.packageData.ref_id))continue}else if("package"===e.scope)continue;const r=parseFloat(this.packageData.price_total||"0")||parseFloat(this.packageData.price||"0")*(this.packageData.qty||1);if("percentage"===e.type){const t=r*(e.value/100);i+=e.maxDiscount?Math.min(t,e.maxDiscount):t}else if("fixed"===e.type&&"order"===e.scope){const n=t.subtotal;if(n>0){const t=r/n;i+=e.value*t}}}return Math.min(i,parseFloat(this.packageData.price_total||"0"))}calculateDiscountedPrice(){if(!this.packageData)return 0;const t=parseFloat(this.packageData.price||"0"),e=this.packageData.qty||1,i=this.calculatePackageDiscountAmount(),n=e>0?i/e:0;return Math.max(0,t-n)}calculateDiscountedPriceTotal(){if(!this.packageData)return 0;const t=parseFloat(this.packageData.price_total||"0")||parseFloat(this.packageData.price||"0")*(this.packageData.qty||1),e=this.calculatePackageDiscountAmount();return Math.max(0,t-e)}calculateFinalPrice(){return this.calculateDiscountedPrice()}calculateFinalPriceTotal(){return this.calculateDiscountedPriceTotal()}calculateTotalSavingsAmount(){if(!this.packageData)return 0;const t={price:parseFloat(this.packageData.price||"0"),retailPrice:parseFloat(this.packageData.price_retail||"0"),quantity:this.packageData.qty||1,priceTotal:parseFloat(this.packageData.price_total||"0"),retailPriceTotal:parseFloat(this.packageData.price_retail_total||"0")};return(Jl.calculatePackageMetrics(t).totalSavings||0)+this.calculatePackageDiscountAmount()}calculateTotalSavingsAmountRaw(){return this.calculateTotalSavingsAmount()}calculateTotalSavingsPercentage(){if(!this.packageData)return 0;const t=parseFloat(this.packageData.price_retail_total||"0")||parseFloat(this.packageData.price_total||"0");if(t<=0)return 0;const e=(t-this.calculateFinalPriceTotal())/t*100;return Math.min(100,Math.max(0,e))}calculateTotalSavingsPercentageRaw(){return this.calculateTotalSavingsPercentage()}calculateHasTotalSavings(){return!!this.packageData&&this.calculateTotalSavingsAmount()>0}calculateProfileAwareSavingsPercentage(){if(!this.originalPackageData||!this.packageData)return 0;const t=parseFloat(this.originalPackageData.price_retail_total||"0")||parseFloat(this.originalPackageData.price_retail||"0"),e=parseFloat(this.packageData.price_total||"0")||parseFloat(this.packageData.price||"0");if(t<=0)return this.logger.warn(`No retail price for original package ${this.originalPackageData.ref_id}`),0;const i=(t-e)/t*100;return this.logger.debug(`Profile-aware calculation for package ${this.originalPackageData.ref_id}â†’${this.packageData.ref_id}: Original retail: $${t}, Current sale: $${e}, Savings: ${i.toFixed(1)}% (rounded: ${Math.round(i)}%)`),Math.min(100,Math.max(0,Math.round(i)))}getPackageValue(t,e){const i=Dl("package",e);return i&&!i.startsWith("_calculated.")?ql.getNestedProperty(t,i):ql.getNestedProperty(t,e)}getCampaignProperty(t,e){const i=t.data;if(!i)return"";switch(e){case"name":return i.name;case"currency":return i.currency;case"language":return i.language;default:return this.logger.warn(`Unknown campaign property: ${e}`),""}}getPackageProperty(t){const e=this.property;this.property=t;const i=this.getPropertyValue();return this.property=e,i}setPackageContext(t){this.packageId=t,this.loadPackageData(),this.updateDisplay()}}},Symbol.toStringTag,{value:"Module"}));class Yl extends jl{constructor(){super(...arguments),this.orderState={}}initialize(){return g(this,null,function*(){yield this.checkAndLoadOrderFromUrl(),yield m(Yl.prototype,this,"initialize").call(this)})}setupStoreSubscriptions(){this.subscribe(Ot,this.handleOrderUpdate.bind(this)),this.orderState=Ot.getState()}getPropertyValue(){return this.getDisplayValue(this.orderState,this.displayPath)}update(t){t?this.handleOrderUpdate(t):super.update()}checkAndLoadOrderFromUrl(){return g(this,null,function*(){const t=new URLSearchParams(window.location.search),e=t.get("ref_id")||t.get("order_ref_id");if(e){const t=Ot.getState();if(!t.order&&!t.isLoading&&t.refId!==e)try{const i=yt.getState();this.apiClient=new re(i.apiKey),yield t.loadOrder(e,this.apiClient)}catch(i){this.logger.error("Failed to auto-load order:",i)}}})}handleOrderUpdate(t){try{this.orderState=t,t.isLoading?(this.addClass("next-loading"),this.removeClass("next-loaded"),this.removeClass("next-error")):t.error?(this.removeClass("next-loading"),this.removeClass("next-loaded"),this.addClass("next-error")):t.order&&(this.removeClass("next-loading"),this.addClass("next-loaded"),this.removeClass("next-error")),this.updateDisplay()}catch(e){this.handleError(e,"handleOrderUpdate"),this.updateElementContent("N/A"),this.addClass("next-error")}}updateElementContent(t){var e;"A"===this.element.tagName&&(null==(e=this.displayPath)?void 0:e.includes("statusUrl"))?(this.element.href=t,this.element.textContent||(this.element.textContent="View Order Status")):super.updateElementContent(t)}getDisplayValue(t,e){var i,n;const r=ce.parseDisplayPath(e).property;if(!r)return"";const s=r,a=t.order;if(!a)return t.isLoading?"Loading...":t.error?"Error":"";const o=Dl("order",s);if(o){if(o.startsWith("_calculated."))return this.getCalculatedProperty(a,o.substring(12));if(o.startsWith("order.")){const t=ql.getNestedProperty(a,o.substring(6));if(void 0!==t)return t}else{const e=ql.getNestedProperty(t,o);if(void 0!==e)return e}}const c=s.split(".");if(c.length>1&&c[0]&&!this.isComplexOrderProperty(c[0])){const t=ql.getNestedProperty(a,s);if(void 0!==t)return t}switch(c[0]){case"created_at":case"createdAt":const t=null==(n=null==(i=a.attribution)?void 0:i.metadata)?void 0:n.timestamp;return t?"raw"===c[1]?t:zl.formatDate(new Date(t)):"";case"testBadge":return a.is_test?"ðŸ§ª TEST ORDER":"";case"user":case"customer":return this.getOrderUserProperty(a,c.slice(1).join(".")||"");case"shippingAddress":return this.getOrderAddressProperty(a.shipping_address,c.slice(1).join(".")||"");case"billingAddress":return this.getOrderAddressProperty(a.billing_address,c.slice(1).join(".")||"");case"items":case"lines":return this.getOrderLinesProperty(a,c.slice(1).join(".")||"");case"attribution":return this.getOrderAttributionProperty(a.attribution,c.slice(1).join(".")||"");default:return this.logger.warn(`Unknown order property: ${s}`),""}}getOrderUserProperty(t,e){const i=t.user;if(!i)return"";switch(e){case"":case"name":return`${i.first_name||""} ${i.last_name||""}`.trim();case"email":return String(i.email||"");case"firstName":return String(i.first_name||"");case"lastName":return String(i.last_name||"");case"phone":return String(i.phone_number||"");case"acceptsMarketing":return i.accepts_marketing;case"language":return String(i.language||"");case"ip":return String(i.ip||"");default:return""}}getOrderAddressProperty(t,e){if(!t)return"";switch(e){case"":case"full":return this.formatAddress(t);case"name":return`${t.first_name||""} ${t.last_name||""}`.trim();case"line1":return String(t.line1||"");case"line2":return String(t.line2||"");case"city":return String(t.line4||"");case"state":return String(t.state||"");case"zip":case"postcode":return String(t.postcode||"");case"country":return String(t.country||"");case"phone":return String(t.phone_number||"");default:return""}}getOrderLinesProperty(t,e){var i,n;const r=t.lines||[];switch(e){case"count":return r.length;case"totalQuantity":return r.reduce((t,e)=>t+(e.quantity||0),0);case"upsellCount":return r.filter(t=>t.is_upsell).length;case"mainProduct":return(null==(i=r[0])?void 0:i.product_title)||"";case"mainProductSku":return(null==(n=r[0])?void 0:n.product_sku)||"";default:const t=e.match(/^\[(\d+)\]\.(.+)$/);if(t&&t[1]&&t[2]){const e=parseInt(t[1],10),i=t[2],n=r[e];if(n&&i)return this.getOrderLineProperty(n,i)}return""}}getOrderLineProperty(t,e){switch(e){case"title":case"product_title":return t.product_title||"";case"sku":case"product_sku":return t.product_sku||"";case"quantity":return t.quantity||0;case"price":return zl.formatCurrency(parseFloat(t.price_incl_tax||"0"));case"price.raw":return parseFloat(t.price_incl_tax||"0");case"priceExclTax":return zl.formatCurrency(parseFloat(t.price_excl_tax||"0"));case"priceExclTax.raw":return parseFloat(t.price_excl_tax||"0");case"priceExclTaxExclDiscounts":return zl.formatCurrency(parseFloat(t.price_excl_tax_excl_discounts||"0"));case"priceExclTaxExclDiscounts.raw":return parseFloat(t.price_excl_tax_excl_discounts||"0");case"priceInclTaxExclDiscounts":return zl.formatCurrency(parseFloat(t.price_incl_tax_excl_discounts||"0"));case"priceInclTaxExclDiscounts.raw":return parseFloat(t.price_incl_tax_excl_discounts||"0");case"total":return zl.formatCurrency(parseFloat(t.price_incl_tax||"0")*(t.quantity||1));case"total.raw":return parseFloat(t.price_incl_tax||"0")*(t.quantity||1);case"totalExclTax":return zl.formatCurrency(parseFloat(t.price_excl_tax||"0")*(t.quantity||1));case"totalExclTax.raw":return parseFloat(t.price_excl_tax||"0")*(t.quantity||1);case"isUpsell":return t.is_upsell||!1;case"image":return t.image||"";default:return""}}getOrderAttributionProperty(t,e){if(!t)return"";switch(e){case"source":case"utm_source":return t.utm_source||"";case"medium":case"utm_medium":return t.utm_medium||"";case"campaign":case"utm_campaign":return t.utm_campaign||"";case"term":case"utm_term":return t.utm_term||"";case"content":case"utm_content":return t.utm_content||"";case"gclid":return t.gclid||"";case"funnel":return t.funnel||"";case"affiliate":return t.affiliate||"";case"hasTracking":return!!(t.utm_source||t.utm_medium||t.gclid);default:return""}}formatAddress(t){return t?[t.line1,t.line2,t.line4,t.state,t.postcode,t.country].filter(Boolean).map(t=>String(t)).join(", "):""}isComplexOrderProperty(t){return["user","customer","total","subtotal","tax","shipping","discounts","shippingAddress","billingAddress","items","lines","attribution","created_at"].includes(t)}getCalculatedProperty(t,e){var i,n,r,s,a,o,c,l;switch(e){case"subtotal":case"subtotalExclShipping":return t.lines&&t.lines.length>0?t.lines.reduce((t,e)=>t+parseFloat(e.price_excl_tax||"0"),0):parseFloat(t.total_excl_tax||"0")-parseFloat(t.shipping_excl_tax||"0");case"savings":case"savingsAmount":if(t.lines&&t.lines.length>0){const e=t.lines.reduce((t,e)=>t+parseFloat(e.price_incl_tax_excl_discounts||e.price_incl_tax||"0")*e.quantity,0),i=parseFloat(t.total_incl_tax||"0");return Math.max(0,e-i)}return parseFloat(t.total_discounts||"0");case"savingsPercentage":if(t.lines&&t.lines.length>0){const e=t.lines.reduce((t,e)=>t+parseFloat(e.price_incl_tax_excl_discounts||e.price_incl_tax||"0")*e.quantity,0),i=parseFloat(t.total_incl_tax||"0");if(e>0&&e>i)return(e-i)/e*100}return 0;case"hasSavings":return parseFloat(t.total_discounts||"0")>0||!!(t.lines&&t.lines.length>0)&&t.lines.some(t=>parseFloat(t.price_incl_tax_excl_discounts||"0")>parseFloat(t.price_incl_tax||"0"));case"hasItems":return t.lines&&t.lines.length>0;case"isEmpty":return!t.lines||0===t.lines.length;case"hasShipping":return parseFloat(t.shipping_incl_tax||"0")>0;case"hasTax":return parseFloat(t.total_tax||"0")>0;case"hasDiscounts":return parseFloat(t.total_discounts||"0")>0;case"hasUpsells":return(null==(i=t.lines)?void 0:i.some(t=>t.is_upsell))||!1;case"lines.count":return(null==(n=t.lines)?void 0:n.length)||0;case"lines.totalQuantity":return(null==(r=t.lines)?void 0:r.reduce((t,e)=>t+(e.quantity||0),0))||0;case"lines.upsellCount":return(null==(s=t.lines)?void 0:s.filter(t=>t.is_upsell).length)||0;case"lines.mainProduct":return(null==(o=null==(a=t.lines)?void 0:a[0])?void 0:o.product_title)||"";case"lines.mainProductSku":return(null==(l=null==(c=t.lines)?void 0:c[0])?void 0:l.product_sku)||"";default:return}}}const Xl=Object.freeze(Object.defineProperty({__proto__:null,OrderDisplayEnhancer:Yl},Symbol.toStringTag,{value:"Module"})),td=Object.freeze(Object.defineProperty({__proto__:null,ShippingDisplayEnhancer:class extends jl{initialize(){return g(this,null,function*(){this.validateElement(),this.parseDisplayAttributes(),this.detectShippingContext(),this.shippingId?(this.setupStoreSubscriptions(),yield this.performInitialUpdate(),this.logger.debug(`ShippingDisplayEnhancer initialized with shipping ID ${this.shippingId}`)):this.logger.warn("ShippingDisplayEnhancer requires data-next-shipping-id context")})}setupStoreSubscriptions(){this.subscribe(dt,this.handleCampaignUpdate.bind(this)),this.loadShippingMethod()}handleCampaignUpdate(){this.loadShippingMethod(),this.updateDisplay()}detectShippingContext(){const t=this.element.closest("[data-next-shipping-id]");if(!t)return;const e=t.getAttribute("data-next-shipping-id");e&&(this.shippingId=parseInt(e,10))}loadShippingMethod(){var t;if(!this.shippingId)return;const e=((null==(t=dt.getState().data)?void 0:t.shipping_methods)||[]).find(t=>t.ref_id===this.shippingId);e&&(this.shippingMethod=e),this.shippingMethod||this.logger.warn(`Shipping method ${this.shippingId} not found in campaign data`)}getPropertyValue(){if(!this.shippingMethod||!this.property)return;const t=Dl("shipping",this.property);if(t&&t.startsWith("_calculated.")){const e=t.replace("_calculated.","");return this.getCalculatedProperty(e)}switch(this.property){case"isFree":return 0===parseFloat(this.shippingMethod.price||"0");case"cost":case"price":return zl.formatValue(parseFloat(this.shippingMethod.price||"0"),"currency");case"cost.raw":case"price.raw":return parseFloat(this.shippingMethod.price||"0");case"name":case"code":return this.shippingMethod.code;case"id":case"refId":return this.shippingMethod.ref_id;case"method":return this.shippingMethod;default:return}}getCalculatedProperty(t){if(this.shippingMethod)switch(t){case"isFree":return 0===parseFloat(this.shippingMethod.price||"0");case"cost":case"price":return zl.formatValue(parseFloat(this.shippingMethod.price||"0"),"currency");case"name":case"code":return this.shippingMethod.code;case"id":case"refId":return this.shippingMethod.ref_id;case"method":return this.shippingMethod;default:return}}update(){this.updateDisplay()}}},Symbol.toStringTag,{value:"Module"})),ed=new Set;"undefined"!=typeof window&&window.addEventListener("beforeunload",()=>{ed.clear()});const id=Object.freeze(Object.defineProperty({__proto__:null,CartToggleEnhancer:class extends be{constructor(){super(...arguments),this.quantity=1,this.syncPackageIds=[],this.isSyncMode=!1,this.isUpsell=!1,this.isInitialized=!1,this.isAutoAdding=!1}initialize(){return g(this,null,function*(){if(this.validateElement(),this.isInitialized)this.logger.warn("CartToggleEnhancer already initialized, skipping");else if(this.element.hasAttribute("data-toggle-initializing"))this.logger.warn("CartToggleEnhancer initialization already in progress, skipping");else{if(this.element.setAttribute("data-toggle-initializing","true"),!this.hasAttribute("data-next-toggle"))throw this.element.removeAttribute("data-toggle-initializing"),new Error("data-next-toggle attribute is required");this.findStateContainer(),this.resolvePackageIdentifier(),this.checkSyncMode(),this.isSyncMode||this.setQuantity(),this.detectUpsellContext(),this.setupEventListeners(),this.updateState(Tt.getState()),yield this.checkAutoAdd(),this.isInitialized=!0,this.element.removeAttribute("data-toggle-initializing"),this.element.setAttribute("data-toggle-initialized","true"),this.logger.debug("Toggle initialized:",{packageId:this.packageId,quantity:this.quantity,isSyncMode:this.isSyncMode,syncPackageIds:this.syncPackageIds,isUpsell:this.isUpsell})}})}findStateContainer(){let t=this.element;for(;t&&t!==document.body;){if(t.hasAttribute("data-next-toggle-container")||t.hasAttribute("data-next-bump")||t.hasAttribute("data-next-upsell-item")||t.classList.contains("upsell")||t.classList.contains("bump")){this.stateContainer=t;break}if(t.hasAttribute("data-next-package-id")||t.hasAttribute("data-package-id")){this.stateContainer=t;break}t=t.parentElement}this.stateContainer||(this.stateContainer=this.element)}resolvePackageIdentifier(){const t=this.getAttribute("data-next-package-id")||this.getAttribute("data-package-id");if(!t){if(this.stateContainer&&this.stateContainer!==this.element){const t=this.stateContainer.getAttribute("data-next-package-id")||this.stateContainer.getAttribute("data-package-id");if(t)return void(this.packageId=parseInt(t,10))}throw new Error("Package identifier required: data-next-package-id")}this.packageId=parseInt(t,10)}checkSyncMode(){var t,e;const i=this.getAttribute("data-next-package-sync")||(null==(t=this.stateContainer)?void 0:t.getAttribute("data-next-package-sync")),n=this.getAttribute("data-next-qty-sync")||(null==(e=this.stateContainer)?void 0:e.getAttribute("data-next-qty-sync"));if(i)this.syncPackageIds=i.split(",").map(t=>parseInt(t.trim(),10)).filter(t=>!isNaN(t)),this.syncPackageIds.length>0&&(this.isSyncMode=!0,this.quantity=0);else if(n){const t=parseInt(n,10);isNaN(t)||(this.syncPackageIds=[t],this.isSyncMode=!0,this.quantity=0)}}setQuantity(){var t;const e=this.getAttribute("data-next-quantity")||this.getAttribute("data-quantity")||(null==(t=this.stateContainer)?void 0:t.getAttribute("data-next-quantity"));this.quantity=e?parseInt(e,10):1}detectUpsellContext(){var t,e;this.isUpsell="true"===this.getAttribute("data-next-is-upsell")||(null==(t=this.stateContainer)?void 0:t.hasAttribute("data-next-upsell"))||(null==(e=this.stateContainer)?void 0:e.hasAttribute("data-next-bump"))||null!==this.element.closest("[data-next-upsell-section]")||null!==this.element.closest("[data-next-bump-section]")}checkAutoAdd(){return g(this,null,function*(){var t;if(("true"===this.getAttribute("data-next-selected")||"true"===(null==(t=this.stateContainer)?void 0:t.getAttribute("data-next-selected")))&&this.packageId){if(ed.has(this.packageId))return void this.logger.debug("Package already auto-added by another element, skipping:",{packageId:this.packageId});if(this.isAutoAdding)return void this.logger.debug("Auto-add already in progress, skipping");const t=Tt.getState();if(!this.isInCart(t)){ed.add(this.packageId),this.logger.debug("Auto-adding item on page load:",{packageId:this.packageId,quantity:this.quantity}),this.isAutoAdding=!0;try{this.isSyncMode&&this.updateSyncedQuantity(t),yield this.addToCart()}catch(e){this.logger.error("Failed to auto-add item:",e),ed.delete(this.packageId)}finally{this.isAutoAdding=!1}}}})}setupEventListeners(){this.clickHandler=this.handleClick.bind(this),this.element.addEventListener("click",this.clickHandler),this.subscribe(Tt,t=>this.updateState(t))}handleClick(t){return g(this,null,function*(){t.preventDefault();try{this.setLoadingState(!0);const t=Tt.getState();this.isSyncMode&&this.updateSyncedQuantity(t);const e=this.isInCart(t);this.logger.debug("Toggle click:",{packageId:this.packageId,isInCart:e,quantity:this.quantity,isSyncMode:this.isSyncMode}),e?yield this.removeFromCart():yield this.addToCart()}catch(e){this.handleError(e,"handleClick")}finally{this.setLoadingState(!1)}})}addToCart(){return g(this,null,function*(){const t=Tt.getState();if(this.logger.debug("Adding to cart:",{packageId:this.packageId,quantity:this.quantity}),this.packageId){let i=`Package ${this.packageId}`,n=0;try{const t=dt.getState().getPackage(this.packageId);t?(i=t.name,n=parseFloat(t.price),this.logger.debug("Found package data:",{title:i,price:n})):this.logger.debug("Package not found in campaign store")}catch(e){this.logger.debug("Error getting package data:",e)}yield t.addItem({packageId:this.packageId,quantity:this.quantity,title:i,price:n,isUpsell:this.isUpsell}),this.logger.debug("Added to cart successfully")}})}removeFromCart(){return g(this,null,function*(){const t=Tt.getState();this.packageId&&(yield t.removeItem(this.packageId))})}updateState(t){const e=this.isInCart(t);this.stateContainer&&(this.stateContainer.setAttribute("data-in-cart",String(e)),this.stateContainer.setAttribute("data-next-active",String(e)),this.stateContainer.classList.toggle("next-in-cart",e),this.stateContainer.classList.toggle("next-not-in-cart",!e),this.stateContainer.classList.toggle("next-active",e),this.stateContainer.classList.toggle("os--active",e)),this.setAttribute("data-in-cart",String(e)),this.setAttribute("data-next-active",String(e)),this.toggleClass("next-in-cart",e),this.toggleClass("next-not-in-cart",!e),this.toggleClass("next-active",e);const i=this.getAttribute("data-add-text"),n=this.getAttribute("data-remove-text");i&&n&&this.updateTextContent(e?n:i),this.isSyncMode&&this.syncPackageIds.length>0&&this.handleSyncUpdate(t)}updateSyncedQuantity(t){if(0===this.syncPackageIds.length)return;let e=0;this.syncPackageIds.forEach(i=>{const n=t.items.find(t=>t.packageId===i||t.originalPackageId===i);if(n){const t=n.qty||1,r=n.quantity*t;e+=r,this.logger.debug(`Sync package ${i}: ${n.quantity} packages Ã— ${t} items/package = ${r} total`)}}),this.quantity=e,this.logger.debug(`Total sync quantity: ${this.quantity} (from packages: ${this.syncPackageIds.join(", ")})`)}handleSyncUpdate(t){return g(this,null,function*(){if(!this.packageId||0===this.syncPackageIds.length)return;let e=0,i=!1;this.syncPackageIds.forEach(n=>{const r=t.items.find(t=>t.packageId===n||t.originalPackageId===n);if(r){i=!0;const t=r.qty||1;e+=r.quantity*t}});const n=t.items.find(t=>t.packageId===this.packageId);i&&e>0?n&&n.quantity!==e&&(this.logger.debug(`Auto-sync: Updating quantity to ${e}`),yield Tt.getState().updateQuantity(this.packageId,e)):n&&!t.swapInProgress?n.is_upsell?(this.logger.debug("Auto-sync: Upsell item detected, delaying removal check"),setTimeout(()=>g(this,null,function*(){const t=Tt.getState();let e=!0;this.syncPackageIds.forEach(i=>{t.items.find(t=>t.packageId===i||t.originalPackageId===i)&&(e=!1)});const i=t.items.find(t=>t.packageId===this.packageId);e&&i&&!t.swapInProgress?(this.logger.debug("Auto-sync: After delay, still no synced packages - removing upsell"),yield this.removeFromCart()):this.logger.debug("Auto-sync: After delay, conditions changed - keeping upsell")}),500)):(this.logger.debug("Auto-sync: No synced packages found and not swapping - removing item"),yield this.removeFromCart()):n&&t.swapInProgress&&this.logger.debug("Auto-sync: Swap in progress - keeping item for now")})}isInCart(t){return!!this.packageId&&t.items.some(t=>t.packageId===this.packageId)}setLoadingState(t){t?(this.addClass("next-loading"),this.setAttribute("disabled","true")):(this.removeClass("next-loading"),this.removeAttribute("disabled"))}update(){this.updateState(Tt.getState())}cleanupEventListeners(){this.clickHandler&&this.element.removeEventListener("click",this.clickHandler)}}},Symbol.toStringTag,{value:"Module"}));class nd extends be{constructor(){super(...arguments),this.isProcessing=!1}executeAction(t,e){return g(this,null,function*(){if(this.isProcessing)return Promise.reject(new Error("Already processing"));this.isProcessing=!0,(null==e?void 0:e.showLoading)&&this.setLoadingState(!0),(null==e?void 0:e.disableOnProcess)&&this.element.setAttribute("disabled","true");try{const e=yield t();return this.emit("action:success",{action:this.constructor.name,data:{element:this.element}}),e}catch(i){throw this.handleError(i,"executeAction"),this.emit("action:failed",{action:this.constructor.name,error:i instanceof Error?i:new Error(String(i))}),i}finally{this.isProcessing=!1,(null==e?void 0:e.showLoading)&&this.setLoadingState(!1),(null==e?void 0:e.disableOnProcess)&&this.element.removeAttribute("disabled")}})}setLoadingState(t){this.toggleClass("loading",t),this.toggleClass("next-loading",t),this.setAttribute("aria-busy",t.toString()),(this.element instanceof HTMLButtonElement||this.element instanceof HTMLInputElement||this.element instanceof HTMLSelectElement)&&(this.element.disabled=t)}isActionProcessing(){return this.isProcessing}setLoadingContent(t){null!==t?this.setAttribute("data-loading-text",t):this.removeAttribute("data-loading-text")}debounceAction(t,e){let i;return(...n)=>(clearTimeout(i),new Promise((r,s)=>{i=setTimeout(()=>{try{const e=t(...n);e instanceof Promise?e.then(r).catch(s):r(e)}catch(e){s(e)}},e)}))}throttleAction(t,e){let i,n;return(...r)=>(i||(i=!0,setTimeout(()=>{i=!1},e),n=t(...r)),n)}}function rd(t,e=["debug","debugger"]){try{const i=new URL(t,window.location.origin),n=new URLSearchParams(window.location.search);return e.forEach(t=>{const e=n.get(t);e&&!i.searchParams.has(t)&&i.searchParams.append(t,e)}),"true"!==n.get("debug")||i.searchParams.has("debug")||i.searchParams.append("debug","true"),"true"!==n.get("debugger")||i.searchParams.has("debugger")||i.searchParams.append("debugger","true"),i.href}catch(i){return t}}const sd=Object.freeze(Object.defineProperty({__proto__:null,AddToCartEnhancer:class extends nd{constructor(){super(...arguments),this.quantity=1,this.clearCart=!1}initialize(){return g(this,null,function*(){this.validateElement();const t=this.getAttribute("data-next-package-id");t&&(this.packageId=parseInt(t,10));const e=this.getAttribute("data-next-quantity");this.quantity=e?parseInt(e,10):1;const i=this.getAttribute("data-next-selector-id");i&&(this.selectorId=i);const n=this.getAttribute("data-next-url");n&&(this.redirectUrl=n);const r=this.getAttribute("data-next-clear-cart");this.clearCart="true"===r,this.clickHandler=this.handleClick.bind(this),this.element.addEventListener("click",this.clickHandler),this.selectorId&&this.setupSelectorListener(),this.updateButtonState(),this.logger.debug("AddToCartEnhancer initialized",{packageId:this.packageId,selectorId:this.selectorId,quantity:this.quantity,redirectUrl:this.redirectUrl,clearCart:this.clearCart})})}setupSelectorListener(){setTimeout(()=>{const t=this.findSelectorElement();t?(this.selectedItem=this.getSelectedItemFromElement(t),this.updateButtonState()):this.logger.warn(`Selector with id "${this.selectorId}" not found. Button may not work properly.`)},100),this.eventBus.on("selector:item-selected",this.handleSelectorChange.bind(this)),this.eventBus.on("selector:selection-changed",this.handleSelectorChange.bind(this))}findSelectorElement(){return document.querySelector(`[data-next-cart-selector][data-next-selector-id="${this.selectorId}"], [data-next-package-selector][data-next-selector-id="${this.selectorId}"]`)}getSelectedItemFromElement(t){const e=t.Lt;if("function"==typeof e)return e();const i=t.Dt;if(i)return i;const n=t.getAttribute("data-selected-package");if(n){const t=parseInt(n,10);if(!isNaN(t))return{packageId:t,quantity:1,element:null,price:void 0,name:void 0,isPreSelected:!1,shippingId:void 0}}return null}handleSelectorChange(t){if(t.selectorId!==this.selectorId)return;const e=this.findSelectorElement();e?this.selectedItem=this.getSelectedItemFromElement(e):t.item?this.selectedItem=t.item:t.packageId?this.selectedItem={packageId:t.packageId,quantity:t.quantity||1,element:null,price:void 0,name:void 0,isPreSelected:!1,shippingId:void 0}:this.selectedItem=null,this.updateButtonState()}updateButtonState(){if(this.selectorId){const t=null!==this.selectedItem;this.setEnabled(t)}else this.packageId&&this.setEnabled(!0)}setEnabled(t){t?(this.element.removeAttribute("disabled"),this.removeClass("next-disabled")):(this.element.setAttribute("disabled","true"),this.addClass("next-disabled"))}handleClick(t){return g(this,null,function*(){t.preventDefault();const e=this.getAttribute("data-next-profile");if(e){const{ProfileManager:t}=yield Promise.resolve().then(()=>ve),i=t.getInstance();yield i.applyProfile(e)}yield this.executeAction(()=>g(this,null,function*(){yield this.addToCart()}),{showLoading:!0,disableOnProcess:!0})})}addToCart(){return g(this,null,function*(){const t=Tt.getState();let e,i=this.quantity;if(this.selectorId&&this.selectedItem?(e=this.selectedItem.packageId,i=this.selectedItem.quantity||this.quantity):this.packageId&&(e=this.packageId),e)try{if(this.clearCart&&(this.logger.debug("Clearing cart before adding item"),yield t.clear()),yield t.addItem({packageId:e,quantity:i,isUpsell:void 0}),this.updateButtonState(),this.eventBus.emit("cart:item-added",{packageId:e,quantity:i,source:this.selectorId?"selector":"direct"}),this.redirectUrl){const t=rd(this.redirectUrl);this.logger.debug("Redirecting to:",t),window.location.href=t}}catch(n){throw this.logger.error("Failed to add item to cart:",n),n}else this.logger.warn("No package ID available for add-to-cart action")})}update(t){}destroy(){this.clickHandler&&this.element.removeEventListener("click",this.clickHandler),this.selectorId&&(this.eventBus.off("selector:item-selected",this.handleSelectorChange.bind(this)),this.eventBus.off("selector:selection-changed",this.handleSelectorChange.bind(this))),super.destroy()}}},Symbol.toStringTag,{value:"Module"}));class ad{constructor(t){this.options=u({backdropDismiss:!0},t)}show(){return g(this,null,function*(){return new Promise(t=>{this.resolve=t,this.createModal()})})}createModal(){this.backdrop=document.createElement("div"),this.backdrop.className="next-modal-backdrop "+(this.options.className?this.options.className+"-backdrop":""),this.backdrop.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background-color: rgba(0, 0, 0, 0.5);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 10000;\n      animation: fadeIn 0.2s ease-out;\n    ",this.modal=document.createElement("div"),this.modal.className=`next-modal ${this.options.className||""}`,this.modal.style.cssText="\n      background: white;\n      border-radius: 8px;\n      padding: 0;\n      max-width: 500px;\n      width: 90%;\n      max-height: 90vh;\n      overflow: hidden;\n      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);\n      animation: slideIn 0.3s ease-out;\n    ";const t=this.options.buttons.map((t,e)=>{const i=this.getDefaultButtonStyles(t.action),n=t.style||i,r=t.className||`next-modal-${t.action}`;return t.href?`<a \n          href="${t.href}" \n          target="${t.target||"_self"}"\n          class="${r}" \n          data-action="${t.action}"\n          data-index="${e}"\n          style="${n}"\n        >${t.text}</a>`:`<button \n        class="${r}" \n        data-action="${t.action}"\n        data-index="${e}"\n        style="${n}"\n      >${t.text}</button>`}).join("");this.modal.innerHTML=`\n      <div class="next-modal-header" style="padding: 20px 24px; border-bottom: 1px solid #e2e8f0; display: flex; align-items: center; justify-content: space-between;">\n        <h3 style="margin: 0; font-size: 20px; font-weight: 600; color: #1a202c;">\n          ${this.options.title}\n        </h3>\n        <button class="next-modal-close" data-action="cancel" style="\n          background: none;\n          border: none;\n          font-size: 24px;\n          color: #718096;\n          cursor: pointer;\n          padding: 0;\n          width: 32px;\n          height: 32px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          border-radius: 4px;\n          transition: all 0.2s;\n        ">&times;</button>\n      </div>\n      <div class="next-modal-body" style="padding: 24px; max-height: 60vh; overflow-y: auto;">\n        <div style="color: #4a5568; line-height: 1.6;">\n          ${this.options.content}\n        </div>\n      </div>\n      <div class="next-modal-footer" style="padding: 16px 24px; border-top: 1px solid #e2e8f0; display: flex; gap: 12px; justify-content: flex-end;">\n        ${t}\n      </div>\n    `,this.style=document.createElement("style"),this.style.textContent="\n      @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n      }\n      @keyframes slideIn {\n        from { \n          opacity: 0;\n          transform: translateY(-20px);\n        }\n        to { \n          opacity: 1;\n          transform: translateY(0);\n        }\n      }\n      .next-modal-close:hover {\n        background: #f7fafc !important;\n      }\n      .next-modal-cancel:hover {\n        border-color: #cbd5e0 !important;\n        background: #f7fafc !important;\n      }\n      .next-modal-confirm:hover {\n        background: var(--brand--color--primary, #3182ce) !important;\n        filter: brightness(0.9);\n      }\n      .next-modal a {\n        text-decoration: none;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n      }\n    ",document.head.appendChild(this.style),this.backdrop.appendChild(this.modal),document.body.appendChild(this.backdrop),this.modal.querySelectorAll("[data-action]").forEach(t=>{"A"!==t.tagName?t.addEventListener("click",t=>this.handleAction(t)):t.addEventListener("click",t=>{const e=t.currentTarget.getAttribute("data-action")||"custom",i=this.resolve;this.cleanup(),i&&i(e)})}),this.options.backdropDismiss&&this.backdrop.addEventListener("click",t=>{t.target===this.backdrop&&this.handleDismiss()}),this.handleEscapeKey=this.handleEscapeKey.bind(this),document.addEventListener("keydown",this.handleEscapeKey)}getDefaultButtonStyles(t){return"confirm"===t?"\n          padding: 10px 20px;\n          border: none;\n          background: var(--brand--color--primary, #3182ce);\n          color: white;\n          border-radius: 6px;\n          font-size: 16px;\n          cursor: pointer;\n          font-weight: 500;\n          transition: all 0.2s;\n        ":"\n          padding: 10px 20px;\n          border: 1px solid #e2e8f0;\n          background: white;\n          border-radius: 6px;\n          font-size: 16px;\n          cursor: pointer;\n          color: #4a5568;\n          transition: all 0.2s;\n        "}handleEscapeKey(t){"Escape"===t.key&&this.options.backdropDismiss&&this.handleDismiss()}handleAction(t){const e=t.currentTarget.getAttribute("data-action")||"custom",i=this.resolve;this.cleanup(),i&&i(e)}handleDismiss(){const t=this.resolve;this.cleanup(),t&&t("backdrop")}cleanup(){this.backdrop&&this.backdrop.remove(),this.style&&this.style.remove(),document.removeEventListener("keydown",this.handleEscapeKey),this.backdrop=void 0,this.modal=void 0,this.style=void 0,this.resolve=void 0}static show(t){return g(this,null,function*(){return new ad(t).show()})}static showDuplicateUpsell(){return g(this,null,function*(){return"cancel"===(yield ad.show({title:"Already Added!",content:"You've already added this item to your order. Would you like to add it again?",buttons:[{text:"Yes, Add Again",action:"cancel"},{text:"Skip to Next",action:"confirm"}]}))})}static showRecentPurchaseWarning(){return g(this,null,function*(){return yield ad.show({title:"Attention",content:"Your initial order has been successfully processed. Please check your email for the order confirmation. Entering your payment details again will result in a secondary purchase.",buttons:[{text:"Close",action:"cancel"},{text:"Back",action:"confirm"}]})})}}class od{constructor(){this.overlay=null,this.showTime=0}show(){this.overlay||(this.showTime=Date.now(),this.overlay=document.createElement("div"),this.overlay.className="next-loading-overlay",this.overlay.innerHTML='\n      <style>\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n        .next-loading-spinner .spinner {\n          width: 30px;\n          height: 30px;\n          border: 3px solid rgba(0, 0, 0, 0.1);\n          border-top-color: var(--brand--color--primary, #000);\n          border-radius: 50%;\n          animation: spin 1s linear infinite;\n        }\n      </style>\n      <div class="next-loading-spinner">\n        <div class="spinner"></div>\n      </div>\n    ',Object.assign(this.overlay.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.9)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999"}),document.body.appendChild(this.overlay))}hide(t=!1){if(this.overlay)if(t)document.body.removeChild(this.overlay),this.overlay=null;else{const t=Date.now()-this.showTime,e=Math.max(0,3e3-t);setTimeout(()=>{this.overlay&&(document.body.removeChild(this.overlay),this.overlay=null)},e)}}}const cd=Object.freeze(Object.defineProperty({__proto__:null,AcceptUpsellEnhancer:class extends nd{constructor(t){super(t),this.quantity=1,this.loadingOverlay=new od}initialize(){return g(this,null,function*(){this.validateElement(),this.pageShowHandler=t=>{t.persisted&&(this.loadingOverlay.hide(!0),this.setEnabled(!0))},window.addEventListener("pageshow",this.pageShowHandler);const t=this.getAttribute("data-next-package-id");t&&(this.packageId=parseInt(t,10));const e=this.getAttribute("data-next-quantity");this.quantity=e?parseInt(e,10):1;const i=this.getAttribute("data-next-selector-id");i&&(this.selectorId=i);const n=this.getAttribute("data-next-url");n&&(this.nextUrl=n);const r=yt.getState();this.apiClient=new re(r.apiKey),this.clickHandler=this.handleClick.bind(this),this.element.addEventListener("click",this.clickHandler),this.selectorId&&this.setupSelectorListener(),this.subscribe(Ot,()=>this.updateButtonState()),this.updateButtonState(),this.logger.debug("AcceptUpsellEnhancer initialized",{packageId:this.packageId,selectorId:this.selectorId,quantity:this.quantity,nextUrl:this.nextUrl})})}setupSelectorListener(){setTimeout(()=>{const t=this.findSelectorElement();t?(this.selectedItem=this.getSelectedItemFromElement(t),this.updateButtonState()):this.logger.warn(`Selector with id "${this.selectorId}" not found. Button may not work properly.`)},100),this.eventBus.on("upsell-selector:item-selected",this.handleSelectorChange.bind(this)),this.eventBus.on("selector:item-selected",this.handleSelectorChange.bind(this)),this.eventBus.on("selector:selection-changed",this.handleSelectorChange.bind(this))}findSelectorElement(){return document.querySelector(`[data-next-upsell-selector][data-next-selector-id="${this.selectorId}"], [data-next-upsell-select="${this.selectorId}"], [data-next-upsell][data-next-selector-id="${this.selectorId}"]`)}getSelectedItemFromElement(t){const e=t.Ft;if("function"==typeof e){const t=e();if(t)return{packageId:t,quantity:1,element:null,price:void 0,name:void 0,isPreSelected:!1,shippingId:void 0}}const i=t.Ot;return i?{packageId:i,quantity:1,element:null,price:void 0,name:void 0,isPreSelected:!1,shippingId:void 0}:null}handleSelectorChange(t){if(t.selectorId!==this.selectorId)return;const e=this.findSelectorElement();e?this.selectedItem=this.getSelectedItemFromElement(e):t.packageId?this.selectedItem={packageId:t.packageId,quantity:t.quantity||1,element:null,price:void 0,name:void 0,isPreSelected:!1,shippingId:void 0}:this.selectedItem=null,this.updateButtonState()}updateButtonState(){const t=Ot.getState().canAddUpsells(),e=!(!this.packageId&&!this.selectedItem);this.setEnabled(t&&e)}setEnabled(t){t?(this.element.removeAttribute("disabled"),this.removeClass("next-disabled")):(this.element.setAttribute("disabled","true"),this.addClass("next-disabled"))}handleClick(t){return g(this,null,function*(){t.preventDefault(),yield this.executeAction(()=>g(this,null,function*(){yield this.acceptUpsell()}),{showLoading:!1,disableOnProcess:!0})})}triggerAcceptUpsell(){return g(this,null,function*(){yield this.executeAction(()=>g(this,null,function*(){yield this.acceptUpsell()}),{showLoading:!1,disableOnProcess:!0})})}getCurrency(){var t;const e=dt.getState();if(null==(t=null==e?void 0:e.data)?void 0:t.currency)return e.data.currency;const i=yt.getState();return(null==i?void 0:i.selectedCurrency)||(null==i?void 0:i.detectedCurrency)||"USD"}acceptUpsell(){return g(this,null,function*(){var t,e;const i=Ot.getState();let n,r=this.quantity;if(this.selectorId&&this.selectedItem?(n=this.selectedItem.packageId,r=this.selectedItem.quantity||this.quantity):this.packageId&&(n=this.packageId),n)if(i.order&&this.apiClient){if(this.checkIfUpsellAlreadyAccepted(n)&&!(yield this.showDuplicateUpsellDialog())){let t=this.nextUrl;if(!t){const e=document.querySelector('meta[name="next-upsell-decline-url"]');t=(null==e?void 0:e.getAttribute("content"))||void 0,t&&this.logger.debug("Using fallback decline URL from meta tag:",t)}if(t){const e=rd(t);window.location.href=e}return}try{this.loadingOverlay.show();const s={lines:[{package_id:n,quantity:r}],currency:this.getCurrency()},a=(null==(t=i.order.lines)?void 0:t.map(t=>t.id))||[],o=yield i.addUpsell(s,this.apiClient);if(!o)throw new Error("Failed to add upsell");const c=null==(e=o.lines)?void 0:e.find(t=>t.is_upsell&&!a.includes(t.id)),l=(null==c?void 0:c.price_incl_tax)?parseFloat(c.price_incl_tax):0;this.eventBus.emit("upsell:accepted",{packageId:n,quantity:r,orderId:i.order.ref_id,value:l});let d=this.nextUrl;if(!d){const t=document.querySelector('meta[name="next-upsell-accept-url"]');d=(null==t?void 0:t.getAttribute("content"))||void 0,d&&this.logger.debug("Using fallback accept URL from meta tag:",d)}if(d){const t=rd(d);window.location.href=t}else this.loadingOverlay.hide()}catch(s){throw this.logger.error("Failed to accept upsell:",s),this.loadingOverlay.hide(!0),s}}else this.logger.error("No order loaded or API client not initialized");else this.logger.warn("No package ID available for accept-upsell action")})}checkIfUpsellAlreadyAccepted(t){const e=Ot.getState();return!!e.completedUpsells.includes(t.toString())||e.upsellJourney.some(e=>e.packageId===t.toString()&&"accepted"===e.action)}showDuplicateUpsellDialog(){return g(this,null,function*(){const t=yield ad.showDuplicateUpsell();return this.logger.info(t?"User confirmed to add duplicate upsell":"User declined to add duplicate upsell"),t})}update(t){}destroy(){this.clickHandler&&this.element.removeEventListener("click",this.clickHandler),this.pageShowHandler&&window.removeEventListener("pageshow",this.pageShowHandler),this.selectorId&&(this.eventBus.off("upsell-selector:item-selected",this.handleSelectorChange.bind(this)),this.eventBus.off("selector:item-selected",this.handleSelectorChange.bind(this)),this.eventBus.off("selector:selection-changed",this.handleSelectorChange.bind(this))),super.destroy()}}},Symbol.toStringTag,{value:"Module"}));function ld(t){if(!("string"==typeof(e=t)&&e.length>0))return;var e;const i=t.match(/\$?(\d+\.?\d*)/);if(!i||!i[1])return;const n=parseFloat(i[1]);return function(t){return function(t){return function(t){return"number"==typeof t&&!isNaN(t)&&isFinite(t)}(t)&&t>=0}(t)}(n)?n:void 0}const dd=class{static extractPrice(t){for(const e of this.PRICE_SELECTORS){const i=t.querySelector(e);if(null==i?void 0:i.textContent){const t=ld(i.textContent.trim());if(void 0!==t)return t}}}static extractName(t){var e;for(const i of this.NAME_SELECTORS){const n=t.querySelector(i),r=null==(e=null==n?void 0:n.textContent)?void 0:e.trim();if(r)return r}}static extractQuantity(t){const e=t.getAttribute("data-next-quantity")||t.getAttribute("data-quantity")||t.getAttribute("data-qty");return e&&parseInt(e,10)||1}};dd.PRICE_SELECTORS=[".pb-quantity__price.pb--current",".price",'[data-next-display*="price"]',".next-price",".product-price",".item-price"],dd.NAME_SELECTORS=[".card-title","h1, h2, h3, h4, h5, h6",".title",".name",'[data-next-display*="name"]',".product-name",".item-name"];let ud=dd;const hd=Object.freeze(Object.defineProperty({__proto__:null,PackageSelectorEnhancer:class extends be{constructor(){super(...arguments),this.items=[],this.selectedItem=null,this.clickHandlers=new Map,this.mutationObserver=null}initialize(){return g(this,null,function*(){var t;this.validateElement(),this.selectorId=this.getRequiredAttribute("data-next-selector-id")||this.getRequiredAttribute("data-next-id")||`selector-${Date.now()}`,this.mode=this.getAttribute("data-next-selection-mode")||"swap",this.initializeSelectorCards(),this.setupMutationObserver(),this.subscribe(Tt,this.syncWithCart.bind(this)),this.syncWithCart(Tt.getState()),this.element.Lt=()=>this.selectedItem,this.element.Ft=()=>{var t;return null==(t=this.selectedItem)?void 0:t.packageId},this.logger.debug("Initialized package selector:",{selectorId:this.selectorId,mode:this.mode,itemCount:this.items.length,element:this.element,initialSelectedPackage:null==(t=this.selectedItem)?void 0:t.packageId}),this.logger.info(`Selector "${this.selectorId}" initialized with ${this.items.length} items in ${this.mode} mode`)})}initializeSelectorCards(){this.element.querySelectorAll("[data-next-selector-card]").forEach(t=>{t instanceof HTMLElement&&this.registerCard(t)}),0===this.items.length&&this.logger.warn("No selector cards found in selector",this.element)}registerCard(t){const e=t.getAttribute("data-next-package-id");if(!e)return void this.logger.warn("Card missing package ID attribute",t);let i=parseInt(e,10);if("true"===t.getAttribute("data-next-apply-profile")){const{useProfileStore:t}=require("@/stores/profileStore"),e=t.getState().getMappedPackageId(i);e!==i&&(this.logger.debug(`Selector card pre-mapped package ${i} -> ${e}`),i=e)}const n=parseInt(t.getAttribute("data-next-quantity")||"1",10),r="true"===t.getAttribute("data-next-selected"),s=t.getAttribute("data-next-shipping-id"),a=this.items.findIndex(e=>e.element===t);if(-1!==a){const t=this.items[a];return t&&(t.packageId=i,t.quantity=n,t.isPreSelected=r,t.shippingId=s||void 0,this.updateItemPackageData(t)),void this.logger.debug("Updated existing selector card:",{packageId:i,quantity:n,isPreSelected:r,shippingId:s})}let o;try{o=dt.getState().getPackage(i)||void 0}catch(h){this.logger.debug("Package data not yet available for:",i)}const c=(null==o?void 0:o.price)?parseFloat(o.price):ud.extractPrice(t),l=(null==o?void 0:o.name)||ud.extractName(t)||`Package ${i}`,d={element:t,packageId:i,quantity:n,price:c,name:l,isPreSelected:r,shippingId:s||void 0};this.items.push(d);const u=t=>this.handleCardClick(t,d);this.clickHandlers.set(t,u),t.addEventListener("click",u),t.classList.add("next-selector-card"),this.logger.debug("Registered selector card:",{packageId:i,quantity:n,isPreSelected:r,shippingId:s})}setupMutationObserver(){this.mutationObserver=new MutationObserver(t=>{t.forEach(t=>{if("attributes"===t.type&&t.target instanceof HTMLElement){const e=t.target;e.hasAttribute("data-next-selector-card")&&"data-next-package-id"===t.attributeName&&this.handlePackageIdChange(e)}"childList"===t.type&&(t.addedNodes.forEach(t=>{t instanceof HTMLElement&&(t.hasAttribute("data-next-selector-card")&&this.registerCard(t),t.querySelectorAll("[data-next-selector-card]").forEach(t=>{t instanceof HTMLElement&&this.registerCard(t)}))}),t.removedNodes.forEach(t=>{t instanceof HTMLElement&&this.handleCardRemoval(t)}))})}),this.mutationObserver.observe(this.element,{attributes:!0,attributeFilter:["data-next-package-id","data-next-quantity","data-next-selected","data-next-shipping-id"],childList:!0,subtree:!0})}handlePackageIdChange(t){const e=this.items.find(e=>e.element===t);if(!e)return void this.registerCard(t);const i=t.getAttribute("data-next-package-id");if(!i)return void this.logger.warn("Card package ID removed",t);const n=parseInt(i,10),r=e.packageId;n!==r&&(e.packageId=n,e.quantity=parseInt(t.getAttribute("data-next-quantity")||"1",10),e.shippingId=t.getAttribute("data-next-shipping-id")||void 0,this.updateItemPackageData(e),this.selectedItem===e&&"swap"===this.mode&&this.updateCart(h(u({},e),{packageId:r}),e).catch(t=>{this.logger.error("Failed to update cart after package ID change:",t)}),this.syncWithCart(Tt.getState()),this.logger.debug("Package ID changed on selector card:",{oldPackageId:r,newPackageId:n,isSelected:this.selectedItem===e}))}updateItemPackageData(t){try{const e=dt.getState().getPackage(t.packageId);e?(t.price=e.price?parseFloat(e.price):t.price,t.name=e.name||t.name):(t.price=ud.extractPrice(t.element),t.name=ud.extractName(t.element)||`Package ${t.packageId}`)}catch(e){this.logger.debug("Failed to update package data:",e)}}handleCardRemoval(t){const e=[];t.hasAttribute("data-next-selector-card")&&e.push(t),t.querySelectorAll("[data-next-selector-card]").forEach(t=>{t instanceof HTMLElement&&e.push(t)}),e.forEach(t=>{const e=this.items.findIndex(e=>e.element===t);if(-1!==e){const i=this.items[e],n=this.clickHandlers.get(t);n&&(t.removeEventListener("click",n),this.clickHandlers.delete(t)),this.items.splice(e,1),this.selectedItem===i&&(this.selectedItem=null,this.element.removeAttribute("data-selected-package")),this.logger.debug("Removed selector card:",{packageId:null==i?void 0:i.packageId})}})}handleCardClick(t,e){return g(this,null,function*(){t.preventDefault();try{if(this.selectedItem===e)return;const t=this.selectedItem;this.selectItem(e),this.eventBus.emit("selector:item-selected",{selectorId:this.selectorId,packageId:e.packageId,previousPackageId:(null==t?void 0:t.packageId)||void 0,mode:this.mode,pendingAction:"select"===this.mode||void 0}),this.element.setAttribute("data-selected-package",e.packageId.toString()),this.element.Dt=e,"swap"===this.mode&&(yield this.updateCart(t,e),e.shippingId&&(yield this.setShippingMethod(e.shippingId)))}catch(i){this.handleError(i,"handleCardClick")}})}selectItem(t){this.items.forEach(t=>{t.element.classList.remove("next-selected"),t.element.setAttribute("data-next-selected","false")}),t.element.classList.add("next-selected"),t.element.setAttribute("data-next-selected","true"),this.selectedItem=t,this.element.setAttribute("data-selected-package",t.packageId.toString()),this.logger.debug(`Selected item in selector ${this.selectorId}:`,{packageId:t.packageId,name:t.name,quantity:t.quantity}),this.emit("selector:selection-changed",{selectorId:this.selectorId,packageId:t.packageId,item:t})}updateCart(t,e){return g(this,null,function*(){const i=Tt.getState();if("swap"===this.mode){const t=i.items.find(t=>this.items.some(e=>t.packageId===e.packageId||t.originalPackageId===e.packageId));t?t.packageId!==e.packageId&&(this.logger.debug(`Swapping cart item from selector: ${t.packageId} -> ${e.packageId}`),yield i.swapPackage(t.packageId,{packageId:e.packageId,quantity:e.quantity,isUpsell:!1})):i.hasItem(e.packageId)||(this.logger.debug(`Adding new item from selector: ${e.packageId}`),yield i.addItem({packageId:e.packageId,quantity:e.quantity,isUpsell:!1}))}else t&&t.packageId!==e.packageId?yield i.swapPackage(t.packageId,{packageId:e.packageId,quantity:e.quantity,isUpsell:!1}):i.hasItem(e.packageId)||(yield i.addItem({packageId:e.packageId,quantity:e.quantity,isUpsell:!1}))})}setShippingMethod(t){return g(this,null,function*(){try{const e=parseInt(t,10);if(isNaN(e))return void this.logger.error("Invalid shipping ID:",t);const i=Tt.getState();yield i.setShippingMethod(e),this.logger.debug(`Shipping method ${e} set via selector`)}catch(e){this.logger.error("Failed to set shipping method:",e)}})}syncWithCart(t){try{this.items.forEach(e=>{const i=t.items.some(t=>t.originalPackageId===e.packageId||t.packageId===e.packageId);e.element.classList.toggle("next-in-cart",i),e.element.setAttribute("data-next-in-cart",i.toString())});const e=this.items.filter(e=>t.items.some(t=>t.originalPackageId===e.packageId||t.packageId===e.packageId));if(e.length>0&&"swap"===this.mode){const t=e[0];t&&this.selectedItem!==t&&this.selectItem(t)}else if(!this.selectedItem&&t.isEmpty){const t=this.items.filter(t=>t.isPreSelected);t.length>1&&(this.logger.warn(`Multiple pre-selected items found in selector ${this.selectorId}. Only one should be pre-selected.`),t.slice(1).forEach(t=>{t.element.classList.remove("next-selected"),t.element.setAttribute("data-next-selected","false"),t.isPreSelected=!1}));const e=t[0];e&&(this.selectItem(e),"select"!==this.mode&&this.updateCart(null,e).catch(t=>{this.logger.error("Failed to add pre-selected item:",t)}))}}catch(e){this.handleError(e,"syncWithCart")}}update(){this.syncWithCart(Tt.getState())}getSelectedItem(){return this.selectedItem}getSelectorConfig(){return{id:this.selectorId,mode:this.mode,itemCount:this.items.length}}cleanupEventListeners(){this.clickHandlers.forEach((t,e)=>{e.removeEventListener("click",t)}),this.clickHandlers.clear(),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null)}destroy(){this.cleanupEventListeners(),this.items.forEach(t=>{t.element.classList.remove("next-selector-card","next-selected","next-in-cart")}),super.destroy()}}},Symbol.toStringTag,{value:"Module"})),pd=Object.freeze(Object.defineProperty({__proto__:null,TimerEnhancer:class extends be{constructor(){super(...arguments),this.duration=0,this.persistenceId="",this.format="mm:ss",this.startTime=0}initialize(){return g(this,null,function*(){this.validateElement();const t=this.getRequiredAttribute("data-duration");this.duration=parseInt(t,10),this.persistenceId=this.getAttribute("data-persistence-id")||"default-timer",this.format=this.getAttribute("data-format")||"mm:ss",this.loadStartTime(),this.startTimer(),this.logger.debug(`Initialized timer: ${this.duration}s, persistence: ${this.persistenceId}`)})}update(){}loadStartTime(){const t=localStorage.getItem(`next-timer-${this.persistenceId}`);t?this.startTime=parseInt(t,10):(this.startTime=Date.now(),localStorage.setItem(`next-timer-${this.persistenceId}`,this.startTime.toString()))}startTimer(){this.updateDisplay(),this.interval=window.setInterval(()=>{this.updateDisplay()},1e3)}updateDisplay(){const t=Math.floor((Date.now()-this.startTime)/1e3),e=Math.max(0,this.duration-t);if(0===e)return void this.handleTimerExpired();const i=this.formatTime(e);(this.element.querySelector("[data-next-timer-display]")||this.element).textContent=i}formatTime(t){const e=Math.floor(t/3600),i=Math.floor(t%3600/60),n=t%60,r=t=>t.toString().padStart(2,"0");switch(this.format){case"hh:mm:ss":return`${r(e)}:${r(i)}:${r(n)}`;case"mm:ss":default:return`${r(i)}:${r(n)}`;case"ss":return r(n)}}handleTimerExpired(){this.interval&&(clearInterval(this.interval),this.interval=void 0),localStorage.removeItem(`next-timer-${this.persistenceId}`),this.element.style.display="none",document.querySelectorAll(`[data-next-timer-expired][data-persistence-id="${this.persistenceId}"]`).forEach(t=>{t.style.display=""}),this.emit("timer:expired",{persistenceId:this.persistenceId}),this.logger.debug(`Timer expired: ${this.persistenceId}`)}destroy(){this.interval&&clearInterval(this.interval),super.destroy()}}},Symbol.toStringTag,{value:"Module"})),fd=Object.freeze(Object.defineProperty({__proto__:null,ConditionalDisplayEnhancer:class extends be{constructor(){super(...arguments),this.packageContext=null,this.selectorId=null,this.dependsOnCart=!1,this.dependsOnPackage=!1,this.dependsOnSelection=!1,this.dependsOnOrder=!1,this.dependsOnShipping=!1,this.dependsOnProfile=!1,this.dependsOnParams=!1,this.profileId=null,this.selectionChangeHandler=null}initialize(){return g(this,null,function*(){const t=this.element.getAttribute("data-next-show"),e=this.element.getAttribute("data-next-hide");this.logger.info("ConditionalDisplayEnhancer initializing:",{element:this.element.tagName,class:this.element.className,showAttr:t,hideAttr:e,hasParams:window.location.search}),this.validateElement();const i=Hl.findPackageId(this.element);this.packageContext=void 0!==i?i:null,this.selectorId=this.detectSelectorContext();const n=this.getAttribute("data-next-show-if-profile"),r=this.getAttribute("data-next-hide-if-profile");if(n)this.profileId=n,this.showCondition=!0,this.dependsOnProfile=!0;else if(r)this.profileId=r,this.showCondition=!1,this.dependsOnProfile=!0;else{const t=this.getAttribute("data-next-show"),e=this.getAttribute("data-next-hide");if(t)this.condition=ce.parseCondition(t),this.showCondition=!0;else{if(!e)throw new Error("Either data-next-show, data-next-hide, data-next-show-if-profile, or data-next-hide-if-profile is required");this.condition=ce.parseCondition(e),this.showCondition=!1}}!this.dependsOnProfile&&this.condition&&(this.analyzeDependencies(),this.logger.debug("Condition analysis:",{condition:this.condition,dependsOnParams:this.dependsOnParams,dependsOnCart:this.dependsOnCart,dependsOnProfile:this.dependsOnProfile})),this.dependsOnCart&&this.subscribe(Tt,this.handleStateUpdate.bind(this)),this.dependsOnPackage&&this.subscribe(dt,this.handleCampaignUpdate.bind(this)),this.dependsOnSelection&&(this.selectionChangeHandler=this.handleSelectionChange.bind(this),this.eventBus.on("selector:selection-changed",this.selectionChangeHandler),this.eventBus.on("selector:item-selected",this.selectionChangeHandler)),this.dependsOnOrder&&this.subscribe(Ot,this.handleOrderUpdate.bind(this)),this.dependsOnShipping&&this.subscribe(dt,this.handleShippingUpdate.bind(this)),this.dependsOnProfile&&(this.subscribe(mt,this.handleProfileUpdate.bind(this)),this.eventBus.on("profile:applied",()=>{this.handleProfileUpdate(mt.getState())}),this.eventBus.on("profile:reverted",()=>{this.handleProfileUpdate(mt.getState())}),this.eventBus.on("profile:switched",()=>{this.handleProfileUpdate(mt.getState())}),this.eventBus.on("sdk:url-parameters-processed",()=>{this.handleProfileUpdate(mt.getState())})),this.dependsOnParams&&(this.subscribe(qt,this.handleParamsUpdate.bind(this)),this.eventBus.on("sdk:url-parameters-processed",()=>{this.handleParamsUpdate(qt.getState())})),yield new Promise(t=>setTimeout(t,0)),this.dependsOnProfile?this.handleProfileUpdate(mt.getState()):this.dependsOnParams?this.handleParamsUpdate(qt.getState()):this.dependsOnCart?this.handleStateUpdate(Tt.getState()):this.dependsOnPackage?this.handlePackageUpdate():this.dependsOnSelection?this.handleSelectionUpdate():this.dependsOnOrder?this.handleOrderUpdate(Ot.getState()):this.dependsOnShipping&&this.handleShippingUpdate()})}update(){this.dependsOnCart?this.handleStateUpdate(Tt.getState()):this.dependsOnPackage?this.handlePackageUpdate():this.dependsOnSelection?this.handleSelectionUpdate():this.dependsOnOrder?this.handleOrderUpdate(Ot.getState()):this.dependsOnProfile?this.handleProfileUpdate(mt.getState()):this.dependsOnParams&&this.handleParamsUpdate(qt.getState())}analyzeDependencies(){this.dependsOnCart=this.conditionDependsOnCart(this.condition),this.dependsOnPackage=this.conditionDependsOnPackage(this.condition),this.dependsOnSelection=this.conditionDependsOnSelection(this.condition),this.dependsOnOrder=this.conditionDependsOnOrder(this.condition),this.dependsOnShipping=this.conditionDependsOnShipping(this.condition),this.dependsOnProfile=this.conditionDependsOnProfile(this.condition),this.dependsOnParams=this.conditionDependsOnParams(this.condition),this.dependsOnCart||this.dependsOnPackage||this.dependsOnSelection||this.dependsOnOrder||this.dependsOnShipping||this.dependsOnProfile||this.dependsOnParams||(this.dependsOnCart=!0)}conditionDependsOnCart(t){switch(t.type){case"property":case"function":return"cart"===t.object;case"comparison":return"cart"===t.left.object||t.right&&"object"==typeof t.right&&"cart"===t.right.object;default:return!1}}conditionDependsOnPackage(t){switch(t.type){case"property":case"function":return"package"===t.object;case"comparison":return"package"===t.left.object||t.right&&"object"==typeof t.right&&"package"===t.right.object;default:return!1}}conditionDependsOnSelection(t){switch(t.type){case"property":case"function":return"selection"===t.object||t.object&&t.object.startsWith("selection.");case"comparison":const e="selection"===t.left.object||t.left.object&&t.left.object.startsWith("selection."),i=t.right&&"object"==typeof t.right&&("selection"===t.right.object||t.right.object&&t.right.object.startsWith("selection."));return e||i;default:return!1}}conditionDependsOnOrder(t){switch(t.type){case"property":case"function":return"order"===t.object;case"comparison":return"order"===t.left.object||t.right&&"object"==typeof t.right&&"order"===t.right.object;default:return!1}}conditionDependsOnShipping(t){switch(t.type){case"property":case"function":return"shipping"===t.object;case"comparison":return"shipping"===t.left.object||t.right&&"object"==typeof t.right&&"shipping"===t.right.object;default:return!1}}conditionDependsOnProfile(t){if(!t)return!1;switch(t.type){case"property":case"function":return"profile"===t.object;case"comparison":return t.left&&"profile"===t.left.object||t.right&&"object"==typeof t.right&&"profile"===t.right.object;default:return!1}}conditionDependsOnParams(t){var e,i;if(!t)return!1;switch(this.logger.debug("Checking if condition depends on params:",{condition:t,type:t.type,leftObject:null==(e=t.left)?void 0:e.object,rightObject:null==(i=t.right)?void 0:i.object}),t.type){case"property":case"function":return"param"===t.object||"params"===t.object;case"comparison":const e=t.left&&("param"===t.left.object||"params"===t.left.object)||t.right&&"object"==typeof t.right&&("param"===t.right.object||"params"===t.right.object);return this.logger.debug("Comparison depends on params:",e),e;default:return!1}}handleCampaignUpdate(){this.dependsOnPackage&&this.handlePackageUpdate()}handleOrderUpdate(t){try{const e=this.evaluateOrderCondition(t),i=this.showCondition?e:!e;this.element.style.display=i?"":"none",this.toggleClass("next-condition-met",e),this.toggleClass("next-condition-not-met",!e),this.toggleClass("next-visible",i),this.toggleClass("next-hidden",!i)}catch(e){this.handleError(e,"handleOrderUpdate")}}handlePackageUpdate(){try{const t=this.evaluatePackageCondition(),e=this.showCondition?t:!t;this.element.style.display=e?"":"none",this.toggleClass("next-condition-met",t),this.toggleClass("next-condition-not-met",!t),this.toggleClass("next-visible",e),this.toggleClass("next-hidden",!e)}catch(t){this.handleError(t,"handlePackageUpdate")}}handleShippingUpdate(){try{const t=this.evaluateShippingCondition(),e=this.showCondition?t:!t;this.element.style.display=e?"":"none",this.toggleClass("next-condition-met",t),this.toggleClass("next-condition-not-met",!t),this.toggleClass("next-visible",e),this.toggleClass("next-hidden",!e)}catch(t){this.handleError(t,"handleShippingUpdate")}}handleProfileUpdate(t){try{let e=!1;this.profileId?e=t.activeProfileId===this.profileId:this.condition&&(e=this.evaluateProfileCondition(t));const i=this.showCondition?e:!e;this.element.style.display=i?"":"none",this.toggleClass("next-condition-met",e),this.toggleClass("next-condition-not-met",!e),this.toggleClass("next-visible",i),this.toggleClass("next-hidden",!i),this.toggleClass("next-profile-active",e&&null!==this.profileId)}catch(e){this.handleError(e,"handleProfileUpdate")}}handleParamsUpdate(t){try{const e=this.evaluateParamsCondition(t),i=this.showCondition?e:!e;this.logger.debug("handleParamsUpdate:",{condition:this.condition,showCondition:this.showCondition,conditionMet:e,shouldShow:i,params:t.params,element:this.element.outerHTML.substring(0,100)}),this.element.style.display=i?"":"none",this.toggleClass("next-condition-met",e),this.toggleClass("next-condition-not-met",!e),this.toggleClass("next-visible",i),this.toggleClass("next-hidden",!i)}catch(e){this.handleError(e,"handleParamsUpdate")}}evaluatePackageCondition(){try{switch(this.condition.type){case"property":return this.evaluatePackageProperty(this.condition);case"comparison":return this.evaluatePackageComparison(this.condition);default:return this.logger.warn(`Unsupported condition type for package: ${this.condition.type}`),!1}}catch(t){return this.logger.error("Error evaluating package condition:",t),!1}}evaluateOrderCondition(t){try{switch(this.condition.type){case"property":return this.evaluateOrderProperty(t,this.condition);case"comparison":return this.evaluateOrderComparison(t,this.condition);default:return this.logger.warn(`Unsupported condition type for order: ${this.condition.type}`),!1}}catch(e){return this.logger.error("Error evaluating order condition:",e),!1}}evaluatePackageProperty(t){const e=this.getPackagePropertyValue(t.property);return Boolean(e)}evaluatePackageComparison(t){const e=this.getPackagePropertyValue(t.left.property),i=t.right;switch(t.operator){case">":return Number(e)>Number(i);case">=":return Number(e)>=Number(i);case"<":return Number(e)<Number(i);case"<=":return Number(e)<=Number(i);case"==":case"===":return e===i;case"!=":case"!==":return e!==i;default:return!1}}evaluateOrderProperty(t,e){const i=this.getOrderPropertyValue(t,e.property);return Boolean(i)}evaluateOrderComparison(t,e){const i=this.getOrderPropertyValue(t,e.left.property),n=e.right;switch(e.operator){case">":return Number(i)>Number(n);case">=":return Number(i)>=Number(n);case"<":return Number(i)<Number(n);case"<=":return Number(i)<=Number(n);case"==":case"===":return i===n;case"!=":case"!==":return i!==n;default:return!1}}handleStateUpdate(t){try{const e=this.evaluateCondition(t),i=this.showCondition?e:!e;this.element.style.display=i?"":"none",this.toggleClass("next-condition-met",e),this.toggleClass("next-condition-not-met",!e),this.toggleClass("next-visible",i),this.toggleClass("next-hidden",!i)}catch(e){this.handleError(e,"handleStateUpdate")}}evaluateCondition(t){try{switch(this.condition.type){case"property":return this.evaluateProperty(t,this.condition);case"function":return this.evaluateFunction(t,this.condition);case"comparison":return this.evaluateComparison(t,this.condition);default:return this.logger.warn(`Unknown condition type: ${this.condition.type}`),!1}}catch(e){return this.logger.error("Error evaluating condition:",e),!1}}detectSelectorContext(){if(this.condition){if(this.condition.property&&this.condition.property.includes(".")){const t=this.condition.property.split(".");if(t.length>=2)return this.logger.debug("Found selector ID in property:",t[0]),t[0]}if(this.condition.left&&this.condition.left.property&&this.condition.left.property.includes(".")){const t=this.condition.left.property.split(".");if(t.length>=2)return this.logger.debug("Found selector ID in comparison:",t[0]),t[0]}}const t=this.getAttribute("data-next-selector-id")||this.getAttribute("data-selector-id");if(t)return t;let e=this.element;for(;e;){const t=e.getAttribute("data-next-selector-id");if(t)return t;if(e.hasAttribute("data-next-cart-selector"))return e.getAttribute("data-next-selector-id")||e.getAttribute("data-next-id")||null;e=e.parentElement}return null}handleSelectionChange(t){this.selectorId&&t.selectorId!==this.selectorId||this.handleSelectionUpdate()}handleSelectionUpdate(){try{const t=this.evaluateSelectionCondition(),e=this.showCondition?t:!t;this.element.style.display=e?"":"none",this.toggleClass("next-condition-met",t),this.toggleClass("next-condition-not-met",!t),this.toggleClass("next-visible",e),this.toggleClass("next-hidden",!e)}catch(t){this.handleError(t,"handleSelectionUpdate")}}evaluateSelectionCondition(){try{switch(this.condition.type){case"property":return this.evaluateSelectionProperty(this.condition);case"comparison":return this.evaluateSelectionComparison(this.condition);default:return this.logger.warn(`Unsupported condition type for selection: ${this.condition.type}`),!1}}catch(t){return this.logger.error("Error evaluating selection condition:",t),!1}}evaluateShippingCondition(){try{switch(this.condition.type){case"property":return this.evaluateShippingProperty(this.condition);case"comparison":return this.evaluateShippingComparison(this.condition);default:return this.logger.warn(`Unsupported condition type for shipping: ${this.condition.type}`),!1}}catch(t){return this.logger.error("Error evaluating shipping condition:",t),!1}}evaluateProfileCondition(t){try{switch(this.condition.type){case"property":return"active"===this.condition.property||"isActive"===this.condition.property?Boolean(t.activeProfileId):"id"===this.condition.property&&(t.activeProfileId||"");case"comparison":if("profile"===this.condition.left.object&&("active"===this.condition.left.property||"id"===this.condition.left.property)){const e=t.activeProfileId||"",i=this.condition.right;switch(this.condition.operator){case"===":case"==":return e===i;case"!==":case"!=":return e!==i;default:return!1}}return!1;case"function":if("is"===this.condition.method){const e=this.condition.args[0];return t.activeProfileId===e}if("has"===this.condition.method){const e=this.condition.args[0];return t.profiles.has(e)}return!1;default:return this.logger.warn(`Unsupported condition type for profile: ${this.condition.type}`),!1}}catch(e){return this.logger.error("Error evaluating profile condition:",e),!1}}evaluateParamsCondition(t){try{switch(this.condition.type){case"property":return t.hasParam(this.condition.property);case"comparison":const e=String(t.getParam(this.condition.left.property)||""),i=String(this.condition.right);switch(this.logger.info("evaluateParamsCondition comparison:",{condition:this.condition,property:this.condition.left.property,paramValue:e,compareValue:i,operator:this.condition.operator,willMatch:e===i,paramValueType:typeof e,compareValueType:typeof i,allParams:t.params}),this.condition.operator){case"===":case"==":return e===i;case"!==":case"!=":return e!==i;case">":return Number(e)>Number(i);case">=":return Number(e)>=Number(i);case"<":return Number(e)<Number(i);case"<=":return Number(e)<=Number(i);default:return!1}case"function":if("has"===this.condition.method||"exists"===this.condition.method){const e=this.condition.args[0];return t.hasParam(e)}if("is"===this.condition.method||"equals"===this.condition.method){const e=this.condition.args[0],i=String(this.condition.args[1]);return(t.getParam(e)||"")===i}return!1;default:return this.logger.warn(`Unsupported condition type for params: ${this.condition.type}`),!1}}catch(e){return this.logger.error("Error evaluating params condition:",e),!1}}evaluateSelectionProperty(t){const e=this.getSelectionPropertyValue(t.property);return Boolean(e)}evaluateSelectionComparison(t){const e=this.getSelectionPropertyValue(t.left.property),i=t.right;switch(t.operator){case">":return Number(e)>Number(i);case">=":return Number(e)>=Number(i);case"<":return Number(e)<Number(i);case"<=":return Number(e)<=Number(i);case"==":case"===":return e===i;case"!=":case"!==":return e!==i;default:return!1}}evaluateShippingProperty(t){const e=this.getShippingPropertyValue(t.property);return Boolean(e)}evaluateShippingComparison(t){const e=this.getShippingPropertyValue(t.left.property),i=t.right;switch(t.operator){case">":return Number(e)>Number(i);case">=":return Number(e)>=Number(i);case"<":return Number(e)<Number(i);case"<=":return Number(e)<=Number(i);case"==":case"===":return e===i;case"!=":case"!==":return e!==i;default:return!1}}evaluateProperty(t,e){const i=this.getPropertyValue(t,e.object,e.property);return Boolean(i)}evaluateFunction(t,e){const{object:i,method:n,args:r}=e;if("cart"===i)switch(n){case"hasItem":if(r.length>0){const e=r[0];return t.items.some(t=>t.packageId===e)}return!1;case"hasItems":return!t.isEmpty;default:return this.logger.warn(`Unknown cart method: ${n}`),!1}return!1}evaluateComparison(t,e){const i=this.getPropertyValue(t,e.left.object,e.left.property),n=e.right;switch(e.operator){case">":return Number(i)>Number(n);case">=":return Number(i)>=Number(n);case"<":return Number(i)<Number(n);case"<=":return Number(i)<=Number(n);case"==":case"===":return i===n;case"!=":case"!==":return i!==n;default:return!1}}getPropertyValue(t,e,i){var n;if("cart"===e)switch(i){case"total":case"total.value":return t.totals.total.value;case"subtotal":case"subtotal.value":return t.totals.subtotal.value;case"shipping":case"shipping.value":return t.totals.shipping.value;case"tax":case"tax.value":return t.totals.tax.value;case"discounts":case"discounts.value":return t.totals.discounts.value;case"count":return t.totalQuantity;case"isEmpty":return t.isEmpty;case"hasItems":return!t.isEmpty;case"hasShipping":return t.totals.shipping.value>0;case"hasFreeShipping":return 0===t.totals.shipping.value;case"savingsAmount":case"savingsAmount.value":return t.totals.savings.value;case"savingsPercentage":case"savingsPercentage.value":return t.totals.savingsPercentage.value;case"compareTotal":case"compareTotal.value":return t.totals.compareTotal.value;case"hasSavings":return t.totals.hasSavings;default:const e=Ll("cart",i);if(e){const{path:i,validator:n}=e;if(i.startsWith("!")){const e=i.substring(1);return!ql.getNestedProperty(t,e)}let r=ql.getNestedProperty(t,i);return n&&void 0!==r&&(r=n(r)),r}return ql.getNestedProperty(t,i)}if("package"===e)return this.getPackagePropertyValue(i);if("selection"===e||e&&e.startsWith("selection.")){let t=this.selectorId,r=i;if(e.startsWith("selection.")){const s=e.split(".");s.length>=2&&(t=null!=(n=s[1])?n:null,s.length>2&&(r=s.slice(2).join(".")+(i?"."+i:"")))}return this.getSelectionPropertyValue(r,t)}if("order"===e){const t=Ot.getState();return this.getOrderPropertyValue(t,i)}return"shipping"===e?this.getShippingPropertyValue(i):"param"===e||"params"===e?qt.getState().getParam(i):null}getSelectionPropertyValue(t,e){var i,n;let r=e||this.selectorId,s=t;if(t&&t.includes(".")){const e=t.split(".");e.length>=2&&(r=null!=(i=e[0])?i:null,s=e.slice(1).join("."))}if(!r)return this.logger.warn("Selection condition used but no selector context found"),null;const a=document.querySelector(`[data-next-selector-id="${r}"]`);if(!a)return this.logger.debug(`Selector element not found for ID: ${r}`),null;const o=a.Lt,c="function"==typeof o?o():null;if(!c)return"hasSelection"!==s&&null;let l;try{l=null!=(n=dt.getState().getPackage(c.packageId))?n:void 0}catch(d){this.logger.debug("Could not get package data for selection")}switch(s){case"hasSelection":return!0;case"packageId":return c.packageId;case"quantity":case"totalUnits":case"totalQuantity":return c.quantity||1;case"name":return(null==l?void 0:l.name)||c.name||"";case"price":return l?parseFloat(l.price||"0"):c.price||0;case"total":case"price_total":return l?parseFloat(l.price_total||"0")||parseFloat(l.price||"0")*c.quantity:(c.price||0)*c.quantity;case"hasSavings":return!!l&&Jl.calculatePackageMetrics({price:parseFloat(l.price||"0"),retailPrice:parseFloat(l.price_retail||"0"),quantity:c.quantity,priceTotal:parseFloat(l.price_total||"0"),retailPriceTotal:parseFloat(l.price_retail_total||"0")}).hasSavings;case"savingsAmount":return l?Jl.calculatePackageMetrics({price:parseFloat(l.price||"0"),retailPrice:parseFloat(l.price_retail||"0"),quantity:c.quantity,priceTotal:parseFloat(l.price_total||"0"),retailPriceTotal:parseFloat(l.price_retail_total||"0")}).totalSavings:0;case"savingsPercentage":return l?Jl.calculatePackageMetrics({price:parseFloat(l.price||"0"),retailPrice:parseFloat(l.price_retail||"0"),quantity:c.quantity,priceTotal:parseFloat(l.price_total||"0"),retailPriceTotal:parseFloat(l.price_retail_total||"0")}).totalSavingsPercentage:0;case"compareTotal":case"price_retail_total":if(!l)return 0;const t=parseFloat(l.price_retail_total||"0");if(t>0)return t;const e=parseFloat(l.price_retail||"0");return e>0?e*c.quantity:this.getSelectionPropertyValue("total",r);case"isBundle":case"isMultiPack":return(c.quantity||1)>1;case"isSingleUnit":return 1===(c.quantity||1);default:return l?ql.getNestedProperty(l,s):null}}getPackagePropertyValue(t){if(!this.packageContext)return this.logger.warn("Package condition used but no package context found"),null;try{const e=dt.getState().getPackage(this.packageContext);return e?this.calculatePackageProperty(e,t):(this.logger.warn(`Package ${this.packageContext} not found in campaign data`),null)}catch(e){return this.logger.error(`Error getting package property ${t}:`,e),null}}calculatePackageProperty(t,e){const i=parseFloat(t.price)||0,n=parseFloat(t.price_retail||t.price)||0,r=parseFloat(t.price_total||"0")||i*(t.qty||1),s=parseFloat(t.price_retail_total||"0")||n*(t.qty||1),a=t.qty||1,o=Jl.calculatePackageMetrics({price:i,retailPrice:n,quantity:a,priceTotal:r,retailPriceTotal:s});switch(e){case"name":return t.name;case"price":case"price.raw":return i;case"quantity":case"qty":return a;case"image":return t.image;case"isRecurring":return t.is_recurring;case"interval":return t.interval;case"intervalCount":return t.interval_count;case"hasRetailPrice":return n>0&&n!==i;case"hasSavings":case"hasDiscount":return o.hasSavings;case"savingsAmount":case"totalSavings":case"savingsAmount.raw":return o.totalSavings;case"savingsPercentage":case"totalSavingsPercentage":return o.totalSavingsPercentage;case"priceRetailTotal":return o.totalRetailPrice;case"unitPrice":return o.unitPrice;case"unitRetailPrice":return o.unitRetailPrice;case"unitSavings":return o.unitSavings;case"unitSavingsPercentage":return o.unitSavingsPercentage;case"isBundle":return a>1;case"isSubscription":return!0===t.is_recurring;case"isOneTime":return!t.is_recurring;case"priceRetail.raw":return n;default:return ql.getNestedProperty(t,e)}}getShippingPropertyValue(t){var e;const i=this.element.closest("[data-next-shipping-id]");if(!i)return this.logger.warn("Shipping condition used but no shipping context found"),null;const n=i.getAttribute("data-next-shipping-id");if(!n)return null;const r=((null==(e=dt.getState().data)?void 0:e.shipping_methods)||[]).find(t=>t.ref_id===parseInt(n,10));if(!r)return this.logger.warn(`Shipping method ${n} not found in campaign data`),null;switch(t){case"isFree":return 0===parseFloat(r.price||"0");case"cost":case"price":return parseFloat(r.price||"0");case"name":case"code":return r.code;case"id":case"refId":return r.ref_id;case"method":return r;default:return null}}getOrderPropertyValue(t,e){var i,n,r,s,a,o,c,l,d,u,h;const p=t.order;switch(e){case"exists":case"hasOrder":return!!p;case"isLoaded":return!t.isLoading&&!!p;case"isLoading":return t.isLoading;case"hasError":return!!t.error;case"cacheFresh":case"isCacheFresh":return!(!p||!t.orderLoadedAt)&&Date.now()-t.orderLoadedAt<9e5;case"cacheExpired":case"isCacheExpired":return!(!p||!t.orderLoadedAt)&&Date.now()-t.orderLoadedAt>=9e5;case"isRecent":case"isRecentOrder":if(!p)return!1;const e=null==(n=null==(i=p.attribution)?void 0:i.metadata)?void 0:n.timestamp;return!!e&&Date.now()-e<9e5;case"isExpired":if(!p)return!1;const d=null==(s=null==(r=p.attribution)?void 0:r.metadata)?void 0:s.timestamp;return!!d&&Date.now()-d>=9e5;case"isNewOrder":case"wasPlacedRecently":if(!p)return!1;const u=null==(o=null==(a=p.attribution)?void 0:a.metadata)?void 0:o.timestamp;return!!u&&Date.now()-u<9e5;case"isOldOrder":case"wasPlacedLongAgo":if(!p)return!1;const h=null==(l=null==(c=p.attribution)?void 0:c.metadata)?void 0:l.timestamp;return!!h&&Date.now()-h>=9e5}if(!p)return!1;switch(e){case"isTest":return p.is_test||!1;case"hasItems":return p.lines&&p.lines.length>0;case"isEmpty":return!p.lines||0===p.lines.length;case"hasShipping":return parseFloat(p.shipping_incl_tax||"0")>0;case"hasTax":return parseFloat(p.total_tax||"0")>0;case"hasDiscounts":return parseFloat(p.total_discounts||"0")>0;case"hasUpsells":return(null==(d=p.lines)?void 0:d.some(t=>t.is_upsell))||!1;case"supportsUpsells":case"acceptsUpsells":case"supportsPostPurchaseUpsells":return p.supports_post_purchase_upsells||!1;case"total":return parseFloat(p.total_incl_tax||"0");case"subtotal":return p.lines&&p.lines.length>0?p.lines.reduce((t,e)=>t+parseFloat(e.price_excl_tax||"0"),0):parseFloat(p.total_excl_tax||"0")-parseFloat(p.shipping_excl_tax||"0");case"tax":return parseFloat(p.total_tax||"0");case"shipping":return parseFloat(p.shipping_incl_tax||"0");case"shippingExclTax":return parseFloat(p.shipping_excl_tax||"0");case"shippingTax":return parseFloat(p.shipping_tax||"0");case"discounts":return parseFloat(p.total_discounts||"0");case"itemCount":return(null==(u=p.lines)?void 0:u.length)||0;case"totalQuantity":return(null==(h=p.lines)?void 0:h.reduce((t,e)=>t+(e.quantity||0),0))||0;default:return ql.getNestedProperty(p,e)}}destroy(){this.selectionChangeHandler&&(this.eventBus.off("selector:selection-changed",this.selectionChangeHandler),this.eventBus.off("selector:item-selected",this.selectionChangeHandler)),super.destroy()}}},Symbol.toStringTag,{value:"Module"}));class md{static findField(t,e={}){const i=e.container||document,n=[`[data-next-checkout-field="${t}"]`,`[os-checkout-field="${t}"]`,`input[name="${t}"]`,`select[name="${t}"]`,`textarea[name="${t}"]`,`#${t}`,`[data-field="${t}"]`,`[data-field-name="${t}"]`],r=e.customSelectors||n;for(const a of r)try{const t=i.querySelector(a);if(t){const i=t;if(!e.includeHidden&&null===i.offsetParent)continue;if(!e.includeDisabled&&"disabled"in i&&i.disabled)continue;return i}}catch(s){}return null}static findFields(t,e={}){const i=new Map;return t.forEach(t=>{const n=this.findField(t,e);n&&i.set(t,n)}),i}static findFieldWrapper(t,e){const i=e||[".form-group",".frm-flds",".form-input",".select-form-wrapper",".field-wrapper",".input-wrapper",".form-field"];for(const n of i){const e=t.closest(n);if(e)return e}return t.parentElement}static findFormContainer(t){return t.closest("form")}static findFieldLabel(t){if(t.id){const e=document.querySelector(`label[for="${t.id}"]`);if(e)return e}let e=t.parentElement;for(;e;){const t=e.querySelector("label");if(t)return t;if("LABEL"===e.tagName)return e;e=e.parentElement}const i=this.findFieldWrapper(t);if(i){const t=i.querySelector("label");if(t)return t}return null}static findAllFormFields(t,e={}){const i=['input:not([type="hidden"]):not([type="submit"]):not([type="button"])',"select","textarea"];e.includeButtons&&i.push("button",'input[type="submit"]','input[type="button"]');const n=[];return t.querySelectorAll(i.join(", ")).forEach(t=>{n.push(t)}),n}static findFieldsByAttribute(t,e,i=document.body){const n=[],r=`[${t}]`;return i.querySelectorAll(r).forEach(i=>{const r=i.getAttribute(t);e&&r?"string"==typeof e?r.includes(e)&&n.push(i):e instanceof RegExp&&e.test(r)&&n.push(i):n.push(i)}),n}static isFormField(t){return["INPUT","SELECT","TEXTAREA"].includes(t.tagName)}static getFieldType(t){return t instanceof HTMLInputElement?t.type||"text":t instanceof HTMLSelectElement?"select":t instanceof HTMLTextAreaElement?"textarea":"unknown"}static getFieldValue(t){return t instanceof HTMLInputElement||t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement?t.value:""}static setFieldValue(t,e){return(t instanceof HTMLInputElement||t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement)&&(t.value=e,t.dispatchEvent(new Event("change",{bubbles:!0})),!0)}}class gd{constructor(t){this.isReady=!1,this.hasTrackedPaymentInfo=!1,this.fieldHasValue={number:!1,cvv:!1},this.originalPlaceholders={number:"Card Number",cvv:"CVV *"},this.labelBehavior={number:null,cvv:null},this.environmentKey=t,this.logger=tt("CreditCardService"),this.validationState=this.initializeValidationState(),t||this.logger.error("No Spreedly environment key provided")}initialize(){return g(this,null,function*(){try{if(this.isReady)return void this.logger.debug("CreditCardService already initialized, skipping");if(this.findCreditCardFields(),!this.numberField||!this.cvvField)return void this.logger.debug("Credit card fields not found, skipping Spreedly initialization");yield this.loadSpreedlyScript(),this.setupSpreedly(),this.logger.debug("CreditCardService initialized successfully")}catch(t){throw this.logger.error("Failed to initialize CreditCardService:",t),t}})}tokenizeCard(t){return g(this,null,function*(){if(!this.isReady)throw new Error("Credit card service is not ready");if(!t.full_name||!t.month||!t.year)throw new Error("Credit card data is incomplete");return this.logger.debug("Tokenizing credit card"),new Promise((e,i)=>{const n=this.onTokenCallback,r=this.onErrorCallback;this.onTokenCallback=(t,i)=>{n&&n(t,i),n?this.onTokenCallback=n:delete this.onTokenCallback,r?this.onErrorCallback=r:delete this.onErrorCallback,e(t)},this.onErrorCallback=t=>{r&&r(t),n?this.onTokenCallback=n:delete this.onTokenCallback,r?this.onErrorCallback=r:delete this.onErrorCallback,i(new Error(t.join(". ")))};const s=setTimeout(()=>{n?this.onTokenCallback=n:delete this.onTokenCallback,r?this.onErrorCallback=r:delete this.onErrorCallback,i(new Error("Credit card tokenization timed out"))},3e4),a=e,o=i;e=t=>{clearTimeout(s),a(t)},i=t=>{clearTimeout(s),o(t)},window.Spreedly.tokenizeCreditCard(t)})})}validateCreditCard(t){var e,i,n,r;const s={};let a=!0;const o=(null==(e=this.monthField)?void 0:e.getAttribute("data-next-checkout-field"))||(null==(i=this.monthField)?void 0:i.getAttribute("os-checkout-field"))||"cc-month",c=(null==(n=this.yearField)?void 0:n.getAttribute("data-next-checkout-field"))||(null==(r=this.yearField)?void 0:r.getAttribute("os-checkout-field"))||"cc-year";if(t.month&&""!==t.month.trim()){const e=parseInt(t.month,10);e<1||e>12?(s[o]="Please select a valid month",this.setCreditCardFieldError("month","Please select a valid month"),a=!1):this.setCreditCardFieldValid("month")}else s[o]="Expiration month is required",this.setCreditCardFieldError("month","Expiration month is required"),a=!1;if(t.year&&""!==t.year.trim()){const e=new Date,i=e.getFullYear(),n=e.getMonth()+1,r=parseInt(t.year,10),l=r<100?2e3+r:r;l<i||l>i+20?(s[c]="Please select a valid year",this.setCreditCardFieldError("year","Please select a valid year"),a=!1):l===i&&t.month&&parseInt(t.month,10)<n?(s[o]="Card has expired",s[c]="Card has expired",this.setCreditCardFieldError("month","Card has expired"),this.setCreditCardFieldError("year","Card has expired"),a=!1):this.setCreditCardFieldValid("year")}else s[c]="Expiration year is required",this.setCreditCardFieldError("year","Expiration year is required"),a=!1;const l={isValid:a};return Object.keys(s).length>0&&(l.errors=s),l}checkSpreedlyFieldsReady(){const t=[];return this.validationState.number.isValid||t.push({field:"number",message:"Please enter a valid credit card number"}),this.validationState.cvv.isValid||t.push({field:"cvv",message:"Please enter a valid CVV"}),{hasEmptyFields:t.length>0,errors:t}}clearAllErrors(){this.clearCreditCardFieldError("number"),this.clearCreditCardFieldError("cvv"),this.clearCreditCardFieldError("month"),this.clearCreditCardFieldError("year"),this.hidePaymentErrorContainers()}clearFields(){if(window.Spreedly&&this.isReady)try{window.Spreedly.reload(),this.logger.debug("Spreedly fields reloaded")}catch(t){this.logger.warn("Failed to reload Spreedly fields:",t)}this.monthField instanceof HTMLSelectElement&&(this.monthField.selectedIndex=0),this.yearField instanceof HTMLSelectElement&&(this.yearField.selectedIndex=0),this.validationState=this.initializeValidationState(),this.clearAllErrors()}hidePaymentErrorContainers(){const t=document.querySelector('[data-next-component="credit-error"]');t instanceof HTMLElement&&(t.style.display="none",t.classList.remove("visible"))}setOnReady(t){this.onReadyCallback=t,this.isReady&&t()}setOnError(t){this.onErrorCallback=t}setOnToken(t){this.onTokenCallback=t}setFloatingLabelCallbacks(t,e,i){this.onFieldFocusCallback=t,this.onFieldBlurCallback=e,this.onFieldInputCallback=i}get ready(){return this.isReady}focusField(t){window.Spreedly&&this.isReady&&(window.Spreedly.transferFocus(t),this.logger.debug(`Focusing ${t} field`))}initializeValidationState(){return{number:{isValid:!1,hasError:!1},cvv:{isValid:!1,hasError:!1},month:{isValid:!1,hasError:!1},year:{isValid:!1,hasError:!1}}}findCreditCardFields(){const t=md.findField("cc-number")||document.getElementById("spreedly-number");t&&(this.numberField=t,this.labelBehavior.number=t.getAttribute("data-label-behavior"));const e=md.findField("cvv")||document.getElementById("spreedly-cvv");e&&(this.cvvField=e,this.labelBehavior.cvv=e.getAttribute("data-label-behavior"));const i=md.findField("cc-month")||md.findField("exp-month");i&&(this.monthField=i,i instanceof HTMLSelectElement&&i.addEventListener("change",()=>this.checkAndTrackPaymentInfo()));const n=md.findField("cc-year")||md.findField("exp-year");n&&(this.yearField=n,n instanceof HTMLSelectElement&&n.addEventListener("change",()=>this.checkAndTrackPaymentInfo())),this.logger.debug("Credit card fields found:",{number:!!this.numberField,cvv:!!this.cvvField,month:!!this.monthField,year:!!this.yearField})}loadSpreedlyScript(){return g(this,null,function*(){if(void 0===window.Spreedly)return this.logger.debug("Loading Spreedly script..."),new Promise((t,e)=>{const i=document.createElement("script");i.src="https://core.spreedly.com/iframe/iframe-v1.min.js",i.async=!0,i.onload=()=>{this.logger.debug("Spreedly script loaded"),t()},i.onerror=()=>{this.logger.error("Failed to load Spreedly script"),e(new Error("Failed to load Spreedly script"))},document.head.appendChild(i)});this.logger.debug("Spreedly already loaded")})}setupSpreedly(){try{this.numberField&&(this.numberField.id="spreedly-number",this.numberField.setAttribute("data-spreedly","number"),this.numberField.classList.add("spreedly-field-transition")),this.cvvField&&(this.cvvField.id="spreedly-cvv",this.cvvField.setAttribute("data-spreedly","cvv"),this.cvvField.classList.add("spreedly-field-transition")),window.Spreedly.init(this.environmentKey,{numberEl:"spreedly-number",cvvEl:"spreedly-cvv"}),this.setupSpreedlyEventListeners(),this.setupFieldClickHandlers(),this.addFocusStyles(),this.logger.debug("Spreedly setup complete")}catch(t){throw this.logger.error("Error setting up Spreedly:",t),t}}addFocusStyles(){}setupFieldClickHandlers(){this.numberField&&((this.numberField.closest(".frm-flds, .form-group, .form-field, .field-group")||this.numberField).addEventListener("click",t=>{const e=t.target;"INPUT"!==e.tagName&&"SELECT"!==e.tagName&&"TEXTAREA"!==e.tagName&&window.Spreedly&&this.isReady&&(window.Spreedly.transferFocus("number"),this.logger.debug("Transferring focus to credit card number field"))}),this.numberField.addEventListener("click",()=>{window.Spreedly&&this.isReady&&window.Spreedly.transferFocus("number")})),this.cvvField&&((this.cvvField.closest(".frm-flds, .form-group, .form-field, .field-group")||this.cvvField).addEventListener("click",t=>{const e=t.target;"INPUT"!==e.tagName&&"SELECT"!==e.tagName&&"TEXTAREA"!==e.tagName&&window.Spreedly&&this.isReady&&(window.Spreedly.transferFocus("cvv"),this.logger.debug("Transferring focus to CVV field"))}),this.cvvField.addEventListener("click",()=>{window.Spreedly&&this.isReady&&window.Spreedly.transferFocus("cvv")}))}setupSpreedlyEventListeners(){window.Spreedly.on("ready",()=>{this.logger.info("[Spreedly Event: ready] iFrame initialized and ready for configuration"),this.applySpreedlyConfig(),this.isReady=!0,this.onReadyCallback&&this.onReadyCallback()}),window.Spreedly.on("errors",t=>{this.logger.error("[Spreedly Event: errors] Tokenization failed:",t.map(t=>({attribute:t.attribute,key:t.key,message:t.message})));const e=t.map(t=>t.message&&""!==t.message.trim()?t.message:"errors.unexpected_error"===t.key||0===t.status?"Unable to process payment. Please check your internet connection and try again.":"An error occurred processing your payment. Please try again.");this.onErrorCallback&&this.onErrorCallback(e),this.showSpreedlyErrors(t)}),window.Spreedly.on("paymentMethod",(t,e)=>{this.logger.info("[Spreedly Event: paymentMethod] Successfully tokenized!",{token:t,last4:e.last_four_digits,cardType:e.card_type,fingerprint:e.fingerprint}),this.clearAllErrors(),this.onTokenCallback?(this.logger.debug("[Spreedly] Invoking token callback"),this.onTokenCallback(t,e)):this.logger.error("[Spreedly] No onTokenCallback registered!")}),window.Spreedly.on("validation",t=>{this.logger.info("[Spreedly Event: validation] Validation requested:",{cardType:t.cardType,validNumber:t.validNumber,validCvv:t.validCvv,numberLength:t.numberLength,cvvLength:t.cvvLength,iin:t.iin}),void 0!==t.validNumber&&(this.validationState.number.isValid=t.validNumber,this.validationState.number.hasError=!t.validNumber),void 0!==t.validCvv&&(this.validationState.cvv.isValid=t.validCvv,this.validationState.cvv.hasError=!t.validCvv)}),window.Spreedly.on("fieldEvent",(t,e,i,n)=>{this.handleSpreedlyFieldEvent(t,e,n)}),window.Spreedly.on("consoleError",t=>{this.logger.error("[Spreedly Event: consoleError] Error from iFrame:",{message:t.msg,url:t.url,line:t.line,col:t.col})})}applySpreedlyConfig(){try{window.Spreedly.setFieldType("number","text"),window.Spreedly.setFieldType("cvv","text"),window.Spreedly.setNumberFormat("prettyFormat"),this.originalPlaceholders.number="Card Number",this.originalPlaceholders.cvv="CVV *",window.Spreedly.setPlaceholder("number",this.originalPlaceholders.number),window.Spreedly.setPlaceholder("cvv",this.originalPlaceholders.cvv);const t='color: #212529; font-size: .925rem; font-weight: 400; width: 100%; height:100%; font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue","Noto Sans","Liberation Sans",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";';window.Spreedly.setStyle("number",t),window.Spreedly.setStyle("cvv",t),window.Spreedly.setRequiredAttribute("number"),window.Spreedly.setRequiredAttribute("cvv"),this.logger.debug("Spreedly configuration applied")}catch(t){this.logger.error("Error applying Spreedly configuration:",t)}}handleSpreedlyFieldEvent(t,e,i){var n,r;if("focus"===e)this.handleFieldFocus(t),("number"===t||"cvv"===t)&&window.Spreedly&&this.isReady&&"placeholder"===this.labelBehavior[t]&&(window.Spreedly.setPlaceholder(t,""),this.logger.debug(`Cleared placeholder for ${t} field (label floating up)`)),!this.onFieldFocusCallback||"number"!==t&&"cvv"!==t||this.onFieldFocusCallback(t);else if("blur"===e){if(this.handleFieldBlur(t),("number"===t||"cvv"===t)&&window.Spreedly&&this.isReady){const e="number"===t?this.fieldHasValue.number:this.fieldHasValue.cvv;if("placeholder"===this.labelBehavior[t]&&!e){const e=this.originalPlaceholders[t];window.Spreedly.setPlaceholder(t,e),this.logger.debug(`Restored placeholder for ${t} field (label floating down)`)}}if(this.onFieldBlurCallback&&("number"===t||"cvv"===t)){const e="number"===t?this.fieldHasValue.number:this.fieldHasValue.cvv;this.onFieldBlurCallback(t,e)}}if("input"===e){if("number"===t){this.clearCreditCardFieldError("number");const t=Mt.getState();if(t.clearError("cc-number"),t.clearError("card_number"),i){const t=i.numberLength>0;if(this.fieldHasValue.number=t,window.Spreedly&&this.isReady&&"placeholder"===this.labelBehavior.number&&(t?window.Spreedly.setPlaceholder("number",""):(null==(n=this.numberField)?void 0:n.classList.contains("next-focused"))||window.Spreedly.setPlaceholder("number",this.originalPlaceholders.number)),this.onFieldInputCallback&&this.onFieldInputCallback("number",t),void 0!==i.validNumber){const t=this.validationState.number.isValid;this.validationState.number.isValid=i.validNumber,this.validationState.number.hasError=!i.validNumber,this.numberField&&(i.validNumber?(this.numberField.classList.add("no-error"),this.numberField.classList.remove("has-error","next-error-field")):this.numberField.classList.remove("no-error")),t!==i.validNumber&&this.logger.info(`[Spreedly] Card number validation changed: ${t} -> ${i.validNumber}`)}}}else if("cvv"===t){this.clearCreditCardFieldError("cvv");const t=Mt.getState();if(t.clearError("cvv"),t.clearError("card_cvv"),i){const t=i.cvvLength>0;if(this.fieldHasValue.cvv=t,window.Spreedly&&this.isReady&&"placeholder"===this.labelBehavior.cvv&&(t?window.Spreedly.setPlaceholder("cvv",""):(null==(r=this.cvvField)?void 0:r.classList.contains("next-focused"))||window.Spreedly.setPlaceholder("cvv",this.originalPlaceholders.cvv)),this.onFieldInputCallback&&this.onFieldInputCallback("cvv",t),void 0!==i.validCvv){const t=this.validationState.cvv.isValid;this.validationState.cvv.isValid=i.validCvv,this.validationState.cvv.hasError=!i.validCvv,this.cvvField&&(i.validCvv?(this.cvvField.classList.add("no-error"),this.cvvField.classList.remove("has-error","next-error-field")):this.cvvField.classList.remove("no-error")),t!==i.validCvv&&this.logger.info(`[Spreedly] CVV validation changed: ${t} -> ${i.validCvv}`)}}}this.checkAndTrackPaymentInfo()}}checkAndTrackPaymentInfo(){if(this.hasTrackedPaymentInfo)return;const t=this.validationState.number.isValid&&this.validationState.cvv.isValid,e=this.monthField instanceof HTMLSelectElement?this.monthField.value:"",i=this.yearField instanceof HTMLSelectElement?this.yearField.value:"";if(t&&e&&i&&""!==e&&""!==i)try{$l.track(Sl.createAddPaymentInfoEvent("Credit Card")),this.hasTrackedPaymentInfo=!0,this.logger.info("Tracked add_payment_info event - credit card fields complete")}catch(n){this.logger.warn("Failed to track add_payment_info event:",n)}}handleFieldFocus(t){const e="number"===t?this.numberField:"cvv"===t?this.cvvField:null;if(e){e.classList.add("next-focused","has-focus");const i=e.closest(".frm-flds, .form-group, .form-field, .field-group");i&&i.classList.add("next-focused","has-focus");const n=e.closest(".credit-card-field, .form-input-wrapper");n&&n.classList.add("next-focused","has-focus"),this.logger.debug(`Field focused: ${t}`)}}handleFieldBlur(t){const e="number"===t?this.numberField:"cvv"===t?this.cvvField:null;if(e){e.classList.remove("next-focused","has-focus");const i=e.closest(".frm-flds, .form-group, .form-field, .field-group");i&&i.classList.remove("next-focused","has-focus");const n=e.closest(".credit-card-field, .form-input-wrapper");n&&n.classList.remove("next-focused","has-focus"),this.logger.debug(`Field blurred: ${t}`)}}showSpreedlyErrors(t){this.logger.info("[Spreedly] Showing errors:",t);const e=document.querySelector('[data-next-component="credit-error"]');if(e instanceof HTMLElement){const i=e.querySelector('[data-next-component="credit-error-text"]');if(i){const n=t.map(t=>t.message).join(". ");i.textContent=n,e.style.display="flex",e.classList.add("visible"),this.logger.debug("[Spreedly] Error displayed with message:",n),setTimeout(()=>{"flex"===e.style.display&&(e.style.display="none",e.classList.remove("visible"),this.logger.debug("[Spreedly] Error auto-hidden after 10 seconds"))},1e4)}}else this.logger.error("[Spreedly] Could not find error container to display errors");t.forEach(t=>{const e=t.attribute;"number"===e||"card_number"===e?this.setCreditCardFieldError("number",t.message):"cvv"===e&&this.setCreditCardFieldError("cvv",t.message)})}setCreditCardFieldValid(t){this.validationState[t].isValid=!0,this.validationState[t].hasError=!1,delete this.validationState[t].errorMessage;const e=this.getFieldElement(t);if(e){e.classList.remove("has-error","next-error-field"),e.classList.add("no-error");const t=md.findFieldWrapper(e);t&&(t.classList.remove("has-error","addErrorIcon"),t.classList.add("addTick"))}}setCreditCardFieldError(t,e){this.validationState[t].isValid=!1,this.validationState[t].hasError=!0,this.validationState[t].errorMessage=e,this.logger.debug(`[Spreedly] Setting error for field: ${t} - ${e}`);let i=null;"number"===t?i='[data-next-checkout-field="cc-number"], #spreedly-number':"cvv"===t?i='[data-next-checkout-field="cvv"], #spreedly-cvv':"month"===t?i='[data-next-checkout-field="cc-month"], [data-next-checkout-field="exp-month"]':"year"===t&&(i='[data-next-checkout-field="cc-year"], [data-next-checkout-field="exp-year"]'),i?document.querySelectorAll(i).forEach(t=>{if(t instanceof HTMLElement){t.classList.remove("no-error"),t.classList.add("has-error","next-error-field");const i=t.closest(".form-group, .frm-flds, .field-group");if(i){i.classList.remove("addTick"),i.classList.add("has-error","addErrorIcon"),i.querySelectorAll(".next-error-label").forEach(t=>t.remove());const t=document.createElement("div");t.className="next-error-label",t.setAttribute("role","alert"),t.setAttribute("aria-live","polite"),t.textContent=e,i.appendChild(t),this.logger.debug(`[Spreedly] Added error label: ${e}`)}}}):this.logger.warn(`[Spreedly] No selector found for field type: ${t}`)}clearCreditCardFieldError(t){this.validationState[t].hasError=!1,delete this.validationState[t].errorMessage,this.logger.debug(`[Spreedly] Clearing error for field: ${t}`);let e=null;"number"===t?e='[data-next-checkout-field="cc-number"], #spreedly-number':"cvv"===t?e='[data-next-checkout-field="cvv"], #spreedly-cvv':"month"===t?e='[data-next-checkout-field="cc-month"], [data-next-checkout-field="exp-month"]':"year"===t&&(e='[data-next-checkout-field="cc-year"], [data-next-checkout-field="exp-year"]'),e?document.querySelectorAll(e).forEach(t=>{if(t instanceof HTMLElement){t.classList.remove("has-error","next-error-field");const e=t.closest(".form-group, .frm-flds, .field-group");e&&(e.classList.remove("has-error","addErrorIcon"),e.querySelectorAll('.next-error-label, .error-message, [role="alert"]').forEach(t=>{this.logger.debug(`[Spreedly] Removing error label: ${t.textContent}`),t.remove()}))}}):this.logger.warn(`[Spreedly] No selector found for field type: ${t}`)}getFieldElement(t){switch(t){case"number":return this.numberField;case"cvv":return this.cvvField;case"month":return this.monthField;case"year":return this.yearField;default:return}}destroy(){this.clearAllErrors(),this.isReady=!1,delete this.onReadyCallback,delete this.onErrorCallback,delete this.onTokenCallback,this.logger.debug("CreditCardService destroyed")}}const vd={wrapperClass:"form-group",errorClass:"next-error-field",errorLabelClass:"next-error-label",successClass:"no-error",iconErrorClass:"addErrorIcon",iconSuccessClass:"addTick"};class yd{constructor(t={}){this.options=u(u({},vd),t)}showFieldError(t,e){const i=md.findFieldWrapper(t);if(!i)return;this.clearFieldError(t),t.classList.add("has-error",this.options.errorClass),t.classList.remove(this.options.successClass),i.classList.add(this.options.iconErrorClass),i.classList.remove(this.options.iconSuccessClass);const n=document.createElement("div");n.className=this.options.errorLabelClass,n.textContent=e,n.setAttribute("role","alert"),n.setAttribute("aria-live","polite");const r=t.closest(`.${this.options.wrapperClass}`);r?r.appendChild(n):i.appendChild(n)}clearFieldError(t){const e=md.findFieldWrapper(t);if(t.classList.remove("has-error",this.options.errorClass),e){e.classList.remove(this.options.iconErrorClass);const i=e.querySelector(`.${this.options.errorLabelClass}`);i&&i.remove();const n=t.closest(`.${this.options.wrapperClass}`);if(n){const t=n.querySelector(`.${this.options.errorLabelClass}`);t&&t.remove()}}}showFieldValid(t){const e=md.findFieldWrapper(t);this.clearFieldError(t),t.classList.add(this.options.successClass),e&&e.classList.add(this.options.iconSuccessClass)}clearAllErrors(t){t.querySelectorAll(`.${this.options.errorLabelClass}`).forEach(t=>t.remove()),t.querySelectorAll(`.${this.options.errorClass}, .has-error`).forEach(t=>{t.classList.remove("has-error",this.options.errorClass)}),t.querySelectorAll(`.${this.options.iconErrorClass}`).forEach(t=>{t.classList.remove(this.options.iconErrorClass)})}displayErrors(t,e){this.clearAllErrors(e),Object.entries(t).forEach(([t,i])=>{const n=this.findField(t,e);n&&this.showFieldError(n,i)})}findField(t,e){const i=[`[data-next-checkout-field="${t}"]`,`[os-checkout-field="${t}"]`,`[name="${t}"]`,`#${t}`];for(const n of i){const t=e.querySelector(n);if(t)return t}return null}static showToastError(t,e=1e4){const i=document.querySelector('[next-checkout-element="spreedly-error"]');if(!(i instanceof HTMLElement))return;const n=i.querySelector('[data-os-message="error"]');n instanceof HTMLElement&&(n.textContent=t,i.style.display="flex",setTimeout(()=>{"flex"===i.style.display&&(i.style.display="none")},e))}static hideToastError(){const t=document.querySelector('[next-checkout-element="spreedly-error"]');t instanceof HTMLElement&&(t.style.display="none")}}new yd;const bd={EMAIL:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?$/,PHONE:/^[\d\s\-\+\(\)]+$/,NAME:/^[A-Za-zÃ€-Ã¿]+(?:[' -][A-Za-zÃ€-Ã¿]+)*$/,CITY:/^[\p{L}\s.''-]+$/u};class xd{constructor(t,e,i){this.rules=new Map,this.errors=new Map,this.logger=t,this.countryService=e,this.phoneInputManager=i,this.errorManager=new yd,this.initializeValidationRules()}setCreditCardService(t){this.creditCardService=t}setPhoneValidator(t){this.phoneValidator=t}initializeValidationRules(){const t={type:"required",message:"This field is required"},e={type:"name",message:"Name can only contain letters, spaces, hyphens, and apostrophes"};this.rules.set("email",[t,{type:"email",message:"Please enter a valid email address"}]),this.rules.set("fname",[t,e]),this.rules.set("lname",[t,e]),this.rules.set("address1",[t]),this.rules.set("city",[t,{type:"city",message:"Please enter a valid city name"}]),this.rules.set("postal",[t]),this.rules.set("country",[t]),this.rules.set("phone",[{type:"phone",message:"Please enter a valid phone number"}])}validateField(t,e,i){const n=this.rules.get(t)||[];let r,s=!0;for(const o of n)if(!this.applyRule(o,e,i)){r=o.message||`${this.formatFieldName(t,i)} is invalid`,this.setError(t,r),s=!1;break}s&&this.clearError(t);const a={isValid:s};return void 0!==r&&(a.message=r),a}validateForm(t,e,i,n=!1,r,s=!0){return g(this,null,function*(){let a,o=!0;const c={},l=e.get(t.country),d=["fname","lname","email","address1","city"],p=document.querySelector('[name="phone"]');if(p&&(p.hasAttribute("required")||"true"===p.dataset.nextRequired)&&d.push("phone"),(null==l?void 0:l.stateRequired)&&d.push("province"),d.push("postal","country"),d.forEach(e=>{t[e]&&""!==t[e].trim()||(c[e]=`${this.formatFieldName(e,i)} is required`,o=!1)}),t.fname&&t.fname.trim()&&!this.isValidName(t.fname)&&(c.fname="First name can only contain letters, spaces, hyphens, and apostrophes",o=!1),t.lname&&t.lname.trim()&&!this.isValidName(t.lname)&&(c.lname="Last name can only contain letters, spaces, hyphens, and apostrophes",o=!1),t.city&&t.city.trim()&&!this.isValidCity(t.city)&&(c.city="Please enter a valid city name",o=!1),t.email&&!this.isValidEmail(t.email)&&(c.email="Please enter a valid email address",o=!1),t.phone){let e=!1;if(this.phoneValidator)e=this.phoneValidator(t.phone,"shipping");else if(this.phoneInputManager){e=this.phoneInputManager.validatePhoneNumber(!0);const i=this.phoneInputManager.getFormattedPhoneNumber(!0);i&&(t.phone=i)}else e=this.isValidPhone(t.phone);e||(c.phone="Please enter a valid phone number",o=!1)}if(t.postal&&t.country){const i=e.get(t.country);if(i&&!this.countryService.validatePostalCode(t.postal,t.country,i)){const t=i.postcodeExample?`Please enter a valid ${i.postcodeLabel.toLowerCase()} (e.g. ${i.postcodeExample})`:`Please enter a valid ${i.postcodeLabel.toLowerCase()}`;c.postal=t,o=!1}}if(n){const e=t.paymentMethod||"credit-card";if("credit-card"===e||"card_token"===e){const e={full_name:`${t.fname||""} ${t.lname||""}`.trim(),month:t["exp-month"]||t["cc-month"]||"",year:t["exp-year"]||t["cc-year"]||""};if(this.creditCardService){const t=this.creditCardService.checkSpreedlyFieldsReady();t.hasEmptyFields&&(t.errors.forEach(t=>{const e="number"===t.field?"cc-number":"cvv";c[e]=t.message}),o=!1);const i=this.creditCardService.validateCreditCard(e);!i.isValid&&i.errors&&(Object.entries(i.errors).forEach(([t,e])=>{c[t]=e}),o=!1)}}}if(!s&&r){const t=this.validateBillingAddress(r,e);Object.entries(t.errors).forEach(([t,e])=>{c[{first_name:"billing-fname",last_name:"billing-lname",address1:"billing-address1",city:"billing-city",province:"billing-province",postal:"billing-postal",country:"billing-country",phone:"billing-phone"}[t]||`billing-${t}`]=e}),t.isValid||(o=!1)}return!o&&Object.keys(c).length>0&&(a=this.findFirstErrorFieldInDOM(c)),h(u({isValid:o},a&&{firstErrorField:a}),{errors:c})})}findFirstErrorFieldInDOM(t){const e=Object.keys(t);if(0===e.length)return;const i=[];return e.forEach(t=>{const e=this.findFormField(t);if(e){const n=e.getBoundingClientRect().top+window.scrollY;i.push({name:t,element:e,position:n})}}),i.length>0?(i.sort((t,e)=>t.position-e.position),i[0].name):e[0]}applyRule(t,e,i){var n;switch(t.type){case"required":return null!=e&&""!==e.toString().trim();case"email":return!e||this.isValidEmail(e);case"phone":return!e||(this.phoneInputManager?this.phoneInputManager.validatePhoneNumber(!0):this.isValidPhone(e));case"name":return!e||this.isValidName(e);case"city":return!e||this.isValidCity(e);case"postal":if(!e||!(null==i?void 0:i.country))return!0;const r=null==(n=i.countryConfigs)?void 0:n.get(i.country);return!r||this.countryService.validatePostalCode(e,i.country,r);case"custom":return!t.validator||t.validator(e,i);default:return!0}}isValidEmail(t){if(!bd.EMAIL.test(t))return!1;if(t.includes(".."))return!1;const[e,i]=t.split("@");if(!e||!i)return!1;if(e.startsWith(".")||e.endsWith(".")||i.startsWith(".")||i.endsWith("."))return!1;const n=i.split("."),r=n[n.length-1];if(!r||r.length<2)return!1;const s=t.toLowerCase();if([/\.c$/,/\.n$/,/\.o$/].some(t=>t.test(s))){const t=i.split("."),e=t[t.length-1];if(e&&1===e.length)return!1}return!0}isValidPhone(t){return bd.PHONE.test(t)&&t.replace(/\D/g,"").length>=10}isValidName(t){return bd.NAME.test(t.trim())}isValidCity(t){const e=t.trim();return!!e&&!(e.length<2)&&!/\d/.test(e)&&!/---+/.test(e)&&!/\s{3,}/.test(e)&&!!/^[\p{L}]/u.test(e)&&bd.CITY.test(e)}formatFieldName(t,e){return{fname:"First name",lname:"Last name",address1:"Address",address2:"Address line 2",city:"City",province:(null==e?void 0:e.stateLabel)||"State/Province",postal:(null==e?void 0:e.postcodeLabel)||"Postal code",country:"Country",email:"Email",phone:"Phone number"}[t]||t}validateBillingAddress(t,e){const i={};let n=!0;const r=["first_name","last_name","address1","city","country"],s=e.get(null==t?void 0:t.country);if((null==s?void 0:s.stateRequired)&&r.push("province"),r.push("postal"),r.forEach(e=>{const r=null==t?void 0:t[e];if(r&&""!==r.trim()){if(("first_name"===e||"last_name"===e)&&r.trim()&&!this.isValidName(r)){const t="first_name"===e?"First name":"Last name";i[e]=`Billing ${t.toLowerCase()} can only contain letters, spaces, hyphens, and apostrophes`,n=!1}}else{const t="first_name"===e?"First name":"last_name"===e?"Last name":"address1"===e?"Address":"city"===e?"City":"province"===e?"State/Province":"postal"===e?"ZIP/Postal code":"country"===e?"Country":e;i[e]=`Billing ${t.toLowerCase()} is required`,n=!1}}),null==t?void 0:t.phone){let e=!1;e=this.phoneValidator?this.phoneValidator(t.phone,"billing"):this.isValidPhone(t.phone),e||(i.phone="Please enter a valid billing phone number",n=!1)}if((null==t?void 0:t.postal)&&(null==t?void 0:t.country)){const r=e.get(t.country);if(r&&!this.countryService.validatePostalCode(t.postal,t.country,r)){const t=r.postcodeExample?`Please enter a valid billing ${r.postcodeLabel.toLowerCase()} (e.g. ${r.postcodeExample})`:`Please enter a valid billing ${r.postcodeLabel.toLowerCase()}`;i.postal=t,n=!1}}return{isValid:n,errors:i}}setError(t,e){this.errors.set(t,e),this.showError(t,e)}clearError(t){this.errors.delete(t),this.hideErrorOnly(t)}clearAllErrors(){this.errors.clear(),document.querySelectorAll("[data-next-checkout-field], [os-checkout-field]").forEach(t=>{const e=t.getAttribute("data-next-checkout-field")||t.getAttribute("os-checkout-field");e&&this.hideErrorOnly(e)}),this.creditCardService&&this.creditCardService.clearAllErrors()}showError(t,e){const i=this.findFormField(t);i?(this.logger.debug(`Showing error for field ${t}:`,{field:i,message:e}),this.errorManager.showFieldError(i,e)):this.logger.warn(`Field not found for error display: ${t}`)}hideErrorOnly(t){const e=this.findFormField(t);e&&this.errorManager.clearFieldError(e)}findFormField(t){return md.findField(t)}focusFirstErrorField(t){if(!t)return;if(["cc-month","cc-year","number","cvv","exp-month","exp-year"].includes(t))return void this.focusCreditCardErrorField(t);const e=this.findFormField(t);e&&"focus"in e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{e.focus()},800))}focusCreditCardErrorField(t){if("cc-number"===t||"number"===t)"undefined"!=typeof window&&window.Spreedly&&window.Spreedly.transferFocus("number");else if("cvv"===t)"undefined"!=typeof window&&window.Spreedly&&window.Spreedly.transferFocus("cvv");else{const e=this.findFormField(t);e&&"focus"in e&&e.focus()}}isValid(){return 0===this.errors.size}destroy(){this.clearAllErrors(),this.logger.debug("CheckoutValidator destroyed")}}class wd{constructor(){this.handlers=new Map,this.bindings=[]}addHandler(t,e,i,n){if(!t)return;this.handlers.has(t)||this.handlers.set(t,new Map);const r=this.handlers.get(t);if(r.has(e)){const i=r.get(e);t.removeEventListener(e,i)}t.addEventListener(e,i,n),r.set(e,i);const s={element:t,event:e,handler:i};void 0!==n&&(s.options=n),this.bindings.push(s)}addHandlers(t){t.forEach(t=>{this.addHandler(t.element,t.event,t.handler,t.options)})}removeHandler(t,e){if(!t)return;const i=this.handlers.get(t);if(!i)return;const n=i.get(e);n&&(t.removeEventListener(e,n),i.delete(e),this.bindings=this.bindings.filter(i=>!(i.element===t&&i.event===e))),0===i.size&&this.handlers.delete(t)}removeElementHandlers(t){const e=this.handlers.get(t);e&&(e.forEach((e,i)=>{t.removeEventListener(i,e)}),this.handlers.delete(t),this.bindings=this.bindings.filter(e=>e.element!==t))}removeAllHandlers(){this.handlers.forEach((t,e)=>{t.forEach((t,i)=>{e.removeEventListener(i,t)})}),this.handlers.clear(),this.bindings=[]}addDelegatedHandler(t,e,i,n){this.addHandler(t,i,i=>{const r=i.target.closest(e);r&&t.contains(r)&&n(i,r)})}addDebouncedHandler(t,e,i,n=300){let r;this.addHandler(t,e,t=>{r&&clearTimeout(r),r=window.setTimeout(()=>{i(t)},n)})}addThrottledHandler(t,e,i,n=300){let r=!1;this.addHandler(t,e,t=>{r||(i(t),r=!0,setTimeout(()=>{r=!1},n))})}addOnceHandler(t,e,i){this.addHandler(t,e,n=>{i(n),this.removeHandler(t,e)})}getActiveBindings(){return[...this.bindings]}hasHandler(t,e){const i=this.handlers.get(t);return!!i&&i.has(e)}}class _d{constructor(t,e,i,n){this.floatingLabels=new Map,this.loadingStates=new Map,this.lastErrorsString="",this.form=t,this.fields=e,this.logger=i,n&&(this.billingFields=n),this.errorManager=new yd,this.eventManager=new wd}initialize(){this.initializeFloatingLabels(),this.logger.debug("UIService initialized")}showLoading(t){this.loadingStates.set(t,!0),this.form.classList.add("next-processing");const e=this.form.querySelector(`[data-section="${t}"]`);e instanceof HTMLElement&&e.classList.add("next-loading"),this.logger.debug(`Showing loading state for section: ${t}`)}hideLoading(t){this.loadingStates.set(t,!1),Array.from(this.loadingStates.values()).some(t=>t)||this.form.classList.remove("next-processing");const e=this.form.querySelector(`[data-section="${t}"]`);e instanceof HTMLElement&&e.classList.remove("next-loading"),this.logger.debug(`Hiding loading state for section: ${t}`)}updateProgress(t){const e=this.form.querySelector(".next-progress-bar");if(e instanceof HTMLElement){const i=e.querySelector(".next-progress-fill");if(i instanceof HTMLElement){const e=Math.min(100,Math.max(0,25*t));i.style.width=`${e}%`,i.setAttribute("aria-valuenow",e.toString())}}this.logger.debug(`Updated progress to step: ${t}`)}displayErrors(t,e){this.errorManager.clearAllErrors(this.form);const i={};Object.entries(t).forEach(([t,e])=>{if("cc-number"===t||"cvv"===t){const e="cc-number"===t?"spreedly-number":"spreedly-cvv",i=document.getElementById(e);if(i&&i.classList.contains("no-error"))return}i[t]=e}),Object.entries(i).forEach(([t,e])=>{let i=this.fields.get(t);!i&&t.startsWith("billing-")&&this.billingFields&&(i=this.billingFields.get(t)),i?this.errorManager.showFieldError(i,e):this.logger.warn(`Field element not found for error: ${t}`)}),e&&this.focusFirstError(e)}focusFirstError(t){let e=this.fields.get(t);if(!e&&t.startsWith("billing-")&&this.billingFields&&(e=this.billingFields.get(t)),!e)return void this.logger.warn(`Field '${t}' not found for scrolling`);const i=(e.closest(".frm-flds")||e).getBoundingClientRect().top+window.scrollY-100;window.scrollTo({top:Math.max(0,i),behavior:"smooth"}),(e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement)&&setTimeout(()=>{try{e.focus(),e.style.outline="2px solid #ff6b6b",e.style.outlineOffset="2px",setTimeout(()=>{e.style.outline="",e.style.outlineOffset=""},2e3)}catch(t){this.logger.debug("Could not focus field after scroll:",t)}},300),this.logger.debug(`Scrolled to field: ${t}`)}updateFieldState(t,e){let i=this.fields.get(t);if(!i&&t.startsWith("billing-")&&this.billingFields&&(i=this.billingFields.get(t)),i){switch(i.classList.remove("next-error-field","next-valid-field","next-neutral-field"),e){case"valid":i.classList.add("next-valid-field");break;case"invalid":i.classList.add("next-error-field");break;case"neutral":i.classList.add("next-neutral-field")}this.logger.debug(`Updated field ${t} state to: ${e}`)}else this.logger.warn(`Field '${t}' not found for state update`)}handleCheckoutUpdate(t,e){const i=JSON.stringify(t.errors||{});i!==this.lastErrorsString&&(this.lastErrorsString=i,t.errors&&Object.keys(t.errors).length>0?e(t.errors):e({})),t.isProcessing?this.showLoading("checkout"):this.hideLoading("checkout")}handleCartUpdate(t){t.isEmpty&&this.logger.warn("Cart is empty, redirecting to cart page")}initializePaymentForms(){this.logger.debug("Initializing payment forms"),this.form.querySelectorAll("[data-next-payment-method]").forEach(t=>{if(t instanceof HTMLElement){const e=t.querySelector('input[type="radio"]'),i=t.querySelector("[data-next-payment-form]");if(!(e instanceof HTMLInputElement&&i instanceof HTMLElement))return;const n="expanded"===i.getAttribute("data-next-payment-state")||i.classList.contains("payment-method__form--expanded");e.checked||n?(t.classList.add("next-selected"),i.setAttribute("data-next-payment-state","expanded"),i.classList.add("payment-method__form--expanded"),i.classList.remove("payment-method__form--collapsed"),i.classList.remove("payment-method__form--collapsing"),i.classList.remove("payment-method__form--expanding"),i.style.height="",i.style.overflow="",i.style.transition=""):(t.classList.remove("next-selected"),i.setAttribute("data-next-payment-state","collapsed"),i.classList.add("payment-method__form--collapsed"),i.classList.remove("payment-method__form--expanded"),i.classList.remove("payment-method__form--expanding"),i.classList.remove("payment-method__form--collapsing"),i.style.height="0px",i.style.overflow="hidden",i.style.transition="")}})}updatePaymentFormVisibility(t){this.logger.debug("Updating payment form visibility for method:",t),this.form.querySelectorAll("[data-next-payment-method]").forEach(e=>{if(e instanceof HTMLElement){const i=e.querySelector('input[type="radio"]'),n=e.querySelector("[data-next-payment-form]");if(!(i instanceof HTMLInputElement&&n instanceof HTMLElement))return;if(i&&n){const r=i.value===t;this.logger.debug(`Payment method ${i.value}: ${r?"selected":"not selected"}`),r?(e.classList.add("next-selected"),n.setAttribute("data-next-payment-state","expanded"),this.expandPaymentForm(n),this.clearPaymentFormErrors(n)):(e.classList.remove("next-selected"),n.setAttribute("data-next-payment-state","collapsed"),this.collapsePaymentForm(n),this.clearPaymentFormErrors(n))}}})}expandPaymentForm(t){if(t.classList.contains("payment-method__form--expanded"))return;t.style.overflow="hidden";const e=t.offsetHeight;t.classList.remove("payment-method__form--collapsed"),t.classList.add("payment-method__form--expanding"),t.style.height="auto";const i=t.scrollHeight;t.style.height=e+"px",t.offsetHeight,requestAnimationFrame(()=>{t.style.transition="height 0.3s cubic-bezier(0.4, 0, 0.2, 1)",t.style.height=i+"px",setTimeout(()=>{t.classList.remove("payment-method__form--expanding"),t.classList.add("payment-method__form--expanded"),t.style.height="",t.style.transition="",t.style.overflow=""},300)}),this.logger.debug("Expanded payment form")}collapsePaymentForm(t){if(t.classList.contains("payment-method__form--collapsed"))return;t.style.overflow="hidden";const e=t.scrollHeight;t.classList.remove("payment-method__form--expanded"),t.classList.add("payment-method__form--collapsing"),t.style.height=e+"px",t.offsetHeight,requestAnimationFrame(()=>{t.style.transition="height 0.3s cubic-bezier(0.4, 0, 0.2, 1)",t.style.height="0px",setTimeout(()=>{t.classList.remove("payment-method__form--collapsing"),t.classList.add("payment-method__form--collapsed"),t.style.transition=""},300)}),this.logger.debug("Collapsed payment form")}clearPaymentFormErrors(t){this.errorManager.clearAllErrors(t),t.querySelectorAll("input, select, textarea").forEach(t=>{t.classList.remove("no-error","has-error","next-error-field");const e=t.closest(".form-group");e&&e.classList.remove("addTick","addErrorIcon","has-error");const i=t.closest(".form-input");i&&i.classList.remove("addTick","addErrorIcon")}),this.logger.debug("Cleared payment form errors")}initializeFloatingLabels(){this.logger.debug("Initializing floating labels"),this.form.querySelectorAll(".form-group").forEach(t=>{const e=t.querySelector(".label-checkout"),i=t.querySelector("input[data-next-checkout-field], input[os-checkout-field], select[data-next-checkout-field], select[os-checkout-field]");e instanceof HTMLLabelElement&&(i instanceof HTMLInputElement||i instanceof HTMLSelectElement)&&this.setupFloatingLabel(i,e)}),this.setupSpreedlyFloatingLabels(),this.logger.debug(`Initialized ${this.floatingLabels.size} floating labels`),this.startPeriodicCheck()}setupSpreedlyFloatingLabels(){var t,e;const i=this.form.querySelector('[data-next-checkout-field="cc-number"], #spreedly-number');if(i){const e=null==(t=i.parentElement)?void 0:t.querySelector(".label-checkout");e instanceof HTMLLabelElement&&(this.floatingLabels.set(i,e),this.setupLabelStyles(e),"placeholder"===i.getAttribute("data-label-behavior")&&this.floatLabelDown(e,i),this.logger.debug("Set up Spreedly floating label for credit card number"))}const n=this.form.querySelector('[data-next-checkout-field="cvv"], #spreedly-cvv');if(n){const t=null==(e=n.parentElement)?void 0:e.querySelector(".label-checkout");t instanceof HTMLLabelElement&&(this.floatingLabels.set(n,t),this.setupLabelStyles(t),"placeholder"===n.getAttribute("data-label-behavior")&&this.floatLabelDown(t,n),this.logger.debug("Set up Spreedly floating label for CVV"))}}handleSpreedlyFieldFocus(t){const e="number"===t?"spreedly-number":"spreedly-cvv",i=document.getElementById(e)||this.form.querySelector(`[data-next-checkout-field="${"number"===t?"cc-number":"cvv"}"]`);if(!i)return void this.logger.warn(`Spreedly field not found: ${t}`);const n=this.floatingLabels.get(i);n&&("placeholder"===i.getAttribute("data-label-behavior")&&this.floatLabelUp(n,i,"focus"),this.logger.debug(`Spreedly field focused: ${t}`))}handleSpreedlyFieldBlur(t,e){const i="number"===t?"spreedly-number":"spreedly-cvv",n=document.getElementById(i)||this.form.querySelector(`[data-next-checkout-field="${"number"===t?"cc-number":"cvv"}"]`);if(!n)return void this.logger.warn(`Spreedly field not found: ${t}`);const r=this.floatingLabels.get(n);r&&("placeholder"===n.getAttribute("data-label-behavior")?e||this.floatLabelDown(r,n):e?this.floatLabelUp(r,n):this.floatLabelDown(r,n),this.logger.debug(`Spreedly field blurred: ${t}, hasValue: ${e}`))}handleSpreedlyFieldInput(t,e){const i="number"===t?"spreedly-number":"spreedly-cvv",n=document.getElementById(i)||this.form.querySelector(`[data-next-checkout-field="${"number"===t?"cc-number":"cvv"}"]`);if(!n)return void this.logger.warn(`Spreedly field not found: ${t}`);const r=this.floatingLabels.get(n);if(r){const i=n.getAttribute("data-label-behavior"),s=n.classList.contains("next-focused")||n.classList.contains("has-focus");"placeholder"===i?s||e?this.floatLabelUp(r,n,s?"focus":"value"):this.floatLabelDown(r,n):e?this.floatLabelUp(r,n):this.floatLabelDown(r,n),this.logger.debug(`Spreedly field input: ${t}, hasValue: ${e}`)}}setupFloatingLabel(t,e){if(!e){const i=t.closest(".form-group");if(i){const t=i.querySelector(".label-checkout");t instanceof HTMLLabelElement&&(e=t)}}e?(this.floatingLabels.set(t,e),this.setupLabelStyles(e),this.setupFieldStyles(t),this.updateLabelState(t,e),this.eventManager.addHandler(t,"input",t=>this.handleInput(t)),this.eventManager.addHandler(t,"focus",t=>this.handleFocus(t)),this.eventManager.addHandler(t,"blur",t=>this.handleBlur(t)),this.eventManager.addHandler(t,"change",t=>this.handleInput(t)),this.eventManager.addHandler(t,"animationstart",t=>this.handleAutofill(t)),this.logger.debug("Set up floating label for field:",t.getAttribute("data-next-checkout-field")||t.name)):this.logger.warn("No label found for floating label setup")}setupLabelStyles(t){t.style.transition||(t.style.transition="all 0.15s ease-in-out")}setupFieldStyles(t){const e=t.closest(".form-input");e instanceof HTMLElement&&(e.style.position="relative")}handleInput(t){const e=t.target,i=this.floatingLabels.get(e);i&&this.updateLabelState(e,i)}handleFocus(t){const e=t.target,i=this.floatingLabels.get(e);i&&("placeholder"===e.getAttribute("data-label-behavior")?this.floatLabelUp(i,e,"focus"):this.hasValue(e)&&this.floatLabelUp(i,e))}handleBlur(t){const e=t.target,i=this.floatingLabels.get(e);i&&("placeholder"===e.getAttribute("data-label-behavior")?this.hasValue(e)||this.floatLabelDown(i,e):this.updateLabelState(e,i))}handleAutofill(t){if("autofill"===t.animationName){const e=t.target,i=this.floatingLabels.get(e);i&&setTimeout(()=>{this.updateLabelState(e,i)},100)}}updateLabelState(t,e){if("placeholder"===t.getAttribute("data-label-behavior")){const i=document.activeElement===t;i||this.hasValue(t)?this.floatLabelUp(e,t,i?"focus":"value"):this.floatLabelDown(e,t)}else this.hasValue(t)?this.floatLabelUp(e,t):this.floatLabelDown(e,t)}hasValue(t){var e;return t instanceof HTMLSelectElement?""!==t.value&&t.value!==(null==(e=t.querySelector("option"))?void 0:e.value):""!==t.value.trim()}floatLabelUp(t,e,i="value"){t.classList.contains("has-value")?"focus"!==i||t.classList.contains("is-focused")||t.classList.add("is-focused"):(t.classList.add("has-value"),"focus"===i&&t.classList.add("is-focused"),e.style.paddingTop="14px","placeholder"===e.getAttribute("data-label-behavior")&&e instanceof HTMLInputElement&&(e.setAttribute("data-original-placeholder",e.placeholder||""),e.placeholder=""),this.logger.debug(`Added has-value class for field (${i}):`,e.getAttribute("data-next-checkout-field")||e.name))}floatLabelDown(t,e){if(t.classList.contains("has-value")){if(t.classList.remove("has-value","is-focused"),e.style.paddingTop="","placeholder"===e.getAttribute("data-label-behavior")&&e instanceof HTMLInputElement){const t=e.getAttribute("data-original-placeholder");null!==t&&(e.placeholder=t)}this.logger.debug("Removed has-value class for field:",e.getAttribute("data-next-checkout-field")||e.name)}}startPeriodicCheck(){this.periodicCheckInterval=window.setInterval(()=>{this.checkAllFieldsForChanges()},500)}checkAllFieldsForChanges(){this.floatingLabels.forEach((t,e)=>{(e instanceof HTMLInputElement||e instanceof HTMLSelectElement)&&this.updateLabelState(e,t)})}updateLabelsForPopulatedData(){this.floatingLabels.forEach((t,e)=>{(e instanceof HTMLInputElement||e instanceof HTMLSelectElement)&&this.updateLabelState(e,t)}),this.logger.debug("Updated all floating labels for populated data")}handleResponsiveUI(){const t=window.innerWidth<=768,e=window.innerWidth<=1024&&window.innerWidth>768;this.form.classList.toggle("next-mobile",t),this.form.classList.toggle("next-tablet",e),this.form.classList.toggle("next-desktop",!t&&!e),t&&this.floatingLabels.forEach((t,e)=>{e.addEventListener("focus",()=>{this.floatLabelUp(t,e)})}),this.logger.debug("Handled responsive UI adjustments for "+(t?"mobile":e?"tablet":"desktop"))}enhanceAccessibility(){this.fields.forEach((t,e)=>{var i;if(t instanceof HTMLInputElement||t instanceof HTMLSelectElement){const n=null==(i=t.parentElement)?void 0:i.querySelector(".next-error-label");if(n){const i=`${e}-error`;n.id=i,t.setAttribute("aria-describedby",i),t.setAttribute("aria-invalid","true")}else t.removeAttribute("aria-describedby"),t.setAttribute("aria-invalid","false");(t.hasAttribute("required")||"true"===t.getAttribute("data-required"))&&t.setAttribute("aria-required","true")}}),this.logger.debug("Enhanced accessibility features")}destroy(){this.periodicCheckInterval&&(clearInterval(this.periodicCheckInterval),delete this.periodicCheckInterval),this.eventManager.removeAllHandlers(),this.floatingLabels.clear(),this.loadingStates.clear(),this.logger.debug("UIService destroyed")}}class kd extends be{constructor(){super(...arguments),this.config={autoCreate:!0,triggerOn:"emailEntry",emailField:"email",includeUtmData:!0,sessionTimeout:30},this.hasTriggered=!1,this.hasTrackedBeginCheckout=!1,this.updateTimeout=0}initialize(){return g(this,null,function*(){this.validateElement(),this.logger.info("Initializing ProspectCartEnhancer",{element:this.element.tagName,config:this.config});const t=yt.getState();this.apiClient=new re(t.apiKey),this.loadConfig(),this.findEmailField(),this.subscribe(Tt,this.handleCartUpdate.bind(this)),this.setupTriggers(),this.checkExistingProspectCart(),this.logger.debug("ProspectCartEnhancer initialized",{emailFieldFound:!!this.emailField,triggerOn:this.config.triggerOn,autoCreate:this.config.autoCreate})})}update(t){(null==t?void 0:t.config)&&(this.config=u(u({},this.config),t.config),this.setupTriggers())}loadConfig(){const t=this.getAttribute("data-prospect-config");if(t)try{const e=JSON.parse(t);this.config=u(u({},this.config),e)}catch(e){this.logger.warn("Invalid prospect config JSON:",e)}if(this.hasAttribute("data-auto-create")&&(this.config.autoCreate="false"!==this.getAttribute("data-auto-create")),this.hasAttribute("data-trigger-on")){const t=this.getAttribute("data-trigger-on");!t||"formStart"!==t&&"emailEntry"!==t&&"manual"!==t||(this.config.triggerOn=t)}if(this.hasAttribute("data-email-field")){const t=this.getAttribute("data-email-field");t&&(this.config.emailField=t)}}findEmailField(){const t=['[data-next-checkout-field="email"]','[os-checkout-field="email"]',`input[name="${this.config.emailField}"]`,'input[type="email"]','input[data-field="email"]','input[name*="email"]'];for(const e of t){const t=this.element.querySelector(e);if(t){this.emailField=t,this.logger.debug("Found email field with selector:",e);break}}this.emailField||this.logger.warn("Email field not found for prospect cart")}getFormattedPhoneNumber(){var t,e;const i=this.element.querySelector('[data-next-checkout-field="phone"], [os-checkout-field="phone"], input[name="phone"], input[type="tel"]');if(!i)return"";const n=null==(e=null==(t=window.intlTelInputGlobals)?void 0:t.getInstance)?void 0:e.call(t,i);if(n&&"function"==typeof n.getNumber)try{const t=n.getNumber();if(t)return this.logger.debug("Got E.164 formatted phone from existing instance:",t),t}catch(r){this.logger.warn("Failed to get E.164 formatted phone from existing instance:",r)}return this.logger.debug("Using raw phone value (intlTelInput instance not found)"),i.value||""}setupTriggers(){if(this.config.autoCreate)switch(this.config.triggerOn){case"formStart":this.setupFormStartTrigger();break;case"emailEntry":this.setupEmailEntryTrigger()}}setupFormStartTrigger(){this.element.querySelectorAll("input, select, textarea").forEach(t=>{const e=()=>{this.hasTriggered||(this.createProspectCart(),this.hasTriggered=!0)};t.addEventListener("focus",e,{once:!0}),t.addEventListener("input",e,{once:!0})})}setupEmailEntryTrigger(){if(!this.emailField)return void this.logger.warn("Cannot setup email entry trigger - email field not found");this.logger.debug("Setting up email entry trigger on field:",this.emailField);const t=this.element.querySelector('[data-next-checkout-field="fname"], [os-checkout-field="fname"], input[name="first_name"]'),e=this.element.querySelector('[data-next-checkout-field="lname"], [os-checkout-field="lname"], input[name="last_name"]');let i,n="";const r=()=>{i&&clearTimeout(i),i=window.setTimeout(()=>{this.logger.debug("Checking if all required fields are valid for cart creation"),this.checkAndCreateCart()},300)};this.emailField.addEventListener("blur",()=>{var t;const e=this.emailField.value.trim();e!==n&&e.length>0&&(n=e,this.logger.debug("Email blur event processed, value:",e),e.includes("@")&&(null==(t=e.split("@")[1])?void 0:t.includes("."))?r():this.logger.debug("Email appears incomplete, skipping cart creation:",e))}),this.emailField.addEventListener("change",()=>{const t=this.emailField.value.trim();this.isValidEmail(t)&&(this.logger.debug("Valid email detected on change event:",t),r())}),t&&(t.addEventListener("blur",()=>{t.value.trim().length>=2&&(this.logger.debug("First name blur event, checking cart creation"),r())}),t.addEventListener("change",()=>{const e=t.value.trim();this.isValidName(e)&&(this.logger.debug("Valid first name detected on change event:",e),r())})),e&&(e.addEventListener("blur",()=>{e.value.trim().length>=2&&(this.logger.debug("Last name blur event, checking cart creation"),r())}),e.addEventListener("change",()=>{const t=e.value.trim();this.isValidName(t)&&(this.logger.debug("Valid last name detected on change event:",t),r())}))}checkExistingProspectCart(){const t=sessionStorage.getItem("next_prospect_cart");if(t)try{const e=JSON.parse(t);new Date(e.expires_at)>new Date?(this.prospectCart=e,this.logger.debug("Restored existing prospect cart:",e.id)):sessionStorage.removeItem("next_prospect_cart")}catch(e){this.logger.warn("Failed to parse stored prospect cart:",e),sessionStorage.removeItem("next_prospect_cart")}}createProspectCart(){return g(this,null,function*(){var t,e,i;if(this.prospectCart)this.logger.debug("Prospect cart already exists");else{this.logger.info("Starting prospect cart creation");try{const s=Tt.getState(),a=(null==(t=this.emailField)?void 0:t.value)||"";if(this.logger.debug("Cart state:",{isEmpty:s.isEmpty,itemCount:s.items.length,items:s.items,email:a}),s.isEmpty||0===s.items.length)return void this.logger.warn("No items in cart, skipping prospect cart creation");const o=(null==(e=this.element.querySelector('[data-next-checkout-field="fname"], [os-checkout-field="fname"], input[name="first_name"]'))?void 0:e.value)||"",c=(null==(i=this.element.querySelector('[data-next-checkout-field="lname"], [os-checkout-field="lname"], input[name="last_name"]'))?void 0:i.value)||"",l=this.getFormattedPhoneNumber(),d=Nt.getState().getAttributionForApi();d.metadata&&(d.metadata.landing_page=window.location.href,d.metadata.referrer||(d.metadata.referrer=document.referrer||""),d.metadata.domain||(d.metadata.domain=window.location.hostname),d.metadata.device||(d.metadata.device=navigator.userAgent||""),d.metadata.timestamp=Date.now()),d.funnel&&""!==d.funnel||(d.funnel="CH01");const u={first_name:o,last_name:c,language:"en",accepts_marketing:!0};a&&(u.email=a),l&&(u.phone_number=l);const h={lines:s.items.map(t=>({package_id:t.packageId,quantity:t.quantity,is_upsell:t.is_upsell||!1})),user:u,currency:this.getCurrency()};let p;d&&Object.keys(d).length>0&&(h.attribution=d),this.logger.debug("Creating prospect cart with data:",{hasAddress:!1,hasAttribution:!!h.attribution,attribution:d,userData:h.user,itemCount:h.lines.length});try{p=yield this.apiClient.createCart(h)}catch(n){if(this.logger.warn("Initial prospect cart creation failed, retrying with minimal data:",n),!this.isValidEmail(a))throw n;const t={lines:s.items.map(t=>({package_id:t.packageId,quantity:t.quantity})),user:{email:a,first_name:"",last_name:"",language:"en"},currency:this.getCurrency()};this.logger.info("Retrying prospect cart creation with minimal data (email only)");try{p=yield this.apiClient.createCart(t),this.logger.info("Successfully created prospect cart with minimal data")}catch(r){throw this.logger.error("Failed to create prospect cart even with minimal data:",r),r}}this.prospectCart={id:p.checkout_url||"",prospect_id:p.checkout_url||"",created_at:(new Date).toISOString(),expires_at:new Date(Date.now()+60*(this.config.sessionTimeout||30)*1e3).toISOString(),utm_data:this.collectUtmData(),cart_data:p},a&&(this.prospectCart.email=a),sessionStorage.setItem("next_prospect_cart",JSON.stringify(this.prospectCart)),this.emitProspectEvent("cart-created",{cart:p,prospectCart:this.prospectCart}),this.logger.info("Prospect cart created with checkout URL:",p.checkout_url)}catch(s){this.logger.error("Failed to create prospect cart:",s)}}})}updateProspectCart(){return g(this,null,function*(){this.prospectCart&&this.logger.debug("Prospect cart update skipped - using standard cart API")})}collectUtmData(){const t=new URLSearchParams(window.location.search),e={};["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].forEach(i=>{const n=t.get(i);n&&(e[i]=n)});const i=sessionStorage.getItem("next_utm_data");if(i)try{const t=JSON.parse(i);Object.assign(e,t)}catch(n){this.logger.warn("Failed to parse stored UTM data:",n)}return Object.keys(e).length>0&&sessionStorage.setItem("next_utm_data",JSON.stringify(e)),e}getCurrency(){var t;const e=dt.getState();if(null==(t=null==e?void 0:e.data)?void 0:t.currency)return e.data.currency;const i=yt.getState();return(null==i?void 0:i.selectedCurrency)||(null==i?void 0:i.detectedCurrency)||"USD"}isValidEmail(t){if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?$/.test(t))return!1;if(t.includes(".."))return!1;const[e,i]=t.split("@");if(!e||!i)return!1;if(e.startsWith(".")||e.endsWith(".")||i.startsWith(".")||i.endsWith("."))return!1;const n=i.split("."),r=n[n.length-1];return!(!r||r.length<2)}isValidName(t){return!(!t||0===t.trim().length)&&(!(t.trim().length<2)&&/^[A-Za-zÃ€-Ã¿]+(?:[' -][A-Za-zÃ€-Ã¿]+)*$/.test(t.trim()))}handleCartUpdate(t){this.prospectCart&&!t.isEmpty&&(clearTimeout(this.updateTimeout),this.updateTimeout=window.setTimeout(()=>{this.updateProspectCart()},1e3))}emitProspectEvent(t,e){const i=new CustomEvent(`next:prospect-${t}`,{detail:e,bubbles:!0});this.element.dispatchEvent(i)}createCartManually(){return g(this,null,function*(){return yield this.createProspectCart(),this.prospectCart||null})}getCurrentProspectCart(){return this.prospectCart||null}abandonCart(){return g(this,null,function*(){this.prospectCart&&(this.emitProspectEvent("cart-abandoned",{prospectCart:this.prospectCart}),sessionStorage.removeItem("next_prospect_cart"),this.prospectCart=void 0,this.logger.info("Prospect cart marked as abandoned"))})}convertCart(){return g(this,null,function*(){this.prospectCart&&(this.emitProspectEvent("cart-converted",{prospectCart:this.prospectCart}),sessionStorage.removeItem("next_prospect_cart"),this.prospectCart=void 0,this.logger.info("Prospect cart converted to order"))})}updateEmail(t){this.emailField&&(this.emailField.value=t),this.isValidEmail(t.trim())?this.checkAndCreateCart():this.logger.debug("updateEmail called with invalid email:",t)}checkAndCreateCart(){var t,e,i,n,r,s;const a=(null==(e=null==(t=this.element.querySelector('[data-next-checkout-field="email"], [os-checkout-field="email"], input[type="email"]'))?void 0:t.value)?void 0:e.trim())||"",o=(null==(n=null==(i=this.element.querySelector('[data-next-checkout-field="fname"], [os-checkout-field="fname"], input[name="first_name"]'))?void 0:i.value)?void 0:n.trim())||"",c=(null==(s=null==(r=this.element.querySelector('[data-next-checkout-field="lname"], [os-checkout-field="lname"], input[name="last_name"]'))?void 0:r.value)?void 0:s.trim())||"",l=this.isValidEmail(a),d=this.isValidName(o),u=this.isValidName(c);if(l&&!this.hasTrackedBeginCheckout&&(this.trackBeginCheckout(),this.logger.info("Tracked begin_checkout event on valid email entry:",a)),!this.hasTriggered){if(this.logger.debug("Field validation status for cart creation:",{email:{value:a,valid:l},firstName:{value:o,valid:d},lastName:{value:c,valid:u}}),!l||!d||!u)return void 0!==this.updateEmailTimeout&&(clearTimeout(this.updateEmailTimeout),this.updateEmailTimeout=void 0),void(l?d?u||this.logger.debug("Invalid or missing last name, waiting for valid name:",c):this.logger.debug("Invalid or missing first name, waiting for valid name:",o):this.logger.debug("Invalid or incomplete email, skipping cart creation:",a));void 0!==this.updateEmailTimeout&&(clearTimeout(this.updateEmailTimeout),this.updateEmailTimeout=void 0),void 0!==this.emailBlurTimeout&&clearTimeout(this.emailBlurTimeout),void 0!==this.emailInputTimeout&&clearTimeout(this.emailInputTimeout),this.logger.info("All required fields valid (email, fname, lname), creating prospect cart immediately",{email:a,firstName:o,lastName:c}),this.createProspectCart(),this.hasTriggered=!0}}trackBeginCheckout(){if(!this.hasTrackedBeginCheckout)try{const t=Tt.getState();!t.isEmpty&&t.items.length>0&&($l.track(Sl.createBeginCheckoutEvent()),this.hasTrackedBeginCheckout=!0,this.logger.info("Tracked begin_checkout event on email entry"))}catch(t){this.logger.warn("Failed to track begin_checkout event:",t)}}}const Sd={"credit-card":"card_token",card_token:"card_token",paypal:"paypal",apple_pay:"apple_pay",google_pay:"google_pay"},Pd={paypal:"paypal","apple-pay":"apple_pay","google-pay":"google_pay"};class Cd{constructor(t,e,i,n,r){this.logger=t,this.showLoadingCallback=e,this.hideLoadingCallback=i,this.emitCallback=n,this.orderManager=r}handleExpressCheckout(t,e,i,n){return g(this,null,function*(){let n=!1;try{if(this.showLoadingCallback(),i)return this.logger.warn("Cannot checkout with empty cart"),this.emitCallback("express-checkout:error",{method:t,error:"Cart is empty"}),void(n=!0);const s=Pd[t]||t;try{$l.track(Sl.createBeginCheckoutEvent()),this.logger.info("Tracked begin_checkout event for express checkout",{method:t})}catch(r){this.logger.warn("Failed to track begin_checkout event:",r)}try{const t={paypal:"PayPal",apple_pay:"Apple Pay",google_pay:"Google Pay"}[s]||s;$l.track(Sl.createAddPaymentInfoEvent(t)),this.logger.info("Tracked add_payment_info event for express checkout",{paymentType:t})}catch(r){this.logger.warn("Failed to track add_payment_info event:",r)}this.emitCallback("express-checkout:started",{method:s,itemCount:e.length}),this.logger.info(`Express checkout initiated with ${t}`);const a=yield this.orderManager.createExpressOrder(e,s);this.emitCallback("express-checkout:completed",{method:s,order:a}),this.orderManager.handleOrderRedirect(a)}catch(s){if(n=!0,this.logger.error("Express checkout failed:",s),s.responseData){const e=s.responseData;"paypal"===t&&e.payment_details?this.displayPayPalError(e.payment_details):"apple_pay"!==t&&"google_pay"!==t||!e.payment_details||this.displayExpressPaymentError(t,e.payment_details)}throw this.emitCallback("express-checkout:failed",{method:t,error:s instanceof Error?s.message:"Unknown error"}),s}finally{this.hideLoadingCallback(n)}})}displayPayPalError(t){const e=document.querySelector('[data-next-component="paypal-error"]'),i=document.querySelector('[data-next-component="paypal-error-text"]');e instanceof HTMLElement&&i&&(i.textContent=t+" Please try a different payment method.",e.style.display="flex",this.logger.info("PayPal error displayed:",t)),this.displayGeneralPaymentError(t)}displayExpressPaymentError(t,e){const i=`${"apple_pay"===t?"Apple Pay":"Google Pay"} error: ${e}. Please try a different payment method.`;this.displayGeneralPaymentError(i)}displayGeneralPaymentError(t){const e=document.querySelector('[data-next-component="credit-error"]'),i=document.querySelector('[data-next-component="credit-error-text"]');e instanceof HTMLElement&&i&&(i.textContent=t,e.style.display="flex")}}function Ed(){const t=document.querySelector('meta[name="next-success-url"]')||document.querySelector('meta[name="next-next-url"]')||document.querySelector('meta[name="os-next-page"]');if(null==t?void 0:t.content){if(t.content.startsWith("http://")||t.content.startsWith("https://"))return t.content;const e=t.content.startsWith("/")?t.content:"/"+t.content;return window.location.origin+e}return window.location.origin+"/success"}function $d(){const t=document.querySelector('meta[name="next-failure-url"]')||document.querySelector('meta[name="os-failure-url"]');if(null==t?void 0:t.content){if(t.content.startsWith("http://")||t.content.startsWith("https://"))return t.content;const e=t.content.startsWith("/")?t.content:"/"+t.content;return window.location.origin+e}const e=new URL(window.location.href);return e.searchParams.set("payment_failed","true"),e.href}class Td{getCurrency(){var t;const e=dt.getState();if(null==(t=null==e?void 0:e.data)?void 0:t.currency)return e.data.currency;const i=yt.getState();return(null==i?void 0:i.selectedCurrency)||(null==i?void 0:i.detectedCurrency)||"USD"}buildOrder(t,e,i,n,r,s=!0,a,o=[]){var c;const l={first_name:t.fname||"",last_name:t.lname||"",line1:t.address1||"",line2:t.address2,line4:t.city||"",state:t.province,postcode:t.postal,country:t.country||"",phone_number:t.phone};let d;!s&&r&&(d=u(u(u(u({first_name:r.first_name||"",last_name:r.last_name||"",line1:r.address1||"",line4:r.city||"",country:r.country||""},r.address2&&{line2:r.address2}),r.province&&{state:r.province}),r.postal&&{postcode:r.postal}),r.phone&&{phone_number:r.phone}));const p=u({payment_method:this.mapPaymentMethod(i)},n&&{card_token:n}),f=Nt.getState().getAttributionForApi();return h(u({lines:e.map(t=>({package_id:t.packageId,quantity:t.quantity,is_upsell:t.is_upsell||!1})),shipping_address:l},d&&{billing_address:d}),{billing_same_as_shipping_address:s,shipping_method:(null==a?void 0:a.id)||this.getDefaultShippingMethodId(),payment_detail:p,user:{email:t.email,first_name:t.fname||"",last_name:t.lname||"",language:"en",phone_number:t.phone,accepts_marketing:null==(c=t.accepts_marketing)||c},vouchers:o,attribution:f,currency:this.getCurrency(),success_url:Ed(),payment_failed_url:$d()})}buildExpressOrder(t,e,i=[]){const n=Nt.getState().getAttributionForApi();return{lines:t.map(t=>({package_id:t.packageId,quantity:t.quantity,is_upsell:t.is_upsell||!1})),payment_detail:{payment_method:e},shipping_method:this.getDefaultShippingMethodId(),vouchers:i,attribution:n,currency:this.getCurrency(),success_url:Ed(),payment_failed_url:$d()}}buildTestOrder(t,e=[]){return{lines:t.length>0?t.map(t=>({package_id:t.packageId,quantity:t.quantity,is_upsell:t.is_upsell||!1})):[{package_id:1,quantity:1,is_upsell:!1}],shipping_address:{first_name:"Test",last_name:"Order",line1:"Test Address 123",line2:"",line4:"Tempe",state:"AZ",postcode:"85281",country:"US",phone_number:"+14807581224"},billing_same_as_shipping_address:!0,shipping_method:this.getDefaultShippingMethodId(),payment_detail:{payment_method:"card_token",card_token:"test_card"},user:{email:"test@test.com",first_name:"Test",last_name:"Order",language:"en",phone_number:"+14807581224",accepts_marketing:!0},vouchers:e,attribution:this.getTestAttribution(),currency:this.getCurrency(),success_url:Ed(),payment_failed_url:$d()}}mapPaymentMethod(t){return Sd[t]||"card_token"}getDefaultShippingMethodId(){var t,e,i;const n=Tt.getState(),r=Mt.getState(),s=dt.getState();if(null==(t=n.shippingMethod)?void 0:t.id)return n.shippingMethod.id;if(null==(e=r.shippingMethod)?void 0:e.id)return r.shippingMethod.id;if((null==(i=s.data)?void 0:i.shipping_methods)&&s.data.shipping_methods.length>0){const t=s.data.shipping_methods[0];if(t)return t.ref_id}return 1}getTestAttribution(){const t=Nt.getState().getAttributionForApi();return h(u({},t),{utm_source:"konami_code",utm_medium:"test",utm_campaign:"debug_test_order",utm_content:"test_mode",metadata:h(u({},t.metadata),{test_order:!0,test_timestamp:Date.now()})})}}class Id{constructor(t,e,i){this.apiClient=t,this.logger=e,this.emitCallback=i,this.orderBuilder=new Td}createOrder(t,e,i,n,r){return g(this,arguments,function*(t,e,i,n,r,s=!0,a,o=[]){try{if(!t.email||!t.fname||!t.lname)throw new Error("Missing required customer information");if(0===e.length)throw new Error("Cannot create order with empty cart");if(("credit-card"===i||"card_token"===i)&&!n)throw new Error("Payment token is required for credit card payments");const c=this.orderBuilder.buildOrder(t,e,i,n,r,s,a,o);this.logger.debug("Creating order with data:",h(u({},c),{payment_detail:h(u({},c.payment_detail),{card_token:c.payment_detail.card_token?"MASKED":void 0})}));const l=yield this.apiClient.createOrder(c);if(!l.ref_id)throw new Error("Invalid order response: missing ref_id");return this.logger.info("Order created successfully",{ref_id:l.ref_id,number:l.number,total:l.total_incl_tax,payment_method:i}),l}catch(c){if(this.logger.error("Failed to create order:",c),400===c.status&&c.responseData){const t=c.responseData;if(t.payment_details||t.payment_response_code){this.emitCallback("payment:error",{message:t.payment_details||"Payment failed",code:t.payment_response_code,details:t});let e="Payment failed: ";throw t.payment_details?e+=t.payment_details:e+="Please check your payment information and try again.",new Error(e)}}if(c instanceof Error){if(c.message.includes("Rate limited"))throw new Error("Too many requests. Please wait a moment and try again.");if(c.message.includes("401")||c.message.includes("403"))throw new Error("Authentication error. Please refresh the page and try again.");if(c.message.includes("400"))throw new Error("Invalid order data. Please check your information and try again.");if(c.message.includes("500"))throw new Error("Server error. Please try again in a few moments.")}throw c}})}createExpressOrder(t,e){return g(this,null,function*(){this.logger.info("createExpressOrder called with:",{paymentMethod:e,itemCount:t.length});try{if(0===t.length)throw new Error("Cannot create express order with empty cart");const{useCartStore:i}=yield Promise.resolve().then(()=>It),n=(i.getState().appliedCoupons||[]).map(t=>t.code),r=this.orderBuilder.buildExpressOrder(t,e,n);this.logger.debug("Creating express order with minimal data:",r),this.logger.info("Express order data built");const s=yield this.apiClient.createOrder(r);return this.logger.info("Express order created:",{ref_id:s.ref_id,has_order_status_url:!!s.order_status_url,has_payment_complete_url:!!s.payment_complete_url}),s}catch(i){throw this.logger.error("Failed to create express order:",i),i}})}createTestOrder(t){return g(this,null,function*(){try{const{useCartStore:e}=yield Promise.resolve().then(()=>It),i=(e.getState().appliedCoupons||[]).map(t=>t.code),n=this.orderBuilder.buildTestOrder(t,i);return this.logger.debug("Creating test order with data:",n),yield this.apiClient.createOrder(n)}catch(e){throw this.logger.error("Failed to create test order:",e),e}})}handleOrderRedirect(t){this.logger.info("handleOrderRedirect called with order:",{ref_id:t.ref_id,has_order_status_url:!!t.order_status_url,has_payment_complete_url:!!t.payment_complete_url});try{if(!t.ref_id)return this.logger.error("Cannot redirect: order missing ref_id"),void this.emitCallback("order:redirect-missing",{order:t});!function(t,e,i){let n;if(t.payment_complete_url)e.debug(`Using payment_complete_url from API: ${t.payment_complete_url}`),n=t.payment_complete_url;else{const i=function(t){const e=document.querySelector('meta[name="next-success-url"]')||document.querySelector('meta[name="next-next-url"]')||document.querySelector('meta[name="os-next-page"]');if(!(null==e?void 0:e.content))return null;const i=e.content,n=i.startsWith("http")?new URL(i):new URL(i,window.location.origin);return t&&n.searchParams.append("ref_id",t),n.href}(t.ref_id);i?(e.debug(`Using success URL from meta tag: ${i}`),n=i):t.order_status_url?(e.debug(`Using order_status_url from API: ${t.order_status_url}`),n=t.order_status_url):(e.warn("No order_status_url found in API response - using fallback URL"),n=`${window.location.origin}/checkout/confirmation/?ref_id=${t.ref_id||""}`)}if(n){const t=rd(n);e.info("Redirecting to:",t),window.location.href=t}else e.error("No redirect URL could be determined"),i("order:redirect-missing",{order:t})}(t,this.logger,this.emitCallback)}catch(e){this.logger.error("Error handling order redirect:",e),this.emitCallback("order:redirect-missing",{order:t})}}handleTokenizedPayment(t,e,i){return g(this,null,function*(){try{if(!t)throw new Error("Payment token is required");this.logger.debug("Handling tokenized payment",{token:t.substring(0,8)+"...",pmData:e?"present":"missing"});const n=yield i();this.emitCallback("order:completed",n),this.handleOrderRedirect(n)}catch(n){throw this.logger.error("Failed to process tokenized payment:",n),n}})}getOrderStatus(t){return g(this,null,function*(){try{return yield this.apiClient.getOrder(t)}catch(e){throw this.logger.error("Failed to get order status:",e),e}})}}const Ad=["[data-next-checkout-field]","[os-checkout-field]"],Md='[os-checkout-element="different-billing-address"], [data-next-component="different-billing-address"]',Ld={credit:"credit-card",paypal:"paypal","apple-pay":"apple_pay","google-pay":"google_pay"},Dd={"credit-card":"card_token",card_token:"card_token",paypal:"paypal",apple_pay:"apple_pay",google_pay:"google_pay"},Fd={fname:"first_name",lname:"last_name",address1:"address1",address2:"address2",city:"city",province:"province",postal:"postal",country:"country",phone:"phone"},Od=Object.freeze(Object.defineProperty({__proto__:null,CheckoutFormEnhancer:class extends be{constructor(t){super(t),this.stateLoadingPromises=new Map,this.fields=new Map,this.billingFields=new Map,this.paymentButtons=new Map,this.countries=[],this.countryConfigs=new Map,this.detectedCountryCode="US",this.phoneInputs=new Map,this.isIntlTelInputAvailable=!1,this.googleMapsLoaded=!1,this.googleMapsLoading=!1,this.googleMapsLoadPromise=null,this.autocompleteInstances=new Map,this.enableAutocomplete=!0,this.locationElements=null,this.billingLocationElements=null,this.locationFieldsShown=!1,this.billingLocationFieldsShown=!1,this.billingAnimationInProgress=!1,this.billingAnimationTimeouts=new Set,this.hasTrackedShippingInfo=!1,this.autocompleteListenersAttached=!1,this.loadingOverlay=new od}initialize(){return g(this,null,function*(){if(this.validateElement(),!(this.element instanceof HTMLFormElement))throw new Error("CheckoutFormEnhancer must be applied to a form element");this.form=this.element,this.form.noValidate=!0,this.loadingOverlay=new od;const t=yt.getState();this.apiClient=new re(t.apiKey),this.countryService=pe.getInstance();const e=Nt.getState();yield e.initialize(),this.orderManager=new Id(this.apiClient,this.logger,(t,e)=>this.emit(t,e)),this.expressProcessor=new Cd(this.logger,()=>this.loadingOverlay.show(),t=>this.loadingOverlay.hide(t),(t,e)=>this.emit(t,e),this.orderManager),this.isIntlTelInputAvailable=!!window.intlTelInput&&!!window.intlTelInputUtils,this.validator=new xd(this.logger,this.countryService,void 0),this.scanAllFields(),this.setupBillingForm()&&this.scanBillingFields(),this.ui=new _d(this.form,this.fields,this.logger,this.billingFields),this.ui.initialize(),this.ui.initializePaymentForms(),t.spreedlyEnvironmentKey&&(yield this.initializeCreditCard(t.spreedlyEnvironmentKey,t.debug)),yield this.initializeAddressManagement(t),this.initializePhoneInputs(),yield this.initializeAddressAutocomplete(),this.validator.setPhoneValidator((t,e="shipping")=>{if(!this.isIntlTelInputAvailable)return/^[\d\s\-\+\(\)]+$/.test(t);const i=this.phoneInputs.get(e);return i?i.isValidNumber():/^[\d\s\-\+\(\)]+$/.test(t)}),this.populateExpirationFields(),this.setupEventHandlers(),this.subscribe(Mt,this.handleCheckoutUpdate.bind(this)),this.subscribe(Tt,this.handleCartUpdate.bind(this)),this.subscribe(yt,this.handleConfigUpdate.bind(this)),this.boundHandleTestDataFilled=this.handleTestDataFilled.bind(this),this.boundHandleKonamiActivation=this.handleKonamiActivation.bind(this),document.addEventListener("checkout:test-data-filled",this.boundHandleTestDataFilled),document.addEventListener("next:test-mode-activated",this.boundHandleKonamiActivation),this.populateFormData(),this.initializeLocationFieldVisibility(),yield this.initializeProspectCart(),this.eventBus.on("payment:error",t=>{t.message&&this.displayPaymentError(t.message)}),document.addEventListener("next:country-changed",t=>g(this,null,function*(){const e=t,{to:i}=e.detail;i&&(yield this.handleCountryChange(i))})),window.addEventListener("pageshow",e=>{var i;if(e.persisted||"back_forward"===(null==(i=performance.getEntriesByType("navigation")[0])?void 0:i.type)){this.logger.info("Page restored from bfcache, resetting express checkout state"),this.loadingOverlay.hide(!0);const e=Mt.getState();e.isProcessing&&(this.logger.info("Resetting processing state after bfcache restore"),e.setProcessing(!1)),"apple_pay"!==e.paymentMethod&&"google_pay"!==e.paymentMethod&&"paypal"!==e.paymentMethod||(this.logger.info("Resetting payment method from",e.paymentMethod,"to credit-card"),e.setPaymentMethod("credit-card"),e.setPaymentToken("")),this.creditCardService&&t.spreedlyEnvironmentKey&&(this.logger.info("Re-initializing credit card service after bfcache restore"),this.creditCardService.initialize().catch(t=>{this.logger.error("Failed to re-initialize credit card service:",t)})),this.handlePurchaseEvent()}}),this.handlePurchaseEvent(),this.logger.debug("CheckoutFormEnhancer initialized"),this.emit("checkout:form-initialized",{form:this.form})})}scanAllFields(){Ad.forEach(t=>{this.form.querySelectorAll(t).forEach(e=>{const i=e.getAttribute(t.includes("data-next")?"data-next-checkout-field":"os-checkout-field");i&&e instanceof HTMLElement&&this.fields.set(i,e)})});const t=this.form.querySelector('button[type="submit"]')||this.form.querySelector("[data-next-checkout-submit]")||this.form.querySelector("[os-checkout-submit]");t instanceof HTMLButtonElement?(this.submitButton=t,this.logger.debug("Found submit button:",t)):this.logger.warn("Submit button not found in checkout form"),["[data-next-checkout-payment]","[os-checkout-payment]"].forEach(t=>{document.querySelectorAll(t).forEach(e=>{const i=e.getAttribute(t.includes("data-next")?"data-next-checkout-payment":"os-checkout-payment");i&&e instanceof HTMLElement&&this.paymentButtons.set(i,e)})}),this.scanExpirationFields()}scanBillingFields(){['[os-checkout-field^="billing-"]','[data-next-checkout-field^="billing-"]'].forEach(t=>{document.querySelectorAll(t).forEach(t=>{const e=t.getAttribute("os-checkout-field")||t.getAttribute("data-next-checkout-field");e&&t instanceof HTMLElement&&this.billingFields.set(e,t)})})}scanExpirationFields(){const t=['[data-next-checkout-field="cc-month"]','[data-next-checkout-field="exp-month"]','[os-checkout-field="cc-month"]','[os-checkout-field="exp-month"]',"#credit_card_exp_month"].map(t=>document.querySelector(t)).find(t=>null!==t),e=['[data-next-checkout-field="cc-year"]','[data-next-checkout-field="exp-year"]','[os-checkout-field="cc-year"]','[os-checkout-field="exp-year"]',"#credit_card_exp_year"].map(t=>document.querySelector(t)).find(t=>null!==t);if(t){const e="exp-month"===t.getAttribute("data-next-checkout-field")||"exp-month"===t.getAttribute("os-checkout-field");e&&!this.fields.has("exp-month")?this.fields.set("exp-month",t):e||this.fields.has("cc-month")||this.fields.has("exp-month")||this.fields.set("cc-month",t)}if(e){const t="exp-year"===e.getAttribute("data-next-checkout-field")||"exp-year"===e.getAttribute("os-checkout-field");t&&!this.fields.has("exp-year")?this.fields.set("exp-year",e):t||this.fields.has("cc-year")||this.fields.has("exp-year")||this.fields.set("cc-year",e)}}populateExpirationFields(){const t=this.fields.get("cc-month")||this.fields.get("exp-month"),e=this.fields.get("cc-year")||this.fields.get("exp-year");if(t instanceof HTMLSelectElement){t.innerHTML='<option value="">Month</option>';for(let e=1;e<=12;e++){const i=e.toString().padStart(2,"0"),n=document.createElement("option");n.value=i,n.textContent=i,t.appendChild(n)}}if(e instanceof HTMLSelectElement){e.innerHTML='<option value="">Year</option>';const t=(new Date).getFullYear();for(let i=0;i<20;i++){const n=t+i,r=document.createElement("option");r.value=n.toString(),r.textContent=n.toString(),e.appendChild(r)}}}setupBillingForm(){const t=document.querySelector(Md);if(!t)return!1;const e=document.querySelector('[os-checkout-component="shipping-form"], [data-next-component="shipping-form"]');if(!e)return!1;const i=t.querySelector('[os-checkout-component="billing-form"], [data-next-component="billing-form"]');if(!i)return!1;i.innerHTML="";const n=e.querySelectorAll('[data-next-component="shipping-field-row"]');n.forEach(t=>{if(!t.closest('[data-next-component="location"]')){const e=t.cloneNode(!0);this.convertShippingFieldsToBilling(e),i.appendChild(e)}});const r=e.querySelector('[data-next-component="location"]');if(r){const t=r.cloneNode(!0);t.setAttribute("data-next-component","billing-location"),this.convertShippingFieldsToBilling(t),t.classList.add("next-hidden","next-location-hidden"),t.style.display="none",i.appendChild(t)}else n.forEach(t=>{if(t.closest('[data-next-component="location"]')){const e=t.cloneNode(!0);this.convertShippingFieldsToBilling(e),i.appendChild(e)}});return this.setInitialBillingFormState(),!0}convertShippingFieldsToBilling(t){t.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(t=>{t.remove()}),t.querySelectorAll("[data-next-checkout-field]").forEach(t=>{const e=t.getAttribute("data-next-checkout-field");e&&!e.startsWith("billing-")&&t.setAttribute("data-next-checkout-field",`billing-${e}`)}),t.querySelectorAll("[os-checkout-field]").forEach(t=>{const e=t.getAttribute("os-checkout-field");e&&!e.startsWith("billing-")&&t.setAttribute("os-checkout-field",`billing-${e}`)}),t.querySelectorAll("input, select, textarea").forEach(t=>{const e=t;e.name&&!e.name.startsWith("billing_")&&(e.name=e.name.startsWith("shipping_")?e.name.replace("shipping_","billing_"):`billing_${e.name}`),e.id&&!e.id.startsWith("billing_")&&(e.id=e.id.startsWith("shipping_")?e.id.replace("shipping_","billing_"):`billing_${e.id}`),"checkbox"===e.type||"radio"===e.type?e.checked=!1:e.value=""})}setInitialBillingFormState(){const t=this.form.querySelector('input[name="use_shipping_address"]'),e=document.querySelector(Md);this.logger.info("[Billing] Setting initial state",{toggleFound:!!t,sectionFound:!!e,toggleChecked:null==t?void 0:t.checked,currentHeight:null==e?void 0:e.style.height,currentOverflow:null==e?void 0:e.style.overflow,currentClasses:null==e?void 0:e.className}),t&&e?(e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition"),t.checked?(e.style.height="0px",e.style.overflow="hidden",e.classList.add("billing-form-collapsed"),e.classList.remove("billing-form-expanded"),this.logger.info("[Billing] Initial state: COLLAPSED (checkbox checked)")):(e.style.height="auto",e.style.overflow="visible",e.classList.add("billing-form-expanded"),e.classList.remove("billing-form-collapsed"),this.logger.info("[Billing] Initial state: EXPANDED (checkbox unchecked)"))):this.logger.warn("[Billing] Could not set initial state - missing elements")}expandBillingForm(t){this.billingAnimationTimeouts.forEach(t=>clearTimeout(t)),this.billingAnimationTimeouts.clear(),this.billingAnimationInProgress=!0,this.logger.debug("[Billing] Starting expand animation",{startHeight:t.offsetHeight,startOverflow:t.style.overflow}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{t.style.transition="none",t.style.height="auto";const e=t.scrollHeight;this.logger.debug("[Billing] Measured full height:",e),t.style.height="0px",t.style.overflow="hidden",t.offsetHeight,t.getBoundingClientRect(),requestAnimationFrame(()=>{t.style.setProperty("transition","height 0.3s cubic-bezier(0.4, 0, 0.2, 1)","important"),t.style.setProperty("height",`${e}px`,"important"),window.getComputedStyle(t),this.logger.debug("[Billing] Expand animation started",{fromHeight:"0px",toHeight:e});const i=()=>{t.style.transition="none",t.style.height="auto",t.style.overflow="visible",t.removeEventListener("transitionend",i),this.billingAnimationInProgress=!1,this.logger.info("[Billing] Expand complete",{finalHeight:t.style.height,finalOverflow:t.style.overflow,finalTransition:t.style.transition})};t.addEventListener("transitionend",i);const n=setTimeout(()=>{this.billingAnimationInProgress&&t.classList.contains("billing-form-expanded")&&(this.logger.warn("[Billing] Expand fallback triggered - forcing completion"),t.style.transition="none",t.style.height="auto",t.style.overflow="visible",this.billingAnimationInProgress=!1),this.billingAnimationTimeouts.delete(n)},350);this.billingAnimationTimeouts.add(n)}),t.classList.add("billing-form-expanded"),t.classList.remove("billing-form-collapsed")})})}collapseBillingForm(t){this.billingAnimationTimeouts.forEach(t=>clearTimeout(t)),this.billingAnimationTimeouts.clear(),this.billingAnimationInProgress=!0,this.logger.debug("[Billing] Starting collapse animation",{startHeight:t.offsetHeight,scrollHeight:t.scrollHeight}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const e=t.scrollHeight;t.style.transition="none",t.style.height=`${e}px`,t.style.overflow="hidden",t.offsetHeight,t.getBoundingClientRect(),requestAnimationFrame(()=>{t.style.setProperty("transition","height 0.3s cubic-bezier(0.4, 0, 0.2, 1)","important"),t.style.setProperty("height","0px","important"),window.getComputedStyle(t),this.logger.debug("[Billing] Collapse animation started",{fromHeight:e,toHeight:"0px"});const i=()=>{t.style.transition="none",t.style.height="0px",t.style.overflow="hidden",t.removeEventListener("transitionend",i),this.billingAnimationInProgress=!1,this.logger.info("[Billing] Collapse complete",{finalHeight:t.style.height,finalOverflow:t.style.overflow,finalTransition:t.style.transition})};t.addEventListener("transitionend",i);const n=setTimeout(()=>{this.billingAnimationInProgress&&t.classList.contains("billing-form-collapsed")&&(this.logger.warn("[Billing] Collapse fallback triggered - forcing completion"),t.style.transition="none",t.style.height="0px",t.style.overflow="hidden",this.billingAnimationInProgress=!1),this.billingAnimationTimeouts.delete(n)},350);this.billingAnimationTimeouts.add(n)}),t.classList.add("billing-form-collapsed"),t.classList.remove("billing-form-expanded")})})}loadGoogleMapsAPI(){return g(this,null,function*(){const t=yt.getState().googleMapsConfig;if(!1!==t.enableAutocomplete)if(t.apiKey)if(this.googleMapsLoaded)this.logger.debug("Google Maps API already loaded");else{if(this.googleMapsLoading)return this.logger.debug("Google Maps API loading in progress, waiting..."),this.googleMapsLoadPromise;this.googleMapsLoading=!0,this.googleMapsLoadPromise=this.performGoogleMapsLoad(t);try{yield this.googleMapsLoadPromise,this.googleMapsLoaded=!0,this.logger.info("Google Maps API loaded successfully")}catch(e){this.logger.error("Failed to load Google Maps API:",e)}finally{this.googleMapsLoading=!1}}else this.logger.warn("Google Maps API key not found. Autocomplete will be disabled.");else this.logger.debug("Google Maps Autocomplete is disabled in configuration")})}performGoogleMapsLoad(t){return g(this,null,function*(){if(void 0===window.google||void 0===window.google.maps)return new Promise((e,i)=>{const n=document.createElement("script"),r=t.region?`&region=${t.region}`:"";if(n.src=`https://maps.googleapis.com/maps/api/js?key=${t.apiKey}&libraries=places${r}&loading=async`,n.async=!0,n.defer=!0,n.onload=()=>g(this,null,function*(){this.logger.debug("Google Maps API script loaded successfully");let t=0;for(;t<10;){if(void 0!==window.google&&void 0!==window.google.maps&&void 0!==window.google.maps.places&&void 0!==window.google.maps.places.Autocomplete)return this.logger.debug("Google Maps Places API fully initialized"),void e();t++,this.logger.debug(`Waiting for Google Maps API to initialize... (attempt ${t}/10)`),yield new Promise(t=>setTimeout(t,100))}i(new Error("Google Maps API not fully available after script load"))}),n.onerror=()=>{const t=new Error("Failed to load Google Maps API script");this.logger.error(t.message),i(t)},document.querySelector('script[src*="maps.googleapis.com"]'))return this.logger.debug("Google Maps script already in DOM, waiting for load..."),void 0!==window.google&&void 0!==window.google.maps&&void 0!==window.google.maps.places&&void 0!==window.google.maps.places.Autocomplete?void e():void(()=>{g(this,null,function*(){let t=0;for(;t<10;){if(void 0!==window.google&&void 0!==window.google.maps&&void 0!==window.google.maps.places&&void 0!==window.google.maps.places.Autocomplete)return this.logger.debug("Existing Google Maps script fully loaded"),void e();t++,yield new Promise(t=>setTimeout(t,100))}i(new Error("Existing Google Maps script failed to fully initialize"))})})();document.head.appendChild(n)});this.logger.debug("Google Maps API already available")})}isGoogleMapsLoaded(){return this.googleMapsLoaded&&void 0!==window.google&&void 0!==window.google.maps}isGoogleMapsPlacesAvailable(){return this.isGoogleMapsLoaded()&&void 0!==window.google.maps.places&&void 0!==window.google.maps.places.Autocomplete}initializeAddressManagement(t){return g(this,null,function*(){try{this.addClass("next-loading-countries"),t.addressConfig&&this.countryService.setConfig(t.addressConfig);const i=t.googleMapsConfig||{};this.enableAutocomplete=!1!==i.enableAutocomplete&&!!i.apiKey;const n=yield this.countryService.getLocationData();this.countries=n.countries;let r=n.detectedCountryCode;const s=this.countryService.getConfig();this.logger.info("Shipping country selection priority check (does not affect currency):",{detectedCountry:n.detectedCountryCode,addressConfigDefault:null==s?void 0:s.defaultCountry,urlParam:new URLSearchParams(window.location.search).get("country"),sessionOverride:sessionStorage.getItem("next_selected_country")});const a=new URLSearchParams(window.location.search).get("country");if(a){const t=a.toUpperCase();this.countries.some(e=>e.code===t)?(r=t,sessionStorage.setItem("next_selected_country",t),this.logger.info(`âœ… Using shipping country from URL parameter: ${t} (currency unaffected)`)):this.logger.warn(`Country ${t} from URL not in available countries`)}else{const t=sessionStorage.getItem("next_selected_country");t?this.countries.some(e=>e.code===t)?(r=t,this.logger.info(`âœ… Using shipping country from session storage: ${t} (currency unaffected)`)):this.logger.warn(`Saved country ${t} not in available countries`):this.logger.info(`âœ… Using detected/default shipping country: ${r} (currency unaffected)`)}this.detectedCountryCode=r;const o=this.fields.get("country");let c;o instanceof HTMLSelectElement&&(this.populateCountryDropdown(o,n.countries,r),r&&(this.updateFormData({country:r}),this.clearError("country")));try{c=yield this.countryService.getCountryConfig(r),this.logger.debug(`Fetched config for country ${r}`)}catch(e){this.logger.warn(`Failed to get config for country ${r}, using detected config`),c=n.detectedCountryConfig}if(this.countryConfigs.set(r,c),r){const t=this.fields.get("province");t instanceof HTMLSelectElement&&(yield this.updateStateOptions(r,t),this.currentCountryConfig=c),this.updateFormLabels(c)}this.billingFields.size>0&&this.populateBillingCountryDropdown()}catch(e){this.logger.error("Failed to load country data:",e)}finally{this.removeClass("next-loading-countries")}})}populateCountryDropdown(t,e,i){const n=t.options[0];t.innerHTML="",n&&!n.value&&(n.disabled=!0,t.appendChild(n)),e.forEach(e=>{const n=document.createElement("option");n.value=e.code,n.textContent=e.name,e.code===i&&(n.selected=!0),t.appendChild(n)}),i&&t.dispatchEvent(new Event("change",{bubbles:!0}))}populateBillingCountryDropdown(){const t=this.billingFields.get("billing-country");if(!(t instanceof HTMLSelectElement))return;const e=t.options[0];t.innerHTML="",e&&!e.value&&(e.disabled=!0,t.appendChild(e)),this.countries.forEach(e=>{const i=document.createElement("option");i.value=e.code,i.textContent=e.name,t.appendChild(i)})}handleCountryChange(t){return g(this,null,function*(){this.logger.info(`Handling country change to: ${t}`);const e=this.fields.get("country");if(e instanceof HTMLSelectElement){e.value=t,this.updateFormData({country:t});const i=this.fields.get("province");i instanceof HTMLSelectElement&&(yield this.updateStateOptions(t,i)),e.dispatchEvent(new Event("change",{bubbles:!0})),this.logger.info(`Country field updated to: ${t}`)}const i=this.billingFields.get("billing-country");if(i instanceof HTMLSelectElement){i.value=t;const e=this.billingFields.get("billing-province");if(e instanceof HTMLSelectElement){const i=Mt.getState(),n=i.sameAsShipping?i.formData.province:void 0;yield this.updateBillingStateOptions(t,e,n)}i.dispatchEvent(new Event("change",{bubbles:!0}))}})}updateStateOptions(t,e){return g(this,null,function*(){if(!t||""===t.trim())return e.innerHTML='<option value="">Select Country First</option>',void(e.disabled=!0);e.disabled=!0;const i=e.innerHTML;e.innerHTML='<option value="">Loading...</option>';try{let i=this.stateLoadingPromises.get(t);i?this.logger.debug(`Reusing existing state loading promise for ${t}`):(i=this.countryService.getCountryStates(t),this.stateLoadingPromises.set(t,i),i.finally(()=>{setTimeout(()=>this.stateLoadingPromises.delete(t),100)}));const n=yield i;this.countryConfigs.set(t,n.countryConfig),this.currentCountryConfig=n.countryConfig,this.updateFormLabels(n.countryConfig);const r=n.states&&n.states.length>0,s=n.countryConfig.stateRequired,a=e.closest(".frm-flds, .form-group, .form-field, .field-group")||e.parentElement;if(!s&&!r)return a&&(a.style.display="none"),e.removeAttribute("required"),this.updateFormData({province:""}),void this.clearError("province");a&&(a.style.display=""),e.innerHTML="";const o=document.createElement("option");o.value="",o.textContent=`Select ${n.countryConfig.stateLabel}`,o.disabled=!1,o.selected=!0,e.appendChild(o),n.states.forEach(t=>{const i=document.createElement("option");i.value=t.code,i.textContent=t.name,e.appendChild(i)}),n.countryConfig.stateRequired?e.setAttribute("required","required"):e.removeAttribute("required");const c=e.value;this.updateFormData({province:""}),this.clearError("province");let l=!1;c&&n.states.some(t=>t.code===c)?(e.value=c,this.updateFormData({province:c}),l=!0,this.logger.debug(`Kept autofilled state: ${c}`)):e.value="",l||(e.value="",this.logger.debug(`No valid state found, showing placeholder: Select ${n.countryConfig.stateLabel}`))}catch(n){this.logger.error("Failed to load states:",n),e.innerHTML=i}finally{e.disabled=!1}})}updateFormLabels(t){const e=this.form.querySelector('label[for*="province"], label[for*="state"]');if(e){const i=t.stateRequired?" *":"";e.textContent=t.stateLabel+i}const i=this.form.querySelector('label[for*="postal"], label[for*="zip"]');i&&(i.textContent=t.postcodeLabel+" *");const n=this.fields.get("postal");n instanceof HTMLInputElement&&(n.placeholder=t.postcodeLabel)}updateBillingFormLabels(t){const e=document.querySelector('[os-checkout-element="different-billing-address"]');if(!e)return;const i=e.querySelector('label[for*="billing"][for*="province"], label[for*="billing"][for*="state"]');if(i){const e=t.stateRequired?" *":"";i.textContent=`Billing ${t.stateLabel}${e}`}const n=e.querySelector('label[for*="billing"][for*="postal"], label[for*="billing"][for*="zip"]');n&&(n.textContent=`Billing ${t.postcodeLabel} *`);const r=this.billingFields.get("billing-postal");r instanceof HTMLInputElement&&(r.placeholder=`Billing ${t.postcodeLabel}`)}initializeAddressAutocomplete(){return g(this,null,function*(){if(this.enableAutocomplete)try{this.setupLazyAutocompleteLoading()}catch(t){this.logger.error("Failed to initialize autocomplete:",t)}else this.logger.debug("Google Maps autocomplete disabled, skipping initialization")})}setupLazyAutocompleteLoading(){const t=this.fields.get("address1"),e=this.billingFields.get("billing-address1");let i=!1,n=!1;const r=()=>g(this,null,function*(){if(!n&&!i){i=!0,this.logger.info("User focused on address field, loading Google Maps API...");try{yield this.initializeGoogleMapsAutocomplete(),n=!0,t&&t.removeEventListener("focus",r),e&&e.removeEventListener("focus",r)}catch(s){this.logger.error("Failed to load Google Maps on focus:",s)}finally{i=!1}}});t instanceof HTMLInputElement&&t.addEventListener("focus",r),e instanceof HTMLInputElement&&e.addEventListener("focus",r)}initializeGoogleMapsAutocomplete(){return g(this,null,function*(){var t,e,i,n,r,s;try{if(yield this.loadGoogleMapsAPI(),yield new Promise(t=>setTimeout(t,100)),this.logger.debug("Google Maps status:",{google:void 0!==window.google,maps:void 0!==(null==(t=window.google)?void 0:t.maps),places:void 0!==(null==(i=null==(e=window.google)?void 0:e.maps)?void 0:i.places),Autocomplete:void 0!==(null==(s=null==(r=null==(n=window.google)?void 0:n.maps)?void 0:r.places)?void 0:s.Autocomplete)}),!this.isGoogleMapsPlacesAvailable())return void this.logger.warn("Google Places API not available, skipping autocomplete setup");this.logger.debug("Google Maps API loaded, setting up autocomplete"),this.setupAutocomplete()}catch(a){this.logger.warn("Failed to load Google Maps API:",a)}})}setupAutocomplete(){const t=this.fields.get("address1"),e=this.billingFields.get("billing-address1"),i=this.detectedCountryCode||"US";t instanceof HTMLInputElement&&this.createAutocompleteInstance(t,"address1",i,"shipping"),e instanceof HTMLInputElement&&this.createAutocompleteInstance(e,"billing-address1",i,"billing"),this.setupAutocompleteCountryChangeListeners()}createAutocompleteInstance(t,e,i,n){var r,s;try{const a="shipping"===n?this.fields.get("country"):this.billingFields.get("billing-country"),o=a instanceof HTMLSelectElement&&a.value?a.value:i,c={types:["address"],fields:["address_components","formatted_address"],componentRestrictions:{country:o}};if(!(null==(s=null==(r=window.google)?void 0:r.maps)?void 0:s.places))return void this.logger.warn("Google Maps Places API not loaded, skipping autocomplete initialization");if(!window.google.maps.places.Autocomplete)return void this.logger.warn("Google Maps Autocomplete API not available");const l=new window.google.maps.places.Autocomplete(t,c);this.autocompleteInstances.set(e,l),this.logger.debug(`Autocomplete created for ${e}, restricted to: ${o}`),l.addListener("place_changed",()=>g(this,null,function*(){const t=l.getPlace();t&&t.address_components?yield this.fillAddressFromAutocomplete(t,n):this.logger.debug("No valid place data returned from autocomplete")})),t.addEventListener("keydown",t=>{"Enter"===t.key&&t.preventDefault()})}catch(a){this.logger.error(`Failed to create autocomplete for ${e}:`,a)}}fillAddressFromAutocomplete(t,e){return g(this,null,function*(){var i,n,r,s,a,o,c,l;if(!t.address_components)return;const d=this.parseAddressComponents(t.address_components);if(!d)return void this.logger.warn("Failed to parse address components");const h=null==(i=d.country)?void 0:i.short,p="shipping"===e,f=p?"":"billing-",m=p?this.fields:this.billingFields,g=Mt.getState(),v=m.get(`${f}address1`);if(v instanceof HTMLInputElement){const t=(null==(n=d.street_number)?void 0:n.long)||"",e=(null==(r=d.route)?void 0:r.long)||"";let i="";"BR"===h&&e&&t?(i=`${e}, ${t}`,d.sublocality_level_1?i+=` - ${d.sublocality_level_1.long}`:d.sublocality&&(i+=` - ${d.sublocality.long}`)):i=[t,e].filter(Boolean).join(" "),v.value=i,v.dispatchEvent(new Event("change",{bubbles:!0}))}let y="",b="";if("BR"===h&&t.formatted_address&&(!d.administrative_area_level_2||!d.administrative_area_level_1)){const e=t.formatted_address.split(",");if(e.length>=3){const t=null==(s=e[e.length-3])?void 0:s.trim();if(t&&t.includes(" - ")){const[e,i]=t.split(" - ").map(t=>t.trim());y=e||"",b=i||""}}}const x=m.get(`${f}city`);if(x instanceof HTMLInputElement){let t="";"BR"===h?d.administrative_area_level_2?t=d.administrative_area_level_2.long:y&&(t=y):d.locality?t=d.locality.long:d.postal_town?t=d.postal_town.long:d.administrative_area_level_2?t=d.administrative_area_level_2.long:d.sublocality&&"BR"!==h?t=d.sublocality.long:d.sublocality_level_1&&"BR"!==h&&(t=d.sublocality_level_1.long),t?(x.value=t,x.dispatchEvent(new Event("change",{bubbles:!0})),this.logger.debug(`City set to: ${t} (type: ${d.locality?"locality":d.postal_town?"postal_town":d.sublocality?"sublocality":"sublocality_level_1"})`)):this.logger.warn("No suitable city component found in address")}const w=m.get(`${f}postal`);w instanceof HTMLInputElement&&(null==d?void 0:d.postal_code)&&(w.value=d.postal_code.long,w.dispatchEvent(new Event("change",{bubbles:!0})));const _=m.get(`${f}country`);if(_ instanceof HTMLSelectElement&&(null==d?void 0:d.country)){const t=d.country.short;_.value!==t&&(_.value=t,_.dispatchEvent(new Event("change",{bubbles:!0})),this.logger.debug(`Country set to ${t}`));const e=m.get(`${f}province`);e instanceof HTMLSelectElement&&((null==d?void 0:d.administrative_area_level_1)?this.setStateWithRetry(e,d.administrative_area_level_1.short,f):"BR"===t&&b&&this.setStateWithRetry(e,b,f))}if(p){const t={};if(d.street_number||d.route){const e=(null==(a=d.street_number)?void 0:a.long)||"",i=(null==(o=d.route)?void 0:o.long)||"";let n="";"BR"===h&&i&&e?(n=`${i}, ${e}`,d.sublocality_level_1?n+=` - ${d.sublocality_level_1.long}`:d.sublocality&&(n+=` - ${d.sublocality.long}`)):n=[e,i].filter(Boolean).join(" "),t.address1=n}if("BR"===h&&d.administrative_area_level_2?t.city=d.administrative_area_level_2.long:d.locality?t.city=d.locality.long:d.postal_town?t.city=d.postal_town.long:d.administrative_area_level_2?t.city=d.administrative_area_level_2.long:d.sublocality&&"BR"!==h?t.city=d.sublocality.long:d.sublocality_level_1&&(t.city=d.sublocality_level_1.long),d.postal_code&&(t.postal=d.postal_code.long),d.country&&(t.country=d.country.short),d.administrative_area_level_1&&(t.province=d.administrative_area_level_1.short),g.updateFormData(t),!this.hasTrackedShippingInfo&&t.city&&t.province)try{const t=g.shippingMethod,e=t?t.name:"Standard";$l.track(Sl.createAddShippingInfoEvent(e)),this.hasTrackedShippingInfo=!0,this.logger.info("Tracked add_shipping_info event (Google Places autofill)",{shippingTier:e})}catch(k){this.logger.warn("Failed to track add_shipping_info event after autofill:",k)}}else{const t=g.billingAddress||{first_name:"",last_name:"",address1:"",city:"",province:"",postal:"",country:"",phone:""},e=u({},t);if(d.street_number||d.route){const t=(null==(c=d.street_number)?void 0:c.long)||"",i=(null==(l=d.route)?void 0:l.long)||"";let n="";"BR"===h&&i&&t?(n=`${i}, ${t}`,d.sublocality_level_1?n+=` - ${d.sublocality_level_1.long}`:d.sublocality&&(n+=` - ${d.sublocality.long}`)):n=[t,i].filter(Boolean).join(" "),e.address1=n}"BR"===h&&d.administrative_area_level_2?e.city=d.administrative_area_level_2.long:d.locality?e.city=d.locality.long:d.postal_town?e.city=d.postal_town.long:d.administrative_area_level_2?e.city=d.administrative_area_level_2.long:d.sublocality&&"BR"!==h?e.city=d.sublocality.long:d.sublocality_level_1&&(e.city=d.sublocality_level_1.long),d.postal_code&&(e.postal=d.postal_code.long),d.country&&(e.country=d.country.short),d.administrative_area_level_1&&(e.province=d.administrative_area_level_1.short),g.setBillingAddress(e)}this.emit("address:autocomplete-filled",{type:e,components:d})})}parseAddressComponents(t){var e,i,n,r;const s={};return t.forEach(t=>{t.types.forEach(e=>{"political"!==e&&(s[e]={long:t.long_name,short:t.short_name})})}),this.logger.debug("Parsed address components:",{availableTypes:Object.keys(s),cityRelatedComponents:{locality:null==(e=s.locality)?void 0:e.long,postal_town:null==(i=s.postal_town)?void 0:i.long,sublocality:null==(n=s.sublocality)?void 0:n.long,sublocality_level_1:null==(r=s.sublocality_level_1)?void 0:r.long},allComponents:s}),s}setStateWithRetry(t,e,i,n=0){return g(this,null,function*(){n>=5?this.logger.warn(`Failed to set state ${e} after 5 attempts`):(yield new Promise(t=>setTimeout(t,300*Math.pow(1.5,n))),Array.from(t.options).some(t=>t.value===e)?(t.value=e,t.dispatchEvent(new Event("change",{bubbles:!0})),this.logger.debug(`State set to ${e}`)):this.setStateWithRetry(t,e,i,n+1))})}setupAutocompleteCountryChangeListeners(){if(this.autocompleteListenersAttached)return void this.logger.debug("Autocomplete country change listeners already attached, skipping");const t=this.fields.get("country");t instanceof HTMLSelectElement&&(t.Ut=!0,t.addEventListener("change",()=>{const e=this.autocompleteInstances.get("address1"),i=t.value;e&&i&&2===i.length&&(e.setComponentRestrictions&&e.setComponentRestrictions({country:i}),this.logger.debug(`Shipping autocomplete restricted to: ${i}`))}));const e=this.billingFields.get("billing-country");e instanceof HTMLSelectElement&&e.addEventListener("change",()=>{const t=this.autocompleteInstances.get("billing-address1"),i=e.value;t&&i&&2===i.length&&(t.setComponentRestrictions&&t.setComponentRestrictions({country:i}),this.logger.debug(`Billing autocomplete restricted to: ${i}`))}),this.autocompleteListenersAttached=!0}initializeLocationFieldVisibility(){var t,e,i;this.locationElements=this.form.querySelectorAll('[data-next-component="location"], [data-next-component-location="location"]'),this.billingLocationElements=this.form.querySelectorAll('[data-next-component="billing-location"]'),this.locationElements&&0!==this.locationElements.length||this.logger.debug("No shipping location elements found"),this.billingLocationElements&&0!==this.billingLocationElements.length||this.logger.debug("No billing location elements found"),this.hideLocationFields(),this.hideBillingLocationFields();const n=this.fields.get("address1");n instanceof HTMLInputElement&&(n.addEventListener("input",this.handleAddressInput.bind(this)),n.addEventListener("change",this.handleAddressInput.bind(this)),n.addEventListener("blur",this.handleAddressInput.bind(this)),n.value&&n.value.trim().length>0&&this.showLocationFields());const r=null==(t=this.billingFields)?void 0:t.get("billing-address1");r instanceof HTMLInputElement&&(r.addEventListener("input",this.handleBillingAddressInput.bind(this)),r.addEventListener("change",this.handleBillingAddressInput.bind(this)),r.addEventListener("blur",this.handleBillingAddressInput.bind(this)),r.value&&r.value.trim().length>0&&this.showBillingLocationFields()),this.eventBus.on("address:autocomplete-filled",t=>{"shipping"===t.type?this.showLocationFields():"billing"===t.type&&this.showBillingLocationFields()});const s=Mt.getState();s.formData.address1&&s.formData.address1.trim().length>0&&this.showLocationFields(),s.formData["billing-address1"]&&s.formData["billing-address1"].trim().length>0&&this.showBillingLocationFields(),this.logger.debug("Location field visibility initialized",{shippingLocationElementsCount:(null==(e=this.locationElements)?void 0:e.length)||0,billingLocationElementsCount:(null==(i=this.billingLocationElements)?void 0:i.length)||0})}handleAddressInput(t){const e=t.target;e.value&&e.value.trim().length>0&&this.showLocationFields()}handleBillingAddressInput(t){const e=t.target;e.value&&e.value.trim().length>0&&this.showBillingLocationFields()}hideLocationFields(){this.locationElements&&(this.locationElements.forEach(t=>{t instanceof HTMLElement&&(t.style.display="none",t.classList.add("next-location-hidden"))}),this.locationFieldsShown=!1,this.logger.debug("Location fields hidden"))}showLocationFields(){!this.locationFieldsShown&&this.locationElements&&(this.locationElements.forEach(t=>{t instanceof HTMLElement&&(t.style.display="flex",t.classList.remove("next-location-hidden"))}),this.locationFieldsShown=!0,this.eventBus.emit("checkout:location-fields-shown",{}),this.form.dispatchEvent(new CustomEvent("checkout:location-fields-shown")),this.logger.debug("Location fields shown"))}hideBillingLocationFields(){this.billingLocationElements&&(this.billingLocationElements.forEach(t=>{t instanceof HTMLElement&&(t.style.display="none",t.classList.add("next-location-hidden"))}),this.billingLocationFieldsShown=!1,this.logger.debug("Billing location fields hidden"))}showBillingLocationFields(){!this.billingLocationFieldsShown&&this.billingLocationElements&&(this.billingLocationElements.forEach(t=>{t instanceof HTMLElement&&(t.style.display="flex",t.classList.remove("next-location-hidden"))}),this.billingLocationFieldsShown=!0,this.eventBus.emit("checkout:billing-location-fields-shown",{}),this.form.dispatchEvent(new CustomEvent("checkout:billing-location-fields-shown")),this.logger.debug("Billing location fields shown"))}initializeProspectCart(){return g(this,null,function*(){try{this.prospectCartEnhancer=new kd(this.form),yield this.prospectCartEnhancer.initialize(),this.form.addEventListener("next:prospect-cart-created",t=>{const e=t;this.logger.info("Prospect cart created",e.detail)}),this.form.addEventListener("next:prospect-cart-abandoned",t=>{const e=t;this.logger.info("Prospect cart abandoned",e.detail)}),this.logger.debug("ProspectCartEnhancer initialized")}catch(t){this.logger.warn("Failed to initialize ProspectCartEnhancer:",t)}})}initializePhoneInputs(){if(!this.isIntlTelInputAvailable)return;const t=this.fields.get("phone"),e=this.billingFields.get("billing-phone");t instanceof HTMLInputElement&&this.initializePhoneInput("shipping",t),e instanceof HTMLInputElement&&this.initializePhoneInput("billing",e)}initializePhoneInput(t,e){try{const i=this.phoneInputs.get(t);i&&i.destroy();const n="shipping"===t?"country":"billing-country",r="shipping"===t?this.fields.get(n):this.billingFields.get(n),s=r instanceof HTMLSelectElement&&r.value?r.value.toLowerCase():this.detectedCountryCode.toLowerCase(),a="true"===e.getAttribute("data-next-required")||e.hasAttribute("required");e.placeholder=a?"Phone*":"Phone (Optional)";const o=window.intlTelInput(e,{separateDialCode:!1,nationalMode:!0,autoPlaceholder:"off",utilsScript:"https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/js/utils.js",preferredCountries:["us","ca","gb","au"],allowDropdown:!1,initialCountry:s,formatOnDisplay:!0});if(this.phoneInputs.set(t,o),e.addEventListener("input",()=>{if(o&&window.intlTelInputUtils){const i=e.value,n=o.getSelectedCountryData();if(i&&n.iso2){const t=window.intlTelInputUtils.formatNumber(i,n.iso2,window.intlTelInputUtils.numberFormat.NATIONAL);if(t!==i){const n=e.selectionStart||0,r=i.length,s=t.length;e.value=t;const a=n+(s-r);e.setSelectionRange(a,a)}}const r=o.getNumber();if("shipping"===t)this.updateFormData({phone:r});else{const t=Mt.getState(),e=t.billingAddress||{first_name:"",last_name:"",address1:"",city:"",province:"",postal:"",country:"",phone:""};t.setBillingAddress(h(u({},e),{phone:r}))}}}),e.addEventListener("blur",()=>{if(o&&window.intlTelInputUtils){const t=o.getSelectedCountryData(),i=e.value;if(i&&t.iso2){const n=window.intlTelInputUtils.formatNumber(i,t.iso2,window.intlTelInputUtils.numberFormat.NATIONAL);e.value=n}}}),r instanceof HTMLSelectElement){const t=()=>{const t=r.value;t&&o&&o.setCountry(t.toLowerCase())};r.addEventListener("change",t)}}catch(i){this.logger.error(`Failed to initialize ${t} phone field:`,i)}}initializeCreditCard(t,e){return g(this,null,function*(){try{this.addClass("next-loading-spreedly"),this.creditCardService=new gd(t),this.creditCardService.setOnReady(()=>{this.removeClass("next-loading-spreedly"),this.emit("checkout:spreedly-ready",{}),this.logger.debug("[Spreedly] Credit card service ready")}),this.creditCardService.setOnError(t=>{if(this.logger.warn("[Spreedly] Credit card validation errors:",t),this.emit("payment:error",{errors:t}),t&&t.length>0){const e=t.map(t=>t.message||t).join(". ");this.displayPaymentError(e)}}),this.creditCardService.setOnToken((t,e)=>{this.logger.info("[Spreedly] Payment token received:",{token:t,pmData:e}),this.handleTokenizedPayment(t,e)}),this.ui&&(this.creditCardService.setFloatingLabelCallbacks(t=>{this.ui.handleSpreedlyFieldFocus(t)},(t,e)=>{this.ui.handleSpreedlyFieldBlur(t,e)},(t,e)=>{this.ui.handleSpreedlyFieldInput(t,e)}),this.logger.debug("[Spreedly] Connected floating label callbacks")),yield this.creditCardService.initialize(),this.validator.setCreditCardService(this.creditCardService)}catch(e){throw this.logger.error("Failed to initialize credit card service:",e),this.removeClass("next-loading-spreedly"),e}})}clearAllCheckoutFields(){try{this.fields.forEach(t=>{t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement?"checkbox"===t.type||"radio"===t.type?t.checked=!1:t.value="":t instanceof HTMLSelectElement&&(t.selectedIndex=0)}),this.billingFields.forEach(t=>{t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement?"checkbox"===t.type||"radio"===t.type?t.checked=!1:t.value="":t instanceof HTMLSelectElement&&(t.selectedIndex=0)}),this.creditCardService&&"function"==typeof this.creditCardService.clearFields&&this.creditCardService.clearFields();const t=Mt.getState();t.reset(),t.clearAllErrors();const e=this.fields.get("country");e instanceof HTMLSelectElement&&this.detectedCountryCode&&(e.value=this.detectedCountryCode,e.dispatchEvent(new Event("change",{bubbles:!0})));const i=this.form.querySelector('input[name="use_shipping_address"]');i&&(i.checked=!0,i.dispatchEvent(new Event("change",{bubbles:!0}))),this.logger.info("All checkout fields cleared")}catch(t){this.logger.error("Error clearing checkout fields:",t)}}handlePurchaseEvent(){return g(this,null,function*(){var t;const e=sessionStorage.getItem("next-order");if(e)try{const i=JSON.parse(e),n=null==(t=null==i?void 0:i.state)?void 0:t.order;if(!(null==n?void 0:n.ref_id)||!(null==n?void 0:n.number))return;const r=sessionStorage.getItem("next-shown-order-warnings"),s=r?JSON.parse(r):[];if(s.includes(n.ref_id))return void this.logger.debug("Already shown warning for order",n.ref_id);this.logger.info("Fresh purchase detected, showing attention modal",{orderNumber:n.number,refId:n.ref_id});const a=Date.now();Mt.getState().setProcessing(!1);const o=yield ad.show({title:"Attention",content:"Your initial order has been successfully processed. Please check your email for the order confirmation. Entering your payment details again will result in a secondary purchase.",buttons:[{text:"Close",action:"cancel"},{text:"Back",action:"confirm"}],className:"purchase-warning-modal"});s.push(n.ref_id),sessionStorage.setItem("next-shown-order-warnings",JSON.stringify(s));const c=Date.now()-a;if(queueMicrotask(()=>{!function(t){g(this,null,function*(){yield te("duplicate_order_prevention",{order_ref_id:t.orderRefId,order_number:t.orderNumber,user_action:t.userAction,time_on_page_ms:t.timeOnPage||null})})}({orderRefId:n.ref_id,orderNumber:n.number,userAction:"confirm"===o?"back":"close",timeOnPage:c})}),"confirm"===o){const t=this.getSuccessUrl();if(t){const e=new URL(t,window.location.origin);!e.searchParams.has("ref_id")&&n.ref_id&&e.searchParams.set("ref_id",n.ref_id),window.location.href=e.href}}else this.populateFormData(),this.ui&&this.ui.hideLoading("checkout"),this.clearAllCheckoutFields()}catch(i){this.logger.error("Failed to parse order data from sessionStorage:",i),Mt.getState().setProcessing(!1)}})}buildOrderData(t,e){var i,n,r;const s={first_name:t.formData.fname||"",last_name:t.formData.lname||"",line1:t.formData.address1||"",line2:t.formData.address2,line4:t.formData.city||"",state:t.formData.province,postcode:t.formData.postal,country:t.formData.country||"",phone_number:t.formData.phone};let a;!t.sameAsShipping&&t.billingAddress&&(a=u(u(u(u({first_name:t.billingAddress.first_name||"",last_name:t.billingAddress.last_name||"",line1:t.billingAddress.address1||"",line4:t.billingAddress.city||"",country:t.billingAddress.country||""},t.billingAddress.address2&&{line2:t.billingAddress.address2}),t.billingAddress.province&&{state:t.billingAddress.province}),t.billingAddress.postal&&{postcode:t.billingAddress.postal}),t.billingAddress.phone&&{phone_number:t.billingAddress.phone}));const o=u({payment_method:Dd[t.paymentMethod]||"card_token"},t.paymentToken&&{card_token:t.paymentToken}),c=Nt.getState().getAttributionForApi(),l=(e.appliedCoupons||[]).map(t=>t.code);return h(u({lines:e.items.map(t=>({package_id:t.packageId,quantity:t.quantity,is_upsell:t.is_upsell||!1})),shipping_address:s},a&&{billing_address:a}),{billing_same_as_shipping_address:t.sameAsShipping,shipping_method:(null==(i=t.shippingMethod)?void 0:i.id)||(null==(n=e.shippingMethod)?void 0:n.id)||1,payment_detail:o,user:{email:t.formData.email,first_name:t.formData.fname||"",last_name:t.formData.lname||"",language:"en",phone_number:t.formData.phone,accepts_marketing:null==(r=t.formData.accepts_marketing)||r},vouchers:l,attribution:c,currency:this.getCurrency(),success_url:this.getSuccessUrl(),payment_failed_url:this.getFailureUrl()})}createOrder(){return g(this,null,function*(){const t=Mt.getState(),e=Tt.getState();try{if(!t.formData.email||!t.formData.fname||!t.formData.lname)throw new Error("Missing required customer information");if(0===e.items.length)throw new Error("Cannot create order with empty cart");if(("credit-card"===t.paymentMethod||"card_token"===t.paymentMethod)&&!t.paymentToken)throw new Error("Payment token is required for credit card payments");const i=this.buildOrderData(t,e),n=yield this.apiClient.createOrder(i);if(!n.ref_id)throw new Error("Invalid order response: missing ref_id");return this.logger.info("Order created successfully",{ref_id:n.ref_id,number:n.number,total:n.total_incl_tax,payment_method:t.paymentMethod}),n}catch(i){if(this.logger.error("Failed to create order:",i),400===i.status&&i.responseData){const t=i.responseData;if(this.logger.warn("API 400 error response:",t),t.message&&Array.isArray(t.message)){const e=t.message.map(t=>"object"==typeof t&&null!==t?t.message||JSON.stringify(t):String(t)).join(". ");throw this.displayPaymentError(e),new Error(e)}if(t.message&&"string"==typeof t.message)throw this.displayPaymentError(t.message),new Error(t.message);if(t.payment_details||t.payment_response_code){this.logger.warn("Payment error detected:",{payment_details:t.payment_details,payment_response_code:t.payment_response_code});const e=Mt.getState(),i=Tt.getState();queueMicrotask(()=>{const n=window._checkoutStartTime||Date.now(),r=Date.now()-n;ne({errorMessage:t.payment_details||"Payment failed",errorType:"payment",paymentResponseCode:t.payment_response_code,cartValue:i.total,itemsCount:i.totalQuantity,country:e.formData.country||"US",paymentMethod:e.paymentMethod,timeOnPage:r})}),this.displayPaymentError(t.payment_details||"Payment failed. Please check your payment information.");let n="Payment failed: ";throw t.payment_details?n+=t.payment_details:n+="Please check your payment information and try again.",new Error(n)}if(t.errors){const e=Object.entries(t.errors).map(([,t])=>Array.isArray(t)?t.join(". "):t).join(". "),i=Mt.getState(),n=Tt.getState();throw queueMicrotask(()=>{const t=window._checkoutStartTime||Date.now(),r=Date.now()-t;ne({errorMessage:e,errorType:"api",cartValue:n.total,itemsCount:n.totalQuantity,country:i.formData.country||"US",paymentMethod:i.paymentMethod,timeOnPage:r})}),this.displayPaymentError(e),new Error(e)}}if(i instanceof Error){if(i.message.includes("Rate limited"))throw new Error("Too many requests. Please wait a moment and try again.");if(i.message.includes("401")||i.message.includes("403"))throw new Error("Authentication error. Please refresh the page and try again.");if(i.message.includes("400"))throw new Error("Invalid order data. Please check your information and try again.");if(i.message.includes("500"))throw new Error("Server error. Please try again in a few moments.")}throw i}})}createTestOrder(){return g(this,null,function*(){var t;const e=Tt.getState();try{const i=(e.appliedCoupons||[]).map(t=>t.code),n={lines:e.items.length>0?e.items.map(t=>({package_id:t.packageId,quantity:t.quantity,is_upsell:t.is_upsell||!1})):[{package_id:1,quantity:1,is_upsell:!1}],shipping_address:{first_name:"Test",last_name:"Order",line1:"Test Address 123",line2:"",line4:"Tempe",state:"AZ",postcode:"85281",country:"US",phone_number:"+14807581224"},billing_same_as_shipping_address:!0,shipping_method:(null==(t=e.shippingMethod)?void 0:t.id)||1,payment_detail:{payment_method:"card_token",card_token:"test_card"},user:{email:"test@test.com",first_name:"Test",last_name:"Order",language:"en",phone_number:"+14807581224",accepts_marketing:!0},vouchers:i,attribution:this.getTestAttribution(),currency:this.getCurrency(),success_url:this.getSuccessUrl(),payment_failed_url:this.getFailureUrl()};return yield this.apiClient.createOrder(n)}catch(i){throw this.logger.error("Failed to create test order:",i),i}})}getTestAttribution(){const t=Nt.getState().getAttributionForApi();return h(u({},t),{utm_source:"konami_code",utm_medium:"test",utm_campaign:"debug_test_order",utm_content:"test_mode",metadata:h(u({},t.metadata),{test_order:!0,test_timestamp:Date.now()})})}handleOrderRedirect(t){const e=Mt.getState(),i=Tt.getState();let n;if(queueMicrotask(()=>{const n=window._checkoutStartTime||Date.now(),r=Date.now()-n,s={orderRefId:t.ref_id||"unknown",orderValue:t.total_amount||i.total,itemsCount:i.totalQuantity,country:e.formData.country||"US",paymentMethod:e.paymentMethod,timeToComplete:r,sameAsShipping:e.sameAsShipping};e.formData.province&&(s.state=e.formData.province),e.formData.city&&(s.city=e.formData.city),e.formData.postal&&(s.postalCode=e.formData.postal),e.formData.email&&(s.email=e.formData.email),!e.sameAsShipping&&e.billingAddress&&(e.billingAddress.country&&(s.billingCountry=e.billingAddress.country),e.billingAddress.province&&(s.billingState=e.billingAddress.province),e.billingAddress.city&&(s.billingCity=e.billingAddress.city),e.billingAddress.postal&&(s.billingPostalCode=e.billingAddress.postal)),function(t){g(this,null,function*(){yield te("checkout_completed",{order_ref_id:t.orderRefId,order_value:t.orderValue,items_count:t.itemsCount,country:t.country,state:t.state||null,city:t.city||null,postal_code:t.postalCode||null,email:t.email||null,payment_method:t.paymentMethod,time_to_complete_ms:t.timeToComplete,same_as_shipping:void 0===t.sameAsShipping||t.sameAsShipping,billing_country:t.billingCountry||null,billing_state:t.billingState||null,billing_city:t.billingCity||null,billing_postal_code:t.billingPostalCode||null,products:t.orderItems||[]})})}(s)}),t.payment_complete_url)n=t.payment_complete_url;else{n=this.getNextPageUrlFromMeta(t.ref_id)||(t.order_status_url?t.order_status_url:`${window.location.origin}/checkout/confirmation/?ref_id=${t.ref_id||""}`)}if(n){const t=this.preserveQueryParams(n);window.location.href=t}else Mt.getState().setProcessing(!1),this.emit("order:redirect-missing",{order:t})}getNextPageUrlFromMeta(t){const e=document.querySelector('meta[name="next-success-url"]')||document.querySelector('meta[name="next-next-url"]')||document.querySelector('meta[name="os-next-page"]');if(!(null==e?void 0:e.content))return null;const i=e.content,n=i.startsWith("http")?new URL(i):new URL(i,window.location.origin);return t&&n.searchParams.append("ref_id",t),n.href}preserveQueryParams(t,e=["debug","debugger"]){try{const i=new URL(t,window.location.origin),n=new URLSearchParams(window.location.search);return e.forEach(t=>{const e=n.get(t);e&&!i.searchParams.has(t)&&i.searchParams.append(t,e)}),i.href}catch(i){return t}}getCurrency(){var t;const e=dt.getState();if(null==(t=null==e?void 0:e.data)?void 0:t.currency)return e.data.currency;const i=yt.getState();return(null==i?void 0:i.selectedCurrency)||(null==i?void 0:i.detectedCurrency)||"USD"}getSuccessUrl(){const t=document.querySelector('meta[name="next-success-url"]')||document.querySelector('meta[name="next-next-url"]')||document.querySelector('meta[name="os-next-page"]');return(null==t?void 0:t.content)?t.content.startsWith("/")?window.location.origin+t.content:t.content:window.location.origin+"/success"}validateExpressCheckoutFields(t,e){return g(this,null,function*(){const i={};let n=null;for(const r of e){const e=t[r];if(!e||"string"==typeof e&&!e.trim()){const t={email:"Email",fname:"First Name",lname:"Last Name",phone:"Phone",address1:"Address",city:"City",province:"State/Province",postal:"ZIP/Postal Code",country:"Country"}[r]||r;i[r]=`${t} is required`,n||(n=r)}"email"===r&&e&&(this.validator.isValidEmail(e)||(i[r]="Please enter a valid email address",n||(n=r)))}return{isValid:0===Object.keys(i).length,errors:i,firstErrorField:n}})}getFailureUrl(){const t=document.querySelector('meta[name="next-failure-url"]')||document.querySelector('meta[name="os-failure-url"]');if(null==t?void 0:t.content)return t.content.startsWith("/")?window.location.origin+t.content:t.content;const e=new URL(window.location.href);return e.searchParams.set("payment_failed","true"),e.href}handleFormSubmit(t){return g(this,null,function*(){var e,i,n,r,s,a;t.preventDefault();const o=Mt.getState(),c=Tt.getState();try{if(o.clearAllErrors(),o.setProcessing(!0),this.loadingOverlay.show(),this.isIntlTelInputAvailable){const t=this.phoneInputs.get("shipping");if(t){const e=t.isValidNumber();if(!e&&o.formData.phone)o.setError("phone","Please enter a valid phone number");else if(e){const e=t.getNumber();e&&o.updateFormData({phone:e})}}if(!o.sameAsShipping&&o.billingAddress){const t=this.phoneInputs.get("billing");t&&!t.isValidNumber()&&o.billingAddress.phone&&o.setError("billing-phone","Please enter a valid phone number")}}const t=["paypal","apple_pay","google_pay"].includes(o.paymentMethod),l=Date.now();window._checkoutStartTime=l,queueMicrotask(()=>{const t=o.formData.country||"US";ie({cartValue:c.total,itemsCount:c.totalQuantity,detectedCountry:t,paymentMethod:o.paymentMethod||"credit-card"})});const d=yt.getState(),u=null==(i=null==(e=d.paymentConfig)?void 0:e.expressCheckout)?void 0:i.requireValidation;if(this.logger.debug("Express payment config:",{isExpressPayment:t,paymentMethod:o.paymentMethod,requireExpressValidation:u,hasExpressProcessor:!!this.expressProcessor,fullConfig:null==(n=d.paymentConfig)?void 0:n.expressCheckout}),t&&this.expressProcessor&&!u)return this.logger.info(`Processing express checkout for ${o.paymentMethod} (skipping validation)`),this.loadingOverlay.hide(!0),void(yield this.expressProcessor.handleExpressCheckout(o.paymentMethod,c.items,c.isEmpty,()=>c.reset()));t&&u&&this.logger.info(`Express payment ${o.paymentMethod} requires validation (requireValidation: true)`);const h="credit-card"===o.paymentMethod||"card_token"===o.paymentMethod||t&&u;let p;if(t&&u&&(null==(s=null==(r=d.paymentConfig)?void 0:r.expressCheckout)?void 0:s.requiredFields)){const t=d.paymentConfig.expressCheckout.requiredFields;p=yield this.validateExpressCheckoutFields(o.formData,t)}else p=yield this.validator.validateForm(o.formData,this.countryConfigs,this.currentCountryConfig,h,o.billingAddress,o.sameAsShipping);if(!p.isValid){if(queueMicrotask(()=>{const t=Object.keys(p.errors||{}),e={},i={shipping:[],billing:[],payment:[],contact:[]};t.forEach(t=>{var n;let r="";if(t.startsWith("billing-")){const e=t.replace("billing-","");r=(null==(n=o.billingAddress)?void 0:n[e])||""}else r="cc-number"===t||"cvv"===t?"[REDACTED]":"exp-month"===t||"cc-month"===t?o.formData["cc-month"]||o.formData["exp-month"]||"":"exp-year"===t||"cc-year"===t?o.formData["cc-year"]||o.formData["exp-year"]||"":o.formData[t]||"";let s="shipping";t.startsWith("billing-")?s="billing":["cc-number","cvv","exp-month","exp-year","cc-month","cc-year"].includes(t)?s="payment":["email","phone"].includes(t)&&(s="contact");const a=p.errors[t];let c="other";a.toLowerCase().includes("required")||a.toLowerCase().includes("is required")?c="required":a.toLowerCase().includes("valid")||a.toLowerCase().includes("invalid")?c="format":a.toLowerCase().includes("match")&&(c="mismatch"),e[t]={value:r,error:a,category:s,errorType:c},i[s].push(t)});const n={email:o.formData.email||"",phone:o.formData.phone||"",shipping_fname:o.formData.fname||"",shipping_lname:o.formData.lname||"",shipping_address1:o.formData.address1||"",shipping_address2:o.formData.address2||"",shipping_city:o.formData.city||"",shipping_province:o.formData.province||"",shipping_postal:o.formData.postal||"",shipping_country:o.formData.country||"US",has_cc_number:!!o.formData["cc-number"],has_cvv:!!o.formData.cvv,exp_month:o.formData["cc-month"]||o.formData["exp-month"]||"",exp_year:o.formData["cc-year"]||o.formData["exp-year"]||"",same_as_shipping:o.sameAsShipping};!o.sameAsShipping&&o.billingAddress&&(n.billing_fname=o.billingAddress.first_name||"",n.billing_lname=o.billingAddress.last_name||"",n.billing_address1=o.billingAddress.address1||"",n.billing_address2=o.billingAddress.address2||"",n.billing_city=o.billingAddress.city||"",n.billing_province=o.billingAddress.province||"",n.billing_postal=o.billingAddress.postal||"",n.billing_country=o.billingAddress.country||""),function(t){g(this,null,function*(){const e=t.errorDetails?Object.entries(t.errorDetails).map(([t,e])=>({field_name:t,field_value:e.value,error_message:e.error,error_category:e.category||"unknown",error_type:e.errorType||"unknown"})):[],i=t.validationErrors.map((t,e)=>({field_name:t,error_position:e+1,is_first_error:0===e})),n=t.errorsByCategory?Object.entries(t.errorsByCategory).flatMap(([t,e])=>e.map(e=>({category:t,field_name:e}))):[],r=t.formValues?Object.entries(t.formValues).map(([t,e])=>({field_name:t,has_value:null!=e&&""!==e,value_type:typeof e})):[];yield te("checkout_validation_failed",{error_count:t.errorCount,first_error_field:t.firstErrorField,country:t.country,payment_method:t.paymentMethod,validation_errors:i,error_details:e,errors_by_category:n,form_fields:r})})}({validationErrors:t,errorCount:t.length,firstErrorField:p.firstErrorField||t[0]||"unknown",country:o.formData.country||"US",paymentMethod:o.paymentMethod,errorDetails:e,formValues:n,errorsByCategory:i})}),this.logger.warn("Validation failed",{paymentMethod:o.paymentMethod,isExpressPayment:t,requireExpressValidation:u,errors:p.errors,firstErrorField:p.firstErrorField}),p.errors&&Object.entries(p.errors).forEach(([t,e])=>{o.setError(t,e),this.validator.showError(t,e)}),t&&u){const t=Object.keys(p.errors||{}),e={email:"Email",fname:"First Name",lname:"Last Name",phone:"Phone",address1:"Address",city:"City",province:"State/Province",postal:"ZIP/Postal Code",country:"Country","cc-month":"Expiration Month","cc-year":"Expiration Year","exp-month":"Expiration Month","exp-year":"Expiration Year","billing-fname":"Billing First Name","billing-lname":"Billing Last Name","billing-address1":"Billing Address","billing-city":"Billing City","billing-province":"Billing State/Province","billing-postal":"Billing ZIP/Postal Code","billing-country":"Billing Country"},i=`Please fill in the following required fields: ${t.map(t=>e[t]||t).join(", ")}`;o.setError("general",i),this.displayPaymentError(i)}return p.firstErrorField&&setTimeout(()=>{this.validator.focusFirstErrorField(p.firstErrorField)},100),o.setProcessing(!1),void this.loadingOverlay.hide(!0)}if(queueMicrotask(()=>{const t=Date.now()-l,e={cartValue:c.total,itemsCount:c.totalQuantity,country:o.formData.country||"US",paymentMethod:o.paymentMethod,timeOnPage:t,sameAsShipping:o.sameAsShipping};o.formData.province&&(e.state=o.formData.province),o.formData.city&&(e.city=o.formData.city),o.formData.postal&&(e.postalCode=o.formData.postal),o.formData.email&&(e.email=o.formData.email),!o.sameAsShipping&&o.billingAddress&&(o.billingAddress.country&&(e.billingCountry=o.billingAddress.country),o.billingAddress.province&&(e.billingState=o.billingAddress.province),o.billingAddress.city&&(e.billingCity=o.billingAddress.city),o.billingAddress.postal&&(e.billingPostalCode=o.billingAddress.postal)),function(t){g(this,null,function*(){yield te("checkout_submitted",{cart_value:t.cartValue,items_count:t.itemsCount,country:t.country,state:t.state||null,city:t.city||null,postal_code:t.postalCode||null,email:t.email||null,payment_method:t.paymentMethod,time_on_page_ms:t.timeOnPage,same_as_shipping:void 0===t.sameAsShipping||t.sameAsShipping,billing_country:t.billingCountry||null,billing_state:t.billingState||null,billing_city:t.billingCity||null,billing_postal_code:t.billingPostalCode||null,products:t.cartItems||[]})})}(e)}),this.emit("checkout:started",{formData:o.formData,paymentMethod:o.paymentMethod}),t&&this.expressProcessor)return this.logger.info(`Processing express checkout for ${o.paymentMethod} (after validation)`),this.loadingOverlay.hide(!0),void(yield this.expressProcessor.handleExpressCheckout(o.paymentMethod,c.items,c.isEmpty,()=>c.reset()));if("credit-card"===o.paymentMethod||"card_token"===o.paymentMethod){if(null==(a=this.creditCardService)?void 0:a.ready){const t={full_name:`${o.formData.fname||""} ${o.formData.lname||""}`.trim(),month:o.formData["cc-month"]||o.formData["exp-month"]||"",year:o.formData["cc-year"]||o.formData["exp-year"]||""};return void(yield this.creditCardService.tokenizeCard(t))}throw new Error("Credit card payment system is not ready. Please refresh the page and try again.")}yield this.processOrder()}catch(l){this.handleError(l,"handleFormSubmit"),o.setError("general","Failed to process order. Please try again."),o.setProcessing(!1),this.loadingOverlay.hide(!0)}})}processOrder(){return g(this,null,function*(){try{const t=yield this.createOrder();this.prospectCartEnhancer&&(yield this.prospectCartEnhancer.convertCart()),this.emit("order:completed",t),this.handleOrderRedirect(t)}catch(t){throw Mt.getState().setProcessing(!1),this.loadingOverlay.hide(!0),t}})}handleTokenizedPayment(t,e){return g(this,null,function*(){try{const i=Mt.getState();i.setPaymentToken(t),this.emit("payment:tokenized",{token:t,pmData:e,paymentMethod:i.paymentMethod}),yield this.processOrder()}catch(i){this.logger.error("Failed to process tokenized payment:",i);const t=Mt.getState();i.message&&i.message.includes("Payment failed:")?t.setError("general",i.message):t.setError("general","Payment processing failed. Please try again."),t.setProcessing(!1),this.loadingOverlay.hide(!0)}})}handleFieldChange(t){return g(this,null,function*(){const e=t.target,i=this.getFieldNameFromElement(e);if(!i)return;const n=Mt.getState();if(i.startsWith("billing-")){if(this.handleBillingFieldChange(i,e.value,n),"billing-country"===i){const t=this.billingFields.get("billing-province");t instanceof HTMLSelectElement&&(yield this.updateBillingStateOptions(e.value,t,n.formData.province))}}else{if(this.updateFormData({[i]:e.value}),n.clearError(i),["email","city","fname","lname"].includes(i)&&("blur"===t.type||"change"===t.type)){const t=e.value.trim();if(t){const e=this.validator.validateField(i,t);!e.isValid&&e.message?(this.validator.setError(i,e.message),this.logger.warn(`Invalid ${i} detected on blur:`,t)):e.isValid&&this.validator.clearError(i)}}if("country"===i){const t=this.fields.get("province");t instanceof HTMLSelectElement&&(yield this.updateStateOptions(e.value,t)),sessionStorage.setItem("next_selected_country",e.value),this.logger.debug(`Saved user's country selection to session: ${e.value}`)}if("address1"===i&&e.value&&e.value.trim().length>0&&(this.showLocationFields(),!this.hasTrackedShippingInfo&&n.formData.city&&n.formData.province))try{const t=n.shippingMethod,e=t?t.name:"Standard";$l.track(Sl.createAddShippingInfoEvent(e)),this.hasTrackedShippingInfo=!0,this.logger.info("Tracked add_shipping_info event (address complete)",{shippingTier:e})}catch(r){this.logger.warn("Failed to track add_shipping_info event:",r)}if("blur"===t.type||"change"===t.type){if("email"===i&&this.prospectCartEnhancer&&this.prospectCartEnhancer.updateEmail(e.value),"email"===i||"fname"===i||"lname"===i||"phone"===i){const t={};"email"===i&&(t.email=e.value),"fname"===i&&(t.firstName=e.value),"lname"===i&&(t.lastName=e.value),"phone"===i&&(t.phone=e.value),ul.updateUserData(t),this.logger.debug("Updated user data storage:",i,e.value)}this.prospectCartEnhancer&&["email","fname","lname"].includes(i)&&this.prospectCartEnhancer.checkAndCreateCart()}}if("blur"===t.type){const t=this.getFieldByName(i);if(!t)return;const n=t.closest(".form-group, .form-input");if(!e.value||"string"==typeof e.value&&""===e.value.trim()){const e=t.closest(".form-group");(null==n?void 0:n.querySelector(".next-error-label"))||(null==e?void 0:e.querySelector(".next-error-label"))?(t.classList.add("has-error","next-error-field"),t.classList.remove("no-error"),n&&(n.classList.add("addErrorIcon"),n.classList.remove("addTick"))):(t.classList.remove("has-error","next-error-field","no-error"),n&&n.classList.remove("addErrorIcon","addTick"))}else{const r=this.validator.validateField(i,e.value);if(r.isValid){if(t.classList.remove("has-error","next-error-field"),t.classList.add("no-error"),n){n.classList.remove("addErrorIcon"),n.classList.add("addTick");const t=n.querySelector(".next-error-label");t&&t.remove()}}else r.message&&(t.classList.remove("no-error"),this.validator.showError(i,r.message))}}else if("input"===t.type){const t=this.getFieldByName(i);if(t){t.classList.remove("has-error","next-error-field");const e=t.closest(".form-group, .form-input");if(e){let t=e.querySelector(".next-error-label");t&&t.remove();const i=e.closest(".form-group");i&&(t=i.querySelector(".next-error-label"),t&&t.remove())}const i=t.closest(".form-group");if(i){const t=i.querySelector(".next-error-label");t&&t.remove()}}}else if("change"===t.type){const t=this.getFieldByName(i);if(t&&e.value&&""!==e.value.trim()&&this.validator.validateField(i,e.value).isValid){t.classList.remove("has-error","next-error-field"),t.classList.add("no-error");const e=t.closest(".form-group, .form-input");if(e){e.classList.remove("addErrorIcon"),e.classList.add("addTick");const t=e.querySelector(".next-error-label");t&&t.remove()}Mt.getState().clearError(i)}}})}updateBillingStateOptions(t,e,i){return g(this,null,function*(){if(!t||""===t.trim())return e.innerHTML='<option value="">Select Country First</option>',void(e.disabled=!0);e.disabled=!0;const n=e.innerHTML;e.innerHTML='<option value="">Loading...</option>';try{let n=this.stateLoadingPromises.get(t);n?this.logger.debug(`Reusing existing state loading promise for ${t} (billing)`):(n=this.countryService.getCountryStates(t),this.stateLoadingPromises.set(t,n),n.finally(()=>{setTimeout(()=>this.stateLoadingPromises.delete(t),100)}));const r=yield n;this.updateBillingFormLabels(r.countryConfig),e.innerHTML="";const s=document.createElement("option");s.value="",s.textContent=`Select ${r.countryConfig.stateLabel}`,s.disabled=!1,s.selected=!0,e.appendChild(s),r.states.forEach(t=>{const i=document.createElement("option");i.value=t.code,i.textContent=t.name,e.appendChild(i)}),r.countryConfig.stateRequired?e.setAttribute("required","required"):e.removeAttribute("required"),i&&(e.value=i)}catch(r){this.logger.error("Failed to load billing states:",r),e.innerHTML=n}finally{e.disabled=!1}})}getFieldNameFromElement(t){return t.getAttribute("data-next-checkout-field")||t.getAttribute("os-checkout-field")||((t instanceof HTMLInputElement||t instanceof HTMLSelectElement)&&t.name?t.name:null)}getFieldByName(t){const e=this.fields.get(t);if(e)return e;return this.billingFields.get(t)||null}handleBillingFieldChange(t,e,i){const n=t.replace("billing-",""),r=i.billingAddress||{first_name:"",last_name:"",address1:"",city:"",province:"",postal:"",country:"",phone:""},s=Fd[n]||n;i.setBillingAddress(h(u({},r),{[s]:e}))}handlePaymentMethodChange(t){const e=t.target,i=Mt.getState(),n=Ld[e.value]||"credit-card";i.setPaymentMethod(n);const r=document.querySelector('[data-next-component="paypal-error"]');r instanceof HTMLElement&&(r.style.display="none");const s=document.querySelector('[data-next-component="credit-error"]');s instanceof HTMLElement&&(s.style.display="none"),this.ui.updatePaymentFormVisibility(e.value)}handleShippingMethodChange(t){const e=t.target,i=Mt.getState(),n=parseInt(e.value);if(isNaN(n))return;const r=[{id:1,name:"Standard Shipping",price:0,code:"standard"},{id:2,name:"Subscription Shipping",price:5,code:"subscription"},{id:3,name:"Expedited: Standard Overnight",price:28,code:"overnight"}].find(t=>t.id===n);if(r&&(i.setShippingMethod(r),Tt.getState().setShippingMethod(r.id),!this.hasTrackedShippingInfo))try{const t={standard:"Standard",subscription:"Subscription",overnight:"Express"}[r.code]||r.name;$l.track(Sl.createAddShippingInfoEvent(t)),this.hasTrackedShippingInfo=!0,this.logger.info("Tracked add_shipping_info event",{shippingTier:t})}catch(s){this.logger.warn("Failed to track add_shipping_info event:",s)}}handleBillingAddressToggle(t){const e=t.target;if(this.logger.info("[Billing] Toggle clicked",{checked:e.checked,animationInProgress:this.billingAnimationInProgress}),this.billingAnimationInProgress)return t.preventDefault(),e.checked=!e.checked,void this.logger.warn("[Billing] Click blocked - animation in progress");this.billingAnimationDebounceTimer&&clearTimeout(this.billingAnimationDebounceTimer),this.billingAnimationDebounceTimer=setTimeout(()=>{const t=Mt.getState(),i=document.querySelector(Md);i&&i instanceof HTMLElement?(this.logger.info("[Billing] Processing toggle",{targetChecked:e.checked,currentHeight:i.style.height,currentOverflow:i.style.overflow,currentTransition:i.style.transition,classes:i.className}),t.setSameAsShipping(e.checked),e.checked?(this.logger.info("[Billing] Collapsing form..."),this.collapseBillingForm(i)):(this.logger.info("[Billing] Expanding form..."),this.expandBillingForm(i),setTimeout(()=>{const e=t.formData.country,i=this.billingFields.get("billing-country");e&&i instanceof HTMLSelectElement&&(i.value=e,i.dispatchEvent(new Event("change",{bubbles:!0})),this.logger.debug("[Billing] Set country to:",e)),t.setBillingAddress({first_name:"",last_name:"",address1:"",address2:"",city:"",province:"",postal:"",country:e||"",phone:""})},50))):this.logger.error("[Billing] CRITICAL: Billing section not found!")},10)}setupAutofillDetection(){const t=new Map;let e=!1;this.eventBus.on("address:autocomplete-filled",()=>{e=!0,setTimeout(()=>{e=!1,[...this.fields.values()].forEach(e=>{(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&t.set(e,e.value)})},2e3)}),[...this.fields.values()].forEach(e=>{(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&t.set(e,e.value)});let i=0;const n=setInterval(()=>{if(i++,e)return;let r=!1;const s=[];[...this.fields.values()].forEach(e=>{if(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement){const i=t.get(e)||"",n=e.value,a=e.getAttribute("data-next-checkout-field")||e.getAttribute("os-checkout-field")||e.name;if("address1"===a||"address"===a)return void t.set(e,n);n!==i&&""!==n&&document.activeElement!==e&&(r=!0,t.set(e,n),a&&s.push(a),"country"!==a&&"billing-country"!==a&&e.dispatchEvent(new Event("change",{bubbles:!0})))}}),r&&s.length>0&&(this.logger.info("Browser autofill detected for fields:",s),setTimeout(()=>{const t=Mt.getState();if(!this.hasTrackedShippingInfo&&t.formData.city&&t.formData.province)try{const e=t.shippingMethod,i=e?e.name:"Standard";$l.track(Sl.createAddShippingInfoEvent(i)),this.hasTrackedShippingInfo=!0,this.logger.info("Tracked add_shipping_info event (browser autofill)",{shippingTier:i})}catch(e){this.logger.warn("Failed to track add_shipping_info event after browser autofill:",e)}},100)),i>=60&&(clearInterval(n),this.logger.debug("Stopped autofill detection after 30 seconds"))},500);this.autofillInterval=n}setupEventHandlers(){this.submitHandler=this.handleFormSubmit.bind(this),this.form.addEventListener("submit",this.submitHandler),this.changeHandler=this.handleFieldChange.bind(this),[...this.fields.values(),...this.billingFields.values()].forEach(t=>{(t instanceof HTMLInputElement||t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement)&&(t.addEventListener("change",this.changeHandler),t.addEventListener("blur",this.changeHandler),t.addEventListener("input",this.changeHandler))}),this.setupAutofillDetection(),this.paymentMethodChangeHandler=this.handlePaymentMethodChange.bind(this),this.form.querySelectorAll(['[data-next-checkout-field="payment-method"]','[os-checkout-field="payment-method"]','input[name="payment_method"]'].join(", ")).forEach(t=>{t.addEventListener("change",this.paymentMethodChangeHandler)}),this.shippingMethodChangeHandler=this.handleShippingMethodChange.bind(this),this.form.querySelectorAll('input[name="shipping_method"]').forEach(t=>{t.addEventListener("change",this.shippingMethodChangeHandler)}),this.billingAddressToggleHandler=this.handleBillingAddressToggle.bind(this);const t=this.form.querySelector('input[name="use_shipping_address"]');t&&t.addEventListener("change",this.billingAddressToggleHandler)}updateFormData(t){Mt.getState().updateFormData(t)}clearError(t){Mt.getState().clearError(t)}populateFormData(){const t=Mt.getState();this.fields.forEach((e,i)=>{t.formData[i]&&(e instanceof HTMLInputElement||e instanceof HTMLSelectElement)&&(e.value=t.formData[i])}),this.ui.updateLabelsForPopulatedData()}handleTestDataFilled(t){setTimeout(()=>{this.populateFormData(),this.fields.forEach(t=>{(t instanceof HTMLInputElement||t instanceof HTMLSelectElement)&&t.dispatchEvent(new Event("change",{bubbles:!0}))}),this.ui.updateLabelsForPopulatedData()},150)}handleKonamiActivation(t){return g(this,null,function*(){var e,i;const n=Mt.getState();if("konami"===(null==(e=t.detail)?void 0:e.method))try{const t={email:"test@test.com",fname:"Test",lname:"Order",phone:"+14807581224",address1:"Test Address 123",address2:"",city:"Tempe",province:"AZ",postal:"85281",country:"US",accepts_marketing:!0};n.clearAllErrors(),this.validator.clearAllErrors(),n.updateFormData(t),n.setPaymentMethod("credit-card"),n.setPaymentToken("test_card"),n.setSameAsShipping(!0);const e=Tt.getState().shippingMethod||n.shippingMethod;if(e)n.setShippingMethod(e);else{const t=dt.getState();if((null==(i=t.data)?void 0:i.shipping_methods)&&t.data.shipping_methods.length>0){const e=t.data.shipping_methods[0];e&&n.setShippingMethod({id:e.ref_id,name:e.code,price:parseFloat(e.price||"0"),code:e.code})}else n.setShippingMethod({id:1,name:"Standard Shipping",price:0,code:"standard"})}this.populateFormData(),setTimeout(()=>g(this,null,function*(){try{const t=yield this.createTestOrder();this.emit("order:completed",t),this.handleOrderRedirect(t)}catch(t){this.logger.error("Failed to create test order:",t)}}),1e3)}catch(r){this.logger.error("Error filling test data for Konami order:",r)}})}handleCheckoutUpdate(t){var e;t.errors&&Object.keys(t.errors).length>0&&Object.entries(t.errors).forEach(([t,e])=>{this.validator.setError(t,e)}),(null==(e=t.formData)?void 0:e.address1)&&t.formData.address1.trim().length>0&&this.showLocationFields(),t.isProcessing?this.submitButton&&(this.submitButton.disabled=!0,this.submitButton.setAttribute("aria-busy","true")):this.submitButton&&(this.submitButton.disabled=!1,this.submitButton.setAttribute("aria-busy","false"))}handleCartUpdate(t){t.isEmpty&&this.logger.warn("Cart is empty")}handleConfigUpdate(t){return g(this,null,function*(){try{t.spreedlyEnvironmentKey&&!this.creditCardService&&(yield this.initializeCreditCard(t.spreedlyEnvironmentKey,t.debug||!1))}catch(e){this.logger.error("Error handling config update:",e)}})}setSuccessUrl(t){this.setOrCreateMetaTag("next-success-url",t),this.setOrCreateMetaTag("next-next-url",t),this.setOrCreateMetaTag("os-next-page",t)}setFailureUrl(t){this.setOrCreateMetaTag("next-failure-url",t),this.setOrCreateMetaTag("os-failure-url",t)}setOrCreateMetaTag(t,e){let i=document.querySelector(`meta[name="${t}"]`);i||(i=document.createElement("meta"),i.name=t,document.head.appendChild(i)),i.content=e}validateField(t,e){const i=this.validator.validateField(t,e);return u({isValid:i.isValid},i.message&&{errorMessage:i.message})}clearAllValidationErrors(){Mt.getState().clearAllErrors(),this.validator.clearAllErrors()}update(){this.scanAllFields(),this.initializePhoneInputs()}cleanupEventListeners(){if(this.submitHandler&&this.form.removeEventListener("submit",this.submitHandler),this.changeHandler&&[...this.fields.values(),...this.billingFields.values()].forEach(t=>{t.removeEventListener("change",this.changeHandler),t.removeEventListener("blur",this.changeHandler),t.removeEventListener("input",this.changeHandler)}),this.autofillInterval&&clearInterval(this.autofillInterval),this.paymentMethodChangeHandler&&this.form.querySelectorAll(['[data-next-checkout-field="payment-method"]','[os-checkout-field="payment-method"]','input[name="payment_method"]'].join(", ")).forEach(t=>{t.removeEventListener("change",this.paymentMethodChangeHandler)}),this.shippingMethodChangeHandler&&this.form.querySelectorAll('input[name="shipping_method"]').forEach(t=>{t.removeEventListener("change",this.shippingMethodChangeHandler)}),this.billingAddressToggleHandler){const t=this.form.querySelector('input[name="use_shipping_address"]');t&&t.removeEventListener("change",this.billingAddressToggleHandler)}this.boundHandleTestDataFilled&&document.removeEventListener("checkout:test-data-filled",this.boundHandleTestDataFilled),this.boundHandleKonamiActivation&&document.removeEventListener("next:test-mode-activated",this.boundHandleKonamiActivation)}displayPaymentError(t){this.logger.info("[Payment Error] Displaying error:",t),setTimeout(()=>{const e=document.querySelector('[data-next-component="credit-error"]');if(e instanceof HTMLElement){const i=e.querySelector('[data-next-component="credit-error-text"]');i&&(i.textContent=t),e.style.display="flex",e.style.visibility="visible",e.style.opacity="1",e.classList.add("visible"),e.classList.remove("hidden"),"none"===e.style.display&&(e.style.removeProperty("display"),e.style.display="flex"),this.logger.info("[Payment Error] Error container shown with message:",t),setTimeout(()=>{e.style.display="none",e.classList.remove("visible")},1e4)}else this.logger.error("[Payment Error] Could not find error container element")},100),this.emit("payment:error",{errors:[t]})}destroy(){this.billingAnimationDebounceTimer&&clearTimeout(this.billingAnimationDebounceTimer),this.billingAnimationTimeouts.forEach(t=>clearTimeout(t)),this.billingAnimationTimeouts.clear(),this.validator&&this.validator.destroy(),this.creditCardService&&this.creditCardService.destroy(),this.prospectCartEnhancer&&this.prospectCartEnhancer.destroy(),this.phoneInputs.forEach(t=>{try{t.destroy()}catch(e){}}),this.phoneInputs.clear(),this.autocompleteInstances.clear(),this.fields.clear(),this.billingFields.clear(),this.paymentButtons.clear(),super.destroy()}}},Symbol.toStringTag,{value:"Module"})),Ud=tt("PaymentAvailability");function Nd(){try{return/Android/i.test(navigator.userAgent)?(Ud.debug("Android device detected - hiding Apple Pay"),!1):(Ud.debug("Apple Pay available (non-Android device)"),!0)}catch(t){return Ud.warn("Error checking Apple Pay availability:",t),!0}}const zd=Object.freeze(Object.defineProperty({__proto__:null,ExpressCheckoutContainerEnhancer:class extends be{constructor(t){super(t),this.buttonInstances=new Map,this.buttonClickHandlers=new Map,this.loadingOverlay=new od}initialize(){return g(this,null,function*(){if(this.validateElement(),"container"!==this.getAttribute("data-next-express-checkout"))throw new Error("ExpressCheckoutContainerEnhancer can only be used on container elements");const t={applePay:Nd(),googlePay:!0,paypal:!0,userAgent:navigator.userAgent,platform:navigator.platform||"unknown"};if(this.logger.info("Payment capabilities detected:",t),this.buttonsContainer=this.element.querySelector('[data-next-express-checkout="buttons"]'),!this.buttonsContainer)return void this.logger.warn('No buttons container found with data-next-express-checkout="buttons"');this.errorElement=document.querySelector('[data-next-component="express-error"]'),this.errorTextElement=document.querySelector('[data-next-component="express-error-text"]'),this.errorElement&&(this.errorElement.style.display="none");const e=yt.getState(),i=new re(e.apiKey);this.orderManager=new Id(i,this.logger,(t,e)=>this.emit(t,e)),this.expressProcessor=new Cd(this.logger,()=>this.loadingOverlay.show(),t=>this.loadingOverlay.hide(t),(t,e)=>this.emit(t,e),this.orderManager),this.subscribe(yt,this.handleConfigUpdate.bind(this)),this.subscribe(dt,this.handleCampaignUpdate.bind(this)),this.subscribe(Tt,this.handleCartUpdate.bind(this)),this.handleConfigUpdate(yt.getState()),this.handleCampaignUpdate(dt.getState()),this.logger.debug("ExpressCheckoutContainerEnhancer initialized")})}handleConfigUpdate(t){const e=this.paymentConfig;this.paymentConfig=t.paymentConfig,JSON.stringify(e)!==JSON.stringify(t.paymentConfig)&&this.updateExpressCheckoutButtons()}handleCampaignUpdate(t){var e;const i=null==(e=t.data)?void 0:e.available_express_payment_methods;JSON.stringify(this.availableExpressMethods)!==JSON.stringify(i)&&(this.availableExpressMethods=i,this.updateExpressCheckoutButtons())}updateExpressCheckoutButtons(){return g(this,null,function*(){var t;if(this.buttonsContainer)if(this.availableExpressMethods&&this.availableExpressMethods.length>0){this.showContainer(),this.clearButtons();for(const e of this.availableExpressMethods)switch(e.code){case"paypal":this.createPayPalButton();break;case"apple_pay":Nd()?this.createApplePayButton():this.logger.debug("Apple Pay not available on this device/browser");break;case"google_pay":this.createGooglePayButton();break;default:this.logger.warn(`Unknown express payment method: ${e.code}`)}const t=this.buttonInstances.size>0;this.logger.debug("Express checkout buttons updated from campaign data",{requestedMethods:this.availableExpressMethods.map(t=>t.code),actuallyShown:Array.from(this.buttonInstances.keys()),hasVisibleButtons:t}),t||this.hideContainer()}else if(null==(t=this.paymentConfig)?void 0:t.expressCheckout){const{enabled:t,methods:e}=this.paymentConfig.expressCheckout;if(!t)return void this.hideContainer();if(!Object.values(e||{}).some(t=>t))return void this.hideContainer();this.showContainer(),this.clearButtons(),e.paypal?this.createPayPalButton():e.paypal&&this.logger.debug("PayPal enabled in config but not available on device"),e.applePay&&Nd()?this.createApplePayButton():e.applePay&&this.logger.debug("Apple Pay enabled in config but not available on device/browser"),e.googlePay?this.createGooglePayButton():e.googlePay&&this.logger.debug("Google Pay enabled in config but not available on device/browser");const i=this.buttonInstances.size>0;this.logger.debug("Express checkout buttons updated from config",{requestedMethods:{paypal:e.paypal,applePay:e.applePay,googlePay:e.googlePay},actuallyShown:Array.from(this.buttonInstances.keys()),hasVisibleButtons:i}),i||this.hideContainer()}else this.hideContainer();else this.hideContainer()})}hideContainer(){this.element.style.display="none",this.logger.debug("Express checkout container hidden - no methods enabled")}showContainer(){this.element.style.display="",this.logger.debug("Express checkout container shown")}clearButtons(){for(const[t,e]of this.buttonClickHandlers){const i=this.buttonInstances.get(t);i&&i.removeEventListener("click",e)}if(this.buttonClickHandlers.clear(),this.buttonsContainer)for(;this.buttonsContainer.firstChild;)this.buttonsContainer.removeChild(this.buttonsContainer.firstChild);this.buttonInstances.clear()}handleButtonClick(t,e){return g(this,null,function*(){if(e.preventDefault(),e.currentTarget.disabled)return;this.errorElement&&(this.errorElement.style.display="none");for(const[,t]of this.buttonInstances)t.setAttribute("disabled","true");const i=Tt.getState(),n=Mt.getState();i.isEmpty?queueMicrotask(()=>{!function(t){g(this,null,function*(){yield te("empty_cart_checkout_attempt",{payment_method:t.paymentMethod,button_location:t.buttonLocation||"express_checkout"})})}({paymentMethod:t,buttonLocation:"express_checkout"})}):queueMicrotask(()=>{var e,r;const s=(null==(e=n.formData)?void 0:e.country)||(null==(r=yt.getState().addressConfig)?void 0:r.defaultCountry)||"US";ie({cartValue:i.total,itemsCount:i.totalQuantity,detectedCountry:s,paymentMethod:t})});try{n.setProcessing(!0),n.setPaymentMethod(t),yield this.expressProcessor.handleExpressCheckout(t,i.items,i.isEmpty,()=>i.reset()),setTimeout(()=>{for(const[,t]of this.buttonInstances)i.isEmpty||t.removeAttribute("disabled")},3e3)}catch(r){if(this.handleError(r,"handleButtonClick"),n.setError("payment","Express checkout failed. Please try again."),this.errorElement&&this.errorTextElement){const t=r instanceof Error?r.message:"Express checkout failed";this.errorTextElement.textContent=`${t}. Please try a different payment method.`,this.errorElement.style.display="flex",this.errorElement.style.position="relative",this.errorElement.style.zIndex="10000"}for(const[,t]of this.buttonInstances)i.isEmpty||t.removeAttribute("disabled")}finally{n.setProcessing(!1)}})}handleCartUpdate(t){for(const[,e]of this.buttonInstances)t.isEmpty?(e.setAttribute("disabled","true"),e.classList.add("next-cart-empty")):(e.removeAttribute("disabled"),e.classList.remove("next-cart-empty"))}createPayPalButton(){return g(this,null,function*(){const t=this.createButton("paypal","cc-paypal",'<?xml version="1.0" encoding="UTF-8"?>\n<svg width="86px" height="22px" viewBox="0 0 86 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n  <title>paypal</title>\n  <g id="-Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n    <g id="express-checkout-cta" transform="translate(-204.000000, -15.000000)" fill-rule="nonzero">\n      <g id="paypal" transform="translate(204.000000, 15.000000)">\n        <path d="M66.4793651,5.73913043 L61.8380952,5.73913043 C61.5650794,5.73913043 61.2920635,6.01242236 61.1555556,6.28571429 L59.2444444,18.310559 C59.2444444,18.5838509 59.3809524,18.7204969 59.6539683,18.7204969 L62.1111111,18.7204969 C62.384127,18.7204969 62.5206349,18.5838509 62.5206349,18.310559 L63.0666667,14.8944099 C63.0666667,14.621118 63.3396825,14.3478261 63.7492063,14.3478261 L65.2507937,14.3478261 C68.3904762,14.3478261 70.1650794,12.8447205 70.5746032,9.83850932 C70.847619,8.60869565 70.5746032,7.51552795 70.0285714,6.83229814 C69.2095238,6.14906832 67.9809524,5.73913043 66.4793651,5.73913043 M67.0253968,10.2484472 C66.752381,11.8881988 65.5238095,11.8881988 64.2952381,11.8881988 L63.4761905,11.8881988 L64.0222222,8.74534161 C64.0222222,8.60869565 64.1587302,8.47204969 64.431746,8.47204969 L64.7047619,8.47204969 C65.5238095,8.47204969 66.3428571,8.47204969 66.752381,9.01863354 C67.0253968,9.1552795 67.0253968,9.56521739 67.0253968,10.2484472" id="Shape" fill="#139AD6"></path>\n        <g id="Group" transform="translate(25.800000, 5.739130)" fill="#263B80">\n          <path d="M7.23492063,0 L2.59365079,0 C2.32063492,0 2.04761905,0.273291925 1.91111111,0.546583851 L0,12.5714286 C0,12.8447205 0.136507937,12.9813665 0.40952381,12.9813665 L2.59365079,12.9813665 C2.86666667,12.9813665 3.13968254,12.7080745 3.27619048,12.4347826 L3.82222222,9.1552795 C3.82222222,8.88198758 4.0952381,8.60869565 4.5047619,8.60869565 L6.00634921,8.60869565 C9.14603175,8.60869565 10.9206349,7.10559006 11.3301587,4.09937888 C11.6031746,2.86956522 11.3301587,1.77639752 10.784127,1.0931677 C9.96507937,0.409937888 8.87301587,0 7.23492063,0 M7.78095238,4.50931677 C7.50793651,6.14906832 6.27936508,6.14906832 5.05079365,6.14906832 L4.36825397,6.14906832 L4.91428571,3.00621118 C4.91428571,2.86956522 5.05079365,2.73291925 5.32380952,2.73291925 L5.5968254,2.73291925 C6.41587302,2.73291925 7.23492063,2.73291925 7.64444444,3.27950311 C7.78095238,3.41614907 7.91746032,3.82608696 7.78095238,4.50931677" id="Shape"></path>\n          <path d="M21.2952381,4.37267081 L19.1111111,4.37267081 C18.9746032,4.37267081 18.7015873,4.50931677 18.7015873,4.64596273 L18.5650794,5.32919255 L18.4285714,5.05590062 C17.8825397,4.37267081 16.9269841,4.09937888 15.8349206,4.09937888 C13.3777778,4.09937888 11.1936508,6.01242236 10.784127,8.60869565 C10.5111111,9.97515528 10.9206349,11.2049689 11.6031746,12.0248447 C12.2857143,12.8447205 13.2412698,13.1180124 14.4698413,13.1180124 C16.5174603,13.1180124 17.6095238,11.8881988 17.6095238,11.8881988 L17.4730159,12.5714286 C17.4730159,12.8447205 17.6095238,12.9813665 17.8825397,12.9813665 L19.9301587,12.9813665 C20.2031746,12.9813665 20.4761905,12.7080745 20.6126984,12.4347826 L21.8412698,4.7826087 C21.7047619,4.64596273 21.431746,4.37267081 21.2952381,4.37267081 M18.1555556,8.74534161 C17.8825397,9.97515528 16.9269841,10.931677 15.5619048,10.931677 C14.8793651,10.931677 14.3333333,10.6583851 14.0603175,10.3850932 C13.7873016,9.97515528 13.6507937,9.42857143 13.6507937,8.74534161 C13.7873016,7.51552795 14.8793651,6.55900621 16.1079365,6.55900621 C16.7904762,6.55900621 17.2,6.83229814 17.6095238,7.10559006 C18.0190476,7.51552795 18.1555556,8.19875776 18.1555556,8.74534161" id="Shape"></path>\n        </g>\n        <path d="M80.4031746,10.1118012 L78.2190476,10.1118012 C78.0825397,10.1118012 77.8095238,10.2484472 77.8095238,10.3850932 L77.6730159,11.068323 L77.5365079,10.7950311 C76.9904762,10.1118012 76.0349206,9.83850932 74.9428571,9.83850932 C72.4857143,9.83850932 70.3015873,11.7515528 69.8920635,14.3478261 C69.6190476,15.7142857 70.0285714,16.9440994 70.7111111,17.7639752 C71.3936508,18.5838509 72.3492063,18.8571429 73.5777778,18.8571429 C75.6253968,18.8571429 76.7174603,17.6273292 76.7174603,17.6273292 L76.5809524,18.310559 C76.5809524,18.5838509 76.7174603,18.7204969 76.9904762,18.7204969 L79.0380952,18.7204969 C79.3111111,18.7204969 79.584127,18.447205 79.7206349,18.173913 L80.9492063,10.5217391 C80.8126984,10.3850932 80.6761905,10.1118012 80.4031746,10.1118012 M77.2634921,14.484472 C76.9904762,15.7142857 76.0349206,16.6708075 74.6698413,16.6708075 C73.9873016,16.6708075 73.4412698,16.3975155 73.168254,16.1242236 C72.8952381,15.7142857 72.7587302,15.1677019 72.7587302,14.484472 C72.8952381,13.2546584 73.9873016,12.2981366 75.215873,12.2981366 C75.8984127,12.2981366 76.3079365,12.5714286 76.7174603,12.8447205 C77.2634921,13.2546584 77.4,13.9378882 77.2634921,14.484472" id="Shape" fill="#139AD6"></path>\n        <path d="M58.9714286,10.1118012 L56.6507937,10.1118012 C56.3777778,10.1118012 56.2412698,10.2484472 56.1047619,10.3850932 L53.1015873,15.0310559 L51.7365079,10.6583851 C51.6,10.3850932 51.4634921,10.2484472 51.0539683,10.2484472 L48.8698413,10.2484472 C48.5968254,10.2484472 48.4603175,10.5217391 48.4603175,10.7950311 L50.9174603,18.0372671 L48.5968254,21.3167702 C48.4603175,21.5900621 48.5968254,22 48.8698413,22 L51.0539683,22 C51.3269841,22 51.4634921,21.863354 51.6,21.7267081 L59.1079365,10.931677 C59.5174603,10.5217391 59.2444444,10.1118012 58.9714286,10.1118012" id="Path" fill="#263B80"></path>\n        <path d="M82.9968254,6.14906832 L81.0857143,18.447205 C81.0857143,18.7204969 81.2222222,18.8571429 81.4952381,18.8571429 L83.4063492,18.8571429 C83.6793651,18.8571429 83.952381,18.5838509 84.0888889,18.310559 L86,6.28571429 C86,6.01242236 85.8634921,5.8757764 85.5904762,5.8757764 L83.4063492,5.8757764 C83.2698413,5.73913043 83.1333333,5.8757764 82.9968254,6.14906832" id="Path" fill="#139AD6"></path>\n        <path d="M15.6984127,1.63975155 C14.7428571,0.546583851 12.968254,4.85463981e-15 10.5111111,4.85463981e-15 L3.68571429,4.85463981e-15 C3.27619048,4.85463981e-15 2.86666667,0.409937888 2.73015873,0.819875776 L0,18.7204969 C0,19.1304348 0.273015873,19.4037267 0.546031746,19.4037267 L4.77777778,19.4037267 L5.86984127,12.7080745 L5.86984127,12.9813665 C6.00634921,12.5714286 6.41587302,12.1614907 6.82539683,12.1614907 L8.87301587,12.1614907 C12.831746,12.1614907 15.8349206,10.5217391 16.7904762,6.01242236 C16.7904762,5.8757764 16.7904762,5.73913043 16.7904762,5.60248447 C16.6539683,5.60248447 16.6539683,5.60248447 16.7904762,5.60248447 C16.9269841,3.82608696 16.6539683,2.73291925 15.6984127,1.63975155" id="Path" fill="#263B80"></path>\n        <path d="M16.6539683,5.60248447 L16.6539683,5.60248447 C16.6539683,5.73913043 16.6539683,5.8757764 16.6539683,6.01242236 C15.6984127,10.6583851 12.6952381,12.1614907 8.73650794,12.1614907 L6.68888889,12.1614907 C6.27936508,12.1614907 5.86984127,12.5714286 5.73333333,12.9813665 L4.36825397,21.3167702 C4.36825397,21.5900621 4.5047619,21.863354 4.91428571,21.863354 L8.46349206,21.863354 C8.87301587,21.863354 9.28253968,21.5900621 9.28253968,21.1801242 L9.28253968,21.0434783 L9.96507937,16.8074534 L9.96507937,16.5341615 C9.96507937,16.1242236 10.3746032,15.8509317 10.784127,15.8509317 L11.3301587,15.8509317 C14.7428571,15.8509317 17.4730159,14.484472 18.1555556,10.3850932 C18.4285714,8.74534161 18.2920635,7.24223602 17.4730159,6.28571429 C17.3365079,6.01242236 17.0634921,5.73913043 16.6539683,5.60248447" id="Path" fill="#139AD6"></path>\n        <path d="M15.6984127,5.19254658 C15.5619048,5.19254658 15.4253968,5.05590062 15.2888889,5.05590062 C15.152381,5.05590062 15.015873,5.05590062 14.8793651,4.91925466 C14.3333333,4.7826087 13.7873016,4.7826087 13.1047619,4.7826087 L7.78095238,4.7826087 C7.64444444,4.7826087 7.50793651,4.7826087 7.37142857,4.91925466 C7.0984127,5.05590062 6.96190476,5.32919255 6.96190476,5.60248447 L5.86984127,12.7080745 L5.86984127,12.9813665 C6.00634921,12.5714286 6.41587302,12.1614907 6.82539683,12.1614907 L8.87301587,12.1614907 C12.831746,12.1614907 15.8349206,10.5217391 16.7904762,6.01242236 C16.7904762,5.8757764 16.7904762,5.73913043 16.9269841,5.60248447 C16.6539683,5.46583851 16.5174603,5.32919255 16.2444444,5.32919255 C15.8349206,5.19254658 15.8349206,5.19254658 15.6984127,5.19254658" id="Path" fill="#232C65"></path>\n      </g>\n    </g>\n  </g>\n</svg>');t.style.backgroundColor="hsla(42.121212121212125, 100.00%, 61.18%, 1.00)",this.buttonInstances.set("paypal",t),this.buttonsContainer.appendChild(t);const e=t=>this.handleButtonClick("paypal",t);this.buttonClickHandlers.set("paypal",e),t.addEventListener("click",e),this.emit("express-checkout:initialized",{method:"paypal",element:t}),this.logger.debug("PayPal express checkout button created")})}createApplePayButton(){return g(this,null,function*(){const t=this.createButton("apple_pay","cc-apple-pay",'<?xml version="1.0" encoding="UTF-8"?>\n<svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="100%" height="100%" viewBox="0 0 512 252.2">\n  <defs></defs>\n  <path class="st0" fill="white" d="M93.6,69.1c-6,7.1-15.6,12.7-25.2,11.9-1.2-9.6,3.5-19.8,9-26.1,6-7.3,16.5-12.5,25-12.9,1,10-2.9,19.8-8.8,27.1M102.3,82.9c-13.9-.8-25.8,7.9-32.4,7.9s-16.8-7.5-27.8-7.3c-14.3.2-27.6,8.3-34.9,21.2-15,25.8-3.9,64,10.6,85,7.1,10.4,15.6,21.8,26.8,21.4,10.6-.4,14.8-6.9,27.6-6.9s16.6,6.9,27.8,6.7c11.6-.2,18.9-10.4,26-20.8,8.1-11.8,11.4-23.3,11.6-23.9-.2-.2-22.4-8.7-22.6-34.3-.2-21.4,17.5-31.6,18.3-32.2-10-14.8-25.6-16.4-31-16.8M182.6,53.9v155.9h24.2v-53.3h33.5c30.6,0,52.1-21,52.1-51.4s-21.1-51.2-51.3-51.2h-58.5ZM206.8,74.3h27.9c21,0,33,11.2,33,30.9s-12,31-33.1,31h-27.8v-61.9ZM336.6,211c15.2,0,29.3-7.7,35.7-19.9h.5v18.7h22.4v-77.6c0-22.5-18-37-45.7-37s-44.7,14.7-45.4,34.9h21.8c1.8-9.6,10.7-15.9,22.9-15.9s23.1,6.9,23.1,19.6v8.6l-30.2,1.8c-28.1,1.7-43.3,13.2-43.3,33.2s15.7,33.6,38.2,33.6ZM343.1,192.5c-12.9,0-21.1-6.2-21.1-15.7s7.9-15.5,23-16.4l26.9-1.7v8.8c0,14.6-12.4,25-28.8,25ZM425.1,252.2c23.6,0,34.7-9,44.4-36.3l42.5-119.2h-24.6l-28.5,92.1h-.5l-28.5-92.1h-25.3l41,113.5-2.2,6.9c-3.7,11.7-9.7,16.2-20.4,16.2s-5.6-.2-7.1-.4v18.7c1.4.4,7.4.6,9.2.6Z" />\n</svg>');t.style.color="hsla(0, 0.00%, 100.00%, 1.00)",this.buttonInstances.set("apple_pay",t),this.buttonsContainer.appendChild(t);const e=t=>this.handleButtonClick("apple_pay",t);this.buttonClickHandlers.set("apple_pay",e),t.addEventListener("click",e),this.emit("express-checkout:initialized",{method:"apple_pay",element:t}),this.logger.debug("Apple Pay express checkout button created")})}createGooglePayButton(){return g(this,null,function*(){const t=this.createButton("google_pay","cc-google-pay",'<?xml version="1.0" encoding="UTF-8"?>\n<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 41 20.3" width="100%" height="100%">\n  <path fill="#ffffff" fill-rule="evenodd" d="M19.5,5.9v4.1h2.5c.6,0,1.1-.2,1.5-.6.4-.4.6-.9.6-1.4s-.2-1-.6-1.4c-.4-.4-.9-.6-1.5-.6h-2.5ZM19.5,11.5v4.7h-1.5V4.5h4c1,0,1.9.3,2.6,1,.7.7,1.1,1.5,1.1,2.5s-.4,1.8-1.1,2.5c-.7.7-1.6,1-2.6,1h-2.5s0,0,0,0ZM27.2,13.7c0,.4.2.7.5,1,.3.3.7.4,1.2.4.6,0,1.2-.2,1.7-.7.5-.5.7-1,.7-1.6-.5-.4-1.1-.6-2-.6s-1.1.1-1.5.4c-.4.3-.6.7-.6,1.1M29.1,7.9c1.1,0,2,.3,2.6.9.6.6,1,1.4,1,2.4v4.9h-1.4v-1.1h0c-.6.9-1.5,1.4-2.5,1.4s-1.6-.3-2.2-.8c-.6-.5-.9-1.2-.9-2s.3-1.5.9-2,1.5-.7,2.5-.7,1.6.2,2.2.5v-.3c0-.5-.2-1-.6-1.3-.4-.4-.9-.6-1.5-.5-.8,0-1.5.4-2,1.1l-1.3-.8c.7-1,1.8-1.6,3.2-1.6M41,8.2l-5,11.5h-1.6l1.9-4-3.3-7.5h1.6l2.4,5.7h0l2.3-5.8h1.6Z" />\n  <path fill="#4285f4" fill-rule="evenodd" d="M13.4,10.4c0-.5,0-.9-.1-1.4h-6.3v2.6h3.6c-.2.8-.6,1.6-1.3,2v1.7h2.2c1.3-1.2,2-2.9,2-4.9" />\n  <path fill="#34a853" fill-rule="evenodd" d="M7,17c1.8,0,3.3-.6,4.5-1.6l-2.2-1.7c-.6.4-1.4.6-2.3.6-1.8,0-3.2-1.2-3.8-2.8H1v1.7c1.1,2.3,3.5,3.7,6,3.7" />\n  <path fill="#fabb05" fill-rule="evenodd" d="M3.2,11.6c-.3-.8-.3-1.7,0-2.6v-1.7H1c-.5.9-.7,2-.7,3,0,1.1.3,2.1.7,3l2.2-1.7h0Z" />\n  <path fill="#e94235" fill-rule="evenodd" d="M7,6.2c1,0,1.9.3,2.6,1h0s1.9-1.9,1.9-1.9c-1.2-1.1-2.7-1.7-4.5-1.7-2.5,0-4.9,1.4-6,3.7l2.2,1.7c.5-1.6,2-2.8,3.8-2.8" />\n</svg>');this.buttonInstances.set("google_pay",t),this.buttonsContainer.appendChild(t);const e=t=>this.handleButtonClick("google_pay",t);this.buttonClickHandlers.set("google_pay",e),t.addEventListener("click",e),this.emit("express-checkout:initialized",{method:"google_pay",element:t}),this.logger.debug("Google Pay express checkout button created")})}createButton(t,e,i){const n=document.createElement("button");n.className=`payment-btn ${e}`,n.setAttribute("data-next-express-checkout",t),n.setAttribute("data-action","submit"),n.style.position="relative",n.style.display="flex",n.style.width="100%",n.style.height="2.75rem",n.style.justifyContent="center",n.style.alignItems="center",n.style.borderRadius="4px",n.style.backgroundColor="hsla(0, 0.00%, 0.00%, 1.00)",n.style.border="none",n.style.cursor="pointer";const r=document.createElement("div");r.setAttribute("next-slot","content");const s=document.createElement("div");"apple_pay"!==t&&"google_pay"!==t||(s.className="payment-btn__logo",s.style.height="1.5rem"),s.innerHTML=i,r.appendChild(s),n.appendChild(r);const a=document.createElement("div");return a.className="payment-btn-spinner",a.setAttribute("next-slot","spinner"),a.innerHTML='<div class="spinner"></div>',n.appendChild(a),n}update(){this.handleConfigUpdate(yt.getState())}destroy(){this.clearButtons(),super.destroy()}}},Symbol.toStringTag,{value:"Module"}));class qd{static render(t,e){const{data:i,formatters:n={},defaultValues:r={}}=e;return t.replace(/\{([^}]+)\}/g,(t,e)=>{try{const t=this.getValue(i,e),s=this.formatValue(t,e,n);return""===s||null==s?r[e]||"":String(s)}catch(s){return r[e]||""}})}static getValue(t,e){const i=e.split(".");let n=t;for(const r of i){if(null==n)return;n=n[r]}return n}static formatValue(t,e,i){if(e.endsWith(".raw"))return t;const n=["price","total","savings","amount","cost","fee","charge","compare","retail","recurring","subtotal","tax","shipping","discount","credit","balance","payment","refund"].some(t=>e.toLowerCase().includes(t.toLowerCase()));return n&&"number"==typeof t?i.currency?i.currency(t):t:n&&"string"==typeof t&&!isNaN(parseFloat(t))?i.currency?i.currency(parseFloat(t)):t:e.includes("date")||e.includes("created_at")?i.date?i.date(t):t:"string"==typeof t&&(e.includes("name")||e.includes("title")||e.includes("description"))&&i.escapeHtml?i.escapeHtml(t):t}static validateTemplate(t,e){const i=[],n=this.extractPlaceholders(t);for(const s of n){const t=s.replace(".raw","");e.some(e=>e.startsWith(t))||i.push(`Unknown placeholder: {${s}}`)}const r=t.match(/\{[^}]*$/g);return r&&i.push(`Unclosed placeholders found: ${r.join(", ")}`),i}static extractPlaceholders(t){return(t.match(/\{([^}]+)\}/g)||[]).map(t=>t.slice(1,-1))}static createDefaultFormatters(){return{currency:t=>{const{formatCurrency:e}=require("@/utils/currencyFormatter");return e(t)},date:t=>{if(!t)return"";try{const e=new Date(t);return isNaN(e.getTime())?String(t):new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)}catch(e){return String(t)}},escapeHtml:t=>{const e=document.createElement("div");return e.textContent=t,e.innerHTML}}}}const jd=Object.freeze(Object.defineProperty({__proto__:null,CartItemListEnhancer:class extends be{constructor(){super(...arguments),this.lastRenderedItems="",this.groupItems=!1}initialize(){return g(this,null,function*(){var t,e;this.validateElement();const i=this.getAttribute("data-item-template-id"),n=this.getAttribute("data-item-template-selector");if(i){const e=document.getElementById(i);this.template=null!=(t=null==e?void 0:e.innerHTML.trim())?t:""}else if(n){const t=document.querySelector(n);this.template=null!=(e=null==t?void 0:t.innerHTML.trim())?e:""}else this.template=this.getAttribute("data-item-template")||this.element.innerHTML.trim();this.template&&""!==this.template.replace(/<!--[\s\S]*?-->/g,"").trim()||(this.template=this.getDefaultItemTemplate()),this.emptyTemplate=this.getAttribute("data-empty-template")||'<div class="cart-empty">Your cart is empty</div>';const r=this.getAttribute("data-title-map");if(r)try{this.titleMap=JSON.parse(r)}catch(s){this.logger.warn("Invalid title map JSON:",s)}this.groupItems=this.hasAttribute("data-group-items"),this.subscribe(Tt,this.handleCartUpdate.bind(this)),this.handleCartUpdate(Tt.getState()),this.logger.debug("CartItemListEnhancer initialized")})}update(t){t&&this.handleCartUpdate(t)}handleCartUpdate(t){return g(this,null,function*(){try{t.isEmpty||0===t.items.length?this.renderEmptyCart():yield this.renderCartItems(t.items)}catch(e){this.handleError(e,"handleCartUpdate")}})}renderEmptyCart(){this.element.innerHTML=this.emptyTemplate||"",this.addClass("cart-empty"),this.removeClass("cart-has-items")}renderCartItems(t){return g(this,null,function*(){this.removeClass("cart-empty"),this.addClass("cart-has-items");const e=dt.getState(),i=[],n=this.groupItems?this.groupIdenticalItems(t):t;for(const t of n){const n=yield this.renderCartItem(t,e);n&&i.push(n)}const r=i.join("");r!==this.lastRenderedItems?(this.element.innerHTML=r,this.lastRenderedItems=r,yield this.enhanceNewElements()):this.logger.debug("Cart items HTML unchanged, skipping DOM update")})}renderCartItem(t,e){return g(this,null,function*(){try{const i=e.getPackage(t.packageId);if(!i)return this.logger.warn(`Package data not found for item ${t.packageId}`),"";const n=this.prepareCartItemData(t,i),r=this.template||this.getDefaultItemTemplate(),s=h(u({},qd.createDefaultFormatters()),{currency:t=>zl.formatCurrency(t)});return qd.render(r,{data:{item:n},formatters:s})}catch(i){return this.logger.error("Error rendering cart item:",i),""}})}getDefaultItemTemplate(){return'\n      <div class="cart-item" data-cart-item-id="{item.id}" data-package-id="{item.packageId}">\n        <div class="cart-item-image">\n          <img src="{item.image}" alt="{item.name}" onerror="this.style.display=\'none\';">\n          <span style="font-size: 1.5em;">ðŸ“¦</span>\n        </div>\n        <div class="cart-item-details">\n          <h4 class="cart-item-name">{item.name}</h4>\n          <div class="cart-item-variant" style="color: #666; font-size: 0.9em;">{item.variantAttributesFormatted}</div>\n          <div class="cart-item-sku" style="color: #999; font-size: 0.85em;">SKU: {item.variantSku}</div>\n          <div class="cart-item-pricing">\n            <div class="original-price {item.showOriginalPrice}" style="text-decoration: line-through; color: #999;">{item.price} each</div>\n            <div class="current-price">{item.finalPrice} each</div>\n            <div class="discount-badge {item.showDiscount}" style="color: #e74c3c; font-weight: bold;">-{item.discountAmount} coupon discount</div>\n            <div class="compare-price {item.showCompare}" style="text-decoration: line-through; color: #999;">{item.comparePrice}</div>\n            <div class="savings {item.showSavings}" style="color: #0d7519; font-weight: bold;">Save {item.savingsAmount} ({item.savingsPct})</div>\n            <div class="frequency">{item.frequency}</div>\n            <div class="recurring-price {item.showRecurring}" style="color: #666;">Then {item.recurringPrice} recurring</div>\n          </div>\n        </div>\n        <div class="quantity-controls">\n          <button class="quantity-btn" data-next-quantity="decrease" data-package-id="{item.packageId}">-</button>\n          <span class="quantity-display">{item.quantity}</span>\n          <button class="quantity-btn" data-next-quantity="increase" data-package-id="{item.packageId}">+</button>\n        </div>\n        <div class="cart-item-total">\n          <div class="line-total-original {item.showOriginalPrice}" style="text-decoration: line-through; color: #999; font-size: 0.9em;">{item.lineTotal}</div>\n          <div class="line-total">{item.finalLineTotal}</div>\n          <div class="line-compare {item.showCompare}" style="text-decoration: line-through; color: #999; font-size: 0.9em;">{item.lineCompare}</div>\n        </div>\n        <button class="remove-btn" data-next-remove-item data-package-id="{item.packageId}" data-confirm="true" data-confirm-message="Remove this item from your cart?">Remove</button>\n      </div>\n    '.trim()}enhanceNewElements(){return g(this,null,function*(){const t=this.element.querySelectorAll("[data-next-quantity]"),e=this.element.querySelectorAll("[data-next-remove-item]");if(t.length>0){const{QuantityControlEnhancer:e}=yield Promise.resolve().then(()=>Vd);for(const n of Array.from(t))if(n instanceof HTMLElement)try{const t=new e(n);yield t.initialize(),this.logger.debug("Enhanced quantity control button",n)}catch(i){this.logger.error("Failed to enhance quantity button:",i,n)}}if(e.length>0){const{RemoveItemEnhancer:t}=yield Promise.resolve().then(()=>Bd);for(const n of Array.from(e))if(n instanceof HTMLElement)try{const e=new t(n);yield e.initialize(),this.logger.debug("Enhanced remove button",n)}catch(i){this.logger.error("Failed to enhance remove button:",i,n)}}this.logger.debug(`Enhanced ${t.length} quantity buttons and ${e.length} remove buttons`)})}prepareCartItemData(t,e){var i,n,r;const s=t.price,a=s*t.quantity,o=parseFloat(e.price||"0"),c=parseFloat(e.price_total||"0"),l=parseFloat(e.price_retail||e.price||"0"),d=parseFloat(e.price_retail_total||"0"),p=e.qty||1,f=Tt.getState();let m=0,g=!1;if(f.appliedCoupons&&f.appliedCoupons.length>0)for(const u of f.appliedCoupons)if("package"===u.definition.scope&&(null==(i=u.definition.packageIds)?void 0:i.includes(t.packageId))){if("percentage"===u.definition.type)m+=a*(u.definition.value/100),u.definition.maxDiscount&&(m=Math.min(m,u.definition.maxDiscount));else{const t=a/f.items.filter(t=>{var e;return null==(e=u.definition.packageIds)?void 0:e.includes(t.packageId)}).reduce((t,e)=>t+e.price*e.quantity,0);m+=u.definition.value*t}g=!0}else if("order"===u.definition.scope){const t=a/f.subtotal;"percentage"===u.definition.type?m+=a*(u.definition.value/100):m+=u.definition.value*t,g=!0}const v=a-m,y=s-m/t.quantity,b=Jl.calculatePackageMetrics({price:o,retailPrice:l,quantity:p,priceTotal:c,retailPriceTotal:d}),x=b.totalRetailPrice*t.quantity,w=b.totalSavings*t.quantity,_=parseFloat(e.price_recurring||"0"),k=parseFloat(e.price_recurring_total||"0"),S=e.is_recurring&&_>0,P=S?e.interval_count&&e.interval_count>1?`Every ${e.interval_count} ${e.interval}s`:`Per ${e.interval}`:"One time",C=(null==(n=window.nextConfig)?void 0:n.productTitleMap)||{},E=this.titleMap||C;let $=E[t.packageId]||E[String(t.packageId)];const T=null==(r=window.nextConfig)?void 0:r.productTitleTransform;if(!$&&"function"==typeof T)try{$=T(t.packageId,e.name)}catch(I){this.logger.warn("Error in productTitleTransform:",I)}return h(u({id:t.id,packageId:t.packageId,title:$||t.title||e.name,name:$||e.name,quantity:t.quantity,productId:t.productId||e.product_id,productName:t.productName||e.product_name||"",variantId:t.variantId||e.product_variant_id,variantName:t.variantName||e.product_variant_name||"",variantAttributes:t.variantAttributes||e.product_variant_attribute_values||[],variantSku:t.variantSku||e.product_sku||"",variantAttributesFormatted:this.formatVariantAttributes(t.variantAttributes||e.product_variant_attribute_values||[]),variantAttributesList:this.formatVariantAttributesList(t.variantAttributes||e.product_variant_attribute_values||[])},this.extractIndividualAttributes(t.variantAttributes||e.product_variant_attribute_values||[])),{price:s,unitPrice:b.unitPrice,lineTotal:a,lineCompare:b.hasSavings?x:0,comparePrice:b.hasSavings?b.totalRetailPrice:0,unitComparePrice:b.unitRetailPrice,recurringPrice:S?_:0,savingsAmount:w>0?w:0,unitSavings:b.unitSavings,discountAmount:m,discountedPrice:y,discountedLineTotal:v,hasDiscount:g,finalPrice:g?y:s,finalLineTotal:g?v:a,packagePrice:o,packagePriceTotal:b.totalPrice,packageRetailPrice:l,packageRetailTotal:b.totalRetailPrice,packageSavings:b.totalSavings>0?b.totalSavings:0,recurringTotal:S?k:0,savingsPct:b.totalSavingsPercentage>0?`${Math.round(b.totalSavingsPercentage)}%`:"",packageSavingsPct:b.totalSavingsPercentage>0?`${Math.round(b.totalSavingsPercentage)}%`:"",packageQty:p,frequency:P,isRecurring:S?"true":"false",hasSavings:w>0?"true":"false",hasPackageSavings:b.hasSavings?"true":"false",image:e.image||"",sku:e.external_id?String(e.external_id):"","price.raw":s,"unitPrice.raw":b.unitPrice,"lineTotal.raw":a,"lineCompare.raw":x,"comparePrice.raw":b.totalRetailPrice,"unitComparePrice.raw":b.unitRetailPrice,"recurringPrice.raw":_,"savingsAmount.raw":w,"unitSavings.raw":b.unitSavings,"packagePrice.raw":o,"packagePriceTotal.raw":b.totalPrice,"packageRetailPrice.raw":l,"packageRetailTotal.raw":b.totalRetailPrice,"packageSavings.raw":b.totalSavings,"recurringTotal.raw":k,"savingsPct.raw":Math.round(b.totalSavingsPercentage),"packageSavingsPct.raw":Math.round(b.totalSavingsPercentage),"discountAmount.raw":m,"discountedPrice.raw":y,"discountedLineTotal.raw":v,"finalPrice.raw":g?y:s,"finalLineTotal.raw":g?v:a,showCompare:b.hasSavings?"show":"hide",showSavings:w>0?"show":"hide",showUnitPrice:p>1?"show":"hide",showUnitCompare:p>1&&b.unitSavings>0?"show":"hide",showUnitSavings:p>1&&b.unitSavings>0?"show":"hide",showRecurring:S?"show":"hide",showPackageSavings:b.totalSavings>0?"show":"hide",showPackageTotal:b.totalPrice>0?"show":"hide",showRecurringTotal:S&&k>0?"show":"hide",showDiscount:g?"show":"hide",showOriginalPrice:g?"show":"hide"})}getItemCount(){return this.element.querySelectorAll("[data-cart-item-id]").length}getItemElements(){return this.element.querySelectorAll("[data-cart-item-id]")}refreshItem(t){const e=Tt.getState();this.handleCartUpdate(e)}groupIdenticalItems(t){const e=new Map;for(const i of t){const t=e.get(i.packageId);t?(t.quantity+=i.quantity,t.groupedItemIds||(t.groupedItemIds=[t.id]),t.groupedItemIds.push(i.id)):e.set(i.packageId,u({},i))}return Array.from(e.values())}formatVariantAttributes(t){return t&&0!==t.length?t.map(t=>`${t.name}: ${t.value}`).join(", "):""}formatVariantAttributesList(t){return t&&0!==t.length?t.map(t=>`<span class="variant-attr">${t.name}: ${t.value}</span>`).join(" "):""}extractIndividualAttributes(t){const e={};return t&&0!==t.length?(t.forEach(t=>{const i=t.code.charAt(0).toUpperCase()+t.code.slice(1).toLowerCase();e[`variant${i}`]=t.value,e[`variant.${t.code.toLowerCase()}`]=t.value,e[`variantAttr.${t.code.toLowerCase()}`]=t.value,e[`variant_${t.code}`]=t.value}),e):e}}},Symbol.toStringTag,{value:"Module"})),Rd=Object.freeze(Object.defineProperty({__proto__:null,OrderItemListEnhancer:class extends be{initialize(){return g(this,null,function*(){var t,e;this.validateElement();const i=this.getAttribute("data-item-template-id"),n=this.getAttribute("data-item-template-selector");if(i){const e=document.getElementById(i);this.template=null!=(t=null==e?void 0:e.innerHTML.trim())?t:""}else if(n){const t=document.querySelector(n);this.template=null!=(e=null==t?void 0:t.innerHTML.trim())?e:""}else this.template=this.getAttribute("data-item-template")||this.element.innerHTML.trim();this.template&&""!==this.template.replace(/<!--[\s\S]*?-->/g,"").trim()||(this.template=this.getDefaultItemTemplate()),this.emptyTemplate=this.getAttribute("data-empty-template")||'<div class="order-empty">No items found in order</div>',yield this.checkAndLoadOrderFromUrl(),this.subscribe(Ot,this.handleOrderUpdate.bind(this)),this.handleOrderUpdate(Ot.getState()),this.logger.debug("OrderItemListEnhancer initialized")})}update(t){t&&this.handleOrderUpdate(t)}checkAndLoadOrderFromUrl(){return g(this,null,function*(){const t=new URLSearchParams(window.location.search).get("ref_id");if(t){const i=Ot.getState();if(!i.order&&!i.isLoading&&i.refId!==t)try{const e=yt.getState();this.apiClient=new re(e.apiKey),yield i.loadOrder(t,this.apiClient)}catch(e){this.logger.error("Failed to auto-load order:",e)}}})}handleOrderUpdate(t){return g(this,null,function*(){try{const e=t.order;if(t.isLoading)return this.element.innerHTML='<div class="status-message">Loading order items...</div>',this.addClass("order-loading"),this.removeClass("order-has-items"),void this.removeClass("order-empty");if(t.error)return this.element.innerHTML='<div class="status-message">Error loading order items</div>',this.addClass("order-error"),this.removeClass("order-has-items"),this.removeClass("order-empty"),void this.removeClass("order-loading");e&&e.lines&&0!==e.lines.length?yield this.renderOrderItems(e.lines):this.renderEmptyOrder()}catch(e){this.handleError(e,"handleOrderUpdate")}})}renderEmptyOrder(){this.element.innerHTML=this.emptyTemplate||"",this.addClass("order-empty"),this.removeClass("order-has-items"),this.removeClass("order-loading"),this.removeClass("order-error")}renderOrderItems(t){return g(this,null,function*(){this.removeClass("order-empty"),this.removeClass("order-loading"),this.removeClass("order-error"),this.addClass("order-has-items");const e=[];for(const i of t){const t=this.renderOrderItem(i);t&&e.push(t)}this.element.innerHTML=e.join("")})}renderOrderItem(t){try{const e=this.prepareOrderLineData(t),i=this.template||this.getDefaultItemTemplate(),n=h(u({},qd.createDefaultFormatters()),{currency:t=>zl.formatCurrency(t)});return qd.render(i,{data:{item:e},formatters:n})}catch(e){return this.logger.error("Error rendering order item:",e),""}}getDefaultItemTemplate(){return'\n      <div class="order-item" data-order-line-id="{item.id}">\n        <div class="order-item-image {item.showImage}">\n          <img src="{item.image}" alt="{item.name}" onerror="this.style.display=\'none\';">\n          <span class="item-fallback-icon" style="font-size: 1.5em;">ðŸ“¦</span>\n        </div>\n        <div class="order-item-details">\n          <h4 class="order-item-name">\n            {item.name}\n            <span class="upsell-badge {item.showUpsell}" style="background: #e7f3ff; color: #0056b3; padding: 2px 6px; border-radius: 10px; font-size: 0.8em; margin-left: 8px;">{item.upsellBadge}</span>\n          </h4>\n          <div class="order-item-meta">\n            <div class="item-sku">SKU: {item.sku}</div>\n            <div class="item-variant {item.showVariant}">Variant: {item.variant}</div>\n            <div class="item-description {item.showDescription}" style="color: #6c757d; font-size: 0.9em;">{item.description}</div>\n          </div>\n          <div class="order-item-pricing">\n            <div class="unit-price">{item.price} each</div>\n            <div class="tax-info {item.showTax}" style="color: #666; font-size: 0.9em;">Tax: {item.unitTax}</div>\n          </div>\n        </div>\n        <div class="quantity-info">\n          <span class="quantity-label">Qty:</span>\n          <span class="quantity-value">{item.quantity}</span>\n        </div>\n        <div class="order-item-total">\n          <div class="line-total">{item.lineTotal}</div>\n          <div class="line-tax {item.showTax}" style="color: #666; font-size: 0.9em;">Tax: {item.lineTax}</div>\n        </div>\n      </div>\n    '.trim()}prepareOrderLineData(t){const e=parseFloat(t.price_incl_tax||"0"),i=parseFloat(t.price_excl_tax||"0"),n=t.quantity||1,r=parseFloat(t.price_incl_tax_excl_discounts||t.price_incl_tax||"0"),s=parseFloat(t.price_excl_tax_excl_discounts||t.price_excl_tax||"0"),a=n>0?e/n:e,o=n>0?i/n:i,c=n>0?r/n:r,l=n>0?s/n:s,d=a-o,u=e-i,h=c-a,p=r-e,f=h>.01,m=t.is_upsell?"UPSELL":"";return{id:String(t.id||""),title:t.product_title||"Unknown Product",name:t.product_title||"Unknown Product",sku:t.product_sku||"",quantity:String(n),price:a,priceExclTax:o,unitTax:d,lineTotal:e,lineTotalExclTax:i,lineTax:u,priceExclDiscounts:c,priceExclTaxExclDiscounts:l,lineTotalExclDiscounts:r,lineTotalExclTaxExclDiscounts:s,unitDiscount:h,lineDiscount:p,image:t.image||"",description:t.product_description||"",variant:t.variant_title||"",isUpsell:t.is_upsell?"true":"false",upsellBadge:m,hasImage:t.image?"true":"false",hasDescription:t.product_description?"true":"false",hasVariant:t.variant_title?"true":"false",hasTax:d>0?"true":"false",hasDiscount:f?"true":"false",showUpsell:t.is_upsell?"show":"hide",showImage:t.image?"show":"hide",showDescription:t.product_description?"show":"hide",showVariant:t.variant_title?"show":"hide",showTax:d>0?"show":"hide",showDiscount:f?"show":"hide"}}getItemCount(){return this.element.querySelectorAll("[data-order-line-id]").length}getItemElements(){return this.element.querySelectorAll("[data-order-line-id]")}}},Symbol.toStringTag,{value:"Module"}));class Hd extends be{setupCartSubscription(){this.subscribe(Tt,this.handleCartUpdate.bind(this)),this.cartState=Tt.getState()}isCartEmpty(){var t,e;return null==(e=null==(t=this.cartState)?void 0:t.isEmpty)||e}getCartItem(t){var e;return null==(e=this.cartState)?void 0:e.items.find(e=>e.packageId===t)}getTotalQuantity(){var t,e;return null!=(e=null==(t=this.cartState)?void 0:t.totalQuantity)?e:0}getCartTotals(){var t,e;return null!=(e=null==(t=this.cartState)?void 0:t.totals)?e:{subtotal:{value:0,formatted:"$0.00"},shipping:{value:0,formatted:"$0.00"},tax:{value:0,formatted:"$0.00"},discounts:{value:0,formatted:"$0.00"},total:{value:0,formatted:"$0.00"},count:0,isEmpty:!0,savings:{value:0,formatted:"$0.00"},savingsPercentage:{value:0,formatted:"0%"},compareTotal:{value:0,formatted:"$0.00"},hasSavings:!1}}getCartItems(){var t,e;return null!=(e=null==(t=this.cartState)?void 0:t.items)?e:[]}hasPackageInCart(t){return void 0!==this.getCartItem(t)}}const Vd=Object.freeze(Object.defineProperty({__proto__:null,QuantityControlEnhancer:class extends Hd{constructor(){super(...arguments),this.step=1,this.min=0,this.max=99}initialize(){return g(this,null,function*(){this.validateElement();const t=this.getRequiredAttribute("data-next-quantity");if(!["increase","decrease","set"].includes(t))throw new Error(`Invalid quantity action: ${t}. Must be 'increase', 'decrease', or 'set'`);this.action=t;const e=this.getRequiredAttribute("data-package-id");if(this.packageId=parseInt(e,10),isNaN(this.packageId))throw new Error(`Invalid package ID: ${e}`);this.step=parseInt(this.getAttribute("data-step")||"1",10)||1,this.min=parseInt(this.getAttribute("data-min")||"0",10)||0,this.max=parseInt(this.getAttribute("data-max")||"99",10)||99,this.setupEventListeners(),this.setupCartSubscription(),this.logger.debug(`QuantityControlEnhancer initialized for package ${this.packageId} with action ${this.action}`)})}update(t){t&&this.handleCartUpdate(t)}setupEventListeners(){"set"!==this.action||"INPUT"!==this.element.tagName&&"SELECT"!==this.element.tagName?this.element.addEventListener("click",this.handleClick.bind(this)):(this.element.addEventListener("change",this.handleQuantityChange.bind(this)),this.element.addEventListener("blur",this.handleQuantityChange.bind(this)),this.element instanceof HTMLInputElement&&"number"===this.element.type&&this.element.addEventListener("input",this.handleNumberInput.bind(this)))}handleClick(t){return g(this,null,function*(){if(t.preventDefault(),t.stopPropagation(),!this.hasClass("disabled")&&!this.element.hasAttribute("disabled"))try{this.addClass("processing"),yield this.updateQuantity()}catch(e){this.handleError(e,"handleClick")}finally{this.removeClass("processing")}})}handleQuantityChange(t){return g(this,null,function*(){if("set"!==this.action)return;const e=t.target,i=parseInt(e.value,10);if(isNaN(i)||i<this.min)e.value=String(this.min);else if(i>this.max)e.value=String(this.max);else try{this.addClass("processing");const t=Tt.getState();0===i?yield t.removeItem(this.packageId):yield t.updateQuantity(this.packageId,i)}catch(n){this.handleError(n,"handleQuantityChange");const t=Tt.getState().getItemQuantity(this.packageId);e.value=String(t)}finally{this.removeClass("processing")}})}handleNumberInput(t){const e=t.target,i=parseInt(e.value,10);i<this.min&&(e.value=String(this.min)),i>this.max&&(e.value=String(this.max))}updateQuantity(){return g(this,null,function*(){const t=Tt.getState(),e=t.getItemQuantity(this.packageId);let i;switch(this.action){case"increase":i=Math.min(e+this.step,this.max);break;case"decrease":i=Math.max(e-this.step,this.min);break;default:return}i!==e?(i<=0?(yield t.removeItem(this.packageId),this.logger.debug(`Removed item ${this.packageId} from cart`)):(yield t.updateQuantity(this.packageId,i),this.logger.debug(`Updated quantity for item ${this.packageId} to ${i}`)),this.emitQuantityChangeEvent(e,i)):this.logger.debug("Quantity unchanged, no action needed")})}handleCartUpdate(t){const e=this.getCartItem(this.packageId),i=(null==e?void 0:e.quantity)||0,n=i>0;this.updateButtonState(i),"set"===this.action&&(this.element instanceof HTMLInputElement||this.element instanceof HTMLSelectElement)&&this.element.value!==String(i)&&(this.element.value=String(i)),this.toggleClass("has-item",n),this.toggleClass("empty",!n),this.element.setAttribute("data-quantity",String(i)),this.element.setAttribute("data-in-cart",String(n))}updateButtonState(t){const e=t<this.max,i=t>this.min;switch(this.action){case"increase":this.toggleClass("disabled",!e),this.element.toggleAttribute("disabled",!e),this.setAttribute("aria-disabled",String(!e));break;case"decrease":this.toggleClass("disabled",!i),this.element.toggleAttribute("disabled",!i),this.setAttribute("aria-disabled",String(!i));break;case"set":this.element instanceof HTMLInputElement&&(this.element.min=String(this.min),this.element.max=String(this.max),this.element.step=String(this.step))}this.updateButtonContent(t)}updateButtonContent(t){const e=this.getAttribute("data-original-content")||this.element.innerHTML;this.hasAttribute("data-original-content")||this.setAttribute("data-original-content",this.element.innerHTML);const i=e.replace(/\{quantity\}/g,String(t)).replace(/\{step\}/g,String(this.step));this.element.innerHTML!==i&&(this.element.innerHTML=i)}emitQuantityChangeEvent(t,e){this.emit("cart:quantity-changed",{packageId:this.packageId,quantity:e,oldQuantity:t})}getCurrentQuantity(){return Tt.getState().getItemQuantity(this.packageId)}setQuantity(t){const e=Math.max(this.min,Math.min(this.max,t)),i=Tt.getState();return e<=0?i.removeItem(this.packageId):i.updateQuantity(this.packageId,e)}getConstraints(){return{min:this.min,max:this.max,step:this.step}}}},Symbol.toStringTag,{value:"Module"})),Bd=Object.freeze(Object.defineProperty({__proto__:null,RemoveItemEnhancer:class extends be{constructor(){super(...arguments),this.confirmRemoval=!1,this.confirmMessage="Are you sure you want to remove this item?"}initialize(){return g(this,null,function*(){this.validateElement();const t=this.getRequiredAttribute("data-package-id");if(this.packageId=parseInt(t,10),isNaN(this.packageId))throw new Error(`Invalid package ID: ${t}`);this.confirmRemoval="true"===this.getAttribute("data-confirm"),this.confirmMessage=this.getAttribute("data-confirm-message")||this.confirmMessage,this.element.addEventListener("click",this.handleClick.bind(this)),this.subscribe(Tt,this.handleCartUpdate.bind(this)),this.handleCartUpdate(Tt.getState()),this.logger.debug(`RemoveItemEnhancer initialized for package ${this.packageId}`)})}update(t){t&&this.handleCartUpdate(t)}handleClick(t){return g(this,null,function*(){if(t.preventDefault(),t.stopPropagation(),!this.hasClass("disabled")&&!this.element.hasAttribute("disabled")&&(!this.confirmRemoval||confirm(this.confirmMessage)))try{this.addClass("processing"),yield this.removeItem()}catch(e){this.handleError(e,"handleClick")}finally{this.removeClass("processing")}})}removeItem(){return g(this,null,function*(){const t=Tt.getState();0!==t.getItemQuantity(this.packageId)?(yield t.removeItem(this.packageId),this.logger.debug(`Removed item ${this.packageId} from cart`),this.emitRemoveEvent(),this.addRemovalFeedback()):this.logger.debug(`Item ${this.packageId} not in cart, nothing to remove`)})}emitRemoveEvent(){this.emit("cart:item-removed",{packageId:this.packageId})}handleCartUpdate(t){var e;const i=(null==(e=t.items.find(t=>t.packageId===this.packageId))?void 0:e.quantity)||0,n=i>0;this.toggleClass("disabled",!n),this.element.toggleAttribute("disabled",!n),this.setAttribute("aria-disabled",String(!n)),this.toggleClass("has-item",n),this.toggleClass("empty",!n),this.element.setAttribute("data-quantity",String(i)),this.element.setAttribute("data-in-cart",String(n)),this.updateButtonContent(i)}updateButtonContent(t){const e=this.getAttribute("data-original-content")||this.element.innerHTML;this.hasAttribute("data-original-content")||this.setAttribute("data-original-content",this.element.innerHTML);const i=e.replace(/\{quantity\}/g,String(t));this.element.innerHTML!==i&&(this.element.innerHTML=i)}addRemovalFeedback(){this.addClass("item-removed");const t=this.element.closest("[data-cart-item-id], .cart-item");t instanceof HTMLElement&&(t.classList.add("removing"),setTimeout(()=>{t.classList.remove("removing")},300)),setTimeout(()=>{this.removeClass("item-removed")},300)}getCurrentQuantity(){return Tt.getState().getItemQuantity(this.packageId)}isInCart(){return this.getCurrentQuantity()>0}setConfirmation(t,e){this.confirmRemoval=t,e&&(this.confirmMessage=e)}}},Symbol.toStringTag,{value:"Module"})),Jd=class t extends be{constructor(t){super(t),this.quantity=1,this.actionButtons=[],this.isProcessing=!1,this.isSelector=!1,this.options=new Map,this.quantityBySelectorId=new Map,this.loadingOverlay=new od}initialize(){return g(this,null,function*(){if(this.validateElement(),this.pageShowHandler=t=>{t.persisted&&(this.loadingOverlay.hide(!0),this.isProcessing=!1,this.setProcessingState(!1))},window.addEventListener("pageshow",this.pageShowHandler),setTimeout(()=>{this.trackUpsellPageView()},100),this.selectorId=this.getAttribute("data-next-selector-id")||"",this.isSelector=!!this.selectorId,this.isSelector)this.initializeSelectorMode();else{const t=this.getAttribute("data-next-package-id");if(!t)throw new Error("UpsellEnhancer requires data-next-package-id attribute (or use selector mode with data-next-selector-id)");if(this.packageId=parseInt(t,10),isNaN(this.packageId))throw new Error("Invalid package ID provided");const e=Ot.getState();e.order&&e.markUpsellViewed(this.packageId.toString())}const t=this.getAttribute("data-next-quantity");t&&(this.quantity=parseInt(t,10)||1);const e=yt.getState();this.apiClient=new re(e.apiKey),this.scanUpsellElements(),this.setupEventHandlers(),this.subscribe(Ot,this.handleOrderUpdate.bind(this)),this.eventBus.on("upsell:quantity-changed",t=>{(this.selectorId&&t.selectorId===this.selectorId||!this.selectorId&&!t.selectorId&&this.packageId&&t.packageId===this.packageId)&&(this.selectorId?(this.quantityBySelectorId.set(this.selectorId,t.quantity),this.currentQuantitySelectorId=this.selectorId):this.quantity=t.quantity,this.updateQuantityDisplay())}),this.eventBus.on("upsell:option-selected",t=>{const e=this.element.querySelectorAll("[data-next-selector-id]");let i=!1;e.forEach(e=>{e.getAttribute("data-next-selector-id")===t.selectorId&&(i=!0)}),this.selectorId===t.selectorId&&(i=!0),i&&(this.selectedPackageId=t.packageId,this.packageId=t.packageId,this.options.forEach((e,i)=>{i===t.packageId?(e.classList.add("next-selected"),e.setAttribute("data-next-selected","true")):(e.classList.remove("next-selected"),e.setAttribute("data-next-selected","false"))}))}),this.updateUpsellDisplay(),this.logger.debug("UpsellEnhancer initialized",{mode:this.isSelector?"selector":"direct",packageId:this.packageId,selectorId:this.selectorId,quantity:this.quantity,actionButtons:this.actionButtons.length,options:this.options.size,currentPagePath:this.currentPagePath}),this.emit("upsell:initialized",{packageId:this.packageId||0,element:this.element})})}trackUpsellPageView(){const e=document.querySelector('meta[name="next-page-type"]');if(e&&"upsell"===e.getAttribute("content")&&(this.currentPagePath=window.location.pathname,!t.pageViewTracked||t.currentPagePath!==this.currentPagePath)){t.pageViewTracked=!0,t.currentPagePath=this.currentPagePath;const e=Ot.getState();e.order&&(e.markUpsellPageViewed(this.currentPagePath),this.logger.debug("Tracked upsell page view:",this.currentPagePath),this.eventBus.emit("upsell:viewed",{pagePath:this.currentPagePath,orderId:e.order.ref_id}))}}initializeSelectorMode(){this.selectorId&&!this.quantityBySelectorId.has(this.selectorId)&&this.quantityBySelectorId.set(this.selectorId,this.quantity),this.element.querySelectorAll("[data-next-upsell-option]").forEach(t=>{if(t instanceof HTMLElement){const e=t.getAttribute("data-next-package-id");if(e){const i=parseInt(e,10);isNaN(i)||(this.options.set(i,t),t.addEventListener("click",()=>this.selectOption(i)),"true"===t.getAttribute("data-next-selected")&&this.selectOption(i))}}});let t=null;if(t="SELECT"===this.element.tagName?this.element:this.element.querySelector(`[data-next-upsell-select="${this.selectorId}"]`),t&&(t.addEventListener("change",()=>{const e=t.value;if(e){const t=parseInt(e,10);isNaN(t)||this.selectOption(t)}else delete this.selectedPackageId,delete this.packageId}),t.value)){const e=parseInt(t.value,10);isNaN(e)||this.selectOption(e)}}selectOption(t){this.options.forEach((e,i)=>{i===t?(e.classList.add("next-selected"),e.setAttribute("data-next-selected","true")):(e.classList.remove("next-selected"),e.setAttribute("data-next-selected","false"))}),this.selectedPackageId=t,this.packageId=t;let e=this.selectorId;const i=this.options.get(t);if(i){const t=i.closest("[data-next-selector-id]");t&&(e=t.getAttribute("data-next-selector-id")||this.selectorId)}this.eventBus.emit("upsell-selector:item-selected",{selectorId:e||"",packageId:t}),this.eventBus.emit("upsell:option-selected",{selectorId:e||"",packageId:t}),e&&this.syncOptionSelectionAcrossContainers(e,t),this.element.Ot=t,this.logger.debug("Upsell option selected:",{packageId:t,selectorId:e})}scanUpsellElements(){["[data-next-upsell-action]"].forEach(t=>{this.element.querySelectorAll(t).forEach(t=>{t instanceof HTMLElement&&(this.actionButtons.push(t),this.logger.debug("Found upsell action button:",t))})});const t=this.element.querySelector('[data-next-upsell-quantity="increase"]'),e=this.element.querySelector('[data-next-upsell-quantity="decrease"]'),i=(null==t?void 0:t.getAttribute("data-next-quantity-selector-id"))||(null==e?void 0:e.getAttribute("data-next-quantity-selector-id"))||this.selectorId;t&&t.addEventListener("click",()=>{if(i){const t=this.quantityBySelectorId.get(i)||1,e=Math.min(10,t+1);this.quantityBySelectorId.set(i,e),this.currentQuantitySelectorId=i,this.eventBus.emit("upsell:quantity-changed",{selectorId:i,quantity:e,packageId:this.packageId})}else this.quantity=Math.min(10,this.quantity+1),this.eventBus.emit("upsell:quantity-changed",{quantity:this.quantity,packageId:this.packageId});this.updateQuantityDisplay(),this.syncQuantityAcrossContainers(i,this.packageId)}),e&&e.addEventListener("click",()=>{if(i){const t=this.quantityBySelectorId.get(i)||1,e=Math.max(1,t-1);this.quantityBySelectorId.set(i,e),this.currentQuantitySelectorId=i,this.eventBus.emit("upsell:quantity-changed",{selectorId:i,quantity:e,packageId:this.packageId})}else this.quantity=Math.max(1,this.quantity-1),this.eventBus.emit("upsell:quantity-changed",{quantity:this.quantity,packageId:this.packageId});this.updateQuantityDisplay(),this.syncQuantityAcrossContainers(i,this.packageId)}),this.element.querySelectorAll("[data-next-upsell-quantity-toggle]").forEach(t=>{if(t instanceof HTMLElement){const e=parseInt(t.getAttribute("data-next-upsell-quantity-toggle")||"1",10);t.addEventListener("click",()=>{this.quantity=e,this.updateQuantityDisplay(),this.updateQuantityToggles(),this.eventBus.emit("upsell:quantity-changed",{selectorId:this.selectorId,quantity:this.quantity,packageId:this.packageId})}),e===this.quantity&&t.classList.add("next-selected")}})}updateQuantityDisplay(){const t=this.currentQuantitySelectorId||this.selectorId;if(t&&this.quantityBySelectorId.has(t)){const e=document.querySelectorAll(`[data-next-upsell-quantity="display"][data-next-quantity-selector-id="${t}"]`),i=this.quantityBySelectorId.get(t);e.forEach(t=>{t instanceof HTMLElement&&(t.textContent=i.toString())});const n=this.element.querySelector('[data-next-upsell-quantity="display"]:not([data-next-quantity-selector-id])');n&&n instanceof HTMLElement&&(n.textContent=i.toString())}else{const t=this.element.querySelector('[data-next-upsell-quantity="display"]');t&&(t.textContent=this.quantity.toString())}}updateQuantityToggles(){this.element.querySelectorAll("[data-next-upsell-quantity-toggle]").forEach(t=>{t instanceof HTMLElement&&(parseInt(t.getAttribute("data-next-upsell-quantity-toggle")||"1",10)===this.quantity?t.classList.add("next-selected"):t.classList.remove("next-selected"))})}syncQuantityAcrossContainers(t,e){if(t){const e=this.quantityBySelectorId.get(t);if(!e)return;document.querySelectorAll(`[data-next-selector-id="${t}"] [data-next-upsell-option]`).forEach(t=>{t instanceof HTMLElement&&t.setAttribute("data-next-quantity",e.toString())}),document.querySelectorAll(`[data-next-upsell-select="${t}"]`).forEach(t=>{t instanceof HTMLSelectElement&&t.querySelectorAll("option[data-next-package-id]").forEach(t=>{t instanceof HTMLOptionElement&&t.setAttribute("data-next-quantity",e.toString())})})}else e&&document.querySelectorAll(`[data-next-upsell="offer"][data-next-package-id="${e}"]:not([data-next-selector-id])`).forEach(t=>{if(t instanceof HTMLElement){const e=t.querySelector('[data-next-upsell-quantity="display"]');e&&e instanceof HTMLElement&&(e.textContent=this.quantity.toString())}})}syncOptionSelectionAcrossContainers(t,e){document.querySelectorAll(`[data-next-selector-id="${t}"]`).forEach(t=>{if(t instanceof HTMLElement){t.querySelectorAll("[data-next-upsell-option]").forEach(t=>{t instanceof HTMLElement&&(parseInt(t.getAttribute("data-next-package-id")||"0",10)===e?(t.classList.add("next-selected"),t.setAttribute("data-next-selected","true")):(t.classList.remove("next-selected"),t.setAttribute("data-next-selected","false")))});const i=t.querySelector("select");i&&(i.value=e.toString())}})}setupEventHandlers(){this.clickHandler=this.handleActionClick.bind(this),this.actionButtons.forEach(t=>{t.addEventListener("click",this.clickHandler)}),this.keydownHandler=t=>{"Enter"===t.key&&this.isProcessing&&(t.preventDefault(),t.stopPropagation(),this.logger.debug("Enter key blocked - upsell is processing"))},this.element.addEventListener("keydown",this.keydownHandler,!0)}handleActionClick(t){return g(this,null,function*(){if(t.preventDefault(),this.isProcessing)return void this.logger.debug("Upsell action blocked - already processing");const e=t.currentTarget,i=e.getAttribute("data-next-upsell-action")||"";let n=e.getAttribute("data-next-url")||e.getAttribute("data-next-next-url")||e.getAttribute("data-os-next-url")||void 0;if(!n){if("add"===i||"accept"===i){const t=document.querySelector('meta[name="next-upsell-accept-url"]');n=(null==t?void 0:t.getAttribute("content"))||void 0}else if("skip"===i||"decline"===i){const t=document.querySelector('meta[name="next-upsell-decline-url"]');n=(null==t?void 0:t.getAttribute("content"))||void 0}n&&this.logger.debug("Using fallback URL from meta tag:",n)}switch(this.logger.debug("Upsell action clicked:",{action:i,nextUrl:n}),i){case"add":case"accept":yield this.addUpsellToOrder(n);break;case"skip":case"decline":this.skipUpsell(n);break;default:this.logger.warn(`Unknown upsell action: ${i}`)}})}getCurrency(){var t;const e=dt.getState();if(null==(t=null==e?void 0:e.data)?void 0:t.currency)return e.data.currency;const i=yt.getState();return(null==i?void 0:i.selectedCurrency)||(null==i?void 0:i.detectedCurrency)||"USD"}addUpsellToOrder(t){return g(this,null,function*(){var e,i,n,r,s;const a=Ot.getState();if(this.logger.debug("Order state check:",{hasOrder:!!a.order,supportsUpsells:null==(e=a.order)?void 0:e.supports_post_purchase_upsells,isProcessingUpsell:a.isProcessingUpsell,canAddUpsells:a.canAddUpsells()}),!a.canAddUpsells()){if(this.logger.warn("Order does not support upsells or is currently processing"),!a.isProcessingUpsell||!(null==(i=a.order)?void 0:i.supports_post_purchase_upsells))return this.showError("Unable to add upsell at this time"),void(t&&(this.logger.info("Navigating to next page despite error"),setTimeout(()=>this.navigateToUrl(t),1e3)));if(this.logger.warn("Processing flag stuck, resetting..."),a.setProcessingUpsell(!1),!a.canAddUpsells())return this.showError("Unable to add upsell at this time"),void(t&&(this.logger.info("Navigating to next page despite error"),setTimeout(()=>this.navigateToUrl(t),1e3)));this.logger.info("Reset successful, continuing with upsell...")}const o=this.isSelector&&this.selectedPackageId||this.packageId;if(o&&this.checkIfUpsellAlreadyAccepted(o)&&!(yield this.showDuplicateUpsellDialog()))t&&this.navigateToUrl(t);else{if(this.logger.debug("Package selection:",{isSelector:this.isSelector,packageId:this.packageId,selectedPackageId:this.selectedPackageId,packageToAdd:o}),!o)return this.logger.warn("No package selected for upsell"),void this.showError("Please select an option first");try{this.isProcessing=!0,this.setProcessingState(!0),this.loadingOverlay.show(),this.emit("upsell:adding",{packageId:o});let e=this.quantity;this.selectorId&&this.quantityBySelectorId.has(this.selectorId)?e=this.quantityBySelectorId.get(this.selectorId):this.currentQuantitySelectorId&&this.quantityBySelectorId.has(this.currentQuantitySelectorId)&&(e=this.quantityBySelectorId.get(this.currentQuantitySelectorId));const i={lines:[{package_id:o,quantity:e}],currency:this.getCurrency()};this.logger.info("Adding upsell to order:",i);const c=yield a.addUpsell(i,this.apiClient);if(!c)throw new Error("Failed to add upsell - no updated order returned");{this.logger.info("Upsell added successfully"),this.showSuccess();let i=0;const l=(null==(r=null==(n=a.order)?void 0:n.lines)?void 0:r.map(t=>t.id))||[],d=null==(s=c.lines)?void 0:s.find(t=>t.is_upsell&&!l.includes(t.id));(null==d?void 0:d.price_incl_tax)&&(i=parseFloat(d.price_incl_tax));const u=dt.getState().getPackage(o);u&&!i&&u.price&&(i=parseFloat(u.price)*this.quantity),this.emit("upsell:added",{packageId:o,quantity:e,order:c,value:i,willRedirect:!!t}),t?setTimeout(()=>{this.navigateToUrl(t,c.ref_id)},100):this.loadingOverlay.hide()}}catch(c){this.logger.error("Failed to add upsell:",c),this.showError(c instanceof Error?c.message:"Failed to add upsell"),this.emit("upsell:error",{packageId:this.packageId||0,error:c instanceof Error?c.message:"Unknown error"}),this.loadingOverlay.hide(!0),t&&(this.logger.info("Navigating to next page despite API error"),setTimeout(()=>this.navigateToUrl(t),1e3))}finally{this.isProcessing=!1,this.setProcessingState(!1)}}})}skipUpsell(t){var e;this.logger.info("Upsell skipped by user"),this.addClass("next-skipped"),this.disableActions(),this.packageId&&Ot.getState().markUpsellSkipped(this.packageId.toString(),this.currentPagePath);const i=Ot.getState(),n={};void 0!==this.packageId&&(n.packageId=this.packageId),void 0!==(null==(e=i.order)?void 0:e.ref_id)&&(n.orderId=i.order.ref_id),this.emit("upsell:skipped",n),t&&this.navigateToUrl(t)}navigateToUrl(t,e){var i;if(t)try{const n=new URL(t,window.location.origin),r=Ot.getState(),s=e||(null==(i=r.order)?void 0:i.ref_id);s&&!n.searchParams.has("ref_id")&&n.searchParams.append("ref_id",s);const a=rd(n.href,["debug","debugger","test"]);this.logger.info(`Navigating to ${a}`),window.location.href=a}catch(n){this.logger.error("Invalid URL for navigation:",t,n);const e=rd(t);window.location.href=e}else this.logger.warn("No URL provided for navigation")}handleOrderUpdate(t){this.updateUpsellDisplay(),t.isProcessingUpsell?this.setProcessingState(!0):this.setProcessingState(!1),t.upsellError&&this.showError(t.upsellError)}updateUpsellDisplay(){Ot.getState().canAddUpsells()?this.showUpsellOffer():this.hideUpsellOffer()}setProcessingState(t){t?(this.addClass("next-processing"),this.disableActions()):(this.removeClass("next-processing"),this.enableActions())}disableActions(){this.actionButtons.forEach(t=>{t instanceof HTMLButtonElement&&(t.disabled=!0),t.classList.add("next-disabled")})}enableActions(){this.actionButtons.forEach(t=>{t instanceof HTMLButtonElement&&(t.disabled=!1),t.classList.remove("next-disabled")})}showUpsellOffer(){this.removeClass("next-hidden"),this.removeClass("next-error"),this.addClass("next-available")}hideUpsellOffer(){this.addClass("next-hidden"),this.removeClass("next-available")}showSuccess(){this.addClass("next-success"),setTimeout(()=>{this.removeClass("next-success")},3e3)}showError(t){this.addClass("next-error"),this.removeClass("next-processing"),this.logger.error("Upsell error:",t),setTimeout(()=>{this.removeClass("next-error")},5e3)}checkIfUpsellAlreadyAccepted(t){const e=Ot.getState();return!!e.completedUpsells.includes(t.toString())||e.upsellJourney.some(e=>e.packageId===t.toString()&&"accepted"===e.action)}showDuplicateUpsellDialog(){return g(this,null,function*(){const t=yield ad.showDuplicateUpsell();return this.logger.info(t?"User confirmed to add duplicate upsell":"User declined to add duplicate upsell"),t})}update(){this.scanUpsellElements(),this.updateUpsellDisplay()}cleanupEventListeners(){this.clickHandler&&this.actionButtons.forEach(t=>{t.removeEventListener("click",this.clickHandler)}),this.keydownHandler&&this.element.removeEventListener("keydown",this.keydownHandler,!0)}destroy(){this.pageShowHandler&&window.removeEventListener("pageshow",this.pageShowHandler),this.actionButtons=[],super.destroy()}};Jd.pageViewTracked=!1,Jd.currentPagePath=null;let Gd=Jd;const Kd=Object.freeze(Object.defineProperty({__proto__:null,UpsellEnhancer:Gd},Symbol.toStringTag,{value:"Module"})),Qd=Object.freeze(Object.defineProperty({__proto__:null,CouponEnhancer:class extends nd{constructor(){super(...arguments),this.input=null,this.button=null,this.display=null,this.template=null,this.unsubscribe=null}initialize(){return g(this,null,function*(){var t,e;this.logger.debug("Enhancing coupon element:",this.element),this.input=this.element.querySelector('input[os-checkout-field="coupon"]')||this.element.querySelector('input[data-next-coupon="input"]')||this.element.querySelector('input[type="text"]')||this.element.querySelector("input"),this.button=this.element.querySelector("button")||this.element.querySelector('[data-next-coupon="apply"]'),this.display=this.element.querySelector('[data-next-coupon="display"]')||this.element.querySelector('[pb-checkout="coupon-display"]')||(null==(t=this.element.parentElement)?void 0:t.querySelector('[data-next-coupon="display"]'))||document.querySelector('[data-next-coupon="display"]'),this.template=(null==(e=this.display)?void 0:e.querySelector('[pb-checkout="coupon-card"]'))||null,this.input&&this.button?(this.setupInputListener(),this.setupButtonListener(),this.updateButtonState(),this.renderAppliedCoupons(),this.unsubscribe=Tt.subscribe(t=>t.appliedCoupons,()=>this.renderAppliedCoupons()),this.logger.info("Coupon enhancer initialized successfully")):this.logger.warn("Required coupon elements not found",{input:!!this.input,button:!!this.button})})}setupInputListener(){this.input&&(this.input.addEventListener("input",()=>{this.updateButtonState()}),this.input.addEventListener("keypress",t=>{"Enter"===t.key&&(t.preventDefault(),this.applyCoupon())}))}setupButtonListener(){this.button&&this.button.addEventListener("click",t=>{t.preventDefault(),this.applyCoupon()})}updateButtonState(){this.input&&this.button&&(this.input.value.trim().length>0?(this.button.classList.remove("next-disabled"),this.button.disabled=!1):(this.button.classList.add("next-disabled"),this.button.disabled=!0))}applyCoupon(){return g(this,null,function*(){if(!this.input||!this.button)return;const t=this.input.value.trim();t&&(yield this.executeAction(()=>g(this,null,function*(){this.logger.debug("Applying coupon:",t);const e=yield Tt.getState().applyCoupon(t);e.success?(this.input&&(this.input.value=""),this.updateButtonState(),this.showMessage(e.message,"success"),this.logger.info("Coupon applied successfully:",t),this.eventBus.emit("coupon:applied",{code:t})):(this.showMessage(e.message,"error"),this.logger.warn("Coupon application failed:",e.message),this.eventBus.emit("coupon:validation-failed",{code:t,message:e.message}))}),{showLoading:!0,disableOnProcess:!0}))})}renderAppliedCoupons(){if(!this.display||!this.template)return void this.logger.debug("No display area or template found for coupons");const t=Tt.getState().getCoupons();this.display.querySelectorAll('[pb-checkout="coupon-card"]:not([data-template])').forEach(t=>t.remove()),this.template.style.display="none",this.template.setAttribute("data-template","true"),t.forEach(t=>{const e=this.template.cloneNode(!0);e.removeAttribute("data-template"),e.style.display="";const i=e.querySelector('[pb-checkout="coupon-title"]');i&&(i.textContent=t.code);const n=e.querySelector('[pb-checkout="coupon-description"]');n&&t.definition.description&&(n.textContent=t.definition.description);const r=e.querySelector('[pb-checkout="coupon-discount"]');if(r){const{formatCurrency:e}=require("@/utils/currencyFormatter"),i=e(t.discount);r.textContent=`-${i}`}const s=e.querySelector('[pb-checkout="coupon-remove"]');s&&s.addEventListener("click",()=>{this.removeCoupon(t.code)}),this.display.appendChild(e)}),this.logger.debug("Rendered applied coupons:",t.length)}removeCoupon(t){this.logger.debug("Removing coupon:",t),Tt.getState().removeCoupon(t),this.eventBus.emit("coupon:removed",{code:t}),this.showMessage(`Coupon ${t} removed`,"info")}showMessage(t,e){var i;this.logger.debug(`Showing message [${e}]:`,t);const n=document.querySelector('[data-next-coupon="messages"]')||document.querySelector(".coupon-messages")||(null==(i=this.element)?void 0:i.querySelector(".messages"));if(n){n.innerHTML="";const i=document.createElement("div");i.className=`coupon-message coupon-message--${e}`,i.textContent=t,n.appendChild(i),setTimeout(()=>{i.remove()},5e3)}}update(){return g(this,null,function*(){this.renderAppliedCoupons()})}destroy(){this.logger.debug("Destroying coupon enhancer"),this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),super.destroy(),this.input=null,this.button=null,this.display=null,this.template=null,this.logger.debug("Coupon enhancer destroyed")}}},Symbol.toStringTag,{value:"Module"})),Zd=class extends be{constructor(){super(...arguments),this.accordions=new Map}initialize(){return g(this,null,function*(){this.enhance()})}enhance(){const t=this.element.getAttribute("data-next-accordion");if(!t)return void this.logger.warn("No accordion ID found on element");const e=this.parseConfig(this.element),i=new Yd(t,this.element,e);this.accordions.set(t,i),this.setupEventListeners(i),this.logger.debug(`Accordion enhanced: ${t}`)}update(t){}parseConfig(t){return{openText:t.getAttribute("data-open-text")||"Hide",closeText:t.getAttribute("data-close-text")||"Show",toggleClass:t.getAttribute("data-toggle-class")||"next-expanded",initialState:t.getAttribute("data-initial-state")||"closed",animationDuration:parseInt(t.getAttribute("data-animation-duration")||"300")}}setupEventListeners(t){t.triggers.forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.toggleAccordion(t)})}),t.triggers.forEach(e=>{e.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.toggleAccordion(t))}),e.hasAttribute("tabindex")||e.setAttribute("tabindex","0"),e.setAttribute("aria-expanded",t.isOpen.toString()),e.setAttribute("aria-controls",t.id)}),t.panels.forEach(e=>{e.setAttribute("aria-labelledby",t.id),e.setAttribute("id",`${t.id}-content`)})}toggleAccordion(t){const e=t.isOpen;e?this.closeAccordion(t):this.openAccordion(t),this.eventBus.emit("accordion:toggled",{id:t.id,isOpen:!e,element:t.element})}openAccordion(t){t.isOpen=!0,t.panels.forEach(e=>{const i=e.offsetHeight;e.style.height=i+"px",e.style.height="auto";const n=e.offsetHeight;e.style.height=i+"px",e.offsetHeight,requestAnimationFrame(()=>{e.style.height=n+"px",e.classList.add(t.config.toggleClass),setTimeout(()=>{t.isOpen&&(e.style.height="auto")},(t.config.animationDuration||300)+50)})}),t.element.classList.add(t.config.toggleClass),t.textElements.forEach(e=>{t.config.openText&&(e.textContent=t.config.openText)}),t.triggers.forEach(t=>{t.setAttribute("aria-expanded","true")}),this.logger.debug(`Accordion opened: ${t.id}`),this.eventBus.emit("accordion:opened",{id:t.id,element:t.element})}closeAccordion(t){t.isOpen=!1,t.panels.forEach(e=>{const i=e.offsetHeight;e.style.height=i+"px",e.offsetHeight,e.style.height="0px",setTimeout(()=>{e.classList.remove(t.config.toggleClass)},t.config.animationDuration||300)}),t.element.classList.remove(t.config.toggleClass),t.textElements.forEach(e=>{t.config.closeText&&(e.textContent=t.config.closeText)}),t.triggers.forEach(t=>{t.setAttribute("aria-expanded","false")}),this.logger.debug(`Accordion closed: ${t.id}`),this.eventBus.emit("accordion:closed",{id:t.id,element:t.element})}openAccordionById(t){const e=this.accordions.get(t);e&&!e.isOpen&&this.openAccordion(e)}closeAccordionById(t){const e=this.accordions.get(t);e&&e.isOpen&&this.closeAccordion(e)}toggleAccordionById(t){const e=this.accordions.get(t);e&&this.toggleAccordion(e)}getAccordionState(t){const e=this.accordions.get(t);return e?e.isOpen:null}getAllAccordions(){return Array.from(this.accordions.keys())}destroy(){this.accordions.clear(),super.destroy()}};Zd.selector="[data-next-accordion]";let Wd=Zd;class Yd{constructor(t,e,i){this.id=t,this.element=e,this.config=i,this.triggers=[],this.panels=[],this.textElements=[],this.findComponents(),this.isOpen=this.detectInitialState(),this.initializeState()}detectInitialState(){const t=this.config.toggleClass,e=this.panels.some(e=>e.classList.contains(t)),i=this.element.classList.contains(t);return!(!e&&!i)||"open"===this.config.initialState}findComponents(){const t=this.element.querySelectorAll(`[data-next-accordion-trigger="${this.id}"]`);this.triggers=Array.from(t);const e=this.element.querySelectorAll(`[data-next-accordion-panel="${this.id}"]`);this.panels=Array.from(e);const i=this.element.querySelectorAll(`[data-next-accordion-text="${this.id}"]`);this.textElements=Array.from(i),this.triggers.length,this.panels.length}initializeState(){const t=this.config.toggleClass;this.isOpen?(this.element.classList.add(t),this.panels.forEach(e=>{e.classList.add(t),e.style.height="auto"}),this.textElements.forEach(t=>{this.config.openText&&(t.textContent=this.config.openText)})):(this.element.classList.remove(t),this.panels.forEach(e=>{e.classList.remove(t),e.style.height="0px"}),this.textElements.forEach(t=>{this.config.closeText&&(t.textContent=this.config.closeText)}))}}const Xd=Object.freeze(Object.defineProperty({__proto__:null,AccordionEnhancer:Wd},Symbol.toStringTag,{value:"Module"})),tu=Math.min,eu=Math.max,iu=Math.round,nu=t=>({x:t,y:t}),ru={left:"right",right:"left",bottom:"top",top:"bottom"},su={start:"end",end:"start"};function au(t,e,i){return eu(t,tu(e,i))}function ou(t,e){return"function"==typeof t?t(e):t}function cu(t){return t.split("-")[0]}function lu(t){return t.split("-")[1]}function du(t){return"x"===t?"y":"x"}function uu(t){return"y"===t?"height":"width"}const hu=new Set(["top","bottom"]);function pu(t){return hu.has(cu(t))?"y":"x"}function fu(t){return du(pu(t))}function mu(t){return t.replace(/start|end/g,t=>su[t])}const gu=["left","right"],vu=["right","left"],yu=["top","bottom"],bu=["bottom","top"];function xu(t){return t.replace(/left|right|bottom|top/g,t=>ru[t])}function wu(t){return"number"!=typeof t?function(t){return u({top:0,right:0,bottom:0,left:0},t)}(t):{top:t,right:t,bottom:t,left:t}}function _u(t){const{x:e,y:i,width:n,height:r}=t;return{width:n,height:r,top:i,left:e,right:e+n,bottom:i+r,x:e,y:i}}function ku(t,e,i){let{reference:n,floating:r}=t;const s=pu(e),a=fu(e),o=uu(a),c=cu(e),l="y"===s,d=n.x+n.width/2-r.width/2,u=n.y+n.height/2-r.height/2,h=n[o]/2-r[o]/2;let p;switch(c){case"top":p={x:d,y:n.y-r.height};break;case"bottom":p={x:d,y:n.y+n.height};break;case"right":p={x:n.x+n.width,y:u};break;case"left":p={x:n.x-r.width,y:u};break;default:p={x:n.x,y:n.y}}switch(lu(e)){case"start":p[a]-=h*(i&&l?-1:1);break;case"end":p[a]+=h*(i&&l?-1:1)}return p}function Su(t,e){return g(this,null,function*(){var i;void 0===e&&(e={});const{x:n,y:r,platform:s,rects:a,elements:o,strategy:c}=t,{boundary:l="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:h=!1,padding:p=0}=ou(e,t),f=wu(p),m=o[h?"floating"===u?"reference":"floating":u],g=_u(yield s.getClippingRect({element:null==(i=yield null==s.isElement?void 0:s.isElement(m))||i?m:m.contextElement||(yield null==s.getDocumentElement?void 0:s.getDocumentElement(o.floating)),boundary:l,rootBoundary:d,strategy:c})),v="floating"===u?{x:n,y:r,width:a.floating.width,height:a.floating.height}:a.reference,y=yield null==s.getOffsetParent?void 0:s.getOffsetParent(o.floating),b=(yield null==s.isElement?void 0:s.isElement(y))&&(yield null==s.getScale?void 0:s.getScale(y))||{x:1,y:1},x=_u(s.convertOffsetParentRelativeRectToViewportRelativeRect?yield s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:v,offsetParent:y,strategy:c}):v);return{top:(g.top-x.top+f.top)/b.y,bottom:(x.bottom-g.bottom+f.bottom)/b.y,left:(g.left-x.left+f.left)/b.x,right:(x.right-g.right+f.right)/b.x}})}const Pu=new Set(["left","top"]);function Cu(){return"undefined"!=typeof window}function Eu(t){return Iu(t)?(t.nodeName||"").toLowerCase():"#document"}function $u(t){var e;return(null==t||null==(e=t.ownerDocument)?void 0:e.defaultView)||window}function Tu(t){var e;return null==(e=(Iu(t)?t.ownerDocument:t.document)||window.document)?void 0:e.documentElement}function Iu(t){return!!Cu()&&(t instanceof Node||t instanceof $u(t).Node)}function Au(t){return!!Cu()&&(t instanceof Element||t instanceof $u(t).Element)}function Mu(t){return!!Cu()&&(t instanceof HTMLElement||t instanceof $u(t).HTMLElement)}function Lu(t){return!(!Cu()||"undefined"==typeof ShadowRoot)&&(t instanceof ShadowRoot||t instanceof $u(t).ShadowRoot)}const Du=new Set(["inline","contents"]);function Fu(t){const{overflow:e,overflowX:i,overflowY:n,display:r}=Gu(t);return/auto|scroll|overlay|hidden|clip/.test(e+n+i)&&!Du.has(r)}const Ou=new Set(["table","td","th"]);function Uu(t){return Ou.has(Eu(t))}const Nu=[":popover-open",":modal"];function zu(t){return Nu.some(e=>{try{return t.matches(e)}catch(i){return!1}})}const qu=["transform","translate","scale","rotate","perspective"],ju=["transform","translate","scale","rotate","perspective","filter"],Ru=["paint","layout","strict","content"];function Hu(t){const e=Vu(),i=Au(t)?Gu(t):t;return qu.some(t=>!!i[t]&&"none"!==i[t])||!!i.containerType&&"normal"!==i.containerType||!e&&!!i.backdropFilter&&"none"!==i.backdropFilter||!e&&!!i.filter&&"none"!==i.filter||ju.some(t=>(i.willChange||"").includes(t))||Ru.some(t=>(i.contain||"").includes(t))}function Vu(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}const Bu=new Set(["html","body","#document"]);function Ju(t){return Bu.has(Eu(t))}function Gu(t){return $u(t).getComputedStyle(t)}function Ku(t){return Au(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Qu(t){if("html"===Eu(t))return t;const e=t.assignedSlot||t.parentNode||Lu(t)&&t.host||Tu(t);return Lu(e)?e.host:e}function Zu(t){const e=Qu(t);return Ju(e)?t.ownerDocument?t.ownerDocument.body:t.body:Mu(e)&&Fu(e)?e:Zu(e)}function Wu(t,e,i){var n;void 0===e&&(e=[]);const r=Zu(t),s=r===(null==(n=t.ownerDocument)?void 0:n.body),a=$u(r);return s?(Yu(a),e.concat(a,a.visualViewport||[],Fu(r)?r:[],[])):e.concat(r,Wu(r,[]))}function Yu(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Xu(t){const e=Gu(t);let i=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const r=Mu(t),s=r?t.offsetWidth:i,a=r?t.offsetHeight:n,o=iu(i)!==s||iu(n)!==a;return o&&(i=s,n=a),{width:i,height:n,$:o}}function th(t){return Au(t)?t:t.contextElement}function eh(t){const e=th(t);if(!Mu(e))return nu(1);const i=e.getBoundingClientRect(),{width:n,height:r,$:s}=Xu(e);let a=(s?iu(i.width):i.width)/n,o=(s?iu(i.height):i.height)/r;return a&&Number.isFinite(a)||(a=1),o&&Number.isFinite(o)||(o=1),{x:a,y:o}}const ih=nu(0);function nh(t){const e=$u(t);return Vu()&&e.visualViewport?{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}:ih}function rh(t,e,i,n){void 0===e&&(e=!1),void 0===i&&(i=!1);const r=t.getBoundingClientRect(),s=th(t);let a=nu(1);e&&(n?Au(n)&&(a=eh(n)):a=eh(t));const o=function(t,e,i){return void 0===e&&(e=!1),!(!i||e&&i!==$u(t))&&e}(s,i,n)?nh(s):nu(0);let c=(r.left+o.x)/a.x,l=(r.top+o.y)/a.y,d=r.width/a.x,u=r.height/a.y;if(s){const t=$u(s),e=n&&Au(n)?$u(n):n;let i=t,r=Yu(i);for(;r&&n&&e!==i;){const t=eh(r),e=r.getBoundingClientRect(),n=Gu(r),s=e.left+(r.clientLeft+parseFloat(n.paddingLeft))*t.x,a=e.top+(r.clientTop+parseFloat(n.paddingTop))*t.y;c*=t.x,l*=t.y,d*=t.x,u*=t.y,c+=s,l+=a,i=$u(r),r=Yu(i)}}return _u({width:d,height:u,x:c,y:l})}function sh(t,e){const i=Ku(t).scrollLeft;return e?e.left+i:rh(Tu(t)).left+i}function ah(t,e,i){void 0===i&&(i=!1);const n=t.getBoundingClientRect();return{x:n.left+e.scrollLeft-(i?0:sh(t,n)),y:n.top+e.scrollTop}}const oh=new Set(["absolute","fixed"]);function ch(t,e,i){let n;if("viewport"===e)n=function(t,e){const i=$u(t),n=Tu(t),r=i.visualViewport;let s=n.clientWidth,a=n.clientHeight,o=0,c=0;if(r){s=r.width,a=r.height;const t=Vu();(!t||t&&"fixed"===e)&&(o=r.offsetLeft,c=r.offsetTop)}return{width:s,height:a,x:o,y:c}}(t,i);else if("document"===e)n=function(t){const e=Tu(t),i=Ku(t),n=t.ownerDocument.body,r=eu(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),s=eu(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let a=-i.scrollLeft+sh(t);const o=-i.scrollTop;return"rtl"===Gu(n).direction&&(a+=eu(e.clientWidth,n.clientWidth)-r),{width:r,height:s,x:a,y:o}}(Tu(t));else if(Au(e))n=function(t,e){const i=rh(t,!0,"fixed"===e),n=i.top+t.clientTop,r=i.left+t.clientLeft,s=Mu(t)?eh(t):nu(1);return{width:t.clientWidth*s.x,height:t.clientHeight*s.y,x:r*s.x,y:n*s.y}}(e,i);else{const i=nh(t);n={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return _u(n)}function lh(t,e){const i=Qu(t);return!(i===e||!Au(i)||Ju(i))&&("fixed"===Gu(i).position||lh(i,e))}function dh(t,e,i){const n=Mu(e),r=Tu(e),s="fixed"===i,a=rh(t,!0,s,e);let o={scrollLeft:0,scrollTop:0};const c=nu(0);function l(){c.x=sh(r)}if(n||!n&&!s)if(("body"!==Eu(e)||Fu(r))&&(o=Ku(e)),n){const t=rh(e,!0,s,e);c.x=t.x+e.clientLeft,c.y=t.y+e.clientTop}else r&&l();s&&!n&&r&&l();const d=!r||n||s?nu(0):ah(r,o);return{x:a.left+o.scrollLeft-c.x-d.x,y:a.top+o.scrollTop-c.y-d.y,width:a.width,height:a.height}}function uh(t){return"static"===Gu(t).position}function hh(t,e){if(!Mu(t)||"fixed"===Gu(t).position)return null;if(e)return e(t);let i=t.offsetParent;return Tu(t)===i&&(i=i.ownerDocument.body),i}function ph(t,e){const i=$u(t);if(zu(t))return i;if(!Mu(t)){let e=Qu(t);for(;e&&!Ju(e);){if(Au(e)&&!uh(e))return e;e=Qu(e)}return i}let n=hh(t,e);for(;n&&Uu(n)&&uh(n);)n=hh(n,e);return n&&Ju(n)&&uh(n)&&!Hu(n)?i:n||function(t){let e=Qu(t);for(;Mu(e)&&!Ju(e);){if(Hu(e))return e;if(zu(e))return null;e=Qu(e)}return null}(t)||i}const fh={convertOffsetParentRelativeRectToViewportRelativeRect:function(t){let{elements:e,rect:i,offsetParent:n,strategy:r}=t;const s="fixed"===r,a=Tu(n),o=!!e&&zu(e.floating);if(n===a||o&&s)return i;let c={scrollLeft:0,scrollTop:0},l=nu(1);const d=nu(0),u=Mu(n);if((u||!u&&!s)&&(("body"!==Eu(n)||Fu(a))&&(c=Ku(n)),Mu(n))){const t=rh(n);l=eh(n),d.x=t.x+n.clientLeft,d.y=t.y+n.clientTop}const h=!a||u||s?nu(0):ah(a,c,!0);return{width:i.width*l.x,height:i.height*l.y,x:i.x*l.x-c.scrollLeft*l.x+d.x+h.x,y:i.y*l.y-c.scrollTop*l.y+d.y+h.y}},getDocumentElement:Tu,getClippingRect:function(t){let{element:e,boundary:i,rootBoundary:n,strategy:r}=t;const s=[..."clippingAncestors"===i?zu(e)?[]:function(t,e){const i=e.get(t);if(i)return i;let n=Wu(t,[]).filter(t=>Au(t)&&"body"!==Eu(t)),r=null;const s="fixed"===Gu(t).position;let a=s?Qu(t):t;for(;Au(a)&&!Ju(a);){const e=Gu(a),i=Hu(a);i||"fixed"!==e.position||(r=null),(s?!i&&!r:!i&&"static"===e.position&&r&&oh.has(r.position)||Fu(a)&&!i&&lh(t,a))?n=n.filter(t=>t!==a):r=e,a=Qu(a)}return e.set(t,n),n}(e,this.Nt):[].concat(i),n],a=s[0],o=s.reduce((t,i)=>{const n=ch(e,i,r);return t.top=eu(n.top,t.top),t.right=tu(n.right,t.right),t.bottom=tu(n.bottom,t.bottom),t.left=eu(n.left,t.left),t},ch(e,a,r));return{width:o.right-o.left,height:o.bottom-o.top,x:o.left,y:o.top}},getOffsetParent:ph,getElementRects:function(t){return g(this,null,function*(){const e=this.getOffsetParent||ph,i=this.getDimensions,n=yield i(t.floating);return{reference:dh(t.reference,yield e(t.floating),t.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}})},getClientRects:function(t){return Array.from(t.getClientRects())},getDimensions:function(t){const{width:e,height:i}=Xu(t);return{width:e,height:i}},getScale:eh,isElement:Au,isRTL:function(t){return"rtl"===Gu(t).direction}},mh=function(t){return void 0===t&&(t={}),{name:"shift",options:t,fn(e){return g(this,null,function*(){const{x:i,y:n,placement:r}=e,s=ou(t,e),{mainAxis:a=!0,crossAxis:o=!1,limiter:c={fn:t=>{let{x:e,y:i}=t;return{x:e,y:i}}}}=s,l=p(s,["mainAxis","crossAxis","limiter"]),d={x:i,y:n},f=yield Su(e,l),m=pu(cu(r)),g=du(m);let v=d[g],y=d[m];if(a){const t="y"===g?"bottom":"right";v=au(v+f["y"===g?"top":"left"],v,v-f[t])}if(o){const t="y"===m?"bottom":"right";y=au(y+f["y"===m?"top":"left"],y,y-f[t])}const b=c.fn(h(u({},e),{[g]:v,[m]:y}));return h(u({},b),{data:{x:b.x-i,y:b.y-n,enabled:{[g]:a,[m]:o}}})})}}},gh=function(t){return void 0===t&&(t={}),{name:"flip",options:t,fn(e){return g(this,null,function*(){var i,n;const{placement:r,middlewareData:s,rects:a,initialPlacement:o,platform:c,elements:l}=e,d=ou(t,e),{mainAxis:u=!0,crossAxis:h=!0,fallbackPlacements:f,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:v=!0}=d,y=p(d,["mainAxis","crossAxis","fallbackPlacements","fallbackStrategy","fallbackAxisSideDirection","flipAlignment"]);if(null!=(i=s.arrow)&&i.alignmentOffset)return{};const b=cu(r),x=pu(o),w=cu(o)===o,_=yield null==c.isRTL?void 0:c.isRTL(l.floating),k=f||(w||!v?[xu(o)]:function(t){const e=xu(t);return[mu(t),e,mu(e)]}(o)),S="none"!==g;!f&&S&&k.push(...function(t,e,i,n){const r=lu(t);let s=function(t,e,i){switch(t){case"top":case"bottom":return i?e?vu:gu:e?gu:vu;case"left":case"right":return e?yu:bu;default:return[]}}(cu(t),"start"===i,n);return r&&(s=s.map(t=>t+"-"+r),e&&(s=s.concat(s.map(mu)))),s}(o,v,g,_));const P=[o,...k],C=yield Su(e,y),E=[];let $=(null==(n=s.flip)?void 0:n.overflows)||[];if(u&&E.push(C[b]),h){const t=function(t,e,i){void 0===i&&(i=!1);const n=lu(t),r=fu(t),s=uu(r);let a="x"===r?n===(i?"end":"start")?"right":"left":"start"===n?"bottom":"top";return e.reference[s]>e.floating[s]&&(a=xu(a)),[a,xu(a)]}(r,a,_);E.push(C[t[0]],C[t[1]])}if($=[...$,{placement:r,overflows:E}],!E.every(t=>t<=0)){var T,I;const t=((null==(T=s.flip)?void 0:T.index)||0)+1,e=P[t];if(e&&("alignment"!==h||x===pu(e)||$.every(t=>pu(t.placement)!==x||t.overflows[0]>0)))return{data:{index:t,overflows:$},reset:{placement:e}};let i=null==(I=$.filter(t=>t.overflows[0]<=0).sort((t,e)=>t.overflows[1]-e.overflows[1])[0])?void 0:I.placement;if(!i)switch(m){case"bestFit":{var A;const t=null==(A=$.filter(t=>{if(S){const e=pu(t.placement);return e===x||"y"===e}return!0}).map(t=>[t.placement,t.overflows.filter(t=>t>0).reduce((t,e)=>t+e,0)]).sort((t,e)=>t[1]-e[1])[0])?void 0:A[0];t&&(i=t);break}case"initialPlacement":i=o}if(r!==i)return{reset:{placement:i}}}return{}})}}},vh=t=>({name:"arrow",options:t,fn(e){return g(this,null,function*(){const{x:i,y:n,placement:r,rects:s,platform:a,elements:o,middlewareData:c}=e,{element:l,padding:d=0}=ou(t,e)||{};if(null==l)return{};const h=wu(d),p={x:i,y:n},f=fu(r),m=uu(f),g=yield a.getDimensions(l),v="y"===f,y=v?"top":"left",b=v?"bottom":"right",x=v?"clientHeight":"clientWidth",w=s.reference[m]+s.reference[f]-p[f]-s.floating[m],_=p[f]-s.reference[f],k=yield null==a.getOffsetParent?void 0:a.getOffsetParent(l);let S=k?k[x]:0;S&&(yield null==a.isElement?void 0:a.isElement(k))||(S=o.floating[x]||s.floating[m]);const P=w/2-_/2,C=S/2-g[m]/2-1,E=tu(h[y],C),$=tu(h[b],C),T=E,I=S-g[m]-$,A=S/2-g[m]/2+P,M=au(T,A,I),L=!c.arrow&&null!=lu(r)&&A!==M&&s.reference[m]/2-(A<T?E:$)-g[m]/2<0,D=L?A<T?A-T:A-I:0;return{[f]:p[f]+D,data:u({[f]:M,centerOffset:A-M-D},L&&{alignmentOffset:D}),reset:L}})}}),yh=class t extends be{constructor(t){super(t),this.tooltip=null,this.arrow=null,this.showTimeout=null,this.hideTimeout=null,this.isVisible=!1,this.handleMouseEnter=()=>{this.scheduleShow()},this.handleMouseLeave=()=>{this.scheduleHide()},this.handleFocus=()=>{this.scheduleShow()},this.handleBlur=()=>{this.scheduleHide()},this.handleTouchStart=()=>{this.isVisible?this.hide():this.show()},this.handleKeydown=t=>{"Escape"===t.key&&this.isVisible&&this.hide()},this.config=this.parseConfig(),this.injectStyles()}initialize(){return g(this,null,function*(){try{this.validateElement(),this.setupEventListeners(),this.logger.debug("Tooltip enhancer initialized")}catch(t){this.handleError(t,"initialize")}})}update(){this.config=this.parseConfig(),this.isVisible&&this.tooltip&&this.updateTooltipContent()}destroy(){this.hide(),this.cleanupTimeouts(),super.destroy()}parseConfig(){return{placement:this.getAttribute("data-next-tooltip-placement")||"top",offset:parseInt(this.getAttribute("data-next-tooltip-offset")||"8"),delay:parseInt(this.getAttribute("data-next-tooltip-delay")||"500"),maxWidth:this.getAttribute("data-next-tooltip-max-width")||"200px",className:this.getAttribute("data-next-tooltip-class")||""}}injectStyles(){if(t.stylesInjected)return;const e="next-tooltip-styles";if(document.getElementById(e))return;const i=document.createElement("style");i.id=e,i.textContent='\n      .next-tooltip {\n        position: fixed;\n        top: 0;\n        left: 0;\n        z-index: 99999;\n        opacity: 0;\n        visibility: hidden;\n        transition: opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease;\n        transform: scale(0.95);\n        pointer-events: none;\n      }\n\n      .next-tooltip--visible {\n        opacity: 1;\n        visibility: visible;\n        transform: scale(1);\n        pointer-events: auto;\n      }\n\n      .next-tooltip__content {\n        background: #333;\n        color: #fff;\n        padding: 8px 12px;\n        border-radius: 6px;\n        font-size: 13px;\n        line-height: 1.4;\n        font-weight: 400;\n        text-align: center;\n        word-wrap: break-word;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        white-space: nowrap;\n        max-width: 200px;\n        white-space: normal;\n        -webkit-font-smoothing: antialiased;\n        -moz-osx-font-smoothing: grayscale;\n      }\n\n      .next-tooltip__arrow {\n        position: absolute;\n        width: 8px;\n        height: 8px;\n        background: #333;\n        transform: rotate(45deg);\n      }\n\n      .next-tooltip[data-placement^="top"] .next-tooltip__arrow {\n        border-top: none;\n        border-left: none;\n      }\n\n      .next-tooltip[data-placement^="bottom"] .next-tooltip__arrow {\n        border-bottom: none;\n        border-right: none;\n      }\n\n      .next-tooltip[data-placement^="left"] .next-tooltip__arrow {\n        border-left: none;\n        border-bottom: none;\n      }\n\n      .next-tooltip[data-placement^="right"] .next-tooltip__arrow {\n        border-right: none;\n        border-top: none;\n      }\n\n      .next-tooltip--light .next-tooltip__content {\n        background: #fff;\n        color: #333;\n        border: 1px solid #ddd;\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n      }\n\n      .next-tooltip--light .next-tooltip__arrow {\n        background: #fff;\n        border: 1px solid #ddd;\n      }\n\n      .next-tooltip--error .next-tooltip__content {\n        background: #dc3545;\n        color: #fff;\n      }\n\n      .next-tooltip--error .next-tooltip__arrow {\n        background: #dc3545;\n      }\n\n      .next-tooltip--success .next-tooltip__content {\n        background: #28a745;\n        color: #fff;\n      }\n\n      .next-tooltip--success .next-tooltip__arrow {\n        background: #28a745;\n      }\n\n      .next-tooltip--warning .next-tooltip__content {\n        background: #ffc107;\n        color: #333;\n      }\n\n      .next-tooltip--warning .next-tooltip__arrow {\n        background: #ffc107;\n      }\n\n      .next-tooltip--large .next-tooltip__content {\n        padding: 12px 16px;\n        font-size: 14px;\n        max-width: 300px;\n      }\n\n      .next-tooltip--small .next-tooltip__content {\n        padding: 4px 8px;\n        font-size: 12px;\n        max-width: 150px;\n      }\n\n      @media (hover: none) {\n        .next-tooltip {\n          transition-duration: 0.15s;\n        }\n      }\n\n      @media (prefers-contrast: high) {\n        .next-tooltip__content {\n          border: 2px solid currentColor;\n        }\n      }\n\n      @media (prefers-reduced-motion: reduce) {\n        .next-tooltip {\n          transition: opacity 0.1s ease, visibility 0.1s ease;\n          transform: none;\n        }\n        \n        .next-tooltip--visible {\n          transform: none;\n        }\n      }\n    ',document.head.appendChild(i),t.stylesInjected=!0,this.logger.debug("Tooltip styles injected into document head")}setupEventListeners(){this.element.addEventListener("mouseenter",this.handleMouseEnter),this.element.addEventListener("mouseleave",this.handleMouseLeave),this.element.addEventListener("focus",this.handleFocus),this.element.addEventListener("blur",this.handleBlur),this.element.addEventListener("touchstart",this.handleTouchStart),document.addEventListener("keydown",this.handleKeydown)}cleanupEventListeners(){this.element.removeEventListener("mouseenter",this.handleMouseEnter),this.element.removeEventListener("mouseleave",this.handleMouseLeave),this.element.removeEventListener("focus",this.handleFocus),this.element.removeEventListener("blur",this.handleBlur),this.element.removeEventListener("touchstart",this.handleTouchStart),document.removeEventListener("keydown",this.handleKeydown)}scheduleShow(){this.cleanupTimeouts(),this.showTimeout=window.setTimeout(()=>{this.show()},this.config.delay)}scheduleHide(){this.cleanupTimeouts(),this.hideTimeout=window.setTimeout(()=>{this.hide()},150)}cleanupTimeouts(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null),this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null)}show(){return g(this,null,function*(){if(this.isVisible)return;const t=this.getTooltipContent();if(t)try{if(this.createTooltip(t),!this.tooltip)return;this.isVisible=!0,document.body.appendChild(this.tooltip);const e=this.element.getBoundingClientRect();this.logger.debug("Element position",{top:e.top,left:e.left,width:e.width,height:e.height,scrollY:window.scrollY,scrollX:window.scrollX}),yield new Promise(t=>requestAnimationFrame(t)),yield this.positionTooltip(),requestAnimationFrame(()=>{this.tooltip&&this.tooltip.classList.add("next-tooltip--visible")}),this.element.setAttribute("aria-describedby",this.tooltip.id),this.logger.debug("Tooltip shown")}catch(e){this.handleError(e,"show tooltip")}})}hide(){this.isVisible&&this.tooltip&&(this.isVisible=!1,this.tooltip.classList.remove("next-tooltip--visible"),setTimeout(()=>{this.tooltip&&this.tooltip.parentNode&&this.tooltip.parentNode.removeChild(this.tooltip),this.tooltip=null,this.arrow=null},200),this.element.removeAttribute("aria-describedby"),this.logger.debug("Tooltip hidden"))}getTooltipContent(){return this.getAttribute("data-next-tooltip")||""}updateTooltipContent(){if(!this.tooltip)return;const t=this.getTooltipContent(),e=this.tooltip.querySelector(".next-tooltip__content");e&&(e.textContent=t)}createTooltip(t){this.tooltip=document.createElement("div"),this.tooltip.className=`next-tooltip ${this.config.className||""}`.trim(),this.tooltip.id=`tooltip-${Math.random().toString(36).substr(2,9)}`,this.tooltip.role="tooltip",this.tooltip.style.maxWidth=this.config.maxWidth||"200px";const e=document.createElement("div");e.className="next-tooltip__content",e.textContent=t,this.arrow=document.createElement("div"),this.arrow.className="next-tooltip__arrow",this.tooltip.appendChild(e),this.tooltip.appendChild(this.arrow),this.tooltip.addEventListener("mouseenter",()=>{this.cleanupTimeouts()}),this.tooltip.addEventListener("mouseleave",()=>{this.scheduleHide()})}positionTooltip(){return g(this,null,function*(){if(this.tooltip&&this.arrow)try{const{x:e,y:i,placement:n,middlewareData:r}=yield((t,e,i)=>{const n=new Map,r=u({platform:fh},i),s=h(u({},r.platform),{Nt:n});return((t,e,i)=>g(null,null,function*(){const{placement:n="bottom",strategy:r="absolute",middleware:s=[],platform:a}=i,o=s.filter(Boolean),c=yield null==a.isRTL?void 0:a.isRTL(e);let l=yield a.getElementRects({reference:t,floating:e,strategy:r}),{x:d,y:p}=ku(l,n,c),f=n,m={},g=0;for(let i=0;i<o.length;i++){const{name:s,fn:v}=o[i],{x:y,y:b,data:x,reset:w}=yield v({x:d,y:p,initialPlacement:n,placement:f,strategy:r,middlewareData:m,rects:l,platform:a,elements:{reference:t,floating:e}});d=null!=y?y:d,p=null!=b?b:p,m=h(u({},m),{[s]:u(u({},m[s]),x)}),w&&g<=50&&(g++,"object"==typeof w&&(w.placement&&(f=w.placement),w.rects&&(l=!0===w.rects?yield a.getElementRects({reference:t,floating:e,strategy:r}):w.rects),({x:d,y:p}=ku(l,f,c))),i=-1)}return{x:d,y:p,placement:f,strategy:r,middlewareData:m}}))(t,e,h(u({},r),{platform:s}))})(this.element,this.tooltip,{placement:this.config.placement||"top",middleware:[(t=this.config.offset||8,void 0===t&&(t=0),{name:"offset",options:t,fn(e){return g(this,null,function*(){var i,n;const{x:r,y:s,placement:a,middlewareData:o}=e,c=yield function(t,e){return g(this,null,function*(){const{placement:i,platform:n,elements:r}=t,s=yield null==n.isRTL?void 0:n.isRTL(r.floating),a=cu(i),o=lu(i),c="y"===pu(i),l=Pu.has(a)?-1:1,d=s&&c?-1:1,u=ou(e,t);let{mainAxis:h,crossAxis:p,alignmentAxis:f}="number"==typeof u?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return o&&"number"==typeof f&&(p="end"===o?-1*f:f),c?{x:p*d,y:h*l}:{x:h*l,y:p*d}})}(e,t);return a===(null==(i=o.offset)?void 0:i.placement)&&null!=(n=o.arrow)&&n.alignmentOffset?{}:{x:r+c.x,y:s+c.y,data:h(u({},c),{placement:a})}})}}),gh(),mh({padding:5}),vh({element:this.arrow})],strategy:"fixed"});if(Object.assign(this.tooltip.style,{left:`${e}px`,top:`${i}px`}),r.arrow){const{x:t,y:e}=r.arrow,i={top:"bottom",right:"left",bottom:"top",left:"right"}[n.split("-")[0]];Object.assign(this.arrow.style,{left:null!=t?`${t}px`:"",top:null!=e?`${e}px`:"",right:"",bottom:"",[i]:"-4px"})}this.tooltip.setAttribute("data-placement",n),this.logger.debug("Tooltip positioned",{x:e,y:i,placement:n})}catch(e){this.handleError(e,"position tooltip")}var t})}};yh.stylesInjected=!1;let bh=yh;const xh=Object.freeze(Object.defineProperty({__proto__:null,TooltipEnhancer:bh},Symbol.toStringTag,{value:"Module"})),wh=Object.freeze(Object.defineProperty({__proto__:null,ScrollHintEnhancer:class extends be{constructor(){super(...arguments),this.scrollThreshold=5,this.activeClass="cart-items__scroll-hint--active"}initialize(){return g(this,null,function*(){this.validateElement(),this.scrollThreshold=parseInt(this.getAttribute("data-next-scroll-threshold")||"5",10);const t=this.getAttribute("data-next-scroll-target");if(t)this.scrollTarget=document.querySelector(t);else{const t=this.findScrollTarget();t&&(this.scrollTarget=t)}this.scrollTarget?(this.scrollHandler=this.throttle(this.updateScrollHint.bind(this),16),this.resizeHandler=this.debounce(this.updateScrollHint.bind(this),100),this.scrollTarget.addEventListener("scroll",this.scrollHandler),window.addEventListener("resize",this.resizeHandler),this.observeContentChanges(),this.updateScrollHint(),this.logger.debug("ScrollHintEnhancer initialized",{scrollTarget:this.scrollTarget,threshold:this.scrollThreshold})):this.logger.warn("No scroll target found for scroll hint")})}findScrollTarget(){const t=[".cart-items__list","[data-next-cart-items]","[data-next-order-items]",".order-items__list",".scrollable-content"],e=this.element.parentElement;if(e)for(const n of t){const t=e.querySelector(n);if(t)return t}const i=this.element.closest(".order-summary, .cart-items, .modal-content");if(i)for(const n of t){const t=i.querySelector(n);if(t)return t}return null}observeContentChanges(){this.scrollTarget&&(this.mutationObserver=new MutationObserver(()=>{this.scheduleUpdate()}),this.mutationObserver.observe(this.scrollTarget,{childList:!0,subtree:!0,characterData:!0}))}scheduleUpdate(){this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.updateScrollHint()})}hasScrollableContent(){return!!this.scrollTarget&&this.scrollTarget.scrollHeight>this.scrollTarget.clientHeight}updateScrollHint(){if(!this.scrollTarget)return;if(!this.hasScrollableContent())return this.removeClass(this.activeClass),void this.setAttribute("aria-hidden","true");const t=this.scrollTarget.scrollTop<=this.scrollThreshold;t?(this.addClass(this.activeClass),this.setAttribute("aria-hidden","false")):(this.removeClass(this.activeClass),this.setAttribute("aria-hidden","true")),this.eventBus.emit("scroll-hint:updated",{isVisible:t&&this.hasScrollableContent(),scrollTop:this.scrollTarget.scrollTop,scrollHeight:this.scrollTarget.scrollHeight,clientHeight:this.scrollTarget.clientHeight})}throttle(t,e){let i=!1;return(...n)=>{i||(t.apply(this,n),i=!0,setTimeout(()=>i=!1,e))}}debounce(t,e){let i;return(...n)=>{clearTimeout(i),i=window.setTimeout(()=>t.apply(this,n),e)}}update(){this.updateScrollHint()}destroy(){this.scrollTarget&&this.scrollHandler&&this.scrollTarget.removeEventListener("scroll",this.scrollHandler),this.resizeHandler&&window.removeEventListener("resize",this.resizeHandler),this.mutationObserver&&this.mutationObserver.disconnect(),this.rafId&&cancelAnimationFrame(this.rafId),super.destroy()}}},Symbol.toStringTag,{value:"Module"})),_h=Object.freeze(Object.defineProperty({__proto__:null,QuantityTextEnhancer:class extends be{constructor(){super(...arguments),this.template="",this.currentQuantity=1}initialize(){return g(this,null,function*(){if(this.validateElement(),this.template=this.getAttribute("data-next-quantity-text")||"",!this.template)return void this.logger.warn("QuantityTextEnhancer requires data-next-quantity-text attribute");this.quantitySelectorId=this.getAttribute("data-next-quantity-selector-id")||"";const t=this.element.closest("[data-next-package-id]");if(t){const e=t.getAttribute("data-next-package-id");e&&(this.containerPackageId=parseInt(e,10))}this.setupQuantityListeners(),this.getInitialQuantity(),this.updateText(),this.logger.debug("QuantityTextEnhancer initialized",{template:this.template,quantitySelectorId:this.quantitySelectorId,packageId:this.containerPackageId})})}setupQuantityListeners(){this.eventBus.on("upsell:quantity-changed",t=>{if(this.quantitySelectorId&&t.selectorId===this.quantitySelectorId)this.currentQuantity=t.quantity,this.updateText();else if(this.quantitySelectorId||t.selectorId){if(!this.quantitySelectorId){const e=this.element.closest("[data-next-selector-id]");e?e.getAttribute("data-next-selector-id")===t.selectorId&&(this.currentQuantity=t.quantity,this.updateText()):t.packageId===this.containerPackageId&&(this.currentQuantity=t.quantity,this.updateText())}}else t.packageId===this.containerPackageId&&(this.currentQuantity=t.quantity,this.updateText())})}getInitialQuantity(){if(this.quantitySelectorId){const t=document.querySelector(`[data-next-upsell-quantity="display"][data-next-quantity-selector-id="${this.quantitySelectorId}"]`);if(t&&t.textContent){const e=parseInt(t.textContent,10);isNaN(e)||(this.currentQuantity=e)}}else{const t=this.element.closest('[data-next-upsell="offer"]');if(t){const e=t.querySelector('[data-next-upsell-quantity="display"]');if(e&&e.textContent){const t=parseInt(e.textContent,10);isNaN(t)||(this.currentQuantity=t)}}}}updateText(){let t=this.template;t=t.replace(/\{qty([*+\-]?\d*)\}/g,(t,e)=>{let i=this.currentQuantity;if(e){const t=e[0],n=parseInt(e.substring(1),10);switch(t){case"*":i=this.currentQuantity*n;break;case"+":i=this.currentQuantity+n;break;case"-":i=Math.max(0,this.currentQuantity-n)}}return i.toString()}),t=t.replace(/\{([^|]+)\|([^}]+)\}/g,(t,e,i)=>1===this.currentQuantity?e:i),this.element.textContent=t}update(){this.updateText()}destroy(){super.destroy()}}},Symbol.toStringTag,{value:"Module"})),kh=tt("UtmTransfer"),Sh=Object.freeze(Object.defineProperty({__proto__:null,UtmTransfer:class{constructor(t={}){this.config=u({enabled:!0,applyToExternalLinks:!1,excludedDomains:[],paramsToCopy:[],debug:!1},t),this.paramsToApply=new URLSearchParams}init(){if(!this.config.enabled)return void kh.debug("UTM Transfer disabled by configuration");const t=new URLSearchParams(window.location.search);if(""!==t.toString()){if(this.config.debug){const e=[];t.forEach((t,i)=>{e.push(`${i}=${t}`)}),kh.debug(`Available parameters: ${e.join(", ")}`)}this.prepareParameters(t),""!==this.paramsToApply.toString()?(this.enhanceLinks(),this.observeNewLinks(),kh.debug(`UTM Transfer initialized with parameters: ${this.paramsToApply.toString()}`)):kh.debug("No matching parameters to transfer")}else kh.debug("No URL parameters to transfer")}prepareParameters(t){Array.isArray(this.config.paramsToCopy)&&this.config.paramsToCopy.length>0?(kh.debug(`Filtering to specific parameters: ${this.config.paramsToCopy.join(", ")}`),this.config.paramsToCopy.forEach(e=>{t.has(e)&&(this.paramsToApply.append(e,t.get(e)),kh.debug(`Found parameter to copy: ${e}=${t.get(e)}`))})):(kh.debug("No specific parameters configured, will copy all parameters"),t.forEach((t,e)=>{this.paramsToApply.append(e,t)}))}enhanceLinks(){const t=document.querySelectorAll("a");kh.debug(`Found ${t.length} links on the page`),t.forEach(t=>{this.addClickListener(t)})}addClickListener(t){"true"!==t.dataset.utmEnhanced&&(t.addEventListener("click",e=>{this.applyParamsToLink(t)}),t.dataset.utmEnhanced="true")}applyParamsToLink(t){if(!t||!t.getAttribute)return void kh.error("Invalid link element provided");const e=t.getAttribute("href");if(!e)return;if(this.shouldSkipLink(e))return;if(this.isExternalLink(e)){if(!this.config.applyToExternalLinks)return;if(this.isExcludedDomain(e))return}let i;try{i=new URL(e,window.location.origin)}catch(s){return void kh.error("Invalid URL:",e)}const n=new URLSearchParams(i.search);let r=!1;this.paramsToApply.forEach((t,e)=>{n.has(e)||(n.append(e,t),r=!0)}),r&&(i.search=n.toString(),t.setAttribute("href",i.toString()),kh.debug(`Updated link ${e} to ${i.toString()}`))}shouldSkipLink(t){return t.startsWith("#")||t.startsWith("javascript:")||t.startsWith("mailto:")||t.startsWith("tel:")||t.startsWith("sms:")||t.startsWith("whatsapp:")}isExternalLink(t){return t.includes("://")&&!t.includes(window.location.hostname)}isExcludedDomain(t){return!(!this.config.excludedDomains||0===this.config.excludedDomains.length)&&this.config.excludedDomains.some(e=>t.includes(e))}observeNewLinks(){new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{if(t.nodeType===Node.ELEMENT_NODE){const e=t;"A"===e.tagName&&this.addClickListener(e),e.querySelectorAll("a").forEach(t=>{this.addClickListener(t)})}})})}).observe(document.body,{childList:!0,subtree:!0})}getConfig(){return u({},this.config)}updateConfig(t){this.config=u(u({},this.config),t)}}},Symbol.toStringTag,{value:"Module"})),Ph=new class{constructor(){this.logger=new Y("ErrorHandler"),this.initialized=!1,this.isHandlingError=!1}initialize(){if(this.initialized)return;window.addEventListener("error",t=>{this.handleError(t.error,{message:t.message,filename:t.filename,lineno:t.lineno,colno:t.colno})}),window.addEventListener("unhandledrejection",t=>{this.handleError(t.reason,{type:"unhandledRejection",promise:t.promise})});const t=console.error;console.error=(...e)=>{if(t.apply(console,e),this.isHandlingError)return;const i=e[0];i instanceof Error?this.handleError(i,{source:"console.error"}):"string"==typeof i&&i.toLowerCase().includes("error")&&this.handleError(new Error(i),{source:"console.error",additionalArgs:e.slice(1)})},this.initialized=!0,this.logger.debug("Global error handler initialized")}handleError(t,e){if(t&&!this.isHandlingError)try{this.isHandlingError=!0;const i=t instanceof Error?t:new Error(String(t)),n=h(u({},e),{sdk:{version:"0.2.0",timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent}});this.logger.error("Captured error:",i,n),st.getInstance().emit("error:occurred",{message:i.message,code:i.name,details:n})}finally{this.isHandlingError=!1}}captureMessage(t,e="info"){}addBreadcrumb(t){}},Ch=Object.freeze(Object.defineProperty({__proto__:null,errorHandler:Ph},Symbol.toStringTag,{value:"Module"}));class Eh{constructor(){this.eventLog=[],this.maxEvents=100,this.initializeEventCapture()}initializeEventCapture(){["next:cart-updated","next:checkout-step","next:item-added","next:item-removed","next:timer-expired","next:validation-error","next:payment-success","next:payment-error"].forEach(t=>{document.addEventListener(t,e=>{this.logEvent(t.replace("next:",""),e.detail,"CustomEvent")})}),this.interceptFetch()}interceptFetch(){const t=window.fetch;window.fetch=(...e)=>g(this,null,function*(){var i;const n=e[0].toString();return(n.includes("29next.com")||n.includes("campaigns."))&&this.logEvent("api-request",{url:n,method:(null==(i=e[1])?void 0:i.method)||"GET"},"API"),t.apply(window,e)})}logEvent(t,e,i){this.eventLog.push({timestamp:new Date,type:t,data:e,source:i}),this.eventLog.length>this.maxEvents&&this.eventLog.shift()}getEvents(t){return(t?this.eventLog.slice(-t):this.eventLog).reverse()}clearEvents(){this.eventLog=[]}exportEvents(){return JSON.stringify(this.eventLog,null,2)}}class $h{static createOverlayHTML(t,e,i,n){const r=t.find(t=>t.id===e);return`\n      <div class="enhanced-debug-overlay ${i?"expanded":"collapsed"}">\n        ${this.createBottomBar(i)}\n        ${i?this.createExpandedContent(t,r,e,n):""}\n      </div>\n    `}static createBottomBar(t){return`\n      <div class="debug-bottom-bar">\n        <div class="debug-logo-section">\n          ${this.get29NextLogo()}\n          <span class="debug-title">Debug Tools</span>\n          <div class="debug-status">\n            <div class="status-indicator active"></div>\n            <span class="status-text">Active</span>\n          </div>\n        </div>\n        \n        <div class="debug-quick-stats">\n          <div class="stat-item">\n            <span class="stat-value" data-debug-stat="cart-items">0</span>\n            <span class="stat-label">Items</span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-value" data-debug-stat="cart-total">$0.00</span>\n            <span class="stat-label">Total</span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-value" data-debug-stat="enhanced-elements">0</span>\n            <span class="stat-label">Enhanced</span>\n          </div>\n        </div>\n\n        <div class="debug-controls">\n          <button class="debug-control-btn" data-action="toggle-mini-cart" title="Toggle Mini Cart">\n            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n              <path d="M17,18C15.89,18 15,18.89 15,20A2,2 0 0,0 17,22A2,2 0 0,0 19,20C19,18.89 18.1,18 17,18M1,2V4H3L6.6,11.59L5.24,14.04C5.09,14.32 5,14.65 5,15A2,2 0 0,0 7,17H19V15H7.42A0.25,0.25 0 0,1 7.17,14.75C7.17,14.7 7.18,14.66 7.2,14.63L8.1,13H15.55C16.3,13 16.96,12.58 17.3,11.97L20.88,5.5C20.95,5.34 21,5.17 21,5A1,1 0 0,0 20,4H5.21L4.27,2M7,18C5.89,18 5,18.89 5,20A2,2 0 0,0 7,22A2,2 0 0,0 9,20C9,18.89 8.1,18 7,18Z"/>\n            </svg>\n          </button>\n          <button class="debug-control-btn" data-action="clear-cart" title="Clear Cart">\n            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n              <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>\n            </svg>\n          </button>\n          <button class="debug-control-btn" data-action="toggle-xray" title="Toggle X-Ray View">\n            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n              <path d="M5 3C3.89 3 3 3.9 3 5V19C3 20.11 3.89 21 5 21H19C20.11 21 21 20.11 21 19V5C21 3.9 20.11 3 19 3H5M5 5H19V19H5V5M7 7V9H9V7H7M11 7V9H13V7H11M15 7V9H17V7H15M7 11V13H9V11H7M11 11V13H13V11H11M15 11V13H17V11H15M7 15V17H9V15H7M11 15V17H13V15H11M15 15V17H17V15H15Z"/>\n            </svg>\n          </button>\n          <button class="debug-control-btn" data-action="export-data" title="Export Debug Data">\n            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n              <path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"/>\n            </svg>\n          </button>\n          <button class="debug-expand-btn" data-action="toggle-expand" title="${t?"Collapse":"Expand"}">\n            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="expand-icon ${t?"rotated":""}">\n              <path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"/>\n            </svg>\n          </button>\n          <button class="debug-control-btn close-btn" data-action="close" title="Close Debug Tools">\n            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n              <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>\n            </svg>\n          </button>\n        </div>\n      </div>\n    `}static createExpandedContent(t,e,i,n){return`\n      <div class="debug-expanded-content">\n        <div class="debug-sidebar">\n          ${this.createPanelTabs(t,i)}\n        </div>\n        \n        <div class="debug-main-content">\n          ${this.createPanelContent(e,n)}\n        </div>\n      </div>\n    `}static createPanelTabs(t,e){return`\n      <div class="debug-panel-tabs">\n        ${t.map(t=>`\n          <button class="debug-panel-tab ${t.id===e?"active":""}" \n                  data-panel="${t.id}">\n            <span class="tab-icon">${t.icon}</span>\n            <span class="tab-label">${t.title}</span>\n            ${"events"===t.id?'<div class="tab-badge" data-debug-badge="events">0</div>':""}\n          </button>\n        `).join("")}\n      </div>\n    `}static createPanelContent(t,e){var i,n;if(!t)return"";const r=(null==(i=t.getTabs)?void 0:i.call(t))||[];if(r.length>0){const i=e||(null==(n=r[0])?void 0:n.id),s=r.find(t=>t.id===i)||r[0];return`\n        <div class="debug-panel-container">\n          <div class="panel-header">\n            <div class="panel-title">\n              <span class="panel-icon">${t.icon}</span>\n              <h2>${t.title}</h2>\n            </div>\n            ${t.getActions?`\n              <div class="panel-actions">\n                ${t.getActions().map(t=>`\n                  <button class="panel-action-btn ${t.variant||"primary"}" \n                          data-panel-action="${t.label}">\n                    ${t.label}\n                  </button>\n                `).join("")}\n              </div>\n            `:""}\n          </div>\n          \n          <div class="panel-horizontal-tabs">\n            ${r.map(t=>`\n              <button class="horizontal-tab ${t.id===i?"active":""}" \n                      data-panel-tab="${t.id}">\n                ${t.icon?`<span class="tab-icon">${t.icon}</span>`:""}\n                <span class="tab-label">${t.label}</span>\n              </button>\n            `).join("")}\n          </div>\n          \n          <div class="panel-content ${"events"===t.id||"event-timeline"===t.id||"order"===t.id&&"lines"===i||"raw"===i?"no-padding":""}">\n            ${s?s.getContent():""}\n          </div>\n        </div>\n      `}return`\n      <div class="debug-panel-container">\n        <div class="panel-header">\n          <div class="panel-title">\n            <span class="panel-icon">${t.icon}</span>\n            <h2>${t.title}</h2>\n          </div>\n          ${t.getActions?`\n            <div class="panel-actions">\n              ${t.getActions().map(t=>`\n                <button class="panel-action-btn ${t.variant||"primary"}" \n                        data-panel-action="${t.label}">\n                  ${t.label}\n                </button>\n              `).join("")}\n            </div>\n          `:""}\n        </div>\n        <div class="panel-content ${"events"===t.id||"event-timeline"===t.id||"order"===t.id?"no-padding":""}">\n          ${t.getContent()}\n        </div>\n      </div>\n    `}static get29NextLogo(){return'\n      <svg class="debug-logo" width="32" height="32" viewBox="0 0 115.4 101.9" fill="none">\n        <defs>\n          <style>\n            .st0 {\n              fill: currentColor;\n              stroke: currentColor;\n              stroke-width: 2.5px;\n            }\n          </style>\n        </defs>\n        <path class="st0" d="M83.5,58.3l-1.9-1.3L27.2,21.2c-.7-.4-1.4-.6-2-.6-2,0-3.6,1.6-3.6,3.6v53.4c0,2,1.6,3.6,3.6,3.6h3.8v12.3h-3.8c-8.8,0-15.8-7.1-15.8-15.8V24.3c0-8.8,7.1-15.8,15.8-15.8,3.1,0,6.2.9,8.7,2.6h0l49,33.4.5.4v13.5ZM90.2,8.4c8.8,0,15.8,7.1,15.8,15.8v53.4c0,8.8-7.1,15.8-15.8,15.8s-6.2-.9-8.7-2.6h0l-49-33.4-.5-.4v-13.5l1.9,1.3,54.3,35.7c.7.4,1.4.7,2,.7,2,0,3.6-1.6,3.6-3.6V24.3c0-2-1.6-3.6-3.6-3.6h-3.8v-12.3h3.8Z"/>\n      </svg>\n    '}static addStyles(){}static removeStyles(){}}const Th=class{static initialize(){"true"===localStorage.getItem(this.STORAGE_KEY)&&this.activate()}static toggle(){return this.isActive?this.deactivate():this.activate(),this.isActive}static activate(){this.isActive||(this.styleElement=document.createElement("style"),this.styleElement.id="debug-xray-styles",this.styleElement.textContent='\n    /* X-RAY WIREFRAME CSS - PURE CSS, NO JS */\n\n    /* Subtle outlines for all data attributes */\n    [data-next-display],\n    [data-next-show],\n    [data-next-checkout],\n    [data-next-selector-id],\n    [data-next-cart-selector],\n    [data-next-selection-mode],\n    [data-next-shipping-id],\n    [data-next-selector-card],\n    [data-next-package-id],\n    [data-next-quantity],\n    [data-next-selected],\n    [data-next-await],\n    [data-next-in-cart],\n    [data-next-express-checkout],\n    [data-next-payment-method],\n    [data-next-checkout-field],\n    [data-next-payment-form] {\n      position: relative !important;\n      outline: 1px dashed rgba(0, 0, 0, 0.3) !important;\n      outline-offset: -1px !important;\n    }\n\n    /* Color coding for different attribute types */\n    [data-next-display] {\n      outline-color: #4ecdc4 !important;\n    }\n\n    [data-next-show] {\n      outline-color: #ffe66d !important;\n    }\n\n    [data-next-checkout] {\n      outline-color: #ff6b6b !important;\n    }\n\n    [data-next-selector-id] {\n      outline-color: #a8e6cf !important;\n    }\n\n    [data-next-selector-card] {\n      outline-color: #95e1d3 !important;\n    }\n\n    [data-next-in-cart] {\n      outline-color: #c7ceea !important;\n    }\n\n    [data-next-selected] {\n      outline-color: #ffa502 !important;\n    }\n\n    [data-next-package-id] {\n      outline-color: #ff8b94 !important;\n    }\n\n    /* Small corner labels */\n    [data-next-selector-id]::before {\n      content: attr(data-next-selector-id) !important;\n      position: absolute !important;\n      top: 2px !important;\n      right: 2px !important;\n      background: rgba(168, 230, 207, 0.9) !important;\n      color: #333 !important;\n      padding: 2px 4px !important;\n      font-size: 9px !important;\n      font-family: monospace !important;\n      line-height: 1 !important;\n      border-radius: 2px !important;\n      pointer-events: none !important;\n      z-index: 10 !important;\n    }\n\n    [data-next-package-id]::before {\n      content: "PKG " attr(data-next-package-id) !important;\n      position: absolute !important;\n      top: 2px !important;\n      left: 2px !important;\n      background: rgba(255, 139, 148, 0.9) !important;\n      color: white !important;\n      padding: 2px 4px !important;\n      font-size: 9px !important;\n      font-family: monospace !important;\n      font-weight: bold !important;\n      line-height: 1 !important;\n      border-radius: 2px !important;\n      pointer-events: none !important;\n      z-index: 10 !important;\n    }\n\n    /* Special highlighting for active states */\n    [data-next-selected="true"] {\n      outline-width: 2px !important;\n      outline-style: solid !important;\n    }\n\n    [data-next-in-cart="true"] {\n      background-color: rgba(199, 206, 234, 0.1) !important;\n    }\n\n    /* Hover tooltips */\n    [data-next-display]:hover::after,\n    [data-next-show]:hover::after,\n    [data-next-selector-card]:hover::after {\n      position: absolute !important;\n      z-index: 99999 !important;\n      pointer-events: none !important;\n      font-family: monospace !important;\n      font-size: 10px !important;\n      padding: 4px 6px !important;\n      border-radius: 3px !important;\n      white-space: nowrap !important;\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;\n      bottom: 100% !important;\n      left: 0 !important;\n      margin-bottom: 4px !important;\n    }\n\n    [data-next-display]:hover::after {\n      content: "display: " attr(data-next-display) !important;\n      background: #4ecdc4 !important;\n      color: white !important;\n    }\n\n    [data-next-show]:hover::after {\n      content: "show: " attr(data-next-show) !important;\n      background: #ffe66d !important;\n      color: #333 !important;\n    }\n\n    [data-next-selector-card]:hover::after {\n      content: "pkg:" attr(data-next-package-id) " | selected:" attr(data-next-selected) " | in-cart:" attr(data-next-in-cart) !important;\n      background: #95e1d3 !important;\n      color: #333 !important;\n    }\n  ',document.head.appendChild(this.styleElement),document.body.classList.add("debug-xray-active"),this.isActive=!0,localStorage.setItem(this.STORAGE_KEY,"true"))}static deactivate(){this.isActive&&(this.styleElement&&(this.styleElement.remove(),this.styleElement=null),document.body.classList.remove("debug-xray-active"),this.isActive=!1,localStorage.setItem(this.STORAGE_KEY,"false"))}static isXrayActive(){return this.isActive}};Th.styleElement=null,Th.isActive=!1,Th.STORAGE_KEY="debug-xray-active";let Ih=Th;class Ah{constructor(){this.container=null,this.shadowRoot=null,this.logger=new Y("CurrencySelector"),this.isChanging=!1,this.listenersAttached=!1,this.renderDebounceTimer=null,this.hasInitiallyRendered=!1}static getInstance(){return Ah.instance||(Ah.instance=new Ah),Ah.instance}initialize(){yt.getState().debug&&(this.createContainer(),this.render(),this.setupEventListeners(),this.setupStoreSubscriptions(),this.logger.info("Currency selector initialized"))}setupStoreSubscriptions(){const t=dt.subscribe((t,e)=>{var i,n;if(this.isChanging)return;const r=(null==(i=t.data)?void 0:i.currency)!==(null==(n=null==e?void 0:e.data)?void 0:n.currency),s=!(null==e?void 0:e.data)&&t.data;(r||s)&&(this.logger.debug("Campaign currency changed or data loaded, re-rendering currency selector"),this.render())});this.zt=t}createContainer(){this.container&&this.container.remove(),this.container=document.createElement("div"),this.container.id="debug-currency-selector",this.container.style.cssText="\n      position: relative;\n      pointer-events: auto;\n    ",this.shadowRoot=this.container.attachShadow({mode:"open"}),document.body.appendChild(this.container)}getAvailableCurrencies(){var t;const e=dt.getState();return(null==(t=e.data)?void 0:t.available_currencies)&&e.data.available_currencies.length>0?e.data.available_currencies:[{code:"USD",label:"$ USD"},{code:"EUR",label:"â‚¬ EUR"},{code:"GBP",label:"Â£ GBP"}]}render(){this.renderDebounceTimer&&clearTimeout(this.renderDebounceTimer),this.renderDebounceTimer=setTimeout(()=>{this.doRender()},50)}doRender(){if(!this.shadowRoot)return;const t=yt.getState(),e=dt.getState(),i=t.selectedCurrency||t.detectedCurrency||"USD",n=this.getAvailableCurrencies();if(!e.data)return this.logger.debug("No campaign data available yet, skipping currency selector render"),void setTimeout(()=>this.doRender(),1e3);if(n.length<=1)return this.logger.debug("Only one currency available, hiding currency selector"),void(this.container&&(this.container.style.display="none"));this.container&&(this.container.style.display="block");const r=t.detectedCurrency;this.shadowRoot.innerHTML=`\n      <style>\n        :host {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n        }\n\n        .currency-selector {\n          background: linear-gradient(135deg, #222 0%, #1a1a1a 100%);\n          backdrop-filter: blur(10px);\n          border: 1px solid #333;\n          border-radius: 4px;\n          padding: 4px 8px;\n          display: inline-flex;\n          align-items: center;\n          gap: 6px;\n          font-size: 11px;\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n          transition: all 0.2s ease;\n        }\n\n        .currency-selector:hover {\n          background: linear-gradient(135deg, #2a2a2a 0%, #222 100%);\n          border-color: #444;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);\n        }\n\n        .currency-label {\n          color: rgba(255, 255, 255, 0.9);\n          font-size: 11px;\n          font-weight: 500;\n          white-space: nowrap;\n        }\n\n        .currency-select {\n          appearance: none;\n          background: #2a2a2a;\n          border: 1px solid rgba(255, 255, 255, 0.2);\n          border-radius: 3px;\n          padding: 2px 20px 2px 6px;\n          font-size: 11px;\n          font-weight: 500;\n          color: rgba(255, 255, 255, 0.9);\n          cursor: pointer;\n          min-width: 60px;\n        }\n\n        .currency-select option {\n          background: #2a2a2a;\n          color: rgba(255, 255, 255, 0.9);\n          padding: 4px;\n        }\n\n        .currency-select:hover {\n          background: #333;\n          border-color: rgba(255, 255, 255, 0.3);\n        }\n\n        .currency-select:focus {\n          outline: none;\n          border-color: #4299e1;\n          background: #333;\n        }\n\n        .currency-select:disabled {\n          opacity: 0.5;\n          cursor: not-allowed;\n        }\n\n        .select-wrapper {\n          position: relative;\n          display: flex;\n          align-items: center;\n        }\n\n        .select-arrow {\n          position: absolute;\n          right: 4px;\n          top: 50%;\n          transform: translateY(-50%);\n          pointer-events: none;\n          color: rgba(255, 255, 255, 0.6);\n          width: 10px;\n          height: 10px;\n        }\n\n        .loading-indicator {\n          display: none;\n          width: 10px;\n          height: 10px;\n          border: 1px solid #cbd5e0;\n          border-top-color: #4299e1;\n          border-radius: 50%;\n          animation: spin 0.8s linear infinite;\n        }\n\n        .loading-indicator.active {\n          display: inline-block;\n        }\n\n        @keyframes spin {\n          to { transform: rotate(360deg); }\n        }\n\n        .detected-info {\n          color: rgba(255, 255, 255, 0.5);\n          font-size: 10px;\n          font-weight: 400;\n          white-space: nowrap;\n          padding-left: 6px;\n          border-left: 1px solid rgba(255, 255, 255, 0.2);\n        }\n\n        .detected-value {\n          color: rgba(255, 255, 255, 0.8);\n          font-weight: 500;\n        }\n      </style>\n\n      <div class="currency-selector">\n        <span class="currency-label">ðŸ’±</span>\n        \n        <div class="select-wrapper">\n          <select class="currency-select" id="currency-select">\n            ${n.map(t=>`\n              <option value="${t.code}" ${t.code===i?"selected":""}>\n                ${t.code}\n              </option>\n            `).join("")}\n          </select>\n          <svg class="select-arrow" viewBox="0 0 24 24" fill="currentColor">\n            <path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"/>\n          </svg>\n        </div>\n\n        <div class="loading-indicator" id="loading-indicator"></div>\n\n        ${r?`\n          <div class="detected-info">\n            Detected: <span class="detected-value">${r}</span>\n          </div>\n        `:""}\n      </div>\n    `,this.hasInitiallyRendered||(this.hasInitiallyRendered=!0)}setupEventListeners(){this.shadowRoot&&!this.listenersAttached&&(this.shadowRoot.addEventListener("change",t=>g(this,null,function*(){const e=t.target;if(e&&"currency-select"===e.id){const t=e.value;if(this.isChanging)return void this.logger.warn("Currency change already in progress");this.logger.debug(`Currency select changed to: ${t}`),yield this.handleCurrencyChange(t)}})),document.addEventListener("next:currency-changed",t=>{var e;"currency-selector"!==(null==(e=t.detail)?void 0:e.source)&&(clearTimeout(this.qt),this.qt=setTimeout(()=>{this.logger.debug("External currency change detected, re-rendering selector"),this.render()},100))}),this.listenersAttached=!0,this.logger.debug("Event listeners attached to currency selector"))}handleCurrencyChange(t){return g(this,null,function*(){var e,i;this.isChanging=!0;const n=null==(e=this.shadowRoot)?void 0:e.getElementById("currency-select"),r=null==(i=this.shadowRoot)?void 0:i.getElementById("loading-indicator");n&&(n.disabled=!0),r&&r.classList.add("active");try{this.logger.info(`Changing currency to ${t}`);const e=yt.getState(),i=dt.getState(),n=Tt.getState(),r=e.selectedCurrency||e.detectedCurrency||"USD";e.updateConfig({selectedCurrency:t}),sessionStorage.setItem("next_selected_currency",t),this.logger.info(`Saved currency preference to session: ${t}`),yield i.loadCampaign(e.apiKey),yield n.refreshItemPrices(),this.logger.info(`Currency changed successfully to ${t}`),document.dispatchEvent(new CustomEvent("next:currency-changed",{detail:{from:r,to:t,source:"currency-selector"}})),document.dispatchEvent(new CustomEvent("debug:update-content")),this.showSuccessFeedback(t)}catch(s){this.logger.error("Failed to change currency:",s),this.showErrorFeedback();const t=yt.getState().selectedCurrency||"USD";n&&(n.value=t)}finally{this.isChanging=!1,n&&(n.disabled=!1),r&&r.classList.remove("active")}})}showSuccessFeedback(t){var e;const i=null==(e=this.shadowRoot)?void 0:e.querySelector(".currency-selector");i&&(i.style.background="linear-gradient(135deg, #10b981 0%, #059669 100%)",setTimeout(()=>{i.style.background="linear-gradient(135deg, #222 0%, #1a1a1a 100%)"},1e3))}showErrorFeedback(){var t;const e=null==(t=this.shadowRoot)?void 0:t.querySelector(".currency-selector");e&&(e.style.background="linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",setTimeout(()=>{e.style.background="linear-gradient(135deg, #222 0%, #1a1a1a 100%)"},1e3))}destroy(){this.zt&&(this.zt(),this.zt=null),this.renderDebounceTimer&&clearTimeout(this.renderDebounceTimer),this.qt&&clearTimeout(this.qt),this.container&&(this.container.remove(),this.container=null,this.shadowRoot=null)}hide(){this.container&&(this.container.style.display="none")}show(){this.container&&(this.container.style.display="block")}}const Mh=Ah.getInstance();class Lh{constructor(){this.container=null,this.shadowRoot=null,this.logger=new Y("CountrySelector"),this.isChanging=!1,this.listenersAttached=!1,this.renderDebounceTimer=null,this.hasInitiallyRendered=!1,this.countries=[]}static getInstance(){return Lh.instance||(Lh.instance=new Lh),Lh.instance}initialize(){return g(this,null,function*(){yt.getState().debug&&(yield this.loadCountries(),this.createContainer(),this.render(),this.setupEventListeners(),this.logger.info("Country selector initialized"))})}loadCountries(){return g(this,null,function*(){try{const t=pe.getInstance(),e=yield t.getLocationData();this.countries=e.countries||[],this.logger.debug(`Loaded ${this.countries.length} countries`)}catch(t){this.logger.error("Failed to load countries:",t),this.countries=[]}})}createContainer(){this.container&&this.container.remove(),this.container=document.createElement("div"),this.container.id="debug-country-selector",this.container.style.cssText="\n      position: relative;\n      pointer-events: auto;\n    ",this.shadowRoot=this.container.attachShadow({mode:"open"}),document.body.appendChild(this.container)}render(){this.renderDebounceTimer&&clearTimeout(this.renderDebounceTimer),this.renderDebounceTimer=setTimeout(()=>{this.doRender()},50)}doRender(){if(!this.shadowRoot)return;const t=yt.getState(),e=t.detectedCountry||"US",i=sessionStorage.getItem("next_selected_country")||e;if(0===this.countries.length)return this.logger.debug("No countries available, hiding country selector"),void(this.container&&(this.container.style.display="none"));this.container&&(this.container.style.display="block");const n=t.detectedCountry;this.shadowRoot.innerHTML=`\n      <style>\n        :host {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n        }\n\n        .country-selector {\n          background: linear-gradient(135deg, #222 0%, #1a1a1a 100%);\n          backdrop-filter: blur(10px);\n          border: 1px solid #333;\n          border-radius: 4px;\n          padding: 4px 8px;\n          display: inline-flex;\n          align-items: center;\n          gap: 6px;\n          font-size: 11px;\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n          transition: all 0.2s ease;\n        }\n\n        .country-selector:hover {\n          background: linear-gradient(135deg, #2a2a2a 0%, #222 100%);\n          border-color: #444;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);\n        }\n\n        .country-label {\n          color: rgba(255, 255, 255, 0.9);\n          font-size: 11px;\n          font-weight: 500;\n          white-space: nowrap;\n        }\n\n        .country-select {\n          appearance: none;\n          background: #2a2a2a;\n          border: 1px solid rgba(255, 255, 255, 0.2);\n          border-radius: 3px;\n          padding: 2px 20px 2px 6px;\n          font-size: 11px;\n          font-weight: 500;\n          color: rgba(255, 255, 255, 0.9);\n          cursor: pointer;\n          min-width: 80px;\n          max-width: 120px;\n        }\n\n        .country-select option {\n          background: #2a2a2a;\n          color: rgba(255, 255, 255, 0.9);\n          padding: 4px;\n        }\n\n        .country-select:hover {\n          background: #333;\n          border-color: rgba(255, 255, 255, 0.3);\n        }\n\n        .country-select:focus {\n          outline: none;\n          border-color: #4299e1;\n          background: #333;\n        }\n\n        .country-select:disabled {\n          opacity: 0.5;\n          cursor: not-allowed;\n        }\n\n        .select-wrapper {\n          position: relative;\n          display: flex;\n          align-items: center;\n        }\n\n        .select-arrow {\n          position: absolute;\n          right: 4px;\n          top: 50%;\n          transform: translateY(-50%);\n          pointer-events: none;\n          color: rgba(255, 255, 255, 0.6);\n          width: 10px;\n          height: 10px;\n        }\n\n        .loading-indicator {\n          display: none;\n          width: 10px;\n          height: 10px;\n          border: 1px solid #cbd5e0;\n          border-top-color: #4299e1;\n          border-radius: 50%;\n          animation: spin 0.8s linear infinite;\n        }\n\n        .loading-indicator.active {\n          display: inline-block;\n        }\n\n        @keyframes spin {\n          to { transform: rotate(360deg); }\n        }\n\n        .reset-button {\n          background: rgba(239, 68, 68, 0.2);\n          border: 1px solid rgba(239, 68, 68, 0.3);\n          border-radius: 3px;\n          color: #ff6b6b;\n          padding: 2px 6px;\n          font-size: 10px;\n          font-weight: 500;\n          cursor: pointer;\n          transition: all 0.2s ease;\n        }\n\n        .reset-button:hover {\n          background: rgba(239, 68, 68, 0.3);\n          border-color: rgba(239, 68, 68, 0.4);\n          color: #ff8787;\n        }\n\n        .detected-info {\n          color: rgba(255, 255, 255, 0.5);\n          font-size: 10px;\n          font-weight: 400;\n          white-space: nowrap;\n          padding-left: 6px;\n          border-left: 1px solid rgba(255, 255, 255, 0.2);\n        }\n\n        .detected-value {\n          color: rgba(255, 255, 255, 0.8);\n          font-weight: 500;\n        }\n      </style>\n\n      <div class="country-selector">\n        <span class="country-label">ðŸŒ</span>\n        \n        <div class="select-wrapper">\n          <select class="country-select" id="country-select">\n            ${this.countries.map(t=>`\n              <option value="${t.code}" ${t.code===i?"selected":""}>\n                ${t.name.length>15?t.name.substring(0,15)+"...":t.name}\n              </option>\n            `).join("")}\n          </select>\n          <svg class="select-arrow" viewBox="0 0 24 24" fill="currentColor">\n            <path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"/>\n          </svg>\n        </div>\n\n        <div class="loading-indicator" id="loading-indicator"></div>\n\n        ${n!==i?`\n          <button class="reset-button" id="reset-button" title="Reset to detected country: ${n}">\n            Reset\n          </button>\n        `:""}\n\n        ${n?`\n          <div class="detected-info">\n            Detected: <span class="detected-value">${n}</span>\n          </div>\n        `:""}\n      </div>\n    `,this.hasInitiallyRendered||(this.hasInitiallyRendered=!0)}setupEventListeners(){this.shadowRoot&&!this.listenersAttached&&(this.shadowRoot.addEventListener("change",t=>g(this,null,function*(){const e=t.target;if(e&&"country-select"===e.id){const t=e.value;if(this.isChanging)return void this.logger.warn("Country change already in progress");this.logger.debug(`Country select changed to: ${t}`),yield this.handleCountryChange(t)}})),this.shadowRoot.addEventListener("click",t=>g(this,null,function*(){const e=t.target;if(e&&"reset-button"===e.id){const t=yt.getState().detectedCountry||"US";this.logger.debug("Resetting to detected country:",t),yield this.handleCountryChange(t,!0)}})),document.addEventListener("next:country-changed",()=>{this.logger.debug("External country change detected, re-rendering selector"),this.render()}),this.listenersAttached=!0,this.logger.debug("Event listeners attached to country selector"))}handleCountryChange(t,e=!1){return g(this,null,function*(){var i,n;this.isChanging=!0;const r=null==(i=this.shadowRoot)?void 0:i.getElementById("country-select"),s=null==(n=this.shadowRoot)?void 0:n.getElementById("loading-indicator");r&&(r.disabled=!0),s&&s.classList.add("active");try{this.logger.info(`Changing country to ${t}`);const i=yt.getState(),n=dt.getState(),r=Tt.getState(),s=pe.getInstance(),a=sessionStorage.getItem("next_selected_country")||i.detectedCountry||"US";e?(sessionStorage.removeItem("next_selected_country"),this.logger.info("Cleared selected country override, using detected country")):(sessionStorage.setItem("next_selected_country",t),this.logger.info(`Saved selected country to session: ${t}`));const o=yield s.getCountryConfig(t),c=yield s.getCountryStates(t);i.updateConfig({locationData:{detectedCountryCode:t,detectedCountryConfig:o,detectedStates:c.states,detectedStateCode:"",detectedCity:"",countries:this.countries}}),o.currencyCode&&o.currencyCode!==i.selectedCurrency&&(this.logger.info(`Country currency is ${o.currencyCode}, updating...`),i.updateConfig({selectedCurrency:o.currencyCode}),sessionStorage.setItem("next_selected_currency",o.currencyCode),yield n.loadCampaign(i.apiKey),yield r.refreshItemPrices(),document.dispatchEvent(new CustomEvent("next:currency-changed",{detail:{from:i.selectedCurrency,to:o.currencyCode,source:"country-selector"}}))),this.logger.info(`Country changed successfully to ${t}`),document.dispatchEvent(new CustomEvent("next:country-changed",{detail:{from:a,to:t,currency:o.currencyCode}})),document.dispatchEvent(new CustomEvent("debug:update-content")),this.showSuccessFeedback(t),this.render()}catch(a){this.logger.error("Failed to change country:",a),this.showErrorFeedback();const t=sessionStorage.getItem("next_selected_country")||yt.getState().detectedCountry||"US";r&&(r.value=t)}finally{this.isChanging=!1,r&&(r.disabled=!1),s&&s.classList.remove("active")}})}showSuccessFeedback(t){var e;const i=null==(e=this.shadowRoot)?void 0:e.querySelector(".country-selector");i&&(i.style.background="linear-gradient(135deg, #10b981 0%, #059669 100%)",setTimeout(()=>{i.style.background="linear-gradient(135deg, #222 0%, #1a1a1a 100%)"},1e3))}showErrorFeedback(){var t;const e=null==(t=this.shadowRoot)?void 0:t.querySelector(".country-selector");e&&(e.style.background="linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",setTimeout(()=>{e.style.background="linear-gradient(135deg, #222 0%, #1a1a1a 100%)"},1e3))}destroy(){this.renderDebounceTimer&&clearTimeout(this.renderDebounceTimer),this.container&&(this.container.remove(),this.container=null,this.shadowRoot=null)}hide(){this.container&&(this.container.style.display="none")}show(){this.container&&(this.container.style.display="block")}}const Dh=Lh.getInstance();class Fh{constructor(){this.container=null,this.shadowRoot=null,this.logger=new Y("LocaleSelector"),this.isChanging=!1,this.listenersAttached=!1,this.renderDebounceTimer=null,this.hasInitiallyRendered=!1,this.locales=[{code:"en-US",name:"English (US)",flag:"ðŸ‡ºðŸ‡¸"},{code:"en-GB",name:"English (UK)",flag:"ðŸ‡¬ðŸ‡§"},{code:"en-CA",name:"English (CA)",flag:"ðŸ‡¨ðŸ‡¦"},{code:"en-AU",name:"English (AU)",flag:"ðŸ‡¦ðŸ‡º"},{code:"pt-BR",name:"PortuguÃªs (BR)",flag:"ðŸ‡§ðŸ‡·"},{code:"es-ES",name:"EspaÃ±ol (ES)",flag:"ðŸ‡ªðŸ‡¸"},{code:"es-MX",name:"EspaÃ±ol (MX)",flag:"ðŸ‡²ðŸ‡½"},{code:"fr-FR",name:"FranÃ§ais",flag:"ðŸ‡«ðŸ‡·"},{code:"de-DE",name:"Deutsch",flag:"ðŸ‡©ðŸ‡ª"},{code:"it-IT",name:"Italiano",flag:"ðŸ‡®ðŸ‡¹"},{code:"ja-JP",name:"æ—¥æœ¬èªž",flag:"ðŸ‡¯ðŸ‡µ"},{code:"zh-CN",name:"ä¸­æ–‡",flag:"ðŸ‡¨ðŸ‡³"},{code:"ko-KR",name:"í•œêµ­ì–´",flag:"ðŸ‡°ðŸ‡·"},{code:"ru-RU",name:"Ð ÑƒÑÑÐºÐ¸Ð¹",flag:"ðŸ‡·ðŸ‡º"},{code:"ar-SA",name:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",flag:"ðŸ‡¸ðŸ‡¦"},{code:"hi-IN",name:"à¤¹à¤¿à¤¨à¥à¤¦à¥€",flag:"ðŸ‡®ðŸ‡³"},{code:"nl-NL",name:"Nederlands",flag:"ðŸ‡³ðŸ‡±"},{code:"sv-SE",name:"Svenska",flag:"ðŸ‡¸ðŸ‡ª"},{code:"pl-PL",name:"Polski",flag:"ðŸ‡µðŸ‡±"},{code:"tr-TR",name:"TÃ¼rkÃ§e",flag:"ðŸ‡¹ðŸ‡·"}]}static getInstance(){return Fh.instance||(Fh.instance=new Fh),Fh.instance}initialize(){this.createContainer(),this.render(),this.setupEventListeners(),this.logger.info("Locale selector initialized")}createContainer(){this.container&&this.container.remove(),this.container=document.createElement("div"),this.container.id="debug-locale-selector",this.container.style.cssText="\n      position: relative;\n      pointer-events: auto;\n    ",this.shadowRoot=this.container.attachShadow({mode:"open"}),document.body.appendChild(this.container)}getCurrentLocale(){return sessionStorage.getItem("next_selected_locale")||navigator.language||"en-US"}render(){this.renderDebounceTimer&&clearTimeout(this.renderDebounceTimer),this.renderDebounceTimer=setTimeout(()=>{this.doRender()},50)}doRender(){if(!this.shadowRoot)return;const t=this.getCurrentLocale(),e=navigator.language||"en-US";this.container&&(this.container.style.display="block"),this.shadowRoot.innerHTML=`\n      <style>\n        :host {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n        }\n\n        .locale-selector {\n          background: linear-gradient(135deg, #222 0%, #1a1a1a 100%);\n          backdrop-filter: blur(10px);\n          border: 1px solid #333;\n          border-radius: 4px;\n          padding: 4px 8px;\n          display: inline-flex;\n          align-items: center;\n          gap: 6px;\n          font-size: 11px;\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n          transition: all 0.2s ease;\n        }\n\n        .locale-selector:hover {\n          background: linear-gradient(135deg, #2a2a2a 0%, #222 100%);\n          border-color: #444;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);\n        }\n\n        .locale-label {\n          color: rgba(255, 255, 255, 0.9);\n          font-size: 11px;\n          font-weight: 500;\n          white-space: nowrap;\n        }\n\n        .locale-select {\n          appearance: none;\n          background: #2a2a2a;\n          border: 1px solid rgba(255, 255, 255, 0.2);\n          border-radius: 3px;\n          padding: 2px 20px 2px 6px;\n          font-size: 11px;\n          font-weight: 500;\n          color: rgba(255, 255, 255, 0.9);\n          cursor: pointer;\n          min-width: 100px;\n          max-width: 140px;\n        }\n\n        .locale-select option {\n          background: #2a2a2a;\n          color: rgba(255, 255, 255, 0.9);\n          padding: 4px;\n        }\n\n        .locale-select:hover {\n          background: #333;\n          border-color: rgba(255, 255, 255, 0.3);\n        }\n\n        .locale-select:focus {\n          outline: none;\n          border-color: #4299e1;\n          background: #333;\n        }\n\n        .locale-select:disabled {\n          opacity: 0.5;\n          cursor: not-allowed;\n        }\n\n        .select-wrapper {\n          position: relative;\n          display: flex;\n          align-items: center;\n        }\n\n        .select-arrow {\n          position: absolute;\n          right: 4px;\n          top: 50%;\n          transform: translateY(-50%);\n          pointer-events: none;\n          color: rgba(255, 255, 255, 0.6);\n          width: 10px;\n          height: 10px;\n        }\n\n        .loading-indicator {\n          display: none;\n          width: 10px;\n          height: 10px;\n          border: 1px solid #cbd5e0;\n          border-top-color: #4299e1;\n          border-radius: 50%;\n          animation: spin 0.8s linear infinite;\n        }\n\n        .loading-indicator.active {\n          display: inline-block;\n        }\n\n        @keyframes spin {\n          to { transform: rotate(360deg); }\n        }\n\n        .reset-button {\n          background: rgba(239, 68, 68, 0.2);\n          border: 1px solid rgba(239, 68, 68, 0.3);\n          border-radius: 3px;\n          color: #ff6b6b;\n          padding: 2px 6px;\n          font-size: 10px;\n          font-weight: 500;\n          cursor: pointer;\n          transition: all 0.2s ease;\n        }\n\n        .reset-button:hover {\n          background: rgba(239, 68, 68, 0.3);\n          border-color: rgba(239, 68, 68, 0.4);\n          color: #ff8787;\n        }\n\n        .detected-info {\n          color: rgba(255, 255, 255, 0.5);\n          font-size: 10px;\n          font-weight: 400;\n          white-space: nowrap;\n          padding-left: 6px;\n          border-left: 1px solid rgba(255, 255, 255, 0.2);\n        }\n\n        .detected-value {\n          color: rgba(255, 255, 255, 0.8);\n          font-weight: 500;\n        }\n      </style>\n\n      <div class="locale-selector">\n        <span class="locale-label">ðŸŒ</span>\n        \n        <div class="select-wrapper">\n          <select class="locale-select" id="locale-select">\n            ${this.locales.map(e=>`\n              <option value="${e.code}" ${e.code===t?"selected":""}>\n                ${e.flag} ${e.code}\n              </option>\n            `).join("")}\n          </select>\n          <svg class="select-arrow" viewBox="0 0 24 24" fill="currentColor">\n            <path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"/>\n          </svg>\n        </div>\n\n        <div class="loading-indicator" id="loading-indicator"></div>\n\n        ${e!==t?`\n          <button class="reset-button" id="reset-button" title="Reset to browser locale: ${e}">\n            Reset\n          </button>\n        `:""}\n\n        <div class="detected-info">\n          Browser: <span class="detected-value">${e}</span>\n        </div>\n      </div>\n    `,this.hasInitiallyRendered||(this.hasInitiallyRendered=!0)}setupEventListeners(){this.shadowRoot&&!this.listenersAttached&&(this.shadowRoot.addEventListener("change",t=>g(this,null,function*(){const e=t.target;if(e&&"locale-select"===e.id){const t=e.value;if(this.isChanging)return void this.logger.warn("Locale change already in progress");this.logger.debug(`Locale select changed to: ${t}`),yield this.handleLocaleChange(t)}})),this.shadowRoot.addEventListener("click",t=>g(this,null,function*(){const e=t.target;if(e&&"reset-button"===e.id){const t=navigator.language||"en-US";this.logger.debug("Resetting to browser locale:",t),yield this.handleLocaleChange(t,!0)}})),document.addEventListener("next:locale-changed",()=>{this.logger.debug("External locale change detected, re-rendering selector"),this.render()}),this.listenersAttached=!0,this.logger.debug("Event listeners attached to locale selector"))}handleLocaleChange(t,e=!1){return g(this,null,function*(){var i,n;this.isChanging=!0;const r=null==(i=this.shadowRoot)?void 0:i.getElementById("locale-select"),s=null==(n=this.shadowRoot)?void 0:n.getElementById("loading-indicator");r&&(r.disabled=!0),s&&s.classList.add("active");try{this.logger.info(`Changing locale to ${t}`);const i=this.getCurrentLocale();e?(sessionStorage.removeItem("next_selected_locale"),this.logger.info("Cleared selected locale override, using browser locale")):(sessionStorage.setItem("next_selected_locale",t),this.logger.info(`Saved selected locale to session: ${t}`));const{CurrencyFormatter:n}=yield Promise.resolve().then(()=>Ct);n.clearCache();const{useCartStore:r}=yield Promise.resolve().then(()=>It),s=r.getState();yield s.calculateTotals(),document.dispatchEvent(new CustomEvent("next:locale-changed",{detail:{from:i,to:t,source:"locale-selector"}})),document.dispatchEvent(new CustomEvent("debug:update-content")),document.dispatchEvent(new CustomEvent("next:display-refresh")),this.refreshAllCurrencyDisplays(),this.showSuccessFeedback(t),this.render(),this.logFormatExamples(t)}catch(a){this.logger.error("Failed to change locale:",a),this.showErrorFeedback();const t=this.getCurrentLocale();r&&(r.value=t)}finally{this.isChanging=!1,r&&(r.disabled=!1),s&&s.classList.remove("active")}})}refreshAllCurrencyDisplays(){const t=document.querySelectorAll("[data-next-display]");t.forEach(t=>{const e=t.getAttribute("data-next-display");((null==e?void 0:e.includes("price"))||(null==e?void 0:e.includes("total"))||(null==e?void 0:e.includes("subtotal"))||(null==e?void 0:e.includes("cost"))||(null==e?void 0:e.includes("amount")))&&t.dispatchEvent(new CustomEvent("next:refresh-display",{bubbles:!0}))});const e=document.querySelectorAll('.next-price, .next-total, .next-subtotal, .next-amount, [class*="price"], [class*="total"], [class*="amount"]');e.forEach(t=>{const e=t.textContent||"";(/[$Â£â‚¬Â¥â‚¹â‚½Â¢]/u.test(e)||/\d+[.,]\d{2}/.test(e))&&t.dispatchEvent(new CustomEvent("next:refresh-display",{bubbles:!0}))}),this.logger.debug(`Refreshed ${t.length+e.length} potential currency displays`)}logFormatExamples(t){new Intl.NumberFormat(t,{style:"currency",currency:"USD",currencyDisplay:"narrowSymbol"}),new Intl.DateTimeFormat(t,{year:"numeric",month:"long",day:"numeric"}),new Intl.NumberFormat(t)}showSuccessFeedback(t){var e;const i=null==(e=this.shadowRoot)?void 0:e.querySelector(".locale-selector");i&&(i.style.background="linear-gradient(135deg, #10b981 0%, #059669 100%)",setTimeout(()=>{i.style.background="linear-gradient(135deg, #222 0%, #1a1a1a 100%)"},1e3))}showErrorFeedback(){var t;const e=null==(t=this.shadowRoot)?void 0:t.querySelector(".locale-selector");e&&(e.style.background="linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",setTimeout(()=>{e.style.background="linear-gradient(135deg, #222 0%, #1a1a1a 100%)"},1e3))}destroy(){this.renderDebounceTimer&&clearTimeout(this.renderDebounceTimer),this.container&&(this.container.remove(),this.container=null,this.shadowRoot=null)}hide(){this.container&&(this.container.style.display="none")}show(){this.container&&(this.container.style.display="block")}}const Oh=Fh.getInstance();class Uh{constructor(){this.container=null,this.setupPanelListener()}static getInstance(){return Uh.instance||(Uh.instance=new Uh),Uh.instance}initialize(){this.createContainer(),Mh.initialize(),Dh.initialize(),Oh.initialize(),this.moveSelectorsToContainer()}createContainer(){this.container&&this.container.remove(),this.container=document.createElement("div"),this.container.id="debug-selectors-container",this.container.style.cssText="\n      position: fixed;\n      bottom: 70px;\n      right: 20px;\n      display: flex;\n      gap: 10px;\n      align-items: center;\n      z-index: 999998;\n      pointer-events: auto;\n      transition: bottom 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    ",document.body.appendChild(this.container)}moveSelectorsToContainer(){this.container&&setTimeout(()=>{const t=document.getElementById("debug-currency-selector"),e=document.getElementById("debug-country-selector"),i=document.getElementById("debug-locale-selector");t&&(t.style.position="relative",t.style.bottom="auto",t.style.left="auto",t.style.transform="none",this.container.appendChild(t)),e&&(e.style.position="relative",e.style.bottom="auto",e.style.left="auto",e.style.transform="none",this.container.appendChild(e)),i&&(i.style.position="relative",i.style.bottom="auto",i.style.left="auto",i.style.transform="none",this.container.appendChild(i))},100)}setupPanelListener(){setTimeout(()=>{const t=document.getElementById("next-debug-overlay-host");if(t&&t.shadowRoot){const e=t.shadowRoot.querySelector(".enhanced-debug-overlay");if(e){new MutationObserver(t=>{t.forEach(t=>{if("attributes"===t.type&&"class"===t.attributeName){const e=t.target;if(e.classList.contains("enhanced-debug-overlay")){const t=e.classList.contains("expanded");this.updatePosition(t)}}})}).observe(e,{attributes:!0,attributeFilter:["class"]});const t=e.classList.contains("expanded");this.updatePosition(t)}}},500),document.addEventListener("debug:panel-toggled",t=>{var e;this.updatePosition((null==(e=t.detail)?void 0:e.isExpanded)||!1)})}updatePosition(t){this.container&&(this.container.style.bottom=t?"calc(max(40vh, 450px) + 10px)":"70px")}destroy(){this.container&&(this.container.remove(),this.container=null)}}const Nh=Uh.getInstance();class zh{static generateRawDataContent(t){const e=JSON.stringify(t,null,2),i=`copy-btn-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return`\n      <style>\n        .raw-data-wrapper {\n          position: relative;\n          height: auto;\n          background: #0f0f0f;\n        }\n        .copy-button-fixed {\n          position: sticky;\n          top: 12px;\n          float: right;\n          margin: 12px;\n          background: rgba(60, 125, 255, 0.9);\n          border: none;\n          color: white;\n          padding: 8px 16px;\n          border-radius: 6px;\n          cursor: pointer;\n          font-size: 12px;\n          font-weight: 600;\n          transition: all 0.2s ease;\n          z-index: 100;\n          display: inline-flex;\n          align-items: center;\n          gap: 6px;\n          backdrop-filter: blur(10px);\n        }\n        .copy-button-fixed:hover {\n          background: rgba(60, 125, 255, 1);\n          transform: translateY(-1px);\n          box-shadow: 0 4px 12px rgba(60, 125, 255, 0.3);\n        }\n        .copy-button-fixed:active {\n          transform: translateY(0);\n        }\n        .copy-button-fixed.copied {\n          background: rgba(76, 175, 80, 0.9);\n        }\n        .copy-button-fixed.copied:hover {\n          background: rgba(76, 175, 80, 1);\n        }\n        .json-content {\n          padding: 20px;\n          padding-top: 1rem;\n          font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;\n          font-size: 12px;\n          line-height: 1.6;\n          color: #e6e6e6;\n          white-space: pre;\n          word-break: break-all;\n        }\n      </style>\n      <div class="raw-data-wrapper">\n        <button id="${i}" class="copy-button-fixed" onclick="\n          (function() {\n            const btn = document.getElementById('${i}');\n            const dataToCopy = ${JSON.stringify(e).replace(/"/g,"&quot;").replace(/'/g,"\\'")};\n            navigator.clipboard.writeText(dataToCopy).then(() => {\n              btn.innerHTML = '<svg width=\\'14\\' height=\\'14\\' viewBox=\\'0 0 24 24\\' fill=\\'currentColor\\'><path d=\\'M9,5H7A2,2 0 0,0 5,7V21A2,2 0 0,0 7,23H17A2,2 0 0,0 19,21V7A2,2 0 0,0 17,5H15M12,2L14,5H10L12,2M10,18L7,15L8.41,13.59L10,15.17L15.59,9.59L17,11L10,18Z\\'/></svg> Copied!';\n              btn.classList.add('copied');\n              setTimeout(() => {\n                btn.innerHTML = '<svg width=\\'14\\' height=\\'14\\' viewBox=\\'0 0 24 24\\' fill=\\'currentColor\\'><path d=\\'M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\\'/></svg> Copy';\n                btn.classList.remove('copied');\n              }, 2000);\n            }).catch(err => {\n              console.error('Failed to copy:', err);\n            });\n          })();\n        ">\n          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">\n            <path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>\n          </svg>\n          Copy\n        </button>\n        <div class="json-content">${e}</div>\n      </div>\n    `}}class qh{constructor(){this.id="cart",this.title="Cart State",this.icon="ðŸ›’"}getContent(){var t;return(null==(t=this.getTabs()[0])?void 0:t.getContent())||""}getTabs(){return[{id:"overview",label:"Overview",icon:"ðŸ“Š",getContent:()=>this.getOverviewContent()},{id:"items",label:"Items",icon:"ðŸ“¦",getContent:()=>this.getItemsContent()},{id:"raw",label:"Raw Data",icon:"ðŸ”§",getContent:()=>this.getRawDataContent()}]}getOverviewContent(){const t=Tt.getState();return`\n      <div class="enhanced-panel">\n        <div class="metrics-grid">\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ“¦</div>\n            <div class="metric-content">\n              <div class="metric-value">${t.items.length}</div>\n              <div class="metric-label">Unique Items</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ”¢</div>\n            <div class="metric-content">\n              <div class="metric-value">${t.totalQuantity}</div>\n              <div class="metric-label">Total Quantity</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ’°</div>\n            <div class="metric-content">\n              <div class="metric-value">${t.totals.subtotal.formatted}</div>\n              <div class="metric-label">Subtotal</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸšš</div>\n            <div class="metric-content">\n              <div class="metric-value">${t.totals.shipping.formatted}</div>\n              <div class="metric-label">Shipping</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ“Š</div>\n            <div class="metric-content">\n              <div class="metric-value">${t.totals.tax.formatted}</div>\n              <div class="metric-label">Tax</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ’³</div>\n            <div class="metric-content">\n              <div class="metric-value">${t.totals.total.formatted}</div>\n              <div class="metric-label">Total</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}getItemsContent(){const t=Tt.getState();return`\n      <div class="enhanced-panel">\n        <div class="section">\n          ${0===t.items.length?'\n            <div class="empty-state">\n              <div class="empty-icon">ðŸ›’</div>\n              <div class="empty-text">Cart is empty</div>\n              <button class="empty-action" onclick="window.nextDebug.addTestItems()">Add Test Items</button>\n            </div>\n          ':`\n            <div class="cart-items-list">\n              ${t.items.map(t=>`\n                <div class="cart-item-card">\n                  <div class="item-info">\n                    <div class="item-title">${t.title}</div>\n                    <div class="item-details">\n                      Package ID: ${t.packageId} â€¢ Price: $${t.price}\n                    </div>\n                  </div>\n                  <div class="item-quantity">\n                    <button onclick="window.nextDebug.updateQuantity(${t.packageId}, ${t.quantity-1})" \n                            class="qty-btn">-</button>\n                    <span class="qty-value">${t.quantity}</span>\n                    <button onclick="window.nextDebug.updateQuantity(${t.packageId}, ${t.quantity+1})" \n                            class="qty-btn">+</button>\n                  </div>\n                  <div class="item-total">$${(t.price*t.quantity).toFixed(2)}</div>\n                  <button onclick="window.nextDebug.removeItem(${t.packageId})" \n                          class="remove-btn">Ã—</button>\n                </div>\n              `).join("")}\n            </div>\n          `}\n        </div>\n      </div>\n    `}getRawDataContent(){const t=Tt.getState();return zh.generateRawDataContent(t)}getActions(){return[{label:"Clear Cart",action:()=>Tt.getState().clear(),variant:"danger"},{label:"Add Test Items",action:this.addTestItems,variant:"secondary"},{label:"Recalculate",action:()=>Tt.getState().calculateTotals(),variant:"primary"},{label:"Export Cart",action:this.exportCart,variant:"secondary"}]}addTestItems(){const t=Tt.getState();[{packageId:999,quantity:1,price:19.99,title:"Debug Test Item 1",isUpsell:!1},{packageId:998,quantity:2,price:29.99,title:"Debug Test Item 2",isUpsell:!1},{packageId:997,quantity:1,price:9.99,title:"Debug Test Item 3",isUpsell:!1}].forEach(e=>t.addItem(e))}exportCart(){const t=Tt.getState(),e=JSON.stringify(t,null,2),i=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(i),r=document.createElement("a");r.href=n,r.download=`cart-state-${(new Date).toISOString()}.json`,r.click(),URL.revokeObjectURL(n)}}class jh{constructor(){this.id="order",this.title="Order State",this.icon="ðŸ“¦"}getContent(){var t;return(null==(t=this.getTabs()[0])?void 0:t.getContent())||""}getTabs(){return[{id:"overview",label:"Overview",icon:"ðŸ“Š",getContent:()=>this.getOverviewContent()},{id:"lines",label:"Order Lines",icon:"ðŸ“‹",getContent:()=>this.getOrderLinesContent()},{id:"addresses",label:"Addresses",icon:"ðŸ“",getContent:()=>this.getAddressesContent()},{id:"raw",label:"Raw Data",icon:"ðŸ”§",getContent:()=>this.getRawDataContent()}]}getOverviewContent(){var t,e;const i=Ot.getState(),n=i.order;if(!n)return this.getEmptyState();const r=i.getOrderTotal(),s=i.canAddUpsells(),a=n.currency||"USD",o=this.getCurrencySymbol(a);return`\n      <div class="enhanced-panel">\n        <div class="metrics-grid">\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ”–</div>\n            <div class="metric-content">\n              <div class="metric-value">${n.number||"N/A"}</div>\n              <div class="metric-label">Order Number</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ†”</div>\n            <div class="metric-content">\n              <div class="metric-value" style="font-size: 0.9em; word-break: break-all;">${i.refId||"N/A"}</div>\n              <div class="metric-label">Reference ID</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ“¦</div>\n            <div class="metric-content">\n              <div class="metric-value">${(null==(t=n.lines)?void 0:t.length)||0}</div>\n              <div class="metric-label">Total Lines</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸŽ¯</div>\n            <div class="metric-content">\n              <div class="metric-value">${(null==(e=n.lines)?void 0:e.filter(t=>t.is_upsell).length)||0}</div>\n              <div class="metric-label">Upsells</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ’°</div>\n            <div class="metric-content">\n              <div class="metric-value">${o}${r.toFixed(2)}</div>\n              <div class="metric-label">Order Total</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">${s?"âœ…":"âŒ"}</div>\n            <div class="metric-content">\n              <div class="metric-value">${s?"Yes":"No"}</div>\n              <div class="metric-label">Can Add Upsells</div>\n            </div>\n          </div>\n        </div>\n        \n        <div class="section">\n          <h4>Order Details</h4>\n          <div class="info-grid">\n            <div class="info-item">\n              <span class="info-label">Status:</span>\n              <span class="info-value">Active</span>\n            </div>\n            <div class="info-item">\n              <span class="info-label">Currency:</span>\n              <span class="info-value">${n.currency||"USD"}</span>\n            </div>\n            <div class="info-item">\n              <span class="info-label">Loaded At:</span>\n              <span class="info-value">${i.orderLoadedAt?new Date(i.orderLoadedAt).toLocaleString():"N/A"}</span>\n            </div>\n            <div class="info-item">\n              <span class="info-label">Shipping Method:</span>\n              <span class="info-value">${n.shipping_method||"N/A"}</span>\n            </div>\n            <div class="info-item">\n              <span class="info-label">Order URL:</span>\n              <span class="info-value" style="font-size: 0.8em; word-break: break-all;">${n.order_status_url?"Available":"N/A"}</span>\n            </div>\n          </div>\n        </div>\n        \n        <div class="section">\n          <h4>Totals Breakdown</h4>\n          <div class="totals-breakdown">\n            <div class="total-item">\n              <span>Subtotal (excl. tax):</span>\n              <span>${o}${parseFloat(n.total_excl_tax||"0").toFixed(2)}</span>\n            </div>\n            <div class="total-item">\n              <span>Shipping:</span>\n              <span>${o}${parseFloat(n.shipping_excl_tax||"0").toFixed(2)}</span>\n            </div>\n            <div class="total-item">\n              <span>Tax:</span>\n              <span>${o}${parseFloat(n.total_tax||"0").toFixed(2)}</span>\n            </div>\n            <div class="total-item total-final">\n              <span>Total (incl. tax):</span>\n              <span>${o}${parseFloat(n.total_incl_tax||"0").toFixed(2)}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}getOrderLinesContent(){const t=Ot.getState().order;if(!t||!t.lines||0===t.lines.length)return this.getEmptyState("No order lines available");const e=t.currency||"USD",i=this.getCurrencySymbol(e);return`\n      <div class="enhanced-panel">\n        <div class="section">\n          <style>\n            .order-table {\n              width: 100%;\n              border-collapse: collapse;\n              font-size: 0.9em;\n            }\n            .order-table th {\n              background: rgba(255, 255, 255, 0.05);\n              padding: 8px;\n              text-align: left;\n              border-bottom: 2px solid rgba(255, 255, 255, 0.1);\n              font-weight: 600;\n            }\n            .order-table td {\n              padding: 8px;\n              border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n            }\n            .order-table tr:hover {\n              background: rgba(255, 255, 255, 0.02);\n            }\n            .order-table .upsell-row {\n              background: rgba(255, 215, 0, 0.05);\n            }\n            .order-table .upsell-badge {\n              background: #ffd700;\n              color: #000;\n              padding: 2px 6px;\n              border-radius: 3px;\n              font-size: 0.75em;\n              font-weight: bold;\n              margin-left: 8px;\n              display: inline-block;\n            }\n            .order-table .text-right {\n              text-align: right;\n            }\n            .order-table .text-center {\n              text-align: center;\n            }\n          </style>\n          \n          <table class="order-table">\n            <thead>\n              <tr>\n                <th style="width: 5%">#</th>\n                <th style="width: 35%">Product</th>\n                <th style="width: 15%">SKU</th>\n                <th style="width: 10%" class="text-center">Qty</th>\n                <th style="width: 12%" class="text-right">Price</th>\n                <th style="width: 11%" class="text-right">Tax</th>\n                <th style="width: 12%" class="text-right">Total</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${t.lines.map((t,e)=>`\n                <tr ${t.is_upsell?'class="upsell-row"':""}>\n                  <td>${e+1}</td>\n                  <td>\n                    ${t.product_title||t.title||"Unknown Product"}\n                    ${t.is_upsell?'<span class="upsell-badge">POST-PURCHASE</span>':""}\n                  </td>\n                  <td>${t.product_sku||"N/A"}</td>\n                  <td class="text-center">${t.quantity||1}</td>\n                  <td class="text-right">${i}${parseFloat(t.price_excl_tax||"0").toFixed(2)}</td>\n                  <td class="text-right">${i}${(parseFloat(t.price_incl_tax||"0")-parseFloat(t.price_excl_tax||"0")).toFixed(2)}</td>\n                  <td class="text-right"><strong>${i}${parseFloat(t.price_incl_tax||"0").toFixed(2)}</strong></td>\n                </tr>\n              `).join("")}\n              \n              <tr style="border-top: 2px solid rgba(255, 255, 255, 0.1);">\n                <td colspan="6" class="text-right"><strong>Order Total:</strong></td>\n                <td class="text-right"><strong>${i}${parseFloat(t.total_incl_tax||"0").toFixed(2)} ${e}</strong></td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    `}getAddressesContent(){var t,e,i,n;const r=Ot.getState().order;if(!r)return this.getEmptyState();const s=(t,e)=>{const i="shipping"===e?"ðŸ“¦":"ðŸ’³",n="shipping"===e?"Shipping Address":"Billing Address";return t?`\n        <div class="address-table-container">\n          <div class="address-header">\n            <span class="address-icon">${i}</span>\n            <h4>${n}</h4>\n          </div>\n          <table class="address-table">\n            <tbody>\n              ${t.first_name||t.last_name?`\n                <tr>\n                  <td class="field-label">Name</td>\n                  <td class="field-value">${t.first_name||""} ${t.last_name||""}</td>\n                </tr>\n              `:""}\n              ${t.line1?`\n                <tr>\n                  <td class="field-label">Address 1</td>\n                  <td class="field-value">${t.line1}</td>\n                </tr>\n              `:""}\n              ${t.line2?`\n                <tr>\n                  <td class="field-label">Address 2</td>\n                  <td class="field-value">${t.line2}</td>\n                </tr>\n              `:""}\n              ${t.line4||t.state||t.postcode?`\n                <tr>\n                  <td class="field-label">City/State/Zip</td>\n                  <td class="field-value">${t.line4||""}${t.state?`, ${t.state}`:""} ${t.postcode||""}</td>\n                </tr>\n              `:""}\n              ${t.country?`\n                <tr>\n                  <td class="field-label">Country</td>\n                  <td class="field-value">${t.country}</td>\n                </tr>\n              `:""}\n              ${t.phone_number?`\n                <tr>\n                  <td class="field-label">Phone</td>\n                  <td class="field-value">${t.phone_number}</td>\n                </tr>\n              `:""}\n            </tbody>\n          </table>\n        </div>\n      `:`\n          <div class="address-table-container">\n            <div class="address-header">\n              <span class="address-icon">${i}</span>\n              <h4>${n}</h4>\n            </div>\n            <div class="address-empty">No ${e} address provided</div>\n          </div>\n        `};return`\n      <div class="enhanced-panel">\n        <style>\n          .addresses-container {\n            display: flex;\n            gap: 20px;\n            margin-bottom: 20px;\n          }\n          .address-table-container {\n            flex: 1;\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 8px;\n            overflow: hidden;\n          }\n          .address-header {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n            padding: 12px 16px;\n            background: rgba(255, 255, 255, 0.05);\n            border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n          }\n          .address-header h4 {\n            margin: 0;\n            font-size: 1em;\n            font-weight: 600;\n          }\n          .address-icon {\n            font-size: 1.2em;\n          }\n          .address-table {\n            width: 100%;\n            border-collapse: collapse;\n          }\n          .address-table td {\n            padding: 10px 16px;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n          }\n          .address-table tr:last-child td {\n            border-bottom: none;\n          }\n          .field-label {\n            width: 40%;\n            color: rgba(255, 255, 255, 0.6);\n            font-size: 0.9em;\n          }\n          .field-value {\n            color: rgba(255, 255, 255, 0.9);\n            font-size: 0.9em;\n          }\n          .address-empty {\n            padding: 30px;\n            text-align: center;\n            color: rgba(255, 255, 255, 0.4);\n            font-style: italic;\n          }\n          .customer-info-section {\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 8px;\n            overflow: hidden;\n          }\n          .customer-header {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n            padding: 12px 16px;\n            background: rgba(255, 255, 255, 0.05);\n            border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n          }\n          .customer-header h4 {\n            margin: 0;\n            font-size: 1em;\n            font-weight: 600;\n          }\n          .customer-table {\n            width: 100%;\n            border-collapse: collapse;\n          }\n          .customer-table td {\n            padding: 10px 16px;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n          }\n          .customer-table tr:last-child td {\n            border-bottom: none;\n          }\n        </style>\n        \n        <div class="addresses-container">\n          ${s(r.shipping_address,"shipping")}\n          ${s(r.billing_address,"billing")}\n        </div>\n        \n        <div class="customer-info-section">\n          <div class="customer-header">\n            <span class="address-icon">ðŸ‘¤</span>\n            <h4>Customer Information</h4>\n          </div>\n          <table class="customer-table">\n            <tbody>\n              <tr>\n                <td class="field-label">Name</td>\n                <td class="field-value">${(null==(t=r.user)?void 0:t.first_name)||""} ${(null==(e=r.user)?void 0:e.last_name)||""}</td>\n              </tr>\n              <tr>\n                <td class="field-label">Email</td>\n                <td class="field-value">${(null==(i=r.user)?void 0:i.email)||"N/A"}</td>\n              </tr>\n              <tr>\n                <td class="field-label">Phone</td>\n                <td class="field-value">${(null==(n=r.user)?void 0:n.phone_number)||"N/A"}</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    `}getRawDataContent(){const t=Ot.getState();return zh.generateRawDataContent({order:t.order,refId:t.refId,orderLoadedAt:t.orderLoadedAt,isLoading:t.isLoading,isProcessingUpsell:t.isProcessingUpsell,error:t.error,upsellError:t.upsellError,pendingUpsells:t.pendingUpsells,completedUpsellPages:t.completedUpsellPages,viewedUpsellPages:t.viewedUpsellPages,upsellJourney:t.upsellJourney})}getEmptyState(t="No order loaded"){return`\n      <div class="enhanced-panel">\n        <div class="empty-state">\n          <div class="empty-icon">ðŸ“¦</div>\n          <div class="empty-text">${t}</div>\n          <div class="empty-hint">Load an order to see details here</div>\n        </div>\n      </div>\n    `}getActions(){const t=Ot.getState(),e=[];return t.order&&(e.push({label:"Clear Order",action:()=>t.clearOrder(),variant:"danger"}),e.push({label:"Reload Order",action:()=>g(null,null,function*(){t.refId&&t.clearOrder()}),variant:"primary"}),t.pendingUpsells.length>0&&e.push({label:"Clear Pending",action:()=>t.clearPendingUpsells(),variant:"secondary"}),e.push({label:"Export Order",action:this.exportOrder,variant:"secondary"})),e.push({label:"Reset Store",action:()=>t.reset(),variant:"danger"}),e}exportOrder(){const t=Ot.getState(),e=JSON.stringify({order:t.order,refId:t.refId,upsellJourney:t.upsellJourney,completedUpsellPages:t.completedUpsellPages,exportedAt:(new Date).toISOString()},null,2),i=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(i),r=document.createElement("a");r.href=n,r.download=`order-state-${t.refId||"unknown"}-${(new Date).toISOString()}.json`,r.click(),URL.revokeObjectURL(n)}getCurrencySymbol(t){return{USD:"$",EUR:"â‚¬",GBP:"Â£",AUD:"$",CAD:"$",JPY:"Â¥",CNY:"Â¥",INR:"â‚¹",KRW:"â‚©",BRL:"R$",MXN:"$",CHF:"Fr",SEK:"kr",NOK:"kr",DKK:"kr",PLN:"zÅ‚",RUB:"â‚½",ZAR:"R",NZD:"$",SGD:"$",HKD:"$",THB:"à¸¿",PHP:"â‚±",IDR:"Rp",MYR:"RM",VND:"â‚«",TRY:"â‚º",AED:"Ø¯.Ø¥",SAR:"ï·¼",ILS:"â‚ª",EGP:"Â£",COP:"$",CLP:"$",ARS:"$",PEN:"S/"}[t]||t+" "}}const Rh=["cart:updated","cart:item-added","cart:item-removed","cart:quantity-changed","cart:package-swapped","campaign:loaded","checkout:started","checkout:form-initialized","checkout:spreedly-ready","checkout:express-started","order:completed","order:redirect-missing","error:occurred","timer:expired","config:updated","coupon:applied","coupon:removed","coupon:validation-failed","selector:item-selected","selector:action-completed","selector:selection-changed","shipping:method-selected","shipping:method-changed","action:success","action:failed","upsell:accepted","upsell-selector:item-selected","upsell:quantity-changed","upsell:option-selected","message:displayed","payment:tokenized","payment:error","checkout:express-completed","checkout:express-failed","express-checkout:initialized","express-checkout:error","express-checkout:started","express-checkout:failed","express-checkout:completed","express-checkout:redirect-missing","address:autocomplete-filled","address:location-fields-shown","checkout:location-fields-shown","checkout:billing-location-fields-shown","upsell:initialized","upsell:adding","upsell:added","upsell:error","accordion:toggled","accordion:opened","accordion:closed","upsell:skipped","upsell:viewed","exit-intent:shown","exit-intent:clicked","exit-intent:dismissed","exit-intent:closed","exit-intent:action","fomo:shown"],Hh=["dataLayer.push","gtm.dom","gtm.js","gtm.load","gtm.click","gtm.linkClick","gtm.scrollDepth","gtm.timer","gtm.historyChange","gtm.video"],Vh=class t{constructor(){this.id="event-timeline",this.title="Events",this.icon="âš¡",this.events=[],this.maxEvents=1e3,this.isRecording=!0,this.showInternalEvents=!1,this.updateTimeout=null,this.saveTimeout=null,this.selectedEventId=null,this.eventBus=st.getInstance();const e=new URLSearchParams(window.location.search);("true"===e.get("debugger")||"true"===e.get("debug"))&&(this.loadSavedState(),this.initializeEventWatching(),t.instance=this)}loadSavedState(){this.checkAndCleanExpiredStorage();const e=localStorage.getItem(t.SHOW_INTERNAL_KEY);null!==e&&(this.showInternalEvents="true"===e);try{const e=localStorage.getItem(t.EVENTS_STORAGE_KEY);if(e){const i=JSON.parse(e);if(Array.isArray(i)){const e=Date.now()-36e5;this.events=i.filter(t=>t.timestamp>e).slice(0,t.MAX_STORED_EVENTS).map(t=>h(u({},t),{relativeTime:this.formatRelativeTime(t.timestamp)}))}}}catch(i){localStorage.removeItem(t.EVENTS_STORAGE_KEY)}}checkAndCleanExpiredStorage(){try{const e=localStorage.getItem(t.STORAGE_EXPIRY_KEY),i=Date.now();if(!e||parseInt(e)<i){localStorage.removeItem(t.EVENTS_STORAGE_KEY);const e=i+60*t.STORAGE_EXPIRY_HOURS*60*1e3;localStorage.setItem(t.STORAGE_EXPIRY_KEY,e.toString())}}catch(e){}}saveEvents(){this.saveTimeout&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(()=>{try{const e=Date.now()-36e5,i=this.events.filter(t=>t.timestamp>e).slice(0,t.MAX_STORED_EVENTS);if(i.length>0){const e=i.map(t=>({id:t.id,timestamp:t.timestamp,type:t.type,name:t.name,data:"string"==typeof t.data&&t.data.length>200?t.data.substring(0,200)+"...":t.data,source:t.source,isInternal:t.isInternal})),n=this.safeStringify(e);if(n.length>5e5){const i=e.slice(0,Math.floor(e.length/2));localStorage.setItem(t.EVENTS_STORAGE_KEY,this.safeStringify(i))}else localStorage.setItem(t.EVENTS_STORAGE_KEY,n)}if(!localStorage.getItem(t.STORAGE_EXPIRY_KEY)){const e=Date.now()+60*t.STORAGE_EXPIRY_HOURS*60*1e3;localStorage.setItem(t.STORAGE_EXPIRY_KEY,e.toString())}}catch(e){e instanceof DOMException&&"QuotaExceededError"===e.name&&localStorage.removeItem(t.EVENTS_STORAGE_KEY)}},500)}safeStringify(t){const e=new WeakSet;return JSON.stringify(t,(t,i)=>{if("object"==typeof i&&null!==i){if(e.has(i))return"[Circular Reference]";e.add(i)}return i instanceof Window?"[Window]":i instanceof Document?"[Document]":i instanceof HTMLElement?"[HTMLElement]":i instanceof Node?"[Node]":i instanceof Event?{type:i.type,target:i.target?"[EventTarget]":void 0,timeStamp:i.timeStamp,bubbles:i.bubbles,cancelable:i.cancelable}:"function"==typeof i?"[Function]":i})}toggleInternalEvents(){this.showInternalEvents=!this.showInternalEvents,localStorage.setItem(t.SHOW_INTERNAL_KEY,String(this.showInternalEvents))}initializeEventWatching(){this.watchDataLayer(),this.watchInternalEvents(),this.watchDOMEvents(),this.watchPerformanceEvents()}watchDataLayer(){if("undefined"==typeof window)return;window.dataLayer=window.dataLayer||[];const t=window.dataLayer.push;window.dataLayer.push=(...e)=>(this.isRecording&&e.forEach(t=>{let e="GTM DataLayer",i=!1;t.event&&t.event.startsWith("gtm_")?(e="GTM Internal",i=!0):(t.timestamp||t.event_context)&&(e="Analytics Manager"),t.event&&Rh.includes(t.event)&&(i=!0),this.addEvent({type:"dataLayer",name:t.event||"dataLayer.push",data:t,source:e,isInternal:i})}),t.apply(window.dataLayer,e)),window.dataLayer.length>0&&window.dataLayer.forEach(t=>{"object"==typeof t&&t.event&&this.addEvent({type:"dataLayer",name:t.event,data:t,source:"GTM DataLayer (Historical)",isInternal:Rh.includes(t.event)})})}watchInternalEvents(){const t=(t,e)=>{t.includes("error")||t.includes("Error")||this.isRecording&&this.addEvent({type:"internal",name:t,data:e,source:"SDK EventBus",isInternal:!0})},e=this.eventBus.emit.bind(this.eventBus);this.eventBus.emit=(i,n)=>(t(i,n),e(i,n))}watchDOMEvents(){if("undefined"==typeof window)return;const e=["click","submit","change","focus","blur","scroll","resize","load"],i=["debug:event-added","debug:update-content","debug:panel-switched","ix2-animation-started","ix2-animation-stopped","ix2-animation-completed","ix2-animation-paused","ix2-animation-resumed","ix2-animation","ix2-element-hover","ix2-element-unhover","ix2-element-click","ix2-page-start","ix2-page-finish","ix2-scroll","ix2-tabs-change","ix2-slider-change","ix2-dropdown-open","ix2-dropdown-close","w-close","w-open","w-tab-active","w-tab-inactive","w-slider-move","w-dropdown-toggle"],n=EventTarget.prototype.dispatchEvent;EventTarget.prototype.dispatchEvent=function(r){if(!(!(r instanceof CustomEvent)||e.includes(r.type)||i.includes(r.type)||r.type.startsWith("debug:")||r.type.startsWith("ix2-")||r.type.startsWith("w-")||r.type.includes("error")||r.type.includes("Error"))){const e=t.getInstance();if(e&&e.isRecording)try{e.addEvent({type:"dom",name:r.type,data:r.detail||{},source:"DOM CustomEvent",isInternal:Rh.includes(r.type)})}catch(s){}}return n.call(this,r)}}static getInstance(){return t.instance}watchPerformanceEvents(){if("undefined"==typeof window||!window.performance)return;const t=this,e=performance.mark;performance.mark=function(i){const n=e.call(performance,i);return t.isRecording&&t.addEvent({type:"performance",name:`mark: ${i}`,data:{markName:i},source:"Performance API",isInternal:!0}),n};const i=performance.measure;performance.measure=function(e,n,r){const s=i.call(performance,e,n,r);return t.isRecording&&t.addEvent({type:"performance",name:`measure: ${e}`,data:{measureName:e,startMark:n,endMark:r},source:"Performance API",isInternal:!0}),s}}addEvent(t){if(Hh.includes(t.name||""))return;const e=Date.now(),i={id:`event_${e}_${Math.random().toString(36).substr(2,9)}`,timestamp:t.timestamp||e,type:t.type||"internal",name:t.name||"unknown",data:t.data||{},source:t.source||"Unknown",relativeTime:this.formatRelativeTime(t.timestamp||e),isInternal:t.isInternal||!1};this.events.unshift(i),this.events.length>this.maxEvents&&(this.events=this.events.slice(0,this.maxEvents)),this.saveEvents(),"undefined"!=typeof document&&(this.updateTimeout&&clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout(()=>{document.dispatchEvent(new CustomEvent("debug:event-added",{detail:{panelId:this.id,event:i}}))},100))}formatRelativeTime(t){const e=Date.now()-t,i=Math.floor(e/1e3),n=Math.floor(i/60),r=Math.floor(n/60);return r>0?`${r}h ${n%60}m ago`:n>0?`${n}m ${i%60}s ago`:i>0?`${i}s ago`:"just now"}formatTimestamp(t){const e=new Date(t);return`${e.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}.${e.getMilliseconds().toString().padStart(3,"0")}`}getFilteredEvents(){return this.showInternalEvents?this.events:this.events.filter(t=>!t.isInternal)}getEventTypeColor(t){return{dataLayer:"#4CAF50",internal:"#2196F3",dom:"#FF9800",performance:"#9C27B0"}[t]||"#666"}getEventTypeBadge(t){return{dataLayer:"GTM",internal:"SDK",dom:"DOM",performance:"PERF"}[t]||t.toUpperCase()}showEventModal(t){this.selectedEventId=t,"undefined"!=typeof document&&document.dispatchEvent(new CustomEvent("debug:update-content",{detail:{panelId:this.id}}))}closeEventModal(){this.selectedEventId=null,"undefined"!=typeof document&&document.dispatchEvent(new CustomEvent("debug:update-content",{detail:{panelId:this.id}}))}getContent(){const t=this.getFilteredEvents(),e=this.selectedEventId?this.events.find(t=>t.id===this.selectedEventId):null,i=e?`\n      <div class="event-modal-overlay" onclick="window.eventTimelinePanel_closeModal()">\n        <div class="event-modal" onclick="event.stopPropagation()">\n          <div class="event-modal-header">\n            <h3 class="event-modal-title">${e.name}</h3>\n            <button class="event-modal-close" onclick="window.eventTimelinePanel_closeModal()">âœ•</button>\n          </div>\n          <div class="event-modal-body">\n            <div class="event-modal-meta">\n              <div class="event-modal-meta-item">\n                <span class="event-modal-meta-label">Type:</span>\n                <span class="event-type-badge" style="background: ${this.getEventTypeColor(e.type)}22; color: ${this.getEventTypeColor(e.type)};">\n                  ${this.getEventTypeBadge(e.type)}\n                </span>\n              </div>\n              <div class="event-modal-meta-item">\n                <span class="event-modal-meta-label">Source:</span>\n                <span>${e.source}</span>\n              </div>\n              <div class="event-modal-meta-item">\n                <span class="event-modal-meta-label">Time:</span>\n                <span>${this.formatTimestamp(e.timestamp)}</span>\n              </div>\n              <div class="event-modal-meta-item">\n                <span class="event-modal-meta-label">Relative:</span>\n                <span>${e.relativeTime}</span>\n              </div>\n            </div>\n            <div class="event-modal-data">\n              <div class="event-modal-data-header">\n                <span>Event Data</span>\n                <button class="event-modal-copy" onclick="window.eventTimelinePanel_copyData('${e.id}')">\n                  Copy JSON\n                </button>\n              </div>\n              <pre class="event-modal-data-content">${this.safeStringify(e.data)}</pre>\n            </div>\n          </div>\n        </div>\n      </div>\n    `:"";return"undefined"!=typeof window&&(window.eventTimelinePanel_showModal=t=>{this.showEventModal(t)},window.eventTimelinePanel_closeModal=()=>{this.closeEventModal()},window.eventTimelinePanel_copyData=t=>{const e=this.events.find(e=>e.id===t);if(e){navigator.clipboard.writeText(this.safeStringify(e.data));const t=document.querySelector(".event-modal-copy");if(t){const e=t.textContent;t.textContent="Copied!",setTimeout(()=>{t.textContent=e},2e3)}}}),`\n      <style>\n        .events-table-container {\n          height: 100%;\n          display: flex;\n          flex-direction: column;\n          background: #0f0f0f;\n        }\n        /* Modal Styles */\n        .event-modal-overlay {\n          position: fixed;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          background: rgba(0, 0, 0, 0.8);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          z-index: 100000;\n          backdrop-filter: blur(4px);\n        }\n        .event-modal {\n          background: #1a1a1a;\n          border: 1px solid rgba(255, 255, 255, 0.1);\n          border-radius: 12px;\n          width: 90%;\n          max-width: 800px;\n          max-height: 80vh;\n          display: flex;\n          flex-direction: column;\n          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);\n        }\n        .event-modal-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 20px;\n          border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n        }\n        .event-modal-title {\n          margin: 0;\n          font-size: 1.2em;\n          color: rgba(255, 255, 255, 0.9);\n          font-weight: 600;\n        }\n        .event-modal-close {\n          background: none;\n          border: none;\n          color: rgba(255, 255, 255, 0.6);\n          font-size: 24px;\n          cursor: pointer;\n          padding: 0;\n          width: 32px;\n          height: 32px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          border-radius: 6px;\n          transition: all 0.2s;\n        }\n        .event-modal-close:hover {\n          background: rgba(255, 255, 255, 0.1);\n          color: rgba(255, 255, 255, 0.9);\n        }\n        .event-modal-body {\n          flex: 1;\n          overflow-y: auto;\n          padding: 20px;\n        }\n        .event-modal-meta {\n          display: grid;\n          grid-template-columns: repeat(2, 1fr);\n          gap: 12px;\n          margin-bottom: 20px;\n        }\n        .event-modal-meta-item {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n        .event-modal-meta-label {\n          color: rgba(255, 255, 255, 0.5);\n          font-size: 0.9em;\n        }\n        .event-modal-data {\n          background: rgba(0, 0, 0, 0.3);\n          border: 1px solid rgba(255, 255, 255, 0.1);\n          border-radius: 8px;\n          overflow: hidden;\n        }\n        .event-modal-data-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 12px 16px;\n          background: rgba(255, 255, 255, 0.02);\n          border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n        }\n        .event-modal-copy {\n          background: rgba(60, 125, 255, 0.2);\n          border: 1px solid #3C7DFF;\n          color: #3C7DFF;\n          padding: 6px 12px;\n          border-radius: 6px;\n          cursor: pointer;\n          font-size: 0.85em;\n          transition: all 0.2s;\n        }\n        .event-modal-copy:hover {\n          background: rgba(60, 125, 255, 0.3);\n        }\n        .event-modal-data-content {\n          padding: 16px;\n          margin: 0;\n          color: rgba(255, 255, 255, 0.8);\n          font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;\n          font-size: 0.85em;\n          line-height: 1.5;\n          overflow-x: auto;\n          max-height: 400px;\n        }\n        .events-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 12px 20px;\n          background: rgba(255, 255, 255, 0.02);\n          border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n        }\n        .events-stats {\n          display: flex;\n          gap: 20px;\n          align-items: center;\n        }\n        .event-stat {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n        .event-stat-value {\n          font-weight: 600;\n          color: #3C7DFF;\n        }\n        .event-stat-label {\n          color: rgba(255, 255, 255, 0.6);\n          font-size: 0.9em;\n        }\n        .events-controls {\n          display: flex;\n          gap: 12px;\n          align-items: center;\n        }\n        .toggle-internal {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          padding: 6px 12px;\n          background: rgba(255, 255, 255, 0.05);\n          border: 1px solid rgba(255, 255, 255, 0.1);\n          border-radius: 6px;\n          color: rgba(255, 255, 255, 0.8);\n          cursor: pointer;\n          transition: all 0.2s ease;\n        }\n        .toggle-internal:hover {\n          background: rgba(255, 255, 255, 0.1);\n        }\n        .toggle-internal.active {\n          background: rgba(60, 125, 255, 0.2);\n          border-color: #3C7DFF;\n        }\n        .recording-status {\n          display: flex;\n          align-items: center;\n          gap: 6px;\n          padding: 6px 12px;\n          background: ${this.isRecording?"rgba(239, 68, 68, 0.2)":"rgba(255, 255, 255, 0.05)"};\n          border: 1px solid ${this.isRecording?"#EF4444":"rgba(255, 255, 255, 0.1)"};\n          border-radius: 6px;\n          color: ${this.isRecording?"#EF4444":"rgba(255, 255, 255, 0.6)"};\n        }\n        .recording-dot {\n          width: 8px;\n          height: 8px;\n          border-radius: 50%;\n          background: currentColor;\n          ${this.isRecording?"animation: pulse 1.5s infinite;":""}\n        }\n        @keyframes pulse {\n          0%, 100% { opacity: 1; }\n          50% { opacity: 0.5; }\n        }\n        .events-table {\n          width: 100%;\n          border-collapse: collapse;\n          font-size: 0.9em;\n        }\n        .events-table th {\n          background: rgba(255, 255, 255, 0.05);\n          padding: 10px;\n          text-align: left;\n          border-bottom: 2px solid rgba(255, 255, 255, 0.1);\n          font-weight: 600;\n          color: rgba(255, 255, 255, 0.8);\n          position: sticky;\n          top: 0;\n          z-index: 10;\n        }\n        .events-table td {\n          padding: 10px;\n          border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n          color: rgba(255, 255, 255, 0.7);\n        }\n        .events-table tr:hover {\n          background: rgba(255, 255, 255, 0.02);\n        }\n        .event-type-badge {\n          display: inline-block;\n          padding: 2px 8px;\n          border-radius: 4px;\n          font-size: 0.75em;\n          font-weight: 600;\n          text-transform: uppercase;\n        }\n        .event-name {\n          font-weight: 500;\n          color: rgba(255, 255, 255, 0.9);\n        }\n        .event-source {\n          font-size: 0.85em;\n          color: rgba(255, 255, 255, 0.5);\n        }\n        .event-time {\n          font-family: 'SF Mono', monospace;\n          font-size: 0.85em;\n          color: rgba(255, 255, 255, 0.5);\n        }\n        .event-data {\n          max-width: 400px;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          font-family: 'SF Mono', monospace;\n          font-size: 0.85em;\n          color: rgba(255, 255, 255, 0.6);\n          cursor: pointer;\n        }\n        .event-row {\n          cursor: pointer;\n          transition: background 0.2s;\n        }\n        .event-row:hover {\n          background: rgba(255, 255, 255, 0.02);\n        }\n        .internal-badge {\n          display: inline-block;\n          padding: 1px 6px;\n          background: rgba(156, 39, 176, 0.2);\n          color: #9C27B0;\n          border-radius: 3px;\n          font-size: 0.7em;\n          font-weight: 600;\n          margin-left: 6px;\n        }\n        .empty-state {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: center;\n          height: 300px;\n          color: rgba(255, 255, 255, 0.4);\n        }\n        .empty-state-icon {\n          font-size: 48px;\n          margin-bottom: 16px;\n        }\n        .empty-state-text {\n          font-size: 1.1em;\n        }\n      </style>\n      \n      <div class="events-table-container">\n        <div class="events-header">\n          <div class="events-stats">\n            <div class="event-stat">\n              <span class="event-stat-value">${this.events.length}</span>\n              <span class="event-stat-label">Total Events</span>\n            </div>\n            <div class="event-stat">\n              <span class="event-stat-value">${t.length}</span>\n              <span class="event-stat-label">Visible</span>\n            </div>\n          </div>\n          \n          <div class="events-controls">\n            <button class="toggle-internal ${this.showInternalEvents?"active":""}" \n                    data-action="toggle-internal-events">\n              <span>${this.showInternalEvents?"âœ“":""}</span>\n              Show Internal Events\n            </button>\n            \n            <div class="recording-status">\n              <span class="recording-dot"></span>\n              <span>${this.isRecording?"Recording":"Paused"}</span>\n            </div>\n          </div>\n        </div>\n        \n        ${0===t.length?'\n          <div class="empty-state">\n            <div class="empty-state-icon">ðŸ“­</div>\n            <div class="empty-state-text">No events captured yet</div>\n          </div>\n        ':`\n          <div style="flex: 1; overflow-y: auto;">\n            <table class="events-table">\n              <thead>\n                <tr>\n                  <th style="width: 5%">#</th>\n                  <th style="width: 8%">Type</th>\n                  <th style="width: 25%">Event Name</th>\n                  <th style="width: 15%">Source</th>\n                  <th style="width: 12%">Time</th>\n                  <th style="width: 35%">Data</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${t.slice(0,100).map((t,e)=>`\n                  <tr class="event-row" onclick="window.eventTimelinePanel_showModal('${t.id}')">\n                    <td>${e+1}</td>\n                    <td>\n                      <span class="event-type-badge" style="background: ${this.getEventTypeColor(t.type)}22; color: ${this.getEventTypeColor(t.type)};">\n                        ${this.getEventTypeBadge(t.type)}\n                      </span>\n                    </td>\n                    <td>\n                      <span class="event-name">${t.name}</span>\n                      ${t.isInternal?'<span class="internal-badge">INTERNAL</span>':""}\n                    </td>\n                    <td class="event-source">${t.source}</td>\n                    <td class="event-time">${this.formatTimestamp(t.timestamp)}</td>\n                    <td>\n                      <div class="event-data" onclick="event.stopPropagation(); window.eventTimelinePanel_showModal('${t.id}')">\n                        ${this.safeStringify(t.data)}\n                      </div>\n                    </td>\n                  </tr>\n                `).join("")}\n              </tbody>\n            </table>\n          </div>\n        `}\n      </div>\n      ${i}\n    `}getActions(){return[{label:this.isRecording?"Pause":"Resume",variant:this.isRecording?"secondary":"primary",action:()=>{this.isRecording=!this.isRecording}},{label:"Clear Events",variant:"danger",action:()=>{this.events=[],localStorage.removeItem(t.EVENTS_STORAGE_KEY)}},{label:"Export Events",variant:"primary",action:()=>{const t=JSON.stringify(this.events,null,2),e=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(e),n=document.createElement("a");n.href=i,n.download=`events-${Date.now()}.json`,n.click(),URL.revokeObjectURL(i)}}]}};Vh.EVENTS_STORAGE_KEY="debug-events-history",Vh.SHOW_INTERNAL_KEY="debug-events-show-internal",Vh.MAX_STORED_EVENTS=100,Vh.STORAGE_EXPIRY_KEY="debug-events-expiry",Vh.STORAGE_EXPIRY_HOURS=2,Vh.instance=null;let Bh=Vh;class Jh{constructor(){this.id="config",this.title="Configuration",this.icon="âš™ï¸"}getContent(){var t;return(null==(t=this.getTabs()[0])?void 0:t.getContent())||""}getTabs(){return[{id:"overview",label:"Overview",icon:"ðŸ“Š",getContent:()=>this.getOverviewContent()},{id:"settings",label:"Settings",icon:"âš™ï¸",getContent:()=>this.getSettingsContent()},{id:"raw",label:"Raw Data",icon:"ðŸ”§",getContent:()=>this.getRawDataContent()}]}getOverviewContent(){const t=yt.getState(),e="undefined"!=typeof window&&window.__NEXT_SDK_VERSION__?window.__NEXT_SDK_VERSION__:"1.0.0";return`\n      <div class="enhanced-panel">\n        <div class="metrics-grid">\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ”§</div>\n            <div class="metric-content">\n              <div class="metric-value">${t.debug?"ON":"OFF"}</div>\n              <div class="metric-label">Debug Mode</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸŒ</div>\n            <div class="metric-content">\n              <div class="metric-value">${t.environment||"production"}</div>\n              <div class="metric-label">Environment</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ”‘</div>\n            <div class="metric-content">\n              <div class="metric-value">${t.apiKey?"SET":"MISSING"}</div>\n              <div class="metric-label">API Key</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ“¦</div>\n            <div class="metric-content">\n              <div class="metric-value">${e}</div>\n              <div class="metric-label">SDK Version</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}getSettingsContent(){var t,e,i,n,r,s,a,o,c,l;const d=yt.getState();return`\n      <div class="enhanced-panel">\n        <div class="section">\n          <div class="config-groups">\n            <div class="config-group">\n              <h4 class="config-group-title">Core Settings</h4>\n              <div class="config-items">\n                <div class="config-item">\n                  <span class="config-key">SDK Version:</span>\n                  <span class="config-value">${"undefined"!=typeof window&&window.__NEXT_SDK_VERSION__?window.__NEXT_SDK_VERSION__:"1.0.0"}</span>\n                </div>\n                <div class="config-item">\n                  <span class="config-key">API Key:</span>\n                  <span class="config-value">${d.apiKey?`${d.apiKey.substring(0,8)}...`:"Not set"}</span>\n                </div>\n                <div class="config-item">\n                  <span class="config-key">Environment:</span>\n                  <span class="config-value">${d.environment||"production"}</span>\n                </div>\n                <div class="config-item">\n                  <span class="config-key">Base URL:</span>\n                  <span class="config-value">https://campaigns.apps.29next.com</span>\n                </div>\n              </div>\n            </div>\n\n            <div class="config-group">\n              <h4 class="config-group-title">Feature Flags</h4>\n              <div class="config-items">\n                <div class="config-item">\n                  <span class="config-key">Debug Mode:</span>\n                  <span class="config-value ${d.debug?"enabled":"disabled"}">${d.debug?"Enabled":"Disabled"}</span>\n                </div>\n                <div class="config-item">\n                  <span class="config-key">Test Mode:</span>\n                  <span class="config-value ${null!=(t=d.testMode)&&t?"enabled":"disabled"}">${null!=(e=d.testMode)&&e?"Enabled":"Disabled"}</span>\n                </div>\n                <div class="config-item">\n                  <span class="config-key">Analytics:</span>\n                  <span class="config-value ${null==(i=d.enableAnalytics)||i?"enabled":"disabled"}">${null==(n=d.enableAnalytics)||n?"Enabled":"Disabled"}</span>\n                </div>\n                <div class="config-item">\n                  <span class="config-key">Auto Initialize:</span>\n                  <span class="config-value ${null==(r=d.autoInit)||r?"enabled":"disabled"}">${null==(s=d.autoInit)||s?"Enabled":"Disabled"}</span>\n                </div>\n              </div>\n            </div>\n\n            <div class="config-group">\n              <h4 class="config-group-title">Performance</h4>\n              <div class="config-items">\n                <div class="config-item">\n                  <span class="config-key">Rate Limit:</span>\n                  <span class="config-value">${null!=(a=d.rateLimit)?a:4} req/sec</span>\n                </div>\n                <div class="config-item">\n                  <span class="config-key">Cache TTL:</span>\n                  <span class="config-value">${null!=(o=d.cacheTtl)?o:300}s</span>\n                </div>\n                <div class="config-item">\n                  <span class="config-key">Retry Attempts:</span>\n                  <span class="config-value">${null!=(c=d.retryAttempts)?c:3}</span>\n                </div>\n                <div class="config-item">\n                  <span class="config-key">Timeout:</span>\n                  <span class="config-value">${null!=(l=d.timeout)?l:1e4}ms</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}getRawDataContent(){const t=yt.getState();return zh.generateRawDataContent(t)}getActions(){return[{label:"Toggle Debug",action:()=>this.toggleDebug(),variant:"primary"},{label:"Toggle Test Mode",action:()=>this.toggleTestMode(),variant:"secondary"},{label:"Export Config",action:()=>this.exportConfig(),variant:"secondary"},{label:"Reset Config",action:()=>this.resetConfig(),variant:"danger"}]}toggleDebug(){const t=yt.getState();t.updateConfig({debug:!t.debug}),document.dispatchEvent(new CustomEvent("debug:update-content"))}toggleTestMode(){var t;const e=yt.getState();e.updateConfig({testMode:!(null!=(t=e.testMode)&&t)}),document.dispatchEvent(new CustomEvent("debug:update-content"))}exportConfig(){const t=yt.getState(),e=JSON.stringify(t,null,2),i=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(i),r=document.createElement("a");r.href=n,r.download=`next-config-${(new Date).toISOString()}.json`,r.click(),URL.revokeObjectURL(n)}resetConfig(){confirm("Are you sure you want to reset the configuration to defaults?")&&(yt.getState().reset(),document.dispatchEvent(new CustomEvent("debug:update-content")))}}class Gh{constructor(){this.id="checkout",this.title="Checkout State",this.icon="ðŸ’³"}getContent(){var t;return(null==(t=this.getTabs()[0])?void 0:t.getContent())||""}getTabs(){return[{id:"overview",label:"Overview",icon:"ðŸ“Š",getContent:()=>this.getOverviewContent()},{id:"customer",label:"Customer Info",icon:"ðŸ‘¤",getContent:()=>this.getCustomerContent()},{id:"validation",label:"Validation",icon:"âœ…",getContent:()=>this.getValidationContent()},{id:"raw",label:"Raw Data",icon:"ðŸ”§",getContent:()=>this.getRawDataContent()}]}getOverviewContent(){var t;const e=Mt.getState();return`\n      <div class="enhanced-panel">\n        <div class="metrics-grid">\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ“‹</div>\n            <div class="metric-content">\n              <div class="metric-value">${e.step||"Not Started"}</div>\n              <div class="metric-label">Current Step</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">${e.isProcessing?"â³":"âœ…"}</div>\n            <div class="metric-content">\n              <div class="metric-value">${e.isProcessing?"PROCESSING":"READY"}</div>\n              <div class="metric-label">Form Status</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ”’</div>\n            <div class="metric-content">\n              <div class="metric-value">${e.paymentMethod||"None"}</div>\n              <div class="metric-label">Payment Method</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸšš</div>\n            <div class="metric-content">\n              <div class="metric-value">${(null==(t=e.shippingMethod)?void 0:t.name)||"None"}</div>\n              <div class="metric-label">Shipping Method</div>\n            </div>\n          </div>\n        </div>\n\n        <div class="section">\n          <h3 class="section-title">Form Fields Status</h3>\n          <div class="form-fields-grid">\n            ${this.renderFormFields(e)}\n          </div>\n        </div>\n        \n        <div class="section">\n          <h3 class="section-title">Current Form Data</h3>\n          <div class="form-data-summary">\n            ${Object.keys(e.formData).length>0?Object.entries(e.formData).map(([t,e])=>`\n                <div class="form-field-row">\n                  <span class="field-name">${this.formatFieldName(t)}</span>\n                  <span class="field-value">${e||"Empty"}</span>\n                </div>\n              `).join(""):'<div class="empty-state">No form data yet</div>'}\n          </div>\n        </div>\n      </div>\n    `}getCustomerContent(){const t=Mt.getState(),e=t.formData;return`\n      <div class="enhanced-panel">\n        <div class="section">\n          <div class="customer-info">\n            ${Object.keys(e).length>0?`\n              <div class="info-card">\n                <h4>Contact Information</h4>\n                <div class="info-row">\n                  <span class="info-label">Email:</span>\n                  <span class="info-value">${e.email||"Not provided"}</span>\n                </div>\n                <div class="info-row">\n                  <span class="info-label">Phone:</span>\n                  <span class="info-value">${e.phone||"Not provided"}</span>\n                </div>\n                <div class="info-row">\n                  <span class="info-label">Name:</span>\n                  <span class="info-value">${e.fname||""} ${e.lname||""}</span>\n                </div>\n              </div>\n              \n              <div class="info-card">\n                <h4>Shipping Address</h4>\n                <div class="address-info">\n                  ${e.address1?`\n                    <div class="info-row">\n                      <span class="info-label">Address:</span>\n                      <span class="info-value">${e.address1}</span>\n                    </div>\n                    ${e.address2?`\n                      <div class="info-row">\n                        <span class="info-label">Address 2:</span>\n                        <span class="info-value">${e.address2}</span>\n                      </div>\n                    `:""}\n                    <div class="info-row">\n                      <span class="info-label">City:</span>\n                      <span class="info-value">${e.city||"Not provided"}</span>\n                    </div>\n                    <div class="info-row">\n                      <span class="info-label">State/Province:</span>\n                      <span class="info-value">${e.province||"Not provided"}</span>\n                    </div>\n                    <div class="info-row">\n                      <span class="info-label">Postal Code:</span>\n                      <span class="info-value">${e.postal||"Not provided"}</span>\n                    </div>\n                    <div class="info-row">\n                      <span class="info-label">Country:</span>\n                      <span class="info-value">${e.country||"Not provided"}</span>\n                    </div>\n                  `:'<div class="info-empty">Not provided</div>'}\n                </div>\n              </div>\n\n              <div class="info-card">\n                <h4>Billing Address</h4>\n                <div class="address-info">\n                  ${t.sameAsShipping?'\n                    <div class="info-same">Same as shipping address</div>\n                  ':t.billingAddress?`\n                    <div class="info-row">\n                      <span class="info-label">Name:</span>\n                      <span class="info-value">${t.billingAddress.first_name} ${t.billingAddress.last_name}</span>\n                    </div>\n                    <div class="info-row">\n                      <span class="info-label">Address:</span>\n                      <span class="info-value">${t.billingAddress.address1}</span>\n                    </div>\n                    <div class="info-row">\n                      <span class="info-label">City:</span>\n                      <span class="info-value">${t.billingAddress.city}, ${t.billingAddress.province} ${t.billingAddress.postal}</span>\n                    </div>\n                  `:'<div class="info-empty">Not provided</div>'}\n                </div>\n              </div>\n            `:'\n              <div class="empty-state">\n                <div class="empty-icon">ðŸ‘¤</div>\n                <div class="empty-text">No customer information yet</div>\n                <div class="empty-subtitle">Fill out the checkout form to see data here</div>\n              </div>\n            '}\n          </div>\n        </div>\n      </div>\n    `}getValidationContent(){const t=Mt.getState();return`\n      <div class="enhanced-panel">\n        <div class="section">\n          <div class="validation-errors">\n            ${t.errors&&Object.keys(t.errors).length>0?`\n              ${Object.entries(t.errors).map(([t,e])=>`\n                <div class="error-item">\n                  <span class="error-field">${t}:</span>\n                  <span class="error-message">${e}</span>\n                </div>\n              `).join("")}\n            `:'\n              <div class="empty-state">\n                <div class="empty-icon">âœ…</div>\n                <div class="empty-text">No validation errors</div>\n              </div>\n            '}\n          </div>\n        </div>\n      </div>\n    `}getRawDataContent(){const t=Mt.getState();return zh.generateRawDataContent(t)}getActions(){return[{label:"Fill Test Data",action:()=>this.fillTestData(),variant:"primary"},{label:"Validate Form",action:()=>this.validateForm(),variant:"secondary"},{label:"Clear Errors",action:()=>this.clearErrors(),variant:"secondary"},{label:"Reset Checkout",action:()=>this.resetCheckout(),variant:"danger"},{label:"Export State",action:()=>this.exportState(),variant:"secondary"}]}renderFormFields(t){return["email","fname","lname","address1","city","province","postal","phone","country"].map(e=>{const i=this.hasFieldValue(t,e),n=t.errors&&t.errors[e];return`\n        <div class="field-status-card ${i?"filled":"empty"} ${n?"error":""}">\n          <div class="field-name">${this.formatFieldName(e)}</div>\n          <div class="field-status">\n            ${i?"âœ…":"â³"}\n            ${n?" âŒ":""}\n          </div>\n        </div>\n      `}).join("")}hasFieldValue(t,e){return t.formData&&t.formData[e]?t.formData[e].toString().trim().length>0:!(!t.billingAddress||!t.billingAddress[e])&&t.billingAddress[e].toString().trim().length>0}formatFieldName(t){return{fname:"First Name",lname:"Last Name",email:"Email",phone:"Phone",address1:"Address",address2:"Address 2",city:"City",province:"State/Province",postal:"Postal Code",country:"Country",accepts_marketing:"Accepts Marketing"}[t]||t.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase()).trim()}fillTestData(){const t=Mt.getState(),e={email:"test@test.com",fname:"Test",lname:"Order",phone:"+14807581224",address1:"Test Address 123",address2:"",city:"Tempe",province:"AZ",postal:"85281",country:"US",accepts_marketing:!0};t.clearAllErrors(),t.updateFormData(e),t.setPaymentMethod("credit-card"),t.setSameAsShipping(!0),t.setShippingMethod({id:1,name:"Standard Shipping",price:0,code:"standard"}),document.dispatchEvent(new CustomEvent("debug:update-content")),setTimeout(()=>{document.dispatchEvent(new CustomEvent("checkout:test-data-filled",{detail:e}))},100)}validateForm(){const t=Mt.getState(),e=t.formData;let i=!1;t.clearAllErrors(),["email","fname","lname","address1","city","country"].forEach(n=>{e[n]&&""!==e[n].toString().trim()||(t.setError(n,`${this.formatFieldName(n)} is required`),i=!0)}),document.dispatchEvent(new CustomEvent("debug:update-content"))}clearErrors(){Mt.getState().clearAllErrors(),document.dispatchEvent(new CustomEvent("debug:update-content"))}resetCheckout(){confirm("Are you sure you want to reset the checkout state?")&&(Mt.getState().reset(),document.dispatchEvent(new CustomEvent("debug:update-content")))}exportState(){const t=Mt.getState(),e=JSON.stringify(t,null,2),i=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(i),r=document.createElement("a");r.href=n,r.download=`checkout-state-${(new Date).toISOString()}.json`,r.click(),URL.revokeObjectURL(n)}}class Kh{constructor(){this.id="storage",this.title="Storage",this.icon="ðŸ’¾"}getContent(){var t;return(null==(t=this.getTabs()[0])?void 0:t.getContent())||""}getTabs(){return[{id:"overview",label:"Overview",icon:"ðŸ“Š",getContent:()=>this.getOverviewContent()},{id:"next-data",label:"Next Data",icon:"ðŸ·ï¸",getContent:()=>this.getNextContent()},{id:"local-storage",label:"Local Storage",icon:"ðŸ’¾",getContent:()=>this.getLocalStorageContent()},{id:"session-storage",label:"Session Storage",icon:"â°",getContent:()=>this.getSessionStorageContent()}]}getOverviewContent(){const t=this.getLocalStorageData(),e=this.getSessionStorageData();return`\n      <div class="enhanced-panel">\n        <div class="metrics-grid">\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ’¾</div>\n            <div class="metric-content">\n              <div class="metric-value">${t.length}</div>\n              <div class="metric-label">LocalStorage Items</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">â°</div>\n            <div class="metric-content">\n              <div class="metric-value">${e.length}</div>\n              <div class="metric-label">SessionStorage Items</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ“Š</div>\n            <div class="metric-content">\n              <div class="metric-value">${this.getStorageSize()}KB</div>\n              <div class="metric-label">Total Size</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ·ï¸</div>\n            <div class="metric-content">\n              <div class="metric-value">${this.getNextItems().length}</div>\n              <div class="metric-label">Next Items</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}getNextContent(){return`\n      <div class="enhanced-panel">\n        <div class="section">\n          <div class="storage-items">\n            ${0===this.getNextItems().length?'\n              <div class="empty-state">\n                <div class="empty-icon">ðŸ’¾</div>\n                <div class="empty-text">No Next storage items found</div>\n              </div>\n            ':`\n              ${this.getNextItems().map(t=>`\n                <div class="storage-item-card next-item">\n                  <div class="storage-item-header">\n                    <span class="storage-key">${t.key}</span>\n                    <span class="storage-type ${t.type}">${t.type}</span>\n                    <button class="storage-delete-btn" onclick="window.nextDebug.deleteStorageItem('${t.key}', '${t.type}')">Ã—</button>\n                  </div>\n                  <div class="storage-item-size">${t.size} bytes</div>\n                  <div class="storage-item-value">\n                    <pre><code>${t.formattedValue}</code></pre>\n                  </div>\n                </div>\n              `).join("")}\n            `}\n          </div>\n        </div>\n      </div>\n    `}getLocalStorageContent(){const t=this.getLocalStorageData();return`\n      <div class="enhanced-panel">\n        <div class="section">\n          <div class="storage-items">\n            ${0===t.length?'\n              <div class="empty-state">\n                <div class="empty-icon">ðŸ’¾</div>\n                <div class="empty-text">No localStorage items</div>\n              </div>\n            ':`\n              ${t.map(t=>`\n                <div class="storage-item-card ${t.key.includes("next")?"next-item":""}">\n                  <div class="storage-item-header">\n                    <span class="storage-key">${t.key}</span>\n                    <span class="storage-type local">local</span>\n                    <button class="storage-delete-btn" onclick="window.nextDebug.deleteStorageItem('${t.key}', 'local')">Ã—</button>\n                  </div>\n                  <div class="storage-item-size">${t.size} bytes</div>\n                  <div class="storage-item-value">\n                    <pre><code>${t.formattedValue}</code></pre>\n                  </div>\n                </div>\n              `).join("")}\n            `}\n          </div>\n        </div>\n      </div>\n    `}getSessionStorageContent(){const t=this.getSessionStorageData();return`\n      <div class="enhanced-panel">\n        <div class="section">\n          <div class="storage-items">\n            ${0===t.length?'\n              <div class="empty-state">\n                <div class="empty-icon">â°</div>\n                <div class="empty-text">No sessionStorage items</div>\n              </div>\n            ':`\n              ${t.map(t=>`\n                <div class="storage-item-card ${t.key.includes("next")?"next-item":""}">\n                  <div class="storage-item-header">\n                    <span class="storage-key">${t.key}</span>\n                    <span class="storage-type session">session</span>\n                    <button class="storage-delete-btn" onclick="window.nextDebug.deleteStorageItem('${t.key}', 'session')">Ã—</button>\n                  </div>\n                  <div class="storage-item-size">${t.size} bytes</div>\n                  <div class="storage-item-value">\n                    <pre><code>${t.formattedValue}</code></pre>\n                  </div>\n                </div>\n              `).join("")}\n            `}\n          </div>\n        </div>\n      </div>\n    `}getActions(){return[{label:"Clear Next Data",action:()=>this.clearNextStorage(),variant:"danger"},{label:"Clear All Local",action:()=>this.clearLocalStorage(),variant:"danger"},{label:"Clear All Session",action:()=>this.clearSessionStorage(),variant:"danger"},{label:"Export Storage",action:()=>this.exportStorage(),variant:"secondary"}]}getLocalStorageData(){const t=[];for(let e=0;e<localStorage.length;e++){const i=localStorage.key(e);if(i){const e=localStorage.getItem(i)||"";t.push({key:i,value:e,size:new Blob([e]).size,formattedValue:this.formatValue(e)})}}return t.sort((t,e)=>t.key.localeCompare(e.key))}getSessionStorageData(){const t=[];for(let e=0;e<sessionStorage.length;e++){const i=sessionStorage.key(e);if(i){const e=sessionStorage.getItem(i)||"";t.push({key:i,value:e,size:new Blob([e]).size,formattedValue:this.formatValue(e)})}}return t.sort((t,e)=>t.key.localeCompare(e.key))}getNextItems(){const t=[];for(let e=0;e<localStorage.length;e++){const i=localStorage.key(e);if(i&&(i.includes("next")||i.includes("29next")||i.includes("campaign"))){const e=localStorage.getItem(i)||"";t.push({key:i,value:e,size:new Blob([e]).size,formattedValue:this.formatValue(e),type:"local"})}}for(let e=0;e<sessionStorage.length;e++){const i=sessionStorage.key(e);if(i&&(i.includes("next")||i.includes("29next")||i.includes("campaign"))){const e=sessionStorage.getItem(i)||"";t.push({key:i,value:e,size:new Blob([e]).size,formattedValue:this.formatValue(e),type:"session"})}}return t.sort((t,e)=>t.key.localeCompare(e.key))}formatValue(t){try{const e=JSON.parse(t);return JSON.stringify(e,null,2)}catch(e){return t.length>200?t.substring(0,200)+"...":t}}getStorageSize(){let t=0;for(let e=0;e<localStorage.length;e++){const i=localStorage.key(e);if(i){const e=localStorage.getItem(i)||"";t+=new Blob([i+e]).size}}for(let e=0;e<sessionStorage.length;e++){const i=sessionStorage.key(e);if(i){const e=sessionStorage.getItem(i)||"";t+=new Blob([i+e]).size}}return Math.round(t/1024)}clearNextStorage(){confirm("Are you sure you want to clear all Next storage data?")&&(this.getNextItems().forEach(t=>{"local"===t.type?localStorage.removeItem(t.key):sessionStorage.removeItem(t.key)}),document.dispatchEvent(new CustomEvent("debug:update-content")))}clearLocalStorage(){confirm("Are you sure you want to clear ALL localStorage data?")&&(localStorage.clear(),document.dispatchEvent(new CustomEvent("debug:update-content")))}clearSessionStorage(){confirm("Are you sure you want to clear ALL sessionStorage data?")&&(sessionStorage.clear(),document.dispatchEvent(new CustomEvent("debug:update-content")))}exportStorage(){const t={localStorage:this.getLocalStorageData(),sessionStorage:this.getSessionStorageData(),timestamp:(new Date).toISOString()},e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),i=URL.createObjectURL(e),n=document.createElement("a");n.href=i,n.download=`storage-data-${(new Date).toISOString()}.json`,n.click(),URL.revokeObjectURL(i)}}class Qh{constructor(){this.id="campaign",this.title="Campaign Data",this.icon="ðŸ“Š"}getContent(){var t;return(null==(t=this.getTabs()[0])?void 0:t.getContent())||""}getTabs(){return[{id:"overview",label:"Overview",icon:"ðŸ“Š",getContent:()=>this.getOverviewContent()},{id:"packages",label:"Packages",icon:"ðŸ“¦",getContent:()=>this.getPackagesContent()},{id:"shipping",label:"Shipping",icon:"ðŸšš",getContent:()=>this.getShippingContent()},{id:"raw",label:"Raw Data",icon:"ðŸ”§",getContent:()=>this.getRawDataContent()}]}getOverviewContent(){const t=dt.getState().data;return t?`\n      <div class="enhanced-panel">\n        ${this.getCampaignOverview(t)}\n      </div>\n    `:'\n        <div class="enhanced-panel">\n          <div class="empty-state">\n            <div class="empty-icon">ðŸ“Š</div>\n            <div class="empty-text">No campaign data loaded</div>\n            <button class="empty-action" onclick="window.nextDebug.loadCampaign()">Load Campaign</button>\n          </div>\n        </div>\n      '}getPackagesContent(){const t=dt.getState(),e=Tt.getState(),i=t.data;return i?`\n      <div class="enhanced-panel">\n        ${this.getPackagesSection(i.packages,e)}\n      </div>\n    `:'\n        <div class="enhanced-panel">\n          <div class="empty-state">\n            <div class="empty-icon">ðŸ“¦</div>\n            <div class="empty-text">No campaign data loaded</div>\n          </div>\n        </div>\n      '}getShippingContent(){const t=dt.getState().data;return t?`\n      <div class="enhanced-panel">\n        ${this.getShippingMethodsSection(t.shipping_methods)}\n      </div>\n    `:'\n        <div class="enhanced-panel">\n          <div class="empty-state">\n            <div class="empty-icon">ðŸšš</div>\n            <div class="empty-text">No campaign data loaded</div>\n          </div>\n        </div>\n      '}getRawDataContent(){const t=dt.getState().data;return t?zh.generateRawDataContent(t):'\n        <div class="enhanced-panel">\n          <div class="empty-state">\n            <div class="empty-icon">ðŸ”§</div>\n            <div class="empty-text">No campaign data loaded</div>\n          </div>\n        </div>\n      '}getCampaignOverview(t){return`\n      <div class="campaign-overview">\n        <div class="campaign-header">\n          <h2 class="campaign-name">${t.name}</h2>\n          <div class="campaign-badges">\n            <span class="campaign-badge currency">${t.currency}</span>\n            <span class="campaign-badge language">${t.language.toUpperCase()}</span>\n          </div>\n        </div>\n        \n        <div class="metrics-grid">\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ“¦</div>\n            <div class="metric-content">\n              <div class="metric-value">${t.packages.length}</div>\n              <div class="metric-label">Total Packages</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸšš</div>\n            <div class="metric-content">\n              <div class="metric-value">${t.shipping_methods.length}</div>\n              <div class="metric-label">Shipping Methods</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ”„</div>\n            <div class="metric-content">\n              <div class="metric-value">${t.packages.filter(t=>t.is_recurring).length}</div>\n              <div class="metric-label">Recurring Items</div>\n            </div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-icon">ðŸ’°</div>\n            <div class="metric-content">\n              <div class="metric-value">${this.getPriceRange(t.packages)}</div>\n              <div class="metric-label">Price Range</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}getPackagesSection(t,e){return`\n      <div class="section">\n        <div class="section-header">\n          <h3 class="section-title">Available Packages</h3>\n          <div class="section-controls">\n            <button class="sort-btn" onclick="window.nextDebug.sortPackages('price')">Sort by Price</button>\n            <button class="sort-btn" onclick="window.nextDebug.sortPackages('name')">Sort by Name</button>\n          </div>\n        </div>\n        \n        <div class="packages-grid">\n          ${t.map(t=>this.getPackageCard(t,e)).join("")}\n        </div>\n      </div>\n    `}getPackageCard(t,e){const i=e.items.some(e=>e.packageId===t.ref_id),n=e.items.find(e=>e.packageId===t.ref_id),r=parseFloat(t.price_retail_total)-parseFloat(t.price_total),s=Math.round(r/parseFloat(t.price_retail_total)*100);return`\n      <div class="package-card ${i?"in-cart":""}" data-package-id="${t.ref_id}">\n        <div class="package-image-container">\n          <img src="${t.image}" alt="${t.name}" class="package-image" loading="lazy" />\n          ${t.is_recurring?'<div class="recurring-badge">ðŸ”„ Recurring</div>':""}\n          ${i?`<div class="cart-badge">In Cart (${(null==n?void 0:n.quantity)||0})</div>`:""}\n        </div>\n        \n        <div class="package-info">\n          <div class="package-header">\n            <h4 class="package-name">${t.name}</h4>\n            <div class="package-id">ID: ${t.ref_id}</div>\n          </div>\n          \n          <div class="package-details">\n            <div class="package-qty">Quantity: ${t.qty}</div>\n            <div class="package-external-id">External ID: ${t.external_id}</div>\n          </div>\n          \n          <div class="package-pricing">\n            <div class="price-row">\n              <span class="price-label">Sale Price:</span>\n              <span class="price-value sale-price">$${t.price_total}</span>\n            </div>\n            ${t.price_retail_total!==t.price_total?`\n              <div class="price-row">\n                <span class="price-label">Retail Price:</span>\n                <span class="price-value retail-price">$${t.price_retail_total}</span>\n              </div>\n              <div class="savings">\n                Save $${r.toFixed(2)} (${s}%)\n              </div>\n            `:""}\n            \n            ${t.is_recurring&&t.price_recurring?`\n              <div class="recurring-pricing">\n                <div class="price-row recurring">\n                  <span class="price-label">Recurring:</span>\n                  <span class="price-value recurring-price">\n                    $${t.price_recurring_total}/${t.interval}\n                  </span>\n                </div>\n              </div>\n            `:""}\n          </div>\n          \n          <div class="package-actions">\n            ${i?`\n              <button class="package-btn remove-btn" onclick="window.nextDebug.removeFromCart(${t.ref_id})">\n                Remove from Cart\n              </button>\n              <div class="qty-controls">\n                <button onclick="window.nextDebug.updateQuantity(${t.ref_id}, ${((null==n?void 0:n.quantity)||1)-1})">-</button>\n                <span>${(null==n?void 0:n.quantity)||0}</span>\n                <button onclick="window.nextDebug.updateQuantity(${t.ref_id}, ${((null==n?void 0:n.quantity)||1)+1})">+</button>\n              </div>\n            `:`\n              <button class="package-btn add-btn" onclick="window.nextDebug.addToCart(${t.ref_id})">\n                Add to Cart - $${t.price_total}\n              </button>\n            `}\n            <button class="package-btn inspect-btn" onclick="window.nextDebug.inspectPackage(${t.ref_id})">\n              Inspect\n            </button>\n          </div>\n        </div>\n      </div>\n    `}getShippingMethodsSection(t){return`\n      <div class="section">\n        <h3 class="section-title">Shipping Methods</h3>\n        \n        <div class="shipping-methods">\n          ${t.map(t=>`\n            <div class="shipping-method-card">\n              <div class="shipping-info">\n                <div class="shipping-name">${t.code}</div>\n                <div class="shipping-id">ID: ${t.ref_id}</div>\n              </div>\n              <div class="shipping-price">\n                ${0===parseFloat(t.price)?"FREE":`$${t.price}`}\n              </div>\n              <button class="shipping-test-btn" onclick="window.nextDebug.testShippingMethod(${t.ref_id})">\n                Test\n              </button>\n            </div>\n          `).join("")}\n        </div>\n      </div>\n    `}getPriceRange(t){const e=t.map(t=>parseFloat(t.price_total)).filter(t=>t>0);if(0===e.length)return"Free";const i=Math.min(...e),n=Math.max(...e);return i===n?`$${i}`:`$${i} - $${n}`}getActions(){return[{label:"Refresh Campaign",action:()=>{const t=yt.getState(),e=dt.getState();t.apiKey&&e.loadCampaign(t.apiKey)},variant:"primary"},{label:"Export Packages",action:()=>this.exportPackages(),variant:"secondary"},{label:"Test All Packages",action:()=>this.testAllPackages(),variant:"secondary"},{label:"Clear Cart",action:()=>Tt.getState().clear(),variant:"danger"}]}exportPackages(){const t=dt.getState().data;if(!t)return;const e={campaign:t.name,packages:t.packages,shipping_methods:t.shipping_methods,export_date:(new Date).toISOString()},i=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(i),r=document.createElement("a");r.href=n,r.download=`campaign-packages-${t.name.toLowerCase().replace(/\s+/g,"-")}.json`,r.click(),URL.revokeObjectURL(n)}testAllPackages(){const t=dt.getState(),e=Tt.getState(),i=t.data;i&&i.packages.slice(0,3).forEach(t=>{e.addItem({packageId:t.ref_id,quantity:1,title:t.name,isUpsell:!1})})}}const Zh=class t{constructor(){this.visible=!1,this.isExpanded=!1,this.container=null,this.shadowRoot=null,this.activePanel="cart",this.updateInterval=null,this.logger=new Y("DebugOverlay"),this.eventManager=null,this.panels=[],this.handleContainerClick=e=>{var i,n,r;const s=e.target,a=s.getAttribute("data-action")||(null==(i=s.closest("[data-action]"))?void 0:i.getAttribute("data-action"));if(a){switch(a){case"toggle-expand":this.isExpanded=!this.isExpanded,localStorage.setItem(t.EXPANDED_STORAGE_KEY,this.isExpanded.toString()),this.updateBodyHeight(),this.updateOverlay(),document.dispatchEvent(new CustomEvent("debug:panel-toggled",{detail:{isExpanded:this.isExpanded}}));break;case"close":this.hide();break;case"clear-cart":this.clearCart();break;case"export-data":this.exportAllData();break;case"toggle-mini-cart":this.toggleMiniCart();break;case"toggle-xray":this.toggleXray();break;case"close-mini-cart":this.closeMiniCart();break;case"toggle-internal-events":const e=this.panels.find(t=>"event-timeline"===t.id);e&&e.toggleInternalEvents&&(e.toggleInternalEvents(),this.updateContent())}return}const o=s.closest(".debug-panel-tab");if(o){const e=o.getAttribute("data-panel");return void(e&&e!==this.activePanel&&(this.activePanel=e,this.activePanelTab=void 0,localStorage.setItem(t.ACTIVE_PANEL_KEY,e),localStorage.removeItem(t.ACTIVE_TAB_KEY),this.updateOverlay()))}const c=s.closest(".horizontal-tab");if(c){const e=c.getAttribute("data-panel-tab");return void(e&&e!==this.activePanelTab&&(this.activePanelTab=e,localStorage.setItem(t.ACTIVE_TAB_KEY,e),this.updateOverlay()))}const l=s.closest(".panel-action-btn");if(l){const t=l.getAttribute("data-panel-action"),e=this.panels.find(t=>t.id===this.activePanel),i=null==(r=null==(n=null==e?void 0:e.getActions)?void 0:n.call(e))?void 0:r.find(e=>e.label===t);return void(i&&(i.action(),setTimeout(()=>this.updateContent(),100)))}};const e=new URLSearchParams(window.location.search);if("true"===e.get("debugger")||"true"===e.get("debug")){this.eventManager=new Eh,this.initializePanels(),this.setupEventListeners(),"true"===localStorage.getItem(t.EXPANDED_STORAGE_KEY)&&(this.isExpanded=!0);const e=localStorage.getItem(t.ACTIVE_PANEL_KEY);e&&(this.activePanel=e);const i=localStorage.getItem(t.ACTIVE_TAB_KEY);i&&(this.activePanelTab=i)}}static getInstance(){return t.instance||(t.instance=new t),t.instance}initializePanels(){this.panels=[new qh,new jh,new Jh,new Qh,new Gh,new Bh,new Kh]}setupEventListeners(){document.addEventListener("debug:update-content",()=>{this.updateContent()}),document.addEventListener("debug:event-added",t=>{const e=t,{panelId:i}=e.detail;this.activePanel===i&&this.isExpanded&&this.updateContent()})}initialize(){"true"===new URLSearchParams(window.location.search).get("debugger")&&(this.show(),this.logger.info("Debug overlay initialized"),Nh.initialize(),this.logger.info("Selector container initialized"))}show(){return g(this,null,function*(){this.visible||(this.visible=!0,yield this.createOverlay(),this.startAutoUpdate(),Ih.initialize(),"true"===localStorage.getItem("debug-mini-cart-visible")&&this.toggleMiniCart(!0),this.updateButtonStates())})}hide(){this.visible&&(this.visible=!1,this.stopAutoUpdate(),document.body.classList.remove("debug-body-expanded"),document.documentElement.classList.remove("debug-body-expanded"),Nh.destroy(),this.container&&(this.container.remove(),this.container=null,this.shadowRoot=null))}toggle(){return g(this,null,function*(){this.visible?this.hide():yield this.show()})}isVisible(){return this.visible}createOverlay(){return g(this,null,function*(){this.container=document.createElement("div"),this.container.id="next-debug-overlay-host",this.container.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      z-index: 2147483647;\n      pointer-events: none;\n    ",this.shadowRoot=this.container.attachShadow({mode:"open"}),yield this.injectShadowStyles();const t=document.createElement("div");t.className="debug-overlay",t.style.pointerEvents="auto",this.shadowRoot.appendChild(t),this.updateOverlay(),this.addEventListeners(),document.body.appendChild(this.container)})}injectShadowStyles(){return g(this,null,function*(){if(!this.shadowRoot)return;const{DebugStyleLoader:t}=yield Promise.resolve().then(()=>dp),e=yield t.getDebugStyles(),i=document.createElement("style");i.textContent=e,this.shadowRoot.appendChild(i);const n=document.createElement("style");n.textContent="\n      :host {\n        all: initial;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n        font-size: 14px;\n        line-height: 1.5;\n        color: #e0e0e0;\n        -webkit-font-smoothing: antialiased;\n        -moz-osx-font-smoothing: grayscale;\n      }\n      \n      * {\n        box-sizing: border-box;\n      }\n      \n      /* Ensure debug overlay is always on top */\n      .debug-overlay {\n        position: fixed;\n        z-index: 2147483647;\n      }\n    ",this.shadowRoot.appendChild(n)})}updateOverlay(){if(!this.shadowRoot)return;const t=this.shadowRoot.querySelector(".debug-overlay");t&&(t.innerHTML=$h.createOverlayHTML(this.panels,this.activePanel,this.isExpanded,this.activePanelTab),this.addEventListeners(),this.updateButtonStates())}updateContent(){var t,e;if(!this.shadowRoot)return;const i=this.shadowRoot.querySelector(".panel-content");if(i){const n=this.panels.find(t=>t.id===this.activePanel);if(n){const r=(null==(t=n.getTabs)?void 0:t.call(n))||[];if(r.length>0){const t=this.activePanelTab||(null==(e=r[0])?void 0:e.id),n=r.find(e=>e.id===t)||r[0];n&&(i.innerHTML=n.getContent())}else i.innerHTML=n.getContent()}}}addEventListeners(){this.shadowRoot&&(this.shadowRoot.removeEventListener("click",this.handleContainerClick),this.shadowRoot.addEventListener("click",this.handleContainerClick))}updateBodyHeight(){this.isExpanded?(document.body.classList.add("debug-body-expanded"),document.documentElement.classList.add("debug-body-expanded")):(document.body.classList.remove("debug-body-expanded"),document.documentElement.classList.remove("debug-body-expanded"))}startAutoUpdate(){this.updateInterval=window.setInterval(()=>{this.updateQuickStats(),"cart"!==this.activePanel&&"config"!==this.activePanel&&"campaign"!==this.activePanel||"raw"===this.activePanelTab||this.updateContent()},1e3)}stopAutoUpdate(){this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null)}getEventManager(){return this.eventManager||null}getPanels(){return this.panels||[]}setActivePanel(e){this.panels.find(t=>t.id===e)&&(this.activePanel=e,localStorage.setItem(t.ACTIVE_PANEL_KEY,e),this.updateOverlay())}logEvent(t,e,i="Manual"){this.eventManager&&this.eventManager.logEvent(t,e,i)}clearCart(){Tt.getState().clear(),this.updateContent()}exportAllData(){const t={timestamp:(new Date).toISOString(),cart:Tt.getState(),config:yt.getState(),events:this.eventManager?this.eventManager.getEvents():[],url:window.location.href,userAgent:navigator.userAgent},e=JSON.stringify(t,null,2),i=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(i),r=document.createElement("a");r.href=n,r.download=`debug-session-${(new Date).toISOString()}.json`,r.click(),URL.revokeObjectURL(n)}closeMiniCart(){if(!this.shadowRoot)return;const t=this.shadowRoot.querySelector("#debug-mini-cart-display");if(t){t.classList.remove("show"),localStorage.setItem("debug-mini-cart-visible","false");const e=this.shadowRoot.querySelector('[data-action="toggle-mini-cart"]');e&&(e.classList.remove("active"),e.setAttribute("title","Toggle Mini Cart"))}}toggleMiniCart(t){var e;if(!this.shadowRoot)return;let i=this.shadowRoot.querySelector("#debug-mini-cart-display");i?(i.classList.toggle("show"),i.classList.contains("show")&&this.updateMiniCart()):(i=document.createElement("div"),i.id="debug-mini-cart-display",i.className="debug-mini-cart-display",this.shadowRoot.appendChild(i),Tt.subscribe(()=>{var t;const e=null==(t=this.shadowRoot)?void 0:t.querySelector("#debug-mini-cart-display");e&&e.classList.contains("show")&&this.updateMiniCart()}),!1!==t&&(i.classList.add("show"),this.updateMiniCart())),localStorage.setItem("debug-mini-cart-visible",i.classList.contains("show").toString());const n=null==(e=this.shadowRoot)?void 0:e.querySelector('[data-action="toggle-mini-cart"]');n&&i&&(i.classList.contains("show")?(n.classList.add("active"),n.setAttribute("title","Hide Mini Cart")):(n.classList.remove("active"),n.setAttribute("title","Toggle Mini Cart")))}updateMiniCart(){if(!this.shadowRoot)return;const t=this.shadowRoot.querySelector("#debug-mini-cart-display");if(!t||!t.classList.contains("show"))return;const e=Tt.getState();if(!e.items||0===e.items.length)return void(t.innerHTML='\n        <div class="debug-mini-cart-header">\n          <span>ðŸ›’ Debug Cart</span>\n          <button class="mini-cart-close" data-action="close-mini-cart">Ã—</button>\n        </div>\n        <div class="debug-mini-cart-empty">Cart empty</div>\n      ');let i="";e.items.forEach(t=>{const e=t.is_upsell?'<span class="mini-cart-upsell-badge">UPSELL</span>':"";i+=`\n        <div class="debug-mini-cart-item">\n          <div class="mini-cart-item-info">\n            <span class="mini-cart-item-id">ID: ${t.packageId}</span>\n            ${e}\n            <span class="mini-cart-item-qty">Ã—${t.quantity}</span>\n          </div>\n          <div class="mini-cart-item-title">${t.title||"Unknown"}</div>\n          <div class="mini-cart-item-price">$${(t.price*t.quantity).toFixed(2)}</div>\n        </div>\n      `}),t.innerHTML=`\n      <div class="debug-mini-cart-header">\n        <span>ðŸ›’ Debug Cart</span>\n        <button class="mini-cart-close" data-action="close-mini-cart">Ã—</button>\n      </div>\n      <div class="debug-mini-cart-items">${i}</div>\n      <div class="debug-mini-cart-footer">\n        <div class="mini-cart-stat">\n          <span>Items:</span>\n          <span>${e.totalQuantity}</span>\n        </div>\n        <div class="mini-cart-stat">\n          <span>Total:</span>\n          <span class="mini-cart-total">${e.totals.total.formatted}</span>\n        </div>\n      </div>\n    `}toggleXray(){var t;const e=Ih.toggle(),i=null==(t=this.shadowRoot)?void 0:t.querySelector('[data-action="toggle-xray"]');i&&(e?(i.classList.add("active"),i.setAttribute("title","Disable X-Ray View")):(i.classList.remove("active"),i.setAttribute("title","Toggle X-Ray View"))),this.eventManager&&this.eventManager.logEvent("debug:xray-toggled",{active:e},"Debug")}updateButtonStates(){if(!this.shadowRoot)return;const t=this.shadowRoot.querySelector('[data-action="toggle-xray"]');t&&(Ih.isXrayActive()?(t.classList.add("active"),t.setAttribute("title","Disable X-Ray View")):(t.classList.remove("active"),t.setAttribute("title","Toggle X-Ray View")));const e=this.shadowRoot.querySelector("#debug-mini-cart-display"),i=this.shadowRoot.querySelector('[data-action="toggle-mini-cart"]');i&&(e&&e.classList.contains("show")?(i.classList.add("active"),i.setAttribute("title","Hide Mini Cart")):(i.classList.remove("active"),i.setAttribute("title","Toggle Mini Cart")))}updateQuickStats(){if(!this.shadowRoot)return;const t=Tt.getState(),e=this.shadowRoot.querySelector('[data-debug-stat="cart-items"]'),i=this.shadowRoot.querySelector('[data-debug-stat="cart-total"]'),n=this.shadowRoot.querySelector('[data-debug-stat="enhanced-elements"]');e&&(e.textContent=t.totalQuantity.toString()),i&&(i.textContent=t.totals.total.formatted),n&&(n.textContent=document.querySelectorAll("[data-next-]").length.toString())}};Zh.EXPANDED_STORAGE_KEY="debug-overlay-expanded",Zh.ACTIVE_PANEL_KEY="debug-overlay-active-panel",Zh.ACTIVE_TAB_KEY="debug-overlay-active-tab";let Wh=Zh;const Yh=Wh.getInstance();"undefined"!=typeof window&&document.addEventListener("DOMContentLoaded",()=>{Yh.initialize()});const Xh=Object.freeze(Object.defineProperty({__proto__:null,DebugOverlay:Wh,debugOverlay:Yh},Symbol.toStringTag,{value:"Module"}));tt("Analytics");const tp=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),ep=".enhanced-debug-overlay{position:fixed;bottom:0;left:0;right:0;z-index:999999;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,SF Pro Display,sans-serif;font-size:13px;line-height:1.4;color:#fff;transition:all .3s cubic-bezier(.4,0,.2,1);box-shadow:0 -4px 32px #0000004d}.enhanced-debug-overlay.collapsed{height:60px}.enhanced-debug-overlay.expanded{height:40vh;min-height:450px;max-height:calc(100vh - 120px)}body:has(.enhanced-debug-overlay.expanded){padding-bottom:40vh}.debug-body-expanded{padding-bottom:40vh!important;box-sizing:border-box}html.debug-body-expanded{overflow-x:hidden}.debug-bottom-bar{display:flex;align-items:center;justify-content:space-between;height:60px;background:linear-gradient(135deg,#1a1a1a,#2d2d2d);border-top:1px solid #3C7DFF;padding:0 20px;backdrop-filter:blur(20px)}.debug-logo-section{display:flex;align-items:center;gap:12px}.debug-logo{color:#3c7dff;filter:drop-shadow(0 0 8px rgba(60,125,255,.3))}.debug-title{font-weight:600;font-size:16px;color:#fff;letter-spacing:-.2px}.debug-status{display:flex;align-items:center;gap:6px;margin-left:12px;padding:4px 8px;background:#3c7dff1a;border-radius:12px;border:1px solid rgba(60,125,255,.2)}.status-indicator{width:6px;height:6px;border-radius:50%;background:#0f8;box-shadow:0 0 6px #0f8;animation:pulse 2s infinite}@keyframes pulse{0%,to{opacity:1}50%{opacity:.5}}.status-text{font-size:11px;color:#3c7dff;font-weight:500}.debug-quick-stats{display:flex;align-items:center;gap:24px}.stat-item{display:flex;flex-direction:column;align-items:center;gap:2px}.stat-value{font-size:16px;font-weight:700;color:#3c7dff;min-width:40px;text-align:center}.stat-label{font-size:10px;color:#888;text-transform:uppercase;font-weight:500;letter-spacing:.5px}.debug-controls{display:flex;align-items:center;gap:8px}.debug-control-btn,.debug-expand-btn{width:36px;height:36px;border:none;border-radius:8px;background:#ffffff1a;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease;position:relative;overflow:hidden}.debug-control-btn:hover,.debug-expand-btn:hover{background:#3c7dff33;transform:translateY(-1px);box-shadow:0 4px 12px #3c7dff4d}.debug-control-btn.active{background:#3c7dff4d;color:#87b4ff;box-shadow:inset 0 0 0 1px #3c7dff80}.debug-control-btn.active:hover{background:#3c7dff66}.debug-expand-btn{background:#3c7dff;color:#fff}.debug-expand-btn:hover{background:#2563eb;transform:translateY(-1px) scale(1.05)}.expand-icon{transition:transform .3s ease}.expand-icon.rotated{transform:rotate(180deg)}.close-btn:hover{background:#ff475733!important;color:#ff4757}.debug-expanded-content{display:flex;height:calc(100% - 60px);background:#1a1a1a}.debug-highlight{outline:2px solid #3C7DFF!important;outline-offset:2px!important;background:#3c7dff1a!important;position:relative!important;z-index:999998!important}.debug-highlight:after{content:attr(data-debug-label);position:absolute;top:-30px;left:0;background:#3c7dff;color:#fff;padding:4px 8px;border-radius:4px;font-size:11px;font-weight:500;white-space:nowrap;z-index:999999}@media (max-width: 768px){.debug-quick-stats{display:none}.debug-bottom-bar{padding:0 12px}}@media (max-width: 640px){.debug-title{display:none}}",ip='.debug-sidebar{width:240px;background:linear-gradient(180deg,#222,#1a1a1a);border-right:1px solid #333;display:flex;flex-direction:column}.debug-panel-tabs{flex:1;padding:16px 0}.debug-panel-tab{width:100%;display:flex;align-items:center;gap:12px;padding:12px 20px;border:none;background:none;color:#888;cursor:pointer;transition:all .2s ease;position:relative;font-size:14px}.debug-panel-tab:hover{background:#3c7dff1a;color:#fff}.debug-panel-tab.active{background:#3c7dff26;color:#3c7dff;border-right:3px solid #3C7DFF}.debug-panel-tab.active:before{content:"";position:absolute;left:0;top:0;bottom:0;width:3px;background:#3c7dff}.tab-icon{font-size:16px;width:20px;text-align:center}.tab-label{font-weight:500;flex:1}.tab-badge{background:#3c7dff;color:#fff;font-size:10px;font-weight:600;padding:2px 6px;border-radius:10px;min-width:16px;text-align:center}.debug-sidebar-footer{padding:16px;border-top:1px solid #333;display:flex;flex-direction:column;gap:8px}.sidebar-btn{display:flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid #333;border-radius:6px;background:#ffffff0d;color:#888;cursor:pointer;font-size:12px;transition:all .2s ease}.sidebar-btn:hover{background:#3c7dff1a;border-color:#3c7dff;color:#3c7dff}@media (max-width: 768px){.debug-sidebar{width:200px}}@media (max-width: 640px){.debug-sidebar{width:180px}}',np=".debug-main-content{flex:1;background:#1a1a1a;overflow:hidden;display:flex;flex-direction:column}.debug-panel-container{flex:1;display:flex;flex-direction:column;height:100%}.panel-header{display:flex;align-items:center;justify-content:space-between;padding:6px 12px;border-bottom:1px solid #333;background:linear-gradient(135deg,#222,#1a1a1a)}.panel-title{display:flex;align-items:center;gap:12px}.panel-icon{font-size:20px}.panel-title h2{margin:0;font-size:18px;font-weight:600;color:#fff}.panel-actions{display:flex;gap:8px}.panel-action-btn{padding:8px 16px;border:none;border-radius:6px;font-size:12px;font-weight:500;cursor:pointer;transition:all .2s ease}.panel-action-btn.primary{background:#3c7dff;color:#fff}.panel-action-btn.secondary{background:#ffffff1a;color:#fff;border:1px solid #333}.panel-action-btn.danger{background:#ff47571a;color:#ff4757;border:1px solid rgba(255,71,87,.3)}.panel-action-btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px #0000004d}.panel-action-btn.primary:hover{background:#2563eb}.panel-action-btn.secondary:hover{background:#ffffff26}.panel-action-btn.danger:hover{background:#ff475733}.panel-horizontal-tabs{display:flex;background:#1a1a1a;border-bottom:1px solid #333;overflow-x:auto}.horizontal-tab{display:flex;align-items:center;gap:8px;padding:12px 20px;background:none;border:none;color:#888;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s ease;white-space:nowrap;border-bottom:2px solid transparent}.horizontal-tab:hover{background:#ffffff0d;color:#ccc}.horizontal-tab.active{color:#3c7dff;border-bottom-color:#3c7dff;background:#3c7dff0d}.horizontal-tab .tab-icon{font-size:14px}.horizontal-tab .tab-label{font-weight:500}.panel-content{flex:1;padding:24px;overflow-y:auto;color:#ccc}.panel-content.no-padding{padding:0}.panel-content::-webkit-scrollbar{width:8px}.panel-content::-webkit-scrollbar-track{background:#ffffff05;border-radius:4px}.panel-content::-webkit-scrollbar-thumb{background:#ffffff1a;border-radius:4px;transition:background .2s ease}.panel-content::-webkit-scrollbar-thumb:hover{background:#fff3}.panel-content::-webkit-scrollbar-thumb:active{background:#ffffff4d}.panel-content{scrollbar-width:thin;scrollbar-color:rgba(255,255,255,.1) rgba(255,255,255,.02)}.panel-content>.enhanced-panel{margin-top:0}.panel-content>.enhanced-panel>*:first-child{margin-top:0}.panel-content .section:first-child,.panel-content .section:first-child .section-title,.panel-content h3:first-child,.panel-content .section-title:first-child,.panel-content h1,.panel-content h2,.panel-content h3,.panel-content h4,.panel-content h5,.panel-content h6{margin-top:0}.enhanced-panel{display:flex;flex-direction:column;gap:24px}.metrics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:16px}.metric-card{background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:8px;padding:16px;display:flex;align-items:center;gap:12px;transition:all .2s ease}.metric-card:hover{border-color:#3c7dff;box-shadow:0 4px 12px #3c7dff1a}.metric-icon{font-size:20px;width:32px;text-align:center}.metric-content{flex:1}.metric-value{font-size:18px;font-weight:700;color:#3c7dff;line-height:1}.metric-label{font-size:11px;color:#888;text-transform:uppercase;font-weight:500;letter-spacing:.5px;margin-top:2px}.section{display:flex;flex-direction:column;gap:16px}.section-title{font-size:16px;font-weight:600;color:#fff;margin:0;padding-bottom:8px;border-bottom:1px solid #333}.section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.section-controls{display:flex;gap:8px}.sort-btn{background:#ffffff1a;border:1px solid #333;color:#ccc;padding:6px 12px;border-radius:6px;font-size:12px;cursor:pointer;transition:all .2s ease}.sort-btn:hover{background:#3c7dff1a;border-color:#3c7dff;color:#3c7dff}.empty-state{display:flex;flex-direction:column;align-items:center;gap:12px;padding:40px 20px;color:#888;text-align:center}.empty-icon{font-size:32px;opacity:.5}.empty-text{font-size:14px}.empty-action{background:#3c7dff;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:12px;font-weight:500}.json-viewer{background:#0f0f0f;border:1px solid #333;border-radius:8px;overflow:hidden}.json-viewer pre{margin:0;padding:16px;overflow-x:auto;font-family:SF Mono,monospace;font-size:12px;line-height:1.6;color:#e6e6e6}.debug-metric{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid #2a2a2a}.debug-metric:last-child{border-bottom:none}.metric-label{color:#888;font-weight:500}.metric-value{color:#3c7dff;font-family:SF Mono,monospace;font-weight:600}@media (max-width: 768px){.panel-header,.panel-content{padding:16px}.metrics-grid{grid-template-columns:repeat(auto-fit,minmax(120px,1fr))}}",rp=".cart-items-list{display:flex;flex-direction:column;gap:8px}.cart-item-card{background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:8px;padding:16px;display:flex;align-items:center;gap:16px}.item-info{flex:1}.item-title{font-weight:600;color:#fff;margin-bottom:4px}.item-details{font-size:12px;color:#888}.item-quantity{display:flex;align-items:center;gap:8px}.qty-btn{width:24px;height:24px;border:1px solid #333;background:#ffffff0d;color:#fff;border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:600}.qty-btn:hover{background:#3c7dff1a;border-color:#3c7dff}.qty-value{font-weight:600;color:#3c7dff;min-width:20px;text-align:center}.item-total{font-weight:600;color:#3c7dff}.remove-btn{width:24px;height:24px;border:1px solid rgba(255,71,87,.3);background:#ff47571a;color:#ff4757;border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:600}.remove-btn:hover{background:#ff475733}.elements-list{display:flex;flex-direction:column;gap:8px}.element-card{background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:8px;padding:16px;cursor:pointer;transition:all .2s ease}.element-card:hover{border-color:#3c7dff;box-shadow:0 4px 12px #3c7dff1a}.element-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.element-tag{background:#3c7dff;color:#fff;padding:2px 6px;border-radius:4px;font-size:10px;font-weight:600;text-transform:uppercase}.element-index{color:#888;font-size:12px}.element-attributes,.element-enhancers{display:flex;flex-wrap:wrap;gap:4px;margin-top:8px}.attribute-tag{background:#ffffff1a;color:#ccc;padding:2px 6px;border-radius:3px;font-size:10px;font-family:SF Mono,monospace}.enhancer-tag{background:#3c7dff33;color:#3c7dff;padding:2px 6px;border-radius:3px;font-size:10px;font-weight:500}.requests-list{display:flex;flex-direction:column;gap:8px}.request-card{background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:8px;padding:16px}.request-card.error{border-color:#ff47574d}.request-card.success{border-color:#00ff884d}.request-header{display:flex;align-items:center;gap:12px;margin-bottom:8px}.request-method{padding:2px 6px;border-radius:3px;font-size:10px;font-weight:600;text-transform:uppercase}.request-method.get{background:#0f83;color:#0f8}.request-method.post{background:#3c7dff33;color:#3c7dff}.request-method.put{background:#ffc10733;color:#ffc107}.request-method.delete{background:#ff475733;color:#ff4757}.request-url{flex:1;color:#ccc;font-family:SF Mono,monospace;font-size:12px}.request-status{padding:2px 6px;border-radius:3px;font-size:10px;font-weight:600}.request-status.status-2xx{background:#0f83;color:#0f8}.request-status.status-4xx,.request-status.status-5xx{background:#ff475733;color:#ff4757}.request-time{color:#888;font-size:11px;font-family:SF Mono,monospace}.request-timestamp{color:#666;font-size:11px;margin-bottom:8px}.request-details summary{cursor:pointer;color:#3c7dff;font-size:12px;margin-top:8px}.request-data,.response-data{margin-top:12px}.request-data h4,.response-data h4{margin:0 0 8px;color:#fff;font-size:12px}.event-types{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px}.event-type-card{background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:6px;padding:12px;text-align:center;cursor:pointer;transition:all .2s ease}.event-type-card:hover{border-color:#3c7dff;box-shadow:0 2px 8px #3c7dff1a}.event-type-name{font-size:12px;color:#fff;font-weight:500}.event-type-count{font-size:16px;color:#3c7dff;font-weight:700;margin-top:4px}.events-timeline{display:flex;flex-direction:column;gap:12px}.timeline-event{display:flex;gap:16px;background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:8px;padding:16px}.event-time{color:#888;font-size:11px;font-family:SF Mono,monospace;white-space:nowrap;width:80px}.event-content{flex:1}.event-header{display:flex;align-items:center;gap:8px;margin-bottom:4px}.event-type-badge{background:#3c7dff;color:#fff;padding:2px 6px;border-radius:3px;font-size:10px;font-weight:600;text-transform:uppercase}.event-source{color:#888;font-size:10px;text-transform:uppercase;font-weight:500}.event-data-preview{color:#ccc;font-size:12px;font-family:SF Mono,monospace}.event-item{background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:8px;padding:16px;margin-bottom:12px;transition:all .2s ease}.event-item:hover{border-color:#3c7dff;box-shadow:0 4px 12px #3c7dff1a}.event-item .event-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.event-type{background:#3c7dff;color:#fff;padding:4px 8px;border-radius:4px;font-size:10px;font-weight:600;text-transform:uppercase}.event-data{background:#0f0f0f;border-radius:4px;padding:12px;font-family:SF Mono,monospace;font-size:11px;color:#ccc;max-height:120px;overflow-y:auto}.debug-mini-cart-display{position:fixed;top:20px;right:20px;background:#000000f2;border:1px solid #333;border-radius:8px;padding:0;min-width:280px;max-width:350px;max-height:400px;box-shadow:0 8px 32px #00000080;font-family:SF Mono,monospace;font-size:12px;color:#ccc;z-index:10000;display:none;overflow:hidden}.debug-mini-cart-display.show{display:block}.debug-mini-cart-header{background:linear-gradient(135deg,#1a1a1a,#111);padding:12px 16px;border-bottom:1px solid #333;display:flex;justify-content:space-between;align-items:center;font-weight:600;color:#3c7dff}.debug-mini-cart-header span{display:flex;align-items:center;gap:8px}.mini-cart-close{background:transparent;border:none;color:#888;font-size:20px;cursor:pointer;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:all .2s ease}.mini-cart-close:hover{background:#ff475733;color:#ff4757}.debug-mini-cart-empty{padding:40px 20px;text-align:center;color:#666;font-style:italic}.debug-mini-cart-items{max-height:280px;overflow-y:auto;padding:8px}.debug-mini-cart-item{background:#ffffff08;border:1px solid rgba(255,255,255,.05);border-radius:6px;padding:10px;margin-bottom:6px;transition:all .2s ease}.debug-mini-cart-item:hover{background:#3c7dff0d;border-color:#3c7dff33}.debug-mini-cart-item:last-child{margin-bottom:0}.mini-cart-item-info{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}.mini-cart-item-id{color:#3c7dff;font-weight:600;font-size:11px}.mini-cart-item-qty{color:#ffc107;font-weight:600;font-size:11px}.mini-cart-upsell-badge{background:#ff4757;color:#fff;padding:1px 4px;border-radius:3px;font-size:9px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin:0 4px}.mini-cart-item-title{color:#fff;font-size:11px;margin-bottom:4px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.mini-cart-item-price{color:#0f8;font-weight:600;font-size:12px;text-align:right}.debug-mini-cart-footer{background:linear-gradient(135deg,#1a1a1a,#111);border-top:1px solid #333;padding:12px 16px;display:flex;justify-content:space-between;align-items:center}.mini-cart-stat{display:flex;align-items:center;gap:6px}.mini-cart-stat span:first-child{color:#888;font-size:11px}.mini-cart-stat span:last-child{color:#fff;font-weight:600}.mini-cart-total{color:#0f8!important;font-size:14px}.debug-mini-cart-items::-webkit-scrollbar{width:6px}.debug-mini-cart-items::-webkit-scrollbar-track{background:#ffffff05;border-radius:3px}.debug-mini-cart-items::-webkit-scrollbar-thumb{background:#3c7dff4d;border-radius:3px}.debug-mini-cart-items::-webkit-scrollbar-thumb:hover{background:#3c7dff80}",sp=".campaign-overview{background:linear-gradient(135deg,#2a2a2a,#1a1a1a);border:1px solid #333;border-radius:12px;padding:24px;margin-bottom:24px}.campaign-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.campaign-name{margin:0;font-size:24px;font-weight:700;color:#fff;background:linear-gradient(135deg,#3c7dff,#00d4ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.campaign-badges{display:flex;gap:8px}.campaign-badge{padding:4px 8px;border-radius:6px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.campaign-badge.currency{background:#3c7dff33;color:#3c7dff}.campaign-badge.language{background:#0f83;color:#0f8}.packages-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:20px;margin-bottom:32px}.package-card{background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:12px;overflow:hidden;transition:all .3s ease;position:relative}.package-card:hover{border-color:#3c7dff;box-shadow:0 8px 32px #3c7dff1a;transform:translateY(-2px)}.package-card.in-cart{border-color:#0f8;background:linear-gradient(135deg,#00ff881a,#1a1a1a)}.package-image-container{position:relative;height:140px;background:#f8f9fa;display:flex;align-items:center;justify-content:center;overflow:hidden}.package-image{max-width:100%;max-height:100%;object-fit:contain}.recurring-badge,.cart-badge{position:absolute;top:8px;right:8px;background:#3c7dff;color:#fff;padding:4px 8px;border-radius:12px;font-size:10px;font-weight:600}.cart-badge{background:#0f8;color:#000;top:8px;left:8px}.package-info{padding:16px}.package-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}.package-name{margin:0;font-size:16px;font-weight:600;color:#fff;line-height:1.3}.package-id{font-size:11px;color:#888;font-family:SF Mono,monospace}.package-details{display:flex;gap:16px;margin-bottom:12px;font-size:12px;color:#888}.package-pricing{margin-bottom:16px}.price-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}.price-label{font-size:12px;color:#888}.price-value{font-weight:600;font-family:SF Mono,monospace}.sale-price{color:#3c7dff;font-size:16px}.retail-price{color:#888;text-decoration:line-through}.recurring-price{color:#ff6b6b}.savings{background:#00ff881a;color:#0f8;padding:4px 8px;border-radius:6px;font-size:11px;font-weight:600;text-align:center;margin-top:8px}.recurring-pricing{border-top:1px solid #333;padding-top:8px;margin-top:8px}.package-actions{display:flex;gap:8px;align-items:center}.package-btn{padding:8px 12px;border:none;border-radius:6px;font-size:12px;font-weight:500;cursor:pointer;transition:all .2s ease;flex:1}.add-btn{background:#3c7dff;color:#fff}.add-btn:hover{background:#2563eb}.remove-btn{background:#ff47571a;color:#ff4757;border:1px solid rgba(255,71,87,.3)}.remove-btn:hover{background:#ff475733}.inspect-btn{background:#ffffff1a;color:#ccc;border:1px solid #333;flex:0 0 auto}.inspect-btn:hover{background:#ffffff26;color:#fff}.qty-controls{display:flex;align-items:center;gap:8px;flex:0 0 auto}.qty-controls button{width:24px;height:24px;border:1px solid #333;background:#ffffff0d;color:#fff;border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:600}.qty-controls span{font-weight:600;color:#3c7dff;min-width:20px;text-align:center}.shipping-methods{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px;margin-bottom:24px}.shipping-method-card{background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:8px;padding:16px;display:flex;align-items:center;gap:16px;transition:all .2s ease}.shipping-method-card:hover{border-color:#3c7dff;box-shadow:0 4px 12px #3c7dff1a}.shipping-info{flex:1}.shipping-name{font-size:16px;font-weight:600;color:#fff;margin-bottom:4px}.shipping-id{font-size:11px;color:#888;font-family:SF Mono,monospace}.shipping-price{font-size:18px;font-weight:700;color:#3c7dff;font-family:SF Mono,monospace}.shipping-test-btn{background:#3c7dff1a;border:1px solid #3C7DFF;color:#3c7dff;padding:8px 16px;border-radius:6px;font-size:12px;font-weight:500;cursor:pointer;transition:all .2s ease}.shipping-test-btn:hover{background:#3c7dff33}.raw-data-section{background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:8px;overflow:hidden}.raw-data-summary{padding:16px;cursor:pointer;display:flex;align-items:center;justify-content:space-between;user-select:none}.raw-data-summary:hover{background:#ffffff0d}.toggle-icon{color:#888;transition:transform .2s ease}.raw-data-section[open] .toggle-icon{transform:rotate(180deg)}.raw-data-section .json-viewer{border-top:1px solid #333;margin:0}@media (max-width: 768px){.packages-grid,.shipping-methods{grid-template-columns:1fr}.campaign-header{flex-direction:column;align-items:flex-start;gap:12px}.package-card{margin-bottom:16px}.package-actions{flex-direction:column;gap:8px}.package-btn{width:100%}}",ap=".enhanced-panel{display:flex;flex-direction:column;gap:24px}.metrics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:16px}.metric-card{background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:8px;padding:16px;display:flex;align-items:center;gap:12px;transition:all .2s ease}.metric-card:hover{border-color:#3c7dff;box-shadow:0 4px 12px #3c7dff1a}.metric-icon{font-size:20px;width:32px;text-align:center}.metric-content{flex:1}.metric-value{font-size:18px;font-weight:700;color:#3c7dff;line-height:1}.metric-label{font-size:11px;color:#888;text-transform:uppercase;font-weight:500;letter-spacing:.5px;margin-top:2px}.section{display:flex;flex-direction:column;gap:16px}.section-title{font-size:16px;font-weight:600;color:#fff;margin:0;padding-bottom:8px;border-bottom:1px solid #333}.empty-state{display:flex;flex-direction:column;align-items:center;gap:12px;padding:40px 20px;color:#888;text-align:center}.empty-icon{font-size:32px;opacity:.5}.empty-text{font-size:14px}.empty-action{background:#3c7dff;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:12px;font-weight:500}.config-groups{display:flex;flex-direction:column;gap:24px}.config-group{background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:8px;padding:20px}.config-group-title{font-size:14px;font-weight:600;color:#fff;margin:0 0 16px;padding-bottom:8px;border-bottom:1px solid #333}.config-items{display:flex;flex-direction:column;gap:12px}.config-item{display:flex;justify-content:space-between;align-items:center;padding:8px 0}.config-key{font-size:12px;color:#ccc;font-weight:500}.config-value{font-size:12px;color:#fff;font-family:SF Mono,monospace}.config-value.enabled{color:#0f8}.config-value.disabled{color:#888}.form-fields-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:12px}.field-status-card{background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:6px;padding:12px;text-align:center;transition:all .2s ease}.field-status-card.filled{border-color:#00ff884d;background:linear-gradient(135deg,#00ff881a,#1a1a1a)}.field-status-card.error{border-color:#ff47574d;background:linear-gradient(135deg,#ff47571a,#1a1a1a)}.field-name{font-size:11px;color:#ccc;font-weight:500;margin-bottom:4px}.field-status{font-size:14px}.customer-info{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}.info-card{background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:8px;padding:16px}.info-card h4{margin:0 0 12px;font-size:14px;color:#fff;font-weight:600}.info-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.info-label{font-size:12px;color:#888}.info-value{font-size:12px;color:#fff;font-family:SF Mono,monospace}.info-empty{color:#666;font-style:italic;font-size:12px}.address-info,.validation-errors{display:flex;flex-direction:column;gap:8px}.error-item{background:linear-gradient(135deg,#ff47571a,#1a1a1a);border:1px solid rgba(255,71,87,.3);border-radius:6px;padding:12px;display:flex;gap:8px}.error-field{font-weight:600;color:#ff4757;font-size:12px}.error-message{color:#ccc;font-size:12px}.storage-items{display:flex;flex-direction:column;gap:12px}.storage-item-card{background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:8px;padding:16px;transition:all .2s ease}.storage-item-card.next-item{border-color:#3c7dff4d;background:linear-gradient(135deg,#3c7dff0d,#1a1a1a)}.storage-item-header{display:flex;align-items:center;gap:12px;margin-bottom:8px}.storage-key{flex:1;font-family:SF Mono,monospace;font-size:12px;color:#fff;font-weight:500}.storage-type{padding:2px 6px;border-radius:3px;font-size:10px;font-weight:600;text-transform:uppercase}.storage-type.local{background:#0f83;color:#0f8}.storage-type.session{background:#ffc10733;color:#ffc107}.storage-delete-btn{width:20px;height:20px;border:1px solid rgba(255,71,87,.3);background:#ff47571a;color:#ff4757;border-radius:3px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:12px}.storage-delete-btn:hover{background:#ff475733}.storage-item-size{font-size:10px;color:#666;margin-bottom:8px}.storage-item-value{background:#0f0f0f;border:1px solid #333;border-radius:4px;overflow:hidden}.storage-item-value pre{margin:0;padding:12px;overflow-x:auto;font-family:SF Mono,monospace;font-size:11px;line-height:1.4;color:#e6e6e6;max-height:200px;overflow-y:auto}.json-viewer{background:#0f0f0f;border:1px solid #333;border-radius:8px;overflow:hidden}.json-viewer pre{margin:0;padding:16px;overflow-x:auto;font-family:SF Mono,monospace;font-size:12px;line-height:1.6;color:#e6e6e6;max-height:400px;overflow-y:auto}.analytics-charts{display:flex;flex-direction:column;gap:12px}.analytics-bar{display:flex;flex-direction:column;gap:4px}.bar-label{font-size:12px;color:#ccc;font-weight:500}.bar-container{position:relative;background:#0f0f0f;border:1px solid #333;border-radius:4px;height:24px;overflow:hidden}.bar-fill{background:linear-gradient(90deg,#3c7dff,#2563eb);height:100%;transition:width .3s ease}.bar-value{position:absolute;right:8px;top:50%;transform:translateY(-50%);font-size:11px;color:#fff;font-weight:500}.source-stats{display:flex;flex-direction:column;gap:8px}.source-stat-item{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:6px}.source-name{font-size:12px;color:#ccc}.source-count{font-size:12px;color:#3c7dff;font-weight:600}.method-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}.method-stat-card{background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:8px;padding:16px}.method-name{font-size:14px;font-weight:600;color:#fff;margin-bottom:8px}.method-metrics{display:flex;flex-direction:column;gap:4px}.method-metrics .metric{font-size:11px;color:#888}.performance-chart{display:flex;flex-direction:column;gap:8px}.performance-bar{display:flex;flex-direction:column;gap:4px}.enhancer-distribution{display:flex;flex-direction:column;gap:8px}.enhancer-dist-item{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:6px}.enhancer-type{font-size:12px;color:#ccc}.enhancer-count{font-size:12px;color:#3c7dff;font-weight:600}.performance-metrics{display:flex;flex-direction:column;gap:12px}.performance-metric{display:flex;justify-content:space-between;align-items:center;padding:12px;background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:6px}.enhancement-timeline{display:flex;flex-direction:column;gap:8px}.timeline-item{display:flex;gap:16px;padding:8px 12px;background:linear-gradient(135deg,#222,#1a1a1a);border:1px solid #333;border-radius:6px}.timeline-time{font-size:11px;color:#888;font-family:SF Mono,monospace;min-width:60px}.timeline-event{font-size:12px;color:#ccc}@media (max-width: 768px){.metrics-grid,.form-fields-grid{grid-template-columns:repeat(2,1fr)}.customer-info{grid-template-columns:1fr}.config-groups{gap:16px}.storage-items{gap:8px}.method-stats{grid-template-columns:1fr}}",op=".timeline-header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#f8f9fa;border-bottom:1px solid #e9ecef;border-radius:4px 4px 0 0;margin-bottom:12px}.timeline-stats{display:flex;gap:16px}.timeline-stat{display:flex;flex-direction:column;align-items:center;font-size:11px}.timeline-stat-label{color:#6c757d;margin-bottom:2px}.timeline-stat-value{font-weight:600;color:#495057}.timeline-stat-value.recording{color:#28a745}.timeline-stat-value.paused{color:#dc3545}.timeline-controls{display:flex;gap:8px}.timeline-control-btn{padding:6px 12px;border:1px solid #dee2e6;border-radius:3px;background:#fff;font-size:11px;cursor:pointer;transition:all .2s}.timeline-control-btn:hover{background:#f8f9fa;transform:translateY(-1px)}.timeline-control-btn.record{background:#28a745;color:#fff;border-color:#28a745}.timeline-control-btn.pause{background:#ffc107;color:#212529;border-color:#ffc107}.timeline-control-btn.clear{background:#dc3545;color:#fff;border-color:#dc3545}.timeline-control-btn.export{background:#007bff;color:#fff;border-color:#007bff}.timeline-events{max-height:500px;overflow-y:auto;padding:0 4px}.timeline-event{background:#fff;border:1px solid #e9ecef;border-radius:4px;margin-bottom:8px;transition:all .2s;position:relative}.timeline-event:hover{box-shadow:0 2px 8px #0000001a;transform:translateY(-1px)}.timeline-event-header{padding:8px 12px;border-bottom:1px solid #f8f9fa;display:flex;justify-content:space-between;align-items:center}.timeline-event-meta{display:flex;align-items:center;gap:8px;font-size:11px}.timeline-event-icon{font-size:14px}.timeline-event-type{font-weight:600;text-transform:uppercase;letter-spacing:.5px}.timeline-event-time{color:#6c757d;font-style:italic}.timeline-event-name{font-weight:600;color:#495057;font-size:13px}.timeline-event-details{padding:8px 12px;font-size:11px}.timeline-event-source{color:#6c757d;margin-bottom:8px}.timeline-event-data-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}.timeline-toggle-data{background:none;border:1px solid #dee2e6;border-radius:2px;padding:2px 6px;font-size:10px;cursor:pointer;color:#007bff}.timeline-toggle-data:hover{background:#f8f9fa}.timeline-event-data-content{background:#f8f9fa;border:1px solid #e9ecef;border-radius:3px;padding:8px;margin:4px 0;font-family:Monaco,Consolas,monospace;font-size:10px;line-height:1.4;max-height:200px;overflow-y:auto}.timeline-event-data-preview{background:#f8f9fa;border:1px solid #e9ecef;border-radius:3px;padding:6px;font-family:Monaco,Consolas,monospace;font-size:10px;color:#6c757d;white-space:pre-wrap;word-break:break-all}.timeline-empty{text-align:center;padding:40px 20px;color:#6c757d}.timeline-empty-icon{font-size:48px;margin-bottom:16px}.timeline-empty-title{font-size:16px;font-weight:600;margin-bottom:8px;color:#495057}.timeline-empty-subtitle{font-size:13px}.analytics-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:12px}.analytics-card{background:#fff;border:1px solid #e9ecef;border-radius:4px;padding:12px}.analytics-card-full{grid-column:1 / -1}.analytics-card-title{font-weight:600;margin-bottom:12px;color:#495057;font-size:13px;border-bottom:1px solid #f8f9fa;padding-bottom:6px}.analytics-stats{display:flex;flex-direction:column;gap:8px}.analytics-stat{display:flex;justify-content:space-between;font-size:11px}.analytics-stat-label{color:#6c757d}.analytics-stat-value{font-weight:600;color:#495057}.analytics-distribution{display:flex;flex-direction:column;gap:6px}.analytics-distribution-item{display:flex;align-items:center;gap:8px;font-size:11px}.analytics-distribution-bar{flex:1;height:16px;background:#f8f9fa;border-radius:8px;overflow:hidden;position:relative}.analytics-distribution-fill{height:100%;border-radius:8px;transition:width .3s ease}.analytics-distribution-label{min-width:80px;color:#495057;font-weight:500}.analytics-sources{display:flex;flex-direction:column;gap:4px;max-height:200px;overflow-y:auto}.analytics-source-item{display:flex;justify-content:space-between;padding:4px 8px;background:#f8f9fa;border-radius:3px;font-size:11px}.analytics-source-name{color:#495057;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.analytics-source-count{color:#6c757d;font-weight:600;min-width:20px;text-align:right}.timeline-chart{display:flex;align-items:end;gap:4px;height:100px;padding:8px;background:#f8f9fa;border-radius:4px}.timeline-chart-bar{flex:1;background:linear-gradient(to top,#007bff,#66b3ff);border-radius:2px 2px 0 0;min-height:2px;position:relative;cursor:pointer;transition:all .2s}.timeline-chart-bar:hover{opacity:.8;transform:scaleY(1.1)}.timeline-chart-value{position:absolute;top:-16px;left:50%;transform:translate(-50%);font-size:9px;color:#495057;font-weight:600;opacity:0;transition:opacity .2s}.timeline-chart-bar:hover .timeline-chart-value{opacity:1}.filters-container{padding:12px;display:flex;flex-direction:column;gap:16px}.filter-group{border:1px solid #e9ecef;border-radius:4px;padding:12px;background:#fff}.filter-group-title{font-weight:600;margin-bottom:8px;color:#495057;font-size:12px}.filter-search-input{width:100%;padding:6px 8px;border:1px solid #dee2e6;border-radius:3px;font-size:11px}.filter-search-input:focus{outline:none;border-color:#007bff;box-shadow:0 0 0 2px #007bff40}.filter-checkboxes{display:flex;flex-direction:column;gap:6px}.filter-checkbox{display:flex;align-items:center;gap:6px;font-size:11px;cursor:pointer;padding:4px;border-radius:3px;transition:background .2s}.filter-checkbox:hover{background:#f8f9fa}.filter-checkbox input[type=checkbox]{margin:0}.filter-checkbox-icon{font-size:14px}.filter-checkbox-label{color:#495057}.filter-sources-list{max-height:150px;overflow-y:auto;border:1px solid #e9ecef;border-radius:3px;padding:4px}.filter-empty{color:#6c757d;font-style:italic;text-align:center;padding:12px;font-size:11px}.filter-time-range{width:100%;padding:6px 8px;border:1px solid #dee2e6;border-radius:3px;font-size:11px;background:#fff}.filter-controls{display:flex;gap:8px}.filter-control-btn{flex:1;padding:8px 12px;border:1px solid #dee2e6;border-radius:3px;background:#fff;font-size:11px;cursor:pointer;transition:all .2s}.filter-control-btn:hover{background:#f8f9fa;transform:translateY(-1px)}@media (max-width: 768px){.timeline-header{flex-direction:column;gap:12px;align-items:stretch}.timeline-stats{justify-content:space-around}.analytics-grid{grid-template-columns:1fr}.filter-controls{flex-direction:column}}@keyframes eventAdded{0%{opacity:0;transform:translate(-20px)}to{opacity:1;transform:translate(0)}}.timeline-event.new{animation:eventAdded .3s ease-out}.timeline-events::-webkit-scrollbar,.analytics-sources::-webkit-scrollbar,.filter-sources-list::-webkit-scrollbar{width:6px}.timeline-events::-webkit-scrollbar-track,.analytics-sources::-webkit-scrollbar-track,.filter-sources-list::-webkit-scrollbar-track{background:#f8f9fa;border-radius:3px}.timeline-events::-webkit-scrollbar-thumb,.analytics-sources::-webkit-scrollbar-thumb,.filter-sources-list::-webkit-scrollbar-thumb{background:#dee2e6;border-radius:3px}.timeline-events::-webkit-scrollbar-thumb:hover,.analytics-sources::-webkit-scrollbar-thumb:hover,.filter-sources-list::-webkit-scrollbar-thumb:hover{background:#adb5bd}",cp=class{static loadDebugStyles(){return g(this,null,function*(){if(!this.isLoading&&!this.styleElement){this.isLoading=!0;try{const t=yield this.getDebugStyles();this.styleElement=document.createElement("style"),this.styleElement.id="debug-overlay-styles",this.styleElement.textContent=t,document.head.appendChild(this.styleElement)}catch(t){}finally{this.isLoading=!1}}})}static getDebugStyles(){return g(this,null,function*(){return[ep,ip,np,rp,sp,ap,op].join("\n")})}static removeDebugStyles(){this.styleElement&&(this.styleElement.remove(),this.styleElement=null);const t=document.getElementById("debug-overlay-styles");t&&t.remove()}};cp.styleElement=null,cp.isLoading=!1;let lp=cp;const dp=Object.freeze(Object.defineProperty({__proto__:null,DebugStyleLoader:lp},Symbol.toStringTag,{value:"Module"}));t.ApiClient=re,t.EventBus=st,t.Logger=Y,t.NextCommerce=ae,t.ProfileManager=ge,t.ProfileMapper=ye,t.ProfileSelectorEnhancer=we,t.ProfileSwitcherEnhancer=xe,t.SDKInitializer=me,t.VERSION=ke,t.useCampaignStore=dt,t.useCartStore=Tt,t.useCheckoutStore=Mt,t.useConfigStore=yt,t.useOrderStore=Ot,t.useProfileStore=mt,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});
