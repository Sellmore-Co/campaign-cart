<!DOCTYPE html>
<html>
<head>
    <title>Exit Intent Test</title>
    <script src="./loader.js"></script>
    <style>
        body {
            min-height: 100vh;
            padding: 40px;
            font-family: Arial, sans-serif;
        }
        .test-content {
            max-width: 800px;
            margin: 0 auto;
        }
        .status {
            padding: 20px;
            background: #f0f0f0;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .event-log {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .event-log div {
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        .event-log .clicked { color: green; font-weight: bold; }
        .event-log .dismissed { color: orange; }
        .event-log .closed { color: red; }
        .event-log .action { color: blue; font-weight: bold; }
        .controls {
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            margin-right: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="test-content">
        <h1>Exit Intent Test</h1>
        
        <div class="status">
            <h3>Instructions:</h3>
            <ol>
                <li>Move your mouse to the top of the browser window to trigger exit intent</li>
                <li>Try clicking on different areas:</li>
                <ul>
                    <li><strong>Image</strong>: Should trigger the action (green log)</li>
                    <li><strong>Overlay (dark area)</strong>: Should dismiss without action (orange log)</li>
                    <li><strong>Close button</strong>: Should close without action (red log)</li>
                    <li><strong>ESC key</strong>: Should dismiss without action (orange log)</li>
                </ul>
            </ol>
        </div>
        
        <div class="controls">
            <button onclick="setupDefault()">Setup Default (Image Clickable)</button>
            <button onclick="setupNonClickable()">Setup Non-Clickable Image</button>
            <button onclick="setupWithButton()">Setup With Action Button</button>
            <button onclick="window.next.disableExitIntent()">Disable Exit Intent</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>
        
        <h3>Event Log:</h3>
        <div class="event-log" id="eventLog">
            Waiting for events...
        </div>
    </div>

    <script>
        let logElement;
        
        window.addEventListener('next:initialized', async () => {
            console.log('SDK initialized');
            logElement = document.getElementById('eventLog');
            
            // Listen to all exit intent events
            window.next.on('exit-intent:shown', (data) => {
                addLog('Exit intent shown', 'shown');
            });
            
            window.next.on('exit-intent:clicked', (data) => {
                addLog('Exit intent CLICKED - Action executed!', 'clicked');
            });
            
            window.next.on('exit-intent:dismissed', (data) => {
                addLog('Exit intent dismissed (overlay/ESC) - No action', 'dismissed');
            });
            
            window.next.on('exit-intent:closed', (data) => {
                addLog('Exit intent closed (X button) - No action', 'closed');
            });
            
            window.next.on('exit-intent:action', (data) => {
                addLog(`Exit intent action: ${data.action}`, 'action');
            });
            
            // Setup default exit intent
            setupDefault();
        });
        
        function setupDefault() {
            window.next.exitIntent({
                image: 'https://via.placeholder.com/600x400/4CAF50/ffffff?text=Click+Me+for+10%25+Discount',
                action: async () => {
                    addLog('>>> DISCOUNT ACTION EXECUTED <<<', 'action');
                    alert('10% Discount Applied!');
                }
            });
            addLog('Setup: Default (image clickable)', 'info');
        }
        
        function setupNonClickable() {
            window.next.exitIntent({
                image: 'https://via.placeholder.com/600x400/FF9800/ffffff?text=Not+Clickable+-+Use+Button',
                imageClickable: false,
                showCloseButton: true,
                action: async () => {
                    addLog('>>> THIS SHOULD NOT EXECUTE <<<', 'action');
                    alert('This should not happen!');
                }
            });
            addLog('Setup: Non-clickable image', 'info');
        }
        
        function setupWithButton() {
            window.next.exitIntent({
                image: 'https://via.placeholder.com/600x300/2196F3/ffffff?text=Special+Offer',
                actionButtonText: 'Apply 10% Discount',
                showCloseButton: true,
                action: async () => {
                    addLog('>>> BUTTON ACTION EXECUTED <<<', 'action');
                    alert('10% Discount Applied via Button!');
                }
            });
            addLog('Setup: With action button', 'info');
        }
        
        function addLog(message, type = '') {
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${time}] ${message}`;
            logElement.insertBefore(div, logElement.firstChild);
        }
        
        function clearLog() {
            logElement.innerHTML = 'Log cleared. Waiting for events...';
        }
        
        // Initialize SDK
        window.NextCommerce.init({
            apiKey: 'test-key',
            campaignId: '1',
            debug: true
        });
    </script>
</body>
</html>